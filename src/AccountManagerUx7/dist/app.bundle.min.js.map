{
  "version": 3,
  "sources": ["app.temp.js"],
  "sourcesContent": ["\n;/* === client/am7client.js === */\n\r\n (function(){\r\n\t\r\n\tif(!window.uwm){\r\n\t\tvar cache = {};\r\n\t\tvar principal = 0;\r\n\t\tvar sCurrentOrganization = 0;\r\n\t\tvar sBase = g_application_path + \"/rest\";\r\n\t\tvar sCache = sBase + \"/cache\";\r\n\t\tvar sResource = sBase + \"/resource\";\r\n\t\tvar sModelSvc = sBase + \"/model\";\r\n\t\tvar sPrincipal = sBase + \"/principal\";\r\n\t\tvar sSearch = sBase + \"/search\";\r\n\t\tvar sPathSvc = sBase + \"/path\";\r\n\t\tvar sMake = sBase + \"/make\";\r\n\t\tvar sList = sBase + \"/list\";\r\n\t\tvar sStreamSvc = sBase + \"/stream\";\r\n\t\tvar sAuthZ = sBase + \"/authorization\";\r\n\t\tvar sComm = sBase + \"/community\";\r\n\t\tvar sCred = sBase + \"/credential\";\r\n\t\tvar sPol = sBase + \"/policy\";\r\n\t\tvar sCtl = sBase + \"/control\";\r\n\t\tvar sReq = sBase + \"/request\";\r\n\t\tvar sToken = sBase + \"/token\";\r\n\t\tvar sAppr = sBase + \"/approval\";\r\n\t\tvar sScr = sBase + \"/script\";\r\n\t\tvar sTagSvc = sBase +\"/tag\";\r\n\t\tvar sOlio = sBase + \"/olio\";\r\n\t\twindow.uwm = {\r\n\t\t\tconsoleMode : 0,\r\n\t\t\tdeveloperMode : 0,\t\r\n\t\t\tdebugMode : 1,\r\n\t\t\tshowDescription : 0,\r\n\t\t\t\r\n\t\t\tgetUser : function(){\r\n\t\t\t\treturn getPrincipal();\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tlogin : function(o, u, p, v2, fH){\r\n\t\t\t\tvar vParms = (v2 ? v2 : {});\r\n\t\t\t\tam7client.loginWithPassword(o, u, p, function(b){\r\n\t\t\t\t\tif(b){\r\n\t\t\t\t\t\tam7client.clearCache(0,1);\r\n\t\t\t\t\t\twindow.uwm.getUser().then((oU2)=>{\r\n\t\t\t\t\t\t\tif(uwm.altFlushSession) uwm.altFlushSession();\r\n\t\t\t\t\t\t\tvParms.user = oU2;\r\n\t\t\t\t\t\t\tif(fH) fH(oU2);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\tconsole.log(\"Login: \" + b);\r\n\t\t\t\t\t\tvParms.user = 0;\r\n\t\t\t\t\t\tif(fH) fH(null);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn 1;\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\t\r\n\t\t\tlogout : async function(){\r\n\t\t\t\treturn am7client.logout().then((b)=>{\r\n\t\t\t\t\treturn b;\r\n\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\tgetApiTypeView : function(sType){\r\n\t\t\t\treturn g_application_path + \"\";\r\n\t\t\t},\r\n\t\t\tgetDefaultParentForType : function(sType, vDef){\r\n\t\t\t\tif(uwm.defaultParentProvider){\r\n\t\t\t\t\treturn uwm.defaultParentProvider(sType,vDef);\r\n\t\t\t\t}\r\n\t\t\t\treturn Promise.resolve(vDef);\r\n\t\t\t},\r\n\t\t\tbase64Encode : function(a){\r\n\t\t\t\treturn Base64.encode(a);\r\n\t\t\t},\r\n\t\t\tbase64Decode : function(a){\r\n\t\t\t\treturn Base64.decode(a);\r\n\t\t\t},\r\n\t\t\tstrToBin : function(s){\r\n\t\t\t\tvar a = [];\r\n\t\t\t\tfor(var i = 0; i < s.length;) a.push(s.charCodeAt(i++));\r\n\t\t\t\treturn a;\r\n\t\t\t},\r\n\t\t\tbinToStr : function(a){\r\n\t\t\t\tvar s = [];\r\n\t\t\t\tif(!a) return s;\r\n\t\t\t\tfor(var i = 0; i < a.length;) s.push(String.fromCharCode(a[i++]));\r\n\t\t\t\treturn s.join(\"\");\r\n\t\t\t},\r\n\t\t\tguid : function(){\r\n\t\t\t\treturn page.uid();\r\n\t\t\t},\r\n\t\t\t/// sKey and sIv in Base64 string format\r\n\t\t\t///\r\n\t\t\tencipher : function(sText, sKey, sIv){\r\n\t\t\t var enc = slowAES.encrypt(uwm.strToBin(sText),\r\n\t        \t\tslowAES.modeOfOperation.CBC,\r\n\t        \t\tslowAES.padding.PKCS7,\r\n\t                uwm.strToBin(uwm.base64Decode(sKey)),\r\n\t                uwm.strToBin(uwm.base64Decode(sIv))\r\n\t          );\r\n\t          return enc.cipher;\r\n\r\n\t\t\t},\r\n\t\t\tdecipher : function(sText, sKey, sIv){\r\n\t        \r\n\t        \treturn slowAES.decrypt(uwm.strToBin(uwm.base64Decode(sText)),\r\n\t        \t\t\tslowAES.modeOfOperation.CBC,\r\n\t        \t\t\tslowAES.padding.PKCS7,\r\n\t        \t\t\tuwm.strToBin(uwm.base64Decode(sKey)),\r\n\t        \t\t\tuwm.strToBin(uwm.base64Decode(sIv))\r\n\t        \t);\r\n\t\t\t},\r\n\r\n\t\t\thandlers : {\r\n\t\t\t\tload : [],\r\n\t\t\t\tunload : []\r\n\t\t\t},\r\n\t\t\taddPageLoadHandler : function(f){\r\n\t\t\t\tuwm.handlers.load.push(f);\r\n\t\t\t},\r\n\t\t\tprocessLoadHandlers : function(){\r\n\t\t\t\tvar aH = uwm.handlers.load, i = 0;\r\n\t\t\t\tfor(; i < aH.length;) aH[i++]();\r\n\t\t\t\taH.length = 0;\r\n\t\t\t},\r\n\t\t\t\r\n\t\t};\r\n\t}\r\n\r\n\tfunction getCache(){\r\n\t\treturn cache;\r\n\t}\r\n\r\n\tfunction cleanup(fH){\r\n\t\treturn get(sModelSvc + \"/cleanup\",fH);\r\n\t}\r\n\r\n\tfunction clearCache(vType, bLocalOnly, fH){\r\n\t\tvar sType = vType, oObj;\r\n\t\tif(vType != null && typeof vType == \"object\"){\r\n\t\t\tsType = vType[am7model.jsonModelKey];\r\n\t\t\toObj = vType;\r\n\t\t\treturn removeFromCache(sType, vType.objectId);\r\n\t\t}\r\n\t\tif(!sType){\r\n\t\t\tcache = {};\r\n\t\t\treturn (bLocalOnly ? Promise.resolve(true) : get(sCache + \"/clearAll\",fH));\r\n\t\t}\r\n\t\telse{\r\n\t\t\tdelete cache[sType];\r\n\t\t\tif(sType.match(/^(project|lifecycle)$/gi)) delete cache[\"GROUP\"];\r\n\t\t\tdelete cache[\"COUNT\"];\r\n\t\t\treturn (bLocalOnly ? Promise.resolve(true) : get(sCache + \"/clear/\" + sType,fH));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction removeFromCache(vType, sObjId){\r\n\t\tvar sType = vType;\r\n\t\tif(typeof vType == \"object\"){\r\n\t\t\tsType = vType[am7model.jsonModelKey];\r\n\t\t\tif(!sObjId) sObjId = vType.objectId;\r\n\t\t}\r\n\t\tif(!cache[sType]) return;\r\n\t\tfor(var s in cache[sType]){\r\n\t\t\tdelete cache[sType][s][sObjId];\r\n\t\t}\r\n\t}\r\n\tfunction getFromCache(sType, sAct, sObjId){\r\n\t\tif(!cache[sType]) return 0;\r\n\t\tif(!cache[sType][sAct]) return 0;\r\n\t\tif(typeof cache[sType][sAct][sObjId]==\"undefined\") return 0;\r\n\t\treturn cache[sType][sAct][sObjId];\r\n\t}\r\n\tfunction addToCache(sType, sAct, sId, vObj){\r\n\t\tif(!cache[sType]) cache[sType] = {};\r\n\t\tif(!cache[sType][sAct]) cache[sType][sAct] = {};\r\n\t\tcache[sType][sAct][sId]=vObj;\r\n\t\t\r\n\t}\r\n\tfunction newPrimaryCredential(sType, sObjId, oAuthN, fH){\r\n\t\treturn post(sCred + \"/\" + sType + \"/\" + sObjId, oAuthN, fH);\r\n\t}\r\n\r\n\tfunction deleteObject(sType,sObjId, fH){\r\n\t\tdelete cache[sType];\r\n\r\n\t\treturn del(sModelSvc + \"/\" + sType + \"/\" + sObjId,fH);\r\n\t}\r\n\t\r\n\tfunction patchObject(sType, oObj, fH){\r\n\t   delete cache[sType];\r\n\t   // console.log(oObj);\r\n\t   return patch(sModelSvc, oObj, fH);\r\n\t}\r\n\t\r\n\tfunction create(sType,oObj, fH){\r\n\t\tdelete cache[sType];\r\n\t   return post(sModelSvc, oObj, fH);\r\n\t}\r\n\r\n\tfunction updateBulk(sType,aObj, fH){\r\n\t\tconsole.error(\"REFACTOR: updateBulk\");\r\n\t\tdelete cache[sType];\r\n\t   //return Hemi.xml.postJSON(sResource + \"/\" + sType + \"/bulk\", aObj,fH,(fH ? 1 : 0));\r\n\t}\r\n\t\r\n\tfunction evaluate(oObj, fH){\r\n\t\tconsole.error(\"REFACTOR: evaluate\");\r\n\t\t// return Hemi.xml.postJSON(sPol + \"/evaluate\",oObj,fH,(fH ? 1 : 0));\r\n\t}\r\n\tfunction executeScript(urn, fH){\r\n\t\tconsole.error(\"REFACTOR: execute\");\r\n\t\t// return Hemi.xml.getJSON(sScr + \"/execurn/\" + urn,fH,(fH ? 1 : 0));\r\n\t}\r\n\tfunction executeScriptById(sObjectId, fH){\r\n\t\tconsole.error(\"REFACTOR: executeScriptById\");\r\n\t\t//return Hemi.xml.getJSON(sScr + \"/execid/\" + sObjectId,fH,(fH ? 1 : 0));\r\n\t}\r\n\tfunction define(sObjectId, fH){\r\n\t\tconsole.error(\"REFACTOR: define\");\r\n\t   //return Hemi.xml.getJSON(sPol + \"/define/\" + sObjectId,fH,(fH ? 1 : 0));\r\n\t}\r\n\tfunction searchCount(q, fH){\r\n\t\treturn search(q, fH, 1);\r\n\t}\r\n\tlet compLabel = {\r\n\t\tless_than: \"<\",\r\n\t\tless_than_or_equals: \"<=\",\r\n\t\tequals: \"=\",\r\n\t\tgreater_than: \">\",\r\n\t\tgreater_than_or_equals: \">=\",\r\n\t\tgroup_and: \"&&\",\r\n\t\tgroup_or: \"||\"\r\n\t};\r\n\r\n\r\n\tfunction newQuery(m){\r\n\t\tlet q = {\r\n\t\t\tentity : {\r\n\t\t\t\tschema: \"io.query\",\r\n\t\t\t\ttype: m,\r\n\t\t\t\tfields: [],\r\n\t\t\t\torder: 'ascending',\r\n\t\t\t\tcomparator: \"group_and\",\r\n\t\t\t\trecordCount: 10,\r\n\t\t\t\tcache: true,\r\n\t\t\t\trequest: am7model\r\n\t\t\t\t\t.inheritsFrom(m)\r\n\t\t\t\t\t.filter(m => m.query)\r\n\t\t\t\t\t.map(m => m.query)\r\n\t\t\t\t\t.flat(1)\r\n\t\t\t\t\t.filter( (v, i, z) => z.indexOf(v) == i)\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tq.cache = (b) => {\r\n\t\t\tq.entity.cache = b;\r\n\t\t};\r\n\t\t\r\n\t\tq.range = function(s, c){\r\n\t\t\tq.entity.startRecord = parseInt(s);\r\n\t\t\tq.entity.recordCount = parseInt(c);\r\n\t\t};\r\n\r\n\t\tq.sort = function(s){\r\n\t\t\tif(s != undefined){\r\n\t\t\t\tq.entity.sortField = s;\r\n\t\t\t}\r\n\t\t\treturn s;\r\n\t\t}\r\n\t\tq.order = function(o){\r\n\t\t\tif(o != undefined){\r\n\t\t\t\tq.entity.order = o;\r\n\t\t\t}\r\n\t\t\treturn q.entity.order;\r\n\t\t};\r\n\t\tq.field = function(name, value){\r\n\t\t\tlet fld = {\r\n\t\t\t\tcomparator: \"equals\",\r\n\t\t\t\tname,\r\n\t\t\t\tvalue\r\n\t\t\t};\r\n\t\t\tq.entity.fields.push(fld);\r\n\t\t\treturn fld;\r\n\t\t};\r\n\t\tq.keyField = function(afs){\r\n\t\t\treturn \"(\" + afs.map(f =>  f.fields ? q.keyField(f.fields) : f.name + \" \" + compLabel[f.comparator] + \" \" + f.value).join(\", \") + \")\";\r\n\t\t};\r\n\r\n\t\tq.key = function(){\r\n\t\t\tlet r = q.entity.request.join(\",\");\r\n\t\t\tif(!r.length) r = \"*\";\r\n\t\t\tlet k = [\r\n\t\t\t\tq.entity.type,\r\n\t\t\t\tq.entity.order,\r\n\t\t\t\tq.entity.limit || false,\r\n\t\t\t\tq.entity.sortField || \"id\",\r\n\t\t\t\tq.entity.startRecord || 0,\r\n\t\t\t\tq.entity.recordCount || 10,\r\n\t\t\t\tpage?.user?.objectId || \"000\",\r\n\t\t\t\tq.keyField(q.entity.fields)\r\n\t\t\t];\r\n\t\t\treturn k.join(\"-\");\r\n\t\t};\r\n\t\treturn q;\r\n\t}\r\n\t/*\r\n\tfunction query(m, f){\r\n\t\tlet r = [];\r\n\t\tlet r1 = am7model.queryFields(m);\r\n\t\tlet request = (f || r1).filter( (v, i, z) => z.indexOf(v) == i);\r\n\t\treturn {\r\n\t\t\ttype: m,\r\n\t\t\tcomparator: \"group_and\",\r\n\t\t\tfields: [\r\n\t\t\t\t{\r\n\t\t\t  \t\t\"comparator\" : \"equals\",\r\n\t\t\t  \t\t\"name\" : \"organizationId\",\r\n\t\t\t  \t\t\"value\" : page?.user?.organizationId\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\torder: 'ascending',\r\n\t\t\trecordCount: 10,\r\n\t\t\trequest\r\n\r\n\t\t};\r\n\t}\r\n\t*/\r\n\r\n\tfunction search(q, fH, bCount){\r\n\t\t\r\n\t\tvar sKey = q.key();\r\n\t\tlet type = (q.entity.type + (bCount ? \"-Count\" : \"\"));\r\n\t\tif(q.entity.cache){\r\n\t\t\tvar o = getFromCache(type, \"GET\", sKey);\r\n\t\t\tif(o){\r\n\t\t\t\tif(fH) fH(o);\r\n\t\t\t\treturn o;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(q.entity.cache && typeof v != \"undefined\" && v != null){addToCache(type,\"GET\",sKey,v);} if(f) f(v);};\r\n\t\treturn post(sModelSvc + \"/search\" + (bCount ? \"/count\" : \"\"), q.entity, fc);\r\n\t}\r\n\tfunction trace( bEnable, fH){\r\n\t\tif(typeof bEnable != \"boolean\") bEnable = true;\r\n\t\treturn get(sAuthZ + \"/unknown/trace/\" + bEnable, fH);\r\n\t}\r\n\tfunction member(sObjectType, sObjectId, sField, sActorType, sActorId, bEnable, fH){\r\n\t\treturn get(sAuthZ + \"/\" + sObjectType + \"/\" + sObjectId + \"/member/\" + sField + \"/\" + sActorType + \"/\" + sActorId + \"/\" + bEnable, fH);\r\n\t}\r\n\tfunction getApplicationProfile(fH){\r\n\t\treturn get(sPrincipal + \"/application\", fH);\r\n\t}\r\n\tfunction getPrincipal(fH){\r\n\t\treturn get(sPrincipal + \"/\", fH);\r\n\t}\r\n\tfunction getImageTags(sObjectId, fH){\r\n\t\tif(!sObjectId){\r\n\t\t\tconsole.error(\"Invalid objectId (\" + sObjectId + \")\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet sType = \"data.data\";\r\n\t\tvar o = getFromCache(sType, \"GET\", sObjectId);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,\"GET\",sObjectId,v);} if(f) f(v);};\r\n\t    return get(sTagSvc + \"/\" + sObjectId, fc);\r\n\t}\r\n\tfunction applyImageTags(sObjectId, fH){\r\n\t\tif(!sObjectId){\r\n\t\t\tconsole.error(\"Invalid objectId (\" + sObjectId + \")\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet sType = \"data.data\";\r\n\t\tvar o = getFromCache(sType, \"GET\", sObjectId);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,\"GET\",sObjectId,v);} if(f) f(v);};\r\n\t    return get(sTagSvc + \"/apply/\" + sObjectId, fc);\r\n\t}\r\n\tfunction getByObjectId(sType,sObjectId, fH){\r\n\t\tif(!sType || !sObjectId){\r\n\t\t\tconsole.error(\"Invalid type (\" + sType + \") or objectId (\" + sObjectId + \")\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar o = getFromCache(sType, \"GET\", sObjectId);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,\"GET\",sObjectId,v);} if(f) f(v);};\r\n\t    return get(sModelSvc + \"/\" + sType + \"/\" + sObjectId, fc);\r\n\t}\r\n\tfunction getFullByObjectId(sType, sObjectId){\r\n\t\treturn get(sModelSvc + \"/\" + sType + \"/\" + sObjectId + \"/full\");\r\n\t}\r\n\tfunction getByUrn(sType, urn, fH){\r\n\t\tvar sKey = sType + \"-\" + urn;\r\n\t\tvar o = getFromCache(sType, \"GET\", sKey);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType, \"GET\", sKey, v);} if(f) f(v);};\r\n\t\tconsole.error(\"REFACTOR: getByUrn\");\r\n\t}\r\n\r\n\tfunction getByName(sType,sObjectId,sName,fH, bParent){\r\n\t\tvar sKey = sObjectId + \"-\" + sName;\r\n\t\t//console.log(\"Get by name\", sName);\r\n\t\tvar o = getFromCache(sType, \"GET\", sKey);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,\"GET\",sKey,v);} if(f) f(v);};\r\n\t\treturn get(sModelSvc + \"/\" + sType + \"/\" + (bParent ? \"parent/\" : \"\") + sObjectId + \"/\" + sName,fc);\r\n\t}\r\n\tfunction getByNameInGroupParent(sType,sObjectId,sName,fH){\r\n\t\tconsole.warn(\"REFACTOR: getByNameInGroupParent\");\r\n\t\treturn getByName(sType, sObjectId, sName, fH, 1);\r\n\t}\r\n\r\n    function stream(sObjectId, i, l, fH){\r\n\t    return get(sStreamSvc + \"/\" + sObjectId + \"/\" + i + \"/\" + (l || 0), fH);\r\n\t}\r\n\r\n\tfunction count(sType,sObjectId,fH){\r\n\t\tvar o = getFromCache(sType, \"COUNT\", sObjectId);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,\"COUNT\",sObjectId,v);} if(f) f(v);};\r\n\t\t//console.error(\"REFACTOR: count\");\r\n\t    return get(sList + \"/\" + sType + \"/\" + sObjectId + \"/count\",fc);\r\n\t}\r\n\t/*\r\n\tfunction countInParent(sType,sObjectId,fH){\r\n\t\tvar o = getFromCache(sType, \"COUNT\", sObjectId);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,\"COUNT\",sObjectId,v);} if(f) f(v);};\r\n\t   return get(sList + \"/\" + sType + \"/parent/\" + sObjectId + \"/count\",fc);\r\n\t}\r\n\t*/\r\n\tfunction list(sType, sObjectId, sFields, iStart, iLength, fH){\r\n\t\tvar sK = \"LIST-\" + sType + \"-\" + (sObjectId ? sObjectId : \"0\") + \"-\" + sFields + \"-\" + iStart + \"-\" + iLength;\r\n\t\tvar o = getFromCache(sType, sK, sObjectId);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,sK,sObjectId,v);} if(f) f(v);};\r\n\t\treturn get(sList + \"/\" + sType + \"/\" + sObjectId + \"/\" + (sFields ? sFields + \"/\" : \"\") + iStart + \"/\" + iLength,fc);\r\n\t}\r\n\t/*\r\n\tfunction listInParent(sType, sObjectId, iStart, sFields, iLength, fH){\r\n\t\t\r\n\t\tvar sK = \"LIST-\" + sType + \"-\" + (sObjectId ? sObjectId : \"0\") + \"-\" + sFields + \"-\" + iStart + \"-\" + iLength;\r\n\t\tvar o = getFromCache(sType, sK, sObjectId);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,sK,sObjectId,v);} if(f) f(v);};\r\n\t\treturn get(sList + \"/\" + sType + \"/parent/\" + sObjectId + \"/\" + iStart + \"/\" + iLength,fc);\r\n\t}\r\n\t*/\r\n\tfunction findTags(sType, sObjId, fH){\r\n\t\tconsole.error(\"REFACTOR: findTags\");\r\n\t\t// return Hemi.xml.getJSON(sSearch + \"/\" + sType + \"/tags/\" + sObjId,fH,(fH ? 1 : 0));\r\n\t}\r\n\tfunction findBy(sType, sObjId, oSearch, fH){\r\n\t\tconsole.error(\"REFACTOR: findBy\");\r\n\t\t// return Hemi.xml.postJSON(sSearch + \"/\" + sType + \"/\" + sObjId,oSearch,fH,(fH ? 1 : 0));\r\n\t}\r\n\tfunction findByTag(sType, aTags, fH){\r\n\t\tvar sKey = sType + \"-\" + aTags.map(t => t.id).join(\",\");\r\n\t\tvar o = getFromCache(\"TAG-ALL\", \"POST\", sKey);\r\n\t\tif(o){ if(fH) fH(o); return Promise.resolve(o); }\r\n\t\tvar fc = function(v){ if(v) addToCache(\"TAG-ALL\", \"POST\", sKey, v); if(fH) fH(v); };\r\n\t\treturn post(sTagSvc + \"/search/\" + sType, aTags, fc);\r\n\t}\r\n\tfunction countByTag(sType, aTags, fH){\r\n\t\tvar sKey = sType + \"-count-\" + aTags.map(t => t.id).join(\",\");\r\n\t\tvar o = getFromCache(\"TAG-ALL\", \"POST\", sKey);\r\n\t\tif(o){ if(fH) fH(o); return Promise.resolve(o); }\r\n\t\tvar fc = function(v){ if(typeof v != \"undefined\" && v != null) addToCache(\"TAG-ALL\", \"POST\", sKey, v); if(fH) fH(v); };\r\n\t\treturn post(sTagSvc + \"/search/\" + sType + \"/count\", aTags, fc);\r\n\t}\r\n\tfunction findByAnyTag(sType, aTags, fH){\r\n\t\tvar sKey = sType + \"-\" + aTags.map(t => t.id).join(\",\");\r\n\t\tvar o = getFromCache(\"TAG-ANY\", \"POST\", sKey);\r\n\t\tif(o){ if(fH) fH(o); return Promise.resolve(o); }\r\n\t\tvar fc = function(v){ if(v) addToCache(\"TAG-ANY\", \"POST\", sKey, v); if(fH) fH(v); };\r\n\t\treturn post(sTagSvc + \"/search/\" + sType + \"/any\", aTags, fc);\r\n\t}\r\n\tfunction countByAnyTag(sType, aTags, fH){\r\n\t\tvar sKey = sType + \"-count-\" + aTags.map(t => t.id).join(\",\");\r\n\t\tvar o = getFromCache(\"TAG-ANY\", \"POST\", sKey);\r\n\t\tif(o){ if(fH) fH(o); return Promise.resolve(o); }\r\n\t\tvar fc = function(v){ if(typeof v != \"undefined\" && v != null) addToCache(\"TAG-ANY\", \"POST\", sKey, v); if(fH) fH(v); };\r\n\t\treturn post(sTagSvc + \"/search/\" + sType + \"/any/count\", aTags, fc);\r\n\t}\r\n\tfunction find(sType,sObjType,sPath,fH){\r\n\t\t// console.error(\"REFACTOR: find\");\r\n\t\treturn makeFind(sType,sObjType,sPath,0,fH);\r\n\t}\r\n\tfunction make(sType,sObjType,sPath,fH){\r\n\t\t// console.error(\"REFACTOR: make\");\r\n\t\treturn makeFind(sType,sObjType,sPath,1,fH);\r\n\t}\r\n\r\n\tfunction makeFind(sType, sObjType, sPath, bMake,fH){\r\n\t\tvar sK = \"FIND-\" + sObjType;\r\n\r\n\t\t/// Band-aid - need to better encode these\r\n\t\t///\r\n\t\tif(sPath.match(/^\\//) || sPath.match(/\\./)){\r\n\t\t\tsPath = \"B64-\" + uwm.base64Encode(sPath).replace(/=/gi,\"%3D\");\r\n\t\t}\r\n\t\tvar o = getFromCache(sType, sK, sPath);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,sK,sPath,v);} if(f) f(v);};\r\n\r\n\t\treturn get(sPathSvc + (bMake ? \"/make/\" : \"/find/\") + sType + \"/\" + sObjType + \"/\" + sPath,fc);\r\n\t}\r\n\t\r\n\tfunction getDotPath(path, sAlt){\r\n\t\tif(!path){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn path.replace(/^\\//,\"\").replace(/\\//gi,(sAlt ? sAlt : \".\"));\r\n\t}\r\n\t\r\n\tfunction logout(fH){\r\n\t\tvar f = fH;\r\n\t\tam7client.currentOrganization = sCurrentOrganization = 0;\r\n\t\tam7client.clearCache(0,1);\r\n\t\treturn get(g_application_path + \"/rest/logout\").then((b) => {\r\n\t\t\tif(f){\r\n\t\t\t\tf(b);\r\n\t\t\t}\r\n\t\t\treturn b;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction loginWithPassword(sOrg, sName, sCred, fH){\r\n\t\tlet cred = {\r\n\t\t\tschema: \"auth.credential\",\r\n\t\t\tname: sName,\r\n\t\t\tcredential: Base64.encode(sCred),\r\n\t\t\torganizationPath: sOrg,\r\n\t\t\ttype: \"hashed_password\"\r\n\t\t};\r\n\t\treturn login(cred, fH);\r\n\t}\r\n\r\n\tfunction get(url, fH){\r\n\t\treturn m.request({\r\n\t\t\tmethod: 'GET',\r\n\t\t\turl,\r\n\t\t\twithCredentials: true\r\n\t\t}).then((x) => {\r\n\t\t\tif(fH){\r\n\t\t\t\tfH(x);\r\n\t\t\t}\r\n\t\t\treturn x;\r\n\t\t}).catch((x) =>{\r\n\t\t\tconsole.error(\"Failed to get \" + url);\r\n\t\t\tif(fH){\r\n\t\t\t\tfH();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction del(url, fH){\r\n\t\treturn m.request({\r\n\t\t\tmethod: 'DELETE',\r\n\t\t\turl,\r\n\t\t\twithCredentials: true\r\n\t\t}).then((x) => {\r\n\t\t\tif(fH){\r\n\t\t\t\tfH(x);\r\n\t\t\t}\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction post(url, data, fH){\r\n\t\treturn m.request({\r\n\t\t\tmethod: 'POST',\r\n\t\t\turl,\r\n\t\t\twithCredentials: true,\r\n\t\t\tbody: data\r\n\t\t}).then((x) => {\r\n\t\t\tif(fH){\r\n\t\t\t\tfH(x);\r\n\t\t\t}\r\n\t\t\treturn x;\r\n\t\t}).catch((x) =>{\r\n\t\t\tconsole.error(\"Failed to post \" + url, x);\r\n\t\t\tif(fH){\r\n\t\t\t\tfH();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction patch(url, data, fH){\r\n\t\treturn m.request({\r\n\t\t\tmethod: 'PATCH',\r\n\t\t\turl,\r\n\t\t\twithCredentials: true,\r\n\t\t\tbody: data\r\n\t\t}).then((x) => {\r\n\t\t\tif(fH){\r\n\t\t\t\tfH(x);\r\n\t\t\t}\r\n\t\t\treturn x;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction login(cred, fH){\r\n\t\tam7client.currentOrganization = sCurrentOrganization = cred.organizationPath;\r\n\t\treturn post(g_application_path + \"/rest/login\", cred, fH);\r\n\t}\r\n\t\r\n\tfunction getObjectAuthorization(sType, sObjectId, fH){\r\n\t\tvar sK = sObjectId + \" Authorization\";\r\n\t\tvar o = getFromCache(sType, \"GET\", sK);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(\"\", o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,\"GET\",sK, v);} if(f) f(v);};\r\n\t\tconsole.error(\"REFACTOR: getObjectAuthorization\");\r\n\t\t// return Hemi.xml.getJSON(sAuthZ + \"/\" + sType + \"/system/\" + sObjectId,fc,(fH ? 1 : 0));\r\n\t}\r\n\tfunction listSystemPermissions(fH){\r\n\t\tvar sK = sCurrentOrganization + \" SystemPermissions\";\r\n\t\tvar o = getFromCache(\"PERMISSION\", \"GET\", sK);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(\"PERMISSION\",\"GET\",sK,v);} if(f) f(v);};\r\n\t\tconsole.error(\"REFACTOR: listSystemPermissions - moved to ApplicationProfile\");\r\n\t\t// return Hemi.xml.getJSON(sAuthZ + \"/PERMISSION/systemPermissions\",fc,(fH ? 1 : 0));\r\n\t}\r\n\tfunction listSystemRoles(fH){\r\n\t\tvar sK = sCurrentOrganization + \" SystemRoles\";\r\n\t\tvar o = getFromCache(\"ROLE\", \"GET\", sK);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(\"ROLE\",\"GET\",sK,v);} if(f) f(v);};\r\n\t\tconsole.error(\"REFACTOR: listSystemRoles - moved to ApplicationProfile\");\r\n\t\t// return Hemi.xml.getJSON(sAuthZ + \"/ROLE/systemRoles\",fc,(fH ? 1 : 0));\r\n\t}\r\n\tfunction listSystemPolicies(fH){\r\n\t\tvar sK = sCurrentOrganization + \" SystemPolicies\";\r\n\t\tvar o = getFromCache(\"POLICY\", \"GET\", sK);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(\"POLICY\",\"GET\",sK,v);} if(f) f(v);};\r\n\t\tconsole.error(\"REFACTOR: listSystemPolicies\");\r\n\t\t//return Hemi.xml.getJSON(sAuthZ + \"/ROLE/systemPolicies\",fc,(fH ? 1 : 0));\r\n\t}\r\n\r\n\tfunction permitSystem(sType, sObjectId, sActorType, sActorId, bView, bEdit, bDelete, bCreate, fH){\r\n\t\tconsole.error(\"REFACTOR: permitSystem\");\r\n\t\t// return Hemi.xml.getJSON(sAuthZ + \"/\" + sType + \"/\" + sObjectId + \"/permit/\" + sActorType + \"/\" + sActorId + \"/\" + bView + \"/\" + bEdit + \"/\" + bDelete + \"/\" + bCreate,fH,(fH ? 1 : 0));\r\n\t}\r\n\tfunction permit(sType, sObjectId, sActorType, sActorId, sPermId, bEnable, fH){\r\n\t\tconsole.error(\"REFACTOR: permit\");\r\n\t\t//return Hemi.xml.getJSON(sAuthZ + \"/\" + sType + \"/\" + sObjectId + \"/permit/\" + sActorType + \"/\" + sActorId + \"/\" + sPermId + \"/\" + bEnable,fH,(fH ? 1 : 0));\r\n\t}\r\n\tfunction listMembers(sType, sObjectId, sActorType, iStart, iCount, fH){\r\n\t\tvar sK = \"LIST-\" + sType + \"-\" + (sObjectId ? sObjectId : \"0\") + \"-\" + sActorType + \"-\" + iStart + \"-\" + iCount;\r\n\t\tvar o = getFromCache(sType, sK, sObjectId);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,sK,sObjectId,v);} if(f) f(v);};\r\n\t\treturn get(sAuthZ + \"/\" + sType + \"/\" + sObjectId + \"/\" + sActorType + \"/\" + iStart + \"/\" + iCount, fc);\t\r\n\t}\r\n\tfunction countMembers(sType, sObjectId, sActorType, fH){\r\n\t\tvar sK = \"COUNT-\" + sType + \"-\" + (sObjectId ? sObjectId : \"0\") + \"-\" + sActorType;\r\n\t\tvar o = getFromCache(sType, sK, sObjectId);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,sK,sObjectId,v);} if(f) f(v);};\r\n\t\treturn get(sAuthZ + \"/\" + sType + \"/\" + sObjectId + \"/\" + sActorType + \"/count\",fc);\r\n\t}\r\n\tfunction membershipStats(sType, sParticipantType, iContainerId, iLimit, fH){\r\n\t\tvar sPart = sParticipantType || \"any\";\r\n\t\tvar iCont = iContainerId || 0;\r\n\t\tvar iLim = iLimit || 0;\r\n\t\tvar sK = \"STATS-\" + sType + \"-\" + sPart + \"-\" + iCont + \"-\" + iLim;\r\n\t\tvar o = getFromCache(sType, sK, null);\r\n\t\tif(o){\r\n\t\t\tif(fH) fH(o);\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tvar f = fH;\r\n\t\tvar fc = function(v){if(typeof v != \"undefined\" && v != null){addToCache(sType,sK,null,v);} if(f) f(v);};\r\n\t\treturn get(sAuthZ + \"/\" + sType + \"/stats/\" + sPart + \"/\" + iCont + \"/\" + iLim, fc);\r\n\t}\r\n\r\n\tfunction personalityProfile(sObjectId, fH){\r\n\t\treturn get(sOlio + \"/profile/\" + sObjectId, fH);\r\n\t}\r\n\r\n\tfunction profileComparison(sObjectId1, sObjectId2, fH){\r\n\t\treturn get(sOlio + \"/compare/\" + sObjectId1 + \"/\" + sObjectId2, fH);\r\n\t}\r\n\r\n\t/**\r\n\t * Apply patches to a cached object to keep it in sync with server state.\r\n\t * Patches are in the format: { path: \"state.currentLocation\", value: {...} }\r\n\t * @param {Object} obj - The object to patch\r\n\t * @param {Array} patches - Array of patch objects with 'path' and 'value' properties\r\n\t */\r\n\tfunction applyPatches(obj, patches) {\r\n\t\tif (!obj || !patches || !Array.isArray(patches)) return;\r\n\r\n\t\tpatches.forEach(function(patch) {\r\n\t\t\tif (!patch.path || patch.value === undefined) return;\r\n\r\n\t\t\tlet pathParts = patch.path.split('.');\r\n\t\t\tlet target = obj;\r\n\r\n\t\t\t// Navigate to parent of final property\r\n\t\t\tfor (let i = 0; i < pathParts.length - 1; i++) {\r\n\t\t\t\tlet part = pathParts[i];\r\n\t\t\t\tif (target[part] === undefined || target[part] === null) {\r\n\t\t\t\t\ttarget[part] = {};\r\n\t\t\t\t}\r\n\t\t\t\ttarget = target[part];\r\n\t\t\t}\r\n\r\n\t\t\t// Set the final property\r\n\t\t\tlet finalProp = pathParts[pathParts.length - 1];\r\n\t\t\ttarget[finalProp] = patch.value;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Refresh a nested object reference from the server.\r\n\t * Useful when a nested foreign reference becomes stale.\r\n\t * @param {Object} obj - The parent object containing the nested reference\r\n\t * @param {string} path - Dot-separated path to the nested object (e.g., \"state.currentLocation\")\r\n\t * @param {string} type - The schema type of the nested object (e.g., \"data.geoLocation\")\r\n\t * @param {boolean} full - Whether to fetch full object with all fields (default: true)\r\n\t * @returns {Promise} - Resolves with the refreshed nested object\r\n\t */\r\n\tasync function refreshNested(obj, path, type, full) {\r\n\t\tif (!obj || !path || !type) return null;\r\n\t\tif (full === undefined) full = true;\r\n\r\n\t\tlet pathParts = path.split('.');\r\n\t\tlet target = obj;\r\n\r\n\t\t// Navigate to the nested object\r\n\t\tfor (let i = 0; i < pathParts.length; i++) {\r\n\t\t\tif (target[pathParts[i]] === undefined || target[pathParts[i]] === null) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\ttarget = target[pathParts[i]];\r\n\t\t}\r\n\r\n\t\t// Get the objectId of the nested object\r\n\t\tlet nestedId = target.objectId || target.id;\r\n\t\tif (!nestedId) return null;\r\n\r\n\t\t// Fetch fresh data from server - use full fetch by default to get all fields\r\n\t\tlet fresh = full ? await getFullByObjectId(type, nestedId) : await getByObjectId(type, nestedId);\r\n\t\tif (!fresh) return null;\r\n\r\n\t\t// Navigate to parent and update the reference\r\n\t\tlet parent = obj;\r\n\t\tfor (let i = 0; i < pathParts.length - 1; i++) {\r\n\t\t\tparent = parent[pathParts[i]];\r\n\t\t}\r\n\t\tlet finalProp = pathParts[pathParts.length - 1];\r\n\t\tparent[finalProp] = fresh;\r\n\r\n\t\treturn fresh;\r\n\t}\r\n\r\n\t/**\r\n\t * Sync a cached object with a partial update from the server.\r\n\t * Merges the update into the cached object, preserving unaffected properties.\r\n\t * @param {Object} cached - The cached object to update\r\n\t * @param {Object} update - Partial update from the server\r\n\t * @param {boolean} deep - Whether to perform deep merge (default: true)\r\n\t */\r\n\tfunction syncObject(cached, update, deep) {\r\n\t\tif (!cached || !update) return cached;\r\n\t\tdeep = deep !== false;\r\n\r\n\t\tObject.keys(update).forEach(function(key) {\r\n\t\t\tif (deep && typeof update[key] === 'object' && update[key] !== null && !Array.isArray(update[key])) {\r\n\t\t\t\tif (typeof cached[key] === 'object' && cached[key] !== null) {\r\n\t\t\t\t\tsyncObject(cached[key], update[key], deep);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcached[key] = update[key];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcached[key] = update[key];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn cached;\r\n\t}\r\n\r\n\t/**\r\n\t * Sync multiple nested paths on an object from a server response.\r\n\t * Handles the sync data format returned by GameUtil.createSyncData().\r\n\t *\r\n\t * @param {Object} obj - The cached object to sync (e.g., player character)\r\n\t * @param {Object} syncData - Server response containing sync data and optional patches\r\n\t * @param {Object} pathMapping - Optional mapping of response keys to object paths\r\n\t *                               e.g., { \"stateSnapshot\": \"state\", \"statistics\": \"statistics\" }\r\n\t *\r\n\t * Example usage:\r\n\t *   am7client.syncFromResponse(player, resp, {\r\n\t *     \"stateSnapshot\": \"state\",\r\n\t *     \"location\": \"state.currentLocation\",\r\n\t *     \"statistics\": \"statistics\",\r\n\t *     \"profile\": \"profile\"\r\n\t *   });\r\n\t */\r\n\tfunction syncFromResponse(obj, syncData, pathMapping) {\r\n\t\tif (!obj || !syncData) return;\r\n\r\n\t\t// Apply patches if present (most precise method)\r\n\t\tif (syncData.patches && Array.isArray(syncData.patches)) {\r\n\t\t\tapplyPatches(obj, syncData.patches);\r\n\t\t}\r\n\r\n\t\t// Apply mapped snapshots if no patches or as supplement\r\n\t\tif (pathMapping) {\r\n\t\t\tObject.keys(pathMapping).forEach(function(responseKey) {\r\n\t\t\t\tif (syncData[responseKey]) {\r\n\t\t\t\t\tlet targetPath = pathMapping[responseKey];\r\n\t\t\t\t\tlet data = syncData[responseKey];\r\n\r\n\t\t\t\t\t// Navigate to target and sync\r\n\t\t\t\t\tlet pathParts = targetPath.split('.');\r\n\t\t\t\t\tlet target = obj;\r\n\t\t\t\t\tfor (let i = 0; i < pathParts.length - 1; i++) {\r\n\t\t\t\t\t\tif (!target[pathParts[i]]) {\r\n\t\t\t\t\t\t\ttarget[pathParts[i]] = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttarget = target[pathParts[i]];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet finalKey = pathParts[pathParts.length - 1];\r\n\t\t\t\t\tif (typeof data === 'object' && !Array.isArray(data)) {\r\n\t\t\t\t\t\tif (!target[finalKey]) {\r\n\t\t\t\t\t\t\ttarget[finalKey] = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsyncObject(target[finalKey], data, true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttarget[finalKey] = data;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Standard path mappings for common Olio sync scenarios\r\n\t */\r\n\tvar SYNC_MAPPINGS = {\r\n\t\t// For situation/move responses\r\n\t\tsituation: {\r\n\t\t\t\"stateSnapshot\": \"state\",\r\n\t\t\t\"location\": \"state.currentLocation\"\r\n\t\t},\r\n\t\t// For full character sync\r\n\t\tfull: {\r\n\t\t\t\"state\": \"state\",\r\n\t\t\t\"statistics\": \"statistics\",\r\n\t\t\t\"instinct\": \"instinct\",\r\n\t\t\t\"store\": \"store\",\r\n\t\t\t\"profile\": \"profile\"\r\n\t\t},\r\n\t\t// For combat-related sync\r\n\t\tcombat: {\r\n\t\t\t\"stateSnapshot\": \"state\",\r\n\t\t\t\"statistics\": \"statistics\"\r\n\t\t},\r\n\t\t// For apparel/store sync\r\n\t\tapparel: {\r\n\t\t\t\"store\": \"store\",\r\n\t\t\t\"apparel\": \"store.apparel\"\r\n\t\t}\r\n\t};\r\n\r\n\tfunction getUserPersonObject(sId,fH){\r\n\t\treturn new Promise((res, rej) => {\r\n\t\t\tif(!sId){\r\n\t\t\t\tgetPrincipal().then((o)=>{\r\n\t\t\t\t\tvar o = getPrincipal();\r\n\t\t\t\t\tif(o) sId = o.objectId;\r\n\t\t\t\t\tget(sPrincipal + \"/person\" + (sId ? \"/\" + sId : \"\")).then((x)=>{\r\n\t\t\t\t\t\tif(fH) fH(\"\",x);\r\n\t\t\t\t\t\tres(x);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse get(sPrincipal + \"/person\" + (sId ? \"/\" + sId : \"\"),fH).then((x)=>{\r\n\t\t\t\tif(fH) fH(\"\",x);\r\n\t\t\t\tres(x);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction getUserObject(sType,sOType,fH){\r\n\t\tif(!sType && !sOType) return getPrincipal(fH);\r\n\t\treturn get(sModelSvc + \"/\" + sType + \"/user/\" + sOType,fH);\r\n\t}\r\n\r\n\tfunction listUserRoles(sObjId, fH){\r\n\t\tif(!sObjId) sObjId = null;\r\n\t\tconsole.error(\"REFACTOR: listUserRoles\");\r\n\t\t// return Hemi.xml.getJSON(sAuthZ + \"/USER/roles/\" + sObjId,fH,(fH ? 1 : 0));\r\n\t}\r\n\r\n\tfunction listEntitlementsForType(sType, sObjId, fH){\r\n\t\tif(!sObjId) sObjId = null;\r\n\t\tconsole.error(\"REFACTOR: listEntitlementsForType\");\r\n\t\t// return Hemi.xml.getJSON(sAuthZ + \"/\" + sType + \"/entitlements/\" + sObjId,fH,(fH ? 1 : 0));\r\n\t}\r\n\r\n\r\n\tfunction mediaDataPath(oObj, bThumb){\r\n\t\treturn g_application_path + \"/\" + (bThumb ? \"thumbnail\" : \"media\") + \"/\" + am7client.dotPath(o.organizationPath) + \"/data.data\" + o.groupPath + \"/\" + o.name + (bThumb ? \"/100x100\" : \"\");\r\n\t}\r\n\t\r\n\tfunction getIsRequestable(sType,sId,fH){\r\n\t\tif(!sType || !sId) return 0;\r\n\t\tconsole.error(\"REFACTOR: getIsRequestable\");\r\n\t\t// return Hemi.xml.getJSON(sAppr + \"/requestable/\" + sType + \"/\" + sId,fH,(fH ? 1 : 0));\r\n\t}\r\n\t\r\n\tfunction getOwnerApprovalPolicy(fH){\r\n\t\tconsole.error(\"REFACTOR: getOwnerApprovalPolicy\");\r\n\t\t// return Hemi.xml.getJSON(sAppr + \"/policy/owner\",fH,(fH ? 1 : 0));\r\n\t}\r\n\t\r\n\tfunction attachPolicy(sType,sId,sPid,fH){\r\n\t\tif(!sType || !sId || !sPid) return 0;\r\n\t\tconsole.error(\"REFACTOR: attachPolicy\");\r\n\t\t// return Hemi.xml.getJSON(sAppr + \"/policy/attach/\" + sType + \"/\" + sId + \"/\" + sPid,fH,(fH ? 1 : 0));\r\n\t}\r\n\r\n\twindow.am7client = {\r\n\t\texecuteScript : executeScript,\r\n\t\texecuteScriptById : executeScriptById,\r\n\t\tdotPath : getDotPath,\r\n\t\tdefine : define,\r\n\t\tmember,\r\n\t\tevaluate : evaluate,\r\n\t\tfind : find,\r\n\t\townerApprovalPolicy : getOwnerApprovalPolicy,\r\n\t\tisRequestable : getIsRequestable,\r\n\t\tattachPolicy : attachPolicy,\r\n\t\tfindByTag : findByTag,\r\n\t\tfindByAnyTag : findByAnyTag,\r\n\t\tfindBy : findBy,\r\n\t\tsearch : search,\r\n\t\t// query : query,\r\n\t\tnewQuery : newQuery,\r\n\t\tsearchCount : searchCount,\r\n\t\tcountByTag : countByTag,\r\n\t\tcountByAnyTag : countByAnyTag,\r\n\t\tfindTags : findTags,\r\n\t\tmake : make,\r\n\t\tmediaDataPath : mediaDataPath,\r\n\t\t/*\r\n\t\tlistInParent : listInParent,\r\n\t\tcountInParent : countInParent,\r\n\t\t*/\r\n\t\tlist : list,\r\n\t\tcount: count,\r\n\t\tstream: stream,\r\n\t\tget : getByObjectId,\r\n\t\tgetFull: getFullByObjectId,\r\n\t\tgetByUrn: getByUrn,\r\n\t\tgetByName : getByName,\r\n\t\tgetByNameInGroupParent : getByNameInGroupParent,\r\n\t\tpatch: patchObject,\r\n\t\tcreate,\r\n\t\tupdateBulk : updateBulk,\r\n\t\tdelete : deleteObject,\r\n\t\tcache : getCache,\r\n\t\tgetCache: getFromCache,\r\n\t\tprincipal : getPrincipal,\r\n\t\tentitlements : listEntitlementsForType,\r\n\t\tuserRoles : listUserRoles,\r\n\t\tauthorization : getObjectAuthorization,\r\n\t\tpermit : permit,\r\n\t\tpermitSystem : permitSystem,\r\n\t\tmembers : listMembers,\r\n\t\tcountMembers,\r\n\t\tmembershipStats,\r\n\t\tsystemRoles : listSystemRoles,\r\n\t\tsystemPolicies : listSystemPolicies,\r\n\t\tsystemPermissions : listSystemPermissions,\r\n\t\tuser: getUserObject,\r\n\t\tapplication : getApplicationProfile,\r\n\t\tuserPerson : getUserPersonObject,\r\n\t\tnewPrimaryCredential : newPrimaryCredential,\r\n\t\tclearCache,\r\n\t\tcleanup,\r\n\t\ttrace,\r\n\t\tclearAuthorizationCache : function(fH){\r\n\t\t\treturn get(sCache + \"/clearAuthorization\",fH);\r\n\t\t},\r\n\t\tpatchAttribute: async function(o, n, v){\r\n\t\t\tlet a = am7client.getAttribute(o, n);\r\n\t\t\tif(!a){\r\n\t\t\t\ta = am7client.addAttribute(o, n, v);\r\n\t\t\t\tawait create(a[am7model.jsonModelKey], a);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\ta[am7model.jsonModelKey] = \"common.attribute\";\r\n\t\t\t\ta.value = v;\r\n\t\t\t\tawait patchObject(a[am7model.jsonModelKey], a);\r\n\t\t\t}\r\n\t\t\treturn a;\t\t\t\r\n\t\t},\r\n\t\tgetAttribute : function(o,n){\r\n\t\t\tif(!o || o == null || !o.attributes){\r\n                return null;\r\n            }\r\n            let r = o.attributes.filter(a => {if(a.name === n) return a;});\r\n            return (r ? r[0] : null);\r\n\t\t},\r\n\t\tgetAttributeValue : function(o,n,d){\r\n\t\t\tvar a = am7client.getAttribute(o,n);\r\n\t\t\tif(!a) return d;\r\n\t\t\treturn a.value;\r\n\t\t},\r\n\t\taddAttribute : function(o,s,v){\r\n\t\t\tif(!o.attributes) o.attributes = [];\r\n\t\t\tlet a = am7client.newAttribute(s,v);\r\n\t\t\ta.referenceModel = o[am7model.jsonModelKey];\r\n\t\t\ta.referenceId = o.id || 0;\r\n\t\t\to.attributes.push(a);\r\n\t\t\treturn a;\r\n\t\t},\r\n\t\tnewAttribute : function(s, v){\r\n\t\t\tvar a = am7model.newPrimitive(\"common.attribute\"),x=null;\r\n\t\t\ta.valueType = \"string\";\r\n\t\t\ta.name = s;\r\n\t\t\t\r\n\t\t\tif(typeof v == \"string\") x = v;\r\n\t\t\telse if(typeof v == \"number\"){\r\n\t\t\t\tlet vs = \"\" + v;\r\n\t\t\t\tif(vs.match(/\\./)) a.valueType = 'double';\r\n\t\t\t\telse a.valueType = 'int';\r\n\t\t\t\tx = v;\r\n\t\t\t}\r\n\t\t\telse if(typeof v == \"object\" && v instanceof Array) x = v;\r\n\t\t\telse console.warn(\"Expected string or array object for value\");\r\n\t\t\ta.value = x;\r\n\t\t\treturn a;\r\n\t\t},\r\n\t\tremoveAttribute : function(o, n){\r\n\t\t\tif(!o.attributes || o.attributes == null) return 0;\r\n\t\t\tfor(var i = 0; i < o.attributes.length; i++){\r\n\t\t\t\tif(o.attributes[i].name == n){\r\n\t\t\t\t\to.attributes.splice(i,1);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tlogin : login,\r\n\t\tloginWithPassword : loginWithPassword,\r\n\t\tlogout : logout,\r\n\t\tbase:function(){\r\n\t\t\treturn sBase;\r\n\t\t},\r\n\t\tgetImageTags,\r\n\t\tapplyImageTags,\r\n\t\tpersonalityProfile,\r\n\t\tprofileComparison,\r\n\t\t// State synchronization helpers\r\n\t\tapplyPatches,\r\n\t\trefreshNested,\r\n\t\tsyncObject,\r\n\t\tsyncFromResponse,\r\n\t\tSYNC_MAPPINGS\r\n\t};\r\n\r\n\t\r\n}());\r\n\r\n\n\n;/* === common/base64.js === */\n(function(){\r\n/**\r\n*\r\n*  Base64 encode / decode\r\n*  http://www.webtoolkit.info/\r\n*\r\n**/\r\n\r\n    var Base64 = {\r\n    \r\n        // private property\r\n        _keyStr : \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\r\n    \r\n        // public method for encoding\r\n        encode : function (input) {\r\n            var output = \"\";\r\n            var chr1, chr2, chr3, enc1, enc2, enc3, enc4;\r\n            var i = 0;\r\n    \r\n            //input = Base64._utf8_encode(input);\r\n    \r\n            while (i < input.length) {\r\n    \r\n                chr1 = input.charCodeAt(i++);\r\n                chr2 = input.charCodeAt(i++);\r\n                chr3 = input.charCodeAt(i++);\r\n    \r\n                enc1 = chr1 >> 2;\r\n                enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\r\n                enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\r\n                enc4 = chr3 & 63;\r\n    \r\n                if (isNaN(chr2)) {\r\n                    enc3 = enc4 = 64;\r\n                } else if (isNaN(chr3)) {\r\n                    enc4 = 64;\r\n                }\r\n    \r\n                output = output +\r\n                this._keyStr.charAt(enc1) + this._keyStr.charAt(enc2) +\r\n                this._keyStr.charAt(enc3) + this._keyStr.charAt(enc4);\r\n    \r\n            }\r\n    \r\n            return output;\r\n        },\r\n    \r\n        // public method for decoding\r\n        decode : function (input) {\r\n            var output = \"\";\r\n            var chr1, chr2, chr3;\r\n            var enc1, enc2, enc3, enc4;\r\n            var i = 0;\r\n    \r\n            input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\r\n    \r\n            while (i < input.length) {\r\n    \r\n                enc1 = this._keyStr.indexOf(input.charAt(i++));\r\n                enc2 = this._keyStr.indexOf(input.charAt(i++));\r\n                enc3 = this._keyStr.indexOf(input.charAt(i++));\r\n                enc4 = this._keyStr.indexOf(input.charAt(i++));\r\n    \r\n                chr1 = (enc1 << 2) | (enc2 >> 4);\r\n                chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\r\n                chr3 = ((enc3 & 3) << 6) | enc4;\r\n    \r\n                output = output + String.fromCharCode(chr1);\r\n    \r\n                if (enc3 != 64) {\r\n                    output = output + String.fromCharCode(chr2);\r\n                }\r\n                if (enc4 != 64) {\r\n                    output = output + String.fromCharCode(chr3);\r\n                }\r\n    \r\n            }\r\n    \r\n            //output = Base64._utf8_decode(output);\r\n    \r\n            return output;\r\n    \r\n        },\r\n    \r\n        // private method for UTF-8 encoding\r\n        _utf8_encode : function (string) {\r\n            string = string.replace(/\\r\\n/g,\"\\n\");\r\n            var utftext = \"\";\r\n    \r\n            for (var n = 0; n < string.length; n++) {\r\n    \r\n                var c = string.charCodeAt(n);\r\n    \r\n                if (c < 128) {\r\n                    utftext += String.fromCharCode(c);\r\n                }\r\n                else if((c > 127) && (c < 2048)) {\r\n                    utftext += String.fromCharCode((c >> 6) | 192);\r\n                    utftext += String.fromCharCode((c & 63) | 128);\r\n                }\r\n                else {\r\n                    utftext += String.fromCharCode((c >> 12) | 224);\r\n                    utftext += String.fromCharCode(((c >> 6) & 63) | 128);\r\n                    utftext += String.fromCharCode((c & 63) | 128);\r\n                }\r\n    \r\n            }\r\n    \r\n            return utftext;\r\n        },\r\n    \r\n        // private method for UTF-8 decoding\r\n        _utf8_decode : function (utftext) {\r\n            var string = \"\";\r\n            var i = 0;\r\n            var c = c1 = c2 = 0;\r\n    \r\n            while ( i < utftext.length ) {\r\n    \r\n                c = utftext.charCodeAt(i);\r\n    \r\n                if (c < 128) {\r\n                    string += String.fromCharCode(c);\r\n                    i++;\r\n                }\r\n                else if((c > 191) && (c < 224)) {\r\n                    c2 = utftext.charCodeAt(i+1);\r\n                    string += String.fromCharCode(((c & 31) << 6) | (c2 & 63));\r\n                    i += 2;\r\n                }\r\n                else {\r\n                    c2 = utftext.charCodeAt(i+1);\r\n                    c3 = utftext.charCodeAt(i+2);\r\n                    string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63));\r\n                    i += 3;\r\n                }\r\n    \r\n            }\r\n    \r\n            return string;\r\n        }\r\n    \r\n    };\r\n    if(typeof module == \"undefined\"){\r\n        window.Base64 = Base64;\r\n    }\r\n    else{\r\n        module.exports = Base64;\r\n    }\r\n}());\n\n;/* === model/modelDef.js === */\n(function () {\r\n  /// Generated by http://localhost:8080/AccountManagerService7/rest/schema\r\n\r\n  let am7model = {\r\n  \"jsonModelKey\": \"schema\",\r\n  \"categories\": [\r\n    {\r\n      \"schema\": \"system.modelCategory\",\r\n      \"name\": \"identity\",\r\n      \"label\": \"Identity\",\r\n      \"icon\": \"account_tree\",\r\n      \"order\": [\r\n        \"system.user\",\r\n        \"identity.person\",\r\n        \"identity.account\",\r\n        \"auth.role\",\r\n        \"auth.permission\",\r\n        \"identity.contact\",\r\n        \"identity.address\"\r\n      ],\r\n      \"prototypes\": [\r\n        {\r\n          \"schema\": \"system.modelCategory\",\r\n          \"name\": \"application\",\r\n          \"pathName\": \"Applications\",\r\n          \"prototype\": true,\r\n          \"type\": \"group\",\r\n          \"limit\": [\r\n            \"data.data\",\r\n            \"auth.group\",\r\n            \"auth.permission\",\r\n            \"identity.account\"\r\n          ],\r\n          \"icon\": \"web_asset\",\r\n          \"order\": [\r\n            \"identity.account\",\r\n            \"auth.group\",\r\n            \"auth.permission\",\r\n            \"data.data\"\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"schema\": \"system.modelCategory\",\r\n      \"label\": \"Assets\",\r\n      \"name\": \"asset\",\r\n      \"order\": [\r\n        \"identity.application\",\r\n        \"gallery\",\r\n        \"article\",\r\n        \"data.data\",\r\n        \"data.note\",\r\n        \"auth.group\",\r\n        \"data.tag\"\r\n      ],\r\n      \"icon\": \"emoji_objects\",\r\n      \"prototypes\": [\r\n        {\r\n          \"schema\": \"system.modelCategory\",\r\n          \"name\": \"gallery\",\r\n          \"prototype\": true,\r\n          \"group\": \"Gallery\",\r\n          \"label\": \"Gallery\",\r\n          \"limit\": [\r\n            \"data.data\",\r\n            \"auth.group\"\r\n          ],\r\n          \"type\": \"group\",\r\n          \"icon\": \"collections\",\r\n          \"order\": [\r\n            \"auth.group\",\r\n            \"data.data\"\r\n          ]\r\n        },\r\n        {\r\n          \"schema\": \"system.modelCategory\",\r\n          \"name\": \"article\",\r\n          \"prototype\": true,\r\n          \"group\": \"Articles\",\r\n          \"limit\": [\r\n            \"data.data\",\r\n            \"auth.group\"\r\n          ],\r\n          \"type\": \"auth.group\",\r\n          \"icon\": \"article\",\r\n          \"label\": \"Articles\",\r\n          \"order\": [\r\n            \"auth.group\",\r\n            \"data.data\"\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"schema\": \"system.modelCategory\",\r\n      \"name\": \"process\",\r\n      \"label\": \"Process\",\r\n      \"order\": [\r\n        \"access.accessRequest\",\r\n        \"methodology\",\r\n        \"process\",\r\n        \"processstep\"\r\n      ],\r\n      \"icon\": \"insights\"\r\n    },\r\n     {\r\n        \"schema\": \"system.modelCategory\",\r\n        \"name\": \"event\",\r\n        \"label\": \"Event\",\r\n        \"order\": [\r\n          /*\r\n          \"message.spool\",\r\n          \"data.geoLocation\",\r\n          \"olio.event\",\r\n          \"data.trait\"\r\n          */\r\n          \"olio.charPerson\",\r\n          \"identity.voice\",\r\n          \"olio.llm.chatConfig\",\r\n          \"olio.llm.promptConfig\",\r\n          \"olio.llm.openai.openaiRequest\",\r\n          \"olio.apparel\",\r\n          \"olio.wearable\",\r\n          \"olio.item\"\r\n        ],\r\n        \"icon\": \"event_note\"\r\n      },\r\n    {\r\n      \"schema\": \"system.modelCategory\",\r\n      \"name\": \"policy\",\r\n      \"label\": \"Policy\",\r\n      \"order\": [\r\n        \"policy.policy\",\r\n        \"policy.rule\",\r\n        \"policy.pattern\",\r\n        \"policy.fact\",\r\n        \"policy.operation\",\r\n        \"policy.function\"\r\n      ],\r\n      \"icon\": \"policy\"\r\n    },\r\n    {\r\n      \"schema\": \"system.modelCategory\",\r\n      \"name\": \"form\",\r\n      \"label\": \"Forms\",\r\n      \"order\": [\r\n        \"form\",\r\n        \"formelement\",\r\n        \"policy.validationrule\"\r\n      ],\r\n      \"icon\": \"dynamic_form\"\r\n    }\r\n  ],\r\n  \"enums\": {\r\n    \"fieldEnumType\": [\r\n      \"BLOB\",\r\n      \"BOOLEAN\",\r\n      \"BYTE\",\r\n      \"CALENDAR\",\r\n      \"DOUBLE\",\r\n      \"ENUM\",\r\n      \"FLEX\",\r\n      \"INT\",\r\n      \"LIST\",\r\n      \"LONG\",\r\n      \"MODEL\",\r\n      \"STRING\",\r\n      \"TIMESTAMP\",\r\n      \"ZONETIME\",\r\n      \"VECTOR\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"systemPermissionEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"CREATE\",\r\n      \"READ\",\r\n      \"UPDATE\",\r\n      \"DELETE\",\r\n      \"EXECUTE\"\r\n    ],\r\n    \"accountEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"GUEST\",\r\n      \"SYSTEM\",\r\n      \"NORMAL\",\r\n      \"DEVELOPMENT\"\r\n    ],\r\n    \"accountStatusEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"UNREGISTERED\",\r\n      \"NORMAL\",\r\n      \"RESTRICTED\",\r\n      \"REGISTERED\",\r\n      \"DISABLED\"\r\n    ],\r\n    \"actionEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ADD\",\r\n      \"EXECUTE\",\r\n      \"DELETE\",\r\n      \"MODIFY\",\r\n      \"PATCH\",\r\n      \"READ\",\r\n      \"REQUEST\",\r\n      \"RESPONSE\",\r\n      \"GRANT\",\r\n      \"DENY\",\r\n      \"REJECT\",\r\n      \"APPROVE\",\r\n      \"AUTHENTICATE\",\r\n      \"AUTHORIZE\",\r\n      \"CLOSE\",\r\n      \"OPEN\",\r\n      \"REOPEN\",\r\n      \"VECTORIZE\"\r\n    ],\r\n    \"approvalEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"PRIVILEGED_ACCESS\",\r\n      \"APPLICATION\",\r\n      \"ACCESS\",\r\n      \"FEDERAL\",\r\n      \"OWNER\"\r\n    ],\r\n    \"approvalResponseEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"APPROVE\",\r\n      \"DENY\",\r\n      \"REMOVE\",\r\n      \"CERTIFIED\",\r\n      \"PENDING\",\r\n      \"DUPLICATE\",\r\n      \"REQUEST\"\r\n    ],\r\n    \"approverEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"GROUP\",\r\n      \"PERSON\",\r\n      \"APPLICATION\",\r\n      \"PERMISSION\",\r\n      \"ACCOUNT\",\r\n      \"USER\",\r\n      \"ROLE\"\r\n    ],\r\n    \"authenticationResponseEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"AUTHENTICATED\",\r\n      \"NOT_AUTHENTICATED\",\r\n      \"STEP_UP_REQUIRED\"\r\n    ],\r\n    \"comparatorEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ANY\",\r\n      \"NOT_ANY\",\r\n      \"EQUALS\",\r\n      \"NOT_EQUALS\",\r\n      \"BETWEEN\",\r\n      \"LESS_THAN\",\r\n      \"LESS_THAN_OR_EQUALS\",\r\n      \"GREATER_THAN\",\r\n      \"GREATER_THAN_OR_EQUALS\",\r\n      \"NOT_IN\",\r\n      \"IN\",\r\n      \"NOT_NULL\",\r\n      \"IS_NULL\",\r\n      \"IS_NULL_EQUALS\",\r\n      \"IS_NULL_NOT_EQUALS\",\r\n      \"LIKE\",\r\n      \"ILIKE\",\r\n      \"GROUP_AND\",\r\n      \"GROUP_OR\"\r\n    ],\r\n    \"compressionEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"NONE\",\r\n      \"GZIP\"\r\n    ],\r\n    \"conditionEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ALL\",\r\n      \"ANY\",\r\n      \"NONE\",\r\n      \"LESS_THAN\",\r\n      \"LESS_THAN_OR_EQUALS\",\r\n      \"GREATER_THAN\",\r\n      \"GREATER_THAN_OR_EQUALS\"\r\n    ],\r\n    \"connectionEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"POSTGRE\",\r\n      \"H2\"\r\n    ],\r\n    \"contactEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"PHONE\",\r\n      \"EMAIL\",\r\n      \"WEB\",\r\n      \"OTHER\",\r\n      \"PROFILE\"\r\n    ],\r\n    \"contactInformationEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"INDIVIDUAL\",\r\n      \"GROUP\",\r\n      \"ORGANIZATION\",\r\n      \"COMPANY\",\r\n      \"ACCOUNT\",\r\n      \"USER\",\r\n      \"PERSON\"\r\n    ],\r\n    \"controlActionEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ACCESS\",\r\n      \"READ\",\r\n      \"WRITE\",\r\n      \"DELETE\",\r\n      \"UPDATE\",\r\n      \"EXECUTE\",\r\n      \"ANY\"\r\n    ],\r\n    \"controlEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"POLICY\"\r\n    ],\r\n    \"credentialEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"LEGACY_PASSWORD\",\r\n      \"HASHED_PASSWORD\",\r\n      \"SALT\",\r\n      \"ENCRYPTED_PASSWORD\",\r\n      \"ENCRYPTED_IDENTITY\",\r\n      \"TOKEN\",\r\n      \"CERTIFICATE\",\r\n      \"SIGNATURE\",\r\n      \"SESSION\",\r\n      \"KEY\",\r\n      \"KNOWLEDGE\"\r\n    ],\r\n    \"effectEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"GRANT_PERMISSION\",\r\n      \"DENY_PERMISSION\",\r\n      \"AGGREGATE\"\r\n    ],\r\n    \"factEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"GROUP\",\r\n      \"ROLE\",\r\n      \"PERMISSION\",\r\n      \"PROPERTY\",\r\n      \"ATTRIBUTE\",\r\n      \"STATIC\",\r\n      \"FACTORY\",\r\n      \"REST\",\r\n      \"FUNCTION\",\r\n      \"SUBJECT\",\r\n      \"CONTEXT\",\r\n      \"PARAMETER\",\r\n      \"OPERATION\"\r\n    ],\r\n    \"functionEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"JAVASCRIPT\",\r\n      \"JAVA\",\r\n      \"REST\"\r\n    ],\r\n    \"groupEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ACCOUNT\",\r\n      \"DATA\",\r\n      \"BUCKET\",\r\n      \"USER\",\r\n      \"PERSON\"\r\n    ],\r\n    \"levelEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"LOW\",\r\n      \"MODERATE\",\r\n      \"CONSIDERABLE\",\r\n      \"HIGH\",\r\n      \"SEVERE\",\r\n      \"EXTREME\",\r\n      \"GRAVE\"\r\n    ],\r\n    \"locationEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"HOME\",\r\n      \"WORK\",\r\n      \"MOBILE\",\r\n      \"OTHER\",\r\n      \"NETWORK\"\r\n    ],\r\n    \"operationEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"NAMED\",\r\n      \"PERMISSION\",\r\n      \"FUNCTION\",\r\n      \"INTERNAL\"\r\n    ],\r\n    \"operationResponseEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"SUCCEEDED\",\r\n      \"FAILED\",\r\n      \"ERROR\"\r\n    ],\r\n    \"orderEnumType\": [\r\n      \"ASCENDING\",\r\n      \"DESCENDING\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"organizationEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ROOT\",\r\n      \"SYSTEM\",\r\n      \"PUBLIC\",\r\n      \"DEVELOPMENT\"\r\n    ],\r\n    \"patternEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"PARAMETER\",\r\n      \"FUNCTION\",\r\n      \"OPERATION\",\r\n      \"EXPRESSION\",\r\n      \"AUTHORIZATION\",\r\n      \"SEPARATION_OF_DUTY\",\r\n      \"VERIFICATION\",\r\n      \"APPROVAL\"\r\n    ],\r\n    \"permissionEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"DATA\",\r\n      \"GROUP\",\r\n      \"ROLE\",\r\n      \"PERMISSION\",\r\n      \"ACCOUNT\",\r\n      \"USER\",\r\n      \"PERSON\",\r\n      \"OBJECT\",\r\n      \"APPLICATION\"\r\n    ],\r\n    \"policyRequestEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"AUTHENTICATE\",\r\n      \"DECIDE\",\r\n      \"DEFINE\",\r\n      \"SCORE\"\r\n    ],\r\n    \"policyResponseEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"AUTHENTICATED\",\r\n      \"PERMIT\",\r\n      \"DENY\",\r\n      \"PENDING\",\r\n      \"PENDING_OPERATION\",\r\n      \"INVALID_ARGUMENT\",\r\n      \"ERROR\",\r\n      \"BANNED\",\r\n      \"DISABLED\"\r\n    ],\r\n    \"queryEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"CREATEDDATE\",\r\n      \"MODIFIEDDATE\",\r\n      \"NAME\",\r\n      \"ID\"\r\n    ],\r\n    \"responseEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"PERMIT\",\r\n      \"VALID\",\r\n      \"INVALID\",\r\n      \"DENY\",\r\n      \"INFO\",\r\n      \"PENDING\"\r\n    ],\r\n    \"roleEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ACCOUNT\",\r\n      \"USER\",\r\n      \"PERSON\"\r\n    ],\r\n    \"ruleEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"PERMIT\",\r\n      \"DENY\"\r\n    ],\r\n    \"spoolBucketEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"RAW\",\r\n      \"MESSAGE_QUEUE\",\r\n      \"SECURITY_TOKEN\",\r\n      \"REQUEST\",\r\n      \"APPROVAL\"\r\n    ],\r\n    \"spoolNameEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"GENERAL\",\r\n      \"AUTHORIZATION\",\r\n      \"STATE\",\r\n      \"MESSAGE\",\r\n      \"QUEUE\",\r\n      \"DATA\",\r\n      \"REQUEST\",\r\n      \"ACCESS\"\r\n    ],\r\n    \"spoolStatusEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ERROR\",\r\n      \"QUEUEING\",\r\n      \"QUEUED\",\r\n      \"TRANSMITTING\",\r\n      \"TRANSMITTED\",\r\n      \"SPOOLING\",\r\n      \"SPOOLED\",\r\n      \"ACKNOWLEGED_RECEIPT\",\r\n      \"RESPONDED\",\r\n      \"PERSISTED\",\r\n      \"REJECTED\",\r\n      \"DELETED\"\r\n    ],\r\n    \"sqlDataEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ARRAY\",\r\n      \"BIGINT\",\r\n      \"BINARY\",\r\n      \"BIT\",\r\n      \"BLOB\",\r\n      \"BOOLEAN\",\r\n      \"CHAR\",\r\n      \"CLOB\",\r\n      \"DATALINK\",\r\n      \"DATE\",\r\n      \"DECIMAL\",\r\n      \"DISTINCT\",\r\n      \"DOUBLE\",\r\n      \"FLOAT\",\r\n      \"INTEGER\",\r\n      \"JAVA_OBJECT\",\r\n      \"LONGVARBINARY\",\r\n      \"LONGVARCHAR\",\r\n      \"NULL\",\r\n      \"NUMERIC\",\r\n      \"OTHER\",\r\n      \"REAL\",\r\n      \"REF\",\r\n      \"SMALLINT\",\r\n      \"STRUCT\",\r\n      \"TIME\",\r\n      \"TIMESTAMP\",\r\n      \"TINYINT\",\r\n      \"VARBINARY\",\r\n      \"VARCHAR\",\r\n      \"VECTOR\",\r\n      \"TEXT\"\r\n    ],\r\n    \"statisticsEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"USER\",\r\n      \"DATA\",\r\n      \"ACCOUNT\"\r\n    ],\r\n    \"streamEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"FILE\",\r\n      \"NETWORK\"\r\n    ],\r\n    \"tagEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ACCOUNT\",\r\n      \"DATA\",\r\n      \"USER\",\r\n      \"PERSON\",\r\n      \"GROUP\"\r\n    ],\r\n    \"userEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"GUEST\",\r\n      \"SYSTEM\",\r\n      \"NORMAL\",\r\n      \"DEVELOPMENT\"\r\n    ],\r\n    \"userStatusEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"UNREGISTERED\",\r\n      \"NORMAL\",\r\n      \"RESTRICTED\",\r\n      \"REGISTERED\",\r\n      \"DISABLED\"\r\n    ],\r\n    \"validationEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"BOOLEAN\",\r\n      \"FUNCTION\",\r\n      \"REPLACEMENT\",\r\n      \"NONE\"\r\n    ],\r\n    \"valueEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"STRING\",\r\n      \"INT\",\r\n      \"LONG\",\r\n      \"BOOLEAN\",\r\n      \"DATETIME\",\r\n      \"BYTE_ARRAY\"\r\n    ],\r\n    \"verificationEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"DEFAULT\",\r\n      \"VERIFIED\",\r\n      \"NOT_VERIFIED\",\r\n      \"ERROR\"\r\n    ],\r\n    \"alignmentEnumType\": [\r\n      \"CHAOTICEVIL\",\r\n      \"NEUTRALEVIL\",\r\n      \"LAWFULEVIL\",\r\n      \"CHAOTICNEUTRAL\",\r\n      \"NEUTRAL\",\r\n      \"UNKNOWN\",\r\n      \"LAWFULNEUTRAL\",\r\n      \"CHAOTICGOOD\",\r\n      \"NEUTRALGOOD\",\r\n      \"LAWFULGOOD\"\r\n    ],\r\n    \"assessedEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"LOCATION\",\r\n      \"GROUP\",\r\n      \"INDIVIDUAL\",\r\n      \"ENCOUNTER\"\r\n    ],\r\n    \"assessmentEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"PHYSIOLOGICAL\",\r\n      \"SAFETY\",\r\n      \"LOVE\",\r\n      \"ESTEEM\",\r\n      \"SELF\",\r\n      \"REPLENISH\",\r\n      \"PREDICTION\",\r\n      \"PREDILECTION\",\r\n      \"CURIOSITY\"\r\n    ],\r\n    \"characterRoleEnumType\": [\r\n      \"ACQUAINTENCE\",\r\n      \"ANTAGONIST\",\r\n      \"ANTIHERO\",\r\n      \"CONFIDANT\",\r\n      \"CONTAGONIST\",\r\n      \"DEUTERAGONIST\",\r\n      \"ENEMY_INTEREST\",\r\n      \"FOIL\",\r\n      \"GUIDE\",\r\n      \"HENCHMAN\",\r\n      \"INDETERMINATE\",\r\n      \"LOVE_INTEREST\",\r\n      \"STRANGER\",\r\n      \"FRIEND_INTEREST\",\r\n      \"COMPANION\",\r\n      \"PROTAGONIST\",\r\n      \"TEMPTRESS\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"densityEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"ROADHOUSE\",\r\n      \"HOMESTEAD\",\r\n      \"BAND\",\r\n      \"HAMLET\",\r\n      \"TRIBE\",\r\n      \"VILLAGE\",\r\n      \"RESIDENTIAL_TOWN\",\r\n      \"TOWN\",\r\n      \"CITY\",\r\n      \"METROPOLIS\",\r\n      \"ECUMENOPOLIS\"\r\n    ],\r\n    \"directionEnumType\": [\r\n      \"NORTH\",\r\n      \"NORTHEAST\",\r\n      \"EAST\",\r\n      \"SOUTHEAST\",\r\n      \"SOUTH\",\r\n      \"SOUTHWEST\",\r\n      \"WEST\",\r\n      \"NORTHWEST\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"esteemNeedsEnumType\": [\r\n      \"RESPECT\",\r\n      \"SELF_ESTEEM\",\r\n      \"STATUS\",\r\n      \"RECOGNITION\",\r\n      \"STRENGTH\",\r\n      \"FREEDOM\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"ethnicityEnumType\": [\r\n      \"A\",\r\n      \"B\",\r\n      \"D\",\r\n      \"E\",\r\n      \"F\",\r\n      \"G\",\r\n      \"H\",\r\n      \"J\",\r\n      \"K\",\r\n      \"L\",\r\n      \"P\",\r\n      \"Q\",\r\n      \"S\",\r\n      \"T\",\r\n      \"V\",\r\n      \"W\",\r\n      \"ZERO\",\r\n      \"ONE\",\r\n      \"TWO\",\r\n      \"THREE\",\r\n      \"FOUR\",\r\n      \"FIVE\",\r\n      \"SIX\",\r\n      \"SEVEN\",\r\n      \"EIGHT\",\r\n      \"NINE\",\r\n      \"TEN\",\r\n      \"ELEVEN\",\r\n      \"TWELVE\",\r\n      \"THIRTEEN\",\r\n      \"FOURTEEN\"\r\n    ],\r\n    \"highEnumType\": [\r\n      \"DISREGARDED\",\r\n      \"NEVER\",\r\n      \"LOW\",\r\n      \"MINIMAL\",\r\n      \"DIMINISHED\",\r\n      \"INSIGNIFICANT\",\r\n      \"WEAK\",\r\n      \"MODEST\",\r\n      \"MARGINAL\",\r\n      \"AVERAGE\",\r\n      \"MODERATE\",\r\n      \"INTERMEDIATE\",\r\n      \"FAIR\",\r\n      \"ADEQUATE\",\r\n      \"BALANCED\",\r\n      \"ELEVATED\",\r\n      \"SUBSTANTIAL\",\r\n      \"STRONG\",\r\n      \"PROFOUND\",\r\n      \"EXTENSIVE\",\r\n      \"PEAK\",\r\n      \"MAXIMUM\",\r\n      \"HERO\"\r\n    ],\r\n    \"instinctEnumType\": [\r\n      \"DISREGARDED\",\r\n      \"INCONCEIVABLE\",\r\n      \"FATAL\",\r\n      \"VAGUE\",\r\n      \"WEAK\",\r\n      \"IMBALANCED\",\r\n      \"INADEQUATE\",\r\n      \"INSIGNIFICANT\",\r\n      \"DIMINISHED\",\r\n      \"BELOW_AVERAGE\",\r\n      \"MINIMAL\",\r\n      \"LOW\",\r\n      \"STASIS\",\r\n      \"MODEST\",\r\n      \"MARGINAL\",\r\n      \"AVERAGE\",\r\n      \"FAIR\",\r\n      \"ADEQUATE\",\r\n      \"BALANCED\",\r\n      \"ELEVATED\",\r\n      \"STRONG\",\r\n      \"PROFOUND\",\r\n      \"PEAK\",\r\n      \"UNCONTROLLABLE\"\r\n    ],\r\n    \"interactionEnumType\": [\r\n      \"ACCOMMODATE\",\r\n      \"ALLY\",\r\n      \"BARTER\",\r\n      \"BEFRIEND\",\r\n      \"BETRAY\",\r\n      \"BREAK_UP\",\r\n      \"COERCE\",\r\n      \"COMBAT\",\r\n      \"COMMERCE\",\r\n      \"COMMUNICATE\",\r\n      \"COMPETE\",\r\n      \"CONFLICT\",\r\n      \"CONGREGATE\",\r\n      \"COOPERATE\",\r\n      \"CORRESPOND\",\r\n      \"CRITICIZE\",\r\n      \"DATE\",\r\n      \"DEBATE\",\r\n      \"DEFEND\",\r\n      \"ENTERTAIN\",\r\n      \"EXCHANGE\",\r\n      \"EXPRESS_GRATITUDE\",\r\n      \"EXPRESS_INDIFFERENCE\",\r\n      \"HELP\",\r\n      \"INTIMATE\",\r\n      \"INVESTIGATE\",\r\n      \"MENTOR\",\r\n      \"NEGOTIATE\",\r\n      \"NONE\",\r\n      \"OPPOSE\",\r\n      \"PEER_PRESSURE\",\r\n      \"RECREATE\",\r\n      \"RELATE\",\r\n      \"ROMANCE\",\r\n      \"SHUN\",\r\n      \"SEPARATE\",\r\n      \"SOCIALIZE\",\r\n      \"THREATEN\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"loveNeedsEnumType\": [\r\n      \"FRIENDSHIP\",\r\n      \"INTIMACY\",\r\n      \"FAMILY\",\r\n      \"CONNECTION\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"outcomeEnumType\": [\r\n      \"VERY_FAVORABLE\",\r\n      \"FAVORABLE\",\r\n      \"EQUILIBRIUM\",\r\n      \"UNFAVORABLE\",\r\n      \"VERY_UNFAVORABLE\"\r\n    ],\r\n    \"pointOfInterestEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"COMMERCIAL\",\r\n      \"RECREATIONAL\",\r\n      \"LANDMARK\",\r\n      \"ENCAMPMENT\",\r\n      \"LAIR\",\r\n      \"RUIN\",\r\n      \"STASH\",\r\n      \"RESOURCE\",\r\n      \"HARVESTABLE\",\r\n      \"ORE\",\r\n      \"STRUCTURE\"\r\n    ],\r\n    \"raceEnumType\": [\r\n      \"A\",\r\n      \"B\",\r\n      \"C\",\r\n      \"D\",\r\n      \"E\",\r\n      \"L\",\r\n      \"R\",\r\n      \"M\",\r\n      \"S\",\r\n      \"U\",\r\n      \"V\",\r\n      \"W\",\r\n      \"X\",\r\n      \"Y\",\r\n      \"Z\"\r\n    ],\r\n    \"reasonEnumType\": [\r\n      \"AGE\",\r\n      \"ALOOFNESS\",\r\n      \"AMORALITY\",\r\n      \"ATTRACTION\",\r\n      \"ATTRACTIVE_NARCISSISM\",\r\n      \"AVARICE\",\r\n      \"COERCION\",\r\n      \"COMMERCE\",\r\n      \"COMMUNITY\",\r\n      \"COMPANIONSHIP\",\r\n      \"CONFIDENCE\",\r\n      \"COWARDICE\",\r\n      \"EXTRAVERSION\",\r\n      \"FRIENDSHIP\",\r\n      \"GENEROSITY\",\r\n      \"GUARDIANSHIP\",\r\n      \"HOSTILITY\",\r\n      \"IMMATURITY\",\r\n      \"INSTINCT\",\r\n      \"INTIMACY\",\r\n      \"INTIMIDATION\",\r\n      \"INTRAVERSION\",\r\n      \"LESS_ATTRACTIVE\",\r\n      \"MACHIAVELLIANISM\",\r\n      \"MATURITY\",\r\n      \"MORALITY\",\r\n      \"NARCISSISM\",\r\n      \"NONE\",\r\n      \"PEER_PRESSURE\",\r\n      \"POLITICAL\",\r\n      \"PSYCHOPATHY\",\r\n      \"REVENGE\",\r\n      \"REVULSION\",\r\n      \"SADISM\",\r\n      \"SANITY\",\r\n      \"SENILITY\",\r\n      \"SENSUALITY\",\r\n      \"SPIRITUALITY\",\r\n      \"SOCIALIZE\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"rollEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"INVALID_STATISTIC\",\r\n      \"CATASTROPHIC_FAILURE\",\r\n      \"FAILURE\",\r\n      \"SUCCESS\",\r\n      \"NATURAL_SUCCESS\"\r\n    ],\r\n    \"safetyNeedsEnumType\": [\r\n      \"SECURITY\",\r\n      \"EMPLOYMENT\",\r\n      \"RESOURCES\",\r\n      \"HEALTH\",\r\n      \"PROPERTY\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"threatEnumType\": [\r\n      \"ANIMAL_TARGET\",\r\n      \"ANIMAL_THREAT\",\r\n      \"ECONOMIC_TARGET\",\r\n      \"ECONOMIC_THREAT\",\r\n      \"ENVIRONMENTAL_THREAT\",\r\n      \"EXISTENTIAL_THREAT\",\r\n      \"EXISTENTIAL_TARGET\",\r\n      \"HEALTH_TARGET\",\r\n      \"HEALTH_THREAT\",\r\n      \"HOLLOW_THREAT\",\r\n      \"IDEOLOGICAL_TARGET\",\r\n      \"IDEOLOGICAL_THREAT\",\r\n      \"NONE\",\r\n      \"PERSONAL_TARGET\",\r\n      \"PERSONAL_THREAT\",\r\n      \"PHYSICAL_TARGET\",\r\n      \"PHYSICAL_THREAT\",\r\n      \"POLITICAL_TARGET\",\r\n      \"POLITICAL_THREAT\",\r\n      \"PSYCHOLOGICAL_TARGET\",\r\n      \"PSYCHOLOGICAL_THREAT\",\r\n      \"SOCIAL_TARGET\",\r\n      \"SOCIAL_THREAT\",\r\n      \"VERBAL_TARGET\",\r\n      \"VERBAL_THREAT\"\r\n    ],\r\n    \"veryEnumType\": [\r\n      \"DISREGARDED\",\r\n      \"NEVER\",\r\n      \"UNLIKELY\",\r\n      \"SLIGHTLY\",\r\n      \"NOT_USUALLY\",\r\n      \"LESS_FREQUENTLY\",\r\n      \"SOMEWHAT\",\r\n      \"FREQUENTLY\",\r\n      \"USUALLY\",\r\n      \"MOSTLY\",\r\n      \"VERY\",\r\n      \"ALWAYS\",\r\n      \"GUARANTEED\"\r\n    ],\r\n    \"wearLevelEnumType\": [\r\n      \"NONE\",\r\n      \"INTERNAL\",\r\n      \"UNDER\",\r\n      \"ON\",\r\n      \"BASE\",\r\n      \"ACCENT\",\r\n      \"SUIT\",\r\n      \"GARNITURE\",\r\n      \"ACCESSORY\",\r\n      \"OVER\",\r\n      \"OUTER\",\r\n      \"FULL_BODY\",\r\n      \"ENCLOSURE\",\r\n      \"UNKNOWN\"\r\n    ],\r\n    \"eSRBEnumType\": [\r\n      \"E\",\r\n      \"E10\",\r\n      \"T\",\r\n      \"M\",\r\n      \"AO\",\r\n      \"RC\"\r\n    ],\r\n    \"lLMServiceEnumType\": [\r\n      \"UNKNOWN\",\r\n      \"LOCAL\",\r\n      \"OLLAMA\",\r\n      \"OPENAI\"\r\n    ]\r\n  },\r\n  \"models\": [\r\n    {\r\n      \"name\": \"common.name\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"label\": \"Name\",\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"required\": true,\r\n          \"index\": true,\r\n          \"allowNull\": false,\r\n          \"maxLength\": 256,\r\n          \"rules\": [\r\n            \"$notEmpty\"\r\n          ],\r\n          \"shortName\": \"n\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.ownerId\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"ownerId\",\r\n          \"type\": \"long\",\r\n          \"required\": true,\r\n          \"private\": true,\r\n          \"shortName\": \"ow\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.objectId\",\r\n      \"abstract\": true,\r\n      \"hints\": [\r\n        \"objectId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"objectId\",\r\n          \"type\": \"string\",\r\n          \"identity\": true,\r\n          \"readOnly\": true,\r\n          \"maxLength\": 64,\r\n          \"shortName\": \"oi\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.attributeList\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"attributes\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"common.attribute\",\r\n          \"referenced\": true,\r\n          \"followReference\": false,\r\n          \"shortName\": \"al\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.organizationExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"organizationPath\",\r\n          \"type\": \"string\",\r\n          \"virtual\": true,\r\n          \"baseModel\": \"system.organization\",\r\n          \"baseProperty\": \"organizationId\",\r\n          \"provider\": \"org.cote.accountmanager.provider.PathProvider\",\r\n          \"priority\": 1,\r\n          \"shortName\": \"op\"\r\n        },\r\n        {\r\n          \"name\": \"organizationId\",\r\n          \"type\": \"long\",\r\n          \"required\": true,\r\n          \"private\": true,\r\n          \"index\": true,\r\n          \"dynamicPolicy\": false,\r\n          \"shortName\": \"o\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.populate\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"populated\",\r\n          \"type\": \"boolean\",\r\n          \"ephemeral\": true,\r\n          \"shortName\": \"pop\"\r\n        },\r\n        {\r\n          \"name\": \"populatedFields\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true,\r\n          \"private\": true,\r\n          \"shortName\": \"popf\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.primaryKey\",\r\n      \"abstract\": true,\r\n      \"hints\": [\r\n        \"id\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"id\",\r\n          \"label\": \"Id\",\r\n          \"type\": \"long\",\r\n          \"index\": true,\r\n          \"identity\": true,\r\n          \"readOnly\": true,\r\n          \"private\": true,\r\n          \"sequence\": true,\r\n          \"primaryKey\": true,\r\n          \"shortName\": \"i\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.baseLight\",\r\n      \"abstract\": true,\r\n      \"inherits\": [\r\n        \"common.ownerId\",\r\n        \"common.objectId\",\r\n        \"common.attributeList\",\r\n        \"system.organizationExt\",\r\n        \"common.populate\",\r\n        \"system.primaryKey\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.BaseFactory\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"objectId\",\r\n        \"ownerId\",\r\n        \"organizationId\"\r\n      ],\r\n      \"fields\": []\r\n    },\r\n    {\r\n      \"name\": \"common.urn\",\r\n      \"abstract\": true,\r\n      \"hints\": [\r\n        \"urn\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"urn\",\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.UrnProvider\",\r\n          \"priority\": 3,\r\n          \"identity\": true,\r\n          \"maxLength\": 255,\r\n          \"shortName\": \"u\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"dev.debug\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"debug\",\r\n          \"type\": \"boolean\",\r\n          \"ephemeral\": true,\r\n          \"shortName\": \"dbg\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.base\",\r\n      \"abstract\": true,\r\n      \"inherits\": [\r\n        \"common.baseLight\",\r\n        \"common.urn\",\r\n        \"dev.debug\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.BaseFactory\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"urn\",\r\n        \"objectId\",\r\n        \"ownerId\"\r\n      ],\r\n      \"fields\": []\r\n    },\r\n    {\r\n      \"name\": \"policy.controlsExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"controls\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"policy.control\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"shortName\": \"ctls\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.tagsExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"tags\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.tag\",\r\n          \"foreign\": true,\r\n          \"participation\": true,\r\n          \"followReference\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.nameId\",\r\n      \"inherits\": [\r\n        \"common.name\",\r\n        \"common.base\",\r\n        \"policy.controlsExt\",\r\n        \"data.tagsExt\"\r\n      ],\r\n      \"abstract\": true,\r\n      \"query\": [\r\n        \"name\"\r\n      ],\r\n      \"fields\": []\r\n    },\r\n    {\r\n      \"name\": \"common.parent\",\r\n      \"abstract\": true,\r\n      \"query\": [\r\n        \"parentId\"\r\n      ],\r\n      \"validation\": {\r\n        \"rules\": [\r\n          {\r\n            \"fields\": [\r\n              \"parentId\"\r\n            ],\r\n            \"rules\": [\r\n              \"$notInParent\"\r\n            ]\r\n          }\r\n        ]\r\n      },\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"parentId\",\r\n          \"type\": \"long\",\r\n          \"baseProperty\": \"id\",\r\n          \"baseModel\": \"$self\",\r\n          \"required\": true,\r\n          \"index\": true,\r\n          \"default\": 0,\r\n          \"recursive\": true,\r\n          \"shortName\": \"pi\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.path\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"path\",\r\n          \"type\": \"string\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.PathProvider\",\r\n          \"priority\": 2\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.organization\",\r\n      \"inherits\": [\r\n        \"common.nameId\",\r\n        \"common.parent\",\r\n        \"common.path\"\r\n      ],\r\n      \"constraints\": [\r\n        \"name, parentId\"\r\n      ],\r\n      \"icon\": \"public\",\r\n      \"label\": \"Organization\",\r\n      \"description\": \"Organization model for defining scope of all other models.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.OrganizationEnumType\",\r\n          \"type\": \"enum\",\r\n          \"required\": true,\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"file.indexEntry\",\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"id\",\r\n          \"type\": \"long\",\r\n          \"identity\": true,\r\n          \"readOnly\": true,\r\n          \"private\": true\r\n        },\r\n        {\r\n          \"name\": \"objectId\",\r\n          \"type\": \"string\",\r\n          \"identity\": true,\r\n          \"readOnly\": true,\r\n          \"maxLength\": 40\r\n        },\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"required\": true\r\n        },\r\n        {\r\n          \"name\": \"indexModel\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"file.simpleByteStore\",\r\n      \"inherits\": [\r\n        \"file.indexEntry\"\r\n      ],\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"dataBytesStore\",\r\n          \"type\": \"blob\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.contactInformationExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"contactInformation\",\r\n          \"baseModel\": \"identity.contactInformation\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"read\": [\r\n                \"AccountUsersReaders\"\r\n              ]\r\n            }\r\n          },\r\n          \"shortName\": \"ci\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.user\",\r\n      \"constraints\": [\r\n        \"name, organizationId\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.nameId\",\r\n        \"identity.contactInformationExt\"\r\n      ],\r\n      \"icon\": \"verified_user\",\r\n      \"label\": \"User\",\r\n      \"validation\": {\r\n        \"rules\": [\r\n          {\r\n            \"fields\": [\r\n              \"name\"\r\n            ],\r\n            \"rules\": [\r\n              \"$minLen5\"\r\n            ]\r\n          }\r\n        ]\r\n      },\r\n      \"io\": {\r\n        \"writer\": \"org.cote.accountmanager.io.factory.UserWriter\"\r\n      },\r\n      \"description\": \"User model for defining system users.\",\r\n      \"access\": {\r\n        \"roles\": {\r\n          \"create\": [\r\n            \"AccountAdministrators\"\r\n          ],\r\n          \"read\": [\r\n            \"AccountAdministrators\",\r\n            \"AccountUsersReaders\"\r\n          ],\r\n          \"update\": [\r\n            \"AccountAdministrators\"\r\n          ],\r\n          \"delete\": [\r\n            \"AccountAdministrators\"\r\n          ],\r\n          \"admin\": [\r\n            \"AccountAdministrators\"\r\n          ]\r\n        }\r\n      },\r\n      \"query\": [\r\n        \"name\",\r\n        \"homeDirectory\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"homeDirectory\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"read\": [\r\n                \"AccountUsersReaders\"\r\n              ]\r\n            }\r\n          },\r\n          \"shortName\": \"hd\"\r\n        },\r\n        {\r\n          \"name\": \"status\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.UserStatusEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"shortName\": \"stat\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.UserEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.groupExt\",\r\n      \"abstract\": true,\r\n      \"query\": [\r\n        \"groupId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"groupId\",\r\n          \"type\": \"long\",\r\n          \"baseProperty\": \"id\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"index\": true,\r\n          \"recursive\": true,\r\n          \"shortName\": \"g\"\r\n        },\r\n        {\r\n          \"name\": \"groupPath\",\r\n          \"type\": \"string\",\r\n          \"virtual\": true,\r\n          \"baseModel\": \"auth.group\",\r\n          \"baseProperty\": \"groupId\",\r\n          \"provider\": \"org.cote.accountmanager.provider.PathProvider\",\r\n          \"priority\": 1,\r\n          \"shortName\": \"gp\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.directory\",\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.nameId\"\r\n      ],\r\n      \"constraints\": [\r\n        \"name, groupId, organizationId\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.DirectoryFactory\",\r\n      \"abstract\": true,\r\n      \"query\": [\r\n        \"groupId\",\r\n        \"groupPath\",\r\n        \"organizationId\"\r\n      ],\r\n      \"fields\": []\r\n    },\r\n    {\r\n      \"name\": \"identity.account\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"identity.contactInformationExt\"\r\n      ],\r\n      \"icon\": \"account_circle\",\r\n      \"label\": \"Account\",\r\n      \"group\": \"Accounts\",\r\n      \"description\": \"An account represents a system or application identity outside the context of the AccountManager system.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.AccountEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"status\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.AccountStatusEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"referenceId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"accountId\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 40\r\n        },\r\n        {\r\n          \"name\": \"databaseRecord\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.description\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"description\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 512,\r\n          \"shortName\": \"dsc\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.person\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\",\r\n        \"identity.contactInformationExt\"\r\n      ],\r\n      \"icon\": \"person\",\r\n      \"label\": \"Person\",\r\n      \"group\": \"Persons\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"Represents an individual identity which may or may not be associated with an account or user.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"race\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"shortName\": \"rac\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"ethnicity\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"shortName\": \"eth\"\r\n        },\r\n        {\r\n          \"name\": \"otherEthnicity\",\r\n          \"type\": \"string\",\r\n          \"shortName\": \"oeth\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"firstName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"middleName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"lastName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"title\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"suffix\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"birthDate\",\r\n          \"type\": \"zonetime\"\r\n        },\r\n        {\r\n          \"name\": \"age\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"gender\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 10\r\n        },\r\n        {\r\n          \"name\": \"alias\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"prefix\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 10\r\n        },\r\n        {\r\n          \"name\": \"users\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"system.user\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"accounts\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"identity.account\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"partners\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$self\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"participantModel\": \"person.partner\"\r\n        },\r\n        {\r\n          \"name\": \"dependents\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$self\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"participantModel\": \"person.dependent\"\r\n        },\r\n        {\r\n          \"name\": \"siblings\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$self\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"participantModel\": \"person.dependent\"\r\n        },\r\n        {\r\n          \"name\": \"socialRing\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"auth.role\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"description\": \"The social ring is a hierarchy of peer groups by importance, and optionally by circumstance\",\r\n          \"participantModel\": \"person.ring\"\r\n        },\r\n        {\r\n          \"name\": \"notes\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.note\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"personality\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"identity.personality\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"per\"\r\n        },\r\n        {\r\n          \"name\": \"behavior\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"identity.behavior\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"beh\"\r\n        },\r\n        {\r\n          \"name\": \"profile\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"identity.profile\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"auth.group\",\r\n      \"inherits\": [\r\n        \"common.nameId\",\r\n        \"common.path\",\r\n        \"common.parent\",\r\n        \"common.description\"\r\n      ],\r\n      \"constraints\": [\r\n        \"name, parentId, organizationId\"\r\n      ],\r\n      \"hints\": [\r\n        \"name, type, parentId\"\r\n      ],\r\n      \"icon\": \"folder\",\r\n      \"label\": \"Group\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"Containers used to store collections of principles such as users, accounts, or persons, or other groups.  Nested groups of type 'data' are frequently used to emulate directory structures for organizing information.\",\r\n      \"query\": [\r\n        \"type\",\r\n        \"path\",\r\n        \"organizationId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.GroupEnumType\",\r\n          \"type\": \"enum\",\r\n          \"required\": true,\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.reference\",\r\n      \"abstract\": true,\r\n      \"hints\": [\r\n        \"referenceModel, referenceId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"referenceModel\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64,\r\n          \"shortName\": \"rm\"\r\n        },\r\n        {\r\n          \"name\": \"referenceId\",\r\n          \"type\": \"long\",\r\n          \"shortName\": \"ri\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.attribute\",\r\n      \"inherits\": [\r\n        \"common.baseLight\",\r\n        \"common.reference\"\r\n      ],\r\n      \"followReference\": false,\r\n      \"description\": \"Attributes are used to store key/value pairs for objects. The valueType is used to determine how the value should be interpreted.\",\r\n      \"access\": {\r\n        \"roles\": {\r\n          \"create\": [\r\n            \"AccountUsers\"\r\n          ],\r\n          \"read\": [\r\n            \"SystemAdministrators\",\r\n            \"DataAdministrators\"\r\n          ],\r\n          \"update\": [\r\n            \"AccountAdministrators\"\r\n          ],\r\n          \"delete\": [\r\n            \"SystemAdministrators\",\r\n            \"DataAdministrators\"\r\n          ],\r\n          \"admin\": [\r\n            \"AccountAdministrators\"\r\n          ]\r\n        }\r\n      },\r\n      \"query\": [\r\n        \"name\",\r\n        \"value\",\r\n        \"valueType\"\r\n      ],\r\n      \"sortField\": \"name\",\r\n      \"sortOrder\": \"ASCENDING\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"value\",\r\n          \"type\": \"flex\",\r\n          \"valueType\": \"valueType\",\r\n          \"shortName\": \"v\"\r\n        },\r\n        {\r\n          \"name\": \"valueType\",\r\n          \"baseClass\": \"org.cote.accountmanager.model.field.FieldEnumType\",\r\n          \"type\": \"enum\",\r\n          \"default\": \"string\",\r\n          \"maxLength\": 16,\r\n          \"shortName\": \"vt\"\r\n        },\r\n        {\r\n          \"name\": \"valueModel\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128,\r\n          \"shortName\": \"vm\"\r\n        },\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64,\r\n          \"shortName\": \"n\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"auth.role\",\r\n      \"inherits\": [\r\n        \"common.nameId\",\r\n        \"common.path\",\r\n        \"common.parent\"\r\n      ],\r\n      \"constraints\": [\r\n        \"parentId, name, type, organizationId\"\r\n      ],\r\n      \"icon\": \"badge\",\r\n      \"label\": \"Role\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"Roles are used to group permissions and are typically assigned to users, accounts, persons, or groups. System role membership is also used for coarse API authorization.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.RoleEnumType\",\r\n          \"type\": \"enum\",\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"auth.permission\",\r\n      \"inherits\": [\r\n        \"common.nameId\",\r\n        \"common.path\",\r\n        \"common.parent\"\r\n      ],\r\n      \"constraints\": [\r\n        \"parentId, name, type, organizationId\"\r\n      ],\r\n      \"icon\": \"shield\",\r\n      \"label\": \"Permission\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"Permissions are used to control access to resources and actions within the system. They are assigned to users, accounts, persons, groups, or roles through participations.\",\r\n      \"fields\": [\r\n        {\r\n          \"label\": \"Type\",\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.PermissionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.compression\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"compressionType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.CompressionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"default\": \"UNKNOWN\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.contentType\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"contentType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.byteStore\",\r\n      \"abstract\": true,\r\n      \"inherits\": [\r\n        \"data.compression\",\r\n        \"data.contentType\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"dataBytesStore\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"dataHash\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        },\r\n        {\r\n          \"name\": \"readDataBytes\",\r\n          \"type\": \"boolean\",\r\n          \"virtual\": true\r\n        },\r\n        {\r\n          \"name\": \"size\",\r\n          \"type\": \"long\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.cipherExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"cipherKey\",\r\n          \"type\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"enciphered\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.vaultExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"keyId\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64,\r\n          \"shortName\": \"kid\"\r\n        },\r\n        {\r\n          \"name\": \"vaultId\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64,\r\n          \"shortName\": \"vid\"\r\n        },\r\n        {\r\n          \"name\": \"vaulted\",\r\n          \"type\": \"boolean\",\r\n          \"shortName\": \"vb\"\r\n        },\r\n        {\r\n          \"name\": \"vaultedFields\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true,\r\n          \"shortName\": \"vf\"\r\n        },\r\n        {\r\n          \"name\": \"unvaultedFields\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true,\r\n          \"shortName\": \"uf\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.cryptoByteStore\",\r\n      \"abstract\": true,\r\n      \"inherits\": [\r\n        \"data.byteStore\",\r\n        \"crypto.cipherExt\",\r\n        \"crypto.vaultExt\"\r\n      ],\r\n      \"fields\": []\r\n    },\r\n    {\r\n      \"name\": \"common.dateTime\",\r\n      \"abstract\": \"true\",\r\n      \"factory\": \"org.cote.accountmanager.factory.DateTimeFactory\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"createdDate\",\r\n          \"type\": \"timestamp\",\r\n          \"shortName\": \"cd\"\r\n        },\r\n        {\r\n          \"name\": \"modifiedDate\",\r\n          \"type\": \"timestamp\",\r\n          \"label\": \"Modified Date\",\r\n          \"shortName\": \"md\"\r\n        },\r\n        {\r\n          \"name\": \"expiryDate\",\r\n          \"type\": \"timestamp\",\r\n          \"shortName\": \"ed\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.streamExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"stream\",\r\n          \"baseModel\": \"data.stream\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.data\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"crypto.cryptoByteStore\",\r\n        \"common.description\",\r\n        \"common.dateTime\",\r\n        \"data.streamExt\"\r\n      ],\r\n      \"group\": \"Data\",\r\n      \"icon\": \"data_object\",\r\n      \"label\": \"Data\",\r\n      \"dedicatedParticipation\": true,\r\n      \"sortField\": \"name\",\r\n      \"sortOrder\": \"ASCENDING\",\r\n      \"query\": [\r\n        \"contentType\",\r\n        \"organizationId\"\r\n      ],\r\n      \"description\": \"Generic data storage model used to store various types of data, including files and streams.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"dimensions\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.control\",\r\n      \"inherits\": [\r\n        \"common.nameId\",\r\n        \"common.dateTime\",\r\n        \"common.reference\"\r\n      ],\r\n      \"group\": \"Controls\",\r\n      \"icon\": \"app_blocking\",\r\n      \"label\": \"Control\",\r\n      \"description\": \"A control is a specific action or set of actions that can be applied to a resource or policy to enforce security or compliance requirements.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"controlId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"controlType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ControlEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"action\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ControlActionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"auth.credential\",\r\n      \"inherits\": [\r\n        \"common.base\",\r\n        \"common.dateTime\",\r\n        \"crypto.vaultExt\",\r\n        \"crypto.cipherExt\",\r\n        \"common.reference\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.CredentialFactory\",\r\n      \"icon\": \"app_blocking\",\r\n      \"label\": \"Credential\",\r\n      \"description\": \"Credential that may be used to authenticate a principle, such as a user, person, or account.  Credentials are usually hashed passwords, certificates, or tokens.\",\r\n      \"access\": {\r\n        \"roles\": {\r\n          \"create\": [\r\n            \"AccountUsers\"\r\n          ],\r\n          \"read\": [\r\n            \"SystemAdministrators\",\r\n            \"DataAdministrators\"\r\n          ],\r\n          \"update\": [\r\n            \"AccountAdministrators\"\r\n          ],\r\n          \"delete\": [\r\n            \"SystemAdministrators\",\r\n            \"DataAdministrators\"\r\n          ],\r\n          \"admin\": [\r\n            \"AccountAdministrators\"\r\n          ]\r\n        }\r\n      },\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"ephemeral\": true,\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"hash\",\r\n          \"baseModel\": \"crypto.hash\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"credential\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"primary\",\r\n          \"type\": \"boolean\",\r\n          \"index\": true\r\n        },\r\n        {\r\n          \"name\": \"previousCredentialId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"nextCredentialId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.CredentialEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.score\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"score\",\r\n          \"type\": \"int\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.order\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"order\",\r\n          \"type\": \"int\",\r\n          \"shortName\": \"ord\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.baseAuthorization\",\r\n      \"abstract\": true,\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\",\r\n        \"common.dateTime\",\r\n        \"policy.score\",\r\n        \"common.order\"\r\n      ],\r\n      \"fields\": []\r\n    },\r\n    {\r\n      \"name\": \"policy.operation\",\r\n      \"inherits\": [\r\n        \"policy.baseAuthorization\"\r\n      ],\r\n      \"group\": \"Operations\",\r\n      \"icon\": \"call_to_action\",\r\n      \"label\": \"Operation\",\r\n      \"description\": \"An operation is a specific action or set of actions that can be performed on a resource or policy to achieve a desired outcome. Operations can be used to manipulate data, enforce policies, or derive new information based on existing data.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"operation\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.OperationEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.contact\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\"\r\n      ],\r\n      \"icon\": \"contact_page\",\r\n      \"label\": \"Contact\",\r\n      \"group\": \"Contacts\",\r\n      \"description\": \"A contact is a method of reaching an individual or group. Contacts can be phone numbers, email or website addresses.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"contactValue\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"contactType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ContactEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"locationType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.LocationEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"preferred\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.address\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\"\r\n      ],\r\n      \"icon\": \"maps_home_work\",\r\n      \"label\": \"Address\",\r\n      \"group\": \"Addresses\",\r\n      \"description\": \"An address represents a physical location, such as a home or office, that can be associated with an account or individual. It includes details like street, city, state, and postal code.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"street\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"street2\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"city\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"region\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"state\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 40\r\n        },\r\n        {\r\n          \"name\": \"postalCode\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 12\r\n        },\r\n        {\r\n          \"name\": \"country\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 40\r\n        },\r\n        {\r\n          \"name\": \"locationType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.LocationEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"location\",\r\n          \"baseModel\": \"data.geoLocation\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"preferred\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.hash\",\r\n      \"inherits\": [\r\n        \"common.base\"\r\n      ],\r\n      \"description\": \"Cryptographic hash\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"keyFunction\",\r\n          \"type\": \"string\",\r\n          \"default\": \"PBKDF2WithHmacSHA512\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"algorithm\",\r\n          \"type\": \"string\",\r\n          \"default\": \"SHA3-224\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"prng\",\r\n          \"type\": \"string\",\r\n          \"default\": \"SHA1PRNG\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"salt\",\r\n          \"type\": \"blob\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.key\",\r\n      \"inherits\": [\r\n        \"common.base\"\r\n      ],\r\n      \"description\": \"Asymmetric key for cryptographic operations.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"key\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"keySpec\",\r\n          \"type\": \"string\",\r\n          \"default\": \"RSA\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"keyMode\",\r\n          \"type\": \"string\",\r\n          \"default\": \"RSA\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"keySize\",\r\n          \"type\": \"int\",\r\n          \"default\": 2048\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.cipherKey\",\r\n      \"inherits\": [\r\n        \"common.base\"\r\n      ],\r\n      \"description\": \"Symmetric cipher key.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"key\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"keyId\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"iv\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"encrypt\",\r\n          \"type\": \"boolean\",\r\n          \"default\": false\r\n        },\r\n        {\r\n          \"name\": \"provider\",\r\n          \"type\": \"string\",\r\n          \"default\": \"BC\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"keySpec\",\r\n          \"type\": \"string\",\r\n          \"default\": \"AES\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"keyMode\",\r\n          \"type\": \"string\",\r\n          \"default\": \"AES/CBC/PKCS5Padding\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"keySize\",\r\n          \"type\": \"int\",\r\n          \"default\": 256\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.keySet\",\r\n      \"inherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.KeyFactory\",\r\n      \"group\": \"Key Pairs\",\r\n      \"description\": \"A pair of asymmetric keys and a symmetric cipher key for cryptographic operations.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"hash\",\r\n          \"baseModel\": \"crypto.hash\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"public\",\r\n          \"baseModel\": \"crypto.key\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"private\",\r\n          \"baseModel\": \"crypto.key\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"cipher\",\r\n          \"baseModel\": \"crypto.cipherKey\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"agreementSpec\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"curveName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"organizationKey\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"primaryKey\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"globalKey\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.rsaKey\",\r\n      \"description\": \"Not used\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"modulus\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"exponent\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"d\",\r\n          \"type\": \"blob\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.policy\",\r\n      \"inherits\": [\r\n        \"policy.baseAuthorization\"\r\n      ],\r\n      \"group\": \"Policies\",\r\n      \"icon\": \"policy\",\r\n      \"label\": \"Policy\",\r\n      \"description\": \"A policy is a set of rules or guidelines that govern the behavior of users, systems, or processes within an organization. Policies can be used to enforce security, compliance, and operational standards across various domains.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"rules\",\r\n          \"baseModel\": \"policy.rule\",\r\n          \"baseType\": \"model\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"enabled\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"decisionAge\",\r\n          \"type\": \"long\",\r\n          \"default\": 0\r\n        },\r\n        {\r\n          \"name\": \"condition\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ConditionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.rule\",\r\n      \"inherits\": [\r\n        \"policy.baseAuthorization\"\r\n      ],\r\n      \"group\": \"Rules\",\r\n      \"icon\": \"rule\",\r\n      \"label\": \"Rule\",\r\n      \"description\": \"A rule is a specific condition or set of conditions that must be met for a policy to be enforced or an operation to be executed. Rules can be used to define the logic and criteria for decision-making within policies and operations.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"rules\",\r\n          \"baseModel\": \"policy.rule\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"patterns\",\r\n          \"baseModel\": \"policy.pattern\",\r\n          \"baseType\": \"model\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.RuleEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"condition\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ConditionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.pattern\",\r\n      \"inherits\": [\r\n        \"policy.baseAuthorization\"\r\n      ],\r\n      \"group\": \"Patterns\",\r\n      \"icon\": \"texture\",\r\n      \"label\": \"Pattern\",\r\n      \"description\": \"A pattern is a reusable template or structure that defines how data or policies should be organized or processed. Patterns can be used to enforce consistency, derive new information, or apply specific logic to data or policies.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"fact\",\r\n          \"baseModel\": \"policy.fact\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"match\",\r\n          \"baseModel\": \"policy.fact\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"operation\",\r\n          \"baseModel\": \"policy.operation\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"operationClass\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"factUrn\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"comparator\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ComparatorEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.PatternEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"matchUrn\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"operationUrn\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"entitlementType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"entitlementPath\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.fact\",\r\n      \"inherits\": [\r\n        \"policy.baseAuthorization\"\r\n      ],\r\n      \"group\": \"Facts\",\r\n      \"icon\": \"fact_check\",\r\n      \"label\": \"Fact\",\r\n      \"description\": \"A fact is a piece of information that can be used in policies to make decisions. Facts can be derived from various sources and can have different types and values.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"factReference\",\r\n          \"baseModel\": \"common.nameId\",\r\n          \"type\": \"model\",\r\n          \"ephemeral\": \"true\"\r\n        },\r\n        {\r\n          \"name\": \"factData\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"propertyName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"parameters\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"policy.factParameter\"\r\n        },\r\n        {\r\n          \"name\": \"value\",\r\n          \"type\": \"flex\",\r\n          \"valueType\": \"valueType\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"valueType\",\r\n          \"baseClass\": \"org.cote.accountmanager.model.field.FieldEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"default\": \"UNKNOWN\"\r\n        },\r\n        {\r\n          \"name\": \"class\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        },\r\n        {\r\n          \"name\": \"factDataType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"factType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"sourceUrn\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"sourceDataType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.SqlDataEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"sourceUrl\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"sourceData\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.FactEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"modelType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"sourceType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"chatConfig\",\r\n          \"baseModel\": \"olio.llm.chatConfig\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"promptConfig\",\r\n          \"baseModel\": \"olio.llm.promptConfig\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        }\r\n\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.factParameter\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"value\",\r\n          \"type\": \"flex\",\r\n          \"valueType\": \"valueType\"\r\n        },\r\n        {\r\n          \"name\": \"valueType\",\r\n          \"baseClass\": \"org.cote.accountmanager.model.field.FieldEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"default\": \"UNKNOWN\"\r\n        },\r\n        {\r\n          \"name\": \"valueModel\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"match\",\r\n          \"type\": \"boolean\",\r\n          \"description\": \"Bit to differentiate the parameter between a fact and match fact.\"\r\n        },\r\n        {\r\n          \"name\": \"class\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.policyRequest\",\r\n      \"factory\": \"org.cote.accountmanager.factory.PolicyRequestFactory\",\r\n      \"description\": \"A policy request is a request for a policy to be applied to a resource or subject. It contains the necessary attributes and facts to evaluate the policy.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"attributes\",\r\n          \"baseModel\": \"common.attribute\",\r\n          \"baseType\": \"model\",\r\n          \"type\": \"list\"\r\n        },\r\n        {\r\n          \"name\": \"facts\",\r\n          \"baseModel\": \"policy.fact\",\r\n          \"baseType\": \"model\",\r\n          \"type\": \"list\"\r\n        },\r\n        {\r\n          \"name\": \"contextUser\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"system.user\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"urn\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"organizationPath\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.PolicyRequestEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"subject\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"subjectType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"credentialType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.CredentialEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"verbose\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.policyResponse\",\r\n      \"inherits\": [\r\n        \"common.attributeList\",\r\n        \"policy.score\",\r\n        \"common.description\"\r\n      ],\r\n      \"description\": \"A policy response is a structured response to a policy evaluation that includes messages, rule chains, pattern chains, and response data. It can also include metadata such as type, URN, and expiry date.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"messages\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"ruleChain\",\r\n          \"baseType\": \"string\",\r\n          \"type\": \"list\"\r\n        },\r\n        {\r\n          \"name\": \"patternChain\",\r\n          \"baseType\": \"string\",\r\n          \"type\": \"list\"\r\n        },\r\n        {\r\n          \"name\": \"responseData\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"common.base\",\r\n          \"type\": \"list\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.PolicyResponseEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"urn\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"expiryDate\",\r\n          \"type\": \"timestamp\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.policyDefinition\",\r\n      \"inherits\": [\r\n        \"common.dateTime\",\r\n        \"system.organizationExt\"\r\n      ],\r\n      \"description\": \"A policy definition is a publicly consummable version of a policy that identifies parameters to be populated.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"parameters\",\r\n          \"baseModel\": \"policy.fact\",\r\n          \"baseType\": \"model\",\r\n          \"type\": \"list\"\r\n        },\r\n        {\r\n          \"name\": \"urn\",\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"enabled\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"decisionAge\",\r\n          \"type\": \"long\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.participation\",\r\n      \"inherits\": [\r\n        \"system.organizationExt\",\r\n        \"system.primaryKey\"\r\n      ],\r\n      \"provider\": \"org.cote.accountmanager.provider.ParticipationProvider\",\r\n      \"hints\": [\r\n        \"participationId, participationModel\",\r\n        \"participantId, participantModel\",\r\n        \"participationId, participationModel, participantId, participantModel\"\r\n      ],\r\n      \"description\": \"Participation model for defining relationships between participants and resources.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"ownerId\",\r\n          \"type\": \"long\",\r\n          \"required\": true,\r\n          \"private\": true\r\n        },\r\n        {\r\n          \"name\": \"participationId\",\r\n          \"type\": \"long\",\r\n          \"required\": true\r\n        },\r\n        {\r\n          \"name\": \"participationModel\",\r\n          \"type\": \"string\",\r\n          \"required\": true,\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"participantId\",\r\n          \"type\": \"long\",\r\n          \"required\": true\r\n        },\r\n        {\r\n          \"name\": \"participantModel\",\r\n          \"type\": \"string\",\r\n          \"required\": true,\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"permissionId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"effectType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.EffectEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"enabled\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"io.query\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.QueryFactory\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"urn\",\r\n          \"type\": \"string\",\r\n          \"identity\": true,\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"required\": true,\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"alias\",\r\n          \"type\": \"string\",\r\n          \"ephemeral\": true,\r\n          \"maxLength\": 60\r\n        },\r\n        {\r\n          \"name\": \"count\",\r\n          \"type\": \"int\",\r\n          \"ephemeral\": true,\r\n          \"private\": true\r\n        },\r\n        {\r\n          \"name\": \"cache\",\r\n          \"type\": \"boolean\",\r\n          \"default\": true\r\n        },\r\n        {\r\n          \"name\": \"executed\",\r\n          \"type\": \"boolean\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"comparator\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ComparatorEnumType\",\r\n          \"type\": \"enum\",\r\n          \"default\": \"GROUP_AND\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"sortField\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"startRecord\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"recordCount\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"order\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.OrderEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"queryKey\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"queryHash\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"request\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"contextUser\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"system.user\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"limitFields\",\r\n          \"type\": \"boolean\",\r\n          \"default\": true\r\n        },\r\n        {\r\n          \"name\": \"fields\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"io.queryField\"\r\n        },\r\n        {\r\n          \"name\": \"queries\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"query\",\r\n          \"internal\": true,\r\n          \"description\": \"Used to extend the query model with another table, such as participation\"\r\n        },\r\n        {\r\n          \"name\": \"joins\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"query\",\r\n          \"internal\": true,\r\n          \"description\": \"Used to hold sub-queries constructed to reconstitute foreign key fields\"\r\n        },\r\n        {\r\n          \"name\": \"joinKey\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"internal\": true,\r\n          \"description\": \"Used to identify the foreignKey column that refers to the primary key.  Note: This column must exist in the model schema or will not be permitted\"\r\n        },\r\n        {\r\n          \"name\": \"topCount\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"organizationId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"groupBy\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"having\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"token\",\r\n          \"type\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"havingClause\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"inspect\",\r\n          \"type\": \"boolean\",\r\n          \"description\": \"Indicates to listening providers not to perform some actions intended for read operations\"\r\n        },\r\n        {\r\n          \"name\": \"participation\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"system.participation\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"plan\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"io.queryPlan\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"debug\",\r\n          \"type\": \"boolean\",\r\n          \"ephemeral\": true,\r\n          \"description\": \"For some reason, inheriting from 'debug' leads to a stackover flow, likely due to how query is used to initially lookup models loaded into the system\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"io.queryField\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"comparator\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ComparatorEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"default\": \"EQUALS\"\r\n        },\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"required\": true,\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"value\",\r\n          \"type\": \"flex\",\r\n          \"valueType\": \"valueType\",\r\n          \"required\": true\r\n        },\r\n        {\r\n          \"name\": \"valueType\",\r\n          \"description\": \"valueType is only meant to be used for certain serialization cases\",\r\n          \"baseClass\": \"org.cote.accountmanager.model.field.FieldEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"shortName\": \"vt\"\r\n        },\r\n        {\r\n          \"name\": \"fields\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$self\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"io.queryResult\",\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"required\": true,\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"queryKey\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"queryHash\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"count\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"totalCount\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"results\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$flex\"\r\n        },\r\n        {\r\n          \"name\": \"response\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.OperationResponseEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"message\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"io.queryPlan\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"modelName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"fieldName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"parent\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"baseModel\": \"io.queryPlan\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"plans\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"io.queryPlan\"\r\n        },\r\n        {\r\n          \"name\": \"fields\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.journal\",\r\n      \"inherits\": [\r\n        \"common.base\"\r\n      ],\r\n      \"description\": \"Journal containing model change records.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"journaled\",\r\n          \"type\": \"boolean\",\r\n          \"shortName\": \"jd\"\r\n        },\r\n        {\r\n          \"name\": \"journalHash\",\r\n          \"type\": \"blob\",\r\n          \"shortName\": \"jh\"\r\n        },\r\n        {\r\n          \"name\": \"journalVersion\",\r\n          \"type\": \"double\",\r\n          \"shortName\": \"jv\"\r\n        },\r\n        {\r\n          \"name\": \"journalEntries\",\r\n          \"baseModel\": \"data.journalEntry\",\r\n          \"baseType\": \"model\",\r\n          \"type\": \"list\",\r\n          \"shortName\": \"je\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.hashExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"hash\",\r\n          \"type\": \"blob\",\r\n          \"restricted\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.journalEntry\",\r\n      \"abstract\": false,\r\n      \"emitModel\": true,\r\n      \"inherits\": [\r\n        \"crypto.hashExt\"\r\n      ],\r\n      \"description\": \"Record of a model change.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"journalDate\",\r\n          \"type\": \"timestamp\",\r\n          \"shortName\": \"jd\"\r\n        },\r\n        {\r\n          \"name\": \"version\",\r\n          \"type\": \"double\",\r\n          \"shortName\": \"jv\"\r\n        },\r\n        {\r\n          \"name\": \"baseline\",\r\n          \"type\": \"boolean\",\r\n          \"shortName\": \"jb\"\r\n        },\r\n        {\r\n          \"name\": \"modified\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"shortName\": \"jm\"\r\n        },\r\n        {\r\n          \"name\": \"fields\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"shortName\": \"jf\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"file.participationList\",\r\n      \"inherits\": [\r\n        \"system.organizationExt\"\r\n      ],\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"id\",\r\n          \"type\": \"long\",\r\n          \"identity\": true,\r\n          \"readOnly\": true,\r\n          \"private\": true\r\n        },\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"partId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"parts\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"file.participationEntry\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"file.participationEntry\",\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"partId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"permissionId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"effectType\",\r\n          \"type\": \"enum\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.EffectEnumType\",\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"message.recipient\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"recipientId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"recipientType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"message.sender\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"senderId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"senderType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"message.spool\",\r\n      \"inherits\": [\r\n        \"common.dateTime\",\r\n        \"system.organizationExt\",\r\n        \"system.primaryKey\",\r\n        \"common.reference\",\r\n        \"message.recipient\",\r\n        \"message.sender\"\r\n      ],\r\n      \"description\": \"A spool is a temporary storage for messages that are queued for processing or delivery. Spools can be used to manage message flow, handle retries, and ensure that messages are delivered even if the recipient is temporarily unavailable.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"data\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"objectId\",\r\n          \"type\": \"string\",\r\n          \"identity\": true,\r\n          \"readOnly\": true,\r\n          \"maxLength\": 60\r\n        },\r\n        {\r\n          \"name\": \"spoolBucketType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.SpoolBucketEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"spoolBucketName\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.SpoolNameEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"valueType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ValueEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"ownerId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"spoolStatus\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.SpoolStatusEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"expires\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"transportType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"credentialId\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"parentObjectId\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 60\r\n        },\r\n        {\r\n          \"name\": \"currentLevel\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"endLevel\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"classification\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"groupId\",\r\n          \"type\": \"long\",\r\n          \"baseModel\": \"auth.group\"\r\n        },\r\n        {\r\n          \"name\": \"groupPath\",\r\n          \"type\": \"string\",\r\n          \"virtual\": true,\r\n          \"baseModel\": \"auth.group\",\r\n          \"baseProperty\": \"groupId\",\r\n          \"provider\": \"org.cote.accountmanager.provider.PathProvider\"\r\n        },\r\n        {\r\n          \"name\": \"modelType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"auth.token\",\r\n      \"inherits\": [\r\n        \"message.spool\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.TokenFactory\",\r\n      \"description\": \"Not used\",\r\n      \"fields\": []\r\n    },\r\n    {\r\n      \"name\": \"dev.parameter\",\r\n      \"inherits\": [\r\n        \"common.attribute\"\r\n      ],\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"valueSchema\",\r\n          \"type\": \"string\",\r\n          \"description\": \"A JSON schema for the parameter value, for use when the entire object model may not be available.\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"dev.parameterList\",\r\n      \"factory\": \"org.cote.accountmanager.factory.ParameterListFactory\",\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"parameters\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"dev.parameter\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"file.index2\",\r\n      \"factory\": \"org.cote.accountmanager.factory.ParameterListFactory\",\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"lastId\",\r\n          \"type\": \"long\",\r\n          \"default\": 100\r\n        },\r\n        {\r\n          \"name\": \"entries\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"file.indexEntry2\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"file.indexEntry2\",\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"values\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"file.indexEntryValue2\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"file.indexEntryValue2\",\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.attribute\"\r\n      ],\r\n      \"fields\": []\r\n    },\r\n    {\r\n      \"name\": \"file.indexStore\",\r\n      \"inherits\": [\r\n        \"file.simpleByteStore\"\r\n      ],\r\n      \"ioConstraints\": [\r\n        \"file\"\r\n      ],\r\n      \"fields\": []\r\n    },\r\n    {\r\n      \"name\": \"crypto.keyStore\",\r\n      \"inherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"group\": \"Key Stores\",\r\n      \"description\": \"Repository for cryptographic keys and certificates. It can be used to store private keys, public keys, and certificates in a secure manner.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"alias\",\r\n          \"type\": \"String\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"String\",\r\n          \"default\": \"PKCS12\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"store\",\r\n          \"type\": \"blob\",\r\n          \"readOnly\": true\r\n        },\r\n        {\r\n          \"name\": \"credential\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"auth.credential\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"keySet\",\r\n          \"baseModel\": \"crypto.keySet\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.vault\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.dateTime\"\r\n      ],\r\n      \"ephemeral\": false,\r\n      \"group\": \".vault\",\r\n      \"description\": \"Specialized key store used to store encrypted cryptographic keys outside of the database.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"alias\",\r\n          \"type\": \"String\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"keyPath\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"vaultPath\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"nameHash\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"activeKey\",\r\n          \"baseModel\": \"crypto.keySet\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"ephemeral\": false\r\n        },\r\n        {\r\n          \"name\": \"vaultKey\",\r\n          \"baseModel\": \"crypto.keySet\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"public\",\r\n          \"baseModel\": \"crypto.keySet\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"salt\",\r\n          \"baseModel\": \"crypto.keySet\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"serviceUser\",\r\n          \"baseModel\": \"system.user\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"credential\",\r\n          \"baseModel\": \"auth.credential\",\r\n          \"type\": \"model\",\r\n          \"foreign\": false\r\n        },\r\n        {\r\n          \"name\": \"protectedCredential\",\r\n          \"baseModel\": \"auth.credential\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"protectedCredentialPath\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"vaultGroup\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"groupName\",\r\n          \"type\": \"String\",\r\n          \"default\": \".vault\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"vaultLink\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 60\r\n        },\r\n        {\r\n          \"name\": \"keyExtension\",\r\n          \"type\": \"string\",\r\n          \"default\": \".mprv\",\r\n          \"maxLength\": 10\r\n        },\r\n        {\r\n          \"name\": \"keyPrefix\",\r\n          \"type\": \"string\",\r\n          \"default\": \"Vault\",\r\n          \"maxLength\": 10\r\n        },\r\n        {\r\n          \"name\": \"keyProtectedPrefix\",\r\n          \"type\": \"string\",\r\n          \"default\": \"Prot\",\r\n          \"maxLength\": 10\r\n        },\r\n        {\r\n          \"name\": \"haveVaultKey\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"protected\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"haveCredential\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"dn\",\r\n          \"type\": \"String\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"initialized\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.subject\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"subject\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"subjectType\"\r\n        },\r\n        {\r\n          \"name\": \"subjectType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"access.submitter\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"submitter\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"subjectType\"\r\n        },\r\n        {\r\n          \"name\": \"submitterType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"access.requester\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"requester\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"requesterType\"\r\n        },\r\n        {\r\n          \"name\": \"requesterType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"access.request\",\r\n      \"abstract\": true,\r\n      \"inherits\": [\r\n        \"identity.subject\",\r\n        \"access.submitter\",\r\n        \"access.requester\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"action\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ActionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"auth.authenticationRequest\",\r\n      \"inherits\": [\r\n        \"access.request\"\r\n      ],\r\n      \"description\": \"Authentication request used to pass credentials or tokens for an actor, such as a user, person, or account.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"credential\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"checkCredential\",\r\n          \"type\": \"blob\"\r\n        },\r\n        {\r\n          \"name\": \"credentialType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.CredentialEnumType\",\r\n          \"type\": \"enum\",\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"checkCredentialType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.CredentialEnumType\",\r\n          \"type\": \"enum\",\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"tokens\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.response\",\r\n      \"inherits\": [\r\n        \"system.organizationExt\"\r\n      ],\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"message\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.OperationResponseEnumType\",\r\n          \"type\": \"enum\",\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"auth.authenticationResponse\",\r\n      \"inherits\": [\r\n        \"policy.response\"\r\n      ],\r\n      \"description\": \"Authentication response used to return the result of an authentication request. This is typically used to return a token and a reference to the authenticated principle.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"principle\",\r\n          \"type\": \"model\"\r\n        },\r\n        {\r\n          \"name\": \"tokens\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"response\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.AuthenticationResponseEnumType\",\r\n          \"type\": \"enum\",\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.description2K\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"description\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 2048,\r\n          \"shortName\": \"dsc\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"crypto.signature\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"signature\",\r\n          \"type\": \"blob\",\r\n          \"restricted\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.audit\",\r\n      \"inherits\": [\r\n        \"common.dateTime\",\r\n        \"system.organizationExt\",\r\n        \"common.description2K\",\r\n        \"system.primaryKey\",\r\n        \"crypto.signature\",\r\n        \"crypto.hashExt\",\r\n        \"identity.subject\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.AuditFactory\",\r\n      \"autoCreateForeignReference\": false,\r\n      \"description\": \"Audit records for actions taken in the system\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"objectId\",\r\n          \"type\": \"string\",\r\n          \"identity\": true,\r\n          \"readOnly\": true,\r\n          \"maxLength\": 40\r\n        },\r\n        {\r\n          \"name\": \"action\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ActionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"response\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ResponseEnumType\",\r\n          \"type\": \"enum\",\r\n          \"index\": true,\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"resource\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"resourceType\"\r\n        },\r\n        {\r\n          \"name\": \"resourceType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"contextUser\",\r\n          \"baseModel\": \"system.user\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"message\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 2048\r\n        },\r\n        {\r\n          \"name\": \"query\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"policy\",\r\n          \"baseModel\": \"policy.policyResponse\",\r\n          \"type\": \"model\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.contactInformation\",\r\n      \"inherits\": [\r\n        \"common.ownerId\",\r\n        \"common.objectId\",\r\n        \"system.organizationExt\",\r\n        \"common.populate\",\r\n        \"system.primaryKey\",\r\n        \"common.reference\",\r\n        \"common.urn\"\r\n      ],\r\n      \"access\": {\r\n        \"roles\": {\r\n          \"create\": [\r\n            \"AccountUsers\"\r\n          ],\r\n          \"read\": [\r\n            \"SystemAdministrators\",\r\n            \"DataAdministrators\"\r\n          ],\r\n          \"update\": [\r\n            \"AccountAdministrators\"\r\n          ],\r\n          \"delete\": [\r\n            \"SystemAdministrators\",\r\n            \"DataAdministrators\"\r\n          ],\r\n          \"admin\": [\r\n            \"AccountAdministrators\"\r\n          ]\r\n        },\r\n        \"policies\": {\r\n          \"bind\": {\r\n            \"objectId\": \"referenceId\",\r\n            \"objectSchema\": \"referenceModel\",\r\n            \"description\": \"Defer to the object identified by 'propertyName' when performing policy evaluations.  This is to allow for ephemeral objects to be authorized and audited in a uniform fashion\"\r\n          }\r\n        }\r\n      },\r\n      \"description\": \"A contact information record for a person or organization.  This is used to store phone numbers, emails, and other contact information.\",\r\n      \"followReference\": false,\r\n      \"dedicatedParticipation\": true,\r\n      \"query\": [\r\n        \"referenceId\",\r\n        \"referenceModel\",\r\n        \"id\",\r\n        \"ownerId\",\r\n        \"organizationId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"contacts\",\r\n          \"baseModel\": \"identity.contact\",\r\n          \"baseType\": \"model\",\r\n          \"foreign\": true,\r\n          \"type\": \"list\",\r\n          \"participantModel\": \"ci.contact\"\r\n        },\r\n        {\r\n          \"name\": \"addresses\",\r\n          \"baseModel\": \"identity.address\",\r\n          \"baseType\": \"model\",\r\n          \"foreign\": true,\r\n          \"type\": \"list\",\r\n          \"participantModel\": \"ci.address\"\r\n        },\r\n        {\r\n          \"name\": \"contactInformationType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ContactInformationEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"auth.entitlement\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"entitlementType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"entitlement\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"entitlementType\",\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"create\": [\r\n                \"AccountUsersReaders\",\r\n                \"RequestReaders\",\r\n                \"RoleReaders\",\r\n                \"PermissionReaders\"\r\n              ],\r\n              \"read\": [\r\n                \"AccountUsersReaders\",\r\n                \"RequestReaders\",\r\n                \"RoleReaders\",\r\n                \"PermissionReaders\"\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"access.baseAccess\",\r\n      \"abstract\": \"true\",\r\n      \"inherits\": [\r\n        \"common.nameId\",\r\n        \"common.parent\",\r\n        \"access.request\",\r\n        \"auth.entitlement\",\r\n        \"common.dateTime\",\r\n        \"common.description\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"resourceData\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreignType\": \"resourceType\",\r\n          \"description\": \"Placeholder for serialized non-persisted objects\"\r\n        },\r\n        {\r\n          \"name\": \"resource\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"resourceType\",\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"read\": [\r\n                \"RequestReaders\"\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"name\": \"resourceType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"token\",\r\n          \"type\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"access.approver\",\r\n      \"abstract\": true,\r\n      \"inherits\": [\r\n        \"crypto.signature\"\r\n      ],\r\n      \"description\": \"An approver for an access request.  This could be a user, a person, an account, a group, or a role.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"approver\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"approverType\",\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"read\": [\r\n                \"AccountUsersReaders\",\r\n                \"RequestReaders\"\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"name\": \"approverType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"delegate\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"delegateType\",\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"read\": [\r\n                \"AccountUsersReaders\",\r\n                \"RequestReaders\"\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"name\": \"delegateType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"access.accessRequest\",\r\n      \"inherits\": [\r\n        \"access.baseAccess\",\r\n        \"access.approver\",\r\n        \"crypto.hashExt\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.AccessRequestFactory\",\r\n      \"icon\": \"switch_access_shortcut\",\r\n      \"label\": \"Access Request\",\r\n      \"description\": \"A request for access to a resource.  This is typically used to request membership in a group, role, or request an entitlement to a resource that requires approval.\",\r\n      \"access\": {\r\n        \"roles\": {\r\n          \"create\": [\r\n            \"Requesters\"\r\n          ],\r\n          \"read\": [\r\n            \"RequestReaders\"\r\n          ],\r\n          \"update\": [\r\n            \"RequestUpdaters\",\r\n            \"RequestAdministrators\"\r\n          ],\r\n          \"delete\": [\r\n            \"RequestAdministrators\"\r\n          ],\r\n          \"admin\": [\r\n            \"RequestAdministrators\"\r\n          ]\r\n        }\r\n      },\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"messages\",\r\n          \"baseModel\": \"message.spool\",\r\n          \"baseType\": \"model\",\r\n          \"type\": \"list\"\r\n        },\r\n        {\r\n          \"name\": \"approvalStatus\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ApprovalResponseEnumType\",\r\n          \"type\": \"enum\",\r\n          \"default\": \"UNKNOWN\",\r\n          \"maxLength\": 32,\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"update\": [\r\n                \"Approvers\",\r\n                \"RequestUpdaters\"\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.modelSchema\",\r\n      \"inherits\": [\r\n        \"common.nameId\"\r\n      ],\r\n      \"constraints\": [\r\n        \"name, organizationId\"\r\n      ],\r\n      \"query\": [\r\n        \"name\",\r\n        \"schemaData\"\r\n      ],\r\n      \"description\": \"Model schema for persisting model structures\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"schemaData\",\r\n          \"type\": \"blob\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.stream\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\",\r\n        \"common.dateTime\",\r\n        \"data.contentType\",\r\n        \"crypto.vaultExt\"\r\n      ],\r\n      \"provider\": \"org.cote.accountmanager.provider.StreamProvider\",\r\n      \"query\": [\r\n        \"contentType\",\r\n        \"type\"\r\n      ],\r\n      \"description\": \"Model used to store and retrieve streams of data.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"streamSource\",\r\n          \"type\": \"string\",\r\n          \"provider\": \"org.cote.accountmanager.provider.EncryptFieldProvider\",\r\n          \"priority\": 10,\r\n          \"encrypt\": true\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.StreamEnumType\",\r\n          \"type\": \"enum\",\r\n          \"default\": \"UNKNOWN\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"size\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"segments\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.streamSegment\",\r\n          \"ephemeral\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.streamSegment\",\r\n      \"ephemeral\": true,\r\n      \"io\": {\r\n        \"reader\": \"org.cote.accountmanager.io.stream.StreamSegmentReader\",\r\n        \"writer\": \"org.cote.accountmanager.io.stream.StreamSegmentWriter\",\r\n        \"search\": \"org.cote.accountmanager.io.stream.StreamSegmentSearch\"\r\n      },\r\n      \"access\": {\r\n        \"policies\": {\r\n          \"bind\": {\r\n            \"objectId\": \"streamId\",\r\n            \"schema\": \"data.stream\",\r\n            \"description\": \"Defer to the object identified by 'propertyName' when performing policy evaluations.  This is to allow for ephemeral objects to be authorized and audited in a uniform fashion\"\r\n          }\r\n        }\r\n      },\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"streamId\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 60,\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"stream\",\r\n          \"type\": \"blob\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"startPosition\",\r\n          \"type\": \"long\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"length\",\r\n          \"type\": \"long\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"size\",\r\n          \"type\": \"long\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"read\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.thumbnail\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"crypto.cryptoByteStore\",\r\n        \"common.dateTime\"\r\n      ],\r\n      \"access\": {\r\n        \"policies\": {\r\n          \"bind\": {\r\n            \"objectId\": \"referenceId\",\r\n            \"schema\": \"data.data\",\r\n            \"description\": \"Defer to the object identified by 'propertyName' when performing policy evaluations.  This is to allow for ephemeral objects to be authorized and audited in a uniform fashion\"\r\n          }\r\n        }\r\n      },\r\n      \"description\": \"Smaller representation of an image.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"referenceId\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 60\r\n        },\r\n        {\r\n          \"name\": \"referenceModel\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"data\"\r\n        },\r\n        {\r\n          \"name\": \"width\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"height\",\r\n          \"type\": \"int\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.validationRule\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\"\r\n      ],\r\n      \"icon\": \"rule\",\r\n      \"label\": \"Validation Rule\",\r\n      \"group\": \"Validation Rules\",\r\n      \"description\": \"A validation rule is a specific condition or set of conditions that must be met for data to be considered valid. Validation rules can be used to enforce data integrity, ensure compliance with business rules, and prevent errors in data entry or processing.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"errorMessage\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"replacementValue\",\r\n          \"type\": \"flex\",\r\n          \"valueType\": \"replacementValueType\"\r\n        },\r\n        {\r\n          \"name\": \"replacementValueType\",\r\n          \"baseClass\": \"org.cote.accountmanager.model.field.FieldEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"default\": \"UNKNOWN\"\r\n        },\r\n        {\r\n          \"name\": \"rules\",\r\n          \"baseModel\": \"policy.validationRule\",\r\n          \"baseType\": \"model\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"expression\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 255\r\n        },\r\n        {\r\n          \"name\": \"function\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"policy.function\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ValidationEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"default\": \"UNKNOWN\"\r\n        },\r\n        {\r\n          \"name\": \"comparison\",\r\n          \"type\": \"boolean\",\r\n          \"default\": true\r\n        },\r\n        {\r\n          \"name\": \"comparator\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ComparatorEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"default\": \"UNKNOWN\"\r\n        },\r\n        {\r\n          \"name\": \"allowNull\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.applicationProfile\",\r\n      \"inherits\": [\r\n        \"system.organizationExt\"\r\n      ],\r\n      \"ephemeral\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"jsonModelKey\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 20,\r\n          \"default\": \"schema\"\r\n        },\r\n        {\r\n          \"name\": \"systemRoles\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"auth.role\"\r\n        },\r\n        {\r\n          \"name\": \"userRoles\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"auth.role\"\r\n        },\r\n        {\r\n          \"name\": \"systemPermissions\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"auth.permission\"\r\n        },\r\n        {\r\n          \"name\": \"user\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"system.user\"\r\n        },\r\n        {\r\n          \"name\": \"person\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"identity.person\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"policy.function\",\r\n      \"inherits\": [\r\n        \"policy.baseAuthorization\"\r\n      ],\r\n      \"icon\": \"functions\",\r\n      \"label\": \"Function\",\r\n      \"description\": \"A function is a reusable piece of logic that can be applied to data or policies to perform specific actions or calculations. Functions can be used to manipulate data, enforce policies, or derive new information based on existing data.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"data\",\r\n          \"baseModel\": \"data.data\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.FunctionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"class\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"sourceUrn\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.tag\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.description\",\r\n        \"common.name\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"description\": \"A tag is a label that can be applied to objects for categorization or filtering purposes. Tags are often used to organize content in a flexible way, allowing users to find related items easily.\",\r\n      \"factory\": \"org.cote.accountmanager.factory.DirectoryFactory\",\r\n      \"group\": \"Tags\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Tag\",\r\n      \"dedicatedParticipation\": true,\r\n      \"constraints\": [\r\n        \"name, type, groupId, organizationId\"\r\n      ],\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\",\r\n        \"name\",\r\n        \"type\"\r\n      ],\r\n      \"sortField\": \"name\",\r\n      \"sortOrder\": \"ASCENDING\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.modelCategory\",\r\n      \"inherits\": [\r\n        \"common.nameId\",\r\n        \"common.description\"\r\n      ],\r\n      \"description\": \"Model category for grouping models together\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"icon\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 25\r\n        },\r\n        {\r\n          \"name\": \"order\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"limit\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"label\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"pathName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"prototype\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"prototypes\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"modelCategory\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.note\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.parent\",\r\n        \"common.dateTime\"\r\n      ],\r\n      \"group\": \"Notes\",\r\n      \"icon\": \"note\",\r\n      \"label\": \"Note\",\r\n      \"description\": \"Generic note model used to store text-based notes.\",\r\n      \"vectorize\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"text\",\r\n          \"type\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"message.socketMessage\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"newMessageCount\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"token\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"message\",\r\n          \"baseModel\": \"message.spool\",\r\n          \"type\": \"model\"\r\n        },\r\n        {\r\n          \"name\": \"chirps\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"limitTest\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"int\",\r\n          \"limit\": [1, 2, 3]\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.fieldLock\",\r\n      \"inherits\": [\r\n        \"common.dateTime\",\r\n        \"system.organizationExt\",\r\n        \"common.reference\",\r\n        \"system.primaryKey\"\r\n      ],\r\n      \"access\": {\r\n        \"roles\": {\r\n          \"create\": [\r\n            \"AccountUsers\"\r\n          ],\r\n          \"read\": [\r\n            \"AccountUsers\"\r\n          ]\r\n        }\r\n      },\r\n      \"description\": \"Lock specific model instance fields for editing.\",\r\n      \"constraints\": [\r\n        \"referenceId, referenceModel, fieldName, organizationId\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.FieldLockFactory\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"fieldName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"enabled\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"ownerId\",\r\n          \"type\": \"long\",\r\n          \"required\": true,\r\n          \"private\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.alignment\",\r\n      \"abstract\": \"true\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"alignment\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.AlignmentEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"aln\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.trait\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\",\r\n        \"common.alignment\",\r\n        \"policy.score\"\r\n      ],\r\n      \"constraints\": [\r\n        \"name, type, groupId, organizationId\"\r\n      ],\r\n      \"group\": \"Traits\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Trait\",\r\n      \"description\": \"A trait is a characteristic or quality that can be associated with an object, often used to define behaviors or attributes in a flexible manner. Traits can be used to categorize objects or define specific functionalities.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.TraitEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"code\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"dependencies\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$self\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.word\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.name\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Words\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Word\",\r\n      \"description\": \"Represent a single word and any gender or frequency.\",\r\n      \"constraints\": [\r\n        \"name, gender, groupId, organizationId\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.DirectoryFactory\",\r\n      \"query\": [\r\n        \"name\",\r\n        \"gender\",\r\n        \"groupId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"gender\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 2,\r\n          \"description\": \"Placeholder for gendered words\"\r\n        },\r\n        {\r\n          \"name\": \"count\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Placeholder for tracking frequency; used in wordNetModel for number of words in the synset\"\r\n        },\r\n        {\r\n          \"name\": \"class\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.wordNet\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.name\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Words\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Word\",\r\n      \"constraints\": [\r\n        \"offset, name, type, groupId, organizationId\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.DirectoryFactory\",\r\n      \"query\": [\r\n        \"name\",\r\n        \"groupId\"\r\n      ],\r\n      \"description\": \"A word with WordNet annotations and synset.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"definition\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 512\r\n        },\r\n        {\r\n          \"name\": \"example\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 512\r\n        },\r\n        {\r\n          \"name\": \"offset\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 8,\r\n          \"description\": \"WordNet synset offset\"\r\n        },\r\n        {\r\n          \"name\": \"lfn\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 2,\r\n          \"description\": \"WordNet lexicographer file name\"\r\n        },\r\n        {\r\n          \"name\": \"count\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Number of words in the synset\"\r\n        },\r\n        {\r\n          \"name\": \"pointerCount\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Number of pointers from this synset to other synsets\"\r\n        },\r\n        {\r\n          \"name\": \"lexId\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Appended to lemma to identify a sense in the lexicographer file\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 1\r\n        },\r\n        {\r\n          \"name\": \"pointers\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"wordNetPointer\"\r\n        },\r\n        {\r\n          \"name\": \"alternatives\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"wordNetAlt\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.cenWord\",\r\n      \"inherits\": [\r\n        \"data.word\"\r\n      ],\r\n      \"group\": \"Words\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Census Word\",\r\n      \"description\": \"Word model used to store words such as names with corresponding census statistics.\",\r\n      \"query\": [\r\n        \"groupId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"rank\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Word rank\"\r\n        },\r\n        {\r\n          \"name\": \"proportion\",\r\n          \"type\": \"double\",\r\n          \"description\": \"Proportion of the word\"\r\n        },\r\n        {\r\n          \"name\": \"pctwhite\",\r\n          \"type\": \"double\",\r\n          \"description\": \"Percent non-Hispanic White\"\r\n        },\r\n        {\r\n          \"name\": \"pcthispanic\",\r\n          \"type\": \"double\",\r\n          \"description\": \"Percent Hispanic or Latino\"\r\n        },\r\n        {\r\n          \"name\": \"pctblack\",\r\n          \"type\": \"double\",\r\n          \"description\": \"Percent non-Hispanic black or African American\"\r\n        },\r\n        {\r\n          \"name\": \"pctapi\",\r\n          \"type\": \"double\",\r\n          \"description\": \"Percent non-Hispanic Asian, Native Hawaiian, or other Pacific Islander\"\r\n        },\r\n        {\r\n          \"name\": \"pctaian\",\r\n          \"type\": \"double\",\r\n          \"description\": \"Percent non-Hispanic American Indian or Alaska Native\"\r\n        },\r\n        {\r\n          \"name\": \"pct2prace\",\r\n          \"type\": \"double\",\r\n          \"description\": \"Percent non-Hispanic two or more races\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.wordNetPointer\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"icon\": \"category\",\r\n      \"label\": \"Word Pointer\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"offset\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 8,\r\n          \"description\": \"WordNet synset offset\"\r\n        },\r\n        {\r\n          \"name\": \"pos\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 1,\r\n          \"description\": \"Reference to the word type\"\r\n        },\r\n        {\r\n          \"name\": \"sourceTarget\",\r\n          \"type\": \"string\",\r\n          \"description\": \"Distinguishes lexical and semantic pointers. The first two digits indicates the word number in the current (source) synset, the last two digits indicate the word number in the target synset. A value of 0000 means that pointer_symbol represents a semantic relation between the current (source) synset and the target synset indicated by synset_offset.\",\r\n          \"maxLength\": 4\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.wordNetAlt\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"icon\": \"category\",\r\n      \"label\": \"Word Alternative\",\r\n      \"inherits\": [\r\n        \"common.name\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"lexId\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Appended to lemma to identify a sense in the lexicographer file\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.location\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.parent\",\r\n        \"common.description\",\r\n        \"common.name\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.DirectoryFactory\",\r\n      \"description\": \"Model used to store locations with various attributes.\",\r\n      \"dedicatedParticipation\": true,\r\n      \"query\": [\r\n        \"name\",\r\n        \"id\",\r\n        \"objectId\",\r\n        \"ownerId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"traits\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"boundaries\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$self\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"participantModel\": \"location.boundary\"\r\n        },\r\n        {\r\n          \"name\": \"borders\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$self\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"participantModel\": \"location.border\"\r\n        },\r\n        {\r\n          \"name\": \"childLocations\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$self\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"participantModel\": \"location.child\"\r\n        },\r\n        {\r\n          \"name\": \"geographyType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.GeographyEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"UNKNOWN\"\r\n        },\r\n        {\r\n          \"name\": \"terrainType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.TerrainEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"UNKNOWN\"\r\n        },\r\n        {\r\n          \"name\": \"classification\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        },\r\n        {\r\n          \"name\": \"longitude\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"latitude\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"area\",\r\n          \"type\": \"double\",\r\n          \"description\": \"Area in square meters\"\r\n        },\r\n        {\r\n          \"name\": \"elevation\",\r\n          \"type\": \"double\",\r\n          \"description\": \"Elevation in meters\"\r\n        },\r\n        {\r\n          \"name\": \"gridZone\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 3,\r\n          \"description\": \"Grid zone designation\"\r\n        },\r\n        {\r\n          \"name\": \"kident\",\r\n          \"type\": \"string\",\r\n          \"description\": \"100K Identity\",\r\n          \"maxLength\": 3\r\n        },\r\n        {\r\n          \"name\": \"eastings\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Meters from the western grid line\"\r\n        },\r\n        {\r\n          \"name\": \"northings\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Meters from the northern grid line\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.geoLocation\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"data.location\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.DirectoryFactory\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"Model used to store geographical locations with various attributes.\",\r\n      \"constraints\": [\r\n        \"geonameid, altgeonameid, parentId, groupId, organizationId\"\r\n      ],\r\n      \"hints\": [\r\n        \"geonameid, groupId\",\r\n        \"parentId, groupId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"altName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 256\r\n        },\r\n        {\r\n          \"name\": \"altgeonameid\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"code\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"geoType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"altType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"feature\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 16\r\n        },\r\n        {\r\n          \"name\": \"iso\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 8\r\n        },\r\n        {\r\n          \"name\": \"iso3\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 8\r\n        },\r\n        {\r\n          \"name\": \"languages\",\r\n          \"baseType\": \"string\",\r\n          \"type\": \"list\"\r\n        },\r\n        {\r\n          \"name\": \"neighbors\",\r\n          \"baseType\": \"string\",\r\n          \"type\": \"list\"\r\n        },\r\n        {\r\n          \"name\": \"capital\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"continent\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"currencyCode\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 4\r\n        },\r\n        {\r\n          \"name\": \"currencyName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"postalCode\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 10\r\n        },\r\n        {\r\n          \"name\": \"geonameid\",\r\n          \"type\": \"int\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.personality\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"group\": \"Personalities\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Personality\",\r\n      \"description\": \"A personality is a set of characteristics and traits that define an individual's consistent patterns of thinking, feeling, and behaving. Personalities can be assessed through various models such as the Big Five, MBTI, and Dark Tetrad.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"openness\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"conscientiousness\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"extraversion\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"agreeableness\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"neuroticism\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"machiavellianism\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"narcissism\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"psychopathy\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"sadism\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"sloanKey\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 5,\r\n          \"provider\": \"org.cote.accountmanager.olio.PersonalityProvider\",\r\n          \"priority\": 10\r\n        },\r\n        {\r\n          \"name\": \"sloanCardinal\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 24,\r\n          \"provider\": \"org.cote.accountmanager.olio.PersonalityProvider\",\r\n          \"priority\": 10\r\n        },\r\n        {\r\n          \"name\": \"mbtiKey\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 24,\r\n          \"provider\": \"org.cote.accountmanager.olio.PersonalityProvider\",\r\n          \"priority\": 15\r\n        },\r\n        {\r\n          \"name\": \"darkTetradKey\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 4,\r\n          \"provider\": \"org.cote.accountmanager.olio.PersonalityProvider\",\r\n          \"priority\": 15\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.socialBehavior\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\",\r\n        \"common.alignment\"\r\n      ],\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"group\": \"SocialBehaviors\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Social Behavior\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"A social behavior is set of positive and negative traits.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"positive\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"participantModel\": \"trait.positive\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"negative\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"participantModel\": \"trait.negative\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.color\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.name\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Colors\",\r\n      \"icon\": \"palette\",\r\n      \"label\": \"Color\",\r\n      \"constraints\": [\r\n        \"name, groupId, organizationId\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.DirectoryFactory\",\r\n      \"query\": [\r\n        \"name\",\r\n        \"hex\",\r\n        \"groupId\"\r\n      ],\r\n      \"description\": \"Model used to store colors with various representations.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"hex\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 7,\r\n          \"description\": \"Hexadecimal color value\"\r\n        },\r\n        {\r\n          \"name\": \"code\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"red\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"green\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"blue\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"hue\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"saturation\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"lightness\",\r\n          \"type\": \"double\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.socialGroup\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\",\r\n        \"common.alignment\",\r\n        \"policy.score\"\r\n      ],\r\n      \"group\": \"SocialGroups\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Social Group\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"A social group is a set of positive and negative social behaviors\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"positive\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"identity.socialBehavior\",\r\n          \"participantModel\": \"behavior.positive\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"negative\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"identity.socialBehavior\",\r\n          \"participantModel\": \"behavior.negative\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.behavior\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"group\": \"Behaviors\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Behavior\",\r\n      \"description\": \"A behavior is a pattern of actions or reactions of an individual or group in response to external or internal stimuli. Behaviors can be influenced by various factors including environment, genetics, and social interactions.\",\r\n      \"dedicatedParticipation\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"rearing\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"education\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"indoctrination\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"herd\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"socialGroups\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"identity.socialGroup\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.profile\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.description\",\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"query\": [\r\n        \"id\",\r\n        \"objectId\",\r\n        \"groupId\",\r\n        \"portrait\",\r\n        \"voice\"\r\n      ],\r\n      \"description\": \"A profile is a collection of shareable information about a person, such as for use in composing UX displays or generating content titles.\",\r\n      \"icon\": \"person\",\r\n      \"label\": \"Profile\",\r\n      \"group\": \"Profiles\",\r\n      \"dedicatedParticipation\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"album\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.data\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"profile.album\"\r\n        },\r\n        {\r\n          \"name\": \"portrait\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.data\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"voice\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"identity.voice\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"contentTitle\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        },\r\n        {\r\n          \"name\": \"contentSubTitle\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        },\r\n        {\r\n          \"name\": \"pseudonym\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"common.vectorExt\",\r\n      \"inherits\": [\r\n        \"crypto.vaultExt\"\r\n      ],\r\n      \"abstract\": true,\r\n      \"query\": [],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"chunk\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"chunkCount\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"content\",\r\n          \"type\": \"string\",\r\n          \"provider\": \"org.cote.accountmanager.provider.EncryptFieldProvider\",\r\n          \"encrypt\": false\r\n        },\r\n        {\r\n          \"name\": \"embedding\",\r\n          \"type\": \"vector\",\r\n          \"maxLength\": 768\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.vectorModelStore\",\r\n      \"inherits\": [\r\n        \"common.objectId\",\r\n        \"common.dateTime\",\r\n        \"common.vectorExt\",\r\n        \"system.organizationExt\",\r\n        \"system.primaryKey\"\r\n      ],\r\n      \"query\": [\r\n        \"vectorReference\",\r\n        \"vectorReferenceType\",\r\n        \"chunk\",\r\n        \"chunkCount\"\r\n      ],\r\n      \"hints\": [\r\n        \"vectorReference, vectorReferenceType\"\r\n      ],\r\n      \"description\": \"A model store for embedding vectors for use with retrieval-augmented generation (RAG).\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"vectorReference\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"vectorReferenceType\",\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"read\": [\r\n                \"AccountUsers\"\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"name\": \"vectorReferenceType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"score\",\r\n          \"type\": \"double\",\r\n          \"ephemeral\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.vectorList\",\r\n      \"ephemeral\": true,\r\n      \"factory\": \"org.cote.accountmanager.factory.VectorListFactory\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"vectors\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.vectorModelStore\",\r\n          \"type\": \"list\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"data.vectorChunk\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"inherits\": [],\r\n      \"query\": [],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"chapter\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"chapterTitle\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"path\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"chunk\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"chunkCount\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"content\",\r\n          \"type\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.taskRequest\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"id\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.SystemTaskEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 10,\r\n          \"default\": \"UNKNOWN\"\r\n        },\r\n        {\r\n          \"name\": \"taskModel\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"taskModelType\",\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"read\": [\r\n                \"ApiUsers\"\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"name\": \"taskModelData\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"taskModelType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"data\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"dataType\",\r\n          \"access\": {\r\n            \"roles\": {\r\n              \"read\": [\r\n                \"ApiUsers\"\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"name\": \"dataType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"payload\",\r\n          \"type\": \"blob\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"system.taskResponse\",\r\n      \"inherits\": [\r\n        \"system.taskRequest\"\r\n      ],\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"responseType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ResponseEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 10,\r\n          \"default\": \"UNKNOWN\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"tool.plan\",\r\n      \"ioConstraints\": [\r\n        \"undefined\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"planQuery\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"planPromptConfigName\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"planChatName\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"executed\",\r\n          \"type\": \"boolean\",\r\n          \"default\": false\r\n        },\r\n        {\r\n          \"name\": \"steps\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"tool.planStep\"\r\n        },\r\n        {\r\n          \"name\": \"output\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"dev.parameter\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"tool.planStep\",\r\n      \"ioConstraints\": [\r\n        \"undefined\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.description\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"toolName\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"step\",\r\n          \"type\": \"int\",\r\n          \"default\": 0\r\n        },\r\n        {\r\n          \"name\": \"stepPromptConfigName\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"stepChatName\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"inputs\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"dev.parameter\"\r\n        },\r\n        {\r\n          \"name\": \"output\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"dev.parameter\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"identity.voice\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"identity.contactInformationExt\"\r\n      ],\r\n      \"icon\": \"volume_up\",\r\n      \"label\": \"Voice\",\r\n      \"group\": \"Voices\",\r\n      \"description\": \"Voice configuration information\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"engine\",\r\n          \"type\": \"string\",\r\n          \"default\": \"xtts\",\r\n          \"limit\": [\r\n            \"piper\",\r\n            \"xtts\"\r\n          ]\r\n        },\r\n        {\r\n          \"name\": \"speakerId\",\r\n          \"type\": \"int\",\r\n          \"default\": -1\r\n        },\r\n        {\r\n          \"name\": \"voiceSample\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.data\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"speaker\",\r\n          \"type\": \"string\",\r\n          \"default\": \"Unknown\",\r\n          \"limit\": [\r\n            \"Unknown\",\r\n            \"en_GB-alba-medium\"\r\n          ]\r\n        },\r\n        {\r\n          \"name\": \"speed\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0.1,\r\n          \"maxValue\": 4,\r\n          \"default\": 1.3\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.charPerson\",\r\n      \"inherits\": [\r\n        \"identity.person\",\r\n        \"common.alignment\"\r\n      ],\r\n      \"group\": \"Characters\",\r\n      \"icon\": \"face\",\r\n      \"label\": \"Character Person\",\r\n      \"dedicatedParticipation\": true,\r\n      \"factory\": \"org.cote.accountmanager.olio.CharPersonFactory\",\r\n      \"vector\": \"org.cote.accountmanager.olio.VectorProvider\",\r\n      \"query\": [\r\n        \"profile\"\r\n      ],\r\n      \"description\": \"A character person is a specific type of person that has attributes such as appearance, traits, and statistics. They can be involved in various interactions and actions within the system, and they may have specific roles or functions.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"eyeColor\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.color\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"hairColor\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.color\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"hairStyle\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"trades\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"traits\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"person.trait\"\r\n        },\r\n        {\r\n          \"name\": \"store\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.store\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"person.store\",\r\n          \"shortName\": \"sto\"\r\n        },\r\n        {\r\n          \"name\": \"statistics\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.statistics\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"sta\"\r\n        },\r\n        {\r\n          \"name\": \"instinct\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.instinct\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"inst\"\r\n        },\r\n        {\r\n          \"name\": \"narrative\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.narrative\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"state\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.state\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"st\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.instinct\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Instincts\",\r\n      \"icon\": \"category\",\r\n      \"description\": \"Instincts are innate behaviors or tendencies that guide the actions and reactions of characters or entities in the Olio universe. They can influence various aspects of behavior, such as survival, social interaction, and emotional responses.\",\r\n      \"label\": \"Instinct\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"sleep\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"fight\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"flight\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"hide\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"feed\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"drink\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"mate\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"herd\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"hygiene\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"cooperate\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"resist\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"adapt\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"laugh\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"cry\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"protect\",\r\n          \"type\": \"double\",\r\n          \"minValue\": -100,\r\n          \"maxValue\": 100,\r\n          \"validateRange\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.quality\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Qualities\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Quality\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"description\": \"This model represents the quality attributes of an item, including physical properties, adjustments, and various quality metrics. It is used to define how items behave in terms of their physical characteristics and performance in the game world.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"unit\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 6,\r\n          \"default\": \"us\",\r\n          \"description\": \"Default for US: dimensions in inches, weight in pounds\"\r\n        },\r\n        {\r\n          \"name\": \"valueAdjustment\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"width\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"height\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"weight\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"length\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"opacity\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"elasticity\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"glossiness\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"viscocity\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"sliminess\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"range\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 100000,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"smoothness\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"hardness\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"toughness\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"defensive\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"offensive\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"waterresistance\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"heatresistance\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"insulation\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"skill\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true,\r\n          \"description\": \"Skillfulness needed for full quality application\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.qualityExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"quality\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 100,\r\n          \"default\": 100,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"qualities\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.quality\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.priceExt\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"retailValue\",\r\n          \"type\": \"double\"\r\n        },\r\n        {\r\n          \"name\": \"resaleAdjustment\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true,\r\n          \"default\": 0.5\r\n        },\r\n        {\r\n          \"name\": \"value\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"validateRange\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.item\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.name\",\r\n        \"common.groupExt\",\r\n        \"data.tagsExt\",\r\n        \"common.baseLight\",\r\n        \"common.description\",\r\n        \"olio.qualityExt\",\r\n        \"olio.priceExt\"\r\n      ],\r\n      \"group\": \"Items\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Item\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\",\r\n        \"name\"\r\n      ],\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"An item is a physical object that can be used, traded, or interacted with in various ways. Items can have specific types, categories, and attributes that define their characteristics and uses. They may also include patterns, colors, and other traits that enhance their functionality or aesthetics.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 24\r\n        },\r\n        {\r\n          \"name\": \"category\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 24,\r\n          \"shortName\": \"cat\"\r\n        },\r\n        {\r\n          \"name\": \"quantity\",\r\n          \"type\": \"int\",\r\n          \"shortName\": \"quan\"\r\n        },\r\n        {\r\n          \"name\": \"pattern\",\r\n          \"baseModel\": \"data.data\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"color\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.color\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"complementColor\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.color\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"accentColor\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.color\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"age\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"inuse\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"materials\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"shortName\": \"mat\"\r\n        },\r\n        {\r\n          \"name\": \"perks\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"participantModel\": \"trait.perk\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"pks\"\r\n        },\r\n        {\r\n          \"name\": \"features\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"participantModel\": \"trait.feature\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"feat\"\r\n        },\r\n        {\r\n          \"name\": \"statistics\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.itemStatistics\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"stat\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.wearable\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"olio.item\"\r\n      ],\r\n      \"group\": \"Wearables\",\r\n      \"icon\": \"apparel\",\r\n      \"label\": \"Wearable\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"An article of clothing, including layer and placement.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"gender\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 6,\r\n          \"description\": \"Male, female, unisex\"\r\n        },\r\n        {\r\n          \"name\": \"fabric\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 24\r\n        },\r\n        {\r\n          \"name\": \"attachment\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 16,\r\n          \"description\": \"Worn, carried, etc\"\r\n        },\r\n        {\r\n          \"name\": \"size\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"level\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.WearLevelEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 16,\r\n          \"default\": \"NONE\"\r\n        },\r\n        {\r\n          \"name\": \"location\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"limit\": [\r\n            \"head\",\r\n            \"brow\",\r\n            \"hair\",\r\n            \"back\",\r\n            \"torso\",\r\n            \"chest\",\r\n            \"breast\",\r\n            \"foot\",\r\n            \"toe\",\r\n            \"ankle\",\r\n            \"thigh\",\r\n            \"leg\",\r\n            \"shin\",\r\n            \"wrist\",\r\n            \"hand\",\r\n            \"finger\",\r\n            \"arm\",\r\n            \"forearm\",\r\n            \"neck\",\r\n            \"groin\",\r\n            \"shoulder\",\r\n            \"bicep\",\r\n            \"tricep\",\r\n            \"upper arm\",\r\n            \"knee\",\r\n            \"elbow\",\r\n            \"face\",\r\n            \"nose\",\r\n            \"ear\",\r\n            \"eye\",\r\n            \"hip\",\r\n            \"waist\",\r\n            \"belly\",\r\n            \"lip\"\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.apparel\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.name\",\r\n        \"common.groupExt\",\r\n        \"common.description2K\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Apparel\",\r\n      \"icon\": \"styler\",\r\n      \"label\": \"Apparel\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\",\r\n        \"name\"\r\n      ],\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"Apparel is a set of wearable items designed to be worn by characters or entities. It can include various types of clothing, accessories, and other wearable items that enhance the appearance or functionality of the wearer.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"description\": \"The type this apparel is supposed to represent, such as a suit, casual outfit, etc\"\r\n        },\r\n        {\r\n          \"name\": \"category\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 24,\r\n          \"shortName\": \"cat\"\r\n        },\r\n        {\r\n          \"name\": \"gender\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 6,\r\n          \"description\": \"Male, female, unisex\"\r\n        },\r\n        {\r\n          \"name\": \"designer\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"manufacturer\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 127\r\n        },\r\n        {\r\n          \"name\": \"wearables\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.wearable\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"inuse\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"gallery\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.data\",\r\n          \"foreign\": true,\r\n          \"description\": \"Gallery of images for this apparel at different wear levels\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.event\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.parent\",\r\n        \"common.description\",\r\n        \"common.name\",\r\n        \"common.baseLight\",\r\n        \"common.alignment\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.factory.DirectoryFactory\",\r\n      \"group\": \"Olio Events\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Olio Event\",\r\n      \"dedicatedParticipation\": true,\r\n      \"constraints\": [\r\n        \"name, parentId, groupId, organizationId\"\r\n      ],\r\n      \"query\": [\r\n        \"name\",\r\n        \"id\",\r\n        \"objectId\",\r\n        \"ownerId\",\r\n        \"parentId\",\r\n        \"type\",\r\n        \"state\"\r\n      ],\r\n      \"description\": \"An event is a significant occurrence or happening within the Olio universe, which can involve various entities, interactions, and states. Events can have multiple participants, actors, and observers, and they may be influenced by various factors such as location, time, and preceding or subsequent events.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.EventEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"timeType\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.TimeEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"tt\"\r\n        },\r\n        {\r\n          \"name\": \"state\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ActionResultEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"st\"\r\n        },\r\n        {\r\n          \"name\": \"entryTraits\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"event.entryTrait\",\r\n          \"shortName\": \"et\"\r\n        },\r\n        {\r\n          \"name\": \"exitTraits\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"event.exitTrait\",\r\n          \"shortName\": \"xt\"\r\n        },\r\n        {\r\n          \"name\": \"actors\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"event.actor\",\r\n          \"shortName\": \"as\"\r\n        },\r\n        {\r\n          \"name\": \"participants\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"event.participant\",\r\n          \"shortName\": \"ps\"\r\n        },\r\n        {\r\n          \"name\": \"observers\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"event.observer\",\r\n          \"shortName\": \"os\"\r\n        },\r\n        {\r\n          \"name\": \"influencers\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"event.influencer\",\r\n          \"shortName\": \"is\"\r\n        },\r\n        {\r\n          \"name\": \"location\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.geoLocation\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"loc\"\r\n        },\r\n        {\r\n          \"name\": \"realm\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.realm\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"shortName\": \"rea\"\r\n        },\r\n        {\r\n          \"name\": \"interactions\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.interaction\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"actionResult.interaction\",\r\n          \"shortName\": \"ias\"\r\n        },\r\n        {\r\n          \"name\": \"eventStart\",\r\n          \"type\": \"zonetime\",\r\n          \"shortName\": \"es\"\r\n        },\r\n        {\r\n          \"name\": \"eventProgress\",\r\n          \"type\": \"zonetime\",\r\n          \"shortName\": \"ep\"\r\n        },\r\n        {\r\n          \"name\": \"inProgress\",\r\n          \"type\": \"boolean\",\r\n          \"shortName\": \"ip\"\r\n        },\r\n        {\r\n          \"name\": \"eventEnd\",\r\n          \"type\": \"zonetime\",\r\n          \"shortName\": \"ee\"\r\n        },\r\n        {\r\n          \"name\": \"precedingEvents\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.event\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"event.preceding\",\r\n          \"shortName\": \"pe\"\r\n        },\r\n        {\r\n          \"name\": \"subsequentEvents\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.event\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"event.subsequent\",\r\n          \"shortName\": \"se\"\r\n        },\r\n        {\r\n          \"name\": \"behavior\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"identity.behavior\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"be\"\r\n        },\r\n        {\r\n          \"name\": \"instinct\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.instinct\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"inst\"\r\n        },\r\n        {\r\n          \"name\": \"groups\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"event.group\",\r\n          \"shortName\": \"gps\"\r\n        },\r\n        {\r\n          \"name\": \"actions\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.actionResult\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"action.result\",\r\n          \"shortName\": \"acts\"\r\n        },\r\n        {\r\n          \"name\": \"epoch\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.statistics\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Statistics\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Character Statistics\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"description\": \"This model represents the statistical attributes of a character in a realm, including physical and mental attributes, derived statistics, and overall potential. It is used to define how characters perform in various aspects of the game world.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"physicalStrength\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"physicalEndurance\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"manualDexterity\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"agility\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"speed\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"mentalStrength\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"mentalEndurance\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"intelligence\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"wisdom\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"perception\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"creativity\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"spirituality\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"description\": \"Potential for both worldy and otherworldly empathy and awareness\"\r\n        },\r\n        {\r\n          \"name\": \"charisma\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"luck\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"athleticism\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"physicalStrength\",\r\n            \"physicalEndurance\",\r\n            \"agility\",\r\n            \"speed\",\r\n            \"mentalEndurance\"\r\n          ],\r\n          \"description\": \"Overall fitness and prowess\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 30\r\n        },\r\n        {\r\n          \"name\": \"magic\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"willpower\",\r\n            \"wisdom\",\r\n            \"creativity\",\r\n            \"spirituality\"\r\n          ],\r\n          \"description\": \"Potential for otherworldly perceptions and manipulations\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 30\r\n        },\r\n        {\r\n          \"name\": \"science\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"intelligence\",\r\n            \"wisdom\",\r\n            \"creativity\"\r\n          ],\r\n          \"description\": \"Propensity to innovate/discover/understand fundamental natural elements\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 30\r\n        },\r\n        {\r\n          \"name\": \"willpower\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"mentalEndurance\",\r\n            \"mentalStrength\"\r\n          ],\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 1\r\n        },\r\n        {\r\n          \"name\": \"reaction\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"agility\",\r\n            \"speed\",\r\n            \"wisdom\",\r\n            \"perception\"\r\n          ],\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 1\r\n        },\r\n        {\r\n          \"name\": \"save\",\r\n          \"type\": \"double\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"PERC20\",\r\n          \"fields\": [\r\n            \"physicalStrength\",\r\n            \"physicalEndurance\",\r\n            \"mentalStrength\",\r\n            \"mentalEndurance\",\r\n            \"charisma\"\r\n          ],\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"validateRange\": true,\r\n          \"priority\": 20\r\n        },\r\n        {\r\n          \"name\": \"potential\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 150,\r\n          \"description\": \"Available attribute points\",\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"health\",\r\n          \"type\": \"int\",\r\n          \"minValue\": -1,\r\n          \"maxValue\": 20,\r\n          \"default\": -1,\r\n          \"description\": \"Note: This is duplicated with state.health because it's tied to the save calculation\",\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"maximumHealth\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"physicalStrength\",\r\n            \"physicalEndurance\",\r\n            \"mentalStrength\",\r\n            \"mentalEndurance\",\r\n            \"charisma\"\r\n          ],\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 10\r\n        },\r\n        {\r\n          \"name\": \"physicalAppearance\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"physicalStrength\",\r\n            \"agility\",\r\n            \"maximumHealth\"\r\n          ],\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 15\r\n        },\r\n        {\r\n          \"name\": \"mentalHealth\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"willpower\",\r\n            \"spirituality\"\r\n          ],\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 15\r\n        },\r\n        {\r\n          \"name\": \"wit\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"intelligence\",\r\n            \"creativity\"\r\n          ],\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 15\r\n        },\r\n        {\r\n          \"name\": \"charm\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"charisma\",\r\n            \"wit\"\r\n          ],\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 20\r\n        },\r\n        {\r\n          \"name\": \"beauty\",\r\n          \"type\": \"int\",\r\n          \"virtual\": true,\r\n          \"provider\": \"org.cote.accountmanager.provider.ComputeProvider\",\r\n          \"compute\": \"AVG\",\r\n          \"fields\": [\r\n            \"physicalAppearance\",\r\n            \"charm\",\r\n            \"manualDexterity\",\r\n            \"mentalHealth\",\r\n            \"perception\"\r\n          ],\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"priority\": 25\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.state\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"States\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"State\",\r\n      \"dedicatedParticipation\": true,\r\n      \"query\": [\r\n        \"groupId\",\r\n        \"organizationId\"\r\n      ],\r\n      \"description\": \"This model represents the state of an entity in a realm, including its current event, location, actions, and various status flags. It is used to track the condition and activities of entities such as players or NPCs within the game world.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"currentEvent\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.event\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"currentLocation\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.geoLocation\",\r\n          \"foreign\": true,\r\n          \"followReference\": true\r\n        },\r\n        {\r\n          \"name\": \"actions\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.actionResult\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"alive\",\r\n          \"type\": \"boolean\",\r\n          \"default\": true\r\n        },\r\n        {\r\n          \"name\": \"awake\",\r\n          \"type\": \"boolean\",\r\n          \"default\": true\r\n        },\r\n        {\r\n          \"name\": \"agitated\",\r\n          \"type\": \"boolean\",\r\n          \"description\": \"Bit indicating that the state was intentionally agitated\"\r\n        },\r\n        {\r\n          \"name\": \"immobilized\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"incapacitated\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"disabled\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"currentEast\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Meters from the western grid line of the currentLocation\",\r\n          \"default\": -1\r\n        },\r\n        {\r\n          \"name\": \"currentNorth\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Meters from the northern grid line of the currentLocation\",\r\n          \"default\": -1\r\n        },\r\n        {\r\n          \"name\": \"health\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"description\": \"Percentage of health remaining\",\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"energy\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"description\": \"Percentage of energy remaining\",\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"schedules\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.schedule\",\r\n          \"participantModel\": \"state.schedule\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.action\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\",\r\n        \"common.alignment\"\r\n      ],\r\n      \"group\": \"Actions\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Action\",\r\n      \"description\": \"An action that can be performed by a character or entity, which may have various effects on their attributes, skills, and states.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"provider\",\r\n          \"type\": \"string\",\r\n          \"description\": \"Class or script name used to perform a discrete execution of the action\"\r\n        },\r\n        {\r\n          \"name\": \"difficulty\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true,\r\n          \"shortName\": \"hard\"\r\n        },\r\n        {\r\n          \"name\": \"minimumTime\",\r\n          \"type\": \"int\",\r\n          \"minValue\": -1,\r\n          \"description\": \"Minimum amount of seconds required to perform the action\",\r\n          \"shortName\": \"mint\"\r\n        },\r\n        {\r\n          \"name\": \"maximumTime\",\r\n          \"type\": \"int\",\r\n          \"minValue\": -1,\r\n          \"description\": \"Maximum amount of seconds to perform the action before becoming counter-productive or futile\",\r\n          \"shortName\": \"maxt\"\r\n        },\r\n        {\r\n          \"name\": \"minimumEnergyCost\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1,\r\n          \"description\": \"Minimum amount of energy required to perform the action, expressed as a percentage of maximum available energy\",\r\n          \"validateRange\": true,\r\n          \"shortName\": \"mine\"\r\n        },\r\n        {\r\n          \"name\": \"positiveStatistics\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"limit\": [\r\n            \"physicalStrength\",\r\n            \"physicalEndurance\",\r\n            \"manualDexterity\",\r\n            \"agility\",\r\n            \"speed\",\r\n            \"mentalStrength\",\r\n            \"mentalEndurance\",\r\n            \"intelligence\",\r\n            \"wisdom\",\r\n            \"charisma\",\r\n            \"creativity\",\r\n            \"spirituality\",\r\n            \"science\",\r\n            \"reaction\",\r\n            \"save\",\r\n            \"magic\",\r\n            \"maximumHealth\"\r\n          ],\r\n          \"shortName\": \"psta\"\r\n        },\r\n        {\r\n          \"name\": \"negativeStatistics\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"limit\": [\r\n            \"physicalStrength\",\r\n            \"physicalEndurance\",\r\n            \"manualDexterity\",\r\n            \"agility\",\r\n            \"speed\",\r\n            \"mentalStrength\",\r\n            \"mentalEndurance\",\r\n            \"intelligence\",\r\n            \"wisdom\",\r\n            \"charisma\",\r\n            \"creativity\",\r\n            \"spirituality\",\r\n            \"science\",\r\n            \"reaction\",\r\n            \"save\",\r\n            \"magic\",\r\n            \"maximumHealth\"\r\n          ],\r\n          \"shortName\": \"nsta\"\r\n        },\r\n        {\r\n          \"name\": \"positivePersonality\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"limit\": [\r\n            \"open\",\r\n            \"conscientious\",\r\n            \"extraverted\",\r\n            \"agreeable\",\r\n            \"neurotic\"\r\n          ],\r\n          \"shortName\": \"pper\"\r\n        },\r\n        {\r\n          \"name\": \"negativePersonality\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"limit\": [\r\n            \"open\",\r\n            \"conscientious\",\r\n            \"extraverted\",\r\n            \"agreeable\",\r\n            \"neurotic\"\r\n          ],\r\n          \"shortName\": \"nper\"\r\n        },\r\n        {\r\n          \"name\": \"positiveStates\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"limit\": [\r\n            \"health\",\r\n            \"energy\"\r\n          ],\r\n          \"shortName\": \"pst\"\r\n        },\r\n        {\r\n          \"name\": \"negativeStates\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"limit\": [\r\n            \"health\",\r\n            \"energy\"\r\n          ],\r\n          \"shortName\": \"nst\"\r\n        },\r\n        {\r\n          \"name\": \"positiveInstincts\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"limit\": [\r\n            \"sleep\",\r\n            \"fight\",\r\n            \"flight\",\r\n            \"feed\",\r\n            \"drink\",\r\n            \"mate\",\r\n            \"herd\",\r\n            \"hygiene\",\r\n            \"cooperate\",\r\n            \"resist\",\r\n            \"adapt\",\r\n            \"laugh\",\r\n            \"cry\",\r\n            \"protect\"\r\n          ],\r\n          \"shortName\": \"pi\"\r\n        },\r\n        {\r\n          \"name\": \"negativeInstincts\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"limit\": [\r\n            \"sleep\",\r\n            \"fight\",\r\n            \"flight\",\r\n            \"feed\",\r\n            \"drink\",\r\n            \"mate\",\r\n            \"herd\",\r\n            \"hygiene\",\r\n            \"cooperate\",\r\n            \"resist\",\r\n            \"adapt\",\r\n            \"laugh\",\r\n            \"cry\",\r\n            \"protect\"\r\n          ],\r\n          \"shortName\": \"ni\"\r\n        },\r\n        {\r\n          \"name\": \"counterActions\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"shortName\": \"ca\"\r\n        },\r\n        {\r\n          \"name\": \"requiredSkills\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"rs\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.actionResult\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\",\r\n        \"common.alignment\"\r\n      ],\r\n      \"group\": \"Action Results\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Action Result\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"An action result is a record of the outcome of an action performed by an actor, which may include various attributes, statistics, and states that are affected by the action. It can also include interactions with other entities and dependent actions.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"action\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.action\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"builder\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.builder\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"counterAction\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.action\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"parameters\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.actionParameters\",\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ActionResultEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"actorType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"actt\"\r\n        },\r\n        {\r\n          \"name\": \"actor\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"actorType\",\r\n          \"shortName\": \"act\"\r\n        },\r\n        {\r\n          \"name\": \"delegateType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"delt\"\r\n        },\r\n        {\r\n          \"name\": \"delegate\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"delegateType\",\r\n          \"shortName\": \"del\"\r\n        },\r\n        {\r\n          \"name\": \"outcome\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.OutcomeEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"equilibrium\",\r\n          \"shortName\": \"out\"\r\n        },\r\n        {\r\n          \"name\": \"need\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"description\": \"Placeholder for the name of a need the action satisfies\"\r\n        },\r\n        {\r\n          \"name\": \"needType\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.AssessmentEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"description\": \"Placeholder for the type need the action satisfies\"\r\n        },\r\n        {\r\n          \"name\": \"store\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.store\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"actionStart\",\r\n          \"type\": \"zonetime\"\r\n        },\r\n        {\r\n          \"name\": \"actionProgress\",\r\n          \"type\": \"zonetime\"\r\n        },\r\n        {\r\n          \"name\": \"actionEnd\",\r\n          \"type\": \"zonetime\"\r\n        },\r\n        {\r\n          \"name\": \"statistics\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.statistics\",\r\n          \"description\": \"Statistics modifiers from this action\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"state\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.state\",\r\n          \"description\": \"State modifiers from this action\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"instinct\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.instinct\",\r\n          \"description\": \"Instinct modifiers from this action\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"personality\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"identity.personality\",\r\n          \"description\": \"Personality modifiers from this action\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"dependentActions\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.actionResult\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"participantModel\": \"actionResult.actionResult\",\r\n          \"shortName\": \"das\"\r\n        },\r\n        {\r\n          \"name\": \"interactions\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.interaction\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"actionResult.interaction\",\r\n          \"shortName\": \"ias\"\r\n        },\r\n        {\r\n          \"name\": \"results\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"trace\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.actionParameters\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"actionName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"itemName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"itemCategory\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"itemModel\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64,\r\n          \"default\": \"olio.item\"\r\n        },\r\n        {\r\n          \"name\": \"direction\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.DirectionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"wearLevel\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.WearLevelEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"narrate\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"autoComplete\",\r\n          \"type\": \"boolean\",\r\n          \"description\": \"In an action is interrupted for some reason, and then the same action attempted again, setting autoComplete to true will conclude the incomplete action.  Otherwise, if false the new action won't start until the prior action is completed.\"\r\n        },\r\n        {\r\n          \"name\": \"duration\",\r\n          \"type\": \"int\",\r\n          \"default\": 0,\r\n          \"description\": \"Number of seconds to perform a timed action.\"\r\n        },\r\n        {\r\n          \"name\": \"quantity\",\r\n          \"type\": \"int\",\r\n          \"default\": 0,\r\n          \"description\": \"Placeholder of quantity to be used in conduct of the action.\"\r\n        },\r\n        {\r\n          \"name\": \"distance\",\r\n          \"type\": \"double\",\r\n          \"default\": 0\r\n        },\r\n        {\r\n          \"name\": \"needName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"needType\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.AssessmentEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"UNKNOWN\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.schedule\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\",\r\n        \"common.reference\"\r\n      ],\r\n      \"group\": \"Schedules\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Schedule\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"This model represents a schedule for recurring events or actions within a realm. It includes details about the schedule's timing, recurrence, and associated actions. Schedules can be used to automate tasks or manage events that occur at specific times or intervals.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"beginDate\",\r\n          \"type\": \"timestamp\"\r\n        },\r\n        {\r\n          \"name\": \"endDate\",\r\n          \"type\": \"timestamp\"\r\n        },\r\n        {\r\n          \"name\": \"completedDate\",\r\n          \"type\": \"timestamp\",\r\n          \"description\": \"Time when the schedule was last completed\"\r\n        },\r\n        {\r\n          \"name\": \"reoccurs\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"reoccurence\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.TimeEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"reoccurenceInterval\",\r\n          \"type\": \"int\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"dayOfWeek\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 7,\r\n          \"description\": \"For reoccuring - Day of the week the schedule applies\",\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"secondOfDay\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 86400,\r\n          \"description\": \"For reoccuring - Second of the day the schedule applies\",\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"duration\",\r\n          \"type\": \"int\",\r\n          \"minValue\": -1,\r\n          \"description\": \"For reoccuring - number of seconds the schedule lasts\",\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"schedules\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"$self\",\r\n          \"type\": \"list\",\r\n          \"foreign\": true,\r\n          \"followReference\": false,\r\n          \"participantModel\": \"schedule.child\"\r\n        },\r\n        {\r\n          \"name\": \"actions\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.action\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.inventoryEntry\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Inventory Entries\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Inventory Entry\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"An inventory entry represents a specific item or apparel in the inventory system. It includes details such as quantity, age, usage status, and the associated item or apparel model.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"quantity\",\r\n          \"type\": \"int\",\r\n          \"shortName\": \"quan\"\r\n        },\r\n        {\r\n          \"name\": \"age\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"inuse\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"item\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.item\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"apparel\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.apparel\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.store\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Stores\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Store\",\r\n      \"dedicatedParticipation\": true,\r\n      \"sortField\": \"name\",\r\n      \"sortOrder\": \"ASCENDING\",\r\n      \"description\": \"This model represents a store in a realm, which can be a physical or virtual place where items, apparel, and other goods are sold or stored. It includes details about the store's name, inventory, items, apparel, and locations associated with the store.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        },\r\n        {\r\n          \"name\": \"inventory\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.inventoryEntry\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"store.entry\",\r\n          \"description\": \"Inventory is meant to hold item references, particularly renewable or consumable items versus continually used items.  For example, an item in a merchant's or manufacturer's inventory entry versus an item that someone owns, and makes use of. At present, it is an abstract duplicate of what may be in the items or apparel or wearable lists, and may ultimately replace those.\"\r\n        },\r\n        {\r\n          \"name\": \"items\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.item\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"store.item\",\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"apparel\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.apparel\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"store.apparel\"\r\n        },\r\n        {\r\n          \"name\": \"locations\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.geoLocation\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"store.location\",\r\n          \"description\": \"Locations that belong to this store - eg: locations a person owns, etc\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.builder\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.name\",\r\n        \"common.groupExt\",\r\n        \"data.tagsExt\",\r\n        \"common.baseLight\",\r\n        \"common.description\",\r\n        \"olio.qualityExt\",\r\n        \"olio.priceExt\"\r\n      ],\r\n      \"group\": \"Builders\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Builder\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\",\r\n        \"name\",\r\n        \"tags\"\r\n      ],\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"A builder is an entity that can create or produce items, apparel, or other objects using various materials and skills. Builders can have specific types, schedules, and renewable capabilities, and they may require certain materials and skills to perform their tasks.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.BuilderEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"unknown\"\r\n        },\r\n        {\r\n          \"name\": \"time\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Time in minutes to build this object with mean skill level\"\r\n        },\r\n        {\r\n          \"name\": \"schedule\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.schedule\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"buildable.schedule\",\r\n          \"description\": \"Schedule to use for reoccuring builders\",\r\n          \"shortName\": \"sch\"\r\n        },\r\n        {\r\n          \"name\": \"store\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.store\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"buildable.store\",\r\n          \"description\": \"Store where a produced item will be placed\",\r\n          \"shortName\": \"sto\"\r\n        },\r\n        {\r\n          \"name\": \"renewable\",\r\n          \"type\": \"boolean\",\r\n          \"shortName\": \"ren\"\r\n        },\r\n        {\r\n          \"name\": \"materials\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.item\",\r\n          \"participantModel\": \"builder.material\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"mat\"\r\n        },\r\n        {\r\n          \"name\": \"apparel\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.apparel\",\r\n          \"description\": \"Templates to use when building out apparel/wearables\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"app\"\r\n        },\r\n        {\r\n          \"name\": \"item\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.item\",\r\n          \"description\": \"Templates to use when building out items\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"skills\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.builder\",\r\n          \"participantModel\": \"builder.builder\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"sk\"\r\n        },\r\n        {\r\n          \"name\": \"perks\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"participantModel\": \"builder.perk\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"pks\"\r\n        },\r\n        {\r\n          \"name\": \"features\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"participantModel\": \"builder.feature\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"feat\"\r\n        },\r\n        {\r\n          \"name\": \"terrain\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"description\": \"Terrain limitations for a particular build.  E.G.: Can't build an igloo in a desert\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.itemStatistics\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Statistics\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Item Statistics\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"description\": \"Item statistics represent various attributes of an item that can affect its performance, usability, and interaction within the Olio universe. These statistics include damage, protection, entrapment capabilities, range, and consumption/replenishment characteristics.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"damage\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"protection\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"entrapment\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"maxValue\": 20,\r\n          \"validateRange\": true\r\n        },\r\n        {\r\n          \"name\": \"range\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Range in meters\"\r\n        },\r\n        {\r\n          \"name\": \"consumptionType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 16,\r\n          \"description\": \"General indicator that the item passively or actively consumes some other item or resource.  It's up to the implementation rule to determine how.\"\r\n        },\r\n        {\r\n          \"name\": \"consumption\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"description\": \"General indicator of how much of the consumptionType is consumed.  It's up to the implementation rule to determine how.\"\r\n        },\r\n        {\r\n          \"name\": \"replenishmentType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 16,\r\n          \"description\": \"General indicator that the item passively or actively replenishes some other item or resource.  It's up to the implementation rule to determine how.\"\r\n        },\r\n        {\r\n          \"name\": \"replenishment\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 0,\r\n          \"description\": \"General indicator of how much of the replenishmentType is replenished.  It's up to the implementation rule to determine how.\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.animal\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.name\",\r\n        \"common.groupExt\",\r\n        \"data.tagsExt\",\r\n        \"common.baseLight\",\r\n        \"common.description\",\r\n        \"common.alignment\"\r\n      ],\r\n      \"group\": \"Animals\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Animal\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\",\r\n        \"name\"\r\n      ],\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"An animal is a living entity that can be interacted with in various ways, such as being tamed, trained, or used for various purposes. Animals can have traits, statistics, and states that define their behavior and capabilities.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"type\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 24\r\n        },\r\n        {\r\n          \"name\": \"category\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 24,\r\n          \"shortName\": \"cat\"\r\n        },\r\n        {\r\n          \"name\": \"groupName\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 24,\r\n          \"shortName\": \"grpn\"\r\n        },\r\n        {\r\n          \"name\": \"habitat\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"age\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"gender\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 10\r\n        },\r\n        {\r\n          \"name\": \"traits\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.trait\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"person.trait\"\r\n        },\r\n        {\r\n          \"name\": \"store\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.store\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"animal.store\",\r\n          \"shortName\": \"sto\"\r\n        },\r\n        {\r\n          \"name\": \"statistics\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.statistics\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"sta\"\r\n        },\r\n        {\r\n          \"name\": \"instinct\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.instinct\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"inst\"\r\n        },\r\n        {\r\n          \"name\": \"state\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.state\",\r\n          \"foreign\": true,\r\n          \"shortName\": \"st\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.realm\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\"\r\n      ],\r\n      \"group\": \"Realms\",\r\n      \"icon\": \"note\",\r\n      \"label\": \"Realm\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"This model represents a realm, which is a collection of communities and their associated data. It includes information about the realm's population, groups, locations, and other relevant details.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"population\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"populationGroups\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"community.group\"\r\n        },\r\n        {\r\n          \"name\": \"principalGroup\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"foreign\": true,\r\n          \"description\": \"Placeholder for a primary group (aka: party or band)\"\r\n        },\r\n        {\r\n          \"name\": \"leadershipGroup\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"foreign\": true,\r\n          \"description\": \"Placeholder for any leadership group\"\r\n        },\r\n        {\r\n          \"name\": \"origin\",\r\n          \"baseModel\": \"data.geoLocation\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"community.origin\"\r\n        },\r\n        {\r\n          \"name\": \"currentEpoch\",\r\n          \"baseModel\": \"olio.event\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"currentEvent\",\r\n          \"baseModel\": \"olio.event\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"currentIncrement\",\r\n          \"baseModel\": \"olio.event\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"locations\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.geoLocation\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"community.location\"\r\n        },\r\n        {\r\n          \"name\": \"zoo\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.animal\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"community.animal\"\r\n        },\r\n        {\r\n          \"name\": \"currencies\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.item\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"community.currency\"\r\n        },\r\n        {\r\n          \"name\": \"schedules\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.schedule\",\r\n          \"participantModel\": \"community.schedule\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"store\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.store\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"person.store\",\r\n          \"shortName\": \"sto\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.interaction\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"Interactions\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Interaction\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"description\": \"Track interactions between an individual actor and individual interactor.  Interaction outcomes are defined as favorable, equilibrium, or unfavorable for the actor and interactor.  The context is determined elsewhere, such as at the event or actionResult level.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"description\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128,\r\n          \"shortName\": \"dsc\"\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.InteractionEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"unknown\",\r\n          \"shortName\": \"intt\"\r\n        },\r\n        {\r\n          \"name\": \"state\",\r\n          \"baseClass\": \"org.cote.accountmanager.schema.type.ActionResultEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"unknown\",\r\n          \"shortName\": \"acts\"\r\n        },\r\n        {\r\n          \"name\": \"interactionStart\",\r\n          \"type\": \"zonetime\",\r\n          \"shortName\": \"is\"\r\n        },\r\n        {\r\n          \"name\": \"interactionEnd\",\r\n          \"type\": \"zonetime\",\r\n          \"shortName\": \"ie\"\r\n        },\r\n        {\r\n          \"name\": \"actorType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"actt\"\r\n        },\r\n        {\r\n          \"name\": \"actor\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"actorType\",\r\n          \"shortName\": \"act\"\r\n        },\r\n        {\r\n          \"name\": \"actorClaim\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128,\r\n          \"shortName\": \"acla\",\r\n          \"description\": \"Textual statement representing the actor's immediate position of the interaction.\"\r\n        },\r\n        {\r\n          \"name\": \"actorInstinct\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"ainst\",\r\n          \"description\": \"Name of any primary instinct driving the interaction.\"\r\n        },\r\n        {\r\n          \"name\": \"actorPersonality\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"aper\",\r\n          \"description\": \"Name of any primary personality trait driving the interaction.\"\r\n        },\r\n        {\r\n          \"name\": \"actorStatistic\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"asta\",\r\n          \"description\": \"Name of any primary statistic driving the interaction.\"\r\n        },\r\n        {\r\n          \"name\": \"actorRoleSuggestion\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"actorRole\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.CharacterRoleEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"unknown\",\r\n          \"shortName\": \"actr\"\r\n        },\r\n        {\r\n          \"name\": \"actorReasonSuggestion\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"actorReason\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.ReasonEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"unknown\",\r\n          \"shortName\": \"actrr\"\r\n        },\r\n        {\r\n          \"name\": \"actorAlignmentSuggestion\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"actorAlignment\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.AlignmentEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"unknown\",\r\n          \"shortName\": \"acta\"\r\n        },\r\n        {\r\n          \"name\": \"actorOutcome\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.OutcomeEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"equilibrium\",\r\n          \"shortName\": \"acto\"\r\n        },\r\n        {\r\n          \"name\": \"actorThreatSuggestion\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"actorThreat\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.ThreatEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"none\",\r\n          \"shortName\": \"actth\"\r\n        },\r\n        {\r\n          \"name\": \"interactorType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"iactt\"\r\n        },\r\n        {\r\n          \"name\": \"interactor\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"interactorType\",\r\n          \"shortName\": \"iact\"\r\n        },\r\n        {\r\n          \"name\": \"interactorClaim\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128,\r\n          \"shortName\": \"icla\",\r\n          \"description\": \"Textual statement representing the interactor's immediate position of the interaction.\"\r\n        },\r\n        {\r\n          \"name\": \"interactorInstinct\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"iinst\",\r\n          \"description\": \"Name of any primary instinct driving the interaction.\"\r\n        },\r\n        {\r\n          \"name\": \"interactorPersonality\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"iper\",\r\n          \"description\": \"Name of any primary personality trait driving the interaction.\"\r\n        },\r\n        {\r\n          \"name\": \"interactorStatistic\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"ista\",\r\n          \"description\": \"Name of any primary statistic driving the interaction.\"\r\n        },\r\n        {\r\n          \"name\": \"interactorRoleSuggestion\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"interactorRole\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.CharacterRoleEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"iactr\"\r\n        },\r\n        {\r\n          \"name\": \"interactorReason\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.ReasonEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"unknown\",\r\n          \"shortName\": \"iactrr\"\r\n        },\r\n        {\r\n          \"name\": \"interactorReasonSuggestion\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"interactorAlignmentSuggestion\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"interactorAlignment\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.AlignmentEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"shortName\": \"iacta\"\r\n        },\r\n        {\r\n          \"name\": \"interactorOutcome\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.OutcomeEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"equilibrium\",\r\n          \"shortName\": \"iacto\"\r\n        },\r\n        {\r\n          \"name\": \"interactorThreatSuggestion\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"interactorThreat\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.ThreatEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"none\",\r\n          \"shortName\": \"iactth\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.narrative\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"icon\": \"category\",\r\n      \"label\": \"Narrative\",\r\n      \"group\": \"Narratives\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"A narrative is a structured story or account that includes various elements such as characters, scenes, interactions, and descriptions. It can be used to create immersive experiences in games or simulations, providing detailed backgrounds and contexts for characters and events.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"fullName\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"sceneDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"interactionDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"physicalDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"outfitDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"armamentDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"statisticsDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"alignmentDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"darkTetradDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"mbtiDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"sloanDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"sdPrompt\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"sdNegativePrompt\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"images\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"data.data\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"narrative.image\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.chatConfig\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\",\r\n        \"common.alignment\",\r\n        \"crypto.vaultExt\"\r\n      ],\r\n      \"group\": \"Chat\",\r\n      \"icon\": \"chat\",\r\n      \"label\": \"Chat Configuration\",\r\n      \"description\": \"Configuration for a chat session with an LLM (Large Language Model). This includes settings for characters, narratives, interactions, and various options to control the chat experience.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"rating\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.llm.ESRBEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 3,\r\n          \"default\": \"E\"\r\n        },\r\n        {\r\n          \"name\": \"serviceType\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.llm.LLMServiceEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 10,\r\n          \"default\": \"OPENAI\"\r\n        },\r\n        {\r\n          \"name\": \"systemCharacter\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"systemNarrative\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.narrative\"\r\n        },\r\n        {\r\n          \"name\": \"userCharacter\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"userNarrative\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.narrative\"\r\n        },\r\n        {\r\n          \"name\": \"interactions\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.interaction\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"chatConfig.interaction\",\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"interaction\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.interaction\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"event\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.event\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"useNLP\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"stream\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"nlpCommand\",\r\n          \"type\": \"string\",\r\n          \"description\": \"Brief phrase (not a complete sentence) of what to reinfore through NLP during a chat conversation\"\r\n        },\r\n        {\r\n          \"name\": \"useJailBreak\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"prune\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"scene\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"terrain\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"populationDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"animalDescription\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"includeScene\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"setting\",\r\n          \"type\": \"string\",\r\n          \"default\": \"random\"\r\n        },\r\n        {\r\n          \"name\": \"model\",\r\n          \"type\": \"string\",\r\n          \"default\": \"dolphin-llama3\"\r\n        },\r\n        {\r\n          \"name\": \"analyzeModel\",\r\n          \"type\": \"string\",\r\n          \"default\": \"dolphin-llama3\"\r\n        },\r\n        {\r\n          \"name\": \"userPrompt\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"universeName\",\r\n          \"type\": \"string\",\r\n          \"description\": \"Name of any olio universe related to the characters or interactions.\"\r\n        },\r\n        {\r\n          \"name\": \"worldName\",\r\n          \"type\": \"string\",\r\n          \"description\": \"Name of any olio world related to the characters or interactions.\"\r\n        },\r\n        {\r\n          \"name\": \"startMode\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": \"16\",\r\n          \"description\": \"Variant used to control how a chat begins\",\r\n          \"limit\": [\r\n            \"user\",\r\n            \"system\",\r\n            \"none\"\r\n          ],\r\n          \"default\": \"none\"\r\n        },\r\n        {\r\n          \"name\": \"episodes\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.episode\"\r\n        },\r\n        {\r\n          \"name\": \"chatOptions\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.chatOptions\"\r\n        },\r\n        {\r\n          \"name\": \"apiVersion\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"serverUrl\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 512,\r\n          \"default\": \"http://localhost:11434\"\r\n        },\r\n        {\r\n          \"name\": \"apiKey\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 256,\r\n          \"provider\": \"org.cote.accountmanager.provider.EncryptFieldProvider\",\r\n          \"encrypt\": true\r\n        },\r\n        {\r\n          \"name\": \"assist\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"remindEvery\",\r\n          \"type\": \"int\",\r\n          \"default\": 6,\r\n          \"description\": \"When assist is true, the number of user messages before any reminder text is included in the conversation history\"\r\n        },\r\n        {\r\n          \"name\": \"keyframeEvery\",\r\n          \"type\": \"int\",\r\n          \"default\": 0,\r\n          \"description\": \"When assist is true and prune is true, the number of messages after any previous keyframe or after the beginning of the message history before conducting a conversation analysis.  This is intended to be an objective summary of the conversation to preserve context and important details\"\r\n        },\r\n        {\r\n          \"name\": \"messageTrim\",\r\n          \"type\": \"int\",\r\n          \"default\": 20,\r\n          \"description\": \"When prune is true, sets the size of the message history to include in each request. messageTrim and keyframeEvery should be the same size when used in conjunction.  Note: The entire conversation is always preserved and may be used for summarization and analysis, this only affects the number of messages to include when using the chat capability.\"\r\n        },\r\n    {\r\n          \"name\": \"policy\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"policy.policy\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.promptConfig\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\",\r\n        \"common.alignment\"\r\n      ],\r\n      \"group\": \"Chat\",\r\n      \"icon\": \"chat\",\r\n      \"label\": \"Prompt Configuration\",\r\n      \"description\": \"Configuration for prompts used in chat sessions with an LLM (Large Language Model). This includes system prompts, user prompts, and various settings to control the chat experience.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"system\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"systemCensorWarning\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"systemNlp\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"systemSDPrompt\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"systemNarrate\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"systemAnalyze\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"assistant\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"assistantAnalyze\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"assistantNarrate\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"assistantNlp\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"assistantCensorWarning\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"assistantReminder\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"user\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"userReminder\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"userAnalyze\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"userCitation\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"userNarrate\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"userReduce\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"jailBreak\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"scene\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"setting\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"userConsentPrefix\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"userConsentRating\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"userConsentNlp\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"femalePerspective\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"malePerspective\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"races\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.promptRaceConfig\"\r\n        },\r\n        {\r\n          \"name\": \"outfit\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"userOutfit\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"assistantOutfit\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"episodeRule\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.promptRaceConfig\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"raceType\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.RaceEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 2,\r\n          \"default\": \"E\"\r\n        },\r\n        {\r\n          \"name\": \"race\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.pointOfInterest\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\"\r\n      ],\r\n      \"group\": \"POIs\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Point of Interest\",\r\n      \"dedicatedParticipation\": true,\r\n      \"sortField\": \"name\",\r\n      \"sortOrder\": \"ASCENDING\",\r\n      \"query\": [\r\n        \"location\",\r\n        \"groupId\",\r\n        \"organizationId\"\r\n      ],\r\n      \"description\": \"This model represents a point of interest in a realm, such as a building, landmark, or other significant location. It includes details about the point's name, type, location, and associated store or builder.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        },\r\n        {\r\n          \"name\": \"description\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 256\r\n        },\r\n        {\r\n          \"name\": \"type\",\r\n          \"baseClass\": \"org.cote.accountmanager.olio.PointOfInterestEnumType\",\r\n          \"type\": \"enum\",\r\n          \"maxLength\": 32,\r\n          \"default\": \"unknown\"\r\n        },\r\n        {\r\n          \"name\": \"concealed\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"location\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.geoLocation\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"store\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.store\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"poi.store\",\r\n          \"shortName\": \"sto\"\r\n        },\r\n        {\r\n          \"name\": \"builder\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.builder\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"poi.build\",\r\n          \"shortName\": \"bld\"\r\n        },\r\n        {\r\n          \"name\": \"east\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Meters from the western grid line of the location\",\r\n          \"default\": -1\r\n        },\r\n        {\r\n          \"name\": \"north\",\r\n          \"type\": \"int\",\r\n          \"description\": \"Meters from the northern grid line of the location\",\r\n          \"default\": -1\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.world\",\r\n      \"inherits\": [\r\n        \"data.directory\",\r\n        \"common.description\"\r\n      ],\r\n      \"factory\": \"org.cote.accountmanager.olio.WorldFactory\",\r\n      \"group\": \"Worlds\",\r\n      \"icon\": \"note\",\r\n      \"label\": \"World\",\r\n      \"description\": \"Collection of groups used to represent a world.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"population\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"locations\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"addresses\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"contacts\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"features\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"events\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"words\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"names\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"surnames\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"occupations\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"dictionary\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"traits\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"colors\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"patterns\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"apparel\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"wearables\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"qualities\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"statistics\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"instincts\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"behaviors\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"states\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"personalities\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"basis\",\r\n          \"baseModel\": \"olio.world\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"schedules\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"actions\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"actionResults\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"builders\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"stores\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"inventories\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"interactions\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"items\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"animals\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"gallery\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"narratives\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"tagsGroup\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"description\": \"Using an alternate name so as not to conflict with the existing 'tags' property\"\r\n        },\r\n        {\r\n          \"name\": \"realmsGroup\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"profiles\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"pointsOfInterest\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"auth.group\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"realms\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.realm\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.episode\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"theme\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 128\r\n        },\r\n        {\r\n          \"name\": \"name\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"completed\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"summary\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"episodeAssist\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"number\",\r\n          \"type\": \"int\",\r\n          \"default\": 0\r\n        },\r\n        {\r\n          \"name\": \"stages\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"duration\",\r\n          \"type\": \"int\",\r\n          \"default\": 0,\r\n          \"description\": \"Number of minutes the episode should last.\"\r\n        }\r\n      ]\r\n    },\r\n       {\r\n      \"name\": \"olio.sd.config\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"description\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"imageAction\",\r\n          \"type\": \"string\",\r\n          \"description\": \"Verb phrase describing the action to be performed in the image.\"\r\n        },\r\n        {\r\n          \"name\": \"seed\",\r\n          \"type\": \"int\",\r\n          \"default\": -1\r\n        },\r\n        {\r\n        \"name\": \"shared\",\r\n        \"type\": \"boolean\",\r\n        \"description\": \"Whether the config is meant to be shared internally across generations.\"\r\n         },\r\n        {\r\n          \"name\": \"hires\",\r\n          \"type\": \"boolean\",\r\n          \"default\": true,\r\n          \"description\": \"Whether to use the refiner.\"\r\n        },\r\n        {\r\n          \"name\": \"steps\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 1,\r\n          \"maxValue\": 100,\r\n          \"default\": 20\r\n        },\r\n        {\r\n          \"name\": \"refinerSteps\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 1,\r\n          \"maxValue\": 100,\r\n          \"default\": 20\r\n        },\r\n        {\r\n          \"name\": \"width\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 1,\r\n          \"maxValue\": 2048,\r\n          \"default\": 1024\r\n        },\r\n        {\r\n          \"name\": \"height\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 1,\r\n          \"maxValue\": 2048,\r\n          \"default\": 1024\r\n        },\r\n        {\r\n          \"name\": \"cfg\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 1,\r\n          \"maxValue\": 20,\r\n          \"default\": 7\r\n        },\r\n        {\r\n          \"name\": \"model\",\r\n          \"type\": \"string\",\r\n          \"default\": \"sdXL_v10VAEFix.safetensors\"\r\n        },\r\n        {\r\n          \"name\": \"scheduler\",\r\n          \"type\": \"string\",\r\n          \"default\": \"Karras\"\r\n        },\r\n        {\r\n          \"name\": \"sampler\",\r\n          \"type\": \"string\",\r\n          \"default\": \"dpmpp_2m\"\r\n        },\r\n        {\r\n          \"name\": \"refinerScheduler\",\r\n          \"type\": \"string\",\r\n          \"default\": \"Karras\"\r\n        },\r\n        {\r\n          \"name\": \"refinerSampler\",\r\n          \"type\": \"string\",\r\n          \"default\": \"dpmpp_2m\"\r\n        },\r\n        {\r\n          \"name\": \"refinerModel\",\r\n          \"type\": \"string\",\r\n          \"default\": \"juggernautXL_ragnarokBy.safetensors\"\r\n        },\r\n        {\r\n          \"name\": \"refinerMethod\",\r\n          \"type\": \"string\",\r\n          \"default\": \"PostApply\"\r\n        },\r\n        {\r\n          \"name\": \"refinerUpscaleMethod\",\r\n          \"type\": \"string\",\r\n          \"default\": \"pixel-lanczos\"\r\n        },\r\n        {\r\n          \"name\": \"refinerControlPercentage\",\r\n          \"type\": \"double\",\r\n          \"minValue\": 0.01,\r\n          \"maxValue\": 1.0,\r\n          \"default\": 0.2\r\n        },\r\n        {\r\n          \"name\": \"refinerUpscale\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 1,\r\n          \"maxValue\": 2,\r\n          \"default\": 2\r\n        },\r\n        {\r\n          \"name\": \"refinerCfg\",\r\n          \"type\": \"int\",\r\n          \"minValue\": 1,\r\n          \"maxValue\": 20,\r\n          \"default\": 7\r\n        },\r\n        {\r\n          \"name\": \"imageCount\",\r\n          \"type\": \"int\",\r\n          \"default\": 1,\r\n          \"minValue\": 1,\r\n          \"maxValue\": 5\r\n        },\r\n        {\r\n          \"name\": \"imageSetting\",\r\n          \"type\": \"string\",\r\n          \"default\": \"random\"\r\n        },\r\n        {\r\n          \"name\": \"bodyStyle\",\r\n          \"type\": \"string\",\r\n          \"default\": \"full body\"\r\n        },\r\n        {\r\n          \"name\": \"stillCamera\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"film\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"lens\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"colorProcess\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"photographer\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"movieCamera\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"movieFilm\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"director\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"photoStyle\",\r\n          \"type\": \"string\"\r\n        },\r\n\t{\r\n\t\t\t\"name\": \"style\",\r\n\t\t\t\"type\": \"string\",\r\n\t\t\t\"limit\": [\"art\", \"movie\", \"photograph\", \"selfie\", \"anime\", \"portrait\", \"comic\", \"digitalArt\", \"fashion\", \"vintage\", \"custom\"]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"artStyle\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"selfiePhone\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"selfieAngle\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"selfieLighting\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"animeStudio\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"animeEra\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"portraitLighting\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"portraitBackdrop\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"comicPublisher\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"comicEra\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"comicColoring\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"digitalMedium\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"digitalSoftware\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"digitalArtist\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"fashionMagazine\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"fashionDecade\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"vintageDecade\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"vintageProcessing\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"vintageCamera\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"customPrompt\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"referenceImageId\",\r\n\t\t\t\"type\": \"string\"\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"name\": \"denoisingStrength\",\r\n\t\t\t\"type\": \"double\",\r\n\t\t\t\"minValue\": 0.0,\r\n\t\t\t\"maxValue\": 1.0,\r\n\t\t\t\"default\": 0.75\r\n\t\t}\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.sd.configData\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"stillCameras\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"films\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"lenses\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"colorProcesses\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"photographers\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"movieCameras\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"movieFilms\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"directors\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"photoStyles\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"artStyles\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"styles\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.vectorChatHistory\",\r\n      \"inherits\": [\r\n        \"data.vectorModelStore\"\r\n      ],\r\n      \"query\": [],\r\n      \"hints\": [],\r\n      \"description\": \"Used for storing chat history with vector embeddings\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"systemCharacter\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"userCharacter\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"event\",\r\n          \"baseModel\": \"olio.event\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"session\",\r\n          \"baseModel\": \"data.data\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"chatConfig\",\r\n          \"baseModel\": \"olio.llm.chatConfig\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"promptConfig\",\r\n          \"baseModel\": \"olio.llm.promptConfig\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.vectorChatHistoryList\",\r\n      \"ephemeral\": true,\r\n      \"factory\": \"org.cote.accountmanager.olio.llm.VectorChatHistoryListFactory\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"vectors\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.vectorChatHistory\",\r\n          \"type\": \"list\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.chatOptions\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"top_k\",\r\n          \"type\": \"int\",\r\n          \"default\": 50,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1\r\n        },\r\n        {\r\n          \"name\": \"top_p\",\r\n          \"type\": \"double\",\r\n          \"default\": 1,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1\r\n        },\r\n        {\r\n          \"name\": \"min_p\",\r\n          \"type\": \"double\",\r\n          \"default\": 0.1,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1\r\n        },\r\n        {\r\n          \"name\": \"typical_p\",\r\n          \"type\": \"double\",\r\n          \"default\": 0.85,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 1\r\n        },\r\n        {\r\n          \"name\": \"repeat_last_n\",\r\n          \"type\": \"int\",\r\n          \"default\": 64,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 100\r\n        },\r\n        {\r\n          \"name\": \"temperature\",\r\n          \"type\": \"double\",\r\n          \"default\": 1,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 2\r\n        },\r\n        {\r\n          \"name\": \"repeat_penalty\",\r\n          \"type\": \"double\",\r\n          \"default\": 1.2,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 2\r\n        },\r\n        {\r\n          \"name\": \"num_ctx\",\r\n          \"type\": \"int\",\r\n          \"default\": 8192,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 120000\r\n        },\r\n        {\r\n          \"name\": \"num_gpu\",\r\n          \"type\": \"int\",\r\n          \"default\": 1\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.chatRequest\",\r\n      \"inherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"group\": \"ChatRequests\",\r\n      \"icon\": \"chat\",\r\n      \"label\": \"Requests\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\",\r\n        \"chatConfig\",\r\n        \"promptConfig\",\r\n        \"session\",\r\n        \"sessionType\",\r\n        \"setting\"\r\n      ],\r\n      \"description\": \"Used for proxying chat requests\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"message\",\r\n          \"type\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"uid\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64,\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"chatConfig\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.chatConfig\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"promptConfig\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.promptConfig\",\r\n          \"foreign\": true\r\n        },\r\n        {\r\n          \"name\": \"sessionType\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"session\",\r\n          \"baseModel\": \"$flex\",\r\n          \"type\": \"model\",\r\n          \"foreign\": true,\r\n          \"foreignType\": \"sessionType\"\r\n        },\r\n        {\r\n          \"name\": \"data\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\",\r\n          \"ephemeral\": true\r\n        },\r\n        {\r\n          \"name\": \"setting\",\r\n          \"type\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.chatResponseModel\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"description\": \"Used for proxying chat responses\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"messages\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.message\"\r\n        },\r\n        {\r\n          \"name\": \"actor\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"uid\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"model\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.message\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"role\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 32\r\n        },\r\n        {\r\n          \"name\": \"content\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"pruned\",\r\n          \"type\": \"boolean\",\r\n          \"ephemeral\": true\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.ollama.ollamaMessage\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"inherits\": [\r\n        \"olio.llm.message\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"images\",\r\n          \"type\": \"string\",\r\n          \"description\": \"Not currently used or correct\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.request\",\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"model\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"options\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.chatOptions\"\r\n        },\r\n        {\r\n          \"name\": \"stream\",\r\n          \"type\": \"boolean\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.ollama.ollamaRequest\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"inherits\": [\r\n        \"olio.llm.request\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"prompt\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"system\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"context\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"messages\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.ollama.ollamaMessage\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.response\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"abstract\": true,\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"model\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        },\r\n        {\r\n          \"name\": \"response\",\r\n          \"type\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.ollama.ollamaResponse\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"inherits\": [\r\n        \"olio.llm.response\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"created_at\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"context\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"done\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"total_duration\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"load_duration\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"done_reason\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"prompt_eval_count\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"prompt_eval_duration\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"eval_count\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"eval_duration\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"message\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.ollama.ollamaMessage\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiMessage\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"inherits\": [\r\n        \"olio.llm.message\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"annotations\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"context\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiCitation\"\r\n        },\r\n        {\r\n          \"name\": \"refusal\",\r\n          \"type\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiRequest\",\r\n      \"likeInherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"inherits\": [\r\n        \"common.groupExt\",\r\n        \"common.baseLight\",\r\n        \"olio.llm.request\"\r\n      ],\r\n      \"description\": \"An OpenAI request model that defines the parameters for making requests to OpenAI's language models. This includes settings like temperature, max tokens, and the messages to be processed by the model.\",\r\n      \"group\": \"ChatRequests\",\r\n      \"icon\": \"chat\",\r\n      \"label\": \"Requests\",\r\n      \"vector\": \"org.cote.accountmanager.olio.VectorProvider\",\r\n      \"query\": [\r\n        \"id\",\r\n        \"groupId\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"max_completion_tokens\",\r\n          \"type\": \"int\",\r\n          \"default\": 2048,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 120000,\r\n          \"description\": \"For o1 and later models\"\r\n        },\r\n        {\r\n          \"name\": \"max_tokens\",\r\n          \"type\": \"int\",\r\n          \"default\": 2048,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 120000\r\n        },\r\n        {\r\n          \"name\": \"num_ctx\",\r\n          \"type\": \"int\",\r\n          \"default\": 2048,\r\n          \"minValue\": 0,\r\n          \"maxValue\": 120000,\r\n          \"description\": \"Cross compat for Ollama OpenAI\"\r\n        },\r\n        {\r\n          \"name\": \"temperature\",\r\n          \"type\": \"double\",\r\n          \"default\": 0.75\r\n        },\r\n        {\r\n          \"name\": \"top_p\",\r\n          \"type\": \"double\",\r\n          \"default\": 0.5\r\n        },\r\n        {\r\n          \"name\": \"frequency_penalty\",\r\n          \"type\": \"double\",\r\n          \"default\": 1.3\r\n        },\r\n        {\r\n          \"name\": \"presence_penalty\",\r\n          \"type\": \"double\",\r\n          \"default\": 1.3\r\n        },\r\n        {\r\n          \"name\": \"messages\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiMessage\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiResponse\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"inherits\": [\r\n        \"olio.llm.response\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"id\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"system_fingerprint\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"created\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"object\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"usage\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiUsage\"\r\n        },\r\n        {\r\n          \"name\": \"message\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiMessage\"\r\n        },\r\n        {\r\n          \"name\": \"choices\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiChoice\"\r\n        },\r\n        {\r\n          \"name\": \"prompt_filter_results\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiFilterResults\"\r\n        },\r\n        {\r\n          \"name\": \"created_at\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"done\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"total_duration\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"load_duration\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"done_reason\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"prompt_eval_count\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"prompt_eval_duration\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"eval_count\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"eval_duration\",\r\n          \"type\": \"long\"\r\n        },\r\n        {\r\n          \"name\": \"data\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiData\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiChoice\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"finish_reason\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"logprobs\",\r\n          \"type\": \"double\",\r\n          \"default\": 0\r\n        },\r\n        {\r\n          \"name\": \"index\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"message\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiMessage\"\r\n        },\r\n        {\r\n          \"name\": \"content_filter_results\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiFilterResults\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiContext\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"citations\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiCitation\"\r\n        },\r\n        {\r\n          \"name\": \"intent\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiCitation\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"content\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"title\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"url\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"filepath\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"chunk_id\",\r\n          \"type\": \"int\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiUsage\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"completion_tokens\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"prompt_tokens\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"total_tokens\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"completion_tokens_details\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"prompt_tokens_details\",\r\n          \"type\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiFilterResult\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"filtered\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"detected\",\r\n          \"type\": \"boolean\"\r\n        },\r\n        {\r\n          \"name\": \"severity\",\r\n          \"type\": \"string\",\r\n          \"maxLength\": 64\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiFilterResults\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"inherits\": [\r\n        \"olio.llm.response\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"hate\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiFilterResult\"\r\n        },\r\n        {\r\n          \"name\": \"protected_material_code\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiFilterResult\"\r\n        },\r\n        {\r\n          \"name\": \"protected_material_text\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiFilterResult\"\r\n        },\r\n        {\r\n          \"name\": \"self_harm\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiFilterResult\"\r\n        },\r\n        {\r\n          \"name\": \"sexual\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiFilterResult\"\r\n        },\r\n        {\r\n          \"name\": \"violence\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiFilterResult\"\r\n        },\r\n        {\r\n          \"name\": \"jailbreak\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.llm.openai.openaiFilterResult\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiData\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"inherits\": [\r\n        \"olio.llm.response\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"object\",\r\n          \"type\": \"string\"\r\n        },\r\n        {\r\n          \"name\": \"index\",\r\n          \"type\": \"int\"\r\n        },\r\n        {\r\n          \"name\": \"embedding\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"float\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"olio.llm.openai.openaiInput\",\r\n      \"ioConstraints\": [\r\n        \"unknown\"\r\n      ],\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"input\",\r\n          \"type\": \"string\"\r\n        }\r\n      ]\r\n    },\r\n {\r\n      \"name\": \"olio.playerState\",\r\n      \"inherits\": [\r\n        \"data.directory\"\r\n      ],\r\n      \"group\": \"Player States\",\r\n      \"icon\": \"category\",\r\n      \"label\": \"Player State\",\r\n      \"dedicatedParticipation\": true,\r\n      \"description\": \"This model represents the state of a player in a realm, including their character, current event, location, and actions.\",\r\n      \"fields\": [\r\n        {\r\n          \"name\": \"realm\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.realm\",\r\n          \"foreign\": true,\r\n          \"followReference\": false\r\n        },\r\n        {\r\n          \"name\": \"character\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"foreign\": true,\r\n          \"followReference\": true\r\n        },\r\n        {\r\n          \"name\": \"party\",\r\n          \"type\": \"list\",\r\n          \"baseType\": \"model\",\r\n          \"baseModel\": \"olio.charPerson\",\r\n          \"foreign\": true,\r\n          \"participantModel\": \"state.party\"\r\n        },\r\n        {\r\n          \"name\": \"user\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"system.user\",\r\n          \"foreign\": true,\r\n          \"followReference\": true\r\n        },\r\n        {\r\n          \"name\": \"currentEvent\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.event\",\r\n          \"foreign\": true,\r\n          \"followReference\": true\r\n        },\r\n        {\r\n          \"name\": \"currentLocation\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"data.geoLocation\",\r\n          \"foreign\": true,\r\n          \"followReference\": true\r\n        },\r\n        {\r\n          \"name\": \"currentAction\",\r\n          \"type\": \"model\",\r\n          \"baseModel\": \"olio.actionResult\",\r\n          \"foreign\": true\r\n        }\r\n      ]\r\n    }\r\n  ],\r\n  \"validationRules\": [\r\n    {\r\n      \"schema\": \"policy.validationRule\",\r\n      \"name\": \"emailRule\",\r\n      \"expression\": \"^[a-zA-Z0-9_!#$%&*+/=?`{|}~^.-]+@[a-zA-Z0-9.-]+$\",\r\n      \"type\": \"boolean\"\r\n    },\r\n    {\r\n      \"schema\": \"policy.validationRule\",\r\n      \"name\": \"minLen5\",\r\n      \"type\": \"boolean\",\r\n      \"expression\": \"[A-Za-z0-9]{5}\",\r\n      \"rules\": [\r\n        \"${notEmpty}\"\r\n      ]\r\n    },\r\n    {\r\n      \"schema\": \"policy.validationRule\",\r\n      \"name\": \"notEmpty\",\r\n      \"type\": \"boolean\",\r\n      \"expression\": \"\\\\S\",\r\n      \"rules\": [\r\n        \"${trimEnds}\"\r\n      ]\r\n    },\r\n    {\r\n      \"schema\": \"policy.validationRule\",\r\n      \"name\": \"notInParent\",\r\n      \"type\": \"function\",\r\n      \"function\": \"!{notInParent}\"\r\n    },\r\n    {\r\n      \"schema\": \"policy.validationRule\",\r\n      \"name\": \"trimBegin\",\r\n      \"expression\": \"^\\\\s+\",\r\n      \"type\": \"replacement\",\r\n      \"replacementValue\": \"\",\r\n      \"replacementValueType\": \"string\"\r\n    },\r\n    {\r\n      \"schema\": \"policy.validationRule\",\r\n      \"name\": \"trimEnd\",\r\n      \"expression\": \"\\\\s+$\",\r\n      \"type\": \"replacement\",\r\n      \"replacementValue\": \"\",\r\n      \"replacementValueType\": \"string\"\r\n    },\r\n    {\r\n      \"schema\": \"policy.validationRule\",\r\n      \"name\": \"trimEnds\",\r\n      \"type\": \"none\",\r\n      \"rules\": [\r\n        \"${trimBegin}\",\r\n        \"${trimEnd}\"\r\n      ]\r\n    }\r\n  ]\r\n};\r\n\r\n  if (typeof module != \"undefined\") {\r\n    module.am7model = am7model;\r\n  } else {\r\n    window.am7model = am7model;\r\n  }\r\n\r\n}());\n\n;/* === model/model.js === */\n(function () {\r\n\r\n\tam7model.enums.modelNames = [];\r\n\tam7model.models.forEach((o) => {\r\n\t\tif (!o.abstract) {\r\n\t\t\tam7model.enums.modelNames.push(o.name);\r\n\t\t}\r\n\t});\r\n\r\n\tam7model.system = {\r\n\t\tlibrary: {\r\n\t\t\t\"data.color\": \"/Library/Colors\"\r\n\t\t}\r\n\t};\r\n\r\n\tam7model.getPrototype = function (name) {\r\n\t\tlet cat = am7model.categories;\r\n\t\tlet proto;\r\n\t\tlet aP = Object.keys(cat).filter((k) => {\r\n\r\n\t\t\tlet vP = Object.keys(cat[k]).filter((l) => {\r\n\t\t\t\tif (l.match(/^prototype$/)) {\r\n\t\t\t\t\tlet catO = cat[k][l];\r\n\t\t\t\t\tif (catO[name]) {\r\n\t\t\t\t\t\tproto = catO[name];\r\n\t\t\t\t\t\tproto.key = name;\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tlet xP = Object.keys(catO).filter((m) => {\r\n\t\t\t\t\t\t\tif (catO[m].pathName && catO[m].pathName.toLowerCase() == name) {\r\n\t\t\t\t\t\t\t\tproto = catO[m];\r\n\t\t\t\t\t\t\t\tproto.key = m;\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (xP.length) return true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (vP.length) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (proto) return proto;\r\n\t\treturn null;\r\n\t}\r\n\r\n\tam7model.getModel = function (type) {\r\n\t\tif (type == null || !type) {\r\n\t\t\tconsole.error(\"Invalid type\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet model = am7model.models.filter(o => o.name.toLowerCase() == type.toLowerCase());\r\n\t\tif (!model.length) {\r\n\t\t\tmodel = am7model.getPrototype(type);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmodel = model[0];\r\n\t\t}\r\n\t\tif (model == null) {\r\n\t\t\t// console.warn(\"No model for '\" + type + \"'\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn model;\r\n\t};\r\n\r\n\tam7model.hasField = function (model, n) {\r\n\t\tlet f;\r\n\t\tif(n.match(/\\./)){\r\n\t\t\tlet an = n.split(\".\");\r\n\t\t\tlet om = model;\r\n\t\t\tfor (let i = 0; i < an.length; i++) {\r\n\t\t\t\tf = am7model.getModelField(om, an[i]);\r\n\t\t\t\tif(!f){\r\n\t\t\t\t\tconsole.error(\"Failed to find field \" + an[i] + \" in \" + model + \", \" + n);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif(f.type == \"model\" && f.baseModel){\r\n\t\t\t\t\tom = am7model.getModel(f.baseModel);\r\n\t\t\t\t\tif(!om){\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\tf = am7model.getModelField(model, n);\r\n\t\t}\r\n\t\t\r\n\t\treturn (f ? true : false);\r\n\t};\r\n\r\n\tam7model.getModelField = function (model, n, ftype) {\r\n\t\tif (typeof model == \"string\") {\r\n\t\t\tif (model == \"$flex\") {\r\n\t\t\t\tif (!ftype) {\r\n\t\t\t\t\tftype = 'common.nameId';\r\n\t\t\t\t}\r\n\t\t\t\tmodel = ftype;\r\n\t\t\t}\r\n\t\t\tmodel = am7model.getModel(model);\r\n\t\t}\r\n\t\tif (!model) {\r\n\t\t\tconsole.error(\"Failed to find model definition for \" + model + \" from \" + model + \", \" + ftype);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet fld = model.fields.filter(o => o.name.toLowerCase() == n.toLowerCase());\r\n\t\tlet field = fld[0];\r\n\t\tif (!field && model.inherits) {\r\n\t\t\tfor (let i in model.inherits) {\r\n\t\t\t\tfield = am7model.getModelField(model.inherits[i], n);\r\n\t\t\t\tif (field) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn field;\r\n\t};\r\n\r\n\tam7model.getModelFields = function (model) {\r\n\t\tlet am = [];\r\n\t\tif (typeof model == \"string\") {\r\n\t\t\tmodel = am7model.getModel(model);\r\n\t\t}\r\n\r\n\t\tif (!model) {\r\n\t\t\tconsole.error(\"Failed to find model definition for \" + model);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tam.push(...model.fields);\r\n\t\tfor (let i in model.inherits) {\r\n\t\t\tam.push(...am7model.getModelFields(model.inherits[i]));\r\n\t\t}\r\n\t\treturn [...new Set(am)];\r\n\t};\r\n\r\n\tam7model.newPrimitive = function (sLType, ignoreEmptyNull, sPath, innerCall) {\r\n\t\tlet o = {};\r\n\t\tlet f = am7model.getModel(sLType);\r\n\t\tif (!f) {\r\n\t\t\tconsole.error(\"No model for: \" + sLType);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (f.followReference == false) {\r\n\t\t\to[am7model.jsonModelKey] = sLType;\r\n\t\t\treturn o;\r\n\t\t}\r\n\t\tif (f.inherits) {\r\n\t\t\tf.inherits.forEach(i => {\r\n\t\t\t\tObject.assign(o, am7model.newPrimitive(i, ignoreEmptyNull, sPath, true));\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (f.fields) {\r\n\t\t\tf.fields.forEach(i => {\r\n\t\t\t\tif (!i.identity && !i.ephemeral && !i.virtual) {\r\n\t\t\t\t\tlet nfv = am7model.defaultValue(i);\r\n\t\t\t\t\tlet emptyArray = (i.type == 'list' && nfv.length == 0);\r\n\t\t\t\t\tlet nullOrUndef = ((i.type == 'string' || i.type == 'object' || i.type == 'enum') && (!nfv || nfv == null));\r\n\t\t\t\t\tif (!ignoreEmptyNull || !(\r\n\t\t\t\t\t\temptyArray\r\n\t\t\t\t\t\t||\r\n\t\t\t\t\t\tnullOrUndef\r\n\t\t\t\t\t)) {\r\n\t\t\t\t\t\to[i.name] = nfv;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tconsole.warn(\"Skip: \" + i.name + \" because \" + emptyArray);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (!innerCall) {\r\n\t\t\to[am7model.jsonModelKey] = sLType;\r\n\t\t\tlet ft = am7model.getModel(sLType);\r\n\t\t\t// ft.inherits && ft.inherits.find(s => s == \"directory\") != null\r\n\t\t\tif (ft && am7model.isGroup(ft)) {\r\n\t\t\t\tlet sDP = sPath || am7view.path(sLType);\r\n\t\t\t\tif (sLType == \"auth.group\") o.path = sDP;\r\n\t\t\t\telse o.groupPath = sDP;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn o;\r\n\t};\r\n\tam7model.defaultValue = function (field) {\r\n\t\tlet fieldDefVal = field.default;\r\n\t\tlet defVal;\r\n\t\tswitch (field.type) {\r\n\t\t\tcase \"int\":\r\n\t\t\tcase \"double\":\r\n\t\t\tcase \"long\":\r\n\t\t\tcase \"number\":\r\n\t\t\t\tdefVal = 0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"blob\":\r\n\t\t\tcase \"binary\":\r\n\t\t\t\tdefVal = \"\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"string\":\r\n\t\t\t\tdefVal = null;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"enum\":\r\n\t\t\t\tdefVal = \"UNKNOWN\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"boolean\":\r\n\t\t\t\tdefVal = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"list\":\r\n\t\t\tcase \"array\":\r\n\t\t\t\tdefVal = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"model\":\r\n\t\t\tcase \"object\":\r\n\t\t\t\tdefVal = null;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"zonetime\":\r\n\t\t\t\tdefVal = new Date().toISOString().slice(0, 16);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"timestamp\":\r\n\t\t\tcase \"datetime\":\r\n\t\t\t\tdefVal = (new Date()).getTime();\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"color\":\r\n\t\t\tcase \"flex\":\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.warn(\"Unhandled field type\", field.type, field);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn (fieldDefVal || defVal);\r\n\t};\r\n\r\n\tam7model.inherits = function (o, i) {\r\n\t\tlet b = false;\r\n\t\tif (typeof o == \"string\") o = am7model.getModel(o);\r\n\t\tif (o.inherits) {\r\n\t\t\tif (o.inherits.includes(i) || (o.likeInherits && o.likeInherits.includes(i))) {\r\n\t\t\t\tb = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let h in o.inherits) {\r\n\t\t\t\t\tlet p = am7model.getModel(o.inherits[h]);\r\n\t\t\t\t\tif (p) {\r\n\t\t\t\t\t\tb = am7model.inherits(p, i);\r\n\t\t\t\t\t\tif (b) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn b;\r\n\t};\r\n\r\n\tam7model.inheritsFrom = function (o) {\r\n\t\tlet a = [];\r\n\t\tif (typeof o == \"string\") o = am7model.getModel(o);\r\n\t\ta.push(o);\r\n\t\tif (o.inherits) {\r\n\t\t\tfor (let h in o.inherits) {\r\n\t\t\t\tlet p = am7model.getModel(o.inherits[h]);\r\n\t\t\t\tif (p && !a.includes(p)) {\r\n\t\t\t\t\ta = [].concat(a, am7model.inheritsFrom(p));\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn a;\r\n\t};\r\n\r\n\tam7model.isParent = function (o) {\r\n\t\treturn am7model.inherits(o, \"common.parent\");\r\n\t};\r\n\r\n\tam7model.isGroup = function (o) {\r\n\t\tif (typeof o == \"string\") o = am7model.getModel(o);\r\n\t\treturn (am7model.inherits(o, \"data.directory\") || o.name == 'auth.group');\r\n\t};\r\n\r\n\tam7model.observers = {\r\n\t\tmodels: {}\r\n\t};\r\n\r\n\tam7model.observe = function (o, s) {\r\n\t\tlet m = am7model.observers.models;\r\n\t\tif (!m[s]) {\r\n\t\t\tm[s] = [];\r\n\t\t}\r\n\t\tm[s].push(o);\r\n\t};\r\n\r\n\tam7model.updateListModel = function (v, f) {\r\n\t\t/// In AM7, the 'model' property may be condensed to occur in only the first result  if the remaining results are the same\r\n\t\t///\r\n\t\tif (v && v.length) {\r\n\t\t\tlet mk = v[0][am7model.jsonModelKey];\r\n\t\t\tlet m = mk || f?.baseModel;\r\n\r\n\t\t\tfor (let i = (mk ? 1 : 0); i < v.length; i++) {\r\n\t\t\t\tif (!v[i][am7model.jsonModelKey]) v[i][am7model.jsonModelKey] = m;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tam7model.applyModelNames = function (o) {\r\n\t\tlet af = am7model.getModelFields(o[am7model.jsonModelKey]);\r\n\t\taf.forEach(f => {\r\n\t\t\tif (f.type == \"model\" && o[f.name] && !o[f.name][am7model.jsonModelKey]) {\r\n\t\t\t\to[f.name][am7model.jsonModelKey] = f.baseModel;\r\n\t\t\t\tam7model.applyModelNames(o[f.name]);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/// A more generic version of the mergeEntity function in Object\r\n\tam7model.prepareEntity = function (e, baseModel, recurse) {\r\n\t\tlet ue = am7model.newPrimitive(e && e[am7model.jsonModelKey] ? e[am7model.jsonModelKey] : baseModel);\r\n\t\tif (!e[am7model.jsonModelKey]) e[am7model.jsonModelKey] = ue[am7model.jsonModelKey] || baseModel;\r\n\t\tif (!e[am7model.jsonModelKey]) {\r\n\t\t\tconsole.warn(\"Cannot find model\", e);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet x = Object.assign(ue, e);\r\n\t\tlet af = am7model.getModelFields(e[am7model.jsonModelKey]);\r\n\t\t\r\n\t\tif (recurse) {\r\n\t\t\taf.forEach(f => {\r\n\t\t\t\tif ((f.type == 'list' || f.type == 'model') && f.foreign && f.baseModel) {\r\n\t\t\t\t\tif (f.type == 'model' && !ue[f.name] && e[f.name]) {\r\n\t\t\t\t\t\tue[f.name] = am7model.prepareEntity(e[f.name], f.baseModel, recurse);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (f.type == 'list') {\r\n\t\t\t\t\t\tue[f.name] = ue[f.name].map(e2 => am7model.prepareEntity(e2, f.baseModel, recurse));\r\n\t\t\t\t\t}\r\n\t\t\t\t\t/*\r\n\t\t\t\t\tif (ue[f.name] && (f.type != 'list' || ue[f.name].length > 0)) {\r\n\t\t\t\t\t\tlet fm = f.baseModel;\r\n\t\t\t\t\t\tue[f.name] = am7model.prepareEntity(e[f.name] || ue[f.name], f.baseModel, recurse);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t*/\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tam7model.applyModelNames(x);\r\n\t\treturn x;\r\n\t};\r\n\r\n\tam7model.validationRule = function (n) {\r\n\t\tlet r = am7model.validationRules.filter(r => r.name == n);\r\n\t\treturn r.length ? r[0] : undefined;\r\n\t};\r\n\r\n\tam7model.validateInstance = function (o) {\r\n\t\tlet r = o.model.fields.map((f) => am7model.validateField(o, f, f.rules));\r\n\t\treturn r;\r\n\t};\r\n\r\n\tlet vrcache = {};\r\n\r\n\tam7model.getValidationRuleInstance = function (ru) {\r\n\t\tlet oru = ru;\r\n\t\tlet vr = oru;\r\n\t\tlet isStr = typeof oru == \"string\"\r\n\t\tif (isStr) {\r\n\t\t\tif (vrcache[oru]) {\r\n\t\t\t\treturn vrcache[oru]\r\n\t\t\t}\r\n\t\t\t/// System rule references start with $, such as $rule\r\n\t\t\t/// Tokenized system rules are in the format of ${rule}, with the intent of being dynamically substituded when the rule is loaded on the backend\r\n\t\t\t/// Otherwise, rules would follow the foreign list model\r\n\t\t\t/// Since this is  a lookup, anything starting with $ is a system rule and $,{,} will be stripped\r\n\t\t\tif (oru.match(/^\\$/)) {\r\n\t\t\t\toru = oru.replace(/[\\$\\{\\}]*/g, \"\");\r\n\t\t\t}\r\n\t\t\tvr = am7model.validationRule(oru);\r\n\t\t}\r\n\t\tlet nvr = am7model.prepareEntity(vr, \"policy.validationRule\")\r\n\t\tlet vri = am7model.prepareInstance(nvr, am7model.forms.validationRule);\r\n\r\n\t\tif (isStr) {\r\n\t\t\tvrcache[ru] = vri;\r\n\t\t}\r\n\t\treturn vri;\r\n\t};\r\n\r\n\tam7model.validateField = function (o, f, rules, applyReplacement) {\r\n\r\n\t\tvar r = 0,\r\n\t\t\tir = 1,\r\n\t\t\ttir,\r\n\t\t\tre = 1\r\n\t\t\t;\r\n\r\n\t\tif (f.readOnly || f.virtual || f.ephemeral || f.private) return 1;\r\n\r\n\t\t/// don't read from API for validation because it will include decorators which may change the value\r\n\t\t///\r\n\t\tlet v = o.entity[f.name];\r\n\t\tlet err;\r\n\t\tswitch (f.type) {\r\n\t\t\tcase \"enum\":\r\n\t\t\tcase \"string\":\r\n\t\t\t\tif (f.required && (v == undefined || v.length == 0)) {\r\n\t\t\t\t\terr = \"Field is required\";\r\n\t\t\t\t\tre = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (f.maxLength > 0 && v != undefined && v.length > f.maxLength) {\r\n\t\t\t\t\terr = \"Exceeds maximum length \" + f.maxLength;\r\n\t\t\t\t\tre = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (f.minLength && (v == undefined || v.length < f.minLength)) {\r\n\t\t\t\t\terr = \"Does not meet the minimum length \" + f.minLength;\r\n\t\t\t\t\tre = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (f.limit?.length > 0 && !f.limit.includes(v) && f.required) {\r\n\t\t\t\t\terr = \"Not defined in the limit\", f.limit;\r\n\t\t\t\t\tre = 0;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"timestamp\":\r\n\t\t\tcase \"long\":\r\n\t\t\tcase \"int\":\r\n\t\t\tcase \"double\":\r\n\t\t\t\tif (f.name == \"parentId\" && am7model.isGroup(o.model.name)) {\r\n\t\t\t\t\t/// Allow parentId to be 0 if group is also present\r\n\t\t\t\t\t///\r\n\t\t\t\t}\r\n\t\t\t\telse if (f.required && (v == undefined || v == 0)) {\r\n\t\t\t\t\terr = \"Field is required\";\r\n\t\t\t\t\tre = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (f.validateRange && (v < f.minValue || v > f.maxValue)) {\r\n\t\t\t\t\terr = v + \" outside value range \" + f.minValue + \" - \" + f.maxValue;\r\n\t\t\t\t\tre = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"list\":\r\n\t\t\t\t/// ignore\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.warn(\"Unhandled field type: \" + f.type, f);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tif (re == 0) {\r\n\t\t\to.validationErrors[f.name] = err;\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tif (!rules || !rules.length) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\tfor (let ri in rules) {\r\n\t\t\tlet ru = rules[ri];\r\n\t\t\tlet vr = am7model.getValidationRuleInstance(ru);\r\n\t\t\tif (!vr) {\r\n\t\t\t\to.validationErrors[f.name] = \"Invalid rule: \" + ru;\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (vr.api.rules()?.length) {\r\n\t\t\t\ttir = am7model.validateField(o, f, vr.api.rules(), applyReplacement);\r\n\t\t\t\tif (ir && !tir) {\r\n\t\t\t\t\tir = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\r\n\r\n\t\t\t/* check typeof == \"number\" because \"\" == 0*/\r\n\t\t\tif (\r\n\t\t\t\t(f.type == \"int\" || f.type == \"double\" || f.type == \"float\") && v == f.default\r\n\r\n\t\t\t) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (v == undefined) {\r\n\t\t\t\to.validationErrors[f.name] = \"Field is empty or undefined\";\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (vr.api.expression()) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet re = new RegExp(vr.api.expression());\r\n\t\t\t\t\tswitch (vr.api.type()) {\r\n\t\t\t\t\t\tcase \"replacement\":\r\n\t\t\t\t\t\t\tr = 1;\r\n\t\t\t\t\t\t\tif (applyReplacement && typeof vr.api.replacementValue() == \"string\") {\r\n\t\t\t\t\t\t\t\tv = v.replace(re, vr.api.replacementValue());\r\n\t\t\t\t\t\t\t\to.api[f.name](v);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"boolean\":\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t(v.allowNull && v.length == 0)\r\n\t\t\t\t\t\t\t\t||\r\n\t\t\t\t\t\t\t\t(v.match(re) != null) == vr.api.comparison()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tr = 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\to.validationErrors[f.name] = \"Invalid value for \" + vr.api.name();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase \"none\":\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tconsole.warn(\"Unhandled expression type: \" + v.type);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcatch (e) {\r\n\t\t\t\t\tconsole.error(\"Error in validateField:: \" + (e.description ? e.description : e.message));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (vr.api.type() == \"none\") r = 1;\r\n\t\t\telse if (vr.api.type() == \"function\") {\r\n\t\t\t\tconsole.warn(\"Unhandled function type: \" + vr.api.name());\r\n\t\t\t\tr = 1;\r\n\t\t\t}\r\n\t\t\t/*\r\n\t\t\t\tif the return value is true, but the include return value is false\r\n\t\t\t\tset the return value to false\r\n\t\t\t*/\r\n\t\t\tif (r && !ir) r = 0;\r\n\t\t\tif (!r) {\r\n\t\t\t\tconsole.error(\"Validation failed for \" + f.name + \" with value \" + v);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\treturn r;\r\n\t};\r\n\r\n\tam7model.hasIdentity = function (entity) {\r\n\t\treturn am7model.getModelFields(entity[am7model.jsonModelKey]).filter(f => {\r\n\t\t\treturn (f.identity && entity[f.name] && entity[f.name] != am7model.defaultValue(f));\r\n\t\t}).length > 0;\r\n\t};\r\n\r\n\r\n\r\n\tlet dateTimeDecorator = {\r\n\t\tdecorateOut: function (i, f, v) {\r\n\t\t\tif (typeof v == \"number\") {\r\n\t\t\t\tlet d = new Date(v);\r\n\t\t\t\t//v = new Date(d.getTime() - (d.getTimezoneOffset() * 60000)).toISOString().slice(0,16);\r\n\t\t\t\tv = new Date(d.getTime()).toISOString().slice(0, 16);\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t},\r\n\t\tdecorateIn: function (i, f, v) {\r\n\t\t\tif (typeof v == \"string\") {\r\n\t\t\t\tlet d = new Date(v);\r\n\t\t\t\tv = d.getTime();\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t}\r\n\t};\r\n\r\n\tlet dateTimeZDecorator = {\r\n\t\tdecorateOut: function (i, f, v) {\r\n\t\t\tif (typeof v == \"string\") {\r\n\t\t\t\tv = new Date(v).toISOString().slice(0, 16);\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t},\r\n\t\tdecorateIn: function (i, f, v) {\r\n\t\t\treturn v;\r\n\t\t}\r\n\t};\r\n\r\n\tlet numberDecorator = {\r\n\t\tdecorateOut: function (i, f, v) {\r\n\t\t\tif (v == undefined) {\r\n\t\t\t\tv = f.default || 0;\r\n\t\t\t}\r\n\t\t\tif (f.type == \"double\" && v % 1 == 0) {\r\n\t\t\t\tv = v + \".0\";\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t},\r\n\t\tdecorateIn: function (i, f, v) {\r\n\t\t\tif (typeof v == \"string\") {\r\n\t\t\t\tif (f.type == \"double\") {\r\n\t\t\t\t\tv = parseFloat(v);\r\n\t\t\t\t}\r\n\t\t\t\telse if (f.type == \"int\") {\r\n\t\t\t\t\tv = parseInt(v);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t}\r\n\t};\r\n\r\n\tlet rangeDecorator = {\r\n\t\tdecorateOut: function (i, f, v) {\r\n\t\t\tif (typeof v == \"number\" && f.type == \"double\" && f.maxValue >= 1) {\r\n\t\t\t\tv = parseInt(v * 100);\r\n\t\t\t}\r\n\t\t\telse if (v == undefined) {\r\n\t\t\t\tv = 0;\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t},\r\n\t\tdecorateIn: function (i, f, v) {\r\n\t\t\t\r\n\t\t\tif (f.type == \"double\" && f.maxValue >= 1) {\r\n\t\t\t\tif (v != 0) {\r\n\t\t\t\t\tv = parseFloat(v / 100);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (f.type == \"int\") {\r\n\t\t\t\tv = parseInt(v);\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t}\r\n\t};\r\n\r\n\tlet textListDecorator = {\r\n\t\tdecorateOut: function (i, f, v) {\r\n\t\t\tif (v && (v instanceof Array)) {\r\n\t\t\t\tv = v.join(\"\\r\\n\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tv = \"\";\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t},\r\n\t\tdecorateIn: function (i, f, v) {\r\n\t\t\tif (v && typeof v == \"string\") {\r\n\t\t\t\tv = v.split(/\\r?\\n|\\r|\\n/g);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tv = [];\r\n\t\t\t}\r\n\t\t\t//v = ntc.name(v)[0];\r\n\t\t\treturn v;\r\n\t\t}\r\n\t};\r\n\r\n\tlet colorDecorator = {\r\n\t\tdecorateOut: function (i, f, v) {\r\n\t\t\t//v = ntc.hex(v)[0];\r\n\t\t\treturn v;\r\n\t\t},\r\n\t\tdecorateIn: function (i, f, v) {\r\n\t\t\tif (i.model.name == \"data.color\" && v && v.length == 7) {\r\n\t\t\t\ti.api[\"red\"](parseInt(v.substring(1, 3), 16));\r\n\t\t\t\ti.api[\"green\"](parseInt(v.substring(3, 5), 16));\r\n\t\t\t\ti.api[\"blue\"](parseInt(v.substring(5, 7), 16));\r\n\r\n\t\t\t}\r\n\t\t\t//v = ntc.name(v)[0];\r\n\t\t\treturn v;\r\n\t\t}\r\n\t};\r\n\r\n\tlet blobDecorator = {\r\n\t\tdecorateOut: function (i, f, v) {\r\n\t\t\tif (typeof v == \"string\") {\r\n\t\t\t\tv = Base64.decode(v);\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t},\r\n\t\tdecorateIn: function (i, f, v) {\r\n\t\t\tif (typeof v == \"string\") {\r\n\t\t\t\tv = Base64.encode(v);\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t}\r\n\t};\r\n\r\n\tam7model.base64ToUint8 = function (data) {\r\n\t\tvar dec = Base64.decode(data);\r\n\t\tvar array = new Uint8Array(new ArrayBuffer(dec.length));\r\n\t\tfor (var i = 0; i < dec.length; i++) {\r\n\t\t\tarray[i] = dec.charCodeAt(i);\r\n\t\t}\r\n\t\treturn array;\r\n\t};\r\n\r\n\tam7model.queryFields = function (type) {\r\n\t\tlet r1 = am7model.inheritsFrom(type).filter(m => m.query).map(m => m.query).flat(1);\r\n\t\tif (am7model.inherits(type, \"system.organizationExt\")) {\r\n\t\t\tr1.push(\"organizationId\");\r\n\t\t\tr1.push(\"organizationPath\");\r\n\t\t}\r\n\t\tif (am7model.inherits(type, \"common.dateTime\")) {\r\n\t\t\tr1.push(\"createdDate\");\r\n\t\t\tr1.push(\"modifiedDate\");\r\n\t\t}\r\n\t\tif (am7model.isParent(type)) {\r\n\t\t\tif (am7model.hasField(type, \"path\")) r1.push(\"path\");\r\n\t\t\tr1.push(\"parentId\");\r\n\t\t}\r\n\t\tif (am7model.isGroup(type) && type != 'auth.group') {\r\n\t\t\tr1.push(\"groupPath\");\r\n\t\t\tr1.push(\"groupId\");\r\n\t\t}\r\n\t\treturn r1;\r\n\t}\r\n\r\n\tam7model.newInstance = function (model, form) {\r\n\t\treturn am7model.prepareInstance(am7model.newPrimitive(model), form);\r\n\t};\r\n\r\n\tam7model.prepareInstance = function (entity, form) {\r\n\t\tform = form ?? am7model.forms[entity[am7model.jsonModelKey].substring(entity[am7model.jsonModelKey].lastIndexOf(\".\") + 1)];\r\n\t\tlet inst = {\r\n\t\t\tentity,\r\n\t\t\tform,\r\n\t\t\tmodel: am7model.getModel(entity[am7model.jsonModelKey]),\r\n\t\t\tobservers: [],\r\n\t\t\tactions: {},\r\n\t\t\tdecorators: {},\r\n\t\t\tdesigners: {},\r\n\t\t\tviewProperties: {},\r\n\t\t\tapi: {},\r\n\t\t\tvalidateField: {},\r\n\t\t\tchanges: [],\r\n\t\t\tvalidations: {},\r\n\t\t\tvalidationErrors: {},\r\n\t\t\tresetChanges: () => {\r\n\t\t\t\tinst.changes = [];\r\n\t\t\t},\r\n\t\t\tfields: []\r\n\t\t};\r\n\t\tinst.fields = am7model.getModelFields(entity[am7model.jsonModelKey]);\r\n\r\n\t\tinst.change = function (n) {\r\n\t\t\tif (!inst.changes.includes(n)) inst.changes.push(n);\r\n\t\t};\r\n\r\n\t\tinst.unchange = function (n) {\r\n\t\t\tinst.changes = inst.changes.filter((value, index, arr) => value != n);\r\n\t\t};\r\n\r\n\t\tfunction report(a, e) {\r\n\t\t\tinst.observers.forEach((o) => {\r\n\t\t\t\tif (o.report) {\r\n\t\t\t\t\to.report(a, e, inst);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction decorateInOut(bIn, v, f) {\r\n\t\t\tlet d = inst.decorators;\r\n\t\t\tif (d[f.name]) {\r\n\r\n\t\t\t\td[f.name].forEach((c) => {\r\n\t\t\t\t\tif (bIn && c.decorateIn) {\r\n\t\t\t\t\t\tv = c.decorateIn(inst, f, v);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!bIn && c.decorateOut) {\r\n\t\t\t\t\t\tv = c.decorateOut(inst, f, v);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\t\t\treturn v;\r\n\t\t}\r\n\r\n\t\tinst.decorate = (e, o) => {\r\n\t\t\tlet d = inst.decorators;\r\n\t\t\tif (!d[e]) {\r\n\t\t\t\td[e] = [];\r\n\t\t\t}\r\n\t\t\td[e].push(o);\r\n\t\t};\r\n\r\n\t\tinst.viewProperties = (e, o) => {\r\n\t\t\tif (o) {\r\n\t\t\t\treturn inst.viewDesigner(e, o, \"viewProperties\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn inst.viewDesign(e, \"viewProperties\");\r\n\t\t\t}\r\n\t\t};\r\n\t\tinst.design = (e) => {\r\n\t\t\treturn inst.viewDesign(te, \"designers\");\r\n\t\t};\r\n\r\n\t\tinst.designer = (e, o) => {\r\n\t\t\treturn inst.viewDesigner(e, o, \"designers\");\r\n\t\t};\r\n\t\tinst.design = (e) => {\r\n\t\t\treturn inst.viewDesign(e, \"designers\");\r\n\t\t};\r\n\t\tinst.viewDesigner = (e, o, p) => {\r\n\t\t\tlet d = inst[p];\r\n\t\t\tif (!d[e]) {\r\n\t\t\t\td[e] = [];\r\n\t\t\t}\r\n\t\t\td[e].push(o);\r\n\t\t};\r\n\t\tinst.viewDesign = (e, p) => {\r\n\t\t\tlet v;\r\n\t\t\tlet d = inst[p];\r\n\t\t\tlet dx = [];\r\n\t\t\tlet dd = dx.concat(d[e], d[\"all\"]);\r\n\t\t\tdd.forEach(df => {\r\n\t\t\t\tif (df) {\r\n\t\t\t\t\tif (typeof df == \"function\") {\r\n\t\t\t\t\t\tv = df(inst, e, v);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse v = df;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn v;\r\n\t\t};\r\n\r\n\t\tinst.field = (n) => {\r\n\t\t\tlet f;\r\n\t\t\t//let a = inst[am7model.jsonModelKey].fields.filter(f => f.name === n);\r\n\t\t\tlet a = inst.fields.filter(f => f.name === n);\r\n\t\t\treturn (a.length ? a[0] : f);\r\n\t\t};\r\n\r\n\t\tinst.formField = (n, v) => {\r\n\t\t\tlet x = inst?.form?.fields[n];\r\n\t\t\tif (v) {\r\n\t\t\t\tlet z;\r\n\t\t\t\tif (x && x[v]) z = x[v];\r\n\t\t\t\telse if (inst.field(n)) z = inst.field(n)[v];\r\n\t\t\t\treturn z;\r\n\t\t\t}\r\n\t\t\treturn x;\r\n\t\t};\r\n\r\n\t\tinst.observe = (o) => {\r\n\t\t\tinst.observers.push(o);\r\n\t\t};\r\n\t\tinst.action = (n, o) => {\r\n\t\t\tif (!o && inst.actions[n]) {\r\n\t\t\t\tinst.actions[n](inst, n);\r\n\t\t\t}\r\n\t\t\telse if (o) {\r\n\t\t\t\tinst.actions[n] = o;\r\n\t\t\t}\r\n\t\t};\r\n\t\tinst.icon = () => {\r\n\t\t\treturn form.icon || inst.model.icon;\r\n\t\t};\r\n\r\n\t\tinst.modelValue = (n, p) => {\r\n\t\t\tif (form.fields[n] && form.fields[n][p]) {\r\n\t\t\t\treturn form.fields[n][p];\r\n\t\t\t}\r\n\t\t\tlet mf = inst.field(n);\r\n\t\t\tif (mf && mf[p]) {\r\n\t\t\t\treturn mf[p];\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t};\r\n\r\n\t\tinst.label = (n) => {\r\n\t\t\tif (n) {\r\n\t\t\t\tlet r = inst.modelValue(n, \"label\");\r\n\t\t\t\tif (!r) r = inst.modelValue(n, \"name\");\r\n\t\t\t\t// console.log(n + \" \" + r + \" \" + inst.modelValue(n, \"label\"));\r\n\t\t\t\treturn r || n;\r\n\t\t\t}\r\n\t\t\treturn form.label || inst.model.label;\r\n\t\t};\r\n\r\n\t\tinst.placeholder = (n) => {\r\n\t\t\treturn inst.modelValue(n, \"placeholder\");\r\n\t\t};\r\n\r\n\t\tam7model.getModelFields(inst.model).forEach((f) => {\r\n\t\t\tinst.api[f.name] = (...v) => {\r\n\t\t\t\tif (!f.readOnly && v.length) {\r\n\t\t\t\t\tlet val = decorateInOut(true, v[0], f);\r\n\t\t\t\t\tinst.entity[f.name] = val;\r\n\t\t\t\t\tinst.change(f.name);\r\n\t\t\t\t\treport('update', f.name, inst);\r\n\t\t\t\t}\r\n\t\t\t\treturn decorateInOut(false, entity[f.name], f);\r\n\t\t\t};\r\n\r\n\t\t\tinst.dapi = (pn, ...v) => {\r\n\t\t\t\tif (v.length) {\r\n\t\t\t\t\tlet p = pn.split(\".\");\r\n\t\t\t\t\tlet op = p[0];\r\n\t\t\t\t\tinst.change(op);\r\n\t\t\t\t\tlet o = inst.entity;\r\n\r\n\t\t\t\t\tfor (let i = 0; i < (p.length - 1); i++) {\r\n\t\t\t\t\t\to = o[op];\r\n\t\t\t\t\t\top = p[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\to[p[p.length - 1]] = v[0];\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tlet field = am7view.formField(form, f.name);\r\n\r\n\t\t\tif (field && field.format == \"color\") {\r\n\t\t\t\tinst.decorate(f.name, colorDecorator);\r\n\t\t\t}\r\n\t\t\telse if (field && field.format == \"textlist\") {\r\n\t\t\t\tinst.decorate(f.name, textListDecorator);\r\n\t\t\t}\r\n\t\t\t/// f.type == \"zonetime\" || \r\n\t\t\telse if (f.type == \"zonetime\") {\r\n\t\t\t\tinst.decorate(f.name, dateTimeZDecorator);\r\n\t\t\t}\r\n\t\t\telse if (f.type == \"timestamp\" || f.type == \"datetime\") {\r\n\t\t\t\tinst.decorate(f.name, dateTimeDecorator);\r\n\t\t\t}\r\n\t\t\telse if (f.type == \"blob\") {\r\n\t\t\t\tinst.decorate(f.name, blobDecorator);\r\n\t\t\t}\r\n\t\t\telse if ((f.type == 'double' || f.type == 'int') && typeof f.minValue == \"number\" && typeof f.maxValue == \"number\" && form && field && field.format == \"range\") {\r\n\t\t\t\tinst.decorate(f.name, rangeDecorator);\r\n\t\t\t}\r\n\t\t\telse if (f.type == 'double' || f.type == 'int') {\r\n\t\t\t\tinst.decorate(f.name, numberDecorator);\r\n\t\t\t}\r\n\r\n\t\t\tinst.validateField[f.name] = (applyReplacement) => {\r\n\t\t\t\tif (field?.skipValidation) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tlet r = am7model.validateField(inst, f, f.rules, applyReplacement);\r\n\t\t\t\tinst.validations[f.name] = (r == 1);\r\n\t\t\t\tif (r == 0 && !inst.validationErrors[f.name]) {\r\n\t\t\t\t\tinst.validationErrors[f.name] = \"Invalid value for \" + f.name;\r\n\t\t\t\t}\r\n\t\t\t\telse if (r == 1) {\r\n\t\t\t\t\tdelete inst.validationErrors[f.name];\r\n\t\t\t\t}\r\n\t\t\t\treturn (r == 1);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tinst.validate = (applyReplacement) => {\r\n\t\t\tlet fv = [];\r\n\t\t\tam7model.getModelFields(inst.model).forEach((f) => {\r\n\t\t\t\tfv.push(inst.validateField[f.name](applyReplacement));\r\n\t\t\t});\r\n\t\t\treturn !fv.includes(false);\r\n\t\t}\r\n\r\n\t\tinst.handleChange = (n, fh) => {\r\n\t\t\tlet f = inst.field(n);\r\n\t\t\tif (!f) {\r\n\t\t\t\tconsole.warn(\"Invalid field: '\" + n + \"'\");\r\n\t\t\t}\r\n\t\t\treturn function (e) {\r\n\t\t\t\tlet v = e.target.value;\r\n\t\t\t\tif (e.target.type && e.target.type == \"checkbox\") {\r\n\t\t\t\t\tv = e.target.checked;\r\n\t\t\t\t}\r\n\t\t\t\telse if (f.type == \"string\" && typeof v == \"string\" && v.length == 0) {\r\n\t\t\t\t\tv = null;\r\n\t\t\t\t}\r\n\t\t\t\tinst.api[n](v);\r\n\t\t\t\tif (fh) fh(e);\r\n\t\t\t\tinst.action(n);\r\n\t\t\t\tinst.validateField[n]();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tinst.patch = () => {\r\n\t\t\tlet pent = {};\r\n\t\t\tlet b1id = 0;\r\n\t\t\tif (inst.changes.length == 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tam7model.getModelFields(inst.model).filter(f => {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t(\r\n\t\t\t\t\t\t(f.identity && inst.entity[f.name])\r\n\t\t\t\t\t\t||\r\n\t\t\t\t\t\tinst.changes.includes(f.name)\r\n\t\t\t\t\t\t||\r\n\t\t\t\t\t\tf.provider\r\n\t\t\t\t\t)\r\n\t\t\t\t\t&&\r\n\t\t\t\t\t/// Foreign entities can patch their own fields - except the initial foreign ref, which can only be set by updating this field\r\n\t\t\t\t\t/// !f.foreign\r\n\t\t\t\t\t/// &&\r\n\t\t\t\t\t!f.ephemeral\r\n\t\t\t\t\t&&\r\n\t\t\t\t\t!f.virtual\r\n\t\t\t\t);\r\n\t\t\t}).forEach(f => {\r\n\t\t\t\tif (!f.identity || !b1id) {\r\n\t\t\t\t\tif (f.identity) b1id++;\r\n\t\t\t\t\tpent[f.name] = entity[f.name];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tpent[am7model.jsonModelKey] = inst.model.name;\r\n\t\t\treturn pent;\r\n\t\t};\r\n\r\n\t\tinst.hasIdentity = () => {\r\n\t\t\treturn am7model.hasIdentity(entity);\r\n\t\t};\r\n\r\n\t\tlet om = am7model.observers.models[entity[am7model.jsonModelKey]];\r\n\t\tif (om) {\r\n\t\t\tom.forEach((o) => {\r\n\t\t\t\tobserve(o);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn inst;\r\n\t};\r\n\r\n}());\n\n;/* === common/ntc.js === */\n/*\r\n\r\n+-----------------------------------------------------------------+\r\n|     Created by Chirag Mehta - http://chir.ag/projects/ntc       |\r\n|-----------------------------------------------------------------|\r\n|               ntc js (Name that Color JavaScript)               |\r\n+-----------------------------------------------------------------+\r\n\r\nAll the functions, code, lists etc. have been written specifically\r\nfor the Name that Color JavaScript by Chirag Mehta unless otherwise\r\nspecified.\r\n\r\nThis script is released under the: Creative Commons License:\r\nAttribution 2.5 http://creativecommons.org/licenses/by/2.5/\r\n\r\nSample Usage:\r\n\r\n  <script type=\"text/javascript\" src=\"ntc.js\"></script>\r\n\r\n  <script type=\"text/javascript\">\r\n\r\n    var n_match  = ntc.name(\"#6195ED\");\r\n    n_rgb        = n_match[0]; // This is the RGB value of the closest matching color\r\n    n_name       = n_match[1]; // This is the text string for the name of the match\r\n    n_exactmatch = n_match[2]; // True if exact color match, False if close-match\r\n\r\n    alert(n_match);\r\n\r\n  </script>\r\n\r\n*/\r\n\r\nvar ntc = {\r\n    nameHash:{},\r\n    init: function() {\r\n      var color, rgb, hsl;\r\n      for(var i = 0; i < ntc.names.length; i++)\r\n      {\r\n        color = \"#\" + ntc.names[i][0];\r\n        rgb = ntc.rgb(color);\r\n        hsl = ntc.hsl(color);\r\n        ntc.nameHash[ntc.names[i][1].toLowerCase()] = i;\r\n        ntc.names[i].push(rgb[0], rgb[1], rgb[2], hsl[0], hsl[1], hsl[2]);\r\n      }\r\n    },\r\n    hex: function(color){\r\n        return ntc.names[ntc.nameHash[color.toLowerCase()]] || [\"#000000\", \"Invalid Color: \" + color, false];\r\n    },\r\n    name: function(color) {\r\n  \r\n      color = color.toUpperCase();\r\n      if(color.length < 3 || color.length > 7)\r\n        return [\"#000000\", \"Invalid Color: \" + color, false];\r\n      if(color.length % 3 == 0)\r\n        color = \"#\" + color;\r\n      if(color.length == 4)\r\n        color = \"#\" + color.substr(1, 1) + color.substr(1, 1) + color.substr(2, 1) + color.substr(2, 1) + color.substr(3, 1) + color.substr(3, 1);\r\n  \r\n      var rgb = ntc.rgb(color);\r\n      var r = rgb[0], g = rgb[1], b = rgb[2];\r\n      var hsl = ntc.hsl(color);\r\n      var h = hsl[0], s = hsl[1], l = hsl[2];\r\n      var ndf1 = 0; ndf2 = 0; ndf = 0;\r\n      var cl = -1, df = -1;\r\n  \r\n      for(var i = 0; i < ntc.names.length; i++)\r\n      {\r\n        if(color == \"#\" + ntc.names[i][0])\r\n          return [\"#\" + ntc.names[i][0], ntc.names[i][1], true];\r\n  \r\n        ndf1 = Math.pow(r - ntc.names[i][2], 2) + Math.pow(g - ntc.names[i][3], 2) + Math.pow(b - ntc.names[i][4], 2);\r\n        ndf2 = Math.pow(h - ntc.names[i][5], 2) + Math.pow(s - ntc.names[i][6], 2) + Math.pow(l - ntc.names[i][7], 2);\r\n        ndf = ndf1 + ndf2 * 2;\r\n        if(df < 0 || df > ndf)\r\n        {\r\n          df = ndf;\r\n          cl = i;\r\n        }\r\n      }\r\n  \r\n      return (cl < 0 ? [\"#000000\", \"Invalid Color: \" + color, false] : [\"#\" + ntc.names[cl][0], ntc.names[cl][1], false]);\r\n    },\r\n  \r\n    // adopted from: Farbtastic 1.2\r\n    // http://acko.net/dev/farbtastic\r\n    hsl: function (color) {\r\n  \r\n      var rgb = [parseInt('0x' + color.substring(1, 3)) / 255, parseInt('0x' + color.substring(3, 5)) / 255, parseInt('0x' + color.substring(5, 7)) / 255];\r\n      var min, max, delta, h, s, l;\r\n      var r = rgb[0], g = rgb[1], b = rgb[2];\r\n  \r\n      min = Math.min(r, Math.min(g, b));\r\n      max = Math.max(r, Math.max(g, b));\r\n      delta = max - min;\r\n      l = (min + max) / 2;\r\n  \r\n      s = 0;\r\n      if(l > 0 && l < 1)\r\n        s = delta / (l < 0.5 ? (2 * l) : (2 - 2 * l));\r\n  \r\n      h = 0;\r\n      if(delta > 0)\r\n      {\r\n        if (max == r && max != g) h += (g - b) / delta;\r\n        if (max == g && max != b) h += (2 + (b - r) / delta);\r\n        if (max == b && max != r) h += (4 + (r - g) / delta);\r\n        h /= 6;\r\n      }\r\n      return [parseInt(h * 255), parseInt(s * 255), parseInt(l * 255)];\r\n    },\r\n  \r\n    // adopted from: Farbtastic 1.2\r\n    // http://acko.net/dev/farbtastic\r\n    rgb: function(color) {\r\n      return [parseInt('0x' + color.substring(1, 3)), parseInt('0x' + color.substring(3, 5)),  parseInt('0x' + color.substring(5, 7))];\r\n    },\r\n  \r\n    names: [\r\n  [\"000000\", \"Black\"],\r\n  [\"000080\", \"Navy Blue\"],\r\n  [\"0000C8\", \"Dark Blue\"],\r\n  [\"0000FF\", \"Blue\"],\r\n  [\"000741\", \"Stratos\"],\r\n  [\"001B1C\", \"Swamp\"],\r\n  [\"002387\", \"Resolution Blue\"],\r\n  [\"002900\", \"Deep Fir\"],\r\n  [\"002E20\", \"Burnham\"],\r\n  [\"002FA7\", \"International Klein Blue\"],\r\n  [\"003153\", \"Prussian Blue\"],\r\n  [\"003366\", \"Midnight Blue\"],\r\n  [\"003399\", \"Smalt\"],\r\n  [\"003532\", \"Deep Teal\"],\r\n  [\"003E40\", \"Cyprus\"],\r\n  [\"004620\", \"Kaitoke Green\"],\r\n  [\"0047AB\", \"Cobalt\"],\r\n  [\"004816\", \"Crusoe\"],\r\n  [\"004950\", \"Sherpa Blue\"],\r\n  [\"0056A7\", \"Endeavour\"],\r\n  [\"00581A\", \"Camarone\"],\r\n  [\"0066CC\", \"Science Blue\"],\r\n  [\"0066FF\", \"Blue Ribbon\"],\r\n  [\"00755E\", \"Tropical Rain Forest\"],\r\n  [\"0076A3\", \"Allports\"],\r\n  [\"007BA7\", \"Deep Cerulean\"],\r\n  [\"007EC7\", \"Lochmara\"],\r\n  [\"007FFF\", \"Azure Radiance\"],\r\n  [\"008080\", \"Teal\"],\r\n  [\"0095B6\", \"Bondi Blue\"],\r\n  [\"009DC4\", \"Pacific Blue\"],\r\n  [\"00A693\", \"Persian Green\"],\r\n  [\"00A86B\", \"Jade\"],\r\n  [\"00CC99\", \"Caribbean Green\"],\r\n  [\"00CCCC\", \"Robin's Egg Blue\"],\r\n  [\"00FF00\", \"Green\"],\r\n  [\"00FF7F\", \"Spring Green\"],\r\n  [\"00FFFF\", \"Cyan / Aqua\"],\r\n  [\"010D1A\", \"Blue Charcoal\"],\r\n  [\"011635\", \"Midnight\"],\r\n  [\"011D13\", \"Holly\"],\r\n  [\"012731\", \"Daintree\"],\r\n  [\"01361C\", \"Cardin Green\"],\r\n  [\"01371A\", \"County Green\"],\r\n  [\"013E62\", \"Astronaut Blue\"],\r\n  [\"013F6A\", \"Regal Blue\"],\r\n  [\"014B43\", \"Aqua Deep\"],\r\n  [\"015E85\", \"Orient\"],\r\n  [\"016162\", \"Blue Stone\"],\r\n  [\"016D39\", \"Fun Green\"],\r\n  [\"01796F\", \"Pine Green\"],\r\n  [\"017987\", \"Blue Lagoon\"],\r\n  [\"01826B\", \"Deep Sea\"],\r\n  [\"01A368\", \"Green Haze\"],\r\n  [\"022D15\", \"English Holly\"],\r\n  [\"02402C\", \"Sherwood Green\"],\r\n  [\"02478E\", \"Congress Blue\"],\r\n  [\"024E46\", \"Evening Sea\"],\r\n  [\"026395\", \"Bahama Blue\"],\r\n  [\"02866F\", \"Observatory\"],\r\n  [\"02A4D3\", \"Cerulean\"],\r\n  [\"03163C\", \"Tangaroa\"],\r\n  [\"032B52\", \"Green Vogue\"],\r\n  [\"036A6E\", \"Mosque\"],\r\n  [\"041004\", \"Midnight Moss\"],\r\n  [\"041322\", \"Black Pearl\"],\r\n  [\"042E4C\", \"Blue Whale\"],\r\n  [\"044022\", \"Zuccini\"],\r\n  [\"044259\", \"Teal Blue\"],\r\n  [\"051040\", \"Deep Cove\"],\r\n  [\"051657\", \"Gulf Blue\"],\r\n  [\"055989\", \"Venice Blue\"],\r\n  [\"056F57\", \"Watercourse\"],\r\n  [\"062A78\", \"Catalina Blue\"],\r\n  [\"063537\", \"Tiber\"],\r\n  [\"069B81\", \"Gossamer\"],\r\n  [\"06A189\", \"Niagara\"],\r\n  [\"073A50\", \"Tarawera\"],\r\n  [\"080110\", \"Jaguar\"],\r\n  [\"081910\", \"Black Bean\"],\r\n  [\"082567\", \"Deep Sapphire\"],\r\n  [\"088370\", \"Elf Green\"],\r\n  [\"08E8DE\", \"Bright Turquoise\"],\r\n  [\"092256\", \"Downriver\"],\r\n  [\"09230F\", \"Palm Green\"],\r\n  [\"09255D\", \"Madison\"],\r\n  [\"093624\", \"Bottle Green\"],\r\n  [\"095859\", \"Deep Sea Green\"],\r\n  [\"097F4B\", \"Salem\"],\r\n  [\"0A001C\", \"Black Russian\"],\r\n  [\"0A480D\", \"Dark Fern\"],\r\n  [\"0A6906\", \"Japanese Laurel\"],\r\n  [\"0A6F75\", \"Atoll\"],\r\n  [\"0B0B0B\", \"Cod Gray\"],\r\n  [\"0B0F08\", \"Marshland\"],\r\n  [\"0B1107\", \"Gordons Green\"],\r\n  [\"0B1304\", \"Black Forest\"],\r\n  [\"0B6207\", \"San Felix\"],\r\n  [\"0BDA51\", \"Malachite\"],\r\n  [\"0C0B1D\", \"Ebony\"],\r\n  [\"0C0D0F\", \"Woodsmoke\"],\r\n  [\"0C1911\", \"Racing Green\"],\r\n  [\"0C7A79\", \"Surfie Green\"],\r\n  [\"0C8990\", \"Blue Chill\"],\r\n  [\"0D0332\", \"Black Rock\"],\r\n  [\"0D1117\", \"Bunker\"],\r\n  [\"0D1C19\", \"Aztec\"],\r\n  [\"0D2E1C\", \"Bush\"],\r\n  [\"0E0E18\", \"Cinder\"],\r\n  [\"0E2A30\", \"Firefly\"],\r\n  [\"0F2D9E\", \"Torea Bay\"],\r\n  [\"10121D\", \"Vulcan\"],\r\n  [\"101405\", \"Green Waterloo\"],\r\n  [\"105852\", \"Eden\"],\r\n  [\"110C6C\", \"Arapawa\"],\r\n  [\"120A8F\", \"Ultramarine\"],\r\n  [\"123447\", \"Elephant\"],\r\n  [\"126B40\", \"Jewel\"],\r\n  [\"130000\", \"Diesel\"],\r\n  [\"130A06\", \"Asphalt\"],\r\n  [\"13264D\", \"Blue Zodiac\"],\r\n  [\"134F19\", \"Parsley\"],\r\n  [\"140600\", \"Nero\"],\r\n  [\"1450AA\", \"Tory Blue\"],\r\n  [\"151F4C\", \"Bunting\"],\r\n  [\"1560BD\", \"Denim\"],\r\n  [\"15736B\", \"Genoa\"],\r\n  [\"161928\", \"Mirage\"],\r\n  [\"161D10\", \"Hunter Green\"],\r\n  [\"162A40\", \"Big Stone\"],\r\n  [\"163222\", \"Celtic\"],\r\n  [\"16322C\", \"Timber Green\"],\r\n  [\"163531\", \"Gable Green\"],\r\n  [\"171F04\", \"Pine Tree\"],\r\n  [\"175579\", \"Chathams Blue\"],\r\n  [\"182D09\", \"Deep Forest Green\"],\r\n  [\"18587A\", \"Blumine\"],\r\n  [\"19330E\", \"Palm Leaf\"],\r\n  [\"193751\", \"Nile Blue\"],\r\n  [\"1959A8\", \"Fun Blue\"],\r\n  [\"1A1A68\", \"Lucky Point\"],\r\n  [\"1AB385\", \"Mountain Meadow\"],\r\n  [\"1B0245\", \"Tolopea\"],\r\n  [\"1B1035\", \"Haiti\"],\r\n  [\"1B127B\", \"Deep Koamaru\"],\r\n  [\"1B1404\", \"Acadia\"],\r\n  [\"1B2F11\", \"Seaweed\"],\r\n  [\"1B3162\", \"Biscay\"],\r\n  [\"1B659D\", \"Matisse\"],\r\n  [\"1C1208\", \"Crowshead\"],\r\n  [\"1C1E13\", \"Rangoon Green\"],\r\n  [\"1C39BB\", \"Persian Blue\"],\r\n  [\"1C402E\", \"Everglade\"],\r\n  [\"1C7C7D\", \"Elm\"],\r\n  [\"1D6142\", \"Green Pea\"],\r\n  [\"1E0F04\", \"Creole\"],\r\n  [\"1E1609\", \"Karaka\"],\r\n  [\"1E1708\", \"El Paso\"],\r\n  [\"1E385B\", \"Cello\"],\r\n  [\"1E433C\", \"Te Papa Green\"],\r\n  [\"1E90FF\", \"Dodger Blue\"],\r\n  [\"1E9AB0\", \"Eastern Blue\"],\r\n  [\"1F120F\", \"Night Rider\"],\r\n  [\"1FC2C2\", \"Java\"],\r\n  [\"20208D\", \"Jacksons Purple\"],\r\n  [\"202E54\", \"Cloud Burst\"],\r\n  [\"204852\", \"Blue Dianne\"],\r\n  [\"211A0E\", \"Eternity\"],\r\n  [\"220878\", \"Deep Blue\"],\r\n  [\"228B22\", \"Forest Green\"],\r\n  [\"233418\", \"Mallard\"],\r\n  [\"240A40\", \"Violet\"],\r\n  [\"240C02\", \"Kilamanjaro\"],\r\n  [\"242A1D\", \"Log Cabin\"],\r\n  [\"242E16\", \"Black Olive\"],\r\n  [\"24500F\", \"Green House\"],\r\n  [\"251607\", \"Graphite\"],\r\n  [\"251706\", \"Cannon Black\"],\r\n  [\"251F4F\", \"Port Gore\"],\r\n  [\"25272C\", \"Shark\"],\r\n  [\"25311C\", \"Green Kelp\"],\r\n  [\"2596D1\", \"Curious Blue\"],\r\n  [\"260368\", \"Paua\"],\r\n  [\"26056A\", \"Paris M\"],\r\n  [\"261105\", \"Wood Bark\"],\r\n  [\"261414\", \"Gondola\"],\r\n  [\"262335\", \"Steel Gray\"],\r\n  [\"26283B\", \"Ebony Clay\"],\r\n  [\"273A81\", \"Bay of Many\"],\r\n  [\"27504B\", \"Plantation\"],\r\n  [\"278A5B\", \"Eucalyptus\"],\r\n  [\"281E15\", \"Oil\"],\r\n  [\"283A77\", \"Astronaut\"],\r\n  [\"286ACD\", \"Mariner\"],\r\n  [\"290C5E\", \"Violent Violet\"],\r\n  [\"292130\", \"Bastille\"],\r\n  [\"292319\", \"Zeus\"],\r\n  [\"292937\", \"Charade\"],\r\n  [\"297B9A\", \"Jelly Bean\"],\r\n  [\"29AB87\", \"Jungle Green\"],\r\n  [\"2A0359\", \"Cherry Pie\"],\r\n  [\"2A140E\", \"Coffee Bean\"],\r\n  [\"2A2630\", \"Baltic Sea\"],\r\n  [\"2A380B\", \"Turtle Green\"],\r\n  [\"2A52BE\", \"Cerulean Blue\"],\r\n  [\"2B0202\", \"Sepia Black\"],\r\n  [\"2B194F\", \"Valhalla\"],\r\n  [\"2B3228\", \"Heavy Metal\"],\r\n  [\"2C0E8C\", \"Blue Gem\"],\r\n  [\"2C1632\", \"Revolver\"],\r\n  [\"2C2133\", \"Bleached Cedar\"],\r\n  [\"2C8C84\", \"Lochinvar\"],\r\n  [\"2D2510\", \"Mikado\"],\r\n  [\"2D383A\", \"Outer Space\"],\r\n  [\"2D569B\", \"St Tropaz\"],\r\n  [\"2E0329\", \"Jacaranda\"],\r\n  [\"2E1905\", \"Jacko Bean\"],\r\n  [\"2E3222\", \"Rangitoto\"],\r\n  [\"2E3F62\", \"Rhino\"],\r\n  [\"2E8B57\", \"Sea Green\"],\r\n  [\"2EBFD4\", \"Scooter\"],\r\n  [\"2F270E\", \"Onion\"],\r\n  [\"2F3CB3\", \"Governor Bay\"],\r\n  [\"2F519E\", \"Sapphire\"],\r\n  [\"2F5A57\", \"Spectra\"],\r\n  [\"2F6168\", \"Casal\"],\r\n  [\"300529\", \"Melanzane\"],\r\n  [\"301F1E\", \"Cocoa Brown\"],\r\n  [\"302A0F\", \"Woodrush\"],\r\n  [\"304B6A\", \"San Juan\"],\r\n  [\"30D5C8\", \"Turquoise\"],\r\n  [\"311C17\", \"Eclipse\"],\r\n  [\"314459\", \"Pickled Bluewood\"],\r\n  [\"315BA1\", \"Azure\"],\r\n  [\"31728D\", \"Calypso\"],\r\n  [\"317D82\", \"Paradiso\"],\r\n  [\"32127A\", \"Persian Indigo\"],\r\n  [\"32293A\", \"Blackcurrant\"],\r\n  [\"323232\", \"Mine Shaft\"],\r\n  [\"325D52\", \"Stromboli\"],\r\n  [\"327C14\", \"Bilbao\"],\r\n  [\"327DA0\", \"Astral\"],\r\n  [\"33036B\", \"Christalle\"],\r\n  [\"33292F\", \"Thunder\"],\r\n  [\"33CC99\", \"Shamrock\"],\r\n  [\"341515\", \"Tamarind\"],\r\n  [\"350036\", \"Mardi Gras\"],\r\n  [\"350E42\", \"Valentino\"],\r\n  [\"350E57\", \"Jagger\"],\r\n  [\"353542\", \"Tuna\"],\r\n  [\"354E8C\", \"Chambray\"],\r\n  [\"363050\", \"Martinique\"],\r\n  [\"363534\", \"Tuatara\"],\r\n  [\"363C0D\", \"Waiouru\"],\r\n  [\"36747D\", \"Ming\"],\r\n  [\"368716\", \"La Palma\"],\r\n  [\"370202\", \"Chocolate\"],\r\n  [\"371D09\", \"Clinker\"],\r\n  [\"37290E\", \"Brown Tumbleweed\"],\r\n  [\"373021\", \"Birch\"],\r\n  [\"377475\", \"Oracle\"],\r\n  [\"380474\", \"Blue Diamond\"],\r\n  [\"381A51\", \"Grape\"],\r\n  [\"383533\", \"Dune\"],\r\n  [\"384555\", \"Oxford Blue\"],\r\n  [\"384910\", \"Clover\"],\r\n  [\"394851\", \"Limed Spruce\"],\r\n  [\"396413\", \"Dell\"],\r\n  [\"3A0020\", \"Toledo\"],\r\n  [\"3A2010\", \"Sambuca\"],\r\n  [\"3A2A6A\", \"Jacarta\"],\r\n  [\"3A686C\", \"William\"],\r\n  [\"3A6A47\", \"Killarney\"],\r\n  [\"3AB09E\", \"Keppel\"],\r\n  [\"3B000B\", \"Temptress\"],\r\n  [\"3B0910\", \"Aubergine\"],\r\n  [\"3B1F1F\", \"Jon\"],\r\n  [\"3B2820\", \"Treehouse\"],\r\n  [\"3B7A57\", \"Amazon\"],\r\n  [\"3B91B4\", \"Boston Blue\"],\r\n  [\"3C0878\", \"Windsor\"],\r\n  [\"3C1206\", \"Rebel\"],\r\n  [\"3C1F76\", \"Meteorite\"],\r\n  [\"3C2005\", \"Dark Ebony\"],\r\n  [\"3C3910\", \"Camouflage\"],\r\n  [\"3C4151\", \"Bright Gray\"],\r\n  [\"3C4443\", \"Cape Cod\"],\r\n  [\"3C493A\", \"Lunar Green\"],\r\n  [\"3D0C02\", \"Bean  \"],\r\n  [\"3D2B1F\", \"Bistre\"],\r\n  [\"3D7D52\", \"Goblin\"],\r\n  [\"3E0480\", \"Kingfisher Daisy\"],\r\n  [\"3E1C14\", \"Cedar\"],\r\n  [\"3E2B23\", \"English Walnut\"],\r\n  [\"3E2C1C\", \"Black Marlin\"],\r\n  [\"3E3A44\", \"Ship Gray\"],\r\n  [\"3EABBF\", \"Pelorous\"],\r\n  [\"3F2109\", \"Bronze\"],\r\n  [\"3F2500\", \"Cola\"],\r\n  [\"3F3002\", \"Madras\"],\r\n  [\"3F307F\", \"Minsk\"],\r\n  [\"3F4C3A\", \"Cabbage Pont\"],\r\n  [\"3F583B\", \"Tom Thumb\"],\r\n  [\"3F5D53\", \"Mineral Green\"],\r\n  [\"3FC1AA\", \"Puerto Rico\"],\r\n  [\"3FFF00\", \"Harlequin\"],\r\n  [\"401801\", \"Brown Pod\"],\r\n  [\"40291D\", \"Cork\"],\r\n  [\"403B38\", \"Masala\"],\r\n  [\"403D19\", \"Thatch Green\"],\r\n  [\"405169\", \"Fiord\"],\r\n  [\"40826D\", \"Viridian\"],\r\n  [\"40A860\", \"Chateau Green\"],\r\n  [\"410056\", \"Ripe Plum\"],\r\n  [\"411F10\", \"Paco\"],\r\n  [\"412010\", \"Deep Oak\"],\r\n  [\"413C37\", \"Merlin\"],\r\n  [\"414257\", \"Gun Powder\"],\r\n  [\"414C7D\", \"East Bay\"],\r\n  [\"4169E1\", \"Royal Blue\"],\r\n  [\"41AA78\", \"Ocean Green\"],\r\n  [\"420303\", \"Burnt Maroon\"],\r\n  [\"423921\", \"Lisbon Brown\"],\r\n  [\"427977\", \"Faded Jade\"],\r\n  [\"431560\", \"Scarlet Gum\"],\r\n  [\"433120\", \"Iroko\"],\r\n  [\"433E37\", \"Armadillo\"],\r\n  [\"434C59\", \"River Bed\"],\r\n  [\"436A0D\", \"Green Leaf\"],\r\n  [\"44012D\", \"Barossa\"],\r\n  [\"441D00\", \"Morocco Brown\"],\r\n  [\"444954\", \"Mako\"],\r\n  [\"454936\", \"Kelp\"],\r\n  [\"456CAC\", \"San Marino\"],\r\n  [\"45B1E8\", \"Picton Blue\"],\r\n  [\"460B41\", \"Loulou\"],\r\n  [\"462425\", \"Crater Brown\"],\r\n  [\"465945\", \"Gray Asparagus\"],\r\n  [\"4682B4\", \"Steel Blue\"],\r\n  [\"480404\", \"Rustic Red\"],\r\n  [\"480607\", \"Bulgarian Rose\"],\r\n  [\"480656\", \"Clairvoyant\"],\r\n  [\"481C1C\", \"Cocoa Bean\"],\r\n  [\"483131\", \"Woody Brown\"],\r\n  [\"483C32\", \"Taupe\"],\r\n  [\"49170C\", \"Van Cleef\"],\r\n  [\"492615\", \"Brown Derby\"],\r\n  [\"49371B\", \"Metallic Bronze\"],\r\n  [\"495400\", \"Verdun Green\"],\r\n  [\"496679\", \"Blue Bayoux\"],\r\n  [\"497183\", \"Bismark\"],\r\n  [\"4A2A04\", \"Bracken\"],\r\n  [\"4A3004\", \"Deep Bronze\"],\r\n  [\"4A3C30\", \"Mondo\"],\r\n  [\"4A4244\", \"Tundora\"],\r\n  [\"4A444B\", \"Gravel\"],\r\n  [\"4A4E5A\", \"Trout\"],\r\n  [\"4B0082\", \"Pigment Indigo\"],\r\n  [\"4B5D52\", \"Nandor\"],\r\n  [\"4C3024\", \"Saddle\"],\r\n  [\"4C4F56\", \"Abbey\"],\r\n  [\"4D0135\", \"Blackberry\"],\r\n  [\"4D0A18\", \"Cab Sav\"],\r\n  [\"4D1E01\", \"Indian Tan\"],\r\n  [\"4D282D\", \"Cowboy\"],\r\n  [\"4D282E\", \"Livid Brown\"],\r\n  [\"4D3833\", \"Rock\"],\r\n  [\"4D3D14\", \"Punga\"],\r\n  [\"4D400F\", \"Bronzetone\"],\r\n  [\"4D5328\", \"Woodland\"],\r\n  [\"4E0606\", \"Mahogany\"],\r\n  [\"4E2A5A\", \"Bossanova\"],\r\n  [\"4E3B41\", \"Matterhorn\"],\r\n  [\"4E420C\", \"Bronze Olive\"],\r\n  [\"4E4562\", \"Mulled Wine\"],\r\n  [\"4E6649\", \"Axolotl\"],\r\n  [\"4E7F9E\", \"Wedgewood\"],\r\n  [\"4EABD1\", \"Shakespeare\"],\r\n  [\"4F1C70\", \"Honey Flower\"],\r\n  [\"4F2398\", \"Daisy Bush\"],\r\n  [\"4F69C6\", \"Indigo\"],\r\n  [\"4F7942\", \"Fern Green\"],\r\n  [\"4F9D5D\", \"Fruit Salad\"],\r\n  [\"4FA83D\", \"Apple\"],\r\n  [\"504351\", \"Mortar\"],\r\n  [\"507096\", \"Kashmir Blue\"],\r\n  [\"507672\", \"Cutty Sark\"],\r\n  [\"50C878\", \"Emerald\"],\r\n  [\"514649\", \"Emperor\"],\r\n  [\"516E3D\", \"Chalet Green\"],\r\n  [\"517C66\", \"Como\"],\r\n  [\"51808F\", \"Smalt Blue\"],\r\n  [\"52001F\", \"Castro\"],\r\n  [\"520C17\", \"Maroon Oak\"],\r\n  [\"523C94\", \"Gigas\"],\r\n  [\"533455\", \"Voodoo\"],\r\n  [\"534491\", \"Victoria\"],\r\n  [\"53824B\", \"Hippie Green\"],\r\n  [\"541012\", \"Heath\"],\r\n  [\"544333\", \"Judge Gray\"],\r\n  [\"54534D\", \"Fuscous Gray\"],\r\n  [\"549019\", \"Vida Loca\"],\r\n  [\"55280C\", \"Cioccolato\"],\r\n  [\"555B10\", \"Saratoga\"],\r\n  [\"556D56\", \"Finlandia\"],\r\n  [\"5590D9\", \"Havelock Blue\"],\r\n  [\"56B4BE\", \"Fountain Blue\"],\r\n  [\"578363\", \"Spring Leaves\"],\r\n  [\"583401\", \"Saddle Brown\"],\r\n  [\"585562\", \"Scarpa Flow\"],\r\n  [\"587156\", \"Cactus\"],\r\n  [\"589AAF\", \"Hippie Blue\"],\r\n  [\"591D35\", \"Wine Berry\"],\r\n  [\"592804\", \"Brown Bramble\"],\r\n  [\"593737\", \"Congo Brown\"],\r\n  [\"594433\", \"Millbrook\"],\r\n  [\"5A6E9C\", \"Waikawa Gray\"],\r\n  [\"5A87A0\", \"Horizon\"],\r\n  [\"5B3013\", \"Jambalaya\"],\r\n  [\"5C0120\", \"Bordeaux\"],\r\n  [\"5C0536\", \"Mulberry Wood\"],\r\n  [\"5C2E01\", \"Carnaby Tan\"],\r\n  [\"5C5D75\", \"Comet\"],\r\n  [\"5D1E0F\", \"Redwood\"],\r\n  [\"5D4C51\", \"Don Juan\"],\r\n  [\"5D5C58\", \"Chicago\"],\r\n  [\"5D5E37\", \"Verdigris\"],\r\n  [\"5D7747\", \"Dingley\"],\r\n  [\"5DA19F\", \"Breaker Bay\"],\r\n  [\"5E483E\", \"Kabul\"],\r\n  [\"5E5D3B\", \"Hemlock\"],\r\n  [\"5F3D26\", \"Irish Coffee\"],\r\n  [\"5F5F6E\", \"Mid Gray\"],\r\n  [\"5F6672\", \"Shuttle Gray\"],\r\n  [\"5FA777\", \"Aqua Forest\"],\r\n  [\"5FB3AC\", \"Tradewind\"],\r\n  [\"604913\", \"Horses Neck\"],\r\n  [\"605B73\", \"Smoky\"],\r\n  [\"606E68\", \"Corduroy\"],\r\n  [\"6093D1\", \"Danube\"],\r\n  [\"612718\", \"Espresso\"],\r\n  [\"614051\", \"Eggplant\"],\r\n  [\"615D30\", \"Costa Del Sol\"],\r\n  [\"61845F\", \"Glade Green\"],\r\n  [\"622F30\", \"Buccaneer\"],\r\n  [\"623F2D\", \"Quincy\"],\r\n  [\"624E9A\", \"Butterfly Bush\"],\r\n  [\"625119\", \"West Coast\"],\r\n  [\"626649\", \"Finch\"],\r\n  [\"639A8F\", \"Patina\"],\r\n  [\"63B76C\", \"Fern\"],\r\n  [\"6456B7\", \"Blue Violet\"],\r\n  [\"646077\", \"Dolphin\"],\r\n  [\"646463\", \"Storm Dust\"],\r\n  [\"646A54\", \"Siam\"],\r\n  [\"646E75\", \"Nevada\"],\r\n  [\"6495ED\", \"Cornflower Blue\"],\r\n  [\"64CCDB\", \"Viking\"],\r\n  [\"65000B\", \"Rosewood\"],\r\n  [\"651A14\", \"Cherrywood\"],\r\n  [\"652DC1\", \"Purple Heart\"],\r\n  [\"657220\", \"Fern Frond\"],\r\n  [\"65745D\", \"Willow Grove\"],\r\n  [\"65869F\", \"Hoki\"],\r\n  [\"660045\", \"Pompadour\"],\r\n  [\"660099\", \"Purple\"],\r\n  [\"66023C\", \"Tyrian Purple\"],\r\n  [\"661010\", \"Dark Tan\"],\r\n  [\"66B58F\", \"Silver Tree\"],\r\n  [\"66FF00\", \"Bright Green\"],\r\n  [\"66FF66\", \"Screamin' Green\"],\r\n  [\"67032D\", \"Black Rose\"],\r\n  [\"675FA6\", \"Scampi\"],\r\n  [\"676662\", \"Ironside Gray\"],\r\n  [\"678975\", \"Viridian Green\"],\r\n  [\"67A712\", \"Christi\"],\r\n  [\"683600\", \"Nutmeg Wood Finish\"],\r\n  [\"685558\", \"Zambezi\"],\r\n  [\"685E6E\", \"Salt Box\"],\r\n  [\"692545\", \"Tawny Port\"],\r\n  [\"692D54\", \"Finn\"],\r\n  [\"695F62\", \"Scorpion\"],\r\n  [\"697E9A\", \"Lynch\"],\r\n  [\"6A442E\", \"Spice\"],\r\n  [\"6A5D1B\", \"Himalaya\"],\r\n  [\"6A6051\", \"Soya Bean\"],\r\n  [\"6B2A14\", \"Hairy Heath\"],\r\n  [\"6B3FA0\", \"Royal Purple\"],\r\n  [\"6B4E31\", \"Shingle Fawn\"],\r\n  [\"6B5755\", \"Dorado\"],\r\n  [\"6B8BA2\", \"Bermuda Gray\"],\r\n  [\"6B8E23\", \"Olive Drab\"],\r\n  [\"6C3082\", \"Eminence\"],\r\n  [\"6CDAE7\", \"Turquoise Blue\"],\r\n  [\"6D0101\", \"Lonestar\"],\r\n  [\"6D5E54\", \"Pine Cone\"],\r\n  [\"6D6C6C\", \"Dove Gray\"],\r\n  [\"6D9292\", \"Juniper\"],\r\n  [\"6D92A1\", \"Gothic\"],\r\n  [\"6E0902\", \"Red Oxide\"],\r\n  [\"6E1D14\", \"Moccaccino\"],\r\n  [\"6E4826\", \"Pickled Bean\"],\r\n  [\"6E4B26\", \"Dallas\"],\r\n  [\"6E6D57\", \"Kokoda\"],\r\n  [\"6E7783\", \"Pale Sky\"],\r\n  [\"6F440C\", \"Cafe Royale\"],\r\n  [\"6F6A61\", \"Flint\"],\r\n  [\"6F8E63\", \"Highland\"],\r\n  [\"6F9D02\", \"Limeade\"],\r\n  [\"6FD0C5\", \"Downy\"],\r\n  [\"701C1C\", \"Persian Plum\"],\r\n  [\"704214\", \"Sepia\"],\r\n  [\"704A07\", \"Antique Bronze\"],\r\n  [\"704F50\", \"Ferra\"],\r\n  [\"706555\", \"Coffee\"],\r\n  [\"708090\", \"Slate Gray\"],\r\n  [\"711A00\", \"Cedar Wood Finish\"],\r\n  [\"71291D\", \"Metallic Copper\"],\r\n  [\"714693\", \"Affair\"],\r\n  [\"714AB2\", \"Studio\"],\r\n  [\"715D47\", \"Tobacco Brown\"],\r\n  [\"716338\", \"Yellow Metal\"],\r\n  [\"716B56\", \"Peat\"],\r\n  [\"716E10\", \"Olivetone\"],\r\n  [\"717486\", \"Storm Gray\"],\r\n  [\"718080\", \"Sirocco\"],\r\n  [\"71D9E2\", \"Aquamarine Blue\"],\r\n  [\"72010F\", \"Venetian Red\"],\r\n  [\"724A2F\", \"Old Copper\"],\r\n  [\"726D4E\", \"Go Ben\"],\r\n  [\"727B89\", \"Raven\"],\r\n  [\"731E8F\", \"Seance\"],\r\n  [\"734A12\", \"Raw Umber\"],\r\n  [\"736C9F\", \"Kimberly\"],\r\n  [\"736D58\", \"Crocodile\"],\r\n  [\"737829\", \"Crete\"],\r\n  [\"738678\", \"Xanadu\"],\r\n  [\"74640D\", \"Spicy Mustard\"],\r\n  [\"747D63\", \"Limed Ash\"],\r\n  [\"747D83\", \"Rolling Stone\"],\r\n  [\"748881\", \"Blue Smoke\"],\r\n  [\"749378\", \"Laurel\"],\r\n  [\"74C365\", \"Mantis\"],\r\n  [\"755A57\", \"Russett\"],\r\n  [\"7563A8\", \"Deluge\"],\r\n  [\"76395D\", \"Cosmic\"],\r\n  [\"7666C6\", \"Blue Marguerite\"],\r\n  [\"76BD17\", \"Lima\"],\r\n  [\"76D7EA\", \"Sky Blue\"],\r\n  [\"770F05\", \"Dark Burgundy\"],\r\n  [\"771F1F\", \"Crown of Thorns\"],\r\n  [\"773F1A\", \"Walnut\"],\r\n  [\"776F61\", \"Pablo\"],\r\n  [\"778120\", \"Pacifika\"],\r\n  [\"779E86\", \"Oxley\"],\r\n  [\"77DD77\", \"Pastel Green\"],\r\n  [\"780109\", \"Japanese Maple\"],\r\n  [\"782D19\", \"Mocha\"],\r\n  [\"782F16\", \"Peanut\"],\r\n  [\"78866B\", \"Camouflage Green\"],\r\n  [\"788A25\", \"Wasabi\"],\r\n  [\"788BBA\", \"Ship Cove\"],\r\n  [\"78A39C\", \"Sea Nymph\"],\r\n  [\"795D4C\", \"Roman Coffee\"],\r\n  [\"796878\", \"Old Lavender\"],\r\n  [\"796989\", \"Rum\"],\r\n  [\"796A78\", \"Fedora\"],\r\n  [\"796D62\", \"Sandstone\"],\r\n  [\"79DEEC\", \"Spray\"],\r\n  [\"7A013A\", \"Siren\"],\r\n  [\"7A58C1\", \"Fuchsia Blue\"],\r\n  [\"7A7A7A\", \"Boulder\"],\r\n  [\"7A89B8\", \"Wild Blue Yonder\"],\r\n  [\"7AC488\", \"De York\"],\r\n  [\"7B3801\", \"Red Beech\"],\r\n  [\"7B3F00\", \"Cinnamon\"],\r\n  [\"7B6608\", \"Yukon Gold\"],\r\n  [\"7B7874\", \"Tapa\"],\r\n  [\"7B7C94\", \"Waterloo \"],\r\n  [\"7B8265\", \"Flax Smoke\"],\r\n  [\"7B9F80\", \"Amulet\"],\r\n  [\"7BA05B\", \"Asparagus\"],\r\n  [\"7C1C05\", \"Kenyan Copper\"],\r\n  [\"7C7631\", \"Pesto\"],\r\n  [\"7C778A\", \"Topaz\"],\r\n  [\"7C7B7A\", \"Concord\"],\r\n  [\"7C7B82\", \"Jumbo\"],\r\n  [\"7C881A\", \"Trendy Green\"],\r\n  [\"7CA1A6\", \"Gumbo\"],\r\n  [\"7CB0A1\", \"Acapulco\"],\r\n  [\"7CB7BB\", \"Neptune\"],\r\n  [\"7D2C14\", \"Pueblo\"],\r\n  [\"7DA98D\", \"Bay Leaf\"],\r\n  [\"7DC8F7\", \"Malibu\"],\r\n  [\"7DD8C6\", \"Bermuda\"],\r\n  [\"7E3A15\", \"Copper Canyon\"],\r\n  [\"7F1734\", \"Claret\"],\r\n  [\"7F3A02\", \"Peru Tan\"],\r\n  [\"7F626D\", \"Falcon\"],\r\n  [\"7F7589\", \"Mobster\"],\r\n  [\"7F76D3\", \"Moody Blue\"],\r\n  [\"7FFF00\", \"Chartreuse\"],\r\n  [\"7FFFD4\", \"Aquamarine\"],\r\n  [\"800000\", \"Maroon\"],\r\n  [\"800B47\", \"Rose Bud Cherry\"],\r\n  [\"801818\", \"Falu Red\"],\r\n  [\"80341F\", \"Red Robin\"],\r\n  [\"803790\", \"Vivid Violet\"],\r\n  [\"80461B\", \"Russet\"],\r\n  [\"807E79\", \"Friar Gray\"],\r\n  [\"808000\", \"Olive\"],\r\n  [\"808080\", \"Gray\"],\r\n  [\"80B3AE\", \"Gulf Stream\"],\r\n  [\"80B3C4\", \"Glacier\"],\r\n  [\"80CCEA\", \"Seagull\"],\r\n  [\"81422C\", \"Nutmeg\"],\r\n  [\"816E71\", \"Spicy Pink\"],\r\n  [\"817377\", \"Empress\"],\r\n  [\"819885\", \"Spanish Green\"],\r\n  [\"826F65\", \"Sand Dune\"],\r\n  [\"828685\", \"Gunsmoke\"],\r\n  [\"828F72\", \"Battleship Gray\"],\r\n  [\"831923\", \"Merlot\"],\r\n  [\"837050\", \"Shadow\"],\r\n  [\"83AA5D\", \"Chelsea Cucumber\"],\r\n  [\"83D0C6\", \"Monte Carlo\"],\r\n  [\"843179\", \"Plum\"],\r\n  [\"84A0A0\", \"Granny Smith\"],\r\n  [\"8581D9\", \"Chetwode Blue\"],\r\n  [\"858470\", \"Bandicoot\"],\r\n  [\"859FAF\", \"Bali Hai\"],\r\n  [\"85C4CC\", \"Half Baked\"],\r\n  [\"860111\", \"Red Devil\"],\r\n  [\"863C3C\", \"Lotus\"],\r\n  [\"86483C\", \"Ironstone\"],\r\n  [\"864D1E\", \"Bull Shot\"],\r\n  [\"86560A\", \"Rusty Nail\"],\r\n  [\"868974\", \"Bitter\"],\r\n  [\"86949F\", \"Regent Gray\"],\r\n  [\"871550\", \"Disco\"],\r\n  [\"87756E\", \"Americano\"],\r\n  [\"877C7B\", \"Hurricane\"],\r\n  [\"878D91\", \"Oslo Gray\"],\r\n  [\"87AB39\", \"Sushi\"],\r\n  [\"885342\", \"Spicy Mix\"],\r\n  [\"886221\", \"Kumera\"],\r\n  [\"888387\", \"Suva Gray\"],\r\n  [\"888D65\", \"Avocado\"],\r\n  [\"893456\", \"Camelot\"],\r\n  [\"893843\", \"Solid Pink\"],\r\n  [\"894367\", \"Cannon Pink\"],\r\n  [\"897D6D\", \"Makara\"],\r\n  [\"8A3324\", \"Burnt Umber\"],\r\n  [\"8A73D6\", \"True V\"],\r\n  [\"8A8360\", \"Clay Creek\"],\r\n  [\"8A8389\", \"Monsoon\"],\r\n  [\"8A8F8A\", \"Stack\"],\r\n  [\"8AB9F1\", \"Jordy Blue\"],\r\n  [\"8B00FF\", \"Electric Violet\"],\r\n  [\"8B0723\", \"Monarch\"],\r\n  [\"8B6B0B\", \"Corn Harvest\"],\r\n  [\"8B8470\", \"Olive Haze\"],\r\n  [\"8B847E\", \"Schooner\"],\r\n  [\"8B8680\", \"Natural Gray\"],\r\n  [\"8B9C90\", \"Mantle\"],\r\n  [\"8B9FEE\", \"Portage\"],\r\n  [\"8BA690\", \"Envy\"],\r\n  [\"8BA9A5\", \"Cascade\"],\r\n  [\"8BE6D8\", \"Riptide\"],\r\n  [\"8C055E\", \"Cardinal Pink\"],\r\n  [\"8C472F\", \"Mule Fawn\"],\r\n  [\"8C5738\", \"Potters Clay\"],\r\n  [\"8C6495\", \"Trendy Pink\"],\r\n  [\"8D0226\", \"Paprika\"],\r\n  [\"8D3D38\", \"Sanguine Brown\"],\r\n  [\"8D3F3F\", \"Tosca\"],\r\n  [\"8D7662\", \"Cement\"],\r\n  [\"8D8974\", \"Granite Green\"],\r\n  [\"8D90A1\", \"Manatee\"],\r\n  [\"8DA8CC\", \"Polo Blue\"],\r\n  [\"8E0000\", \"Red Berry\"],\r\n  [\"8E4D1E\", \"Rope\"],\r\n  [\"8E6F70\", \"Opium\"],\r\n  [\"8E775E\", \"Domino\"],\r\n  [\"8E8190\", \"Mamba\"],\r\n  [\"8EABC1\", \"Nepal\"],\r\n  [\"8F021C\", \"Pohutukawa\"],\r\n  [\"8F3E33\", \"El Salva\"],\r\n  [\"8F4B0E\", \"Korma\"],\r\n  [\"8F8176\", \"Squirrel\"],\r\n  [\"8FD6B4\", \"Vista Blue\"],\r\n  [\"900020\", \"Burgundy\"],\r\n  [\"901E1E\", \"Old Brick\"],\r\n  [\"907874\", \"Hemp\"],\r\n  [\"907B71\", \"Almond Frost\"],\r\n  [\"908D39\", \"Sycamore\"],\r\n  [\"92000A\", \"Sangria\"],\r\n  [\"924321\", \"Cumin\"],\r\n  [\"926F5B\", \"Beaver\"],\r\n  [\"928573\", \"Stonewall\"],\r\n  [\"928590\", \"Venus\"],\r\n  [\"9370DB\", \"Medium Purple\"],\r\n  [\"93CCEA\", \"Cornflower\"],\r\n  [\"93DFB8\", \"Algae Green\"],\r\n  [\"944747\", \"Copper Rust\"],\r\n  [\"948771\", \"Arrowtown\"],\r\n  [\"950015\", \"Scarlett\"],\r\n  [\"956387\", \"Strikemaster\"],\r\n  [\"959396\", \"Mountain Mist\"],\r\n  [\"960018\", \"Carmine\"],\r\n  [\"964B00\", \"Brown\"],\r\n  [\"967059\", \"Leather\"],\r\n  [\"9678B6\", \"Purple Mountain's Majesty\"],\r\n  [\"967BB6\", \"Lavender Purple\"],\r\n  [\"96A8A1\", \"Pewter\"],\r\n  [\"96BBAB\", \"Summer Green\"],\r\n  [\"97605D\", \"Au Chico\"],\r\n  [\"9771B5\", \"Wisteria\"],\r\n  [\"97CD2D\", \"Atlantis\"],\r\n  [\"983D61\", \"Vin Rouge\"],\r\n  [\"9874D3\", \"Lilac Bush\"],\r\n  [\"98777B\", \"Bazaar\"],\r\n  [\"98811B\", \"Hacienda\"],\r\n  [\"988D77\", \"Pale Oyster\"],\r\n  [\"98FF98\", \"Mint Green\"],\r\n  [\"990066\", \"Fresh Eggplant\"],\r\n  [\"991199\", \"Violet Eggplant\"],\r\n  [\"991613\", \"Tamarillo\"],\r\n  [\"991B07\", \"Totem Pole\"],\r\n  [\"996666\", \"Copper Rose\"],\r\n  [\"9966CC\", \"Amethyst\"],\r\n  [\"997A8D\", \"Mountbatten Pink\"],\r\n  [\"9999CC\", \"Blue Bell\"],\r\n  [\"9A3820\", \"Prairie Sand\"],\r\n  [\"9A6E61\", \"Toast\"],\r\n  [\"9A9577\", \"Gurkha\"],\r\n  [\"9AB973\", \"Olivine\"],\r\n  [\"9AC2B8\", \"Shadow Green\"],\r\n  [\"9B4703\", \"Oregon\"],\r\n  [\"9B9E8F\", \"Lemon Grass\"],\r\n  [\"9C3336\", \"Stiletto\"],\r\n  [\"9D5616\", \"Hawaiian Tan\"],\r\n  [\"9DACB7\", \"Gull Gray\"],\r\n  [\"9DC209\", \"Pistachio\"],\r\n  [\"9DE093\", \"Granny Smith Apple\"],\r\n  [\"9DE5FF\", \"Anakiwa\"],\r\n  [\"9E5302\", \"Chelsea Gem\"],\r\n  [\"9E5B40\", \"Sepia Skin\"],\r\n  [\"9EA587\", \"Sage\"],\r\n  [\"9EA91F\", \"Citron\"],\r\n  [\"9EB1CD\", \"Rock Blue\"],\r\n  [\"9EDEE0\", \"Morning Glory\"],\r\n  [\"9F381D\", \"Cognac\"],\r\n  [\"9F821C\", \"Reef Gold\"],\r\n  [\"9F9F9C\", \"Star Dust\"],\r\n  [\"9FA0B1\", \"Santas Gray\"],\r\n  [\"9FD7D3\", \"Sinbad\"],\r\n  [\"9FDD8C\", \"Feijoa\"],\r\n  [\"A02712\", \"Tabasco\"],\r\n  [\"A1750D\", \"Buttered Rum\"],\r\n  [\"A1ADB5\", \"Hit Gray\"],\r\n  [\"A1C50A\", \"Citrus\"],\r\n  [\"A1DAD7\", \"Aqua Island\"],\r\n  [\"A1E9DE\", \"Water Leaf\"],\r\n  [\"A2006D\", \"Flirt\"],\r\n  [\"A23B6C\", \"Rouge\"],\r\n  [\"A26645\", \"Cape Palliser\"],\r\n  [\"A2AAB3\", \"Gray Chateau\"],\r\n  [\"A2AEAB\", \"Edward\"],\r\n  [\"A3807B\", \"Pharlap\"],\r\n  [\"A397B4\", \"Amethyst Smoke\"],\r\n  [\"A3E3ED\", \"Blizzard Blue\"],\r\n  [\"A4A49D\", \"Delta\"],\r\n  [\"A4A6D3\", \"Wistful\"],\r\n  [\"A4AF6E\", \"Green Smoke\"],\r\n  [\"A50B5E\", \"Jazzberry Jam\"],\r\n  [\"A59B91\", \"Zorba\"],\r\n  [\"A5CB0C\", \"Bahia\"],\r\n  [\"A62F20\", \"Roof Terracotta\"],\r\n  [\"A65529\", \"Paarl\"],\r\n  [\"A68B5B\", \"Barley Corn\"],\r\n  [\"A69279\", \"Donkey Brown\"],\r\n  [\"A6A29A\", \"Dawn\"],\r\n  [\"A72525\", \"Mexican Red\"],\r\n  [\"A7882C\", \"Luxor Gold\"],\r\n  [\"A85307\", \"Rich Gold\"],\r\n  [\"A86515\", \"Reno Sand\"],\r\n  [\"A86B6B\", \"Coral Tree\"],\r\n  [\"A8989B\", \"Dusty Gray\"],\r\n  [\"A899E6\", \"Dull Lavender\"],\r\n  [\"A8A589\", \"Tallow\"],\r\n  [\"A8AE9C\", \"Bud\"],\r\n  [\"A8AF8E\", \"Locust\"],\r\n  [\"A8BD9F\", \"Norway\"],\r\n  [\"A8E3BD\", \"Chinook\"],\r\n  [\"A9A491\", \"Gray Olive\"],\r\n  [\"A9ACB6\", \"Aluminium\"],\r\n  [\"A9B2C3\", \"Cadet Blue\"],\r\n  [\"A9B497\", \"Schist\"],\r\n  [\"A9BDBF\", \"Tower Gray\"],\r\n  [\"A9BEF2\", \"Perano\"],\r\n  [\"A9C6C2\", \"Opal\"],\r\n  [\"AA375A\", \"Night Shadz\"],\r\n  [\"AA4203\", \"Fire\"],\r\n  [\"AA8B5B\", \"Muesli\"],\r\n  [\"AA8D6F\", \"Sandal\"],\r\n  [\"AAA5A9\", \"Shady Lady\"],\r\n  [\"AAA9CD\", \"Logan\"],\r\n  [\"AAABB7\", \"Spun Pearl\"],\r\n  [\"AAD6E6\", \"Regent St Blue\"],\r\n  [\"AAF0D1\", \"Magic Mint\"],\r\n  [\"AB0563\", \"Lipstick\"],\r\n  [\"AB3472\", \"Royal Heath\"],\r\n  [\"AB917A\", \"Sandrift\"],\r\n  [\"ABA0D9\", \"Cold Purple\"],\r\n  [\"ABA196\", \"Bronco\"],\r\n  [\"AC8A56\", \"Limed Oak\"],\r\n  [\"AC91CE\", \"East Side\"],\r\n  [\"AC9E22\", \"Lemon Ginger\"],\r\n  [\"ACA494\", \"Napa\"],\r\n  [\"ACA586\", \"Hillary\"],\r\n  [\"ACA59F\", \"Cloudy\"],\r\n  [\"ACACAC\", \"Silver Chalice\"],\r\n  [\"ACB78E\", \"Swamp Green\"],\r\n  [\"ACCBB1\", \"Spring Rain\"],\r\n  [\"ACDD4D\", \"Conifer\"],\r\n  [\"ACE1AF\", \"Celadon\"],\r\n  [\"AD781B\", \"Mandalay\"],\r\n  [\"ADBED1\", \"Casper\"],\r\n  [\"ADDFAD\", \"Moss Green\"],\r\n  [\"ADE6C4\", \"Padua\"],\r\n  [\"ADFF2F\", \"Green Yellow\"],\r\n  [\"AE4560\", \"Hippie Pink\"],\r\n  [\"AE6020\", \"Desert\"],\r\n  [\"AE809E\", \"Bouquet\"],\r\n  [\"AF4035\", \"Medium Carmine\"],\r\n  [\"AF4D43\", \"Apple Blossom\"],\r\n  [\"AF593E\", \"Brown Rust\"],\r\n  [\"AF8751\", \"Driftwood\"],\r\n  [\"AF8F2C\", \"Alpine\"],\r\n  [\"AF9F1C\", \"Lucky\"],\r\n  [\"AFA09E\", \"Martini\"],\r\n  [\"AFB1B8\", \"Bombay\"],\r\n  [\"AFBDD9\", \"Pigeon Post\"],\r\n  [\"B04C6A\", \"Cadillac\"],\r\n  [\"B05D54\", \"Matrix\"],\r\n  [\"B05E81\", \"Tapestry\"],\r\n  [\"B06608\", \"Mai Tai\"],\r\n  [\"B09A95\", \"Del Rio\"],\r\n  [\"B0E0E6\", \"Powder Blue\"],\r\n  [\"B0E313\", \"Inch Worm\"],\r\n  [\"B10000\", \"Bright Red\"],\r\n  [\"B14A0B\", \"Vesuvius\"],\r\n  [\"B1610B\", \"Pumpkin Skin\"],\r\n  [\"B16D52\", \"Santa Fe\"],\r\n  [\"B19461\", \"Teak\"],\r\n  [\"B1E2C1\", \"Fringy Flower\"],\r\n  [\"B1F4E7\", \"Ice Cold\"],\r\n  [\"B20931\", \"Shiraz\"],\r\n  [\"B2A1EA\", \"Biloba Flower\"],\r\n  [\"B32D29\", \"Tall Poppy\"],\r\n  [\"B35213\", \"Fiery Orange\"],\r\n  [\"B38007\", \"Hot Toddy\"],\r\n  [\"B3AF95\", \"Taupe Gray\"],\r\n  [\"B3C110\", \"La Rioja\"],\r\n  [\"B43332\", \"Well Read\"],\r\n  [\"B44668\", \"Blush\"],\r\n  [\"B4CFD3\", \"Jungle Mist\"],\r\n  [\"B57281\", \"Turkish Rose\"],\r\n  [\"B57EDC\", \"Lavender\"],\r\n  [\"B5A27F\", \"Mongoose\"],\r\n  [\"B5B35C\", \"Olive Green\"],\r\n  [\"B5D2CE\", \"Jet Stream\"],\r\n  [\"B5ECDF\", \"Cruise\"],\r\n  [\"B6316C\", \"Hibiscus\"],\r\n  [\"B69D98\", \"Thatch\"],\r\n  [\"B6B095\", \"Heathered Gray\"],\r\n  [\"B6BAA4\", \"Eagle\"],\r\n  [\"B6D1EA\", \"Spindle\"],\r\n  [\"B6D3BF\", \"Gum Leaf\"],\r\n  [\"B7410E\", \"Rust\"],\r\n  [\"B78E5C\", \"Muddy Waters\"],\r\n  [\"B7A214\", \"Sahara\"],\r\n  [\"B7A458\", \"Husk\"],\r\n  [\"B7B1B1\", \"Nobel\"],\r\n  [\"B7C3D0\", \"Heather\"],\r\n  [\"B7F0BE\", \"Madang\"],\r\n  [\"B81104\", \"Milano Red\"],\r\n  [\"B87333\", \"Copper\"],\r\n  [\"B8B56A\", \"Gimblet\"],\r\n  [\"B8C1B1\", \"Green Spring\"],\r\n  [\"B8C25D\", \"Celery\"],\r\n  [\"B8E0F9\", \"Sail\"],\r\n  [\"B94E48\", \"Chestnut\"],\r\n  [\"B95140\", \"Crail\"],\r\n  [\"B98D28\", \"Marigold\"],\r\n  [\"B9C46A\", \"Wild Willow\"],\r\n  [\"B9C8AC\", \"Rainee\"],\r\n  [\"BA0101\", \"Guardsman Red\"],\r\n  [\"BA450C\", \"Rock Spray\"],\r\n  [\"BA6F1E\", \"Bourbon\"],\r\n  [\"BA7F03\", \"Pirate Gold\"],\r\n  [\"BAB1A2\", \"Nomad\"],\r\n  [\"BAC7C9\", \"Submarine\"],\r\n  [\"BAEEF9\", \"Charlotte\"],\r\n  [\"BB3385\", \"Medium Red Violet\"],\r\n  [\"BB8983\", \"Brandy Rose\"],\r\n  [\"BBD009\", \"Rio Grande\"],\r\n  [\"BBD7C1\", \"Surf\"],\r\n  [\"BCC9C2\", \"Powder Ash\"],\r\n  [\"BD5E2E\", \"Tuscany\"],\r\n  [\"BD978E\", \"Quicksand\"],\r\n  [\"BDB1A8\", \"Silk\"],\r\n  [\"BDB2A1\", \"Malta\"],\r\n  [\"BDB3C7\", \"Chatelle\"],\r\n  [\"BDBBD7\", \"Lavender Gray\"],\r\n  [\"BDBDC6\", \"French Gray\"],\r\n  [\"BDC8B3\", \"Clay Ash\"],\r\n  [\"BDC9CE\", \"Loblolly\"],\r\n  [\"BDEDFD\", \"French Pass\"],\r\n  [\"BEA6C3\", \"London Hue\"],\r\n  [\"BEB5B7\", \"Pink Swan\"],\r\n  [\"BEDE0D\", \"Fuego\"],\r\n  [\"BF5500\", \"Rose of Sharon\"],\r\n  [\"BFB8B0\", \"Tide\"],\r\n  [\"BFBED8\", \"Blue Haze\"],\r\n  [\"BFC1C2\", \"Silver Sand\"],\r\n  [\"BFC921\", \"Key Lime Pie\"],\r\n  [\"BFDBE2\", \"Ziggurat\"],\r\n  [\"BFFF00\", \"Lime\"],\r\n  [\"C02B18\", \"Thunderbird\"],\r\n  [\"C04737\", \"Mojo\"],\r\n  [\"C08081\", \"Old Rose\"],\r\n  [\"C0C0C0\", \"Silver\"],\r\n  [\"C0D3B9\", \"Pale Leaf\"],\r\n  [\"C0D8B6\", \"Pixie Green\"],\r\n  [\"C1440E\", \"Tia Maria\"],\r\n  [\"C154C1\", \"Fuchsia Pink\"],\r\n  [\"C1A004\", \"Buddha Gold\"],\r\n  [\"C1B7A4\", \"Bison Hide\"],\r\n  [\"C1BAB0\", \"Tea\"],\r\n  [\"C1BECD\", \"Gray Suit\"],\r\n  [\"C1D7B0\", \"Sprout\"],\r\n  [\"C1F07C\", \"Sulu\"],\r\n  [\"C26B03\", \"Indochine\"],\r\n  [\"C2955D\", \"Twine\"],\r\n  [\"C2BDB6\", \"Cotton Seed\"],\r\n  [\"C2CAC4\", \"Pumice\"],\r\n  [\"C2E8E5\", \"Jagged Ice\"],\r\n  [\"C32148\", \"Maroon Flush\"],\r\n  [\"C3B091\", \"Indian Khaki\"],\r\n  [\"C3BFC1\", \"Pale Slate\"],\r\n  [\"C3C3BD\", \"Gray Nickel\"],\r\n  [\"C3CDE6\", \"Periwinkle Gray\"],\r\n  [\"C3D1D1\", \"Tiara\"],\r\n  [\"C3DDF9\", \"Tropical Blue\"],\r\n  [\"C41E3A\", \"Cardinal\"],\r\n  [\"C45655\", \"Fuzzy Wuzzy Brown\"],\r\n  [\"C45719\", \"Orange Roughy\"],\r\n  [\"C4C4BC\", \"Mist Gray\"],\r\n  [\"C4D0B0\", \"Coriander\"],\r\n  [\"C4F4EB\", \"Mint Tulip\"],\r\n  [\"C54B8C\", \"Mulberry\"],\r\n  [\"C59922\", \"Nugget\"],\r\n  [\"C5994B\", \"Tussock\"],\r\n  [\"C5DBCA\", \"Sea Mist\"],\r\n  [\"C5E17A\", \"Yellow Green\"],\r\n  [\"C62D42\", \"Brick Red\"],\r\n  [\"C6726B\", \"Contessa\"],\r\n  [\"C69191\", \"Oriental Pink\"],\r\n  [\"C6A84B\", \"Roti\"],\r\n  [\"C6C3B5\", \"Ash\"],\r\n  [\"C6C8BD\", \"Kangaroo\"],\r\n  [\"C6E610\", \"Las Palmas\"],\r\n  [\"C7031E\", \"Monza\"],\r\n  [\"C71585\", \"Red Violet\"],\r\n  [\"C7BCA2\", \"Coral Reef\"],\r\n  [\"C7C1FF\", \"Melrose\"],\r\n  [\"C7C4BF\", \"Cloud\"],\r\n  [\"C7C9D5\", \"Ghost\"],\r\n  [\"C7CD90\", \"Pine Glade\"],\r\n  [\"C7DDE5\", \"Botticelli\"],\r\n  [\"C88A65\", \"Antique Brass\"],\r\n  [\"C8A2C8\", \"Lilac\"],\r\n  [\"C8A528\", \"Hokey Pokey\"],\r\n  [\"C8AABF\", \"Lily\"],\r\n  [\"C8B568\", \"Laser\"],\r\n  [\"C8E3D7\", \"Edgewater\"],\r\n  [\"C96323\", \"Piper\"],\r\n  [\"C99415\", \"Pizza\"],\r\n  [\"C9A0DC\", \"Light Wisteria\"],\r\n  [\"C9B29B\", \"Rodeo Dust\"],\r\n  [\"C9B35B\", \"Sundance\"],\r\n  [\"C9B93B\", \"Earls Green\"],\r\n  [\"C9C0BB\", \"Silver Rust\"],\r\n  [\"C9D9D2\", \"Conch\"],\r\n  [\"C9FFA2\", \"Reef\"],\r\n  [\"C9FFE5\", \"Aero Blue\"],\r\n  [\"CA3435\", \"Flush Mahogany\"],\r\n  [\"CABB48\", \"Turmeric\"],\r\n  [\"CADCD4\", \"Paris White\"],\r\n  [\"CAE00D\", \"Bitter Lemon\"],\r\n  [\"CAE6DA\", \"Skeptic\"],\r\n  [\"CB8FA9\", \"Viola\"],\r\n  [\"CBCAB6\", \"Foggy Gray\"],\r\n  [\"CBD3B0\", \"Green Mist\"],\r\n  [\"CBDBD6\", \"Nebula\"],\r\n  [\"CC3333\", \"Persian Red\"],\r\n  [\"CC5500\", \"Burnt Orange\"],\r\n  [\"CC7722\", \"Ochre\"],\r\n  [\"CC8899\", \"Puce\"],\r\n  [\"CCCAA8\", \"Thistle Green\"],\r\n  [\"CCCCFF\", \"Periwinkle\"],\r\n  [\"CCFF00\", \"Electric Lime\"],\r\n  [\"CD5700\", \"Tenn\"],\r\n  [\"CD5C5C\", \"Chestnut Rose\"],\r\n  [\"CD8429\", \"Brandy Punch\"],\r\n  [\"CDF4FF\", \"Onahau\"],\r\n  [\"CEB98F\", \"Sorrell Brown\"],\r\n  [\"CEBABA\", \"Cold Turkey\"],\r\n  [\"CEC291\", \"Yuma\"],\r\n  [\"CEC7A7\", \"Chino\"],\r\n  [\"CFA39D\", \"Eunry\"],\r\n  [\"CFB53B\", \"Old Gold\"],\r\n  [\"CFDCCF\", \"Tasman\"],\r\n  [\"CFE5D2\", \"Surf Crest\"],\r\n  [\"CFF9F3\", \"Humming Bird\"],\r\n  [\"CFFAF4\", \"Scandal\"],\r\n  [\"D05F04\", \"Red Stage\"],\r\n  [\"D06DA1\", \"Hopbush\"],\r\n  [\"D07D12\", \"Meteor\"],\r\n  [\"D0BEF8\", \"Perfume\"],\r\n  [\"D0C0E5\", \"Prelude\"],\r\n  [\"D0F0C0\", \"Tea Green\"],\r\n  [\"D18F1B\", \"Geebung\"],\r\n  [\"D1BEA8\", \"Vanilla\"],\r\n  [\"D1C6B4\", \"Soft Amber\"],\r\n  [\"D1D2CA\", \"Celeste\"],\r\n  [\"D1D2DD\", \"Mischka\"],\r\n  [\"D1E231\", \"Pear\"],\r\n  [\"D2691E\", \"Hot Cinnamon\"],\r\n  [\"D27D46\", \"Raw Sienna\"],\r\n  [\"D29EAA\", \"Careys Pink\"],\r\n  [\"D2B48C\", \"Tan\"],\r\n  [\"D2DA97\", \"Deco\"],\r\n  [\"D2F6DE\", \"Blue Romance\"],\r\n  [\"D2F8B0\", \"Gossip\"],\r\n  [\"D3CBBA\", \"Sisal\"],\r\n  [\"D3CDC5\", \"Swirl\"],\r\n  [\"D47494\", \"Charm\"],\r\n  [\"D4B6AF\", \"Clam Shell\"],\r\n  [\"D4BF8D\", \"Straw\"],\r\n  [\"D4C4A8\", \"Akaroa\"],\r\n  [\"D4CD16\", \"Bird Flower\"],\r\n  [\"D4D7D9\", \"Iron\"],\r\n  [\"D4DFE2\", \"Geyser\"],\r\n  [\"D4E2FC\", \"Hawkes Blue\"],\r\n  [\"D54600\", \"Grenadier\"],\r\n  [\"D591A4\", \"Can Can\"],\r\n  [\"D59A6F\", \"Whiskey\"],\r\n  [\"D5D195\", \"Winter Hazel\"],\r\n  [\"D5F6E3\", \"Granny Apple\"],\r\n  [\"D69188\", \"My Pink\"],\r\n  [\"D6C562\", \"Tacha\"],\r\n  [\"D6CEF6\", \"Moon Raker\"],\r\n  [\"D6D6D1\", \"Quill Gray\"],\r\n  [\"D6FFDB\", \"Snowy Mint\"],\r\n  [\"D7837F\", \"New York Pink\"],\r\n  [\"D7C498\", \"Pavlova\"],\r\n  [\"D7D0FF\", \"Fog\"],\r\n  [\"D84437\", \"Valencia\"],\r\n  [\"D87C63\", \"Japonica\"],\r\n  [\"D8BFD8\", \"Thistle\"],\r\n  [\"D8C2D5\", \"Maverick\"],\r\n  [\"D8FCFA\", \"Foam\"],\r\n  [\"D94972\", \"Cabaret\"],\r\n  [\"D99376\", \"Burning Sand\"],\r\n  [\"D9B99B\", \"Cameo\"],\r\n  [\"D9D6CF\", \"Timberwolf\"],\r\n  [\"D9DCC1\", \"Tana\"],\r\n  [\"D9E4F5\", \"Link Water\"],\r\n  [\"D9F7FF\", \"Mabel\"],\r\n  [\"DA3287\", \"Cerise\"],\r\n  [\"DA5B38\", \"Flame Pea\"],\r\n  [\"DA6304\", \"Bamboo\"],\r\n  [\"DA6A41\", \"Red Damask\"],\r\n  [\"DA70D6\", \"Orchid\"],\r\n  [\"DA8A67\", \"Copperfield\"],\r\n  [\"DAA520\", \"Golden Grass\"],\r\n  [\"DAECD6\", \"Zanah\"],\r\n  [\"DAF4F0\", \"Iceberg\"],\r\n  [\"DAFAFF\", \"Oyster Bay\"],\r\n  [\"DB5079\", \"Cranberry\"],\r\n  [\"DB9690\", \"Petite Orchid\"],\r\n  [\"DB995E\", \"Di Serria\"],\r\n  [\"DBDBDB\", \"Alto\"],\r\n  [\"DBFFF8\", \"Frosted Mint\"],\r\n  [\"DC143C\", \"Crimson\"],\r\n  [\"DC4333\", \"Punch\"],\r\n  [\"DCB20C\", \"Galliano\"],\r\n  [\"DCB4BC\", \"Blossom\"],\r\n  [\"DCD747\", \"Wattle\"],\r\n  [\"DCD9D2\", \"Westar\"],\r\n  [\"DCDDCC\", \"Moon Mist\"],\r\n  [\"DCEDB4\", \"Caper\"],\r\n  [\"DCF0EA\", \"Swans Down\"],\r\n  [\"DDD6D5\", \"Swiss Coffee\"],\r\n  [\"DDF9F1\", \"White Ice\"],\r\n  [\"DE3163\", \"Cerise Red\"],\r\n  [\"DE6360\", \"Roman\"],\r\n  [\"DEA681\", \"Tumbleweed\"],\r\n  [\"DEBA13\", \"Gold Tips\"],\r\n  [\"DEC196\", \"Brandy\"],\r\n  [\"DECBC6\", \"Wafer\"],\r\n  [\"DED4A4\", \"Sapling\"],\r\n  [\"DED717\", \"Barberry\"],\r\n  [\"DEE5C0\", \"Beryl Green\"],\r\n  [\"DEF5FF\", \"Pattens Blue\"],\r\n  [\"DF73FF\", \"Heliotrope\"],\r\n  [\"DFBE6F\", \"Apache\"],\r\n  [\"DFCD6F\", \"Chenin\"],\r\n  [\"DFCFDB\", \"Lola\"],\r\n  [\"DFECDA\", \"Willow Brook\"],\r\n  [\"DFFF00\", \"Chartreuse Yellow\"],\r\n  [\"E0B0FF\", \"Mauve\"],\r\n  [\"E0B646\", \"Anzac\"],\r\n  [\"E0B974\", \"Harvest Gold\"],\r\n  [\"E0C095\", \"Calico\"],\r\n  [\"E0FFFF\", \"Baby Blue\"],\r\n  [\"E16865\", \"Sunglo\"],\r\n  [\"E1BC64\", \"Equator\"],\r\n  [\"E1C0C8\", \"Pink Flare\"],\r\n  [\"E1E6D6\", \"Periglacial Blue\"],\r\n  [\"E1EAD4\", \"Kidnapper\"],\r\n  [\"E1F6E8\", \"Tara\"],\r\n  [\"E25465\", \"Mandy\"],\r\n  [\"E2725B\", \"Terracotta\"],\r\n  [\"E28913\", \"Golden Bell\"],\r\n  [\"E292C0\", \"Shocking\"],\r\n  [\"E29418\", \"Dixie\"],\r\n  [\"E29CD2\", \"Light Orchid\"],\r\n  [\"E2D8ED\", \"Snuff\"],\r\n  [\"E2EBED\", \"Mystic\"],\r\n  [\"E2F3EC\", \"Apple Green\"],\r\n  [\"E30B5C\", \"Razzmatazz\"],\r\n  [\"E32636\", \"Alizarin Crimson\"],\r\n  [\"E34234\", \"Cinnabar\"],\r\n  [\"E3BEBE\", \"Cavern Pink\"],\r\n  [\"E3F5E1\", \"Peppermint\"],\r\n  [\"E3F988\", \"Mindaro\"],\r\n  [\"E47698\", \"Deep Blush\"],\r\n  [\"E49B0F\", \"Gamboge\"],\r\n  [\"E4C2D5\", \"Melanie\"],\r\n  [\"E4CFDE\", \"Twilight\"],\r\n  [\"E4D1C0\", \"Bone\"],\r\n  [\"E4D422\", \"Sunflower\"],\r\n  [\"E4D5B7\", \"Grain Brown\"],\r\n  [\"E4D69B\", \"Zombie\"],\r\n  [\"E4F6E7\", \"Frostee\"],\r\n  [\"E4FFD1\", \"Snow Flurry\"],\r\n  [\"E52B50\", \"Amaranth\"],\r\n  [\"E5841B\", \"Zest\"],\r\n  [\"E5CCC9\", \"Dust Storm\"],\r\n  [\"E5D7BD\", \"Stark White\"],\r\n  [\"E5D8AF\", \"Hampton\"],\r\n  [\"E5E0E1\", \"Bon Jour\"],\r\n  [\"E5E5E5\", \"Mercury\"],\r\n  [\"E5F9F6\", \"Polar\"],\r\n  [\"E64E03\", \"Trinidad\"],\r\n  [\"E6BE8A\", \"Gold Sand\"],\r\n  [\"E6BEA5\", \"Cashmere\"],\r\n  [\"E6D7B9\", \"Double Spanish White\"],\r\n  [\"E6E4D4\", \"Satin Linen\"],\r\n  [\"E6F2EA\", \"Harp\"],\r\n  [\"E6F8F3\", \"Off Green\"],\r\n  [\"E6FFE9\", \"Hint of Green\"],\r\n  [\"E6FFFF\", \"Tranquil\"],\r\n  [\"E77200\", \"Mango Tango\"],\r\n  [\"E7730A\", \"Christine\"],\r\n  [\"E79F8C\", \"Tonys Pink\"],\r\n  [\"E79FC4\", \"Kobi\"],\r\n  [\"E7BCB4\", \"Rose Fog\"],\r\n  [\"E7BF05\", \"Corn\"],\r\n  [\"E7CD8C\", \"Putty\"],\r\n  [\"E7ECE6\", \"Gray Nurse\"],\r\n  [\"E7F8FF\", \"Lily White\"],\r\n  [\"E7FEFF\", \"Bubbles\"],\r\n  [\"E89928\", \"Fire Bush\"],\r\n  [\"E8B9B3\", \"Shilo\"],\r\n  [\"E8E0D5\", \"Pearl Bush\"],\r\n  [\"E8EBE0\", \"Green White\"],\r\n  [\"E8F1D4\", \"Chrome White\"],\r\n  [\"E8F2EB\", \"Gin\"],\r\n  [\"E8F5F2\", \"Aqua Squeeze\"],\r\n  [\"E96E00\", \"Clementine\"],\r\n  [\"E97451\", \"Burnt Sienna\"],\r\n  [\"E97C07\", \"Tahiti Gold\"],\r\n  [\"E9CECD\", \"Oyster Pink\"],\r\n  [\"E9D75A\", \"Confetti\"],\r\n  [\"E9E3E3\", \"Ebb\"],\r\n  [\"E9F8ED\", \"Ottoman\"],\r\n  [\"E9FFFD\", \"Clear Day\"],\r\n  [\"EA88A8\", \"Carissma\"],\r\n  [\"EAAE69\", \"Porsche\"],\r\n  [\"EAB33B\", \"Tulip Tree\"],\r\n  [\"EAC674\", \"Rob Roy\"],\r\n  [\"EADAB8\", \"Raffia\"],\r\n  [\"EAE8D4\", \"White Rock\"],\r\n  [\"EAF6EE\", \"Panache\"],\r\n  [\"EAF6FF\", \"Solitude\"],\r\n  [\"EAF9F5\", \"Aqua Spring\"],\r\n  [\"EAFFFE\", \"Dew\"],\r\n  [\"EB9373\", \"Apricot\"],\r\n  [\"EBC2AF\", \"Zinnwaldite\"],\r\n  [\"ECA927\", \"Fuel Yellow\"],\r\n  [\"ECC54E\", \"Ronchi\"],\r\n  [\"ECC7EE\", \"French Lilac\"],\r\n  [\"ECCDB9\", \"Just Right\"],\r\n  [\"ECE090\", \"Wild Rice\"],\r\n  [\"ECEBBD\", \"Fall Green\"],\r\n  [\"ECEBCE\", \"Aths Special\"],\r\n  [\"ECF245\", \"Starship\"],\r\n  [\"ED0A3F\", \"Red Ribbon\"],\r\n  [\"ED7A1C\", \"Tango\"],\r\n  [\"ED9121\", \"Carrot Orange\"],\r\n  [\"ED989E\", \"Sea Pink\"],\r\n  [\"EDB381\", \"Tacao\"],\r\n  [\"EDC9AF\", \"Desert Sand\"],\r\n  [\"EDCDAB\", \"Pancho\"],\r\n  [\"EDDCB1\", \"Chamois\"],\r\n  [\"EDEA99\", \"Primrose\"],\r\n  [\"EDF5DD\", \"Frost\"],\r\n  [\"EDF5F5\", \"Aqua Haze\"],\r\n  [\"EDF6FF\", \"Zumthor\"],\r\n  [\"EDF9F1\", \"Narvik\"],\r\n  [\"EDFC84\", \"Honeysuckle\"],\r\n  [\"EE82EE\", \"Lavender Magenta\"],\r\n  [\"EEC1BE\", \"Beauty Bush\"],\r\n  [\"EED794\", \"Chalky\"],\r\n  [\"EED9C4\", \"Almond\"],\r\n  [\"EEDC82\", \"Flax\"],\r\n  [\"EEDEDA\", \"Bizarre\"],\r\n  [\"EEE3AD\", \"Double Colonial White\"],\r\n  [\"EEEEE8\", \"Cararra\"],\r\n  [\"EEEF78\", \"Manz\"],\r\n  [\"EEF0C8\", \"Tahuna Sands\"],\r\n  [\"EEF0F3\", \"Athens Gray\"],\r\n  [\"EEF3C3\", \"Tusk\"],\r\n  [\"EEF4DE\", \"Loafer\"],\r\n  [\"EEF6F7\", \"Catskill White\"],\r\n  [\"EEFDFF\", \"Twilight Blue\"],\r\n  [\"EEFF9A\", \"Jonquil\"],\r\n  [\"EEFFE2\", \"Rice Flower\"],\r\n  [\"EF863F\", \"Jaffa\"],\r\n  [\"EFEFEF\", \"Gallery\"],\r\n  [\"EFF2F3\", \"Porcelain\"],\r\n  [\"F091A9\", \"Mauvelous\"],\r\n  [\"F0D52D\", \"Golden Dream\"],\r\n  [\"F0DB7D\", \"Golden Sand\"],\r\n  [\"F0DC82\", \"Buff\"],\r\n  [\"F0E2EC\", \"Prim\"],\r\n  [\"F0E68C\", \"Khaki\"],\r\n  [\"F0EEFD\", \"Selago\"],\r\n  [\"F0EEFF\", \"Titan White\"],\r\n  [\"F0F8FF\", \"Alice Blue\"],\r\n  [\"F0FCEA\", \"Feta\"],\r\n  [\"F18200\", \"Gold Drop\"],\r\n  [\"F19BAB\", \"Wewak\"],\r\n  [\"F1E788\", \"Sahara Sand\"],\r\n  [\"F1E9D2\", \"Parchment\"],\r\n  [\"F1E9FF\", \"Blue Chalk\"],\r\n  [\"F1EEC1\", \"Mint Julep\"],\r\n  [\"F1F1F1\", \"Seashell\"],\r\n  [\"F1F7F2\", \"Saltpan\"],\r\n  [\"F1FFAD\", \"Tidal\"],\r\n  [\"F1FFC8\", \"Chiffon\"],\r\n  [\"F2552A\", \"Flamingo\"],\r\n  [\"F28500\", \"Tangerine\"],\r\n  [\"F2C3B2\", \"Mandys Pink\"],\r\n  [\"F2F2F2\", \"Concrete\"],\r\n  [\"F2FAFA\", \"Black Squeeze\"],\r\n  [\"F34723\", \"Pomegranate\"],\r\n  [\"F3AD16\", \"Buttercup\"],\r\n  [\"F3D69D\", \"New Orleans\"],\r\n  [\"F3D9DF\", \"Vanilla Ice\"],\r\n  [\"F3E7BB\", \"Sidecar\"],\r\n  [\"F3E9E5\", \"Dawn Pink\"],\r\n  [\"F3EDCF\", \"Wheatfield\"],\r\n  [\"F3FB62\", \"Canary\"],\r\n  [\"F3FBD4\", \"Orinoco\"],\r\n  [\"F3FFD8\", \"Carla\"],\r\n  [\"F400A1\", \"Hollywood Cerise\"],\r\n  [\"F4A460\", \"Sandy brown\"],\r\n  [\"F4C430\", \"Saffron\"],\r\n  [\"F4D81C\", \"Ripe Lemon\"],\r\n  [\"F4EBD3\", \"Janna\"],\r\n  [\"F4F2EE\", \"Pampas\"],\r\n  [\"F4F4F4\", \"Wild Sand\"],\r\n  [\"F4F8FF\", \"Zircon\"],\r\n  [\"F57584\", \"Froly\"],\r\n  [\"F5C85C\", \"Cream Can\"],\r\n  [\"F5C999\", \"Manhattan\"],\r\n  [\"F5D5A0\", \"Maize\"],\r\n  [\"F5DEB3\", \"Wheat\"],\r\n  [\"F5E7A2\", \"Sandwisp\"],\r\n  [\"F5E7E2\", \"Pot Pourri\"],\r\n  [\"F5E9D3\", \"Albescent White\"],\r\n  [\"F5EDEF\", \"Soft Peach\"],\r\n  [\"F5F3E5\", \"Ecru White\"],\r\n  [\"F5F5DC\", \"Beige\"],\r\n  [\"F5FB3D\", \"Golden Fizz\"],\r\n  [\"F5FFBE\", \"Australian Mint\"],\r\n  [\"F64A8A\", \"French Rose\"],\r\n  [\"F653A6\", \"Brilliant Rose\"],\r\n  [\"F6A4C9\", \"Illusion\"],\r\n  [\"F6F0E6\", \"Merino\"],\r\n  [\"F6F7F7\", \"Black Haze\"],\r\n  [\"F6FFDC\", \"Spring Sun\"],\r\n  [\"F7468A\", \"Violet Red\"],\r\n  [\"F77703\", \"Chilean Fire\"],\r\n  [\"F77FBE\", \"Persian Pink\"],\r\n  [\"F7B668\", \"Rajah\"],\r\n  [\"F7C8DA\", \"Azalea\"],\r\n  [\"F7DBE6\", \"We Peep\"],\r\n  [\"F7F2E1\", \"Quarter Spanish White\"],\r\n  [\"F7F5FA\", \"Whisper\"],\r\n  [\"F7FAF7\", \"Snow Drift\"],\r\n  [\"F8B853\", \"Casablanca\"],\r\n  [\"F8C3DF\", \"Chantilly\"],\r\n  [\"F8D9E9\", \"Cherub\"],\r\n  [\"F8DB9D\", \"Marzipan\"],\r\n  [\"F8DD5C\", \"Energy Yellow\"],\r\n  [\"F8E4BF\", \"Givry\"],\r\n  [\"F8F0E8\", \"White Linen\"],\r\n  [\"F8F4FF\", \"Magnolia\"],\r\n  [\"F8F6F1\", \"Spring Wood\"],\r\n  [\"F8F7DC\", \"Coconut Cream\"],\r\n  [\"F8F7FC\", \"White Lilac\"],\r\n  [\"F8F8F7\", \"Desert Storm\"],\r\n  [\"F8F99C\", \"Texas\"],\r\n  [\"F8FACD\", \"Corn Field\"],\r\n  [\"F8FDD3\", \"Mimosa\"],\r\n  [\"F95A61\", \"Carnation\"],\r\n  [\"F9BF58\", \"Saffron Mango\"],\r\n  [\"F9E0ED\", \"Carousel Pink\"],\r\n  [\"F9E4BC\", \"Dairy Cream\"],\r\n  [\"F9E663\", \"Portica\"],\r\n  [\"F9EAF3\", \"Amour\"],\r\n  [\"F9F8E4\", \"Rum Swizzle\"],\r\n  [\"F9FF8B\", \"Dolly\"],\r\n  [\"F9FFF6\", \"Sugar Cane\"],\r\n  [\"FA7814\", \"Ecstasy\"],\r\n  [\"FA9D5A\", \"Tan Hide\"],\r\n  [\"FAD3A2\", \"Corvette\"],\r\n  [\"FADFAD\", \"Peach Yellow\"],\r\n  [\"FAE600\", \"Turbo\"],\r\n  [\"FAEAB9\", \"Astra\"],\r\n  [\"FAECCC\", \"Champagne\"],\r\n  [\"FAF0E6\", \"Linen\"],\r\n  [\"FAF3F0\", \"Fantasy\"],\r\n  [\"FAF7D6\", \"Citrine White\"],\r\n  [\"FAFAFA\", \"Alabaster\"],\r\n  [\"FAFDE4\", \"Hint of Yellow\"],\r\n  [\"FAFFA4\", \"Milan\"],\r\n  [\"FB607F\", \"Brink Pink\"],\r\n  [\"FB8989\", \"Geraldine\"],\r\n  [\"FBA0E3\", \"Lavender Rose\"],\r\n  [\"FBA129\", \"Sea Buckthorn\"],\r\n  [\"FBAC13\", \"Sun\"],\r\n  [\"FBAED2\", \"Lavender Pink\"],\r\n  [\"FBB2A3\", \"Rose Bud\"],\r\n  [\"FBBEDA\", \"Cupid\"],\r\n  [\"FBCCE7\", \"Classic Rose\"],\r\n  [\"FBCEB1\", \"Apricot Peach\"],\r\n  [\"FBE7B2\", \"Banana Mania\"],\r\n  [\"FBE870\", \"Marigold Yellow\"],\r\n  [\"FBE96C\", \"Festival\"],\r\n  [\"FBEA8C\", \"Sweet Corn\"],\r\n  [\"FBEC5D\", \"Candy Corn\"],\r\n  [\"FBF9F9\", \"Hint of Red\"],\r\n  [\"FBFFBA\", \"Shalimar\"],\r\n  [\"FC0FC0\", \"Shocking Pink\"],\r\n  [\"FC80A5\", \"Tickle Me Pink\"],\r\n  [\"FC9C1D\", \"Tree Poppy\"],\r\n  [\"FCC01E\", \"Lightning Yellow\"],\r\n  [\"FCD667\", \"Goldenrod\"],\r\n  [\"FCD917\", \"Candlelight\"],\r\n  [\"FCDA98\", \"Cherokee\"],\r\n  [\"FCF4D0\", \"Double Pearl Lusta\"],\r\n  [\"FCF4DC\", \"Pearl Lusta\"],\r\n  [\"FCF8F7\", \"Vista White\"],\r\n  [\"FCFBF3\", \"Bianca\"],\r\n  [\"FCFEDA\", \"Moon Glow\"],\r\n  [\"FCFFE7\", \"China Ivory\"],\r\n  [\"FCFFF9\", \"Ceramic\"],\r\n  [\"FD0E35\", \"Torch Red\"],\r\n  [\"FD5B78\", \"Wild Watermelon\"],\r\n  [\"FD7B33\", \"Crusta\"],\r\n  [\"FD7C07\", \"Sorbus\"],\r\n  [\"FD9FA2\", \"Sweet Pink\"],\r\n  [\"FDD5B1\", \"Light Apricot\"],\r\n  [\"FDD7E4\", \"Pig Pink\"],\r\n  [\"FDE1DC\", \"Cinderella\"],\r\n  [\"FDE295\", \"Golden Glow\"],\r\n  [\"FDE910\", \"Lemon\"],\r\n  [\"FDF5E6\", \"Old Lace\"],\r\n  [\"FDF6D3\", \"Half Colonial White\"],\r\n  [\"FDF7AD\", \"Drover\"],\r\n  [\"FDFEB8\", \"Pale Prim\"],\r\n  [\"FDFFD5\", \"Cumulus\"],\r\n  [\"FE28A2\", \"Persian Rose\"],\r\n  [\"FE4C40\", \"Sunset Orange\"],\r\n  [\"FE6F5E\", \"Bittersweet\"],\r\n  [\"FE9D04\", \"California\"],\r\n  [\"FEA904\", \"Yellow Sea\"],\r\n  [\"FEBAAD\", \"Melon\"],\r\n  [\"FED33C\", \"Bright Sun\"],\r\n  [\"FED85D\", \"Dandelion\"],\r\n  [\"FEDB8D\", \"Salomie\"],\r\n  [\"FEE5AC\", \"Cape Honey\"],\r\n  [\"FEEBF3\", \"Remy\"],\r\n  [\"FEEFCE\", \"Oasis\"],\r\n  [\"FEF0EC\", \"Bridesmaid\"],\r\n  [\"FEF2C7\", \"Beeswax\"],\r\n  [\"FEF3D8\", \"Bleach White\"],\r\n  [\"FEF4CC\", \"Pipi\"],\r\n  [\"FEF4DB\", \"Half Spanish White\"],\r\n  [\"FEF4F8\", \"Wisp Pink\"],\r\n  [\"FEF5F1\", \"Provincial Pink\"],\r\n  [\"FEF7DE\", \"Half Dutch White\"],\r\n  [\"FEF8E2\", \"Solitaire\"],\r\n  [\"FEF8FF\", \"White Pointer\"],\r\n  [\"FEF9E3\", \"Off Yellow\"],\r\n  [\"FEFCED\", \"Orange White\"],\r\n  [\"FF0000\", \"Red\"],\r\n  [\"FF007F\", \"Rose\"],\r\n  [\"FF00CC\", \"Purple Pizzazz\"],\r\n  [\"FF00FF\", \"Magenta / Fuchsia\"],\r\n  [\"FF2400\", \"Scarlet\"],\r\n  [\"FF3399\", \"Wild Strawberry\"],\r\n  [\"FF33CC\", \"Razzle Dazzle Rose\"],\r\n  [\"FF355E\", \"Radical Red\"],\r\n  [\"FF3F34\", \"Red Orange\"],\r\n  [\"FF4040\", \"Coral Red\"],\r\n  [\"FF4D00\", \"Vermilion\"],\r\n  [\"FF4F00\", \"International Orange\"],\r\n  [\"FF6037\", \"Outrageous Orange\"],\r\n  [\"FF6600\", \"Blaze Orange\"],\r\n  [\"FF66FF\", \"Pink Flamingo\"],\r\n  [\"FF681F\", \"Orange\"],\r\n  [\"FF69B4\", \"Hot Pink\"],\r\n  [\"FF6B53\", \"Persimmon\"],\r\n  [\"FF6FFF\", \"Blush Pink\"],\r\n  [\"FF7034\", \"Burning Orange\"],\r\n  [\"FF7518\", \"Pumpkin\"],\r\n  [\"FF7D07\", \"Flamenco\"],\r\n  [\"FF7F00\", \"Flush Orange\"],\r\n  [\"FF7F50\", \"Coral\"],\r\n  [\"FF8C69\", \"Salmon\"],\r\n  [\"FF9000\", \"Pizazz\"],\r\n  [\"FF910F\", \"West Side\"],\r\n  [\"FF91A4\", \"Pink Salmon\"],\r\n  [\"FF9933\", \"Neon Carrot\"],\r\n  [\"FF9966\", \"Atomic Tangerine\"],\r\n  [\"FF9980\", \"Vivid Tangerine\"],\r\n  [\"FF9E2C\", \"Sunshade\"],\r\n  [\"FFA000\", \"Orange Peel\"],\r\n  [\"FFA194\", \"Mona Lisa\"],\r\n  [\"FFA500\", \"Web Orange\"],\r\n  [\"FFA6C9\", \"Carnation Pink\"],\r\n  [\"FFAB81\", \"Hit Pink\"],\r\n  [\"FFAE42\", \"Yellow Orange\"],\r\n  [\"FFB0AC\", \"Cornflower Lilac\"],\r\n  [\"FFB1B3\", \"Sundown\"],\r\n  [\"FFB31F\", \"My Sin\"],\r\n  [\"FFB555\", \"Texas Rose\"],\r\n  [\"FFB7D5\", \"Cotton Candy\"],\r\n  [\"FFB97B\", \"Macaroni and Cheese\"],\r\n  [\"FFBA00\", \"Selective Yellow\"],\r\n  [\"FFBD5F\", \"Koromiko\"],\r\n  [\"FFBF00\", \"Amber\"],\r\n  [\"FFC0A8\", \"Wax Flower\"],\r\n  [\"FFC0CB\", \"Pink\"],\r\n  [\"FFC3C0\", \"Your Pink\"],\r\n  [\"FFC901\", \"Supernova\"],\r\n  [\"FFCBA4\", \"Flesh\"],\r\n  [\"FFCC33\", \"Sunglow\"],\r\n  [\"FFCC5C\", \"Golden Tainoi\"],\r\n  [\"FFCC99\", \"Peach Orange\"],\r\n  [\"FFCD8C\", \"Chardonnay\"],\r\n  [\"FFD1DC\", \"Pastel Pink\"],\r\n  [\"FFD2B7\", \"Romantic\"],\r\n  [\"FFD38C\", \"Grandis\"],\r\n  [\"FFD700\", \"Gold\"],\r\n  [\"FFD800\", \"School bus Yellow\"],\r\n  [\"FFD8D9\", \"Cosmos\"],\r\n  [\"FFDB58\", \"Mustard\"],\r\n  [\"FFDCD6\", \"Peach Schnapps\"],\r\n  [\"FFDDAF\", \"Caramel\"],\r\n  [\"FFDDCD\", \"Tuft Bush\"],\r\n  [\"FFDDCF\", \"Watusi\"],\r\n  [\"FFDDF4\", \"Pink Lace\"],\r\n  [\"FFDEAD\", \"Navajo White\"],\r\n  [\"FFDEB3\", \"Frangipani\"],\r\n  [\"FFE1DF\", \"Pippin\"],\r\n  [\"FFE1F2\", \"Pale Rose\"],\r\n  [\"FFE2C5\", \"Negroni\"],\r\n  [\"FFE5A0\", \"Cream Brulee\"],\r\n  [\"FFE5B4\", \"Peach\"],\r\n  [\"FFE6C7\", \"Tequila\"],\r\n  [\"FFE772\", \"Kournikova\"],\r\n  [\"FFEAC8\", \"Sandy Beach\"],\r\n  [\"FFEAD4\", \"Karry\"],\r\n  [\"FFEC13\", \"Broom\"],\r\n  [\"FFEDBC\", \"Colonial White\"],\r\n  [\"FFEED8\", \"Derby\"],\r\n  [\"FFEFA1\", \"Vis Vis\"],\r\n  [\"FFEFC1\", \"Egg White\"],\r\n  [\"FFEFD5\", \"Papaya Whip\"],\r\n  [\"FFEFEC\", \"Fair Pink\"],\r\n  [\"FFF0DB\", \"Peach Cream\"],\r\n  [\"FFF0F5\", \"Lavender blush\"],\r\n  [\"FFF14F\", \"Gorse\"],\r\n  [\"FFF1B5\", \"Buttermilk\"],\r\n  [\"FFF1D8\", \"Pink Lady\"],\r\n  [\"FFF1EE\", \"Forget Me Not\"],\r\n  [\"FFF1F9\", \"Tutu\"],\r\n  [\"FFF39D\", \"Picasso\"],\r\n  [\"FFF3F1\", \"Chardon\"],\r\n  [\"FFF46E\", \"Paris Daisy\"],\r\n  [\"FFF4CE\", \"Barley White\"],\r\n  [\"FFF4DD\", \"Egg Sour\"],\r\n  [\"FFF4E0\", \"Sazerac\"],\r\n  [\"FFF4E8\", \"Serenade\"],\r\n  [\"FFF4F3\", \"Chablis\"],\r\n  [\"FFF5EE\", \"Seashell Peach\"],\r\n  [\"FFF5F3\", \"Sauvignon\"],\r\n  [\"FFF6D4\", \"Milk Punch\"],\r\n  [\"FFF6DF\", \"Varden\"],\r\n  [\"FFF6F5\", \"Rose White\"],\r\n  [\"FFF8D1\", \"Baja White\"],\r\n  [\"FFF9E2\", \"Gin Fizz\"],\r\n  [\"FFF9E6\", \"Early Dawn\"],\r\n  [\"FFFACD\", \"Lemon Chiffon\"],\r\n  [\"FFFAF4\", \"Bridal Heath\"],\r\n  [\"FFFBDC\", \"Scotch Mist\"],\r\n  [\"FFFBF9\", \"Soapstone\"],\r\n  [\"FFFC99\", \"Witch Haze\"],\r\n  [\"FFFCEA\", \"Buttery White\"],\r\n  [\"FFFCEE\", \"Island Spice\"],\r\n  [\"FFFDD0\", \"Cream\"],\r\n  [\"FFFDE6\", \"Chilean Heath\"],\r\n  [\"FFFDE8\", \"Travertine\"],\r\n  [\"FFFDF3\", \"Orchid White\"],\r\n  [\"FFFDF4\", \"Quarter Pearl Lusta\"],\r\n  [\"FFFEE1\", \"Half and Half\"],\r\n  [\"FFFEEC\", \"Apricot White\"],\r\n  [\"FFFEF0\", \"Rice Cake\"],\r\n  [\"FFFEF6\", \"Black White\"],\r\n  [\"FFFEFD\", \"Romance\"],\r\n  [\"FFFF00\", \"Yellow\"],\r\n  [\"FFFF66\", \"Laser Lemon\"],\r\n  [\"FFFF99\", \"Pale Canary\"],\r\n  [\"FFFFB4\", \"Portafino\"],\r\n  [\"FFFFF0\", \"Ivory\"],\r\n  [\"FFFFFF\", \"White\"]\r\n  ]\r\n  \r\n  }\r\n  \r\n  ntc.init();\r\n  \n\n;/* === client/codemirror.jslint.js === */\n/*jslint browser*/\r\nconst CodeMirror = window.CodeMirror;\r\n\r\nfunction validator(text, options) {\r\n    let data = jslint(text, options, options.globals);\r\n    let warnings = data.warnings;\r\n    let output = [];\r\n\r\n    if (data.stop) {\r\n        output.push({\r\n            message: \"JSLint was unable to finish.\",\r\n            severity: \"warning\",\r\n            from: new CodeMirror.Pos(0, 0),\r\n            to: new CodeMirror.Pos(0, 0)\r\n        });\r\n    }\r\n\r\n    warnings.forEach(function (warning) {\r\n        output.push({\r\n            message: warning.message,\r\n            severity: \"error\",\r\n            from: new CodeMirror.Pos(warning.line - 1, warning.column - 1),\r\n            to: new CodeMirror.Pos(warning.line - 1, warning.column + 1)\r\n        });\r\n    });\r\n\r\n    return output;\r\n}\r\n\r\nCodeMirror.registerHelper(\"lint\", \"javascript\", validator);\r\n\n\n;/* === client/bbscript.js === */\n\r\nwindow.bbConverter = {\r\n\tpatterns : [\r\n\t\t{exp:/\\[ul(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/ul(?:\\s*)\\]/gi,replace:\"<ul>$1</ul>\"},\r\n\t\t{exp:/\\[ol(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/ol(?:\\s*)\\]/gi,replace:\"<ol>$1</ol>\"},\r\n\t\t{exp:/\\[li(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/li(?:\\s*)\\]/gi,replace:\"<li>$1</li>\"},\r\n\t\t{exp:/\\[b(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/b(?:\\s*)\\]/gi,replace:\"<b>$1</b>\"},\r\n\t\t{exp:/\\[p(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/p(?:\\s*)\\]/gi,replace:\"<p>$1</p>\"},\r\n\t\t{exp:/\\[div(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/div(?:\\s*)\\]/gi,replace:\"<div>$1</div>\"},\r\n\t\t{exp:/\\[p class=((.|\\n|\\r)*?)(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/p(?:\\s*)\\]/gi,replace:\"<p class = \\\"$1\\\">$3</p>\"},\r\n\t\t{exp:/\\[div class=((.|\\n|\\r)*?)(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/div(?:\\s*)\\]/gi,replace:\"<div class = \\\"$1\\\">$3</div>\"},\r\n\t\t{exp:/\\[div style=((.|\\n|\\r)*?)(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/div(?:\\s*)\\]/gi,replace:\"<div style = \\\"$1\\\">$3</div>\"},\r\n\t\t{exp:/\\[blockquote(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/blockquote(?:\\s*)\\]/gi,replace:\"<blockquote>$1</blockquote>\"},\r\n\t\t{exp:/\\[h1(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/h1(?:\\s*)\\]/gi,replace:\"<h1>$1</h1>\"},\r\n\t\t{exp:/\\[h2(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/h2(?:\\s*)\\]/gi,replace:\"<h2>$1</h2>\"},\r\n\t\t{exp:/\\[h3(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/h3(?:\\s*)\\]/gi,replace:\"<h3>$1</h3>\"},\r\n\t\t{exp:/\\[h4(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/h4(?:\\s*)\\]/gi,replace:\"<h4>$1</h4>\"},\r\n\t\t{exp:/\\[h5(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/h5(?:\\s*)\\]/gi,replace:\"<h5>$1</h5>\"},\r\n\t\t{exp:/\\[i(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/i(?:\\s*)\\]/gi,replace:\"<i>$1</i>\"},\r\n\t\t{exp:/\\[s(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/s(?:\\s*)\\]/gi,replace:\"<strike>$1</strike>\"},\r\n\t\r\n\t\t{exp:/\\[url(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/url(?:\\s*)\\]/gi,replace:\"<a href=\\\"$1\\\" target=\\\"_blank\\\" title=\\\"$1\\\">$1</a>\"},\r\n\t\t{exp:/\\[url=\\\"\\\"((.|\\n|\\r)*?)(?:\\s*)\\\"\\\"\\]((.|\\n|\\r)*?)\\[\\/url(?:\\s*)\\]/gi,replace:\"<a href=\\\"$1\\\" target=\\\"_blank\\\" title=\\\"$1\\\">$3</a>\"},\r\n\t\t{exp:/\\[url=((.|\\n|\\r)*?)(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/url(?:\\s*)\\]/gi,replace:\"<a href=\\\"$1\\\" target=\\\"_blank\\\" title=\\\"$1\\\">$3</a>\"},\r\n\t\r\n\t\t{exp:/\\[img align=((.|\\n|\\r)*?)(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/img(?:\\s*)\\]/gi,replace:\"<img src=\\\"$3\\\" border=\\\"0\\\" align=\\\"$1\\\" alt=\\\"\\\" />\"},\r\n\t\t{exp:/\\[img class=((.|\\n|\\r)*?)(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/img(?:\\s*)\\]/gi,replace:\"<img src=\\\"$3\\\" border=\\\"0\\\" class=\\\"$1\\\" alt=\\\"\\\" />\"},\r\n\t\t{exp:/\\[img(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/img(?:\\s*)\\]/gi,replace:\"<img src=\\\"$1\\\" border=\\\"0\\\" alt=\\\"\\\" />\"},\r\n\t\t{exp:/\\[img=((.|\\n|\\r)*?)x((.|\\n|\\r)*?)(?:\\s*)\\]((.|\\n|\\r)*?)\\[\\/img(?:\\s*)\\]/gi,replace:\"<img width=\\\"$1\\\" height=\\\"$3\\\" src=\\\"$5\\\" border=\\\"0\\\" alt=\\\"\\\" />\"}\r\n\t],\r\n\r\n\tlimitAttr : ['class', 'style', 'border', 'align', 'alt', 'type', 'src', 'width', 'height', 'title', 'target'],\r\n\r\n\tmInto : function(s){\r\n\t\tvar x = (new DOMParser()).parseFromString(\"<div>\" + bbConverter.import(s) + \"</div>\", \"text/xml\");\r\n\t\tif(!x || x.documentElement == null){\r\n\t\t\tconsole.error(\"Failed to parse \" + s);\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\treturn bbConverter.mCurse(x.documentElement);\t\t\t\t\r\n\t},\r\n\tmProp : function(o){\r\n\t\tlet attr = bbConverter.limitAttr;\r\n\t\tlet prop = {};\r\n\t\tattr.forEach((a)=>{\r\n\t\t\tif(o.hasAttribute(a)) prop[a] = o.getAttribute(a);\r\n\t\t});\r\n\t\treturn prop;\r\n\t},\r\n\tmCurse : function(o){\r\n\t\tlet a = [];\r\n\t\tif(!o) return a;\r\n\t\tfor(let i = 0; i < o.childNodes.length; i++){\r\n\t\t\tlet node = o.childNodes[i];\r\n\t\t\tswitch(node.nodeType){\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\ta.push(m(node.nodeName, bbConverter.mProp(node), bbConverter.mCurse(node)));\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\ta.push(node.nodeValue);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn a;\r\n\t},\r\n\r\n\tcopyInto : function(s, o, b){\r\n\t\tvar x = (new DOMParser()).parseFromString(\"<div>\" + bbConverter.import(s) + \"</div>\", \"text/xml\");\r\n\t\tif(!x || x.documentElement == null){\r\n\t\t\tconsole.error(\"Failed to parse \" + s);\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tfor(var i = 0; i < x.documentElement.childNodes.length;i++){\r\n\t\t\tpage.setInnerXHTML(o, x.documentElement.childNodes[i],(i==0 ? b : 1));\r\n\t\t}\r\n\t\treturn 1;\r\n\t},\r\n\timport : function(s){\r\n\t\tvar aP = bbConverter.patterns;\r\n\t\tfor(var i = 0; i < aP.length;i++){\r\n\t\t\twhile(s.match(aP[i].exp)){\r\n\t\t\t\ts = s.replace(aP[i].exp, aP[i].replace);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn s;\r\n\t},\r\n\tconvert : function(o){\r\n\t   var r = \"\";\r\n\t   if(typeof o == \"string\") return o;\r\n\t   if(typeof o.nodeType != \"number\") return \"[error]\";\r\n\t   switch(o.nodeType){\r\n\t   \t\tcase 1:\r\n\t   \t\t\tr = bbConverter.node(o);\r\n\t\t   break;\r\n\t      case 3:\r\n\t           r = o.nodeValue;\r\n\t   \t       //r = r.replace(/[\\s]{2,}/gi,\" \"),\r\n\t   \t       r = r.replace(/&nbsp;/gi,\" \");\r\n\t           break;\r\n\t   }\r\n\t   return r;\r\n\t\r\n\t},\r\n\r\n\tconvertNodes : function(a){\r\n\t   var aa = [];\r\n\t   for(var i = 0; i < a.length; i++){\r\n\t       aa.push(bbConverter.convert(a[i]));\r\n\t   }\r\n\t   return aa.join(\"\").trim();\r\n\t},\r\n\r\n\tnode : function(o){\r\n\t\tvar s = \"\";\r\n\t\tif(typeof o != \"object\" || o == null || o.nodeType != 1) return s;\r\n\t\tvar sStart = \"\";\r\n\t\tvar sEnd = \"\";\r\n\t\tswitch(o.nodeName.toLowerCase()){\r\n\t\t\tcase \"a\":\r\n\t\t\t\tsStart = \"[url=\" + o.getAttribute(\"href\") + \"]\";\r\n\t\t\t\tsEnd = \"[/url]\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ul\":\r\n\t\t\tcase \"ol\":\r\n\t\t\tcase \"li\":\r\n\t\t\tcase \"blockquote\":\r\n\t\t\tcase \"h1\":\r\n\t\t\tcase \"h2\":\r\n\t\t\tcase \"h3\":\r\n\t\t\tcase \"h4\":\r\n\t\t\tcase \"h5\":\r\n\t\t\tcase \"b\":\r\n\t\t\tcase \"i\":\r\n\t\t\t\tvar sA = o.getAttribute(\"align\");\r\n\t\t\t\tsStart = \"[\" + o.nodeName.toLowerCase() + (sA ? \" align=\" + sA : \"\") + \"]\";\r\n\t\t\t\tsEnd = \"[/\" + o.nodeName.toLowerCase() + \"]\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"img\":\r\n\t\t\t\tvar sA = o.getAttribute(\"align\");\r\n\t\t\t\tvar sC = o.getAttribute(\"class\");\r\n\t\t\t\treturn \"[img\" + (sC ? \" class=\" + sC :\"\") + (sA ? \" align=\" + sA : \"\") + \"]\" + o.getAttribute(\"src\") + \"[/img]\";\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"p\":\r\n\t\t\tcase \"div\":\r\n\t\t\t\t\r\n\t\t\t\tvar sC = o.getAttribute(\"class\");\r\n\t\t\t\t/// Trash the default html designer class\r\n\t\t\t\t///\r\n\t\t\t\tif(sC && sC.match(/^p1$/)) sC = 0;\r\n\t\t\t\tvar sS = o.getAttribute(\"style\");\r\n\r\n\t\t\t\tsStart = \"[\" + o.nodeName.toLowerCase() + (sC ? \" class=\" + sC :\"\") + (sS ? \" style=\" + sS: \"\") + \"]\";\r\n\t\t\t\tsEnd = \"[/\" + o.nodeName.toLowerCase() + \"]\";\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tsStart = \"\";\r\n\t\t\t\tsEnd = \"\";\r\n\t\t\t\tbreak;\r\n\t\t\t\r\n\t\t}\r\n\t   \r\n\t\treturn (sStart + bbConverter.convertNodes(o.childNodes) + sEnd);\r\n\t}\r\n};\r\n\n\n;/* === client/pageClient.js === */\n(function(){\r\n\r\n    let undef;\r\n\r\n    /// Note: These only apply to a handful of system roles within an organization.\r\n    ///\r\n    function getContextRoles(){\r\n        return {\r\n            api : false,\r\n            userReader : false,\r\n            roleReader : false,\r\n            permissionReader : false,\r\n            author : false,\r\n            user : false,\r\n            systemAdmin : false,\r\n            accountAdmin : false,\r\n            objectAdmin : false,\r\n            dataAdmin : false\r\n        }\r\n    }\r\n\r\n    function newContextModel(){\r\n        return {\r\n            streams : {},\r\n            contextObjects : {},\r\n            entitlements : {},\r\n            tags : {},\r\n            favorites : {},\r\n            controls: {},\r\n            requests: {},\r\n            contextViews : {},\r\n            roles : getContextRoles(),\r\n            notifications: [],\r\n            messages: [],\r\n            pendingEntity : undef\r\n        };\r\n    }\r\n\r\n    function clearContextObject(id){\r\n        let ctx = page.context();\r\n        delete ctx.streams[id];\r\n        delete ctx.contextObjects[id];\r\n        delete ctx.entitlements[id];\r\n        delete ctx.tags[id];\r\n        delete ctx.controls[id];\r\n        delete ctx.requests[id];\r\n        delete ctx.contextViews[id];\r\n    }\r\n\r\n    let contextModel = newContextModel();\r\n\r\n    let uidStub = \"xxxxxxxx-xxxx-9xxx-yxxx-xxxxxxxxxxxx\";\r\n    let luidStub = \"xxxx-xxxx\";\r\n\r\n    let toast = [];\r\n    let toastConfig = {\r\n        info: {\r\n            ico: \"info\",\r\n            style: \"text-gray-500 bg-white dark:bg-black dark:text-gray-300\",\r\n            icoStyle: \"text-blue-500 dark:text-blue-300\",\r\n            timeout: 5000\r\n        },\r\n        success: {\r\n            ico: \"check\",\r\n            style: \"text-gray-500 bg-green-200 dark:bg-green-800 dark:text-gray-300\",\r\n            icoStyle: \"text-black dark:text-white\",\r\n            timeout: 5000\r\n        },\r\n        warn: {\r\n            ico: \"warning\",\r\n            style: \"bg-yellow-200 text-black dark:text-white dark:bg-yellow-800\",\r\n            icoStyle: \"text-black dark:text-white\",\r\n            timeout: 10000\r\n        },\r\n        error: {\r\n            ico: \"stop\",\r\n            style: \"bg-red-200 text-black dark:text-white dark:bg-red-700\",\r\n            icoStyle: \"text-black dark:text-white\",\r\n            timeout: 15000\r\n        }\r\n    };\r\n\r\n    let page = {\r\n\r\n        profile,\r\n        imageView,\r\n        imageGallery,\r\n        clearToast,\r\n        reconnect,\r\n        toast: addToast,\r\n        toasts: () => toast,\r\n        loadToast,\r\n        clearServerCache,\r\n        cleanup,\r\n        clearCache : clearPageCache,\r\n        components: {},\r\n        user : null,\r\n        application : undef,\r\n        navigable : undef,\r\n        contentRouter : contentRouter,\r\n        authenticated : () => (page.user != null),\r\n        getRawUrl : getRawUrl,\r\n        home : goHome,\r\n        nav: goNav,\r\n        getTag,\r\n        chat: goChat,\r\n        member: promiseMember,\r\n        parentType: promiseParentType,\r\n        moveObject: promiseMoveObject,\r\n        reparentObject: promiseReparentObject,\r\n        countObjects : promiseCountObjects,\r\n        deleteObject: promiseDeleteObject,\r\n        listObjects : promiseListObjects,\r\n        findObject : promiseFindObject,\r\n        makePath: promiseMakePath,\r\n        stream : promiseStream,\r\n        openObject : promiseOpenObject,\r\n        search: promiseSearch,\r\n        searchByName : promiseSearchObjectByName,\r\n        count: promiseCount,\r\n        openObjectByName : promiseOpenObjectByName,\r\n        createObject: promiseCreate,\r\n        patchObject: promisePatch,\r\n        uriStem : getURIStem,\r\n        uri : getURI,\r\n        iconButton : iconButton,\r\n        context : function(){ return contextModel;},\r\n        clearContextObject : clearContextObject,\r\n        listByType,\r\n        navigateToPath : navigateToPathId,\r\n        logout : async function(){\r\n            clearPageCache();\r\n            await uwm.logout();\r\n            m.route.set(\"/sig\");\r\n        },\r\n        removeDuplicates : removeDuplicates,\r\n        tags : getTags,\r\n        controls: getControls,\r\n        requests: getRequests,\r\n        entitlements : getEntitlements,\r\n        resetCredential,\r\n        wss: {\r\n            connect: wssConnect,\r\n            close: wssClose,\r\n            send: wssSend\r\n        },\r\n        messages,\r\n        cleanupUserRemains,\r\n        uid : function(){\r\n            return uid(uidStub);\r\n        },\r\n        luid : function(){\r\n            return uid(luidStub);\r\n        },\r\n        views: {},\r\n        setInnerXHTML,\r\n        checkFavorites,\r\n        isFavorite,\r\n        favorite,\r\n        favorites,\r\n        systemLibrary,\r\n        blobUrl : toBlobUrl,\r\n        sessionName: function() {\r\n            let a = [\"turtle\", \"bunny\", \"kitty\", \"puppy\", \"duckling\", \"pony\", \"fishy\", \"birdie\"];\r\n            let b = [\"fluffy\", \"cute\", \"ornery\", \"obnoxious\", \"scratchy\", \"licky\", \"cuddly\", \"mangy\"];\r\n            let c = [\"little\", \"tiny\", \"enormous\", \"big\", \"skinny\", \"lumpy\"];\r\n      \r\n            return b[parseInt(Math.random() * b.length)] + \" \" + c[parseInt(Math.random() * c.length)] + \" \" + a[parseInt(Math.random() * a.length)];\r\n          },\r\n        searchFirst,\r\n        chatAvatar,\r\n        normalizePath,\r\n        chatStream: undefined,\r\n        audioStream: undefined,\r\n        gameStream: undefined,\r\n        imageTags: (id) => {\r\n            return am7client.getImageTags(id);\r\n        },\r\n        applyImageTags: async (id) => {\r\n            let tags = await am7client.applyImageTags(id);\r\n            await am7client.clearCache(\"data.data\");\r\n            await am7client.clearCache(\"data.tag\");\r\n            return tags;\r\n        }\r\n\r\n    };\r\n\r\n\r\n    function normalizePath(path, grp){\r\n      let opath;\r\n      let cnt = grp || page.user.homeDirectory;\r\n      if(cnt && cnt.path){\r\n        if(path.startsWith(\"./\")){\r\n          opath = cnt.path + path.substring(1);\r\n        }\r\n        else if(path.startsWith(\"../\")){\r\n          let p = cnt.path.split(\"/\");\r\n          p.pop();\r\n          opath = p.join(\"/\") + path.substring(2);\r\n        }\r\n        else if(path.startsWith(\"/\") || path.startsWith(\"~\")){\r\n          opath = path;\r\n        }\r\n        else{\r\n          opath = cnt.path + \"/\" + path;\r\n        }\r\n      }\r\n      return opath;\r\n    }\r\n\r\n    async function chatAvatar(){\r\n        await am7model.forms.commands.character(\"Basi Lisk\", undefined, 42, \"M\", \"/media/logo_512.png\");\r\n    }\r\n    function isFavorite(obj){\r\n        let ctx = contextModel;\r\n        let type = obj[am7model.jsonModelKey];\r\n        return (ctx.favorites[type] != undefined && ctx.favorites[type].filter((o)=>o.objectId == obj.objectId).length)\r\n    }\r\n    async function favorite(obj){\r\n        let set = !isFavorite(obj);\r\n        let ctx = contextModel;\r\n        //ctx.favorites[obj[am7model.jsonModelKey]] = undefined;\r\n        let fav = await favorites();\r\n        let b = await promiseMember(fav[am7model.jsonModelKey], fav.objectId, obj[am7model.jsonModelKey], obj.objectId, set);\r\n        if(!b){\r\n            addToast(\"warn\", \"Failed to set favorite status\");\r\n        }\r\n        page.context().favorites[obj[am7model.jsonModelKey]] = undefined;\r\n        await am7client.clearCache();\r\n        return b;\r\n    }\r\n\r\n    async function checkFavorites(itype){\r\n        let type = itype || m.route.param(\"type\");\r\n        let ctx = contextModel;\r\n        if(type && ctx.favorites[type] == undefined){\r\n          ctx.favorites[type] = [];\r\n          let fav = await favorites();\r\n          am7client.members(fav[am7model.jsonModelKey], fav.objectId, type, 0, 100, function (v) {\r\n            ctx.favorites[type] = v;\r\n          });\r\n        }\r\n      }\r\n\r\n    async function getTag(name, type){\r\n        let grp = await page.findObject(\"auth.group\", \"data\", \"~/Tags\");\r\n        if(grp == null){\r\n            return;\r\n        }\r\n        let q = am7view.viewQuery(am7model.newInstance(\"data.tag\"));\r\n        q.field(\"groupId\", grp.id);\r\n        q.field(\"name\", name);\r\n        if(type){\r\n            q.field(\"type\", type);\r\n        }\r\n        let qr = await page.search(q);\r\n        let tag;\r\n        if(qr && qr.results && qr.results.length){\r\n            tag = qr.results[0];\r\n        }\r\n        return tag;\r\n    }\r\n\r\n    async function systemLibrary(model){\r\n        let grp;\r\n        if(am7model.system.library[model]){\r\n            grp = await page.findObject(\"auth.group\", \"data\", am7model.system.library[model]);\r\n        }\r\n        return grp;\r\n    }\r\n\r\n    async function favorites(){\r\n        if(!page.user){\r\n            return;\r\n        }\r\n        let origin = page.user.homeDirectory;\r\n\r\n        let grp = await page.openObjectByName(\"auth.group\", origin.objectId, \"Favorites\");\r\n        if(!grp){\r\n            grp = am7model.newPrimitive(\"auth.group\");\r\n            grp.type = \"bucket\";\r\n            grp.parentId = origin.id;\r\n            grp.name = \"Favorites\";\r\n            await page.createObject(grp);\r\n            am7client.clearCache(\"auth.group\", true);\r\n            grp = await page.openObjectByName(\"auth.group\", origin.objectId, \"Favorites\");\r\n        }\r\n        return grp;\r\n    }\r\n\r\n    function uid(temp){\r\n        return temp.replace(/[xy]/g, function (c) {\r\n            const r = Math.random() * 16 | 0, \r\n                v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n        });\r\n    }\r\n\r\n    async function cleanupUserRemains(name){\r\n\r\n        let g = await promiseFindObject(\"auth.group\", \"data\", \"/home/\" + name);\r\n        if(g){\r\n            console.log(\"Cleaning up home directory\");\r\n            await promiseDeleteObject(\"auth.group\", g.objectId);\r\n        }\r\n        let r = await promiseFindObject(\"auth.role\", \"user\", \"/home/\" + name);\r\n        if(r){\r\n            console.log(\"Cleaning up home role\");\r\n            await promiseDeleteObject(\"auth.role\", r.objectId);\r\n        }\r\n        let p = await promiseFindObject(\"auth.permission\", \"user\", \"/home/\" + name);\r\n        if(p){\r\n            console.log(\"Cleaning up home permission\");\r\n            await promiseDeleteObject(\"auth.permission\", p.objectId);\r\n        }\r\n        let pg = await promiseFindObject(\"auth.group\", \"data\", \"/Persons\")\r\n        if(pg){\r\n            let up = await promiseOpenObjectByName(\"identity.person\", pg.objectId, name);\r\n            if(up){\r\n                console.log(\"Cleaning up person object\");\r\n                await promiseDeleteObject(\"identity.person\", up.objectId);\r\n            }\r\n        }\r\n    }\r\n\r\n    async function messages(){\r\n        contextModel.notifications = [];\r\n        //let listPathBase = (am7community.getCommunityMode() ? getRawUrl() : \"\") + \"/list/message\";\r\n        let listPathBase = getRawUrl() + \"/list/message\";\r\n        let dir = await page.makePath(\"auth.group\", \"data\", \"~/.messages\");\r\n        m.route.set(listPathBase + \"/\" + dir.objectId);\r\n    }\r\n\r\n    let webSocket;\r\n    function wssClose(){\r\n        if(!webSocket || webSocket.readyState === WebSocket.CLOSED){\r\n            // console.log(\"Connection already closed\");\r\n            return;\r\n        }\r\n        // console.log(\"Closing WebSocket\");\r\n        webSocket.close();\r\n        webSocket = undefined;\r\n    }\r\n\r\n    function wssConnect() {\r\n        if (webSocket !== undefined && webSocket.readyState !== WebSocket.CLOSED) {\r\n            console.warn(\"Connection is already open\");\r\n            return;\r\n        }\r\n        /*\r\n        if(!page.user){\r\n            console.warn(\"Connection requires authentication\");\r\n            return;\r\n        }\r\n        */\r\n        return new Promise((res, rej) => {\r\n            /// /\" + (page?.user?.objectId)\r\n            let wsUrl = g_application_path.replace(/^http[s]*/, \"wss\") + \"/wss\";\r\n            webSocket = new WebSocket(wsUrl);\r\n    \r\n            webSocket.onopen = function(event) {\r\n                res(event);\r\n            };\r\n    \r\n            webSocket.onmessage = function(event) {\r\n                if(event.data){\r\n                    routeMessage(JSON.parse(event.data));\r\n                }\r\n            };\r\n    \r\n            webSocket.onclose = function(event) {\r\n                /// console.log(\"WebSocket Closed ... TODO: Add reconnect\");\r\n                setTimeout(function(){\r\n                    reconnect(am7client.currentOrganization, page.token, 0);\r\n                }, 5000)\r\n                \r\n            };\r\n        });\r\n      }\r\n\r\n      let maxReconnect = 60;\r\n      async function reconnect(sOrg, sTok, iIter){\r\n        addToast(\"warn\", \"Reconnecting ...\", 5000);\r\n        let i = 0;\r\n        let iter = (iIter || 0) + 1;\r\n        let org = sOrg || am7client.currentOrganization;\r\n        let tok = sTok || page.token;\r\n        if(!org || !tok){\r\n            clearToast();\r\n            addToast(\"error\", \"Unable to reconnect\", 5000);\r\n            return;\r\n        }\r\n\r\n        /// Test that the server is available\r\n        try{\r\n            i = await m.request({method: \"GET\", url: g_application_path + \"/rest/login/time\"});\r\n        }\r\n        catch(e){\r\n            \r\n        }\r\n        \r\n        if(iter >= maxReconnect){\r\n            addToast(\"error\", \"Failed to reconnect\", 5000);\r\n            return;\r\n        }\r\n        if(i > 0){\r\n            await am7client.loginWithPassword(sOrg, \"${jwt}\", sTok, function(v){\r\n                clearToast();\r\n                if(v != null){\r\n                    addToast(\"success\", \"Reconnected\", 5000);\r\n                    page.router.refresh();\r\n                }\r\n                else{\r\n                    addToast(\"error\", \"Failed to reconnect\", 5000);\r\n                }\r\n            });\r\n        }\r\n        else{\r\n            setTimeout(function(){\r\n                reconnect(sOrg, sTok, iter);\r\n            }, 5000);\r\n        }\r\n      }\r\n\r\n      function routeMessage(msg){\r\n        if(msg.token){\r\n            page.token = msg.token;\r\n        }\r\n        if(msg.chirps){\r\n            let c1 = msg.chirps[0] || \"\";\r\n            if(c1.match(/(chatStart|chatComplete|chatUpdate|chatError)/)){\r\n                if(!page.chatStream){\r\n                    console.error(\"Chat stream isn't available\");\r\n                    return;\r\n                }\r\n                page.chatStream[\"on\" + c1.toLowerCase()](msg.chirps[1], msg.chirps[2], msg.chirps[3]);\r\n            }\r\n            else if(c1.match(/(audioUpdate|audioSTTUpdate|audioError)/)){\r\n                if(!page.audioStream){\r\n                    console.error(\"Audio stream isn't available\");\r\n                    return;\r\n                }\r\n                page.audioStream[\"on\" + c1.toLowerCase()](msg.chirps[1], msg.chirps[2]);\r\n            }\r\n            else if(c1 === \"chainEvent\"){\r\n                let eventType = msg.chirps[1];\r\n                let eventData = null;\r\n                try { eventData = JSON.parse(msg.chirps[2]); } catch(e) { eventData = msg.chirps[2]; }\r\n                if(page.chainStream){\r\n                    page.chainStream[\"on\" + eventType](eventData);\r\n                }\r\n            }\r\n            else if(c1.match(/^game\\.action\\./)){\r\n                // Game action messages (start, progress, complete, error, interrupt, cancel)\r\n                if(page.gameStream || window.gameStream){\r\n                    let gs = page.gameStream || window.gameStream;\r\n                    gs.routeActionMessage(c1, ...msg.chirps.slice(1));\r\n                }\r\n            }\r\n            else if(c1.match(/^game\\./)){\r\n                // Game push messages (situation, state, threat, npc, interaction, time, event)\r\n                if(page.gameStream || window.gameStream){\r\n                    let gs = page.gameStream || window.gameStream;\r\n                    gs.routePushMessage(c1, ...msg.chirps.slice(1));\r\n                }\r\n            }\r\n            else{\r\n                //console.warn(\"Unhandled message type: \" + c1);\r\n            }\r\n            /*\r\n            msg.chirps.forEach((s) => {\r\n                console.log(s);\r\n                page.toast(\"info\", s, 5000);\r\n            });\r\n            */\r\n        }\r\n      }\r\n  \r\n      async function wssSend(name, message, recipient, schema) {\r\n        try{\r\n            let recipientId = null;\r\n            if(typeof recipient == \"number\") recipientId = recipient;\r\n            else if(typeof recipient == \"string\"){\r\n                let obj = await promiseOpenObjectByName(\"USER\", null, recipient);\r\n                if(obj){\r\n                    recipientId = obj.id;\r\n                }\r\n            }\r\n            if(recipient && !recipientId){\r\n                console.warn(\"Invalid recipientId (\" + recipientId + \") for recipient \" + recipient);\r\n                return;\r\n            }\r\n            let msg = {\r\n                data : uwm.base64Encode(message),\r\n                modelType: schema,\r\n                messageId: page.uid(),\r\n                name : name,\r\n                // userId: (page?.user?.objectId),\r\n                recipientId,\r\n                recipientType: (recipientId != null ? \"USER\" : \"UNKNOWN\")\r\n\r\n            };\r\n            let dat = JSON.stringify({schema: \"message.socketMessage\", token: page?.token, message: msg});\r\n            webSocket.send(dat);\r\n        }\r\n        catch(e){\r\n            console.error(e);\r\n        }\r\n    }\r\n \r\n\r\n    async function resetCredential(obj, newCredential, currentCredential){\r\n\r\n        if(!obj){\r\n            obj = page.user;\r\n        }\r\n        let authReq = {\r\n\t\t\tschema: \"authenticationRequest\",\r\n\t\t\tcredential: uwm.base64Encode(newCredential),\r\n\t\t\tcredentialType: \"hashed_password\",\r\n            checkCredential: (currentCredential ? uwm.base64Encode(currentCredential) : null),\r\n            checkCredentialType: (currentCredential ? \"hashed_password\" : null)\r\n\t\t};\r\n        let newCred = await new Promise((res, rej)=>{\r\n            am7client.newPrimaryCredential(obj[am7model.jsonModelKey], obj.objectId, authReq, function(v){\r\n                res(v);\r\n            });\r\n        });\r\n\r\n        return newCred;\r\n    }\r\n\r\n    function getEntitlements(type, id){\r\n        return new Promise((res, rej) => {\r\n            if(contextModel.entitlements[id]) res(contextModel.entitlements[id]);\r\n            else am7client.entitlements(type, id, function(v){\r\n                contextModel.entitlements[id] = v || [];\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n    function getRequests(type, id, startRecord, recordCount){\r\n        let sr = startRecord || 0;\r\n        let rc = recordCount || 25;\r\n        return new Promise((res, rej) => {\r\n            if(contextModel.requests[id]) res(contextModel.requests[id]);\r\n            else am7client.listRequests(type, id, sr, rc, function(v){\r\n                contextModel.requests[id] = v || [];\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n    function getControls(type, id, startRecord, recordCount){\r\n        let sr = startRecord || 0;\r\n        let rc = recordCount || 25;\r\n        return new Promise((res, rej) => {\r\n            if(contextModel.controls[id]) res(contextModel.controls[id]);\r\n            else am7client.listControls(type, id, sr, rc, function(v){\r\n                contextModel.controls[id] = v || [];\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n\r\n    function getTags(type, id){\r\n        return new Promise((res, rej) => {\r\n            if(contextModel.tags[id]) res(contextModel.tags[id]);\r\n            else am7client.findTags(type, id, function(v){\r\n                contextModel.tags[id] = v || [];\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n    function clearServerCache(){\r\n        return new Promise((res, rej)=>{\r\n            am7client.clearCache(null, false, function(){\r\n                res(true);\r\n            });\r\n        });\r\n    }\r\n    async function cleanup(){\r\n        page.toast(\"info\", \"Cleaning up ...\", -1);\r\n        await am7client.cleanup();\r\n        await am7client.clearCache();       \r\n        page.clearToast();\r\n        page.toast(\"success\", \"Cleaned up!\");\r\n    }\r\n    function clearPageCache(){\r\n        \r\n        am7client.clearCache(false, true);\r\n\r\n        contextModel = newContextModel();\r\n\r\n        page.token = null;\r\n        page.user = null;\r\n        page.application = null;\r\n\r\n    }\r\n\r\n    function navigateToPathId(type, modType, path, handler){\r\n        console.log(type, modType, path);\r\n        return new Promise((res, rej)=>{\r\n            if(am7model.isGroup(modType)){\r\n                am7client.find(\"auth.group\",\"UNKNOWN\", path,function(v){\r\n                    if(v != null){\r\n                        res(v.objectId);\r\n                    }\r\n                    else res(null);\r\n                });\r\n            }\r\n            else res(null);\r\n        });\r\n    }\r\n\r\n    async function profileEntity(){\r\n        let grp = await promiseMakePath(\"auth.group\", \"DATA\", am7view.path(\"data.data\"));\r\n        let obj;\r\n        try{\r\n            obj = await promiseSearchObjectByName(\"data.data\", grp.id, \".profile\");\r\n        } catch(e){\r\n            console.error(e);\r\n        }\r\n        if(!obj){\r\n            obj = am7model.newPrimitive(\"data.data\");\r\n            obj.name = \".profile\";\r\n            obj.mimeType = \"application/json\";\r\n            obj.dataBytesStore = uwm.base64Encode(JSON.stringify({schema: \"userProfile\"}));\r\n            let bUp = await promiseCreate(obj);\r\n            obj = await promiseSearchObjectByName(\"data.data\", grp.objectId, \".profile\");\r\n        }\r\n        return obj;\r\n    }\r\n\r\n    function imageView(entity, fConfirm, fCancel){\r\n        page.components.dialog.setDialog({\r\n            label: \"Viewer\",\r\n            entityType: \"imageView\",\r\n            size: 75,\r\n            data: {\r\n                entity: {schema:\"imageView\", image:entity}\r\n            },\r\n            cancel: function(data){\r\n                if(fCancel) fCancel(data);\r\n                page.components.dialog.cancelDialog();\r\n            }\r\n        });\r\n    }\r\n\r\n    async function imageGallery(images, charInst, fCancel){\r\n        let galleryImages = images || [];\r\n        let characterInstance = charInst;\r\n\r\n        console.log(\"imageGallery called with images:\", images?.length, \"charInst:\", charInst);\r\n\r\n        // If charInst is provided, try to load all images from the appropriate source\r\n        if(characterInstance && characterInstance.entity){\r\n            let entity = characterInstance.entity;\r\n            let entitySchema = entity[am7model.jsonModelKey] || entity.schema;\r\n\r\n            // Check if this is an apparel entity (use gallery field directly)\r\n            if(entitySchema === \"olio.apparel\"){\r\n                let gallery = entity.gallery || [];\r\n                if(gallery.length > 0){\r\n                    // Put any new images (passed in) at the beginning, avoiding duplicates\r\n                    let existingIds = new Set(gallery.map(r => r.id));\r\n                    let newImages = galleryImages.filter(img => !existingIds.has(img.id));\r\n                    galleryImages = [...newImages, ...gallery];\r\n                }\r\n                // If we have images passed in, use those even if gallery is empty\r\n            }\r\n            // Otherwise, handle charPerson entities (use profile.portrait)\r\n            else {\r\n                let profile = entity.profile;\r\n                let portrait = profile ? profile.portrait : null;\r\n                let profileObjectId = profile ? profile.objectId : null;\r\n\r\n                // If profile exists but portrait isn't loaded, or profile is just a reference,\r\n                // query for the profile with portrait attribute\r\n                if(profileObjectId && (!portrait || !portrait.groupId)){\r\n                    let pq = am7view.viewQuery(\"identity.profile\");\r\n                    pq.field(\"objectId\", profileObjectId);\r\n                    pq.entity.request.push(\"portrait\");\r\n                    let pqr = await page.search(pq);\r\n                    if(pqr && pqr.results && pqr.results.length){\r\n                        portrait = pqr.results[0].portrait;\r\n                        // Update the entity's profile portrait reference\r\n                        if(!characterInstance.entity.profile){\r\n                            characterInstance.entity.profile = pqr.results[0];\r\n                        } else {\r\n                            characterInstance.entity.profile.portrait = portrait;\r\n                        }\r\n                        if(!portrait){\r\n                            console.warn(\"imageGallery: Profile query returned but no portrait found\");\r\n                        }\r\n                    } else {\r\n                        console.warn(\"imageGallery: Profile query returned no results for objectId: \" + profileObjectId);\r\n                    }\r\n                } else if(!profileObjectId){\r\n                    console.warn(\"imageGallery: No profile objectId available\", profile);\r\n                }\r\n\r\n                if(portrait && portrait.groupId){\r\n                    // Query for all images in the same group as the portrait\r\n                    let q = am7client.newQuery(\"data.data\")\r\n                    q.field(\"groupId\", portrait.groupId);\r\n                    q.entity.request.push(\"id\", \"objectId\", \"name\", \"groupId\", \"groupPath\", \"contentType\", \"attributes\", \"tags\");\r\n\r\n                    q.range(0, 200);\r\n                    q.sort(\"createdDate\");\r\n                    q.order(\"descending\");\r\n                    let qr = await page.search(q);\r\n                    if(qr && qr.results && qr.results.length){\r\n                        // Put any new images (passed in) at the beginning, avoiding duplicates\r\n                        let existingIds = new Set(qr.results.map(r => r.id));\r\n                        let newImages = galleryImages.filter(img => !existingIds.has(img.id));\r\n                        galleryImages = [...newImages, ...qr.results];\r\n                    } else {\r\n                        console.warn(\"imageGallery: No images found in group: \" + portrait.groupId);\r\n                    }\r\n                } else if(portrait && !portrait.groupId){\r\n                    console.warn(\"imageGallery: Portrait exists but no groupId\", portrait);\r\n                } else if(!portrait){\r\n                    console.warn(\"imageGallery: No portrait available after all attempts\");\r\n                }\r\n            }\r\n        } else {\r\n            console.warn(\"imageGallery: No characterInstance or entity provided\", characterInstance);\r\n        }\r\n\r\n        console.log(\"imageGallery: Final galleryImages count:\", galleryImages.length, \"images:\", galleryImages);\r\n\r\n        page.components.dialog.setDialog({\r\n            label: \"Gallery (\" + galleryImages.length + \" images)\",\r\n            entityType: \"imageGallery\",\r\n            size: 75,\r\n            data: {\r\n                entity: {schema:\"imageGallery\", images: galleryImages, currentIndex: 0, characterInstance: characterInstance}\r\n            },\r\n            cancel: function(data){\r\n                if(fCancel) fCancel(data);\r\n                page.components.dialog.cancelDialog();\r\n            }\r\n        });\r\n    }\r\n   \r\n\r\n    async function profile(){\r\n        let obj = await profileEntity();\r\n        let objj = {schema: \"userProfile\"};\r\n        if(obj.dataBytesStore && obj.dataBytesStore.length){\r\n            objj = JSON.parse(uwm.base64Decode(obj.dataBytesStore));\r\n            if(!objj[am7model.jsonModelKey]) objj[am7model.jsonModelKey] = \"userProfile\";\r\n        }\r\n        page.components.dialog.setDialog({\r\n            label: \"Profile\",\r\n            entityType: \"userProfile\",\r\n            size: 75,\r\n            data: {\r\n                object: obj,\r\n                entity: objj\r\n            },\r\n            confirm: updateProfile,\r\n            cancel: page.components.dialog.cancelDialog,\r\n        });\r\n    }\r\n    \r\n    /// TODO: Replace this by having system.user inherit identity.profile\r\n    /// Need to fix how referenced objects are created\r\n    /// In fact, the whole reference approach should probably just be removed in favor of participations\r\n    /// The new version of the back end only auto-creates when the parent object is created, and won't try to auto create \r\n    async function updateProfile(obj){\r\n\r\n        let a1 = am7client.getAttribute(page.user, \"v1-profile\");\r\n        let a2 = am7client.getAttribute(page.user, \"v1-profile-path\");\r\n\r\n        obj.entity.profilePortraitPath = undefined;\r\n        if(obj.entity.profilePortrait){\r\n            let port = await promiseOpenObject(\"data\", obj.entity.profilePortrait);\r\n            obj.entity.profilePortraitPath = am7client.dotPath(port.organizationPath) + \"/data.data\" + port.groupPath + \"/\" + port.name;\r\n        }\r\n\r\n        if(obj.entity.profilePortraitPath){\r\n            await am7client.patchAttribute(page.user, \"v1-profile-path\",obj.entity.profilePortraitPath);\r\n        }\r\n        if(obj.entity.profileId){\r\n            await am7client.patchAttribute(page.user, \"v1-profile\", obj.entity.profileId);\r\n        }\r\n\r\n        obj.object.dataBytesStore = uwm.base64Encode(JSON.stringify(obj.entity));\r\n        let bUp = await promisePatch(obj.object);\r\n\r\n        page.components.dialog.endDialog();\r\n        m.redraw();\r\n    }\r\n\r\n\r\n    \r\n    function removeToast(id){\r\n        toast = toast.filter((t)=>{\r\n            return t.id != id;\r\n        });\r\n    }\r\n    function burnToast(nt){\r\n        let o = document.querySelector(\"#toast-box-\" + nt.id);\r\n        if(o){\r\n            o.className = \"transition transition-0 toast-box \" + toastConfig[nt.type].style;\r\n        }\r\n        window.setTimeout(()=>{\r\n            nt.visible = false;\r\n            removeToast(nt.id);\r\n            m.redraw();\r\n        }, 300);\r\n    }\r\n    \r\n    function clearToast(){\r\n        toast = [];\r\n        m.redraw();\r\n    }\r\n\r\n    function addToast(type, msg, timeout){\r\n        let nt = {\r\n            id: page.luid(),\r\n            type,\r\n            message: msg,\r\n            visible: false,\r\n            expiry: timeout || 5000\r\n        };\r\n        toast.push(nt);\r\n        window.setTimeout(()=>{\r\n            nt.visible = true;\r\n            let o = document.querySelector(\"#toast-box-\" + nt.id);\r\n            if(o){\r\n                o.className = \"transition transition-100 toast-box \" + toastConfig[nt.type].style;\r\n            }\r\n        }, 10);\r\n        if(nt.expiry >= 0){\r\n            window.setTimeout(()=>{\r\n            burnToast(nt);\r\n            }, nt.expiry);\r\n        }\r\n        m.redraw();\r\n        return nt.id;\r\n    }\r\n\r\n    /// dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700\r\n    function loadToast(){\r\n        // transition-full transition-0 transition-100\r\n        let items = toast.map((t)=>{\r\n            let cfg = toastConfig[t.type];\r\n            let closeBtn = m(\"button\", {onclick: ()=>{ burnToast(t);}, type: \"button\", class: \"ms-auto -mx-1.5 -my-1.5  rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 dark:bg-gray-900 dark:text-gray-200 inline-flex items-center justify-center h-8 w-8 \"}, \r\n                m(\"span\", {class: \"material-symbols-outlined\"}, \"close\")\r\n            );\r\n            return m(\"div\", {id: \"toast-box-\" + t.id, class: \"transition transition-\" + (t.visible ? \"100\":\"0\") + \" toast-box \" + cfg.style}, [\r\n                m(\"div\", {class: cfg.icoStyle + \" ico-box\"}, [\r\n                    m(\"span\", {class: \"material-symbols-outlined\"}, cfg.ico)\r\n                ]),\r\n                m(\"div\", {class: \"toast-text\"}, t.message),\r\n                closeBtn\r\n            ]);\r\n        });\r\n        return (items.length == 0 ? \"\" : m(\"div\", {class: \"toast-container\"}, [\r\n            items\r\n        ]));\r\n\r\n    }\r\n\r\n\r\n    function listByType(type, objectId, bParent){\r\n        //let viewPath = (am7community.getCommunityMode() ? getRawUrl() : \"\") + \"/\" + (bParent ? \"p\" : \"\") + \"list/\" + type + \"/\" + objectId;\r\n        /// getRawUrl() + \r\n        let viewPath = \"/\" + (bParent ? \"p\" : \"\") + \"list/\" + type + \"/\" + objectId;\r\n        m.route.set(viewPath);\r\n    }\r\n\r\n    function iconButton(sClass, sIco, sLabel, fHandler){\r\n        return m(\"button\",{onclick : fHandler, class: sClass}, (sIco ? m(\"span\",{class: \"material-symbols-outlined material-icons-24\"},sIco) : \"\"), (sLabel || \"\"));\r\n    }\r\n    function getURI(){\r\n        let url = page.getRawUrl();\r\n        let params = [];\r\n        if(page.pagination.paginating){\r\n            let pages = page.pagination.pages();\r\n            if(pages != null && pages.currentPage > 0){\r\n                if(pages.filter != null) params.push(\"filter=\" + encodeURI(pages.filter));\r\n                params.push(\"startRecord=\" + ((pages.currentPage - 1)*pages.recordCount));\r\n                params.push(\"recordCount=\" + pages.recordCount);\r\n            }\r\n        }\r\n        return url + (params.length ? \"?\" + params.join(\"&\") : \"\");\r\n    }\r\n    function getURIStem(){\r\n        let stem = [];\r\n        let openItems = [];\r\n        Object.keys(contextModel.contextViews).forEach((k)=>{\r\n          openItems.push(\"{\" + contextModel.contextViews[k].mode + \".\" + contextModel.contextViews[k].type + \".\" + k + \"}\");\r\n        });\r\n        if(openItems.length) stem.push(\"open=\" + openItems.join(\",\"));\r\n        return stem.join(\"&\");\r\n    }\r\n\r\n    async function promiseCreate(object){\r\n        return new Promise((res, rej)=>{\r\n            am7client.create(object[am7model.jsonModelKey], object, function(v){\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n    async function promiseMakePath(type, subType, path){\r\n        return new Promise((res, rej)=>{\r\n            am7client.make(type, subType, path,function(v){\r\n                if(v != null){\r\n                    res(v);\r\n                }\r\n                else res(null);\r\n            });\r\n        });\r\n    }\r\n    async function promiseFindObject(type, subType, path){\r\n        return new Promise((res, rej)=>{\r\n            am7client.find(type, subType, path,function(v){\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n    /*\r\n    async function promiseListObjectsInParent(sType, id, start, length){\r\n        return new Promise((res, rej)=>{\r\n            am7client.listInParent(sType, id, start, length, function(v){\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n    */\r\n    async function promiseReparentObject(child, newParent){\r\n        let modType = am7model.getModel(child[am7model.jsonModelKey]);\r\n        let modType2 = am7model.getModel(newParent[am7model.jsonModelKey]);\r\n        if(!am7model.inherits(modType2, \"common.parent\")){\r\n            console.warn(\"Not a parentable object\");\r\n            return false;\r\n        }\r\n\r\n        child.parentId = newParent.id;\r\n\r\n        let b = await promisePatch(child);\r\n        am7client.clearCache(child[am7model.jsonModelKey]);\r\n        return b;\r\n    }\r\n    /*\r\n    async function promiseMember(object, actor, enabled){\r\n        return new Promise((res, rej)=>{\r\n            am7client.member(object[am7model.jsonModelKey], object.objectId, null, actor[am7model.jsonModelKey], actor.objectId, enabled, function(v){\r\n                res(v);\r\n            })\r\n\r\n        });\r\n    }\r\n    */\r\n\r\n    async function promiseParentType(sType){\r\n        return new Promise((res, rej) => {\r\n            am7client.user(sType, \"USER\", function(v){\r\n                uwm.getDefaultParentForType(sType, v).then((parObj) =>{\r\n                    if(parObj != null){\r\n                        res(parObj);\r\n                    }\r\n                    else{\r\n                        rej();\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    }\r\n    async function promiseMoveObject(object, group){\r\n        let modType = am7model.getModel(object[am7model.jsonModelKey]);\r\n        let bUp = false;\r\n        if(object[am7model.jsonModelKey].match(/^auth\\.group$/gi)){\r\n          console.warn(\"Use reparent to move groups\");\r\n          return;\r\n        }\r\n        if(object[am7model.jsonModelKey].match(/^data\\.data$/gi)){\r\n          delete object.dataBytesStore;\r\n        }\r\n        if(am7model.isGroup(modType)){\r\n          object.groupId = group.id;\r\n          object.groupPath = group.path;\r\n          bUp = await promisePatch(object);\r\n        }\r\n        return bUp;\r\n      }\r\n\r\n      async function promiseMember(sType, sId, sActorType, sActorId, bEnable){\r\n        return new Promise((res, rej)=>{\r\n            am7client.member(sType, sId, null, sActorType, sActorId, bEnable, function(v){\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n\r\n    async function promiseDeleteObject(sType, id){\r\n        return new Promise((res, rej)=>{\r\n            am7client.delete(sType, id, function(v){\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n    async function promiseListObjects(sType, id, sFields, start, length){\r\n            return am7client.list(sType, id, sFields, start, length);\r\n    }\r\n\r\n    async function promiseCountObjects(sType, id){\r\n            return am7client.count(sType, id);\r\n    }\r\n\r\n    async function promiseSearchObjectByName(type, id, name){\r\n        \r\n        if(typeof id == \"string\"){\r\n            let q = am7view.viewQuery(am7model.newInstance(\"auth.group\"));\r\n            q.field(\"objectId\", id);\r\n            let qr = await promiseSearch(q);\r\n            if(qr && qr.results){\r\n                id = qr.results[0].id;\r\n            }\r\n        }\r\n        if(typeof id == \"string\"){\r\n            console.error(\"Expected a numeric groupId\");\r\n            return null;\r\n        }\r\n        let q = am7view.viewQuery(am7model.newInstance(type));\r\n        q.field(\"groupId\", id);\r\n        if(name){\r\n            q.field(\"name\", name);\r\n        }\r\n        return new Promise( (res, rej) => {\r\n            page.search(q).then( (g2) => {\r\n                let og;\r\n                if(g2 && g2.results){\r\n                    og = g2.results[0];\r\n                }\r\n                res(og);\r\n            })\r\n        });\r\n    }\r\n\r\n    async function promiseOpenObjectByName(type, id, name, bParent){\r\n        return new Promise ((res, rej) => {\r\n            let o = null;\r\n            am7client.getByName(type, id, name, function(o){\r\n                res (o);\r\n            }).catch( () => {\r\n                res(null);\r\n            });\r\n        });\r\n    }\r\n\r\n    async function promiseStream(id, start, length){\r\n        if(typeof start == \"undefined\"){\r\n            start = 0;\r\n        }\r\n        if(typeof length == \"undefined\"){\r\n            length == 0;\r\n        }\r\n        if(typeof id == \"object\"){\r\n            if(!length) length = id.size;\r\n            id = id.objectId;\r\n        }\r\n        return (contextModel.streams[id] ? Promise.resolve(contextModel.streams[id]) : new Promise((res, rej)=>{\r\n            am7client.stream(id, start, length, function(v){\r\n                contextModel.streams[id] = v;\r\n                res(v);\r\n            });\r\n        }));\r\n    }\r\n\r\n    async function promiseSearch(query){\r\n        return am7client.search(query);\r\n    }\r\n    async function promiseCount(query){\r\n        return am7client.search(query, undefined, true);\r\n    }\r\n    async function promisePatch(object){\r\n        return new Promise((res, rej)=>{\r\n            am7client.patch(object[am7model.jsonModelKey], object, function(v){\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n    async function promiseOpenObject(type, id, mode){\r\n        return (contextModel.contextObjects[id] ? Promise.resolve(contextModel.contextObjects[id]) : new Promise((res, rej)=>{\r\n            let alt = (typeof id == \"string\" && id.match(/^am:/));\r\n            am7client[alt ? \"getByUrn\" : \"get\"](type, id, function(v){\r\n                contextModel.contextObjects[id] = v;\r\n                contextModel.contextViews[id] = {type: type, mode:mode};\r\n                res(v);\r\n            });\r\n        }));\r\n    }\r\n    function removeDuplicates(array, key){\r\n        return array.filter((obj, index, self) => index === self.findIndex((obj2) => (obj2.objectId === obj.objectId)));\r\n\r\n    }\r\n    function filterObject(object, keyMatch){\r\n        return Object.keys(object).filter((key) => { \r\n            return key.includes(keyMatch) == false;\r\n        }).reduce(( prev, key) => {\r\n            return Object.assign(prev, { [key]: object[key] });\r\n        }, {});\r\n    }\r\n\r\n     function goNav(){\r\n        m.route.set(\"/nav\");\r\n    }\r\n    \r\n    function goChat(){\r\n        m.route.set(\"/chat\");\r\n    }\r\n\r\n    function goHome(){\r\n        let url = \"/main\";\r\n       m.route.set(url);\r\n    }\r\n    function getRawUrl(){\r\n        let url = m.route.get();\r\n        let idx = url.indexOf(\"?\");\r\n        if(idx > -1) url = url.substring(0, idx);\r\n        return url;\r\n    }\r\n    function contentRouter(){\r\n        let curRout = m.route.get();\r\n        if(curRout != \"/sig\" && !page.authenticated()){\r\n            console.log(\"Force to /sig\");\r\n            return m.route.set(\"/sig\");\r\n        }\r\n        else{\r\n            return m(page.components.panel);\r\n        }\r\n    }\r\n   \r\n    /// given a data: url, exchange it for a blob url which caches the data to the client to be referenced by the blob id\r\n    ///\r\n    function toBlobUrl(dataURI){\r\n        /// https://stackoverflow.com/questions/9388412/data-uri-to-object-url-with-createobjecturl-in-chrome-ff\r\n        var mime = dataURI.split(',')[0].split(':')[1].split(';')[0];\r\n        /// TODO: Replace with Buffer.from(dataURI.split(',')[1],\"base64\"); \r\n        var binary = window.atob(dataURI.split(',')[1]);\r\n        var a = [];\r\n        for (var i = 0; i < binary.length; i++) {\r\n            a.push(binary.charCodeAt(i));\r\n        }\r\n        return URL.createObjectURL(new Blob([new Uint8Array(a)], {type: mime}));\r\n    }\r\n\r\n    function isAttributeSet (o, n, b) {\r\n        if (o == null || (typeof o != \"object\") || o.nodeType != 1) return 0;\r\n        var s = o.getAttribute(n);\r\n        if (typeof s != \"string\" || s.length == 0) return 0;\r\n        return (b ? s : 1);\r\n    }\r\n\r\n\r\n    function setInnerXHTML(t, s, p, d, z, c, h, ch) {\r\n\r\n        var y, e, a, l, x, n, v, r = 0, b, f;\r\n\r\n\r\n        if (!d) d = document;\r\n\r\n        b = (d == document ? 1 : 0);\r\n\r\n        if (!p)\r\n            HemiEngine.xml.removeChildren(t);\r\n\r\n        y = (s && typeof s == \"object\") ? s.nodeType : (typeof s == \"string\") ? 33 : -1;\r\n\r\n        try {\r\n\r\n            switch (y) {\r\n                case 1:\r\n                    if (h) {\r\n                        e = s.cloneNode(false);\r\n                    }\r\n                    else {\r\n                        f = s.nodeName;\r\n                        if (typeof ch == \"function\") f = ch(y, f);\r\n                        if (!f) return 0;\r\n                        e = d.createElement(f);\r\n                        a = s.attributes;\r\n                        l = a.length;\r\n                        for (x = 0; x < l; x++) {\r\n                            n = a[x].nodeName;\r\n                            v = a[x].nodeValue;\r\n                            if (typeof ch == \"function\") {\r\n                                n = ch(2, n);\r\n                                v = ch(2, v);\r\n                            }\r\n\r\n\r\n\r\n                            if (b && n == \"style\") {\r\n                                e.style.cssText = v;\r\n                            }\r\n\r\n                            else if (b && n == \"id\") {\r\n                                e.id = v;\r\n                            }\r\n\r\n\r\n\r\n                            else if (b && n == \"class\") {\r\n                                e.className = v;\r\n                            }\r\n\r\n\r\n                            else if (b && n.match(/^on/i)) {\r\n                                eval(\"e.\" + n + \"=function(){\" + v + \"}\");\r\n                            }\r\n                            else {\r\n                                e.setAttribute(n, v);\r\n                            }\r\n                        }\r\n                    }\r\n                    if (!z && s.hasChildNodes()) {\r\n                        a = s.childNodes;\r\n                        l = a.length;\r\n                        for (x = 0; x < l; x++)\r\n                           page.setInnerXHTML(e, a[x], 1, d, z, c, h, ch);\r\n\r\n                    }\r\n\r\n                    if (b && s.nodeName.match(/input/i) && isAttributeSet(s,\"checked\")) {\r\n                        e.checked = true;\r\n                    }\r\n                    t.appendChild(e);\r\n                    r = e;\r\n                    break;\r\n                case 3:\r\n                    e = s.nodeValue;\r\n                    if (typeof ch == DATATYPES.TYPE_FUNCTION) e = ch(y, e);\r\n                    if (e) {\r\n                        e = e.replace(/\\s+/g, \" \");\r\n                        t.appendChild(d.createTextNode(e));\r\n                        r = e;\r\n                    }\r\n                    break;\r\n\r\n                case 4:\r\n                    e = s.nodeValue;\r\n                    if (typeof ch == DATATYPES.TYPE_FUNCTION) e = ch(y, e);\r\n                    t.appendChild(d.createCDATASection(e));\r\n                    break;\r\n                case 8:\r\n\r\n                    break;\r\n                case 33:\r\n                    e = s;\r\n                    if (typeof ch == DATATYPES.TYPE_FUNCTION) e = ch(y, e);\r\n                    if (e) {\r\n                        if (!c) {\r\n                            e = e.replace(/^\\s*/, \"\");\r\n                            e = e.replace(/\\s*$/, \"\");\r\n                            e = e.replace(/\\s+/g, \" \");\r\n                        }\r\n                        t.appendChild(d.createTextNode(e));\r\n                        r = e;\r\n                    }\r\n                    break;\r\n                default:\r\n\r\n                    break;\r\n            }\r\n\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n\r\n        return r;\r\n    }\r\n\r\n    async function searchFirst(model, groupId, name, objectId){\r\n        let q = am7view.viewQuery(am7model.newInstance(model));\r\n        if(groupId){\r\n            q.field(\"groupId\", groupId);\r\n        }\r\n        if(name){\r\n            q.field(\"name\", name);\r\n        }\r\n        if(objectId){\r\n            q.field(\"objectId\", objectId);\r\n        }\r\n        let qr = await page.search(q);\r\n        let obj;\r\n        if(qr && qr.results && qr.results.length){\r\n            obj = qr.results[0];\r\n        }\r\n        return obj;\r\n    }\r\n    \r\n\r\n    let test = typeof module;\r\n\r\n    if (test !== \"undefined\") {\r\n        module.exports = page;\r\n    } else {\r\n        window.page = page;\r\n    }\r\n}());\r\n\n\n;/* === client/components/dialog.js === */\n(function(){\r\n\r\n    /// TODO: Persist chatRequest.\r\n    /// NOTE: The underlying AI request should also be persisted to make it easier to access and edit without having to deserialize the data.data byteStore\r\n    ///\r\n\r\n    let dialogUp = false;\r\n    let dialogCfg;\r\n\r\n    async function chatInto(ref, inst, aCCfg){\r\n        let sessName = page.sessionName();\r\n\r\n        let pa = (await loadPromptList()).filter(c => c.name.match(/^Object/gi));\r\n        let ca = (await loadChatList()).filter(c => c.name.match(/^Object/gi));\r\n        let cname = \"Analyze \" + (ref && ref[am7model.jsonModelKey] ? ref[am7model.jsonModelKey].toUpperCase() + \" \" : \"\") + (ref?.name ? ref.name : inst.api.name());\r\n        let remoteEnt = {\r\n          schema: \"olio.llm.chatRequest\",          \r\n          chatConfig: ca.length ? ca[0] : undefined,\r\n          promptConfig: pa.length ? pa[0] : undefined,\r\n          name:cname\r\n          //sessions: sessName\r\n        };\r\n        let wset = [];\r\n        /*\r\n        /// Since the summary tag is set to the summary notes and not the reference, adding the tag will limit the citations to only the summary notes\r\n        let tag = await page.getTag(\"Summary\");\r\n        if(tag){\r\n            wset.push(tag);\r\n        }\r\n        */\r\n        let aCPs = [];\r\n        \r\n        if(inst && aCCfg){\r\n            let aC = aCCfg.filter(c => c.name == inst.api.chatConfig()?.name);\r\n            if(aC.length && aC[0].userCharacter && aC[0].systemCharacter){\r\n                aCPs.push(aC[0].userCharacter.name);\r\n                aCPs.push(aC[0].systemCharacter.name);\r\n            }\r\n        }\r\n        else if(ref && (ref[am7model.jsonModelKey] == \"olio.charPerson\" || ref[am7model.jsonModelKey] == \"identity.person\")){\r\n            aCPs.push(ref.name);\r\n        }\r\n        \r\n        if(inst && inst.api.session && inst.api.session() != null && inst.api.session()[am7model.jsonModelKey]){\r\n            let sq = am7view.viewQuery(inst.api.session()[am7model.jsonModelKey]);\r\n            sq.entity.request = [\"id\", \"objectId\", \"groupId\", \"groupPath\", \"organizationId\", \"organizationPath\"];\r\n            sq.field(\"id\", inst.api.session().id);\r\n            let sess = await page.search(sq);\r\n            if(sess && sess.results && sess.results.length){\r\n                let x = await m.request({ method: 'GET', url: am7client.base() + \"/vector/vectorize/\" + inst.api.session()[am7model.jsonModelKey] + \"/\" + sess.results[0].objectId + \"/WORD/500\", withCredentials: true });\r\n                if(x){\r\n                    wset.push(sess.results[0]);\r\n                }\r\n                else{\r\n                    page.toast(\"error\", \"Session vectorization failed: \" + inst.api.session().id);\r\n                }\r\n            }\r\n            else{\r\n                page.toast(\"error\", \"Session not found: \" + inst.api.session().id);\r\n            }\r\n        }\r\n        \r\n        if(aCPs.length){\r\n            let grp = await page.findObject(\"auth.group\", \"data\", \"~/Tags\");\r\n            let q = am7view.viewQuery(am7model.newInstance(\"data.tag\"));\r\n            q.field(\"groupId\", grp.id);\r\n            let q2 = q.field(null, null);\r\n            q2.comparator = \"group_or\";\r\n            q2.fields = aCPs.map((a) => {\r\n                return {\r\n                    name: \"name\",\r\n                    comparator: \"equals\",\r\n                    value: a\r\n                }\r\n            });\r\n            /*\r\n            [\r\n                {name: \"name\", comparator: \"equals\", value: aC[0].userCharacter.name},\r\n                {name: \"name\", comparator: \"equals\", value: aC[0].systemCharacter.name}\r\n            ];\r\n            */\r\n    \r\n            let qr = await page.search(q);\r\n            if(qr && qr.results){\r\n                am7model.updateListModel(qr.results);\r\n                wset.push(...qr.results);\r\n            }\r\n        }\r\n\r\n        if(ref){\r\n            wset.push(ref);\r\n        }\r\n  \r\n        let w = window.open(\"/\", \"_blank\");\r\n        w.remoteEntity = remoteEnt;\r\n        w.onload = function(){\r\n          w.page.components.dnd.workingSet.push(...wset);\r\n          if(wset.length){\r\n            w.page.components.topMenu.activeShuffle(wset[0]);\r\n          }\r\n          w.m.route.set(\"/chat\");\r\n        }\r\n  \r\n  \r\n        \r\n      }\r\n\r\n    function endDialog(){\r\n        dialogUp = false;\r\n        m.redraw();\r\n    }\r\n    function setDialog(cfg){\r\n        dialogCfg = cfg;\r\n        dialogUp = true;\r\n        m.redraw();\r\n    }\r\n\r\n    function showProgress(object, inst) {\r\n        if(!object){\r\n            return;\r\n        }\r\n        object.label = object.label || \"Progress\";\r\n        let cfg = {\r\n            label: object.label,\r\n            entityType: \"progress\",\r\n            size: 50,\r\n            data: {entity:object, inst},\r\n            cancel: async function (data) {\r\n                endDialog();\r\n            }\r\n        };\r\n        setDialog(cfg);\r\n    }\r\n\r\n    async function loadPromptList(){\r\n        let dir = await page.findObject(\"auth.group\", \"DATA\", \"~/Chat\");\r\n        return await am7client.list(\"olio.llm.promptConfig\", dir.objectId, null, 0, 0);\r\n    }\r\n\r\n    async function loadChatList() {\r\n        let dir = await page.findObject(\"auth.group\", \"DATA\", \"~/Chat\");\r\n        return await am7client.list(\"olio.llm.chatConfig\", dir.objectId, null, 0, 0);\r\n      }\r\n\r\n    function updateSessionName(inst, acfg, pcfg, bRename){\r\n        let chat = inst.api.chatConfig();\r\n        let prompt = inst.api.promptConfig();\r\n        if(!chat || !prompt){\r\n            console.warn(\"Invalid chat or prompt selection: \" + chat + \" / \" + prompt);\r\n            return;\r\n        }\r\n       \r\n        let ycfg = pcfg.filter(a => a.name.toLowerCase() == prompt.name.toLowerCase());\r\n        let vcfg = acfg.filter(a => a.name.toLowerCase() == chat.name.toLowerCase());\r\n        if(!ycfg.length || !vcfg.length){\r\n            console.warn(\"Invalid chat or prompt list: \" + chat + \" / \" + prompt);\r\n            return;\r\n        }\r\n        let occfg = vcfg[0];\r\n        let opcfg = ycfg[0];\r\n\r\n        inst.api.setting(occfg.setting)\r\n\r\n        let name;\r\n        if(inst.api.name) name = inst.api.name();\r\n\r\n        if(bRename || !name || !name.length){\r\n            if(page.components.dnd.workingSet.length){\r\n                name = page.components.dnd.workingSet[0].name;\r\n            }\r\n            else if(occfg.systemCharacter && occfg.userCharacter){\r\n                let sysName = occfg.systemCharacter.firstName || occfg.systemCharacter.name.substring(0,occfg.systemCharacter.name.indexOf(\" \"));\r\n                let usrName = occfg.userCharacter.firstName || occfg.userCharacter.name.substring(0,occfg.userCharacter.name.indexOf(\" \"));\r\n                name = sysName + \" and \" + usrName + \" (\" + occfg.rating.toUpperCase() + \")\";\r\n            }\r\n            else {\r\n                name = page.sessionName();\r\n            }\r\n        }\r\n        inst.api.name(name);\r\n\r\n    }\r\n    \r\n    async function chatSettings(cinst, fHandler){\r\n        let entity = cinst ? cinst.entity : am7model.newPrimitive(\"olio.llm.chatRequest\");\r\n        let inst = am7model.prepareInstance(entity, am7model.forms.newChatRequest);\r\n        let acfg = await loadChatList();\r\n        if(acfg && acfg.length && !entity.chatConfig) entity.chatConfig = acfg[0];\r\n        let pcfg = await loadPromptList();\r\n        if(pcfg && pcfg.length && !entity.promptConfig) entity.promptConfig = pcfg[0];\r\n\r\n        inst.action(\"chatConfig\", function(){updateSessionName(inst, acfg, pcfg, true);});\r\n        inst.action(\"promptConfig\", function(){updateSessionName(inst, acfg, pcfg, true);});\r\n        updateSessionName(inst, acfg, pcfg);\r\n\r\n        let cfg = {\r\n            label: \"Chat Settings\",\r\n            entityType: \"olio.llm.chatRequest\",\r\n            size: 75,\r\n            data: {entity, inst},\r\n            confirm: async function (data) {\r\n\r\n                if(fHandler){\r\n                    fHandler(entity);\r\n                }\r\n\r\n                endDialog();\r\n            },\r\n            cancel: async function (data) {\r\n                endDialog();\r\n            }\r\n        };\r\n        setDialog(cfg);\r\n    }\r\n\r\n    async function summarize(object, inst){\r\n        let entity = am7model.newPrimitive(\"summarizeSettings\");\r\n        let acfg = await loadChatList();\r\n        if(acfg && acfg.length) entity.chat = acfg[0].name;\r\n        am7model.getModelField(\"summarizeSettings\", \"chat\").limit  = acfg.map((c) => { return c.name; });\r\n\r\n        let pcfg = await loadPromptList();\r\n        if(pcfg && pcfg.length) entity.prompt = pcfg[0].name;\r\n        am7model.getModelField(\"summarizeSettings\", \"prompt\").limit  = pcfg.map((c) => { return c.name; });\r\n\r\n\r\n        let cfg = {\r\n            label: \"Summarize Options\",\r\n            entityType: \"summarizeSettings\",\r\n            size: 50,\r\n            data: {entity},\r\n            confirm: async function (data) {\r\n                let ycfg = pcfg.filter(a => a.name.toLowerCase() == entity.prompt.toLowerCase());\r\n                if(!ycfg.length){\r\n                    page.toast(\"error\", \"Invalid prompt selection: \" + entity.prompt);\r\n                    return;\r\n                }\r\n\r\n                let vcfg = acfg.filter(a => a.name.toLowerCase() == entity.chat.toLowerCase());\r\n                if(!vcfg.length){\r\n                    page.toast(\"error\", \"Invalid chat selection: \" + entity.chat);\r\n                    return;\r\n                }\r\n                page.toast(\"info\", \"Summarizing ...\", -1);\r\n                let creq = am7model.newPrimitive(\"olio.llm.chatRequest\");\r\n                creq.chatConfig = {name:vcfg[0].name,id:vcfg[0].id};\r\n                creq.promptConfig = {name: ycfg[0].name, id: ycfg[0].id};\r\n                creq.data = [\r\n                    JSON.stringify({schema:inst.model.name,objectId:inst.api.objectId()})\r\n                ];\r\n                let x = await m.request({ method: 'POST', url: am7client.base() + \"/vector/summarize/\" + entity.chunkType.toUpperCase() + \"/\" + entity.chunk, body: creq, withCredentials: true });\r\n                page.clearToast();\r\n                if (x && x != null) {\r\n                    page.toast(\"success\", \"Summarization complete\");\r\n                }\r\n                else{\r\n                    page.toast(\"error\", \"Summarization failed\");\r\n                }\r\n                endDialog();\r\n            },\r\n            cancel: async function (data) {\r\n                endDialog();\r\n            }\r\n        };\r\n        setDialog(cfg);\r\n\r\n    }\r\n\r\n    async function vectorize(object, inst) {\r\n        let entity = am7model.newPrimitive(\"vectorOptions\");\r\n        let cfg = {\r\n            label: \"Vector Options\",\r\n            entityType: \"vectorOptions\",\r\n            size: 50,\r\n            data: {entity},\r\n            confirm: async function (data) {\r\n                page.toast(\"info\", \"Vectorizing ...\");\r\n                let x = await m.request({ method: 'GET', url: am7client.base() + \"/vector/vectorize/\" + inst.model.name + \"/\" + inst.api.objectId() + \"/\" + entity.chunkType.toUpperCase() + \"/\" + entity.chunk, withCredentials: true });\r\n                if (x && x != null) {\r\n                    page.toast(\"success\", \"Vectorization complete\");\r\n                }\r\n                else{\r\n                    page.toast(\"error\", \"Vectorization failed\");\r\n                }\r\n                endDialog();\r\n            },\r\n            cancel: async function (data) {\r\n                endDialog();\r\n            }\r\n        };\r\n        setDialog(cfg);\r\n    }\r\n\r\n    let lastReimage;\r\n\r\n    // SD config load/save/apply delegated to am7sd common utility (sdConfig.js)\r\n    function loadSDConfig(name) { return am7sd.loadConfig(name); }\r\n    function saveSDConfig(name, config) { return am7sd.saveConfig(name, config); }\r\n    function applySDConfig(cinst, config) { return am7sd.applyConfig(cinst, config); }\r\n\r\n    // Social sharing context mapping to wear levels\r\n    // Maps wear level names (from wearLevelEnumType) to social sharing tags\r\n    // Levels: NONE, INTERNAL, UNDER, ON, BASE, ACCENT, SUIT, GARNITURE, ACCESSORY, OVER, OUTER, FULL_BODY, ENCLOSURE, UNKNOWN\r\n    // UNDER/ON = tattoos/implants (under skin, on skin), BASE = skin contact clothing\r\n    const socialSharingMap = {\r\n        \"NONE\": \"nude\",      // No clothing - nude\r\n        \"INTERNAL\": \"nude\",  // Internal items (implants)\r\n        \"UNDER\": \"nude\",     // Under skin (implants)\r\n        \"ON\": \"nude\",        // On skin (tattoos)\r\n        \"BASE\": \"intimate\",           // Skin contact clothing (underwear)\r\n        \"ACCENT\": \"public\",           // Everything above BASE is public\r\n        \"SUIT\": \"public\",\r\n        \"GARNITURE\": \"public\",\r\n        \"ACCESSORY\": \"public\",\r\n        \"OVER\": \"public\",\r\n        \"OUTER\": \"public\",\r\n        \"FULL_BODY\": \"public\",\r\n        \"ENCLOSURE\": \"public\",\r\n        \"UNKNOWN\": null               // No automatic tag for unknown\r\n    };\r\n\r\n    // All social sharing tags that can be toggled in the gallery\r\n    // These are the subjective tags users can manually apply\r\n    const socialSharingTags = [\r\n        \"nude\",\r\n        \"selfie\",\r\n        \"inappropriate\",\r\n        \"intimate\",\r\n        \"sexy\",\r\n        \"private\",\r\n        \"casual\",\r\n        \"public\",\r\n        \"professional\"\r\n    ];\r\n\r\n    // Get or create a social sharing tag\r\n    async function getOrCreateSharingTag(tagName, objectType){\r\n        // First try to get existing tag\r\n        let tag = await page.getTag(tagName, objectType);\r\n        if(tag){\r\n            return tag;\r\n        }\r\n\r\n        // Create the tag if it doesn't exist\r\n        let grp = await page.findObject(\"auth.group\", \"data\", \"~/Tags\");\r\n        if(!grp){\r\n            console.warn(\"Tags group not found\");\r\n            return null;\r\n        }\r\n\r\n        let newTag = am7model.newPrimitive(\"data.tag\");\r\n        newTag.name = tagName;\r\n        newTag.type = objectType;\r\n        newTag.groupId = grp.id;\r\n        newTag.groupPath = grp.path;\r\n        newTag.description = \"Social sharing context: \" + tagName;\r\n\r\n        tag = await page.createObject(newTag);\r\n        return tag;\r\n    }\r\n\r\n    // Apply social sharing tag to an image based on wear level\r\n    async function applySharingTag(image, wearLevelName){\r\n        let sharingContext = socialSharingMap[wearLevelName];\r\n        if(!sharingContext){\r\n            // No automatic tag for this level (e.g., UNKNOWN)\r\n            return;\r\n        }\r\n\r\n        let tag = await getOrCreateSharingTag(sharingContext, \"data.data\");\r\n        if(!tag){\r\n            console.warn(\"Failed to get/create sharing tag: \" + sharingContext);\r\n            return;\r\n        }\r\n\r\n        // Make the image a member of the tag\r\n        await page.member(\"data.tag\", tag.objectId, \"data.data\", image.objectId, true);\r\n    }\r\n\r\n    // Toggle a sharing tag on an image\r\n    async function toggleSharingTag(image, tagName, enable){\r\n        let tag = await getOrCreateSharingTag(tagName, \"data.data\");\r\n        if(!tag){\r\n            console.warn(\"Failed to get/create sharing tag: \" + tagName);\r\n            return false;\r\n        }\r\n\r\n        // Add or remove membership\r\n        await page.member(\"data.tag\", tag.objectId, \"data.data\", image.objectId, enable);\r\n        return true;\r\n    }\r\n\r\n    // Expose for use in gallery\r\n    if(typeof window !== \"undefined\"){\r\n        window.am7sharingTags = {\r\n            tags: socialSharingTags,\r\n            toggle: toggleSharingTag,\r\n            getOrCreate: getOrCreateSharingTag\r\n        };\r\n    }\r\n\r\n    // ==========================================\r\n    // Image Token System (shared by cardGame.js and chat.js)\r\n    // ==========================================\r\n\r\n    const chatImageTags = [\"selfie\", \"nude\", \"intimate\", \"sexy\", \"private\", \"casual\", \"public\", \"professional\"];\r\n\r\n    const tagToWearLevel = {\r\n        \"nude\": \"NONE\",\r\n        \"intimate\": \"BASE\",\r\n        \"sexy\": \"BASE\",\r\n        \"private\": \"ACCENT\",\r\n        \"casual\": \"SUIT\",\r\n        \"public\": \"SUIT\",\r\n        \"professional\": \"SUIT\",\r\n        \"selfie\": null\r\n    };\r\n\r\n    // Cache for resolved image URLs\r\n    let resolvedImageCache = {};\r\n\r\n    function parseImageTokens(content) {\r\n        if (!content) return [];\r\n        let tokens = [];\r\n        let regex = /\\$\\{image\\.([^}]+)\\}/g;\r\n        let match;\r\n        while ((match = regex.exec(content)) !== null) {\r\n            let inner = match[1];\r\n            let parts = inner.split(\".\");\r\n            let id = null;\r\n            let tagStr;\r\n            if (parts.length > 1 && parts[0].indexOf(\"-\") > -1) {\r\n                id = parts[0];\r\n                tagStr = parts.slice(1).join(\".\");\r\n            } else {\r\n                tagStr = inner;\r\n            }\r\n            let tags = tagStr.split(\",\").map(t => t.trim()).filter(t => t.length > 0);\r\n            tokens.push({\r\n                match: match[0],\r\n                id: id,\r\n                tags: tags,\r\n                start: match.index,\r\n                end: match.index + match[0].length\r\n            });\r\n        }\r\n        return tokens;\r\n    }\r\n\r\n    function getImageThumbnailUrl(image, size) {\r\n        if (!image || !image.groupPath || !image.name) return null;\r\n        return g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) +\r\n               \"/data.data\" + image.groupPath + \"/\" + image.name + \"/\" + (size || \"256x256\");\r\n    }\r\n\r\n    async function findImageForTags(character, tags) {\r\n        if (!character || !tags || !tags.length) return null;\r\n\r\n        let charName = character.name || (character.firstName + \" \" + character.lastName);\r\n        let nameTag = await page.getTag(charName, \"data.data\");\r\n        if (!nameTag) return null;\r\n\r\n        let charImages = await am7client.members(\"data.tag\", nameTag.objectId, \"data.data\", 0, 100);\r\n        if (!charImages || !charImages.length) return null;\r\n\r\n        let candidateIds = new Set(charImages.map(img => img.objectId));\r\n\r\n        for (let tagName of tags) {\r\n            if (tagName === \"selfie\") continue;\r\n            let tag = await page.getTag(tagName, \"data.data\");\r\n            if (!tag) {\r\n                candidateIds.clear();\r\n                break;\r\n            }\r\n            let tagMembers = await am7client.members(\"data.tag\", tag.objectId, \"data.data\", 0, 100);\r\n            if (!tagMembers || !tagMembers.length) {\r\n                candidateIds.clear();\r\n                break;\r\n            }\r\n            let memberIds = new Set(tagMembers.map(img => img.objectId));\r\n            for (let cid of candidateIds) {\r\n                if (!memberIds.has(cid)) candidateIds.delete(cid);\r\n            }\r\n        }\r\n\r\n        if (candidateIds.size === 0) return null;\r\n        let ids = Array.from(candidateIds);\r\n        let picked = ids[Math.floor(Math.random() * ids.length)];\r\n        return charImages.find(img => img.objectId === picked) || null;\r\n    }\r\n\r\n    // When true, opens the reimage dialog before generating so user can review/edit config\r\n    let debugReimage = false;\r\n\r\n    async function generateImageForTags(character, tags) {\r\n        if (!character) return null;\r\n\r\n        page.toast(\"info\", \"Generating image for \" + (character.name || \"character\") + \"...\", -1);\r\n\r\n        try {\r\n            let targetLevel = \"SUIT\";\r\n            for (let tag of tags) {\r\n                if (tagToWearLevel[tag] && tagToWearLevel[tag] !== null) {\r\n                    let lvl = tagToWearLevel[tag];\r\n                    let levelOrder = [\"NONE\", \"BASE\", \"ACCENT\", \"SUIT\"];\r\n                    if (levelOrder.indexOf(lvl) < levelOrder.indexOf(targetLevel)) {\r\n                        targetLevel = lvl;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Load SD config\r\n            let entity = await am7sd.fetchTemplate(true);\r\n\r\n            // Set style to selfie if tags include \"selfie\"\r\n            if (tags.indexOf(\"selfie\") >= 0) {\r\n                entity.style = \"selfie\";\r\n            }\r\n\r\n            let charType = character[am7model.jsonModelKey] || \"olio.charPerson\";\r\n            let charName = character.name || (character.firstName + \" \" + character.lastName);\r\n\r\n            // Get character record for profile info\r\n            let charRecord = await page.searchFirst(charType, undefined, undefined, character.objectId);\r\n            let originalPortraitId = charRecord && charRecord.profile && charRecord.profile.portrait ? charRecord.profile.portrait.id : null;\r\n            let profileId = charRecord && charRecord.profile ? charRecord.profile.id : null;\r\n\r\n            // Dress character to target wear level\r\n            let originalWearStates = [];\r\n            if (charRecord && charRecord.store && charRecord.store.objectId) {\r\n                // Use getFull on store to get apparel with proper inuse flags\r\n                await am7client.clearCache(\"olio.store\");\r\n                let sto = await am7client.getFull(\"olio.store\", charRecord.store.objectId);\r\n                if (sto && sto.apparel && sto.apparel.length) {\r\n                    let activeAp = sto.apparel.find(a => a.inuse) || sto.apparel[0];\r\n                    // Use getFull on apparel to get wearables with proper inuse flags\r\n                    await am7client.clearCache(\"olio.apparel\");\r\n                    let app = await am7client.getFull(\"olio.apparel\", activeAp.objectId);\r\n                    if (app && app.wearables && app.wearables.length) {\r\n                        let wears = app.wearables;\r\n                        let targetIdx = am7model.enums.wearLevelEnumType.indexOf(targetLevel);\r\n                        let patches = [];\r\n                        wears.forEach(function(w) {\r\n                            if (w.level) {\r\n                                originalWearStates.push({id: w.id, inuse: w.inuse});\r\n                                let lvl = am7model.enums.wearLevelEnumType.indexOf(w.level.toUpperCase());\r\n                                let shouldWear = (targetLevel !== \"NONE\" && lvl <= targetIdx);\r\n                                if (w.inuse !== shouldWear) {\r\n                                    patches.push({schema: 'olio.wearable', id: w.id, inuse: shouldWear});\r\n                                }\r\n                            }\r\n                        });\r\n                        if (patches.length) {\r\n                            await am7client.clearCache();\r\n                            await Promise.all(patches.map(function(p) { return page.patchObject(p); }));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // If debug mode, open the reimage dialog and wait for user confirmation\r\n            if (debugReimage) {\r\n                page.clearToast();\r\n                let cinst = am7model.prepareInstance(entity, am7model.forms.sdConfig);\r\n\r\n                // Try to load character-specific SD config\r\n                let charConfigName = charName + \"-SD.json\";\r\n                let charConfig = await loadSDConfig(charConfigName);\r\n                if (charConfig) {\r\n                    applySDConfig(cinst, charConfig);\r\n                }\r\n\r\n                // Wait for user to confirm or cancel the dialog\r\n                entity = await new Promise(function(resolve, reject) {\r\n                    let cfg = {\r\n                        label: \"Chat Image: \" + charName + \" [\" + tags.join(\", \") + \"]\",\r\n                        entityType: \"olio.sd.config\",\r\n                        size: 75,\r\n                        data: {entity: cinst.entity, inst: cinst},\r\n                        confirm: async function() {\r\n                            endDialog();\r\n                            resolve(cinst.entity);\r\n                        },\r\n                        cancel: async function() {\r\n                            endDialog();\r\n                            resolve(null);\r\n                        }\r\n                    };\r\n                    setDialog(cfg);\r\n                });\r\n\r\n                if (!entity) {\r\n                    page.clearToast();\r\n                    return null; // User cancelled\r\n                }\r\n                page.toast(\"info\", \"Generating image...\", -1);\r\n            }\r\n\r\n            let image = await m.request({\r\n                method: 'POST',\r\n                url: am7client.base() + \"/olio/\" + charType + \"/\" + character.objectId + \"/reimage\",\r\n                body: entity,\r\n                withCredentials: true\r\n            });\r\n\r\n            if (!image) {\r\n                page.toast(\"error\", \"Failed to generate image\");\r\n                return null;\r\n            }\r\n\r\n            // Tag with sharing context\r\n            let sharingTag = targetLevel === \"NONE\" ? \"nude\" :\r\n                            targetLevel === \"BASE\" ? \"intimate\" : \"public\";\r\n            let stag = await getOrCreateSharingTag(sharingTag, \"data.data\");\r\n            if (stag) {\r\n                await page.member(\"data.tag\", stag.objectId, \"data.data\", image.objectId, true);\r\n            }\r\n\r\n            for (let tagName of tags) {\r\n                if (tagName !== sharingTag) {\r\n                    let t = await getOrCreateSharingTag(tagName, \"data.data\");\r\n                    if (t) {\r\n                        await page.member(\"data.tag\", t.objectId, \"data.data\", image.objectId, true);\r\n                    }\r\n                }\r\n            }\r\n\r\n            let nameTag = await getOrCreateSharingTag(charName, \"data.data\");\r\n            if (nameTag) {\r\n                await page.member(\"data.tag\", nameTag.objectId, \"data.data\", image.objectId, true);\r\n            }\r\n\r\n            await page.applyImageTags(image.objectId);\r\n\r\n            // Restore original portrait (reimage sets it to the new image)\r\n            if (profileId && originalPortraitId) {\r\n                let od = {id: profileId, portrait: {id: originalPortraitId}};\r\n                od[am7model.jsonModelKey] = \"identity.profile\";\r\n                await page.patchObject(od);\r\n            }\r\n\r\n            // Restore original wear states\r\n            if (originalWearStates.length) {\r\n                let restorePatches = originalWearStates.map(function(s) {\r\n                    return {schema: 'olio.wearable', id: s.id, inuse: s.inuse};\r\n                });\r\n                await am7client.clearCache();\r\n                await Promise.all(restorePatches.map(function(p) { return page.patchObject(p); }));\r\n            }\r\n\r\n            page.clearToast();\r\n            page.toast(\"success\", \"Image generated\");\r\n            return image;\r\n        } catch (e) {\r\n            console.error(\"generateImageForTags error:\", e);\r\n            page.clearToast();\r\n            page.toast(\"error\", \"Image generation failed\");\r\n            return null;\r\n        }\r\n    }\r\n\r\n    async function resolveImageToken(token, character) {\r\n        if (token.id) {\r\n            if (resolvedImageCache[token.id]) {\r\n                return resolvedImageCache[token.id];\r\n            }\r\n            let charName = character.name || (character.firstName + \" \" + character.lastName);\r\n            let nameTag = await page.getTag(charName, \"data.data\");\r\n            if (nameTag) {\r\n                let members = await am7client.members(\"data.tag\", nameTag.objectId, \"data.data\", 0, 100);\r\n                if (members) {\r\n                    let img = members.find(mi => mi.objectId === token.id);\r\n                    if (img) {\r\n                        let url = getImageThumbnailUrl(img, \"256x256\");\r\n                        resolvedImageCache[token.id] = { image: img, url: url };\r\n                        return { image: img, url: url };\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        let image = await findImageForTags(character, token.tags);\r\n        if (!image) {\r\n            image = await generateImageForTags(character, token.tags);\r\n        }\r\n        if (image) {\r\n            let url = getImageThumbnailUrl(image, \"256x256\");\r\n            resolvedImageCache[image.objectId] = { image: image, url: url };\r\n            return { image: image, url: url };\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // Expose image token functions globally\r\n    if(typeof window !== \"undefined\"){\r\n        window.am7imageTokens = {\r\n            tags: chatImageTags,\r\n            tagToWearLevel: tagToWearLevel,\r\n            cache: resolvedImageCache,\r\n            parse: parseImageTokens,\r\n            thumbnailUrl: getImageThumbnailUrl,\r\n            findForTags: findImageForTags,\r\n            generateForTags: generateImageForTags,\r\n            resolve: resolveImageToken,\r\n            get debug() { return debugReimage; },\r\n            set debug(v) { debugReimage = v; }\r\n        };\r\n    }\r\n\r\n    async function getCurrentWearLevel(inst){\r\n        // Get store with getFull to get apparel with inuse flags\r\n        let storeRef = inst.api.store();\r\n        if(!storeRef || !storeRef.objectId){\r\n            return null;\r\n        }\r\n        await am7client.clearCache(\"olio.store\");\r\n        let sto = await am7client.getFull(\"olio.store\", storeRef.objectId);\r\n        if(!sto || !sto.apparel || !sto.apparel.length){\r\n            return null;\r\n        }\r\n        let activeAp = sto.apparel.find(a => a.inuse) || sto.apparel[0];\r\n\r\n        // Get full apparel to get wearables with inuse flags\r\n        await am7client.clearCache(\"olio.apparel\");\r\n        let app = await am7client.getFull(\"olio.apparel\", activeAp.objectId);\r\n        if(!app || !app.wearables || !app.wearables.length){\r\n            return null;\r\n        }\r\n        let wears = app.wearables;\r\n\r\n        // Find the current max level that is in use\r\n        let maxLevel = -1;\r\n        let maxLevelName = \"NUDE\";\r\n        wears.forEach((w) => {\r\n            if(w.level && w.inuse){\r\n                let lvl = am7model.enums.wearLevelEnumType.findIndex(we => we == w.level.toUpperCase());\r\n                if(lvl > maxLevel){\r\n                    maxLevel = lvl;\r\n                    maxLevelName = w.level.toUpperCase();\r\n                }\r\n            }\r\n        });\r\n\r\n        // Get level index (position in enum)\r\n        let levelIndex = maxLevel >= 0 ? maxLevel : 0;\r\n        return {level: maxLevelName, index: levelIndex};\r\n    }\r\n\r\n    async function reimage(object, inst) {\r\n\r\n        let isCharPerson = inst.model.name === \"olio.charPerson\";\r\n\r\n        //let entity = am7model.newPrimitive(\"olio.sd.config\");\r\n        let entity = await am7sd.fetchTemplate(true);\r\n        let cinst = (lastReimage || am7model.prepareInstance(entity, am7model.forms.sdConfig));\r\n\r\n        function tempApplyDefaults(){\r\n            // TODO - Add to form\r\n            cinst.api.steps(40);\r\n            cinst.api.refinerSteps(40);\r\n            cinst.api.cfg(5);\r\n            cinst.api.refinerCfg(5);\r\n            cinst.api.model(\"sdXL_v10VAEFix.safetensors\");\r\n            cinst.api.refinerModel(\"juggernautXL_ragnarokBy.safetensors\");\r\n        }\r\n\r\n        tempApplyDefaults();\r\n\r\n        // Use consistent photograph style as default (can be overridden by saved config)\r\n        cinst.entity.style = \"photograph\";\r\n\r\n        // Try to load character-specific config\r\n        let charConfigName = inst.api.name() + \"-SD.json\";\r\n        let charConfig = await loadSDConfig(charConfigName);\r\n        if(charConfig){\r\n            applySDConfig(cinst, charConfig);\r\n        }\r\n\r\n        // Fill style-specific defaults after style may have changed from template\r\n        am7sd.fillStyleDefaults(cinst.entity);\r\n\r\n        lastReimage = cinst;\r\n\r\n        if(isCharPerson) {\r\n            await am7olio.setNarDescription(inst, cinst);\r\n        } else {\r\n            // For data.data, set reference image for img2img\r\n            if(inst.api.objectId()) {\r\n                cinst.entity.referenceImageId = inst.api.objectId();\r\n            }\r\n        }\r\n\r\n        // Apply preferred seed from character attributes (overrides saved config)\r\n        let cseed = (inst.entity?.attributes || []).filter(a => a.name == \"preferredSeed\");\r\n        if(cseed.length){\r\n            cinst.api.seed(cseed[0].value);\r\n        }\r\n        let cfg = {\r\n            label: \"Reimage \" + inst.api.name(),\r\n            entityType: \"olio.sd.config\",\r\n            size: 75,\r\n            data: {entity:cinst.entity, inst: cinst},\r\n            confirm: async function (data) {\r\n                //console.log(data);\r\n                let count = cinst.api.imageCount ? (parseInt(cinst.api.imageCount()) || 1) : 1;\r\n                if(count < 1) count = 1;\r\n\r\n                let baseSeed = cinst.api.seed();\r\n                let images = [];\r\n                let wearLevel = isCharPerson ? await getCurrentWearLevel(inst) : null;\r\n\r\n                for(let i = 0; i < count; i++){\r\n                    page.toast(\"info\", \"Creating image \" + (i + 1) + \" of \" + count + \"...\", -1);\r\n\r\n                    // Increment seed for subsequent images\r\n                    let useSeed = baseSeed;//(i === 0) ? baseSeed : (parseInt(baseSeed) + i);\r\n                    let imgEntity = Object.assign({}, cinst.entity);\r\n                    imgEntity.seed = useSeed;\r\n\r\n                    let x = await m.request({ method: 'POST', url: am7client.base() + \"/olio/\" + inst.model.name + \"/\" + inst.api.objectId() + \"/reimage\", body: imgEntity, withCredentials: true });\r\n\r\n                    if(!x){\r\n                        page.toast(\"error\", \"Failed to create image \" + (i + 1));\r\n                        break;\r\n                    }\r\n\r\n                    // Tag image with wear level and apply sharing tag\r\n                    if(wearLevel){\r\n                        await am7client.patchAttribute(x, \"wearLevel\", wearLevel.level + \"/\" + wearLevel.index);\r\n                        await applySharingTag(x, wearLevel.level);\r\n                    }\r\n\r\n                    // Apply image tags (caption/description)\r\n                    await page.applyImageTags(x.objectId);\r\n\r\n                    if(isCharPerson) {\r\n                        // Apply character name tag (model type, for character queries)\r\n                        let nameTag = await getOrCreateSharingTag(inst.api.name(), inst.model.name);\r\n                        if(nameTag){\r\n                            await page.member(\"data.tag\", nameTag.objectId, \"data.data\", x.objectId, true);\r\n                        }\r\n                        // Apply character name tag (data.data type, for image discovery)\r\n                        let imageNameTag = await getOrCreateSharingTag(inst.api.name(), \"data.data\");\r\n                        if(imageNameTag){\r\n                            await page.member(\"data.tag\", imageNameTag.objectId, \"data.data\", x.objectId, true);\r\n                        }\r\n                    }\r\n\r\n                    // Apply style-specific tags\r\n                    if(cinst.entity.style === \"selfie\") {\r\n                        let selfieTag = await getOrCreateSharingTag(\"selfie\", \"data.data\");\r\n                        if(selfieTag){\r\n                            await page.member(\"data.tag\", selfieTag.objectId, \"data.data\", x.objectId, true);\r\n                        }\r\n                    }\r\n\r\n                    images.push(x);\r\n\r\n                    // For first image, extract seed and update portrait\r\n                    if(i === 0){\r\n                        if(isCharPerson) {\r\n                            inst.entity.profile.portrait = x;\r\n\r\n                            let od = {id: inst.entity.profile.id, portrait: {id: x.id}};\r\n                            od[am7model.jsonModelKey] = \"identity.profile\";\r\n                            await page.patchObject(od);\r\n                        }\r\n\r\n                        // Extract seed from response image (important for random seeds)\r\n                        let seed = x.attributes.filter(a => a.name == \"seed\");\r\n                        if(seed.length){\r\n                            await am7client.patchAttribute(inst.entity, \"preferredSeed\", seed[0].value);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                page.clearToast();\r\n\r\n                if(images.length > 0){\r\n                    page.toast(\"success\", \"Created \" + images.length + \" image(s)\");\r\n\r\n                    // Save SD config for this character\r\n                    let charConfigName = inst.api.name() + \"-SD.json\";\r\n                    let saveEntity = Object.assign({}, cinst.entity);\r\n                    saveEntity.shared = false; // Always save character config with shared=false\r\n                    await saveSDConfig(charConfigName, saveEntity);\r\n\r\n                    // If shared was checked, also save to shared config\r\n                    if(cinst.api.shared && cinst.api.shared()){\r\n                        await saveSDConfig(\"sharedSD.json\", cinst.entity);\r\n                        cinst.api.shared(false); // Reset checkbox after save\r\n                    }\r\n\r\n                    // Clear the context cache for this object and its portrait\r\n                    page.clearContextObject(inst.api.objectId());\r\n                    images.forEach(img => {\r\n                        if(img.objectId) page.clearContextObject(img.objectId);\r\n                    });\r\n\r\n                    // Force Mithril redraw\r\n                    m.redraw();\r\n                }\r\n                else{\r\n                    page.toast(\"error\", \"Reimage failed\");\r\n                }\r\n\r\n                endDialog();\r\n\r\n                // Show images - single or gallery\r\n                if(images.length === 1){\r\n                    page.imageView(images[0]);\r\n                } else if(images.length > 1){\r\n                    page.imageGallery(images, inst);\r\n                }\r\n\r\n            },\r\n            cancel: async function (data) {\r\n                endDialog();\r\n            }\r\n        };\r\n        \r\n        am7model.forms.sdConfig.fields.dressDown.field.command = async function(){\r\n            if(!isCharPerson) return;\r\n            await am7olio.dressCharacter(inst, false);\r\n            await am7olio.setNarDescription(inst, cinst);\r\n        };\r\n\r\n        am7model.forms.sdConfig.fields.dressUp.field.command = async function(){\r\n            if(!isCharPerson) return;\r\n            await am7olio.dressCharacter(inst, true);\r\n            await am7olio.setNarDescription(inst, cinst);\r\n        };\r\n        am7model.forms.sdConfig.fields.randomSeed.field.command = async function(){\r\n            cinst.api.seed(-1);\r\n        };\r\n        am7model.forms.sdConfig.fields.selectReference.field.command = async function(){\r\n            let galleryImages = [];\r\n            if(isCharPerson) {\r\n                let profile = inst.entity.profile;\r\n                let portrait = profile ? profile.portrait : null;\r\n                let profileObjectId = profile ? profile.objectId : null;\r\n                if(profileObjectId && (!portrait || !portrait.groupId)){\r\n                    let pq = am7view.viewQuery(\"identity.profile\");\r\n                    pq.field(\"objectId\", profileObjectId);\r\n                    pq.entity.request.push(\"portrait\");\r\n                    let pqr = await page.search(pq);\r\n                    if(pqr && pqr.results && pqr.results.length){\r\n                        portrait = pqr.results[0].portrait;\r\n                    }\r\n                }\r\n                if(portrait && portrait.groupId){\r\n                    let q = am7client.newQuery(\"data.data\");\r\n                    q.field(\"groupId\", portrait.groupId);\r\n                    q.entity.request.push(\"id\", \"objectId\", \"name\", \"groupId\", \"groupPath\", \"contentType\");\r\n                    q.range(0, 100);\r\n                    q.sort(\"createdDate\");\r\n                    q.order(\"descending\");\r\n                    let qr = await page.search(q);\r\n                    if(qr && qr.results) {\r\n                        galleryImages = qr.results.filter(r => r.contentType && r.contentType.match(/^image\\//i));\r\n                    }\r\n                }\r\n            } else if(inst.entity.groupId) {\r\n                let q = am7client.newQuery(\"data.data\");\r\n                q.field(\"groupId\", inst.entity.groupId);\r\n                q.entity.request.push(\"id\", \"objectId\", \"name\", \"groupId\", \"groupPath\", \"contentType\");\r\n                q.range(0, 100);\r\n                q.sort(\"createdDate\");\r\n                q.order(\"descending\");\r\n                let qr = await page.search(q);\r\n                if(qr && qr.results) {\r\n                    galleryImages = qr.results.filter(r => r.contentType && r.contentType.match(/^image\\//i));\r\n                }\r\n            }\r\n            if(!galleryImages.length){\r\n                page.toast(\"warn\", \"No gallery images found\");\r\n                return;\r\n            }\r\n            let savedCfg = dialogCfg;\r\n            let orgPath = am7client.dotPath(am7client.currentOrganization);\r\n            let pickerView = {\r\n                view: function(){\r\n                    return m(\"div\", {style: \"padding: 12px; display: flex; flex-wrap: wrap; gap: 8px; max-height: 400px; overflow-y: auto;\"},\r\n                        galleryImages.map(function(img){\r\n                            let src = g_application_path + \"/thumbnail/\" + orgPath + \"/data.data\" + img.groupPath + \"/\" + img.name + \"/96x96\";\r\n                            let selected = cinst.entity.referenceImageId === img.objectId;\r\n                            return m(\"img\", {\r\n                                src: src,\r\n                                width: 96, height: 96,\r\n                                style: \"object-fit: cover; border-radius: 4px; cursor: pointer; border: 3px solid \" + (selected ? \"#2196F3\" : \"transparent\") + \";\",\r\n                                title: img.name,\r\n                                onclick: function(){\r\n                                    cinst.entity.referenceImageId = img.objectId;\r\n                                    if(!cinst.entity.denoisingStrength || cinst.entity.denoisingStrength === 0.75) {\r\n                                        cinst.entity.denoisingStrength = 0.6;\r\n                                    }\r\n                                    setDialog(savedCfg);\r\n                                    m.redraw();\r\n                                }\r\n                            });\r\n                        })\r\n                    );\r\n                }\r\n            };\r\n            setDialog({\r\n                label: \"Select Reference Image\",\r\n                entityType: \"imagePicker\",\r\n                size: 75,\r\n                data: {entity: {}, view: pickerView},\r\n                cancel: async function(){\r\n                    setDialog(savedCfg);\r\n                }\r\n            });\r\n        };\r\n        am7model.forms.sdConfig.fields.createApparelSequence.field.command = async function(){\r\n            if(!isCharPerson) return;\r\n            // Get store with getFull to get apparel with proper inuse flags\r\n            let storeRef = inst.api.store();\r\n            if(!storeRef || !storeRef.objectId){\r\n                page.toast(\"error\", \"No store found for character\");\r\n                return;\r\n            }\r\n            await am7client.clearCache(\"olio.store\");\r\n            let sto = await am7client.getFull(\"olio.store\", storeRef.objectId);\r\n            if(!sto || !sto.apparel || !sto.apparel.length){\r\n                page.toast(\"error\", \"No apparel found in store\");\r\n                return;\r\n            }\r\n            let appl = sto.apparel;\r\n            let activeAp = appl.find(a => a.inuse) || appl[0];\r\n\r\n            // Get full apparel to get wearables with proper inuse flags\r\n            await am7client.clearCache(\"olio.apparel\");\r\n            let app = await am7client.getFull(\"olio.apparel\", activeAp.objectId);\r\n            if(!app || !app.wearables || !app.wearables.length){\r\n                page.toast(\"error\", \"No wearables found in apparel\");\r\n                return;\r\n            }\r\n            let wears = app.wearables;\r\n\r\n            // Get sorted unique wear levels present in wearables\r\n            let lvls = [...new Set(wears.sort((a, b) => {\r\n                let aL = am7model.enums.wearLevelEnumType.findIndex(we => we == a.level.toUpperCase());\r\n                let bL = am7model.enums.wearLevelEnumType.findIndex(we => we == b.level.toUpperCase());\r\n                return aL < bL ? -1 : aL > bL ? 1 : 0;\r\n            }).map((w) => w.level.toUpperCase()))];\r\n\r\n            if(!lvls.length){\r\n                page.toast(\"error\", \"No wear levels found\");\r\n                return;\r\n            }\r\n\r\n            // Dress down completely (all wearables off) first\r\n            page.toast(\"info\", \"Dressing down completely...\", -1);\r\n            let dressedDown = true;\r\n            while(dressedDown == true){\r\n                dressedDown = await am7olio.dressApparel(activeAp, false);\r\n            }\r\n            // Update server narrative to reflect fully undressed state\r\n            await am7model.forms.commands.narrate(undefined, inst);\r\n\r\n            // Store original seed\r\n            let baseSeed = cinst.api.seed();\r\n            let images = [];\r\n\r\n            // Check if lowest level is not NUDE - if so, create a nude image first\r\n            let lowestLevel = lvls[0];\r\n            let nudeIdx = am7model.enums.wearLevelEnumType.findIndex(we => we == \"NUDE\");\r\n            let lowestIdx = am7model.enums.wearLevelEnumType.findIndex(we => we == lowestLevel);\r\n            let includeNude = (lowestIdx > nudeIdx);\r\n\r\n            // Iterate through each level from lowest to highest\r\n            page.toast(\"info\", \"Creating apparel sequence...\", -1);\r\n            let totalImages = lvls.length + (includeNude ? 1 : 0);\r\n\r\n            // Create nude image first if needed\r\n            if(includeNude){\r\n                // Server narrative already updated after dress-down above\r\n                page.toast(\"info\", \"Creating image 1 of \" + totalImages + \" (level: NUDE)...\", -1);\r\n                let imgEntity = Object.assign({}, cinst.entity);\r\n                imgEntity.seed = baseSeed;\r\n                let x = await m.request({ method: 'POST', url: am7client.base() + \"/olio/\" + inst.model.name + \"/\" + inst.api.objectId() + \"/reimage\", body: imgEntity, withCredentials: true });\r\n                if(x){\r\n                    // Extract seed if it was random (-1)\r\n                    let seed = x.attributes.filter(a => a.name == \"seed\");\r\n                    if(seed.length){\r\n                        baseSeed = seed[0].value;\r\n                        await am7client.patchAttribute(inst.entity, \"preferredSeed\", baseSeed);\r\n                    }\r\n                    await am7client.patchAttribute(x, \"wearLevel\", \"NUDE/\" + nudeIdx);\r\n                    await applySharingTag(x, \"NUDE\");\r\n                    // Apply image tags (caption/description)\r\n                    await page.applyImageTags(x.objectId);\r\n                    // Apply character name tag (model type, for character queries)\r\n                    let nameTag = await getOrCreateSharingTag(inst.api.name(), inst.model.name);\r\n                    if(nameTag){\r\n                        await page.member(\"data.tag\", nameTag.objectId, \"data.data\", x.objectId, true);\r\n                    }\r\n                    // Apply character name tag (data.data type, for image discovery)\r\n                    let imageNameTag = await getOrCreateSharingTag(inst.api.name(), \"data.data\");\r\n                    if(imageNameTag){\r\n                        await page.member(\"data.tag\", imageNameTag.objectId, \"data.data\", x.objectId, true);\r\n                    }\r\n                    images.push(x);\r\n                }\r\n            }\r\n\r\n            for(let i = 0; i < lvls.length; i++){\r\n                // Dress up to this level first (we start fully undressed)\r\n                await am7olio.dressApparel(activeAp, true);\r\n\r\n                // Update server narrative to reflect current clothing state\r\n                await am7model.forms.commands.narrate(undefined, inst);\r\n\r\n                // Set seed (base seed + image count for 2nd+ images)\r\n                let useSeed = (images.length === 0) ? baseSeed : (parseInt(baseSeed) + images.length);\r\n                cinst.api.seed(useSeed);\r\n\r\n                // Create image\r\n                page.toast(\"info\", \"Creating image \" + (images.length + 1) + \" of \" + totalImages + \" (level: \" + lvls[i] + \")...\", -1);\r\n                let imgEntity = Object.assign({}, cinst.entity);\r\n                imgEntity.seed = useSeed;\r\n                let x = await m.request({ method: 'POST', url: am7client.base() + \"/olio/\" + inst.model.name + \"/\" + inst.api.objectId() + \"/reimage\", body: imgEntity, withCredentials: true });\r\n\r\n                if(!x){\r\n                    page.toast(\"error\", \"Failed to create image at level \" + lvls[i]);\r\n                    break;\r\n                }\r\n\r\n                // For first image (if no nude), extract seed if it was random (-1)\r\n                if(images.length === 0){\r\n                    let seed = x.attributes.filter(a => a.name == \"seed\");\r\n                    if(seed.length){\r\n                        baseSeed = seed[0].value;\r\n                        await am7client.patchAttribute(inst.entity, \"preferredSeed\", baseSeed);\r\n                    }\r\n                }\r\n\r\n                // Tag image with wear level and apply sharing tag\r\n                let levelIndex = am7model.enums.wearLevelEnumType.findIndex(we => we == lvls[i]);\r\n                await am7client.patchAttribute(x, \"wearLevel\", lvls[i] + \"/\" + levelIndex);\r\n                await applySharingTag(x, lvls[i]);\r\n\r\n                // Apply image tags (caption/description)\r\n                await page.applyImageTags(x.objectId);\r\n\r\n                // Apply character name tag (model type, for character queries)\r\n                let nameTag = await getOrCreateSharingTag(inst.api.name(), inst.model.name);\r\n                if(nameTag){\r\n                    await page.member(\"data.tag\", nameTag.objectId, \"data.data\", x.objectId, true);\r\n                }\r\n                // Apply character name tag (data.data type, for image discovery)\r\n                let imageNameTag = await getOrCreateSharingTag(inst.api.name(), \"data.data\");\r\n                if(imageNameTag){\r\n                    await page.member(\"data.tag\", imageNameTag.objectId, \"data.data\", x.objectId, true);\r\n                }\r\n\r\n                // Apply style-specific tags (e.g., selfie)\r\n                if(cinst.entity.style === \"selfie\") {\r\n                    let selfieTag = await getOrCreateSharingTag(\"selfie\", \"data.data\");\r\n                    if(selfieTag){\r\n                        await page.member(\"data.tag\", selfieTag.objectId, \"data.data\", x.objectId, true);\r\n                    }\r\n                }\r\n\r\n                images.push(x);\r\n            }\r\n\r\n            // Restore seed to extracted value (important if it was random)\r\n            cinst.api.seed(baseSeed);\r\n\r\n            // Save SD config for this character\r\n            if(images.length > 0){\r\n                let charConfigName = inst.api.name() + \"-SD.json\";\r\n                let saveEntity = Object.assign({}, cinst.entity);\r\n                saveEntity.shared = false;\r\n                await saveSDConfig(charConfigName, saveEntity);\r\n\r\n                // If shared was checked, also save to shared config\r\n                if(cinst.api.shared && cinst.api.shared()){\r\n                    await saveSDConfig(\"sharedSD.json\", cinst.entity);\r\n                    cinst.api.shared(false);\r\n                }\r\n            }\r\n            else{\r\n                page.toast(\"warn\", \"Nothing  to save\");\r\n            }\r\n\r\n            page.clearToast();\r\n            page.toast(\"success\", \"Created \" + images.length + \" images in apparel sequence\");\r\n            m.redraw();\r\n\r\n            // Show images in gallery\r\n            if(images.length === 1){\r\n                page.imageView(images[0]);\r\n            } else if(images.length > 1){\r\n                page.imageGallery(images, inst);\r\n            }\r\n        };\r\n        am7model.forms.sdConfig.fields.loadShared.field.command = async function(){\r\n            let sharedConfig = await loadSDConfig(\"sharedSD.json\");\r\n            if(sharedConfig){\r\n                let seed = cinst.api.seed(); // Preserve current seed\r\n                applySDConfig(cinst, sharedConfig);\r\n                cinst.api.seed(seed);\r\n                cinst.api.shared(false); // Reset shared checkbox after loading\r\n                m.redraw();\r\n                page.toast(\"success\", \"Loaded shared SD config\");\r\n            } else {\r\n                page.toast(\"warn\", \"No shared SD config found\");\r\n            }\r\n        };\r\n        am7model.forms.sdConfig.fields.randomConfig.field.command = async function(){\r\n            let ncfg = await am7sd.fetchTemplate(true);\r\n            // Do style first since that drives the display\r\n            cinst.api.style(ncfg.style);\r\n            m.redraw();\r\n            let seed = cinst.api.seed();\r\n            for(let k in ncfg){\r\n                if(k != \"id\" && k != \"objectId\" && k != \"style\"){\r\n                    if(cinst.api[k]) cinst.api[k](ncfg[k]);\r\n                }\r\n            }\r\n            cinst.api.seed(seed);\r\n            tempApplyDefaults();\r\n            setTimeout(m.redraw, 10);\r\n        };\r\n        setDialog(cfg);\r\n    }\r\n\r\n    async function reimageApparel(object, inst) {\r\n        if (!inst || inst.model.name !== \"olio.apparel\") {\r\n            page.toast(\"error\", \"Not an apparel record\");\r\n            return;\r\n        }\r\n\r\n        let entity = await am7sd.fetchTemplate(true);\r\n        let cinst = am7model.prepareInstance(entity, am7model.forms.sdMannequinConfig);\r\n\r\n        function tempApplyDefaults(){\r\n            cinst.api.steps(40);\r\n            cinst.api.refinerSteps(40);\r\n            cinst.api.model(\"sdXL_v10VAEFix.safetensors\");\r\n            cinst.api.refinerModel(\"juggernautXL_ragnarokBy.safetensors\");\r\n            // Use consistent photograph style for apparel\r\n            cinst.entity.style = \"photograph\";\r\n        }\r\n\r\n        tempApplyDefaults();\r\n\r\n        // Try to load shared apparel config\r\n        let sharedConfig = await loadSDConfig(\"sharedApparelSD.json\");\r\n        if(sharedConfig){\r\n            applySDConfig(cinst, sharedConfig);\r\n        }\r\n\r\n        // Wire up the random seed button\r\n        am7model.forms.sdMannequinConfig.fields.randomSeed.field.command = async function(){\r\n            cinst.api.seed(-1);\r\n        };\r\n\r\n        // Wire up the load shared button\r\n        am7model.forms.sdMannequinConfig.fields.loadShared.field.command = async function(){\r\n            let config = await loadSDConfig(\"sharedApparelSD.json\");\r\n            if(config){\r\n                applySDConfig(cinst, config);\r\n                page.toast(\"success\", \"Loaded shared apparel config\");\r\n                m.redraw();\r\n            } else {\r\n                page.toast(\"warn\", \"No shared apparel config found\");\r\n            }\r\n        };\r\n\r\n        let cfg = {\r\n            label: \"Mannequin Images: \" + inst.api.name(),\r\n            entityType: \"olio.sd.config\",\r\n            size: 50,\r\n            data: {entity: cinst.entity, inst: cinst},\r\n            confirm: async function (data) {\r\n                let baseSeed = cinst.api.seed();\r\n                let hires = cinst.api.hires ? cinst.api.hires() : false;\r\n\r\n                page.toast(\"info\", \"Creating mannequin images...\", -1);\r\n\r\n                let imgEntity = Object.assign({}, cinst.entity);\r\n                imgEntity.seed = baseSeed;\r\n                imgEntity.hires = hires;\r\n\r\n                let images = await m.request({\r\n                    method: 'POST',\r\n                    url: am7client.base() + \"/olio/apparel/\" + inst.api.objectId() + \"/reimage\",\r\n                    body: imgEntity,\r\n                    withCredentials: true\r\n                });\r\n\r\n                console.log(\"reimageApparel: Server returned images:\", images);\r\n\r\n                page.clearToast();\r\n\r\n                if(images && images.length > 0){\r\n                    page.toast(\"success\", \"Created \" + images.length + \" mannequin image(s)\");\r\n\r\n                    // Clear the context cache for this object\r\n                    page.clearContextObject(inst.api.objectId());\r\n                    images.forEach(img => {\r\n                        if(img.objectId) page.clearContextObject(img.objectId);\r\n                    });\r\n\r\n                    // Apply style-specific tags (e.g., selfie)\r\n                    if(cinst.entity.style === \"selfie\") {\r\n                        let selfieTag = await getOrCreateSharingTag(\"selfie\", \"data.data\");\r\n                        if(selfieTag){\r\n                            for(let img of images){\r\n                                await page.member(\"data.tag\", selfieTag.objectId, \"data.data\", img.objectId, true);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Save shared config if checkbox is checked\r\n                    if(cinst.api.shared && cinst.api.shared()){\r\n                        await saveSDConfig(\"sharedApparelSD.json\", cinst.entity);\r\n                        cinst.api.shared(false);\r\n                    }\r\n\r\n                    // Force Mithril redraw\r\n                    m.redraw();\r\n\r\n                }\r\n                else{\r\n                    page.toast(\"error\", \"Mannequin imaging failed\");\r\n                }\r\n\r\n                // Close config dialog first, then show images\r\n                endDialog();\r\n\r\n                // Show images - these functions open their own dialogs\r\n                if(images && images.length > 0){\r\n                    console.log(\"reimageApparel: About to call imageGallery, inst:\", inst, \"inst.entity:\", inst?.entity);\r\n                    if(images.length === 1){\r\n                        page.imageView(images[0]);\r\n                    } else if(images.length > 1){\r\n                        page.imageGallery(images, inst);\r\n                    }\r\n                }\r\n            },\r\n            cancel: async function (data) {\r\n                endDialog();\r\n            }\r\n        };\r\n\r\n        setDialog(cfg);\r\n    }\r\n\r\n    function loadDialog(){\r\n        if(!dialogCfg || !dialogUp) return \"\";\r\n        return createDialog(dialogCfg.size, dialogCfg.entityType, dialogCfg.data, dialogCfg.label, dialogCfg.confirm, dialogCfg.cancel);\r\n    }\r\n\r\n    function createDialog(size, entityType, data, title, fConf, fCanc){\r\n        let sizeCls = \"page-dialog-\" + (size || \"50\");\r\n\r\n        if(!data.view){\r\n            data.view = page.views.object().view;\r\n        }\r\n        let mconf = \"\";\r\n        if(fConf){\r\n            mconf = m(\"button\", {class: \"page-dialog-button\", onclick: async function(){ if(data.view) data.view.sync(); await fConf(data);}}, [\r\n                m(\"span\", {class: \"material-symbols-outlined material-symbols-outlined-white md-18 mr-2\"}, \"check\"),\r\n                \"Ok\"\r\n            ])\r\n        }\r\n        return [\r\n            m(\"div\", {class: \"screen-glass screen-glass-open\"}, [\r\n                m(\"div\", {class: \"screen-glass-gray\"})\r\n            ]),\r\n            m(\"div\", {class: \"page-dialog-container\"}, [\r\n                m(\"div\", {class: \"page-dialog \" + sizeCls}, [\r\n                    m(\"div\", {class: \"list-results-container\"}, [\r\n                        m(\"div\", {class: \"list-results\"}, [\r\n                            m(\"div\",{class: \"result-nav-outer\"},[\r\n                                m(\"div\",{class: \"result-nav-inner\"},[\r\n                                        m(\"nav\",{class: \"result-nav\"},[\r\n                                        m(\"h3\", {class: \"box-title\"}, title)\r\n                                    ])\r\n                                ])\r\n                            ]),\r\n                            m(data.view, {\r\n                                freeForm: true,\r\n                                freeFormType: entityType,\r\n                                freeFormEntity: data.entity,\r\n                                freeFormInstance: data.inst\r\n                            }),\r\n                            m(\"div\",{class: \"result-nav-outer\"},[\r\n                                m(\"div\",{class: \"result-nav-inner\"},[\r\n                                    m(\"nav\",{class: \"result-nav\"},[\r\n                                       mconf,\r\n                                        m(\"button\", {class: \"page-dialog-button\", onclick: async function(){ await fCanc(data);}},[\r\n                                            m(\"span\", {class: \"material-symbols-outlined material-symbols-outlined-white md-18 mr-2\"}, \"cancel\"),\r\n                                            \"Cancel\"\r\n                                        ])\r\n                                    ])\r\n                                ])\r\n                            ]),\r\n                        ])\r\n                    ])\r\n                ])\r\n            ])\r\n        ];\r\n    }\r\n    \r\n    function confirm(sMessage, fConfirm, fCancel){\r\n        dialogCfg = {\r\n            label: \"Confirmation\",\r\n            entityType: \"confirmation\",\r\n            size: 50,\r\n            data: {\r\n                entity: {textData: sMessage}\r\n            },\r\n            confirm: function(data){\r\n                if(fConfirm) fConfirm(data);\r\n                dialogUp = false;\r\n                m.redraw();\r\n            },\r\n            cancel: function(data){\r\n                if(fCancel) fCancel(data);\r\n                dialogUp = false;\r\n                m.redraw();\r\n            }\r\n        };\r\n        dialogUp = true;\r\n        m.redraw();\r\n    }\r\n\r\n    function cancelDialog(obj){\r\n        dialogUp = false;\r\n        m.redraw();\r\n    }\r\n\r\n    function batchProgress(label, items, processItem, onComplete){\r\n        let state = {\r\n            started: false,\r\n            running: false,\r\n            aborted: false,\r\n            current: 0,\r\n            total: items.length,\r\n            currentName: \"\",\r\n            successCount: 0,\r\n            errorCount: 0\r\n        };\r\n\r\n        async function startBatch(){\r\n            state.started = true;\r\n            state.running = true;\r\n            state.aborted = false;\r\n            m.redraw();\r\n            for(let i = 0; i < items.length; i++){\r\n                if(state.aborted) break;\r\n                state.current = i + 1;\r\n                state.currentName = items[i].name || (\"Item \" + (i + 1));\r\n                m.redraw();\r\n                try {\r\n                    let result = await processItem(items[i], i);\r\n                    if(result) state.successCount++;\r\n                } catch(e){\r\n                    console.error(\"Batch item error:\", e);\r\n                    state.errorCount++;\r\n                }\r\n            }\r\n            state.running = false;\r\n            m.redraw();\r\n            if(onComplete) onComplete(state);\r\n        }\r\n\r\n        function stopBatch(){\r\n            state.aborted = true;\r\n        }\r\n\r\n        let progressView = {\r\n            view: function(){\r\n                let pct = state.total > 0 ? Math.round((state.current / state.total) * 100) : 0;\r\n                return m(\"div\", {style: \"padding: 16px;\"}, [\r\n                    m(\"div\", {style: \"margin-bottom: 12px; color: #666;\"}, label + \" - \" + state.total + \" items\"),\r\n                    m(\"div\", {style: \"margin-bottom: 8px; height: 24px; background: #e0e0e0; border-radius: 12px; overflow: hidden;\"}, [\r\n                        m(\"div\", {style: \"height: 100%; width:\" + pct + \"%; background: linear-gradient(90deg, #4a90d9, #67b26f); transition: width 0.3s; border-radius: 12px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:0.75em; font-weight:bold;\"}, state.started ? pct + \"%\" : \"\")\r\n                    ]),\r\n                    m(\"div\", {style: \"margin-bottom: 12px; font-size: 0.9em; color: #555; min-height: 1.4em;\"},\r\n                        state.running ? (state.current + \" of \" + state.total + \": \" + state.currentName) :\r\n                        (state.started ? (\"Done - \" + state.successCount + \" succeeded\" + (state.errorCount > 0 ? \", \" + state.errorCount + \" errors\" : \"\") + (state.aborted ? \" (aborted)\" : \"\")) : \"Ready to start\")\r\n                    ),\r\n                    m(\"div\", {style: \"display: flex; gap: 8px;\"}, [\r\n                        !state.started ? m(\"button\", {class: \"page-dialog-button\", onclick: startBatch}, [\r\n                            m(\"span\", {class: \"material-symbols-outlined md-18 mr-2\"}, \"play_arrow\"),\r\n                            \"Start\"\r\n                        ]) : \"\",\r\n                        state.running ? m(\"button\", {class: \"page-dialog-button\", onclick: stopBatch}, [\r\n                            m(\"span\", {class: \"material-symbols-outlined md-18 mr-2\"}, \"stop\"),\r\n                            \"Stop\"\r\n                        ]) : \"\",\r\n                        (!state.running) ? m(\"button\", {class: \"page-dialog-button\", onclick: function(){ endDialog(); }}, [\r\n                            m(\"span\", {class: \"material-symbols-outlined md-18 mr-2\"}, \"close\"),\r\n                            \"Close\"\r\n                        ]) : \"\"\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n\r\n        let cfg = {\r\n            label: label,\r\n            entityType: \"batchProgress\",\r\n            size: 50,\r\n            data: {entity: {}, view: progressView},\r\n            cancel: async function(data){\r\n                if(state.running){\r\n                    state.aborted = true;\r\n                } else {\r\n                    endDialog();\r\n                }\r\n            }\r\n        };\r\n        setDialog(cfg);\r\n    }\r\n\r\n    async function memberCloud(modelType, containerId){\r\n        let stats = await am7client.membershipStats(modelType, \"any\", containerId, 200);\r\n        if(!stats || !stats.length){\r\n            page.toast(\"info\", \"No membership data found\");\r\n            return;\r\n        }\r\n\r\n        let cloudMode = true;\r\n        let selectedStat = null;\r\n        let memberList = [];\r\n        let previewSrc = null;\r\n        let searchFilter = \"\";\r\n\r\n        let minCount = Math.min(...stats.map(s => s.count));\r\n        let maxCount = Math.max(...stats.map(s => s.count));\r\n\r\n        function getFilteredStats(){\r\n            if(!searchFilter || !searchFilter.length) return stats;\r\n            let lowerFilter = searchFilter.toLowerCase();\r\n            return stats.filter(s => s.name && s.name.toLowerCase().indexOf(lowerFilter) > -1);\r\n        }\r\n\r\n        function fontSize(count){\r\n            if(maxCount === minCount) return 1.5;\r\n            return 0.8 + ((count - minCount) / (maxCount - minCount)) * 2.2;\r\n        }\r\n\r\n        async function selectStat(stat){\r\n            selectedStat = stat;\r\n            cloudMode = false;\r\n            memberList = [];\r\n            m.redraw();\r\n            let mems = await am7client.members(modelType, stat.objectId, stat.type || \"any\", 0, 100);\r\n            if(mems && mems.length) am7model.updateListModel(mems);\r\n            memberList = mems || [];\r\n            m.redraw();\r\n        }\r\n\r\n        function backToCloud(){\r\n            cloudMode = true;\r\n            selectedStat = null;\r\n            memberList = [];\r\n            m.redraw();\r\n        }\r\n\r\n        function cloudColor(count){\r\n            let ratio = (maxCount === minCount) ? 0.5 : (count - minCount) / (maxCount - minCount);\r\n            let hue = 210 - (ratio * 160);\r\n            let sat = 55 + (ratio * 25);\r\n            let lit = 92 - (ratio * 20);\r\n            return \"hsl(\" + hue + \",\" + sat + \"%,\" + lit + \"%)\";\r\n        }\r\n\r\n        function cloudTextColor(count){\r\n            let ratio = (maxCount === minCount) ? 0.5 : (count - minCount) / (maxCount - minCount);\r\n            let hue = 210 - (ratio * 160);\r\n            let lit = 35 - (ratio * 10);\r\n            return \"hsl(\" + hue + \",60%,\" + lit + \"%)\";\r\n        }\r\n\r\n        let cloudView = {\r\n            view: function(){\r\n                if(cloudMode){\r\n                    let filteredStats = getFilteredStats();\r\n                    return m(\"div\", {style: \"display: flex; flex-direction: column; max-height: 60vh;\"}, [\r\n                        m(\"div\", {style: \"padding: 10px 20px; border-bottom: 1px solid #e0e0e0;\"}, [\r\n                            m(\"input\", {\r\n                                type: \"text\",\r\n                                placeholder: \"Search tags...\",\r\n                                value: searchFilter,\r\n                                oninput: function(e){ searchFilter = e.target.value; },\r\n                                style: \"width: 100%; padding: 8px 12px; border: 1px solid #ccc; border-radius: 20px; font-size: 14px; outline: none;\"\r\n                            })\r\n                        ]),\r\n                        m(\"div\", {style: \"padding: 20px; text-align: center; line-height: 1.4; overflow-y: auto; flex: 1;\"},\r\n                            filteredStats.length ? filteredStats.map(function(stat){\r\n                                let size = fontSize(stat.count);\r\n                                let bg = cloudColor(stat.count);\r\n                                let fg = cloudTextColor(stat.count);\r\n                                return m(\"span\", {\r\n                                    style: \"font-size:\" + size + \"em; cursor:pointer; margin: 5px 6px; display:inline-block;\" +\r\n                                        \"background:\" + bg + \"; color:\" + fg + \";\" +\r\n                                        \"padding: 4px 12px; border-radius: 20px;\" +\r\n                                        \"border: 1px solid \" + fg + \"20;\" +\r\n                                        \"transition: transform 0.15s, box-shadow 0.15s;\" +\r\n                                        \"box-shadow: 0 1px 3px rgba(0,0,0,0.08);\",\r\n                                    title: stat.name + \" (\" + stat.count + \")\",\r\n                                    onmouseenter: function(e){ e.target.style.transform = \"scale(1.08)\"; e.target.style.boxShadow = \"0 3px 8px rgba(0,0,0,0.15)\"; },\r\n                                    onmouseleave: function(e){ e.target.style.transform = \"\"; e.target.style.boxShadow = \"0 1px 3px rgba(0,0,0,0.08)\"; },\r\n                                    onclick: function(){ selectStat(stat); }\r\n                                }, [stat.name, m(\"sup\", {style: \"margin-left:3px; font-size:0.65em; opacity:0.7;\"}, stat.count)]);\r\n                            }) : m(\"div\", {style: \"color: #888; padding: 20px;\"}, \"No tags match \\\"\" + searchFilter + \"\\\"\")\r\n                        )\r\n                    ]);\r\n                }\r\n                // Detail view - grid layout filling horizontal space with larger previews\r\n                return m(\"div\", {style: \"padding: 16px; position: relative; display: flex; flex-direction: column; height: 100%;\"}, [\r\n                    previewSrc ? m(\"div\", {\r\n                        style: \"position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 10; display: flex; align-items: center; justify-content: center; cursor: pointer;\",\r\n                        onclick: function(){ previewSrc = null; m.redraw(); }\r\n                    }, [\r\n                        m(\"img\", {src: previewSrc, style: \"max-width: 90%; max-height: 90%; object-fit: contain; border-radius: 4px; box-shadow: 0 4px 24px rgba(0,0,0,0.5);\"})\r\n                    ]) : \"\",\r\n                    m(\"div\", {style: \"margin-bottom: 12px; display: flex; align-items: center; gap: 16px;\"}, [\r\n                        m(\"button\", {class: \"page-dialog-button\", style: \"margin: 0;\", onclick: backToCloud}, [\r\n                            m(\"span\", {class: \"material-symbols-outlined md-18 mr-2\"}, \"arrow_back\"),\r\n                            \"Back\"\r\n                        ]),\r\n                        m(\"div\", [\r\n                            m(\"h4\", {style: \"margin: 0 0 4px 0;\"}, [\r\n                                m(\"a\", {href: \"#!/view/\" + modelType + \"/\" + selectedStat.objectId, target: \"_blank\"}, selectedStat.name)\r\n                            ]),\r\n                            m(\"span\", {style: \"color: #666;\"}, selectedStat.count + \" member\" + (selectedStat.count != 1 ? \"s\" : \"\"))\r\n                        ])\r\n                    ]),\r\n                    m(\"div\", {class: \"cloud-members\", style: \"flex: 1; overflow-y: auto; width: 100%;\"},\r\n                        memberList.length == 0 ? m(\"em\", \"Loading members...\") :\r\n                        m(\"div\", {style: \"display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; padding: 8px;\"},\r\n                            memberList.map(function(mem){\r\n                                let memType = mem[am7model.jsonModelKey] || \"unknown\";\r\n                                let memName = mem.name || mem.objectId;\r\n                                let thumb = \"\";\r\n                                let orgPath = am7client.dotPath(am7client.currentOrganization);\r\n                                let imgSrc = null;\r\n                                if(memType == \"olio.charPerson\" && mem.profile && mem.profile.portrait && mem.profile.portrait.contentType){\r\n                                    let pp = mem.profile.portrait;\r\n                                    imgSrc = g_application_path + \"/thumbnail/\" + orgPath + \"/data.data\" + pp.groupPath + \"/\" + pp.name;\r\n                                    thumb = m(\"img\", {style: \"width: 100%; aspect-ratio: 1; border-radius: 8px; object-fit: cover; cursor: pointer;\", src: imgSrc + \"/256x256\", onclick: function(e){ e.preventDefault(); previewSrc = imgSrc + \"/512x512\"; m.redraw(); }});\r\n                                } else if(memType == \"olio.charPerson\"){\r\n                                    thumb = m(\"div\", {style: \"width: 100%; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 8px;\"}, [\r\n                                        m(\"span\", {class: \"material-symbols-outlined\", style: \"font-size: 64px; color: #999;\"}, \"person\")\r\n                                    ]);\r\n                                } else if(memType == \"data.data\" && mem.contentType && mem.contentType.match(/^image/)){\r\n                                    imgSrc = g_application_path + \"/thumbnail/\" + orgPath + \"/data.data\" + mem.groupPath + \"/\" + mem.name;\r\n                                    thumb = m(\"img\", {style: \"width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 8px; cursor: pointer;\", src: imgSrc + \"/256x256\", onclick: function(e){ e.preventDefault(); previewSrc = imgSrc + \"/512x512\"; m.redraw(); }});\r\n                                }\r\n                                return m(\"div\", {style: \"background: #fafafa; border-radius: 12px; padding: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: box-shadow 0.2s;\", onmouseenter: function(e){ e.currentTarget.style.boxShadow = \"0 4px 12px rgba(0,0,0,0.15)\"; }, onmouseleave: function(e){ e.currentTarget.style.boxShadow = \"0 1px 3px rgba(0,0,0,0.1)\"; }}, [\r\n                                    thumb,\r\n                                    m(\"div\", {style: \"margin-top: 8px; text-align: center;\"}, [\r\n                                        m(\"a\", {href: \"#!/view/\" + memType + \"/\" + mem.objectId, target: \"_blank\", style: \"font-weight: 500; color: #333; text-decoration: none; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\"}, memName),\r\n                                        m(\"span\", {style: \"color: #999; font-size: 0.75em;\"}, memType.split('.').pop())\r\n                                    ])\r\n                                ]);\r\n                            })\r\n                        )\r\n                    )\r\n                ]);\r\n            }\r\n        };\r\n\r\n        let cfg = {\r\n            label: \"Membership Cloud\",\r\n            entityType: modelType,\r\n            size: 75,\r\n            data: {entity: {}, view: cloudView},\r\n            cancel: async function(data){\r\n                endDialog();\r\n            }\r\n        };\r\n        setDialog(cfg);\r\n    }\r\n\r\n    // Show the outfit builder panel for a character\r\n    async function showOutfitBuilder(object, inst) {\r\n        if (!inst) {\r\n            page.toast(\"error\", \"No instance provided\");\r\n            return;\r\n        }\r\n\r\n        let characterId = null;\r\n        let gender = \"female\";\r\n        let currentApparel = null;\r\n\r\n        // Check if this is a charPerson (character) or apparel\r\n        let modelName = inst.model ? inst.model.name : null;\r\n\r\n        if (modelName === \"olio.charPerson\") {\r\n            // Invoked from character - the entity IS the character\r\n            characterId = inst.entity.objectId || inst.entity.id;\r\n            gender = inst.entity.gender || \"female\";\r\n            // Get the character's current apparel (prefer inuse)\r\n            if (inst.entity.store && inst.entity.store.apparel && inst.entity.store.apparel.length > 0) {\r\n                currentApparel = inst.entity.store.apparel.find(a => a.inuse) || inst.entity.store.apparel[0];\r\n            }\r\n        } else if (modelName === \"olio.apparel\") {\r\n            // Invoked from apparel - try to get the associated character\r\n            if (inst.entity && inst.entity.designer) {\r\n                characterId = inst.entity.designer.objectId || inst.entity.designer.id;\r\n                gender = inst.entity.designer.gender || \"female\";\r\n            }\r\n            currentApparel = inst.entity;\r\n        }\r\n\r\n        // Set up outfit builder state\r\n        if (window.am7olio) {\r\n            am7olio.outfitBuilderState.characterId = characterId;\r\n            am7olio.outfitBuilderState.gender = gender;\r\n            am7olio.outfitBuilderState.currentApparel = currentApparel;\r\n        }\r\n\r\n        // Create the dialog with the outfit builder\r\n        let cfg = {\r\n            title: \"Outfit Builder\" + (inst.entity.name ? \" - \" + inst.entity.name : \"\"),\r\n            icon: \"checkroom\",\r\n            label: \"Generate context-aware outfit for character\",\r\n            size: 80,\r\n            data: { entity: inst.entity, characterId: characterId },\r\n            view: function() {\r\n                if (!window.am7olio || !am7olio.OutfitBuilderPanel) {\r\n                    return m(\"div\", { class: \"p-4 text-red-500\" }, \"Outfit builder component not loaded\");\r\n                }\r\n                let builderApparel = am7olio.outfitBuilderState.currentApparel;\r\n                return m(\"div\", { class: \"flex gap-4 p-4\" }, [\r\n                    // Outfit Builder Panel\r\n                    m(\"div\", { class: \"flex-1\" }, [\r\n                        m(am7olio.OutfitBuilderPanel, {\r\n                            characterId: characterId,\r\n                            gender: gender,\r\n                            onGenerate: async function(apparel) {\r\n                                if (apparel) {\r\n                                    // Update the state with new apparel\r\n                                    am7olio.outfitBuilderState.currentApparel = apparel;\r\n                                    m.redraw();\r\n                                }\r\n                            }\r\n                        })\r\n                    ]),\r\n                    // Piece Editor (if apparel exists)\r\n                    builderApparel && builderApparel.wearables ? m(\"div\", { class: \"flex-1\" }, [\r\n                        m(am7olio.PieceEditorPanel, {\r\n                            apparel: builderApparel\r\n                        })\r\n                    ]) : null\r\n                ]);\r\n            },\r\n            confirm: async function(data) {\r\n                endDialog();\r\n                // Refresh the character view to show updated apparel\r\n                page.clearContextObject(inst.api.objectId());\r\n                m.redraw();\r\n            },\r\n            cancel: async function(data) {\r\n                endDialog();\r\n            }\r\n        };\r\n        setDialog(cfg);\r\n    }\r\n\r\n    // Start the card game with a specific character\r\n    // Only works if the character is part of a realm's population\r\n    async function startGameWithCharacter(object, inst) {\r\n        if (!inst || !inst.entity) {\r\n            page.toast(\"error\", \"No character selected\");\r\n            return;\r\n        }\r\n\r\n        let characterId = inst.entity.objectId || inst.entity.id;\r\n        let characterName = inst.entity.name || \"Unknown\";\r\n\r\n        // Check if character is part of a realm's population by checking groupPath\r\n        // Characters in the world should be in a path like ~/World Building/...\r\n        let groupPath = inst.entity.groupPath || \"\";\r\n        let isInWorld = groupPath.includes(\"World Building\") || groupPath.includes(\"Worlds\") || groupPath.includes(\"Population\");\r\n\r\n        if (!isInWorld) {\r\n            // Show adopt dialog instead\r\n            let cfg = {\r\n                title: \"Character Not in World\",\r\n                icon: \"warning\",\r\n                label: \"This character is not part of the Olio world. Would you like to adopt them into the world first?\",\r\n                size: 40,\r\n                buttons: [\r\n                    { label: \"Adopt Character\", value: \"adopt\" },\r\n                    { label: \"Cancel\", value: \"cancel\" }\r\n                ],\r\n                submit: async function(data) {\r\n                    endDialog();\r\n                    if (data.value === \"adopt\") {\r\n                        await adoptCharacter(object, inst);\r\n                    }\r\n                },\r\n                cancel: async function() {\r\n                    endDialog();\r\n                }\r\n            };\r\n            setDialog(cfg);\r\n            return;\r\n        }\r\n\r\n        // Navigate to the card game with this character\r\n        page.toast(\"info\", \"Starting game with \" + characterName);\r\n\r\n        // Store in session for pickup by card game\r\n        sessionStorage.setItem(\"olio_selected_character\", characterId);\r\n\r\n        // Navigate to the card game view\r\n        m.route.set(\"/app/game/cardGame-v2\", { character: characterId });\r\n    }\r\n\r\n    // Adopt a character into the Olio worldspace\r\n    // Moves to proper group and adds to realm population\r\n    async function adoptCharacter(object, inst) {\r\n        if (!inst || !inst.entity) {\r\n            page.toast(\"error\", \"No character selected\");\r\n            return;\r\n        }\r\n\r\n        let character = inst.entity;\r\n        let characterName = character.name || \"Unknown\";\r\n\r\n        // Show realm selection dialog\r\n        let cfg = {\r\n            title: \"Adopt Character to World\",\r\n            icon: \"person_add\",\r\n            label: \"Adopt '\" + characterName + \"' into the Olio world\",\r\n            size: 50,\r\n            view: function() {\r\n                return m(\"div\", { class: \"p-4\" }, [\r\n                    m(\"p\", { class: \"mb-4\" },\r\n                        \"This will move the character to the world's population and make them available for game interactions.\"),\r\n                    m(\"div\", { class: \"mb-4\" }, [\r\n                        m(\"label\", { class: \"block mb-2 font-medium\" }, \"Target Realm:\"),\r\n                        m(\"select\", {\r\n                            id: \"adoptRealmSelect\",\r\n                            class: \"w-full p-2 border rounded\"\r\n                        }, [\r\n                            m(\"option\", { value: \"default\" }, \"Default Realm\")\r\n                        ])\r\n                    ]),\r\n                    m(\"div\", { class: \"text-sm text-gray-600\" }, [\r\n                        m(\"p\", \"Current location: \" + (character.groupPath || \"Unknown\")),\r\n                        m(\"p\", \"Character will be added to the realm's population group.\")\r\n                    ])\r\n                ]);\r\n            },\r\n            submit: async function(data) {\r\n                endDialog();\r\n                page.toast(\"info\", \"Adopting \" + characterName + \"...\");\r\n\r\n                try {\r\n                    // Call the adopt endpoint\r\n                    let result = await m.request({\r\n                        method: \"POST\",\r\n                        url: am7client.base() + \"/rest/game/adopt/\" + (character.objectId || character.id),\r\n                        withCredentials: true,\r\n                        body: {}\r\n                    });\r\n\r\n                    if (result && result.adopted) {\r\n                        page.toast(\"success\", characterName + \" has been adopted into the world!\");\r\n                        // Refresh the character view\r\n                        page.clearContextObject(inst.api.objectId());\r\n                        m.redraw();\r\n                    } else {\r\n                        page.toast(\"error\", result.error || \"Failed to adopt character\");\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Adopt failed:\", e);\r\n                    page.toast(\"error\", \"Failed to adopt character: \" + (e.message || \"Unknown error\"));\r\n                }\r\n            },\r\n            cancel: async function() {\r\n                endDialog();\r\n            }\r\n        };\r\n        setDialog(cfg);\r\n    }\r\n\r\n    let dialog = {\r\n        endDialog,\r\n        setDialog,\r\n        loadDialog,\r\n        confirm,\r\n        cancelDialog,\r\n        vectorize,\r\n        summarize,\r\n        reimage,\r\n        reimageApparel,\r\n        showOutfitBuilder,\r\n        startGameWithCharacter,\r\n        adoptCharacter,\r\n        chatSettings,\r\n        showProgress,\r\n        chatInto,\r\n        memberCloud,\r\n        batchProgress\r\n    }\r\n    page.components.dialog = dialog;\r\n}())\n\n;/* === client/components/dnd.js === */\n(function () {\r\n\r\n    const dnd = {\r\n        dragTarget: undefined,\r\n        overTarget: undefined,\r\n        workingSet: []\r\n    };\r\n    dnd.doBlend = async function (sId) {\r\n        let blended = [];\r\n        let blender = [];\r\n        dnd.workingSet.forEach((w) => {\r\n            /// if an id is specified, then that is the item to apply to the rest of the set\r\n            /// if an id isn't specified, then the blender list will be any tag, event, group, or role\r\n            if ((sId && w.objectId == sId) || (!sId && w[am7model.jsonModelKey].match(/^(data\\.tag|olio\\.event|auth\\.group|auth\\.role)$/gi) && (!w[am7model.jsonModelKey].match(/^auth\\.group$/gi) || w.type.match(/^(person|account|bucket)$/gi)))) {\r\n                blender.push(w);\r\n            }\r\n            else {\r\n                blended.push(w);\r\n            }\r\n        });\r\n        let aP = [];\r\n        let filt = {};\r\n        blender.forEach((b) => {\r\n            blended.forEach((b2) => {\r\n                let actor = b2[am7model.jsonModelKey].match(/^identity\\.account|identity\\.person|olio\\.charPerson|system\\.user$/gi);\r\n                if ((b[am7model.jsonModelKey] == 'data.data' || b[am7model.jsonModelKey] == 'olio.charPerson') && (b2[am7model.jsonModelKey] == 'data.data' || b2[am7model.jsonModelKey] == 'olio.charPerson') && b[am7model.jsonModelKey] != b2[am7model.jsonModelKey]) {\r\n                    let p = b;\r\n                    let d = b2;\r\n                    if (p[am7model.jsonModelKey] == 'data.data') {\r\n                        p = b2;\r\n                        d = b;\r\n                    }\r\n\r\n                }\r\n                switch (b[am7model.jsonModelKey]) {\r\n\r\n                    case \"olio.llm.promptConfig\":\r\n                    case \"olio.llm.chatConfig\":\r\n                        if ((b2[am7model.jsonModelKey] == \"olio.llm.promptConfig\" || b2[am7model.jsonModelKey] == \"olio.llm.chatConfig\") && b2[am7model.jsonModelKey] != b[am7model.jsonModelKey]) {\r\n                            let cfg = {};\r\n                            cfg[b2[am7model.jsonModelKey]] = b2;\r\n                            cfg[b[am7model.jsonModelKey]] = b;\r\n                            page.context().contextObjects[\"chatConfig\"] = cfg;\r\n                            m.route.set(\"/chat\");\r\n                            break;\r\n                        }\r\n                    case \"auth.role\":\r\n                        if (actor && b.type == b2[am7model.jsonModelKey]) {\r\n                            aP.push(page.member(b[am7model.jsonModelKey], b.objectId, b2[am7model.jsonModelKey], b2.objectId, true));\r\n                            filt[b2.objectId] = true;\r\n                        }\r\n                        else {\r\n                            console.warn(\"Skip actor type: \" + b2[am7model.jsonModelKey] + \" for role \" + b.type);\r\n                        }\r\n                        break;\r\n                    case \"auth.group\":\r\n                        if ((actor && b2[am7model.jsonModelKey] == b.type) || (b.type == \"bucket\" && b2[am7model.jsonModelKey] != \"auth.group\")) {\r\n                            aP.push(page.member(b[am7model.jsonModelKey], b.objectId, b2[am7model.jsonModelKey], b2.objectId, true));\r\n                            filt[b2.objectId] = true;\r\n                        }\r\n                        else {\r\n                            console.warn(\"Skip actor type: \" + b2[am7model.jsonModelKey] + \" for group \" + b.type);\r\n                        }\r\n                        break;\r\n                    case \"data.tag\":\r\n                        if ((actor || b2[am7model.jsonModelKey].match(/^data\\.data$/gi)) && b2[am7model.jsonModelKey] == b.type) {\r\n                            // aP.push(page.tag(b2, b, true));\r\n                            aP.push(page.member(b[am7model.jsonModelKey], b.objectId, b2[am7model.jsonModelKey], b2.objectId, true));\r\n                            filt[b2.objectId] = true;\r\n                        }\r\n                        else {\r\n                            console.warn(\"Skip object type: \" + b2[am7model.jsonModelKey] + \" for tag type \" + b.type);\r\n                            console.warn(blender);\r\n                            console.warn(b);\r\n                        }\r\n                        break;\r\n                    /// Need to populate these in order to obtain contactInformation\r\n                    case \"system.user\":\r\n                    case \"identity.account\":\r\n                    case \"olio.charPerson\":\r\n                    case \"identity.person\":\r\n                        let bUp = false;\r\n                        console.log(b, b2);\r\n                        if (b2[am7model.jsonModelKey].match(/^identity\\.contact$/gi)) {\r\n                            b.contactInformation.contacts.push(b2);\r\n                            bUp = true;\r\n                        }\r\n                        if (b2[am7model.jsonModelKey].match(/^identity\\.address$/gi)) {\r\n                            b.contactInformation.addresses.push(b2);\r\n                            bUp = true;\r\n                        }\r\n                        if (bUp) {\r\n                            aP.push(page.patchObject(b));\r\n                        }\r\n\r\n                        console.log(\"Blend \" + b[am7model.jsonModelKey] + \" with \" + b2[am7model.jsonModelKey]);\r\n                        break;\r\n                    default:\r\n                        console.warn(\"Unhandled\", b[am7model.jsonModelKey]);\r\n                        break;\r\n\r\n                }\r\n            });\r\n\r\n\r\n        });\r\n        await Promise.all(aP);\r\n        dnd.workingSet = dnd.workingSet.filter((o) => !filt[o.objectId]);\r\n\r\n        console.log(\"Blended\", blender);\r\n\r\n    };\r\n    dnd.doDragDecorate = function (object) {\r\n        let cls;\r\n        if (!object || !object.objectId) return cls;\r\n        if (dnd.dragTarget && dnd.dragTarget.objectId == object.objectId) {\r\n            cls = \"hover:bg-orange-200\";\r\n        }\r\n        else if (dnd.overTarget && dnd.overTarget.objectId == object.objectId && dnd.dragTarget.objectId != object.objectId) {\r\n            let modType = am7model.getModel(object[am7model.jsonModelKey]);\r\n            if (dnd.overTarget[am7model.jsonModelKey].match(/^auth\\.group$/gi) || am7model.inherits(modType, \"common.parent\")) {\r\n                cls = \"hover:bg-green-200 bg-green-200\";\r\n            }\r\n        }\r\n        return cls;\r\n    }\r\n\r\n    dnd.doDragStart = function (e, obj) {\r\n        e.dataTransfer.setData('text', obj.objectId);\r\n        dnd.dragTarget = obj;\r\n    }\r\n\r\n    dnd.doDragOver = function (e, obj) {\r\n        if (obj && dnd.dragTarget) {\r\n\r\n            if (typeof obj === \"string\") {\r\n                dnd.overTarget = obj;\r\n            }\r\n            if (obj.objectId != dnd.dragTarget.objectId) {\r\n                dnd.overTarget = obj;\r\n            }\r\n        }\r\n    }\r\n    dnd.doDragEnd = function (e, obj) {\r\n        dnd.dragTarget = undefined;\r\n        dnd.overTarget = undefined;\r\n    }\r\n    dnd.doDrop = async function (e, obj) {\r\n        let ret = false;\r\n        if (obj && dnd.dragTarget) {\r\n            let dragGroup = dnd.dragTarget[am7model.jsonModelKey].match(/^auth\\.group$/gi);\r\n            let dragParent = am7model.isParent(dnd.dragTarget[am7model.jsonModelKey]);\r\n\r\n            let dragModType = am7model.getModel(dnd.dragTarget[am7model.jsonModelKey]);\r\n            if (typeof obj === \"string\") {\r\n                if (obj === \"set\") {\r\n                    let aL = dnd.workingSet.filter((o) => { if (o.objectId == dnd.dragTarget.objectId) return true; });\r\n                    if (aL.length) {\r\n                        console.warn(\"Already in set\");\r\n                    }\r\n                    else {\r\n                        dnd.workingSet.push(dnd.dragTarget);\r\n                        ret = true;\r\n                    }\r\n                }\r\n            }\r\n            else if (dnd.overTarget) {\r\n                let overParent = am7model.isParent(dnd.overTarget[am7model.jsonModelKey]);\r\n                let dropGroup = dnd.overTarget[am7model.jsonModelKey].match(/^auth\\.group$/gi);\r\n                console.log(dnd.dragTarget, dnd.overTarget, dragParent, overParent);\r\n                if ((dragGroup && dropGroup) || (dragParent && overParent)) {\r\n                    ret = await page.reparentObject(dnd.dragTarget, dnd.overTarget);\r\n                }\r\n                else if (dropGroup && am7model.isGroup(dragModType)) {\r\n                    ret = await page.moveObject(dnd.dragTarget, dnd.overTarget);\r\n                }\r\n                else {\r\n                    console.warn(\"Don't know what to do: Drop: \" + dnd.dragTarget.name + \" on \" + dnd.overTarget.name);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n\r\n    }\r\n\r\n    let totalUpCount = 0;\r\n    let currentUpCount = 0;\r\n    let maxUpload = 10;\r\n    dnd.uploadFiles = async function(inst, files) {\r\n        let entity = inst?.entity;\r\n        if(!entity){\r\n            return;\r\n        }\r\n\r\n        totalUpCount = files.length;\r\n        currentUpCount = 0;\r\n\r\n        let pb = am7model.prepareInstance(am7model.newPrimitive(\"progress\"), am7model.forms.progress);\r\n        //let pb = am7model.newPrimitive(\"progress\");\r\n        pb.api.label(\"Uploading \" + files.length + \" files\");\r\n        pb.api.progress(0);\r\n        page.components.dialog.showProgress(pb.entity, pb);\r\n\r\n        let aP = [];\r\n        if(inst.model.name != \"data.data\"){\r\n            \r\n            return new Promise((res, rej) =>{\r\n                //for(let i = 0; i < files.length; i++){\r\n                    var fileReader = new FileReader();  \r\n                    fileReader.onload = function() {\r\n                        //if(files[i].name.match(/\\.json$/gi)){\r\n                            let obj = JSON.parse(this.result);\r\n                            let clearFlds = [\"objectId\", \"id\", \"ownerId\", \"urn\", \"groupPath\", \"organizationId\", \"organizationPath\", \"vaultId\", \"vaulted\", \"keyId\"];\r\n                            for(let f in clearFlds){\r\n                                delete obj[f];\r\n                            }\r\n\r\n                            if(inst.api.groupId){\r\n                                console.warn(\"Creating\");\r\n                                obj.groupId = inst.api.groupId();\r\n                                obj.groupPath = inst.api.groupPath();\r\n                                page.createObject(obj).then((o) => {\r\n                                    let uri = \"/view/\" + obj.schema + \"/\" + o.objectId;\r\n                                    m.route.set(uri, {key: o.objectId});\r\n                                });\r\n                            }\r\n                            else{\r\n                                logger.warn(\"Need a group\");\r\n                            }\r\n\r\n                        //}\r\n                        //else{\r\n                          //  console.warn(\"Skipped \" + files[i].name);\r\n                        //}\r\n                    };\r\n                    fileReader.readAsText(files[0]);\r\n                    page.components.dialog.endDialog();\r\n\r\n                //}\r\n                res();\r\n            });\r\n        }\r\n        for (var i = 0; i < files.length; i++) {\r\n            if(i > 0){\r\n                pb.api.label(\"Uploading (\" + i + \" of \" + files.length + \")\");\r\n                pb.api.progress(parseInt((i / files.length) * 100));\r\n                console.log(pb.api.label() + \" \" + pb.api.progress() + \"%\");\r\n                m.redraw();\r\n            }\r\n            var formData = new FormData();\r\n            formData.append(\"organizationPath\", am7client.currentOrganization);\r\n            formData.append(\"groupPath\", entity.groupPath);\r\n            let fname = files[i].name;\r\n            formData.append(\"name\", files[i].name);\r\n            formData.append(\"dataFile\", files[i]);\r\n            aP.push(new Promise((res, rej)=>{\r\n                var xhr = new XMLHttpRequest();\r\n                xhr.withCredentials = true;\r\n                console.log(\"Posting: \" + g_application_path + '/mediaForm');\r\n                xhr.open('POST', g_application_path + '/mediaForm');\r\n                xhr.onload = function(v){\r\n                    res(fname);\r\n                };\r\n                xhr.upload.onprogress = function(event){\r\n                    ///ctl.updateWaitingCount();\r\n                };\r\n                xhr.send(formData);\r\n            }));\r\n            if(i > 0 && (i % maxUpload) == 0){\r\n                await Promise.all(aP);\r\n                aP = [];\r\n            }\r\n\r\n        }\r\n        return new Promise((res2, rej2)=>{\r\n            Promise.all(aP).then((aD)=>{\r\n                page.components.dialog.endDialog();\r\n                if(aD.length == 1){\r\n                    page.findObject(\"auth.group\", \"data\", entity.groupPath).then((oG)=>{\r\n                        if(!oG){\r\n                            page.toast(\"error\", \"Failed to lookup group\", oG);\r\n                        }\r\n                        else{\r\n                            page.openObjectByName(\"data.data\", oG.objectId, aD[0]).then((oD)=>{\r\n                                if(!oD){\r\n                                    page.toast(\"error\", \"Failed to lookup data\");\r\n                                }\r\n                                else{\r\n                                    let uri = \"/view/data.data/\" + oD.objectId;\r\n                                    m.route.set(uri, {key: oD.objectId});\r\n                                    res2();\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n                else{\r\n                    res2();\r\n                }\r\n            });\r\n        });\r\n\r\n    }\r\n\r\n    function handleDragLeave(evt) {\r\n        evt.preventDefault();\r\n    }\r\n    function handleDragEnter(evt) {\r\n        evt.preventDefault();\r\n    }\r\n    function handleDragOver(evt) {\r\n        evt.preventDefault();\r\n    }\r\n    function handleDrop(inst, evt) {\r\n        evt.preventDefault();\r\n        dnd.uploadFiles(inst, evt.dataTransfer.files);\r\n    }\r\n\r\n    dnd.dropProps = function(inst){\r\n        return {\r\n            ondrop: function(e){ handleDrop(inst, e); },\r\n            ondragover: handleDragOver,\r\n            ondragenter: handleDragEnter,\r\n            ondragleave: handleDragLeave\r\n        };\r\n    };\r\n\r\n    dnd.dragProps = function(p){\r\n        return {\r\n          ondragover: function (e) { dnd.doDragOver(e, p); },\r\n          ondragend: function (e) { dnd.doDragEnd(e, p); },\r\n          ondragstart: function (e) { dnd.doDragStart(e, p); },\r\n          ondrop: function (e) { dnd.doDrop(e, p); }\r\n        };\r\n      };\r\n\r\n    page.components.dnd = dnd;\r\n}());\r\n\r\n\n\n;/* === client/components/pdf.js === */\n(function(){\r\nlet viewers = {};\r\nfunction pdfViewer(inInst){\r\n\r\n    if(typeof inInst == \"string\"){\r\n        return viewers[inInst];\r\n    }\r\n\r\n    let eventBus;\r\n\r\n    let currentPage = 1;\r\n    let pageCount = 0;\r\n    let scale = 1.0;\r\n    let raster = [];\r\n    let pdfDocument;\r\n    let inst = inInst;\r\n    let didInit = false;\r\n    function pdfControls(){\r\n\r\n        let cls = \"button\";\r\n        let fp = page.iconButton(\"button ml-4\", \"keyboard_double_arrow_left\", \"\", function(){\r\n            document.querySelector(\"#pdfContainer\").innerHTML = \"\";\r\n           render(1, scale);\r\n        });\r\n\r\n        let zoom = [m(\"input\", {type: \"range\", step: 5, max: 300, min: 25, class: \"inline-block ml-2 h-10 range-field-full\", value: (scale * 100), onchange: function(e){\r\n\t\t\t    document.querySelector(\"#pdfContainer\").innerHTML = \"\";    \r\n                scale = parseInt(e.target.value) / 100;\r\n                render(currentPage, scale);\r\n            }}),\r\n            m(\"span\", {\"class\": \"inline-block text-content mr-2 mt-0 mb-0\"}, (scale * 100).toFixed(0) + \"%\"),\r\n            m(\"span\", {\"class\": \"inline-block text-content w-72 ml-2 mr-2 mt-0 mb-0\"}, \"Page \" + currentPage + \" of \" + pageCount)\r\n        ];\r\n\r\n        \r\n        \r\n        let pb = page.iconButton(\"button\", \"chevron_left\", \"\", function(){\r\n            document.querySelector(\"#pdfContainer\").innerHTML = \"\";\r\n            render(Math.max(1, currentPage - 1), scale);\r\n        });\r\n        let lp = page.iconButton(\"button\", \"keyboard_double_arrow_right\", \"\", function(){\r\n            document.querySelector(\"#pdfContainer\").innerHTML = \"\";\r\n            render(pageCount, scale);\r\n         });\r\n         \r\n         let np = page.iconButton(\"button\", \"chevron_right\", \"\", function(){\r\n            document.querySelector(\"#pdfContainer\").innerHTML = \"\";\r\n             render(Math.min(pageCount, currentPage + 1), scale);\r\n         });\r\n\r\n        return m(\"div\",{class: \"result-nav-outer\"},[\r\n            m(\"div\",{class: \"result-nav-inner\"},[\r\n                m(\"div\",{class: \"result-nav\"},\r\n                    [\r\n                        fp, pb, zoom, np, lp\r\n                    ]\r\n                )\r\n            ])\r\n        ]);\r\n    }\r\n\r\n    function pdfContainer(){\r\n        return[pdfControls(), m(\"div\", {id: 'pdfContainer', class: \"pdfViewer singlePageView\"})];\r\n    }\r\n    async function loadPdf(){\r\n        if(pdfDocument){\r\n            return pdfDocument\r\n        }\r\n        if(!eventBus){\r\n            eventBus = new pdfjsViewer.EventBus();\r\n        }\r\n        if(!pdfjsLib.GlobalWorkerOptions.workerSrc){\r\n            pdfjsLib.GlobalWorkerOptions.workerSrc = \"/node_modules/pdfjs-dist/build/webpack/pdf.worker.bundle.js\";\r\n        }\r\n\r\n        let bits = am7model.base64ToUint8(inst.entity.dataBytesStore);\r\n        let loadingTask = pdfjsLib.getDocument(bits);\r\n        pdfDocument = await loadingTask.promise;\r\n        return pdfDocument;\r\n    }\r\n    \r\n    async function init(scale){\r\n        let container = document.querySelector(\"#pdfContainer\");\r\n        if(container && inst && !didInit){\r\n            didInit = true;\r\n            await render(1, scale || 1.0);\r\n        }\r\n        else if(didInit){\r\n            // console.warn(\"PDF already initialized.\");\r\n        }\r\n    }\r\n\r\n    async function render(pdfPageNum, pdfScale){\r\n    \r\n        if(!inst || !inst.model.name == \"data.data\"){\r\n            console.error(\"Invalid instance or model name.\", inst);\r\n            return;\r\n        }\r\n        if(!inst.entity.dataBytesStore){\r\n            console.info(\"Data is empty.\", inst);\r\n            return;\r\n        }\r\n        if(pdfPageNum){\r\n            currentPage = pdfPageNum;\r\n        }\r\n        if(pdfScale){\r\n            scale = pdfScale;\r\n        }\r\n\r\n        let container = document.querySelector(\"#pdfContainer\");\r\n        if(container != null){\r\n            let doc = await loadPdf(inst);\r\n            if(!doc){\r\n                console.error(\"Failed to load pdf document.\");\r\n            }\r\n\r\n            pageCount = doc.numPages;\r\n            let pdfPage = await doc.getPage(currentPage);\r\n            if(!pdfPage){\r\n                console.error(\"Failed to load page \" + currentPage);\r\n                return;\r\n            }\r\n\r\n           let viewport = pdfPage.getViewport({ scale: scale });\r\n            let pdfPageView = new pdfjsViewer.PDFPageView({\r\n                container,\r\n                id: pdfPageNum,\r\n                scale: scale,\r\n                defaultViewport: viewport,\r\n                eventBus,\r\n            });\r\n            pdfPageView.setPdfPage(pdfPage);\r\n            pdfPageView.draw();\r\n            currentPage = pdfPageNum;\r\n        }\r\n\r\n    }\r\n\r\n    let pdf = {\r\n        controls: pdfControls,\r\n        init,\r\n        render,\r\n        container: pdfContainer,\r\n        clear: function(){\r\n            didInit = false;\r\n            /*\r\n            if(inst && inst.entity.objectId){\r\n                delete viewers[inst.entity.objectId];\r\n            }\r\n            */\r\n        }\r\n    }\r\n    if(inst && inst.entity.objectId){\r\n        viewers[inst.entity.objectId] = pdf;\r\n    }\r\n\r\n    return pdf;\r\n}\r\n    page.components.pdf = {\r\n        viewer: pdfViewer,\r\n        viewers,\r\n        clear: function(objectId){\r\n            if(!objectId){\r\n                for(let k in viewers){\r\n                    viewers[k].clear();\r\n                }\r\n            }\r\n            else if(viewers[objectId]){\r\n                viewers[objectId].clear();\r\n            }\r\n        }\r\n    };\r\n}())\n\n;/* === client/components/olio.js === */\n(function () {\r\n    async function dressUp(object, inst, name){\r\n        if(inst.model.name == \"olio.charPerson\"){\r\n            await dressCharacter(inst, true);\r\n        }\r\n        else if(inst.model.name == \"olio.apparel\"){\r\n            await dressApparel(inst.entity, true);\r\n        }\r\n    }\r\n    async function dressDown(object, inst, name){\r\n        if(inst.model.name == \"olio.charPerson\"){\r\n            await dressCharacter(inst, false);\r\n        }\r\n        else if(inst.model.name == \"olio.apparel\"){\r\n            await dressApparel(inst.entity, false);\r\n        }\r\n    }\r\n\r\n    async function setApparelDescription(app, wears){\r\n        let wdesc = wears.filter((w) => w.inuse).map((w) => describeWearable(w)).join(\", \");\r\n        app.description = \"Worn apparel includes \" + wdesc + \".\";\r\n        if(wdesc.length == 0){\r\n            app.description = \"No apparel worn.\";\r\n        }\r\n        console.log(\"Setting description to \" + app.description);\r\n        await page.patchObject({schema: 'olio.apparel', id: app.id, description: app.description}); \r\n        m.redraw();\r\n    }\r\n\r\n    function describeWearable(wear){\r\n\r\n        let qual = wear.qualities ? wear.qualities[0] : null;\r\n        let opac = qual?.opacity || 0.0;\r\n        let shin = qual?.shininess || 0.0;\r\n        let smoo = qual?.smoothness || 0.0;\r\n        let col = wear?.color?.name.toLowerCase() || \"\";        \r\n       \r\n        if(col){\r\n            col = col.replaceAll(/([\\^\\(\\)]*)/g, \"\");\r\n        }\r\n        let fab = wear?.fabric?.toLowerCase() || \"\";\r\n        let pat = wear?.pattern?.name.toLowerCase() || \"\";\r\n        let loc = wear?.location[0]?.toLowerCase() || \"\"\r\n        let name = wear?.name;\r\n        if(name.indexOf(\"pierc\") > -1) {\r\n            name = loc + \" piercing\";\r\n            pat = \"\";\r\n        }\r\n        let opacs = \"\";\r\n        if(opac > 0.0 && opac <= 0.25) {\r\n            opacs = \" see-through\";\r\n        }\r\n        let shins = \"\";\r\n        if(shin >= 0.7) {\r\n            shins = \" shiny\";\r\n        }\r\n    \r\n        return (shins + opacs + \" \" + col + \" \" + pat + \" \" + fab + \" \" + name).replaceAll(\"  \", \" \").trim();\r\n    \r\n    }\r\n\r\n    async function dressCharacter(inst, dressUp){\r\n        // Get store reference from character\r\n        let storeRef = inst.api.store();\r\n        if(!storeRef || !storeRef.objectId){\r\n            page.toast(\"error\", \"No store found for character\");\r\n            return;\r\n        }\r\n        // Use getFull on store to get properly populated apparel with inuse flags\r\n        await am7client.clearCache(\"olio.store\");\r\n        let sto = await am7client.getFull(\"olio.store\", storeRef.objectId);\r\n        if(!sto || !sto.apparel || !sto.apparel.length){\r\n            page.toast(\"error\", \"No apparel found in store\");\r\n            return;\r\n        }\r\n        let appl = sto.apparel;\r\n\r\n        let activeAp = appl.find(a => a.inuse) || appl[0];\r\n        let bdress = await dressApparel(activeAp, dressUp);\r\n        if(bdress){\r\n            await am7model.forms.commands.narrate(undefined, inst);\r\n        }\r\n    }\r\n    async function dressApparel(vapp, dressUp){\r\n\r\n        await am7client.clearCache(\"olio.apparel\");\r\n        let aq = am7view.viewQuery(\"olio.apparel\");\r\n        aq.field(\"objectId\", vapp.objectId);\r\n        let aqr = await page.search(aq);\r\n        let app;\r\n        if(aqr && aqr.results && aqr.results.length){\r\n            am7model.updateListModel(aqr.results);\r\n            app = aqr.results[0];\r\n        }\r\n        else{\r\n            page.toast(\"error\", \"No apparel found for \" + vapp.objectId);\r\n            return;\r\n        }\r\n\r\n        if(!app){\r\n            page.toast(\"error\", \"No apparel found for \" + vapp.objectId);\r\n            return;\r\n        }\r\n\r\n        let wear = app.wearables;\r\n        if(!wear || !wear.length){\r\n            page.toast(\"error\", \"No wearables found in apparel \" + app.name);\r\n        }\r\n\r\n        // Restore schema on nested wearables array to prevent schema loss\r\n        if(wear && wear.length) {\r\n            am7model.updateListModel(wear);\r\n        }\r\n\r\n        let q = am7view.viewQuery(\"olio.wearable\");\r\n        q.range(0, 20);\r\n        let oids = wear.map((a) => { return a.objectId; }).join(\",\");\r\n        q.field(\"groupId\", wear[0].groupId);\r\n        let fld = q.field(\"objectId\", oids);\r\n        fld.comparator = \"in\";\r\n\r\n        let qr = await page.search(q);\r\n        if(!qr || !qr.results || !qr.results.length){\r\n            page.toast(\"error\", \"No wearables found in apparel \" + app.name);\r\n            return;\r\n        }\r\n        am7model.updateListModel(qr.results);\r\n        let wears = qr.results;\r\n\r\n        \r\n        let minLevel = 3;\r\n        let availMin = am7model.enums.wearLevelEnumType.findIndex(we => we == \"UNKNOWN\");\r\n        let maxLevel = minLevel;\r\n        let lvls = [...new Set(wears.sort((a, b) => {\r\n            let aL = am7model.enums.wearLevelEnumType.findIndex(we => we == a.level.toUpperCase());\r\n            let bL = am7model.enums.wearLevelEnumType.findIndex(we => we == b.level.toUpperCase());\r\n            return aL < bL ? -1 : aL > bL ? 1 : 0;\r\n        }).map((w) => w.level.toUpperCase()))];\r\n        \r\n        wears.forEach((w) => {\r\n            if(w.level){\r\n                let lvl = am7model.enums.wearLevelEnumType.findIndex(we => we == w.level.toUpperCase());\r\n                if(w.inuse){\r\n                    maxLevel = Math.max(maxLevel, lvl);\r\n                }\r\n                \r\n                else{\r\n                    availMin = Math.min(availMin, lvl);\r\n                }\r\n            }\r\n        });\r\n\r\n        let ulevel = (dressUp ? availMin : maxLevel);\r\n        let maxLevelName = am7model.enums.wearLevelEnumType[ulevel];\r\n        let maxLevelIdx = lvls.findIndex((l) => l == maxLevelName);\r\n\r\n        if(!lvls.includes(maxLevelName) || maxLevelIdx == -1){\r\n            page.toast(\"info\", \"No wearables found in apparel \" + app.name + \" for level \" + maxLevelName);\r\n            return false;\r\n        }\r\n\r\n        console.log(\"Max level is \" + maxLevelName + \" at index \" + maxLevelIdx + \" of \" + lvls.length);\r\n        if(dressUp && maxLevelIdx >= lvls.length){\r\n            page.toast(\"info\", \"Already dressed up to max level\");\r\n            return false; // Can't dress up anymore\r\n        }\r\n        else if(!dressUp && maxLevelIdx < 0){\r\n            page.toast(\"info\", \"Already dressed down to min level\");\r\n            return false; // Can't dress down anymore\r\n        }\r\n\r\n        let newLevel = am7model.enums.wearLevelEnumType.findIndex(we => we == lvls[maxLevelIdx + (dressUp ? 0 : -1)]);\r\n        let patch = [];\r\n        wears.forEach((w) => {\r\n            if(w.level){\r\n                let lvl = am7model.enums.wearLevelEnumType.findIndex(we => we == w.level.toUpperCase());\r\n                if(lvl > newLevel && w.inuse){\r\n                    w.inuse = false;\r\n                    patch.push({schema: 'olio.wearable', id: w.id, inuse: false});\r\n                }\r\n                else if(lvl <= newLevel && !w.inuse){\r\n                    w.inuse = true;\r\n                    patch.push({schema: 'olio.wearable', id: w.id, inuse: true});\r\n                }\r\n            }\r\n        });\r\n\r\n        if(patch.length || !app.description){\r\n            await setApparelDescription(app, wears);\r\n            vapp.description = app.description;\r\n        }\r\n\r\n        if(!patch.length){\r\n            page.toast(\"info\", \"No changes to make to \" + app.name + \" for level \" + newLevel);\r\n            // No changes but may still be able to continue dressing\r\n            return true;\r\n        }\r\n        \r\n        console.log(\"Patching \" + patch.length + \" items to level \" + newLevel);\r\n        let aP = [];\r\n        patch.forEach((p) => {\r\n            aP.push(page.patchObject(p));\r\n        });\r\n\r\n        // Execute all patches FIRST, then clear cache to prevent race condition\r\n        // where cache is cleared before patches complete, leaving orphaned mutations\r\n        await Promise.all(aP);\r\n\r\n        // Now clear cache after patches have successfully completed\r\n        await am7client.clearCache(\"olio.wearable\");\r\n        await am7client.clearCache(\"olio.apparel\");\r\n        await am7client.clearCache(\"olio.store\");\r\n\r\n        // Sync the local wears array with freshly patched state\r\n        // This ensures the nested references match what was persisted\r\n        patch.forEach((p) => {\r\n            let w = wears.find(w => w.id === p.id);\r\n            if(w) {\r\n                w.inuse = p.inuse;\r\n            }\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    async function setNarDescription(inst, cinst){\r\n        await am7client.clearCache(\"olio.narrative\");\r\n        let nar = await page.searchFirst(\"olio.narrative\", undefined, undefined, inst.api.narrative().objectId);\r\n        let pro = (inst.api.gender() == \"male\" ? \"He\" : \"She\");\r\n        cinst.api.description(inst.api.firstName() + \" is a \" + nar.physicalDescription + \" \" + pro + \" is \" + nar.outfitDescription + \".\");\r\n    }\r\n\r\n    // ==========================================\r\n    // Outfit Builder\r\n    // ==========================================\r\n\r\n    // Tech tier definitions (Kardashev-to-tier mapping)\r\n    const TECH_TIERS = [\r\n        { value: 0, label: \"Primitive\", icon: \"nature\", desc: \"Leaves, hide, raw fur\" },\r\n        { value: 1, label: \"Crafted\", icon: \"carpenter\", desc: \"Leather, linen, hemp\" },\r\n        { value: 2, label: \"Artisan\", icon: \"handyman\", desc: \"Cotton, wool, silk\" },\r\n        { value: 3, label: \"Industrial\", icon: \"precision_manufacturing\", desc: \"Polyester, nylon, denim\" },\r\n        { value: 4, label: \"Advanced\", icon: \"rocket_launch\", desc: \"Gore-Tex, carbon fiber\" }\r\n    ];\r\n\r\n    // Climate types\r\n    const CLIMATE_TYPES = [\r\n        { value: \"TROPICAL\", label: \"Tropical\", icon: \"wb_sunny\", desc: \"Hot, humid - minimal coverage\" },\r\n        { value: \"ARID\", label: \"Arid\", icon: \"terrain\", desc: \"Hot, dry - full coverage, light fabrics\" },\r\n        { value: \"TEMPERATE\", label: \"Temperate\", icon: \"park\", desc: \"Moderate - versatile layering\" },\r\n        { value: \"COLD\", label: \"Cold\", icon: \"ac_unit\", desc: \"Cold - heavy insulation\" },\r\n        { value: \"ARCTIC\", label: \"Arctic\", icon: \"severe_cold\", desc: \"Extreme - maximum insulation\" }\r\n    ];\r\n\r\n    // Outfit presets\r\n    const OUTFIT_PRESETS = [\r\n        { value: \"survival\", label: \"Survival\", icon: \"camping\" },\r\n        { value: \"casual\", label: \"Casual\", icon: \"weekend\" },\r\n        { value: \"formal\", label: \"Formal\", icon: \"checkroom\" },\r\n        { value: \"combat\", label: \"Combat\", icon: \"shield\" },\r\n        { value: \"travel\", label: \"Travel\", icon: \"hiking\" }\r\n    ];\r\n\r\n    // Body location slots for the piece editor\r\n    const BODY_LOCATIONS = [\r\n        { slot: \"head\", label: \"Head\", icon: \"face\" },\r\n        { slot: \"torso\", label: \"Torso\", icon: \"accessibility\" },\r\n        { slot: \"legs\", label: \"Legs\", icon: \"straighten\" },\r\n        { slot: \"feet\", label: \"Feet\", icon: \"do_not_step\" },\r\n        { slot: \"hands\", label: \"Hands\", icon: \"back_hand\" },\r\n        { slot: \"accessories\", label: \"Accessories\", icon: \"diamond\" }\r\n    ];\r\n\r\n    // Outfit builder state\r\n    let outfitBuilderState = {\r\n        characterId: null,\r\n        techTier: 2,\r\n        climate: \"TEMPERATE\",\r\n        preset: null,\r\n        isLoading: false,\r\n        currentApparel: null,\r\n        mannequinImages: [],\r\n        gender: \"female\",          // For mannequin base selection\r\n        selectedWearLevel: \"SUIT\", // Current wear level to display\r\n        mannequinBasePath: null    // Path to base mannequin image\r\n    };\r\n\r\n    // Wear levels for mannequin display\r\n    const WEAR_LEVELS = [\r\n        { value: \"NONE\", label: \"Nude\", icon: \"person\" },\r\n        { value: \"BASE\", label: \"Base\", icon: \"checkroom\" },\r\n        { value: \"SUIT\", label: \"Suit\", icon: \"dry_cleaning\" },\r\n        { value: \"OVER\", label: \"Over\", icon: \"layers\" },\r\n        { value: \"OUTER\", label: \"Outer\", icon: \"ac_unit\" }\r\n    ];\r\n\r\n    // Generate outfit via REST API\r\n    async function generateOutfit(characterId, techTier, climate, style) {\r\n        outfitBuilderState.isLoading = true;\r\n        m.redraw();\r\n\r\n        try {\r\n            let body = { characterId: characterId };\r\n            if (techTier !== undefined) body.techTier = techTier;\r\n            if (climate) body.climate = climate;\r\n            if (style) body.style = style;\r\n\r\n            let resp = await m.request({\r\n                method: 'POST',\r\n                url: g_application_path + \"/rest/game/outfit/generate\",\r\n                body: body,\r\n                withCredentials: true\r\n            });\r\n\r\n            if (resp) {\r\n                outfitBuilderState.currentApparel = resp;\r\n                page.toast(\"success\", \"Outfit generated successfully\");\r\n                await am7client.clearCache(\"olio.apparel\");\r\n                await am7client.clearCache(\"olio.wearable\");\r\n            }\r\n            return resp;\r\n        } catch (e) {\r\n            console.error(\"Failed to generate outfit\", e);\r\n            page.toast(\"error\", \"Failed to generate outfit: \" + e.message);\r\n            return null;\r\n        } finally {\r\n            outfitBuilderState.isLoading = false;\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    // Generate mannequin images for an apparel record\r\n    async function generateMannequinImages(apparelId, hires, style, seed) {\r\n        outfitBuilderState.isLoading = true;\r\n        m.redraw();\r\n\r\n        try {\r\n            let body = {\r\n                apparelId: apparelId,\r\n                hires: hires || false,\r\n                style: style || \"fashion\",\r\n                seed: seed || 0\r\n            };\r\n\r\n            let resp = await m.request({\r\n                method: 'POST',\r\n                url: g_application_path + \"/rest/game/outfit/mannequin\",\r\n                body: body,\r\n                withCredentials: true\r\n            });\r\n\r\n            if (resp && Array.isArray(resp)) {\r\n                outfitBuilderState.mannequinImages = resp;\r\n                page.toast(\"success\", \"Generated \" + resp.length + \" mannequin images\");\r\n            }\r\n            return resp;\r\n        } catch (e) {\r\n            console.error(\"Failed to generate mannequin images\", e);\r\n            page.toast(\"error\", \"Failed to generate images: \" + e.message);\r\n            return [];\r\n        } finally {\r\n            outfitBuilderState.isLoading = false;\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    // Build outfit from explicit pieces\r\n    async function buildFromPieces(characterId, pieces, primaryColor, pattern) {\r\n        outfitBuilderState.isLoading = true;\r\n        m.redraw();\r\n\r\n        try {\r\n            let body = {\r\n                characterId: characterId,\r\n                pieces: pieces,\r\n                primaryColor: primaryColor || null,\r\n                pattern: pattern || \"solid\"\r\n            };\r\n\r\n            let resp = await m.request({\r\n                method: 'POST',\r\n                url: g_application_path + \"/rest/game/outfit/pieces\",\r\n                body: body,\r\n                withCredentials: true\r\n            });\r\n\r\n            if (resp) {\r\n                outfitBuilderState.currentApparel = resp;\r\n                page.toast(\"success\", \"Custom outfit created\");\r\n                await am7client.clearCache(\"olio.apparel\");\r\n            }\r\n            return resp;\r\n        } catch (e) {\r\n            console.error(\"Failed to build outfit from pieces\", e);\r\n            page.toast(\"error\", \"Failed to create outfit: \" + e.message);\r\n            return null;\r\n        } finally {\r\n            outfitBuilderState.isLoading = false;\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    // Get mannequin base image URL\r\n    function getMannequinBaseUrl(gender, size) {\r\n        let modelName = (gender === \"male\") ? \"maleModel\" : \"femaleModel\";\r\n        // Use the olio random mannequin endpoint or a static path\r\n        return g_application_path + \"/rest/olio/mannequin/\" + modelName + \"/\" + (size || \"512x768\");\r\n    }\r\n\r\n    // Interactive Mannequin Component\r\n    let MannequinViewer = {\r\n        view: function(vnode) {\r\n            let gender = vnode.attrs.gender || outfitBuilderState.gender;\r\n            let apparel = vnode.attrs.apparel || outfitBuilderState.currentApparel;\r\n            let wearLevel = vnode.attrs.wearLevel || outfitBuilderState.selectedWearLevel;\r\n            let images = outfitBuilderState.mannequinImages || [];\r\n\r\n            // Find the image for the current wear level\r\n            let levelImage = images.find(function(img) {\r\n                return img.wearLevel && img.wearLevel.startsWith(wearLevel);\r\n            });\r\n\r\n            let baseUrl = getMannequinBaseUrl(gender, \"512x768\");\r\n            let overlayUrl = null;\r\n\r\n            if (levelImage) {\r\n                overlayUrl = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) +\r\n                    \"/data.data\" + levelImage.groupPath + \"/\" + levelImage.name + \"/512x768\";\r\n            }\r\n\r\n            return m(\"div\", { class: \"mv-container\" }, [\r\n                // Mannequin display area\r\n                m(\"div\", { class: \"mv-viewport\" }, [\r\n                    // Base mannequin silhouette\r\n                    m(\"div\", { class: \"mv-base\" }, [\r\n                        m(\"img\", {\r\n                            src: baseUrl,\r\n                            alt: \"Mannequin\",\r\n                            class: \"mv-base-img\",\r\n                            onerror: function(e) {\r\n                                // Fallback to placeholder if image not found\r\n                                e.target.style.display = 'none';\r\n                            }\r\n                        }),\r\n                        // Fallback silhouette\r\n                        m(\"div\", { class: \"mv-silhouette\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined mv-silhouette-icon\" },\r\n                                gender === \"male\" ? \"man\" : \"woman\")\r\n                        ])\r\n                    ]),\r\n\r\n                    // Overlay with generated outfit image\r\n                    overlayUrl ? m(\"div\", { class: \"mv-overlay\" }, [\r\n                        m(\"img\", {\r\n                            src: overlayUrl,\r\n                            alt: wearLevel + \" outfit\",\r\n                            class: \"mv-overlay-img\"\r\n                        })\r\n                    ]) : null,\r\n\r\n                    // Loading indicator\r\n                    outfitBuilderState.isLoading ? m(\"div\", { class: \"mv-loading\" }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined animate-spin\" }, \"sync\")\r\n                    ]) : null\r\n                ]),\r\n\r\n                // Wear level tabs\r\n                m(\"div\", { class: \"mv-levels\" }, WEAR_LEVELS.map(function(level) {\r\n                    let isSelected = wearLevel === level.value;\r\n                    let hasImage = images.some(function(img) {\r\n                        return img.wearLevel && img.wearLevel.startsWith(level.value);\r\n                    });\r\n                    return m(\"button\", {\r\n                        class: \"mv-level-btn\" + (isSelected ? \" mv-level-selected\" : \"\") +\r\n                               (hasImage ? \" mv-level-available\" : \"\"),\r\n                        onclick: function() {\r\n                            outfitBuilderState.selectedWearLevel = level.value;\r\n                        }\r\n                    }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined\" }, level.icon),\r\n                        m(\"span\", { class: \"mv-level-label\" }, level.label)\r\n                    ]);\r\n                })),\r\n\r\n                // Gender toggle\r\n                m(\"div\", { class: \"mv-gender-toggle\" }, [\r\n                    m(\"button\", {\r\n                        class: \"mv-gender-btn\" + (gender === \"female\" ? \" mv-gender-selected\" : \"\"),\r\n                        onclick: function() {\r\n                            outfitBuilderState.gender = \"female\";\r\n                        }\r\n                    }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined\" }, \"woman\")\r\n                    ]),\r\n                    m(\"button\", {\r\n                        class: \"mv-gender-btn\" + (gender === \"male\" ? \" mv-gender-selected\" : \"\"),\r\n                        onclick: function() {\r\n                            outfitBuilderState.gender = \"male\";\r\n                        }\r\n                    }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined\" }, \"man\")\r\n                    ])\r\n                ])\r\n            ]);\r\n        }\r\n    };\r\n\r\n    // Outfit Builder UI Component\r\n    let OutfitBuilderPanel = {\r\n        oninit: function(vnode) {\r\n            if (vnode.attrs.characterId) {\r\n                outfitBuilderState.characterId = vnode.attrs.characterId;\r\n            }\r\n            if (vnode.attrs.gender) {\r\n                outfitBuilderState.gender = vnode.attrs.gender;\r\n            }\r\n        },\r\n        view: function(vnode) {\r\n            let characterId = vnode.attrs.characterId || outfitBuilderState.characterId;\r\n\r\n            return m(\"div\", { class: \"ob-panel\" }, [\r\n                // Header\r\n                m(\"div\", { class: \"ob-header\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined\" }, \"checkroom\"),\r\n                    \" Outfit Builder\"\r\n                ]),\r\n\r\n                // Loading indicator\r\n                outfitBuilderState.isLoading ? m(\"div\", { class: \"ob-loading\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined animate-spin\" }, \"sync\"),\r\n                    \" Generating...\"\r\n                ]) : null,\r\n\r\n                // Tech Tier Selection\r\n                m(\"div\", { class: \"ob-section\" }, [\r\n                    m(\"div\", { class: \"ob-section-label\" }, \"Tech Level\"),\r\n                    m(\"div\", { class: \"ob-tier-grid\" }, TECH_TIERS.map(function(tier) {\r\n                        let isSelected = outfitBuilderState.techTier === tier.value;\r\n                        return m(\"button\", {\r\n                            class: \"ob-tier-btn\" + (isSelected ? \" ob-tier-selected\" : \"\"),\r\n                            title: tier.desc,\r\n                            onclick: function() { outfitBuilderState.techTier = tier.value; }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\" }, tier.icon),\r\n                            m(\"span\", { class: \"ob-tier-label\" }, tier.label)\r\n                        ]);\r\n                    }))\r\n                ]),\r\n\r\n                // Climate Selection\r\n                m(\"div\", { class: \"ob-section\" }, [\r\n                    m(\"div\", { class: \"ob-section-label\" }, \"Climate\"),\r\n                    m(\"div\", { class: \"ob-climate-grid\" }, CLIMATE_TYPES.map(function(climate) {\r\n                        let isSelected = outfitBuilderState.climate === climate.value;\r\n                        return m(\"button\", {\r\n                            class: \"ob-climate-btn\" + (isSelected ? \" ob-climate-selected\" : \"\"),\r\n                            title: climate.desc,\r\n                            onclick: function() { outfitBuilderState.climate = climate.value; }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\" }, climate.icon),\r\n                            m(\"span\", { class: \"ob-climate-label\" }, climate.label)\r\n                        ]);\r\n                    }))\r\n                ]),\r\n\r\n                // Presets\r\n                m(\"div\", { class: \"ob-section\" }, [\r\n                    m(\"div\", { class: \"ob-section-label\" }, \"Quick Presets\"),\r\n                    m(\"div\", { class: \"ob-preset-grid\" }, OUTFIT_PRESETS.map(function(preset) {\r\n                        return m(\"button\", {\r\n                            class: \"ob-preset-btn\",\r\n                            onclick: async function() {\r\n                                await generateOutfit(characterId, outfitBuilderState.techTier, outfitBuilderState.climate, preset.value);\r\n                                if (vnode.attrs.onGenerate) {\r\n                                    vnode.attrs.onGenerate(outfitBuilderState.currentApparel);\r\n                                }\r\n                            }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\" }, preset.icon),\r\n                            \" \" + preset.label\r\n                        ]);\r\n                    }))\r\n                ]),\r\n\r\n                // Generate Button\r\n                m(\"div\", { class: \"ob-section ob-actions\" }, [\r\n                    m(\"button\", {\r\n                        class: \"ob-generate-btn\",\r\n                        disabled: !characterId || outfitBuilderState.isLoading,\r\n                        onclick: async function() {\r\n                            await generateOutfit(characterId, outfitBuilderState.techTier, outfitBuilderState.climate);\r\n                            if (vnode.attrs.onGenerate) {\r\n                                vnode.attrs.onGenerate(outfitBuilderState.currentApparel);\r\n                            }\r\n                        }\r\n                    }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined\" }, \"auto_awesome\"),\r\n                        \" Generate Outfit\"\r\n                    ])\r\n                ]),\r\n\r\n                // Interactive Mannequin Viewer\r\n                m(\"div\", { class: \"ob-section\" }, [\r\n                    m(\"div\", { class: \"ob-section-label\" }, \"Mannequin Preview\"),\r\n                    m(MannequinViewer, {\r\n                        gender: outfitBuilderState.gender,\r\n                        apparel: outfitBuilderState.currentApparel,\r\n                        wearLevel: outfitBuilderState.selectedWearLevel\r\n                    })\r\n                ]),\r\n\r\n                // Current Apparel Preview (if available)\r\n                outfitBuilderState.currentApparel ? m(\"div\", { class: \"ob-section ob-preview\" }, [\r\n                    m(\"div\", { class: \"ob-section-label\" }, \"Current Outfit\"),\r\n                    m(\"div\", { class: \"ob-apparel-name\" }, outfitBuilderState.currentApparel.name || \"Unnamed\"),\r\n                    m(\"div\", { class: \"ob-apparel-desc\" }, outfitBuilderState.currentApparel.description || \"\"),\r\n\r\n                    // Mannequin image button\r\n                    m(\"button\", {\r\n                        class: \"ob-mannequin-btn\",\r\n                        onclick: async function() {\r\n                            await generateMannequinImages(outfitBuilderState.currentApparel.objectId);\r\n                        }\r\n                    }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined\" }, \"photo_camera\"),\r\n                        \" Generate Outfit Images\"\r\n                    ]),\r\n\r\n                    // Mannequin gallery (per-level images)\r\n                    outfitBuilderState.mannequinImages.length > 0 ? m(\"div\", { class: \"ob-mannequin-gallery\" },\r\n                        outfitBuilderState.mannequinImages.map(function(img) {\r\n                            let imgUrl = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) +\r\n                                \"/data.data\" + img.groupPath + \"/\" + img.name + \"/256x256\";\r\n                            return m(\"div\", {\r\n                                class: \"ob-mannequin-thumb\" + (img.wearLevel && img.wearLevel.startsWith(outfitBuilderState.selectedWearLevel) ? \" ob-thumb-selected\" : \"\"),\r\n                                onclick: function() {\r\n                                    if (img.wearLevel) {\r\n                                        outfitBuilderState.selectedWearLevel = img.wearLevel.split(\"/\")[0];\r\n                                    }\r\n                                }\r\n                            }, [\r\n                                m(\"img\", { src: imgUrl, alt: img.wearLevel || \"Level\" }),\r\n                                m(\"div\", { class: \"ob-level-label\" }, img.wearLevel ? img.wearLevel.split(\"/\")[0] : \"\")\r\n                            ]);\r\n                        })\r\n                    ) : null\r\n                ]) : null\r\n            ]);\r\n        }\r\n    };\r\n\r\n    // Piece Editor Component (for detailed outfit customization)\r\n    let PieceEditorPanel = {\r\n        view: function(vnode) {\r\n            let apparel = vnode.attrs.apparel;\r\n            let wearables = apparel && apparel.wearables ? apparel.wearables : [];\r\n\r\n            // Group wearables by body location\r\n            let byLocation = {};\r\n            BODY_LOCATIONS.forEach(function(loc) {\r\n                byLocation[loc.slot] = [];\r\n            });\r\n            wearables.forEach(function(w) {\r\n                let locs = w.location || [];\r\n                locs.forEach(function(l) {\r\n                    let slot = l.toLowerCase();\r\n                    if (slot.includes(\"head\") || slot.includes(\"face\") || slot.includes(\"ear\")) {\r\n                        byLocation.head.push(w);\r\n                    } else if (slot.includes(\"torso\") || slot.includes(\"chest\") || slot.includes(\"back\") || slot.includes(\"shoulder\")) {\r\n                        byLocation.torso.push(w);\r\n                    } else if (slot.includes(\"leg\") || slot.includes(\"hip\") || slot.includes(\"thigh\")) {\r\n                        byLocation.legs.push(w);\r\n                    } else if (slot.includes(\"foot\") || slot.includes(\"ankle\")) {\r\n                        byLocation.feet.push(w);\r\n                    } else if (slot.includes(\"hand\") || slot.includes(\"wrist\") || slot.includes(\"finger\")) {\r\n                        byLocation.hands.push(w);\r\n                    } else {\r\n                        byLocation.accessories.push(w);\r\n                    }\r\n                });\r\n            });\r\n\r\n            return m(\"div\", { class: \"pe-panel\" }, [\r\n                m(\"div\", { class: \"pe-header\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined\" }, \"edit\"),\r\n                    \" Piece Editor\"\r\n                ]),\r\n\r\n                m(\"div\", { class: \"pe-slots\" }, BODY_LOCATIONS.map(function(loc) {\r\n                    let pieces = byLocation[loc.slot] || [];\r\n                    return m(\"div\", { class: \"pe-slot\" }, [\r\n                        m(\"div\", { class: \"pe-slot-header\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\" }, loc.icon),\r\n                            \" \" + loc.label\r\n                        ]),\r\n                        m(\"div\", { class: \"pe-slot-items\" }, pieces.length > 0 ?\r\n                            pieces.map(function(p) {\r\n                                return m(\"div\", {\r\n                                    class: \"pe-item\" + (p.inuse ? \" pe-item-worn\" : \"\")\r\n                                }, [\r\n                                    m(\"span\", { class: \"pe-item-name\" }, p.name),\r\n                                    p.color ? m(\"span\", {\r\n                                        class: \"pe-item-color\",\r\n                                        style: \"background-color: \" + (p.color.hex || \"#888\")\r\n                                    }) : null\r\n                                ]);\r\n                            }) :\r\n                            m(\"div\", { class: \"pe-slot-empty\" }, \"Empty\")\r\n                        )\r\n                    ]);\r\n                }))\r\n            ]);\r\n        }\r\n    };\r\n\r\n    let am7olio = {\r\n        dressUp,\r\n        dressDown,\r\n        dressCharacter,\r\n        dressApparel,\r\n        setNarDescription,\r\n        // Outfit builder exports\r\n        TECH_TIERS,\r\n        CLIMATE_TYPES,\r\n        OUTFIT_PRESETS,\r\n        BODY_LOCATIONS,\r\n        WEAR_LEVELS,\r\n        outfitBuilderState,\r\n        generateOutfit,\r\n        generateMannequinImages,\r\n        buildFromPieces,\r\n        getMannequinBaseUrl,\r\n        OutfitBuilderPanel,\r\n        MannequinViewer,\r\n        PieceEditorPanel\r\n    };\r\n\r\n    if (typeof module != \"undefined\") {\r\n        module.am7olio = am7olio;\r\n    } else {\r\n        window.am7olio = am7olio;\r\n    }\r\n}());\n\n;/* === client/formDef.js === */\n(function () {\r\n    /// TODO: Currently out of date\r\n    let forms = {\r\n        access: {},\r\n        auth: {},\r\n        common: {},\r\n        crypto: {},\r\n        data: {},\r\n        identity: {},\r\n        message: {},\r\n        olio: {},\r\n        policy: {},\r\n        system: {}\r\n    };\r\n\r\n    forms.nameIdType = {\r\n        fields: [\"name\"]\r\n    };\r\n    forms.attribute = {\r\n        label: \"Attribute\",\r\n        format: \"table\",\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                altIcon: 'check',\r\n                altCondition: ['edit'],\r\n                function: 'newEntry',\r\n                altFunction: 'checkEntry'\r\n            },\r\n            edit: {\r\n                label: 'Edit',\r\n                icon: 'edit',\r\n                function: 'editEntry',\r\n                condition: ['select']\r\n            },\r\n            cancel: {\r\n                label: 'Cancel',\r\n                icon: 'cancel',\r\n                function: 'cancelEntry',\r\n                condition: ['select', 'edit']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteEntry',\r\n                condition: ['select']\r\n            }\r\n\r\n        },\r\n\r\n        fields: {\r\n            valueType: {\r\n                layout: \"one\"\r\n            },\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            value: {\r\n                layout: \"third\"\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.control = {\r\n        label: \"Control\",\r\n        requiredAttributes: [],\r\n        format: \"table\",\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                altIcon: 'check',\r\n                altCondition: ['edit'],\r\n                function: 'newEntry',\r\n                altFunction: 'checkEntry'\r\n            },\r\n            edit: {\r\n                label: 'Edit',\r\n                icon: 'edit',\r\n                function: 'editEntry',\r\n                condition: ['select']\r\n            },\r\n            cancel: {\r\n                label: 'Cancel',\r\n                icon: 'cancel',\r\n                function: 'cancelEntry',\r\n                condition: ['select', 'edit']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteEntry',\r\n                condition: ['select']\r\n            }\r\n\r\n        },\r\n\r\n        fields: {\r\n            controlType: {\r\n                layout: \"third\"\r\n            },\r\n            controlId: {\r\n                layout: \"third\"\r\n            },\r\n            action: {\r\n                layout: \"third\"\r\n            }\r\n        }\r\n    };\r\n    forms.controls = {\r\n        label: \"Controls\",\r\n        format: \"table\",\r\n        fields: {\r\n            controls: {\r\n                layout: 'half',\r\n                form: forms.control\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    forms.requestList = {\r\n        label: \"Request\",\r\n        requiredAttributes: [\"objectId\"],\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                altIcon: 'check',\r\n                altCondition: ['edit'],\r\n                function: 'newEntry',\r\n                altFunction: 'checkEntry'\r\n            },\r\n            edit: {\r\n                label: 'Edit',\r\n                icon: 'edit',\r\n                function: 'editEntry',\r\n                condition: ['select']\r\n            },\r\n            cancel: {\r\n                label: 'Cancel',\r\n                icon: 'cancel',\r\n                function: 'cancelEntry',\r\n                condition: ['select', 'edit']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteEntry',\r\n                condition: ['select']\r\n            }\r\n\r\n        },\r\n\r\n        fields: {\r\n            approvalStatus: {\r\n                layout: \"one\"\r\n            },\r\n            entitlementType: {\r\n                layout: \"one\"\r\n            },\r\n            entitlementrel: {\r\n                layout: \"third\"\r\n            },\r\n            requestorrel: {\r\n                layout: \"third\"\r\n            }\r\n            /*\r\n            ,\r\n            referencerel : {\r\n                layout : \"third\"\r\n            }\r\n            */\r\n        }\r\n    };\r\n    forms.requestsList = {\r\n        label: \"Requests\",\r\n        fields: {\r\n            requests: {\r\n                layout: 'half',\r\n                form: forms.requestList\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    forms.request = {\r\n        label: \"Requests\",\r\n        fields: {\r\n            approvalStatus: {\r\n                layout: \"one\"\r\n            },\r\n            entitlementType: {\r\n                layout: \"one\"\r\n            },\r\n            entitlementrel: {\r\n                layout: \"third\"\r\n            },\r\n            requestorrel: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        forms: [\"dateinfo\", \"attributes\"]\r\n    };\r\n\r\n\r\n\r\n    forms.attributes = {\r\n        label: \"Attributes\",\r\n        format: \"table\",\r\n        /*requiredAttributes : [\"objectId\"],*/\r\n        fields: {\r\n            attributes: {\r\n                layout: 'full',\r\n                form: forms.attribute\r\n            }\r\n        }\r\n    };\r\n    \r\n\r\n\r\n    forms.ctlattributes = {\r\n        label: \"Controls and Attributes\",\r\n        /*requiredAttributes : [\"objectId\"],*/\r\n        fields: {\r\n            attributes: {\r\n                layout: 'half',\r\n                form: forms.attribute\r\n            },\r\n            controls: {\r\n                /*requiredAttributes : [\"objectId\"],*/\r\n                layout: \"half\",\r\n                form: forms.control\r\n            }\r\n        }\r\n    };\r\n    forms.reqattributes = {\r\n        label: \"Requests and Attributes\",\r\n        /*requiredAttributes : [\"objectId\"],*/\r\n        fields: {\r\n            attributes: {\r\n                layout: 'half',\r\n                form: forms.attribute\r\n            },\r\n            requestsList: {\r\n                requiredAttributes: [\"objectId\"],\r\n                layout: \"half\",\r\n                form: forms.requestList\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n\r\n    forms.elementValues = {\r\n        label: \"Select Option\",\r\n        requiredAttributes: [\"elementType\"],\r\n        requiredValues: [\"SELECT|MULTIPLE_SELECT\"],\r\n        referField: true,\r\n        commands: {\r\n            new: {\r\n                icon: 'add',\r\n                altIcon: 'check',\r\n                altCondition: ['edit'],\r\n                function: 'newEntry',\r\n                altFunction: 'checkEntry'\r\n            },\r\n            edit: {\r\n                label: 'Edit',\r\n                icon: 'edit',\r\n                function: 'editEntry',\r\n                condition: ['select']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteEntry',\r\n                condition: ['select']\r\n            }\r\n\r\n        },\r\n\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            textValue: {\r\n                layout: \"third\"\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.dateinfo = {\r\n        label: \"Info\",\r\n        fields: {\r\n            uri: {\r\n                layout: \"full\"\r\n            },\r\n            urn: {\r\n                layout: \"third\"\r\n            },\r\n            objectId: {\r\n                layout: \"third\"\r\n            },\r\n            organizationPath: {\r\n                layout: \"third\"\r\n            },\r\n            createdDate: {\r\n                layout: \"third\"\r\n            },\r\n            modifiedDate: {\r\n                layout: \"third\"\r\n            },\r\n            expiryDate: {\r\n                layout: \"third\"\r\n            }\r\n        }\r\n    };\r\n    /*\r\n    forms.subdateinfo = {\r\n        label : \"Info\",\r\n        fields : {\r\n            uri : {\r\n                layout : \"half\"\r\n            },\r\n            objectId : {\r\n                layout : \"half\"\r\n            },\r\n            createdDate : {\r\n                layout : \"third\"\r\n            },\r\n            modifiedDate : {\r\n                layout : \"third\"\r\n            },\r\n            expiryDate : {\r\n                layout : \"third\"\r\n            }\r\n        }\r\n    };\r\n    */\r\n    forms.messageMeta = {\r\n        label: \"Message Meta\",\r\n        fields: {\r\n            senderType: {\r\n                layout: \"one\"\r\n            },\r\n            senderId: {\r\n                layout: \"third\"\r\n            },\r\n            recipientType: {\r\n                layout: \"one\"\r\n            },\r\n            recipientId: {\r\n                layout: \"third\"\r\n            },\r\n            expires: {\r\n                layout: \"one\"\r\n            },\r\n            uri: {\r\n                layout: \"half\"\r\n            },\r\n            objectId: {\r\n                layout: \"third\"\r\n            },\r\n            createdDate: {\r\n                layout: \"third\"\r\n            },\r\n            modifiedDate: {\r\n                layout: \"third\"\r\n            },\r\n            expiryDate: {\r\n                layout: \"third\"\r\n            },\r\n            transportType: {\r\n                layout: \"one\"\r\n            },\r\n            transportId: {\r\n                layout: \"third\"\r\n            },\r\n            referenceType: {\r\n                layout: \"one\"\r\n            },\r\n            referenceId: {\r\n                layout: \"third\"\r\n            }\r\n        }\r\n    };\r\n    forms.message = {\r\n        label: \"Message\",\r\n        fields: {\r\n\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            valueType: {\r\n                layout: \"half\"\r\n            },\r\n            spoolBucketType: {\r\n                layout: \"third\"\r\n            },\r\n            spoolBucketName: {\r\n                layout: \"third\"\r\n            },\r\n            spoolStatus: {\r\n                layout: \"third\"\r\n            },\r\n            data: {\r\n                layout: \"full\"\r\n            }\r\n        },\r\n        forms: [\"messageMeta\"]\r\n    };\r\n\r\n\r\n    forms.groupdateinfo = {\r\n        label: \"Info\",\r\n        fields: {\r\n            uri: {\r\n                layout: \"full\"\r\n            },\r\n            urn: {\r\n                layout: \"third\"\r\n            },\r\n            objectId: {\r\n                layout: \"third\"\r\n            },\r\n            organizationPath: {\r\n                layout: \"third\"\r\n            },\r\n            createdDate: {\r\n                layout: \"third\"\r\n            },\r\n            modifiedDate: {\r\n                layout: \"third\"\r\n            },\r\n            expiryDate: {\r\n                layout: \"third\"\r\n            },\r\n            groupPath: {\r\n                layout: \"half\"\r\n            }\r\n        }\r\n    };\r\n    forms.groupinfo = {\r\n        label: \"Info\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            uri: {\r\n                layout: \"full\"\r\n            },\r\n            urn: {\r\n                layout: \"third\"\r\n            },\r\n            objectId: {\r\n                layout: \"third\"\r\n            },\r\n            organizationPath: {\r\n                layout: \"third\"\r\n            },\r\n            groupPath: {\r\n                layout: \"half\"\r\n            }\r\n        }\r\n    }\r\n    forms.lightgroupinfo = {\r\n        label: \"Info\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            uri: {\r\n                layout: \"full\"\r\n            },\r\n            objectId: {\r\n                layout: \"third\"\r\n            },\r\n            organizationPath: {\r\n                layout: \"third\"\r\n            },\r\n            groupPath: {\r\n                layout: \"third\"\r\n            }\r\n        }\r\n    }\r\n    forms.parentinfo = {\r\n        label: \"Info\",\r\n        fields: {\r\n            uri: {\r\n                layout: \"full\"\r\n            },\r\n            urn: {\r\n                layout: \"third\"\r\n            },\r\n            objectId: {\r\n                layout: \"third\"\r\n            },\r\n            organizationPath: {\r\n                layout: \"third\"\r\n            },\r\n            path: {\r\n                layout: \"half\"\r\n            }\r\n        }\r\n    }\r\n    forms.grouptypeinfo = {\r\n        label: \"Info\",\r\n        fields: {\r\n            uri: {\r\n                layout: \"full\"\r\n            },\r\n            /*\r\n            urn : {\r\n                layout : \"third\"\r\n            },\r\n            */\r\n            objectId: {\r\n                layout: \"third\"\r\n            },\r\n            organizationPath: {\r\n                layout: \"third\"\r\n            },\r\n            groupPath: {\r\n                layout: \"third\"\r\n            }\r\n        }\r\n    }\r\n\r\n    am7model.models.push(\r\n        {\r\n            name: \"executeExt\",\r\n            fields: [\r\n                {\r\n                    name: \"execute\",\r\n                    label: 'Execute',\r\n                    virtual: true,\r\n                    ephemeral: true,\r\n                    type: 'form',\r\n                    function: 'objectExecute',\r\n                    format: 'form'\r\n                }\r\n            ]\r\n        }\r\n    );\r\n\r\n\r\n    /// TEMPORARY: Move this directly to the form config setting to override the model, versus modifying the model definition\r\n    ///\r\n    am7model.enums.mimeTypeEnumType = [\"application/binhex\", \"application/book\", \"application/cdf\", \"application/clariscad\", \"application/commonground\", \"application/drafting\", \"application/envoy\", \"application/excel\", \"application/fractals\", \"application/freeloader\", \"application/futuresplash\", \"application/groupwise\", \"application/hlp\", \"application/hta\", \"application/i-deas\", \"application/inf\", \"application/json\", \"application/lha\", \"application/marc\", \"application/mbedlet\", \"application/mcad\", \"application/mime\", \"application/mspowerpoint\", \"application/msword\", \"application/mswrite\", \"application/netmc\", \"application/octet-stream\", \"application/oda\", \"application/pdf\", \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\", \"application/pkix-cert\", \"application/pkix-crl\", \"application/postscript\", \"application/ringing-tones\", \"application/sdp\", \"application/sea\", \"application/set\", \"application/sla\", \"application/smil\", \"application/solids\", \"application/sounder\", \"application/step\", \"application/streamingmedia\", \"application/toolbook\", \"application/vda\", \"application/vocaltec-media-desc\", \"application/vocaltec-media-file\", \"application/wordperfect\", \"application/x-aim\", \"application/x-authorware-bin\", \"application/x-authorware-map\", \"application/x-authorware-seg\", \"application/x-bcpio\", \"application/x-bsh\", \"application/x-bzip\", \"application/x-cdlink\", \"application/x-chat\", \"application/x-cocoa\", \"application/x-compressed\", \"application/x-conference\", \"application/x-cpio\", \"application/x-cpt\", \"application/x-deepv\", \"application/x-director\", \"application/x-dvi\", \"application/x-elc\", \"application/x-envoy\", \"application/x-esrehber\", \"application/x-excel\", \"application/x-freelance\", \"application/x-gsp\", \"application/x-gss\", \"application/x-gtar\", \"application/x-gzip\", \"application/x-hdf\", \"application/x-helpfile\", \"application/x-httpd-imap\", \"application/x-ima\", \"application/x-inventor\", \"application/x-java-class\", \"application/x-java-commerce\", \"application/x-javascript\", \"application/x-koan\", \"application/x-ksh\", \"application/x-latex\", \"application/x-livescreen\", \"application/x-lotus\", \"application/x-mif\", \"application/x-mix-transfer\", \"application/x-msexcel\", \"application/x-navi-animation\", \"application/x-navidoc\", \"application/x-navimap\", \"application/x-netcdf\", \"application/x-newton-compatible-pkg\", \"application/x-omc\", \"application/x-omcdatamaker\", \"application/x-omcregerator\", \"application/x-pagemaker\", \"application/x-pcl\", \"application/x-pixclscript\", \"application/x-project\", \"application/x-qpro\", \"application/x-seelogo\", \"application/x-shockwave-flash\", \"application/x-sprite\", \"application/x-stuffit\", \"application/x-tar\", \"application/x-tbook\", \"application/x-tcl\", \"application/x-tex\", \"application/x-texinfo\", \"application/x-troff\", \"application/x-troff-man\", \"application/x-troff-me\", \"application/x-troff-ms\", \"application/x-ustar\", \"application/x-visio\", \"application/x-wais-source\", \"application/x-wintalk\", \"application/x-world\", \"audio/aiff\", \"audio/basic\", \"audio/it\", \"audio/make\", \"audio/mid\", \"audio/midi\", \"audio/mod\", \"audio/mpeg\", \"audio/nspaudio\", \"audio/tsp-audio\", \"audio/tsplayer\", \"audio/voc\", \"audio/voxware\", \"audio/wav\", \"audio/weba\", \"audio/x-au\", \"audio/x-gsm\", \"audio/x-jam\", \"audio/x-liveaudio\", \"audio/x-mpequrl\", \"audio/x-pn-realaudio\", \"audio/x-pn-realaudio-plugin\", \"audio/x-psid\", \"audio/x-realaudio\", \"audio/x-twinvq\", \"audio/x-twinvq-plugin\", \"audio/xm\", \"chemical/x-pdb\", \"i-world/i-vrml\", \"image/bmp\", \"image/cmu-raster\", \"image/fif\", \"image/florian\", \"image/gif\", \"image/ief\", \"image/jpeg\", \"image/jutvision\", \"image/naplps\", \"image/pict\", \"image/png\", \"image/tiff\", \"image/x-dwg\", \"image/x-icon\", \"image/x-jg\", \"image/x-jps\", \"image/x-niff\", \"image/x-pcx\", \"image/x-pict\", \"image/x-portable-anymap\", \"image/x-portable-bitmap\", \"image/x-portable-graymap\", \"image/x-portable-pixmap\", \"image/x-quicktime\", \"image/x-rgb\", \"image/x-xpixmap\", \"image/x-xwindowdump\", \"image/xbm\", \"image/xpm\", \"model/iges\", \"model/vrml\", \"model/x-pov\", \"multipart/x-zip\", \"music/x-karaoke\", \"paleovu/x-pv\", \"text/asp\", \"text/css\", \"text/csv\", \"text/html\", \"text/mcf\", \"text/pascal\", \"text/plain\", \"text/richtext\", \"text/scriplet\", \"text/sgml\", \"text/tab-separated-values\", \"text/uri-list\", \"text/webviewhtml\", \"text/x-asm\", \"text/x-audiosoft-intra\", \"text/x-c\", \"text/x-component\", \"text/x-fortran\", \"text/x-h\", \"text/x-java-source\", \"text/x-la-asf\", \"text/x-m\", \"text/x-pascal\", \"text/x-script\", \"text/x-server-parsed-html\", \"text/x-setext\", \"text/x-speech\", \"text/x-uil\", \"text/x-uuencode\", \"text/x-vcalendar\", \"text/xml\", \"video/animaflex\", \"video/avi\", \"video/avs-video\", \"video/fli\", \"video/gl\", \"video/3gpp\", \"video/mp4\", \"video/mpeg\", \"video/quicktime\", \"video/vdo\", \"video/vivo\", \"video/webm\", \"video/webp\", \"video/x-amt-demorun\", \"video/x-amt-showrun\", \"video/x-dl\", \"video/x-dv\", \"video/x-flv\", \"video/x-isvideo\", \"video/x-motion-jpeg\", \"video/x-ms-asf\", \"video/x-ms-wmv\", \"video/x-qtc\", \"video/x-scm\", \"video/x-sgi-movie\", \"windows/metafile\", \"www/mime\", \"x-conference/x-cooltalk\", \"x-world/x-vrt\", \"xgl/drawing\", \"xgl/movie\"];\r\n    //let nameId = am7model.getModel(\"common.nameId\");\r\n    //nameId\r\n    let sysId = am7model.getModel(\"system.primaryKey\");\r\n    sysId.fields.push({\r\n        name: \"uri\",\r\n        label: 'URI',\r\n        type: 'link',\r\n        virtual: true,\r\n        ephemeral: true,\r\n        format: 'object-link'\r\n    },\r\n        {\r\n            name: am7model.jsonModelKey,\r\n            label: \"Model\",\r\n            type: \"string\",\r\n            virtual: true,\r\n            ephemeral: true,\r\n            function: 'getModel'\r\n        }\r\n\r\n    );\r\n\r\n\r\n    let role = am7model.getModel(\"auth.role\");\r\n    role.fields.push({\r\n        name: \"members\",\r\n        label: 'Members',\r\n        type: 'list',\r\n        baseType: \"model\",\r\n        baseModel: \"$flex\",\r\n        function : 'objectMembers',\r\n        promise: true,\r\n        foreignType: \"type\",\r\n        virtual: true,\r\n        ephemeral: true,\r\n        format: 'table'\r\n    });\r\n\r\n    let dataM = am7model.getModel(\"data.data\");\r\n    dataM.inherits.push(\"executeExt\");\r\n    //dataM.query.push(\"groupPath\");\r\n    let ctf = am7model.getModelField(dataM, \"contentType\");\r\n    ctf.type = \"enum\";\r\n    ctf.default = \"text/plain\";\r\n    ctf.enum = am7model.enums.mimeTypeEnumType;\r\n    ctf.filter = /(^text\\/(plain|css|csv|html|xml)$|\\/json$|javascript$|^video\\/(webm|webp|mpeg|avi|mp4|3gpp)$|^audio\\/(wav|mp3|mp4)|^image\\/(gif|jpeg|png)|application\\/vnd.openxmlformats-officedocument.wordprocessingml.document)/;\r\n\r\n    let tagM = am7model.getModel(\"data.tag\");\r\n    let tagf = am7model.getModelField(tagM, \"type\");\r\n    tagf.type = \"enum\";\r\n    tagf.default = am7model.enums.modelNames[0];\r\n    tagf.enum = am7model.enums.modelNames.sort();\r\n\r\n    forms.data = {\r\n        label: \"Data\",\r\n        commands: {\r\n            fact: {\r\n                label: 'Fact',\r\n                icon: 'fact_check',\r\n                function: 'makeFact',\r\n                requiredAttribute: \"objectId\"\r\n            },\r\n            reimage: {\r\n                label: 'Reimage',\r\n                icon: 'auto_awesome',\r\n                function: 'reimage',\r\n                requiredAttribute: \"objectId\"\r\n            }\r\n        },\r\n        query: [\"stream\", \"compressionType\", \"vaulted\", \"enciphered\"],\r\n        fields: {\r\n            name: {\r\n                label: \"Name\",\r\n                layout: \"half\"\r\n            },\r\n            contentType: {\r\n                layout: \"one\"\r\n            },\r\n            vectorize: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'polyline',\r\n                requiredAttributes: [\"objectId\"],\r\n                field: {\r\n                    label: \"Vectorize\",\r\n                    command: page.components.dialog.vectorize\r\n                }\r\n            },\r\n            summarize: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'summarize',\r\n                requiredAttributes: [\"objectId\"],\r\n                field: {\r\n                    label: \"Summarize\",\r\n                    command: page.components.dialog.summarize\r\n                }\r\n            },\r\n\r\n            /*\r\n            compressionType: {\r\n                layout : \"one\",\r\n                readOnly: true\r\n            },\r\n            \r\n            vaulted: {\r\n                layout: \"one\"\r\n            },\r\n            vaultId: {\r\n                layout: \"one\"\r\n            },\r\n            */\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            dataBytesStore: {\r\n                layout: \"full\",\r\n                label: \"Data\",\r\n                dragAndDrop: true,\r\n                format: \"contentType\"\r\n            }\r\n        },\r\n        //[\"name\", \"description\", \"createdDate\", \"modifiedDate\", \"expiryDate\", \"mimeType\", \"dataBytesStore\"],\r\n        forms: [\"groupdateinfo\", \"tags\", \"ctlattributes\", \"execute\"]\r\n    };\r\n\r\n\r\n    am7model.models.push({\r\n        name: \"summarizeSettings\",\r\n        icon: \"polyline\",\r\n        label: \"Settings\",\r\n        fields: [\r\n\r\n        {\r\n            \"name\": \"chat\",\r\n            \"label\": \"Chat Config\",\r\n            \"type\": \"list\",\r\n        },\r\n        {\r\n            \"name\": \"prompt\",\r\n            \"label\": \"Prompt Config\",\r\n            \"type\": \"list\",\r\n        },\r\n        {\r\n            name: \"chunkType\",\r\n            label: \"Chunk Type\",\r\n            type: 'string',\r\n            baseType: \"string\",\r\n            default: \"word\"\r\n        },\r\n        {\r\n            name: \"chunk\",\r\n            label: \"Chunk\",\r\n            type: 'int',\r\n            default: 25\r\n        }\r\n        ]\r\n    });\r\n\r\n    forms.summarizeSettings = {\r\n        label: \"Summarize Options\",\r\n        fields: {\r\n            chat: {\r\n                layout: 'third',\r\n               format: \"select\"\r\n            },\r\n            prompt: {\r\n                layout: 'third',\r\n               format: \"select\"\r\n            },\r\n            chunkType: {\r\n                layout: 'one',\r\n                label: 'Chunk Type',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['Sentence', 'Chapter', 'Word']\r\n                }\r\n            },\r\n            chunk: {\r\n                layout: 'one'\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n    forms.sdConfig = {\r\n        label: \"SD Config\",\r\n        fields: {\r\n            description: {\r\n                label: \"Description\",\r\n                layout: \"full\",\r\n                format: \"print\"\r\n            },\r\n            randomSeed: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'casino',\r\n                field: {\r\n                    label: \"Random\",\r\n                    command: undefined\r\n                }\r\n            },\r\n            seed:{\r\n                label: 'Seed',\r\n                layout: 'one'\r\n            },\r\n            /*\r\n            imageCount: {\r\n                label: 'Count',\r\n                layout: 'one'\r\n            },\r\n            */\r\n            hires: {\r\n                label: 'Hi-Res',\r\n                layout: 'one'\r\n            },\r\n            randomConfig: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'run_circle',\r\n                field: {\r\n                    label: \"New Config\",\r\n                    command: undefined\r\n                }\r\n            },\r\n            dressUp: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'add',\r\n                field: {\r\n                    label: \"Dress Up\",\r\n                    command: undefined\r\n                }\r\n            },\r\n            dressDown: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'remove',\r\n                field: {\r\n                    label: \"Dress Down\",\r\n                    command: undefined\r\n                }\r\n            },\r\n            /*\r\n            blank : {\r\n                layout : \"one\",\r\n                format: \"blank\",\r\n                field: {\r\n                    label: \"\",\r\n                    readOnly: true\r\n                }\r\n            },\r\n            */\r\n            bodyStyle: {\r\n                label: 'Composition',\r\n                layout: 'third'\r\n            },\r\n            imageAction: {\r\n                label: 'Action',\r\n                layout: 'third'\r\n            },\r\n            imageSetting: {\r\n                label: 'Setting',\r\n                layout: 'third'\r\n            },\r\n            style: {\r\n                layout: 'one',\r\n                label: 'Style',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['art', 'movie', 'photograph', 'selfie', 'anime', 'portrait', 'comic', 'digitalArt', 'fashion', 'vintage', 'custom']\r\n                }\r\n            },\r\n            artStyle: {\r\n                label: 'Art Style',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"art\"],\r\n            },\r\n            director: {\r\n                label: 'Director',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"movie\"],\r\n            },\r\n            photographer: {\r\n                label: 'Photographer',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"photograph|portrait|fashion\"],\r\n            },\r\n            selfiePhone: {\r\n                label: 'Phone',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"selfie\"],\r\n            },\r\n            selfieAngle: {\r\n                label: 'Angle',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"selfie\"],\r\n            },\r\n            selfieLighting: {\r\n                label: 'Lighting',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"selfie\"],\r\n            },\r\n            animeStudio: {\r\n                label: 'Studio',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"anime\"],\r\n            },\r\n            animeEra: {\r\n                label: 'Era',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"anime\"],\r\n            },\r\n            portraitLighting: {\r\n                label: 'Lighting',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"portrait\"],\r\n            },\r\n            portraitBackdrop: {\r\n                label: 'Backdrop',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"portrait\"],\r\n            },\r\n            comicPublisher: {\r\n                label: 'Publisher',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"comic\"],\r\n            },\r\n            comicEra: {\r\n                label: 'Era',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"comic\"],\r\n            },\r\n            comicColoring: {\r\n                label: 'Coloring',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"comic\"],\r\n            },\r\n            digitalMedium: {\r\n                label: 'Medium',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"digitalArt\"],\r\n            },\r\n            digitalSoftware: {\r\n                label: 'Software',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"digitalArt\"],\r\n            },\r\n            digitalArtist: {\r\n                label: 'Artist',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"digitalArt\"],\r\n            },\r\n            fashionMagazine: {\r\n                label: 'Magazine',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"fashion\"],\r\n            },\r\n            fashionDecade: {\r\n                label: 'Decade',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"fashion\"],\r\n            },\r\n            vintageDecade: {\r\n                label: 'Decade',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"vintage\"],\r\n            },\r\n            vintageProcessing: {\r\n                label: 'Processing',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"vintage\"],\r\n            },\r\n            vintageCamera: {\r\n                label: 'Camera',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"vintage\"],\r\n            },\r\n            customPrompt: {\r\n                label: 'Custom Style Prompt',\r\n                layout: 'full',\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"custom\"],\r\n            },\r\n\r\n            denoisingStrength: {\r\n                label: 'Denoising',\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            blank2 : {\r\n                layout : \"third\",\r\n                format: \"blank\",\r\n                field: {\r\n                    label: \"\",\r\n                    readOnly: true\r\n                }\r\n            },\r\n            stillCamera: {\r\n                label: 'Still Camera',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"photograph\"],\r\n            },\r\n            lens: {\r\n                label: 'Lens',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"photograph\"],\r\n            },\r\n            film: {\r\n                label: 'Film',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"photograph\"],\r\n            },\r\n            colorProcess: {\r\n                label: 'Process',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"movie|photograph\"],\r\n            },\r\n            movieCamera: {\r\n                label: 'Movie Camera',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"movie\"],\r\n            },\r\n            movieFilm: {\r\n                label: 'Movie Film',\r\n                layout: 'one',\r\n                referField: true,\r\n                requiredAttributes: [\"style\"],\r\n                requiredValues: [\"movie\"],\r\n            },\r\n            blank3: {\r\n                layout : \"half\",\r\n                format: \"blank\",\r\n                field: {\r\n                    label: \"\",\r\n                    readOnly: true\r\n                }\r\n            },\r\n            model: {\r\n                layout: 'third',\r\n                label: 'Model',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['juggernautXL_ragnarokBy.safetensors','dreamshaperXL_v21TurboDPMSDE','chilloutmix_Ni','realismFromHadesXL_lightningV3','realmixXL_V10.safetensors', 'lustifySDXLNSFW_endgame.safetensors', 'ponyRealism_V22.safetensors', 'sdXL_v10VAEFix']\r\n                }\r\n            },\r\n            steps: {\r\n                label: 'Steps',\r\n                layout: 'one'\r\n            },\r\n            refinerModel: {\r\n                layout: 'third',\r\n                label: 'Refiner Model',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['juggernautXL_ragnarokBy.safetensors','dreamshaperXL_v21TurboDPMSDE','chilloutmix_Ni','realismFromHadesXL_lightningV3','realmixXL_V10.safetensors', 'lustifySDXLNSFW_endgame.safetensors', 'ponyRealism_V22.safetensors', 'sdXL_v10VAEFix']\r\n                }\r\n            },\r\n            refinerSteps: {\r\n                label: 'Refiner Steps',\r\n                layout: 'one'\r\n            },\r\n            cfg: {\r\n                label: 'CFG',\r\n                layout: 'half',\r\n                format: 'range'\r\n            },\r\n            refinerCfg: {\r\n                label: 'Refiner CFG',\r\n                layout: 'half',\r\n                format: 'range'\r\n            \r\n            },\r\n            imageCount:{\r\n                label: \"Count\",\r\n                layout: \"one\"\r\n            },\r\n            shared: {\r\n                label: \"Use Shared\",\r\n                layout: 'one'\r\n            },\r\n            loadShared: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'open_in_new',\r\n                field: {\r\n                    label: \"Load Shared\",\r\n                    command: undefined\r\n                },\r\n                referField: true,\r\n                requiredAttributes: [\"shared\"],\r\n                requiredValues: [\"true\"],\r\n            },\r\n            selectReference: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'image',\r\n                field: {\r\n                    label: \"Reference\",\r\n                    command: undefined\r\n                }\r\n            },\r\n            createApparelSequence: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'apparel',\r\n                field: {\r\n                    label: \"Sequence\",\r\n                    command: undefined\r\n                }\r\n            }\r\n\r\n\r\n\r\n        }\r\n    };\r\n\r\n    /// SD config overrides form for cardGame deck builder\r\n    /// Renders core generation parameters via the standard form system.\r\n    forms.sdConfigOverrides = {\r\n        label: \"SD Config\",\r\n        fields: {\r\n            model: {\r\n                layout: 'third',\r\n                label: 'Model',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['juggernautXL_ragnarokBy.safetensors','dreamshaperXL_v21TurboDPMSDE','chilloutmix_Ni','realismFromHadesXL_lightningV3','realmixXL_V10.safetensors', 'lustifySDXLNSFW_endgame.safetensors', 'ponyRealism_V22.safetensors', 'sdXL_v10VAEFix.safetensors']\r\n                }\r\n            },\r\n            refinerModel: {\r\n                layout: 'third',\r\n                label: 'Refiner',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['juggernautXL_ragnarokBy.safetensors','dreamshaperXL_v21TurboDPMSDE','chilloutmix_Ni','realismFromHadesXL_lightningV3','realmixXL_V10.safetensors', 'lustifySDXLNSFW_endgame.safetensors', 'ponyRealism_V22.safetensors', 'sdXL_v10VAEFix.safetensors']\r\n                }\r\n            },\r\n            style: {\r\n                layout: 'one',\r\n                label: 'Style',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['art', 'movie', 'photograph', 'selfie', 'anime', 'portrait', 'comic', 'digitalArt', 'fashion', 'vintage', 'custom']\r\n                }\r\n            },\r\n            cfg: {\r\n                label: 'CFG',\r\n                layout: 'half',\r\n                format: 'range'\r\n            },\r\n            refinerCfg: {\r\n                label: 'Refiner CFG',\r\n                layout: 'half',\r\n                format: 'range'\r\n            },\r\n            steps: {\r\n                label: 'Steps',\r\n                layout: 'half',\r\n                format: 'range'\r\n            },\r\n            refinerSteps: {\r\n                label: 'Refiner Steps',\r\n                layout: 'half',\r\n                format: 'range'\r\n            },\r\n            hires: {\r\n                label: 'Hi-Res',\r\n                layout: 'one'\r\n            },\r\n            width: {\r\n                label: 'Width',\r\n                layout: 'half',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['512', '640', '768', '832', '896', '1024', '1152', '1280', '1536', '2048']\r\n                }\r\n            },\r\n            height: {\r\n                label: 'Height',\r\n                layout: 'half',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['512', '640', '768', '832', '896', '1024', '1152', '1280', '1536', '2048']\r\n                }\r\n            },\r\n            sampler: {\r\n                label: 'Sampler',\r\n                layout: 'half',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['dpmpp_2m', 'euler_a', 'euler', 'dpmpp_sde', 'ddim']\r\n                }\r\n            },\r\n            scheduler: {\r\n                label: 'Scheduler',\r\n                layout: 'half',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['Karras', 'Normal', 'Exponential']\r\n                }\r\n            },\r\n            denoisingStrength: {\r\n                label: 'Denoising',\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            bodyStyle: {\r\n                label: 'Composition',\r\n                layout: 'third'\r\n            },\r\n            imageSetting: {\r\n                label: 'Setting',\r\n                layout: 'third'\r\n            },\r\n            description: {\r\n                label: 'Prompt',\r\n                layout: 'full'\r\n            }\r\n        }\r\n    };\r\n\r\n    /// Simplified form for mannequin/apparel imaging - minimal controls\r\n    forms.sdMannequinConfig = {\r\n        label: \"Mannequin Config\",\r\n        fields: {\r\n            randomSeed: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'casino',\r\n                field: {\r\n                    label: \"Random\",\r\n                    command: undefined\r\n                }\r\n            },\r\n            seed:{\r\n                label: 'Seed',\r\n                layout: 'one'\r\n            },\r\n            hires: {\r\n                label: 'Hi-Res',\r\n                layout: 'one'\r\n            },\r\n            model: {\r\n                layout: 'one',\r\n                label: 'Model',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['juggernautXL_ragnarokBy.safetensors','dreamshaperXL_v21TurboDPMSDE','chilloutmix_Ni','realismFromHadesXL_lightningV3','realmixXL_V10.safetensors', 'lustifySDXLNSFW_endgame.safetensors', 'ponyRealism_V22.safetensors', 'sdXL_v10VAEFix']\r\n                }\r\n            },\r\n            steps: {\r\n                label: 'Steps',\r\n                layout: 'one'\r\n            },\r\n            refinerModel: {\r\n                layout: 'one',\r\n                label: 'Refiner',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['juggernautXL_ragnarokBy.safetensors','dreamshaperXL_v21TurboDPMSDE','chilloutmix_Ni','realismFromHadesXL_lightningV3','realmixXL_V10.safetensors', 'lustifySDXLNSFW_endgame.safetensors', 'ponyRealism_V22.safetensors', 'sdXL_v10VAEFix']\r\n                }\r\n            },\r\n            refinerSteps: {\r\n                label: 'Refiner Steps',\r\n                layout: 'one'\r\n            },\r\n            shared: {\r\n                label: \"Save Shared\",\r\n                layout: 'one'\r\n            },\r\n            loadShared: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'open_in_new',\r\n                field: {\r\n                    label: \"Load Shared\",\r\n                    command: undefined\r\n                },\r\n                referField: true,\r\n                requiredAttributes: [\"shared\"],\r\n                requiredValues: [\"true\"],\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.models.push(\r\n        {\r\n            name: \"vectorOptions\", icon: \"polyline\", fields: [\r\n                {\r\n                    name: \"chunkType\",\r\n                    label: \"Chunk Type\",\r\n                    type: 'string',\r\n                    baseType: \"string\",\r\n                    default: \"word\"\r\n                },\r\n                {\r\n                    name: \"chunk\",\r\n                    label: \"Chunk\",\r\n                    type: 'int',\r\n                    default: 25\r\n                }\r\n            ]\r\n        }\r\n    );\r\n\r\n    forms.vectorOptions = {\r\n        label: \"Vector Options\",\r\n        fields: {\r\n            chunkType: {\r\n                layout: 'one',\r\n                label: 'Chunk Type',\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['Sentence', 'Chapter', 'Word']\r\n                }\r\n            },\r\n            chunk: {\r\n                layout: 'one'\r\n            }\r\n        }\r\n    };\r\n\r\n    \r\n    am7model.models.push(\r\n        {\r\n            name: \"characterWizard\", icon: \"person\", fields: [\r\n                {\r\n                    name: \"firstName\",\r\n                    label: \"First Name\",\r\n                    type: 'string'\r\n                },\r\n                {\r\n                    name: \"middleName\",\r\n                    label: \"Middle Name\",\r\n                    type: 'string'\r\n                },\r\n                {\r\n                    name: \"lastName\",\r\n                    label: \"Last Name\",\r\n                    type: 'string'\r\n                },\r\n                {\r\n                    name: \"gender\",\r\n                    label: \"Gender\",\r\n                    type: 'string',\r\n                    default: \"male\"\r\n                },\r\n                {\r\n                    name: \"age\",\r\n                    label: \"Age\",\r\n                    type: 'int',\r\n                    default: 25\r\n                }\r\n            ]\r\n        }\r\n    );\r\n\r\n    forms.characterWizard = {\r\n        label: \"Character Wizard\",\r\n        fields: {\r\n            gender: {\r\n                layout: 'one',\r\n                field: {\r\n                    label: 'Gender',\r\n                    type: 'list',\r\n                    limit: ['male', 'female', 'random']\r\n                }\r\n            },\r\n            firstName: {\r\n                layout: 'one'\r\n            },\r\n            middleName: {\r\n                layout: 'one'\r\n            },\r\n            lastName: {\r\n                layout: 'one'\r\n            },\r\n            age: {\r\n                layout: 'one'\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n    am7model.models.push(\r\n        {\r\n            name: \"progress\", icon: \"pending\", fields: [\r\n                {\r\n                    name: \"label\",\r\n                    label: \"Label\",\r\n                    type: 'string'\r\n                },\r\n                {\r\n                    name: \"progress\",\r\n                    label: \"Progress\",\r\n                    type: 'int',\r\n                    minValue: 0,\r\n                    maxValue: 100\r\n                }\r\n            ]\r\n        }\r\n    );\r\n\r\n    forms.progress = {\r\n        label: \"Progress\",\r\n        fields: {\r\n            label: {\r\n                layout: 'third',\r\n                format: 'print'\r\n\r\n            },\r\n            progress: {\r\n                layout: 'two-thirds',\r\n                format: 'progress'\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.control = {\r\n        label: \"Control\",\r\n        fields: {\r\n            controlType: {\r\n                layout: \"one\"\r\n            },\r\n            action: {\r\n                layout: \"third\"\r\n            },\r\n            referenceType: {\r\n                layout: \"one\"\r\n            },\r\n            referenceId: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        //[\"name\", \"description\", \"createdDate\", \"modifiedDate\", \"expiryDate\", \"mimeType\", \"dataBytesStore\"],\r\n        forms: [\"info\"]\r\n    };\r\n\r\n    forms.info = {\r\n        label: \"Info\",\r\n        fields: {\r\n            uri: {\r\n                layout: \"full\"\r\n            },\r\n            urn: {\r\n                layout: \"third\"\r\n            },\r\n            objectId: {\r\n                layout: \"third\"\r\n            },\r\n            organizationPath: {\r\n                layout: \"third\"\r\n            }\r\n        }\r\n    }\r\n\r\n    forms.user = {\r\n        label: \"User\",\r\n        commands: {\r\n            fact: {\r\n                label: 'Fact',\r\n                icon: 'fact_check',\r\n                function: 'makeFact',\r\n                requiredAttribute: \"objectId\"\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            type: {\r\n                layout: \"third\"\r\n            },\r\n            status: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        forms: [\"info\", \"contactinfo\", \"tags\", \"reqattributes\"]\r\n    };\r\n\r\n\r\n    forms.person = {\r\n        label: \"Person\",\r\n        commands: {\r\n            fact: {\r\n                label: 'Fact',\r\n                icon: 'fact_check',\r\n                function: 'makeFact',\r\n                requiredAttribute: \"objectId\"\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            gender: {\r\n                layout: 'one',\r\n                field: {\r\n                    label: 'Gender',\r\n                    type: 'list',\r\n                    limit: ['male', 'female', 'unisex']\r\n                }\r\n            },\r\n            birthDate: {\r\n                layout: \"one\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            title: {\r\n                layout: \"third\"\r\n            },\r\n            prefix: {\r\n                layout: \"third\"\r\n            },\r\n            suffix: {\r\n                layout: \"third\"\r\n            },\r\n            firstName: {\r\n                layout: \"third\"\r\n            },\r\n            middleName: {\r\n                layout: \"third\"\r\n            },\r\n            lastName: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        forms: [\"contactinfo\", \"personrel\", \"groupinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.account = {\r\n        label: \"Account\",\r\n        commands: {\r\n            fact: {\r\n                label: 'Fact',\r\n                icon: 'fact_check',\r\n                function: 'makeFact',\r\n                requiredAttribute: \"objectId\"\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            type: {\r\n                layout: \"third\"\r\n            },\r\n            status: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        forms: [\"contactinfo\", \"groupinfo\", \"tags\", \"reqattributes\"]\r\n    };\r\n\r\n    forms.childlist = {\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                function: 'addChild',\r\n                properties: {\r\n                    picker: true\r\n                }\r\n            },\r\n            view: {\r\n                label: 'View',\r\n                icon: 'file_open',\r\n                function: 'openEntity',\r\n                condition: ['select']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteChild',\r\n                condition: ['select']\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            }\r\n        }\r\n    }\r\n\r\n    forms.entitylist2 = {\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                function: 'addEntity',\r\n                properties: {\r\n                    picker: true\r\n                }\r\n            },\r\n            view: {\r\n                label: 'View',\r\n                icon: 'file_open',\r\n                function: 'openEntity',\r\n                condition: ['select']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteEntity',\r\n                condition: ['select']\r\n            }\r\n        },\r\n        fields: {\r\n            objectId: {\r\n                layout: \"full\"\r\n            }\r\n        }\r\n    }\r\n\r\n    forms.entitylist = {\r\n        format: \"table\",\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                function: 'addEntity',\r\n                properties: {\r\n                    picker: true\r\n                }\r\n            },\r\n            view: {\r\n                label: 'View',\r\n                icon: 'file_open',\r\n                function: 'openEntity',\r\n                condition: ['select']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteEntity',\r\n                condition: ['select']\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            }\r\n        }\r\n    }\r\n\r\n    forms.memberlist = {\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                function: 'addMember',\r\n                properties: {\r\n                    picker: true\r\n                }\r\n            },\r\n            view: {\r\n                label: 'View',\r\n                icon: 'file_open',\r\n                function: 'openEntity',\r\n                condition: ['select']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteMember',\r\n                condition: ['select']\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            }\r\n        }\r\n    }\r\n\r\n    forms.memberlist2 = {\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                function: 'addMember',\r\n                properties: {\r\n                    picker: true\r\n                }\r\n            },\r\n            view: {\r\n                label: 'View',\r\n                icon: 'file_open',\r\n                function: 'openEntity',\r\n                condition: ['select']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteMember',\r\n                condition: ['select']\r\n            }\r\n        },\r\n        fields: {\r\n            objectId: {\r\n                layout: \"full\"\r\n            }\r\n        }\r\n    }\r\n\r\n    forms.contactinfo = {\r\n        label: \"Contact\",\r\n        requiredAttributes: [\"objectId\"],\r\n        model: true,\r\n        property: \"contactInformation\",\r\n        fields: {\r\n            contactInformation: {\r\n                layout: \"full\",\r\n                form: forms.contactInformation\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    forms.contactInformation = {\r\n        label: \"Contact\",\r\n        fields: {\r\n            contacts: {\r\n                layout: 'half',\r\n                format: \"table\",\r\n                form: forms.entitylist\r\n            },\r\n            addresses: {\r\n                layout: 'half',\r\n                format: \"table\",\r\n                form: forms.entitylist\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.address = {\r\n        label: \"Address\",\r\n        fields: {\r\n            name: {\r\n                layout: 'two-thirds',\r\n            },\r\n            locationType: {\r\n                layout: 'one'\r\n            },\r\n            preferred: {\r\n                layout: 'one'\r\n            },\r\n            street: {\r\n                layout: 'full'\r\n            },\r\n            street2: {\r\n                layout: 'full'\r\n            },\r\n            city: {\r\n                layout: 'third'\r\n            },\r\n            state: {\r\n                layout: 'third'\r\n            },\r\n            postalCode: {\r\n                layout: 'third'\r\n            },\r\n            country: {\r\n                layout: 'third'\r\n            }\r\n\r\n\r\n\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.contact = {\r\n        label: \"Contact\",\r\n        fields: {\r\n            name: {\r\n                layout: 'third'\r\n            },\r\n            contactType: {\r\n                layout: 'third'\r\n            },\r\n            locationType: {\r\n                layout: 'third'\r\n            },\r\n            preferred: {\r\n                layout: 'one'\r\n            },\r\n            contactValue: {\r\n                layout: 'fifth'\r\n            },\r\n            description: {\r\n                layout: 'full'\r\n            }\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.personrel = {\r\n        label: \"Relations\",\r\n        fields: {\r\n            partners: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            dependents: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            accounts: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            }\r\n        }\r\n    };\r\n    forms.role = {\r\n        label: \"Role\",\r\n        commands: {\r\n            fact: {\r\n                label: 'Fact',\r\n                icon: 'fact_check',\r\n                function: 'makeFact',\r\n                requiredAttribute: \"objectId\"\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            type: {\r\n                layout: \"half\"\r\n            }\r\n        },\r\n        forms: [\"parentinfo\", \"rolemembers\", \"attributes\"]\r\n    };\r\n\r\n    forms.permission = {\r\n        label: \"Permission\",\r\n        commands: {\r\n            fact: {\r\n                label: 'Fact',\r\n                icon: 'fact_check',\r\n                function: 'makeFact',\r\n                requiredAttribute: \"objectId\"\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            type: {\r\n                layout: \"half\"\r\n            }\r\n        },\r\n        forms: [\"parentinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.event = {\r\n        label: \"Event\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            parent: {\r\n                layout: \"third\"\r\n            },\r\n            location: {\r\n                layout: \"third\"\r\n            },\r\n            eventType: {\r\n                layout: \"third\"\r\n            },\r\n            startDate: {\r\n                layout: \"third\"\r\n            },\r\n            endDate: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            childEvents: {\r\n                layout: \"third\",\r\n                form: forms.childlist\r\n            },\r\n            entryTraits: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            exitTraits: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"eventpart\", \"eventobj\", \"grouptypeinfo\", \"attributes\"]\r\n    };\r\n    forms.eventpart = {\r\n        label: \"Participants\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            actors: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            orchestrators: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            influencers: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            observers: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            }\r\n\r\n        }\r\n    };\r\n    forms.eventobj = {\r\n        label: \"Objects\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            things: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            },\r\n            groups: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            }\r\n        }\r\n    };\r\n    forms.location = {\r\n        label: \"Location\",\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            geographyType: {\r\n                layout: \"one\"\r\n            },\r\n            latitude: {\r\n                layout: \"one\"\r\n            },\r\n            longitude: {\r\n                layout: \"one\"\r\n            },\r\n\r\n            classification: {\r\n                layout: \"half\"\r\n            },\r\n            parent: {\r\n                layout: \"half\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            }\r\n        },\r\n        forms: [\"locationrel\", \"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    /// TEMPORARY: Move this directly to the form config setting to override the model, versus modifying the model definition\r\n    ///\r\n    let parent = am7model.getModel(\"common.parent\");\r\n    parent.fields.push({\r\n        name: \"parent\",\r\n        label: \"Parent\",\r\n        type: \"string\",\r\n        format: \"picker\",\r\n        pickerType: \"self\",\r\n        pickerProperty: {\r\n            selected: \"id\",\r\n            entity: \"parentId\"\r\n        },\r\n        virtual: true,\r\n        ephemeral: true\r\n    });\r\n\r\n    forms.note = {\r\n        label: \"Note\",\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            parent: {\r\n                layout: \"half\"\r\n            },\r\n            createdDate: {\r\n                layout: \"third\"\r\n            },\r\n            modifiedDate: {\r\n                layout: \"third\"\r\n            },\r\n            vectorize: {\r\n                format: \"button\",\r\n                layout: \"third\",\r\n                icon: 'polyline',\r\n                requiredAttributes: [\"objectId\"],\r\n                field: {\r\n                    label: \"Vectorize\",\r\n                    command: page.components.dialog.vectorize\r\n                }\r\n            },\r\n            text: {\r\n                layout: \"full\",\r\n                format: \"textarea\"\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n    forms.trait = {\r\n        label: \"Trait\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            traitType: {\r\n                layout: \"third\"\r\n            },\r\n            alignment: {\r\n                layout: \"third\",\r\n                field:{\r\n                    label: \"Alignment\",\r\n                    type: \"list\",\r\n                    default: \"neutral\",\r\n                    \"limit\": [\"neutralevil\", \"lawfulevil\", \"chaoticevil\", \"chaoticneutral\", \"neutral\", \"lawfulneutral\", \"chaoticgood\", \"neutralgood\", \"lawfulgood\"]\r\n                }\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.tag = {\r\n        label: \"Tag\",\r\n        format: \"table\",\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                function: 'addMember',\r\n                properties: {\r\n                    picker: true\r\n                }\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteMember',\r\n                condition: ['select']\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            type: {\r\n                layout: \"half\"\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.tagattributes = {\r\n        label: \"Tags and Attributes\",\r\n        fields: {\r\n            attributes: {\r\n                layout: 'half',\r\n                form: forms.attribute\r\n            },\r\n            tags: {\r\n                layout: \"half\",\r\n                form: forms.tag\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.locationrel = {\r\n        label: \"Relation\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            childLocations: {\r\n                layout: \"third\",\r\n                form: forms.childlist\r\n            },\r\n            borders: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            boundaries: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            }\r\n        }\r\n    };\r\n    forms.notechildren = {\r\n        label: \"Children\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            childNotes: {\r\n                layout: \"full\",\r\n                form: forms.childlist\r\n            }\r\n        }\r\n    };\r\n    forms.eventObject = {\r\n        label: \"Events\",\r\n        commands: {\r\n            view: {\r\n                label: 'View',\r\n                icon: 'file_open',\r\n                function: 'openEntity',\r\n                condition: ['select']\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            schema: {\r\n                layout: \"half\"\r\n            }\r\n        }\r\n    };\r\n    forms.rolemember = {\r\n        label: \"Member\",\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                function: 'addMember',\r\n                properties: {\r\n                    picker: true,\r\n                    typeAttribute: 'type'\r\n                }\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteMember',\r\n                condition: ['select']\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            schema: {\r\n                layout: \"half\"\r\n            }\r\n            /*\r\n            roleType: {\r\n                layout : \"half\"\r\n            }\r\n            */\r\n        }\r\n    };\r\n\r\n    forms.rolemembers = {\r\n        label: \"Members\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            members: {\r\n                layout: 'half',\r\n                form: forms.rolemember\r\n                /*\r\n                field : {\r\n                    label : 'Members',\r\n                    name: \"members\",\r\n                    virtual : true,\r\n                    ephemeral: true,\r\n                    type : 'list',\r\n                    baseType: \"model\",\r\n                    baseModel : '$flex',\r\n                    foreignType: \"type\",\r\n                    function : 'objectMembers',\r\n                    typeAttribute : 'type',\r\n                    foreign : true,\r\n                    format : 'table'\r\n                }\r\n                */\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.eventtags = {\r\n        label: \"Events and Tags\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            tags: {\r\n                layout: 'one',\r\n                form: forms.tag\r\n            },\r\n            /*\r\n            events : {\r\n                layout : 'one',\r\n                form : forms.eventObject\r\n            },\r\n            */\r\n            actors: {\r\n                layout: 'one',\r\n                form: forms.eventObject\r\n            },\r\n            orchestrators: {\r\n                layout: 'one',\r\n                form: forms.eventObject\r\n            },\r\n            influencers: {\r\n                layout: 'one',\r\n                form: forms.eventObject\r\n            },\r\n            observers: {\r\n                layout: 'one',\r\n                form: forms.eventObject\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.tags = {\r\n        label: \"Tags\",\r\n        requiredAttributes: [],\r\n        format: \"table\",\r\n        fields: {\r\n            tags: {\r\n                layout: 'full',\r\n                form: forms.tag\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.group = {\r\n        label: \"Group\",\r\n        commands: {\r\n            fact: {\r\n                label: 'Fact',\r\n                icon: 'fact_check',\r\n                function: 'makeFact',\r\n                requiredAttribute: \"objectId\"\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            type: {\r\n                layout: \"half\"\r\n            }\r\n        },\r\n        //[\"name\", \"description\", \"createdDate\", \"modifiedDate\", \"expiryDate\", \"mimeType\", \"dataBytesStore\"],\r\n        forms: [\"parentinfo\", \"tags\", \"ctlattributes\"]\r\n    };\r\n\r\n    forms.form = {\r\n        label: \"Form\",\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            description: {\r\n                layout: \"half\"\r\n            },\r\n            isTemplate: {\r\n                layout: \"one\"\r\n            },\r\n            isGrid: {\r\n                layout: \"one\",\r\n                requiredAttributes: [\"isTemplate\"],\r\n                referField: true\r\n            },\r\n            viewTemplate: {\r\n                layout: \"third\",\r\n                requiredAttributes: [\"!isTemplate\"],\r\n                referField: true\r\n            },\r\n            template: {\r\n                layout: \"third\",\r\n                requiredAttributes: [\"!isTemplate\"],\r\n                referField: true\r\n            },\r\n            childForms: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            },\r\n            elements: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.formelement = {\r\n        label: \"Form Element\",\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            description: {\r\n                layout: \"half\"\r\n            },\r\n            elementName: {\r\n                layout: \"third\"\r\n            },\r\n            elementLabel: {\r\n                layout: \"third\"\r\n            },\r\n            elementType: {\r\n                layout: \"third\"\r\n            },\r\n            viewTemplate: {\r\n                layout: \"half\"\r\n            },\r\n            validationRule: {\r\n                layout: \"half\"\r\n            },\r\n            elementValues: {\r\n                layout: \"full\",\r\n                form: forms.elementValues,\r\n                requiredAttributes: [\"elementType\"],\r\n                requiredValues: [\"SELECT|MULTIPLE_SELECT\"],\r\n                referField: true\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.validationRule = {\r\n        label: \"Validation Rule\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            validationType: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"third\"\r\n            },\r\n            isRuleSet: {\r\n                layout: \"third\"\r\n            },\r\n            allowNull: {\r\n                layout: \"third\"\r\n            },\r\n            comparison: {\r\n                layout: \"third\",\r\n                requiredAttributes: [\"validationType\"],\r\n                referField: true,\r\n                requiredValues: [\"BOOLEAN\"],\r\n            },\r\n            expression: {\r\n                layout: \"third\"\r\n            },\r\n            replacementValue: {\r\n                layout: \"third\",\r\n                requiredAttributes: [\"validationType\"],\r\n                referField: true,\r\n                requiredValues: [\"REPLACEMENT\"],\r\n            },\r\n            errorMessage: {\r\n                layout: \"third\"\r\n            },\r\n            rules: {\r\n                layout: \"full\",\r\n                form: forms.entitylist,\r\n                requiredAttributes: [\"isRuleSet\"],\r\n                referField: true\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.policy = {\r\n        label: \"Policy Form\",\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            },\r\n            createdDate: {\r\n                layout: \"third\"\r\n            },\r\n            modifiedDate: {\r\n                layout: \"third\"\r\n            },\r\n            expiryDate: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            condition: {\r\n                layout: \"third\"\r\n            },\r\n            enabled: {\r\n                layout: \"one\"\r\n            },\r\n            decisionAge: {\r\n                layout: \"one\"\r\n            },\r\n            order: {\r\n                layout: \"one\"\r\n            },\r\n            score: {\r\n                layout: \"one\"\r\n            },\r\n            rules: {\r\n                layout: \"full\",\r\n                form: forms.entitylist,\r\n                requiredAttributes: [],\r\n                referField: true\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"evaluate\"]\r\n    };\r\n\r\n    forms.rule = {\r\n        label: \"Rule Form\",\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            ruleType: {\r\n                layout: \"third\"\r\n            },\r\n            condition: {\r\n                layout: \"third\"\r\n            },\r\n            score: {\r\n                layout: \"one\"\r\n            },\r\n            order: {\r\n                layout: \"one\"\r\n            },\r\n\r\n            rules: {\r\n                layout: \"half\",\r\n                form: forms.entitylist,\r\n                requiredAttributes: [],\r\n                referField: true\r\n            },\r\n\r\n            patterns: {\r\n                layout: \"half\",\r\n                form: forms.entitylist,\r\n                requiredAttributes: [],\r\n                referField: true\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.pattern = {\r\n        label: \"Pattern Form\",\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            type: {\r\n                layout: \"third\"\r\n            },\r\n            operation: {\r\n                layout: 'third',\r\n                format: 'picker',\r\n                label: \"Operation\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"policy.operation\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"operation\"\r\n                    }\r\n                }\r\n            },\r\n            score: {\r\n                layout: \"one\"\r\n            },\r\n            order: {\r\n                layout: \"one\"\r\n            },\r\n            fact: {\r\n                layout: 'third',\r\n                format: 'picker',\r\n                label: \"Fact\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"policy.fact\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"fact\"\r\n                    }\r\n                }\r\n            },\r\n            comparator: {\r\n                layout: \"third\"\r\n            },\r\n            match: {\r\n                layout: 'third',\r\n                format: 'picker',\r\n                label: \"Match\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"policy.fact\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"match\"\r\n                    }\r\n                }\r\n            },\r\n\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.fact = {\r\n        label: \"Fact Form\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            type: {\r\n                layout: \"third\"\r\n            },\r\n            score: {\r\n                layout: \"third\"\r\n            },\r\n\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            factType: {\r\n                layout: \"third\"\r\n            },\r\n            modelType: {\r\n                layout: \"third\"\r\n            },\r\n            sourceDataType: {\r\n                layout: \"third\"\r\n            },\r\n            sourceUrn: {\r\n                layout: \"third\"\r\n            },\r\n            sourceUrl: {\r\n                layout: \"third\"\r\n            },\r\n            factData: {\r\n                layout: \"third\"\r\n            },\r\n            promptConfig: {\r\n                layout: 'third',\r\n                format: 'picker',\r\n                field: {\r\n                format: 'picker',\r\n                pickerType: \"olio.llm.promptConfig\",\r\n                pickerProperty: {\r\n                    selected: \"{object}\",\r\n                    entity: \"promptConfig\"\r\n                },\r\n                label: \"Prompt Config\"\r\n                }\r\n            },\r\n            chatConfig: {\r\n                layout: 'third',\r\n                format: 'picker',\r\n                field: {\r\n                format: 'picker',\r\n                pickerType: \"olio.llm.chatConfig\",\r\n                pickerProperty: {\r\n                    selected: \"{object}\",\r\n                    entity: \"chatConfig\"\r\n                },\r\n                label: \"Chat Config\"\r\n                }\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.operation = {\r\n        label: \"Operation Form\",\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            score: {\r\n                layout: \"third\"\r\n            },\r\n            operationType: {\r\n                layout: \"third\"\r\n            },\r\n            operationrel: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n\r\n    forms.function = {\r\n        label: \"Fact Form\",\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            functionType: {\r\n                layout: \"third\"\r\n            },\r\n            order: {\r\n                layout: \"third\"\r\n            },\r\n            score: {\r\n                layout: \"third\"\r\n            },\r\n            sourceurnrel: {\r\n                layout: \"half\"\r\n            },\r\n            sourceUrl: {\r\n                layout: \"half\"\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n    am7model.models.push({ name: \"confirmation\", fields: [{ name: \"textData\", type: \"string\" }] });\r\n    forms.confirmation = {\r\n        label: \"Confirm\",\r\n        fields: {\r\n            textData: {\r\n                layout: \"full\"\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.models.push(\r\n        {\r\n            name: \"userProfile\", icon: \"work\", fields: [\r\n                {\r\n                    name: \"profilePortrait\",\r\n                    label: \"Portrait\",\r\n                    type: \"string\",\r\n                    format: \"picker\",\r\n                    pickerType: \"data.data\",\r\n                    pickerProperty: {\r\n                        selected: \"objectId\",\r\n                        entity: \"profilePortrait\",\r\n                        path: \"~/Gallery\"\r\n                    },\r\n                    virtual: true\r\n                }\r\n            ]\r\n        }\r\n    );\r\n    forms.userProfile = {\r\n        label: \"Profile\",\r\n        fields: {\r\n            profilePortrait: {\r\n                layout: 'full',\r\n                format: 'picker',\r\n                label: \"Portrait\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"data.data\",\r\n                    pickerProperty: {\r\n                        selected: \"objectId\",\r\n                        entity: \"profilePortrait\",\r\n                        path: \"~/Gallery\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        forms: []\r\n    };\r\n\r\n\r\n    forms.evaluaterel = {\r\n        label: \"Evaluate\",\r\n        requiredRoles: [\"scriptExecutor\"],\r\n        requiredAttributes: [\"objectId\"],\r\n        commands: {\r\n            exec: {\r\n                label: 'Evaluate',\r\n                icon: 'run_circle',\r\n                function: 'evaluate'\r\n            }\r\n        },\r\n        fields: {\r\n            evaluate: {\r\n                layout: \"full\"\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.evaluate = {\r\n        label: \"Evaluate\",\r\n        requiredRoles: [\"scriptExecutor\"],\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            evaluate: {\r\n                layout: \"full\",\r\n                form: forms.evaluaterel,\r\n                properties: {\r\n                    prepare: \"define\"\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.executerel = {\r\n        label: \"Execute\",\r\n        requiredRoles: [\"scriptExecutor\"],\r\n        requiredAttributes: [\"contentType\", \"objectId\"],\r\n        requiredValues: [\"application/x-javascript\"],\r\n        referField: true,\r\n        commands: {\r\n            exec: {\r\n                label: 'Execute',\r\n                icon: 'run_circle',\r\n                function: 'execute'\r\n            }\r\n        },\r\n        fields: {\r\n            execute: {\r\n                layout: \"full\"\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.execute = {\r\n        label: \"Execute\",\r\n        requiredRoles: [\"scriptExecutor\"],\r\n        requiredAttributes: [\"contentType\", \"objectId\"],\r\n        requiredValues: [\"application/x-javascript\"],\r\n        referField: true,\r\n        fields: {\r\n            execute: {\r\n                layout: \"full\",\r\n                form: forms.executerel\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    forms.cost = {\r\n        label: \"Cost\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            currencyType: {\r\n                layout: \"third\"\r\n            },\r\n            value: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.time = {\r\n        label: \"Time\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            basisType: {\r\n                layout: \"third\"\r\n            },\r\n            value: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.estimate = {\r\n        label: \"Estimate\",\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            estimateType: {\r\n                layout: \"half\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            time: {\r\n                layout: \"half\"\r\n            },\r\n            cost: {\r\n                layout: \"half\"\r\n            }\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\", \"tags\"]\r\n    };\r\n    forms.budget = {\r\n        label: \"Budget\",\r\n        fields: {\r\n            name: {\r\n                layout: \"half\"\r\n            },\r\n            budgetType: {\r\n                layout: \"half\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            time: {\r\n                layout: \"half\"\r\n            },\r\n            cost: {\r\n                layout: \"half\"\r\n            }\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.schedule = {\r\n        label: \"Schedule\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            startTime: {\r\n                layout: \"third\"\r\n            },\r\n            endTime: {\r\n                layout: \"third\"\r\n            },\r\n            goals: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\", \"tags\"]\r\n    };\r\n    forms.resource = {\r\n        label: \"Resource\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            resourceType: {\r\n                layout: \"third\"\r\n            },\r\n            resourceDataId: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            utilization: {\r\n                layout: \"third\"\r\n            },\r\n            estimate: {\r\n                layout: \"third\"\r\n            },\r\n            schedule: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\", \"ctlattributes\"]\r\n    };\r\n    forms.artifact = {\r\n        label: \"Artifact\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            createdDate: {\r\n                layout: \"third\"\r\n            },\r\n            artifactType: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            artifactDataId: {\r\n                layout: \"third\"\r\n            },\r\n            previousTransitionId: {\r\n                layout: \"third\"\r\n            },\r\n            nextTransitionId: {\r\n                layout: \"third\"\r\n            }\r\n\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.requirement = {\r\n        label: \"Requirement\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            requirementType: {\r\n                layout: \"third\"\r\n            },\r\n            requirementStatus: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            order: {\r\n                layout: \"third\"\r\n            },\r\n            note: {\r\n                layout: \"third\"\r\n            },\r\n            form: {\r\n                layout: \"third\"\r\n            }\r\n        },\r\n        forms: [\"groupinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n\r\n    forms.taskrel = {\r\n        label: \"Relationships\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            childTasks: {\r\n                layout: \"third\",\r\n                form: forms.childlist\r\n            },\r\n            actualCost: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            actualTime: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.taskacts = {\r\n        label: \"Activities\",\r\n        requiredAttributes: [\"objectId\"],\r\n        fields: {\r\n            requirements: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            dependencies: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            resources: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            artifacts: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            notes: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            work: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    forms.task = {\r\n        label: \"Task\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            parent: {\r\n                layout: \"third\"\r\n            },\r\n            taskStatus: {\r\n                layout: \"one\"\r\n            },\r\n            order: {\r\n                layout: \"one\"\r\n            },\r\n            startDate: {\r\n                layout: \"third\"\r\n            },\r\n            dueDate: {\r\n                layout: \"third\"\r\n            },\r\n            completedDate: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            }\r\n        },\r\n        forms: [\"taskrel\", \"taskacts\", \"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.ticket = {\r\n        label: \"Task\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            ticketStatus: {\r\n                layout: \"one\"\r\n            },\r\n            priority: {\r\n                layout: \"one\"\r\n            },\r\n            severity: {\r\n                layout: \"one\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            assignedResource: {\r\n                layout: \"third\"\r\n            },\r\n            estimate: {\r\n                layout: \"third\"\r\n            },\r\n            actualTime: {\r\n                layout: \"one\"\r\n            },\r\n            actualCost: {\r\n                layout: \"one\"\r\n            },\r\n            createdDate: {\r\n                layout: \"third\"\r\n            },\r\n            modifiedDate: {\r\n                layout: \"third\"\r\n            },\r\n            dueDate: {\r\n                layout: \"third\"\r\n            },\r\n            artifacts: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            dependencies: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            notes: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            requiredResources: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            forms: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            }\r\n\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.model = {\r\n        label: \"Model\",\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            cases: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            requirements: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            dependencies: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            artifacts: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            models: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.processstep = {\r\n        label: \"Process Step\",\r\n        fields: {\r\n            name: {\r\n                layout: \"two-thirds\"\r\n            },\r\n            order: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            goals: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            budgets: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            requirements: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.process = {\r\n        label: \"Process\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            order: {\r\n                layout: \"third\"\r\n            },\r\n            iterates: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            steps: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            },\r\n            budgets: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.methodology = {\r\n        label: \"Methodology\",\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            processes: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            },\r\n            budgets: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.goal = {\r\n        label: \"Goal\",\r\n        fields: {\r\n            name: {\r\n                layout: \"two-thirds\"\r\n            },\r\n            order: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            budget: {\r\n                layout: \"third\"\r\n            },\r\n            schedule: {\r\n                layout: \"third\"\r\n            },\r\n            assigned: {\r\n                layout: \"third\"\r\n            },\r\n            requirements: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            dependencies: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            cases: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n    forms.case = {\r\n        label: \"Case\",\r\n        fields: {\r\n            name: {\r\n                layout: \"two-thirds\"\r\n            },\r\n            caseType: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            actors: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            prerequisites: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            sequence: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            diagrams: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.module = {\r\n        label: \"Module\",\r\n        fields: {\r\n            name: {\r\n                layout: \"two-thirds\"\r\n            },\r\n            moduleType: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            time: {\r\n                layout: \"half\"\r\n            },\r\n            cost: {\r\n                layout: \"half\"\r\n            },\r\n            artifacts: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            },\r\n            work: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.lifecycle = {\r\n        label: \"Lifecycle\",\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            goals: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            schedules: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            budgets: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            projects: {\r\n                layout: \"half\",\r\n                form: forms.entitylist\r\n            }\r\n\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.project = {\r\n        label: \"Project\",\r\n        fields: {\r\n            name: {\r\n                layout: \"two-thirds\"\r\n            },\r\n            schedule: {\r\n                layout: \"third\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            requirements: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            modules: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            stages: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"projectassets\", \"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.projectassets = {\r\n        label: \"Assets\",\r\n        fields: {\r\n            dependencies: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            artifacts: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            blueprints: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            }\r\n        }\r\n    };\r\n    forms.work = {\r\n        label: \"Work\",\r\n        fields: {\r\n            name: {\r\n                layout: \"full\"\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            tasks: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            resources: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            dependencies: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            },\r\n            artifacts: {\r\n                layout: \"one\",\r\n                form: forms.entitylist\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n\r\n    forms.stage = {\r\n        label: \"Stage\",\r\n        fields: {\r\n            name: {\r\n                layout: \"two-thirds\"\r\n            },\r\n            order: {\r\n                layout: \"third\",\r\n            },\r\n            description: {\r\n                layout: \"full\"\r\n            },\r\n            schedule: {\r\n                layout: \"half\"\r\n            },\r\n            methodology: {\r\n                layout: \"half\"\r\n            },\r\n            work: {\r\n                layout: \"half\"\r\n            },\r\n            budget: {\r\n                layout: \"half\"\r\n            }\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\", \"tags\"]\r\n    };\r\n    \r\n    async function cleanupTestVoice(data){\r\n        page.toast(\"info\", \"Cleaning up test voice data for \" + data.objectId);\r\n        await page.deleteObject(data[am7model.jsonModelKey], data.objectId);\r\n    }\r\n\r\n    async function testVoice(object, inst, name) {\r\n        let refId = \"Test Voice - \" + page.uid();\r\n        let cnt = inst.api.sampleText() || \"Hello, this is a test of the voice synthesis system.\";\r\n        let vprops = {\"text\": cnt, \"speed\": 1.2, engine: inst.api.engine(), speaker: inst.api.speaker(), speaker_id: inst.api.speakerId()};\r\n        if(inst.api.engine() == \"xtts\" && inst.api.voiceSample()){\r\n            let sinst = am7model.newInstance(\"data.data\");\r\n            let q = am7client.newQuery(\"data.data\");\r\n            q.entity.request = am7view.viewFields(sinst);\r\n            q.field(\"organizationId\", page.user.organizationId);\r\n            q.field(\"objectId\", inst.api.voiceSample().objectId);\r\n            let sdr = await page.search(q);\r\n            let sd;\r\n            if(sdr && sdr.results && sdr.results.length > 0){\r\n                sd = sdr.results[0];\r\n            }\r\n            \r\n            if(!sd || !sd.dataBytesStore || sd.dataBytesStore.length == 0){\r\n                page.toast(\"error\", \"No voice sample data found for \" + inst.api.voiceSample().objectId);\r\n                return;\r\n            }\r\n            vprops.voice_sample = sd.dataBytesStore;\r\n        }\r\n        \r\n        let d = await m.request({method: 'POST', url: g_application_path + \"/rest/voice/\" + refId, withCredentials: true, body: vprops});\r\n        inst.api.sampleAudio(d);\r\n        if(d){\r\n            page.toast(\"success\", \"Voice synthesis test successful\");\r\n            /// If there is already an audio component, then update it:\r\n            let aud = document.querySelector(\"#sampleAudio\");\r\n            if(aud){\r\n                let apath = g_application_path + \"/media/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + d.groupPath + \"/\" + d.name;\r\n                let amt = d.contentType;\r\n                if (amt.match(/mpeg3$/)) amt = \"audio/mpeg\";\r\n                aud.src = apath;\r\n            }\r\n            setTimeout(() => {cleanupTestVoice(d);}, 20000);\r\n        }\r\n        else{\r\n            page.toast(\"error\", \"Voice synthesis test failed\");\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    async function pickProfile(object, inst, name) {\r\n        //console.log(\"~/GalleryHome/Characters/\" + inst.api.name());\r\n        //inst.change(\"portrait\");\r\n        //inst.change(\"profile\");\r\n        // \" + inst.api.name()\r\n        //console.warn(\"Need to update profile.portrait after picking, and/or fix the child object property not being updated\");\r\n        let n = \"\";\r\n        let p = object.caller();\r\n        let np = \"\";\r\n        //console.log(p.getInstance()?.entity?.groupPath);\r\n        if (p && p.getInstance()?.entity?.name) {\r\n            let pe = p.getInstance().entity;\r\n            let gp = \"/Gallery\";\r\n            let tp = pe.groupPath.substring(0, pe.groupPath.lastIndexOf(\"/\"));\r\n\r\n            n = \"/\" + pe.name;\r\n            np = tp + gp + \"/Characters\" + n;\r\n        }\r\n        /// \"~/GalleryHome/Characters\" + n\r\n        //page.components.picker.fieldPicker(inst, inst.formField(\"portrait\")?.field, undefined, undefined, np, function (objectPage, inst, field, useName, data) {\r\n        object.picker(inst.formField(\"portrait\")?.field, undefined, undefined, np, function (objectPage, inst, field, useName, data) {\r\n            if (p && p.getInstance()?.entity?.profile) {\r\n                let od = {id: p.getInstance().entity.profile.id, portrait: {id: data.id}};\r\n                p.getInstance().entity.profile.portrait = data;\r\n                od[am7model.jsonModelKey] = \"identity.profile\";\r\n                page.patchObject(od);\r\n               \r\n            }\r\n        });\r\n    };\r\n\r\n      async function pickVoice(object, inst, name) {\r\n        let n = \"\";\r\n        let p = object.caller();\r\n        let np = \"\";\r\n        if (p && p.getInstance()?.entity?.name) {\r\n            let pe = p.getInstance().entity;\r\n            let gp = \"/Voices\";\r\n            let tp = pe.groupPath.substring(0, pe.groupPath.lastIndexOf(\"/\"));\r\n            np = tp + gp;\r\n        }\r\n        console.info(inst.formField(\"voice\"));\r\n        object.picker(inst.formField(\"voice\")?.field, undefined, undefined, np, function (objectPage, inst, field, useName, data) {\r\n            if (p && p.getInstance()?.entity?.profile) {\r\n                let od = {id: p.getInstance().entity.profile.id, voice: {id: data.id}};\r\n                p.getInstance().entity.profile.voice = data;\r\n                od[am7model.jsonModelKey] = \"identity.voice\";\r\n                page.patchObject(od);\r\n               \r\n            }\r\n        });\r\n    };\r\n \r\n\r\n\r\n\r\n\r\n    async function narrate(object, inst) {\r\n        if (!inst || inst.model.name != \"olio.charPerson\") {\r\n            page.toast(\"warn\", \"Invalid object instance\");\r\n            return;\r\n        }\r\n        page.toast(\"info\", \"Updating narrative ...\");\r\n        let x = await m.request({ method: 'GET', url: am7client.base() + \"/olio/\" + inst.model.name + \"/\" + inst.api.objectId() + \"/narrate\", withCredentials: true });\r\n        if (x && x != null) {\r\n            inst.api.narrative(x);\r\n            page.toast(\"success\", \"Updated narrative\");\r\n        }\r\n        else{\r\n            page.toast(\"error\", \"Failed to update narrative\");\r\n        }\r\n    }\r\n\r\n    async function character(name, gender, age, race, profUrl, op){\r\n\r\n        let obj = await am7model.forms.commands.rollCharacter(undefined, undefined, gender);\r\n        obj.age = age;\r\n        obj.race = [race];\r\n        if(name && name.length > 0) {\r\n            obj.name = name;\r\n            let nms = name.split(\" \");\r\n            if(nms.length){\r\n                obj.firstName = nms[0];\r\n                obj.lastName = nms[nms.length - 1];\r\n                if(nms.length > 2){\r\n                    obj.middleName = nms[1];\r\n                }\r\n                else obj.middleName = null;\r\n            }\r\n            else{\r\n                obj.firstName = name;\r\n                obj.middleName = null;\r\n                obj.lastName = null;\r\n            }\r\n        }\r\n\r\n        let char = await createCharacter(obj, profUrl);\r\n        if(op && char.objectId){\r\n            m.route.set(\"/view/\" + char[am7model.jsonModelKey] + \"/\" + char.objectId);\r\n        }\r\n        return char;\r\n\r\n    }\r\n    \r\n    async function createCharacter(obj, profUrl){\r\n        if(!obj){\r\n            obj = await am7model.forms.commands.rollCharacter();\r\n        }\r\n\r\n        let cdir = await page.makePath(\"auth.group\", \"data\", \"~/Characters\");\r\n        let char = await page.searchFirst(\"olio.charPerson\", cdir.id, obj.name); \r\n\r\n        if(char == null){\r\n            \r\n            let charN = am7model.prepareEntity(obj, \"olio.charPerson\", true);\r\n            let w = charN.store.apparel[0].wearables;\r\n            for(let i = 0; i < w.length; i++){\r\n                w[i] = am7model.prepareEntity(w[i], \"olio.wearable\", false);\r\n                w[i].qualities[0] = am7model.prepareEntity(w[i].qualities[0], \"olio.quality\", false);\r\n            }\r\n    \r\n            char = await page.createObject(charN);\r\n    \r\n            if(char != null){\r\n                char = await page.searchFirst(\"olio.charPerson\", cdir.id, obj.name); \r\n                if(char == null){\r\n                    console.error(\"Failed to find character\", cdir.id, obj.name);\r\n                    return null;\r\n                }\r\n            }\r\n            else{\r\n                console.error(\"Failed to create character \" + obj.name, char);\r\n                return null;\r\n            }\r\n        }\r\n        if(char == null){\r\n            console.error(\"Character is null\", char);\r\n            return null;\r\n        }\r\n        if(!char.profile.portrait){\r\n\r\n            let dir = await page.makePath(\"auth.group\", \"data\", \"~/Gallery\");\r\n            if(!profUrl){\r\n                profUrl = \"/media/\" + char.gender + \"Silhouette.png\";\r\n            }\r\n            let datName = profUrl.substring(profUrl.lastIndexOf(\"/\") + 1);\r\n            let img;\r\n            try{\r\n                img = await page.openObjectByName(\"data.data\", dir.objectId, datName);\r\n            }\r\n            catch(e){\r\n                console.warn(e);\r\n            }\r\n            if(!img){\r\n                img = am7model.newInstance(\"data.data\").entity;\r\n                img.groupPath = dir.path;\r\n                img.name = datName;\r\n                img.contentType = \"image/png\";\r\n                img.dataBytesStore = await getProfUrl(profUrl);\r\n                img = await page.createObject(img);\r\n            }\r\n\r\n            char.profile.portrait = {id: img.id};\r\n            await page.patchObject(char.profile);\r\n        }\r\n        let inst = am7model.prepareInstance(char);\r\n        await am7model.forms.commands.narrate(undefined, inst);\r\n        return char;\r\n    }\r\n    async function getProfUrl(url){\r\n    \r\n        let x;\r\n        try{\r\n            x = await m.request({ method: 'GET', responseType: 'blob', url});\r\n        }\r\n        catch(e){\r\n            console.error(\"Error loading \" + url);\r\n        }\r\n        return new Promise((res, rej) => {\r\n            if(!x){\r\n                rej()\r\n            }\r\n            else{\r\n                var reader = new FileReader();\r\n                reader.onloadend = function() {\r\n                       res(reader.result.split(',', 2)[1]);\r\n                }\r\n                reader.readAsDataURL(x);\r\n            }\r\n        });\r\n    }\r\n\r\n    function characterWizard(){\r\n\r\n            let entity = am7model.newPrimitive(\"characterWizard\");\r\n            let cfg = {\r\n                label: \"Character Wizard\",\r\n                entityType: \"characterWizard\",\r\n                size: 50,\r\n                data: {entity},\r\n                confirm: async function (data) {\r\n                    page.toast(\"info\", \"Generating ...\");\r\n                    let o = data.entity;\r\n                    let name = o.firstName;\r\n                    if(o.middleName && o.middleName.length) name += \" \" + o.middleName;\r\n                    if(o.lastName && o.lastName.length) name += \" \" + o.lastName;\r\n                    await character(name, (o.gender == 'random' ? undefined : o.gender), o.age, \"E\", undefined, true);\r\n                    page.components.dialog.endDialog();\r\n                },\r\n                cancel: async function (data) {\r\n                    page.components.dialog.endDialog();\r\n                }\r\n            };\r\n            page.components.dialog.setDialog(cfg);\r\n        \r\n\r\n    }\r\n\r\n    async function rollCharacter(object, inst, gender) {\r\n        let x = await m.request({ method: 'GET', url: am7client.base() + \"/olio/roll\" + (gender ? \"/\" + gender : \"\"), withCredentials: true });\r\n        if (x && x != null) {\r\n            if(object){\r\n                object.mergeEntity(x);\r\n            }\r\n        }\r\n        return x;\r\n    }\r\n    async function getSystemPrompt(object, inst) {\r\n        if (!inst) {\r\n            return;\r\n        }\r\n        let x = await m.request({ method: 'GET', url: am7client.base() + \"/chat/prompt\", withCredentials: true });\r\n        if (x && x != null) {\r\n            object.mergeEntity(x);\r\n        }\r\n    }\r\n\r\n    forms.color = {\r\n        label: \"Color\",\r\n        fields: {\r\n            name: {\r\n                layout: \"third\"\r\n            },\r\n            hex: {\r\n                layout: \"one\",\r\n                format: \"color\"\r\n            },\r\n            red: {\r\n                layout: \"one\",\r\n                readOnly: true\r\n            },\r\n            green: {\r\n                layout: \"one\",\r\n                readOnly: true\r\n            },\r\n            blue: {\r\n                layout: \"one\",\r\n                readOnly: true\r\n            }\r\n\r\n\r\n        },\r\n        forms: [\"lightgroupinfo\"]\r\n    };\r\n\r\n    forms.charPerson = {\r\n        label: \"Character\",\r\n        commands: {\r\n            reimage: {\r\n                label: 'Reimage',\r\n                icon: 'auto_awesome',\r\n                function: 'reimage',\r\n                requiredAttribute: \"objectId\"\r\n            },\r\n            outfitBuilder: {\r\n                label: 'Outfit Builder',\r\n                icon: 'checkroom',\r\n                function: 'showOutfitBuilder',\r\n                requiredAttribute: \"objectId\"\r\n            },\r\n            startGame: {\r\n                label: 'Start Game',\r\n                icon: 'sports_esports',\r\n                function: 'startGameWithCharacter',\r\n                requiredAttribute: \"objectId\"\r\n            },\r\n            adoptCharacter: {\r\n                label: 'Adopt to World',\r\n                icon: 'person_add',\r\n                function: 'adoptCharacter',\r\n                requiredAttribute: \"objectId\"\r\n            }\r\n        },\r\n        fields: {\r\n            profile: {\r\n                layout: \"one\",\r\n                field: {\r\n                    label: \"Profile\"\r\n                },\r\n                format: \"image\"\r\n            },\r\n            name: {\r\n                layout: \"one\"\r\n            },\r\n            firstName: {\r\n                layout: \"one\"\r\n            },\r\n            middleName: {\r\n                layout: \"one\"\r\n            },\r\n            lastName: {\r\n                layout: \"one\"\r\n            },\r\n            gender: {\r\n                layout: 'one',\r\n                field: {\r\n                    label: 'Gender',\r\n                    type: 'list',\r\n                    limit: ['male', 'female', 'unisex']\r\n                }\r\n            },\r\n\r\n            eyeColor: {\r\n                layout: 'one',\r\n                format: 'picker',\r\n                label: \"Eye Color\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"data.color\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"eyeColor\"\r\n                    }\r\n                }\r\n            },\r\n            hairColor: {\r\n                layout: 'one',\r\n                format: 'picker',\r\n                label: \"Hair Color\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"data.color\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"hairColor\"\r\n                    }\r\n                }\r\n\r\n            },\r\n            hairStyle: {\r\n                layout: 'one'\r\n            },\r\n            birthDate: {\r\n                layout: \"one\"\r\n            },\r\n            age: {\r\n                layout: \"one\"\r\n            },\r\n            alignment: {\r\n                layout: \"one\",\r\n                field:{\r\n                    label: \"Alignment\",\r\n                    type: \"list\",\r\n                    default: \"neutral\",\r\n                    \"limit\": [\"neutralevil\", \"lawfulevil\", \"chaoticevil\", \"chaoticneutral\", \"neutral\", \"lawfulneutral\", \"chaoticgood\", \"neutralgood\", \"lawfulgood\"]\r\n                }\r\n            },\r\n\r\n            /*\r\n            blank : {\r\n                layout : \"full\",\r\n                format: \"blank\",\r\n                field: {\r\n                    label: \"\",\r\n                    readOnly: true\r\n                }\r\n            },\r\n            */\r\n            /*\r\n             pickProfile: {\r\n                 format: \"button\",\r\n                 layout: \"one\",\r\n                 icon: 'run_circle',\r\n                 requiredAttributes : [\"objectId\"],\r\n                 field: {\r\n                     label: \"Pick Profile\",\r\n                     command: pickProfile\r\n                 }\r\n             },\r\n             */\r\n            narrate: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'run_circle',\r\n                requiredAttributes: [\"objectId\"],\r\n                field: {\r\n                    label: \"Narrate\",\r\n                    command: narrate\r\n                }\r\n            },\r\n            vectorize: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'polyline',\r\n                requiredAttributes: [\"objectId\"],\r\n                field: {\r\n                    label: \"Vectorize\",\r\n                    command: page.components.dialog.vectorize\r\n                }\r\n            },\r\n            blank: {\r\n                layout: \"one\",\r\n                format: \"blank\",\r\n                field: {\r\n                    label: \"\",\r\n                    readOnly: true\r\n                }\r\n            },\r\n\r\n            /*\r\n            roll: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'run_circle',\r\n                requiredAttributes: [\"!objectId\"],\r\n                field: {\r\n                    label: \"Roll\",\r\n                    command: rollCharacter\r\n                }\r\n            },\r\n            */\r\n            summarize: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'summarize',\r\n                requiredAttributes: [\"objectId\"],\r\n                field: {\r\n                    label: \"Summarize\",\r\n                    command: page.components.dialog.summarize\r\n                }\r\n            },\r\n            description: {\r\n                layout: \"full\",\r\n            },\r\n            trades: {\r\n                layout: \"third\",\r\n                format: \"textlist\"\r\n            },\r\n            race: {\r\n                layout: \"third\",\r\n                format: \"textlist\"\r\n            },\r\n            ethnicity: {\r\n                layout: \"third\",\r\n                format: \"textlist\"\r\n            }\r\n        },\r\n        forms: [\"personalityRef\", \"statisticsRef\", \"storeRef\", \"narrativeRef\", \"profileRef\", \"groupinfo\", \"tagattributes\"]\r\n    };\r\n\r\n    forms.storeRef = {\r\n        label: \"Store\",\r\n        model: true,\r\n        property: \"store\",\r\n        fields: {\r\n            store: {\r\n                layout: \"full\",\r\n                form: forms.store\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    forms.store = {\r\n        label: \"Store\",\r\n        fields: {\r\n            apparel: {\r\n                layout: 'half',\r\n                format: \"table\",\r\n                form: forms.entitylist\r\n            },\r\n            items: {\r\n                layout: 'half',\r\n                format: \"table\",\r\n                form: forms.entitylist\r\n            }\r\n        }\r\n    };\r\n\r\n    let apparel = am7model.getModel(\"olio.apparel\");\r\n    apparel.fields.push({\r\n        name: \"designerRef\",\r\n        label: \"Designer\",\r\n        type: \"string\",\r\n        format: \"picker\",\r\n        pickerType: \"olio.charPerson\",\r\n        pickerProperty: {\r\n            selected: \"id\",\r\n            entity: \"designer\"\r\n        },\r\n        virtual: true,\r\n        ephemeral: true\r\n    });\r\n    forms.apparel = {\r\n        label: \"Apparel\",\r\n        commands: {\r\n            reimage: {\r\n                label: 'Reimage',\r\n                icon: 'auto_awesome',\r\n                function: 'reimageApparel',\r\n                requiredAttribute: \"objectId\"\r\n            }\r\n        },\r\n        fields: {\r\n            name: {\r\n                layout: 'half'\r\n            },\r\n            type: {\r\n                layout: 'one'\r\n            },\r\n            category: {\r\n                layout: 'one'\r\n            },\r\n            gender: {\r\n                layout: 'one',\r\n                field: {\r\n                    label: 'Gender',\r\n                    type: 'list',\r\n                    limit: ['male', 'female', 'unisex']\r\n                }\r\n            },\r\n            inuse: {\r\n                layout: 'one'\r\n            },\r\n            designerRef: {\r\n                layout: 'one'\r\n            },\r\n            manufacturer: {\r\n                layout: 'one'\r\n            },\r\n            dressUp: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'add',\r\n                field: {\r\n                    label: \"Dress Up\",\r\n                    command: am7olio.dressUp\r\n                }\r\n            },\r\n            dressDown: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'remove',\r\n                field: {\r\n                    label: \"Dress Down\",\r\n                    command: am7olio.dressDown\r\n                }\r\n            },\r\n            description: {\r\n                layout: 'full'\r\n            },\r\n            wearables: {\r\n                layout: 'half',\r\n                format: \"table\",\r\n                form: forms.entitylist\r\n            },\r\n            gallery: {\r\n                layout: 'half',\r\n                format: 'gallery',\r\n\r\n                field: {\r\n                    label: 'Gallery',\r\n                    promise: true,\r\n                    function: 'loadApparelGallery'\r\n                }\r\n            }\r\n        },\r\n        query: [\"gallery\"],\r\n        forms: [\"lightgroupinfo\"]\r\n    };\r\n\r\n    forms.quality = {\r\n        label: \"Quality\",\r\n        fields: {\r\n            unit: {\r\n                layout: 'one'\r\n            },\r\n            valueAdjustment: {\r\n                layout: 'one'\r\n            },\r\n            width: {\r\n                layout: 'one'\r\n            },\r\n            height: {\r\n                layout: 'one'\r\n            },\r\n            weight: {\r\n                layout: 'one'\r\n            },\r\n            length: {\r\n                layout: 'one'\r\n            },\r\n            opacity: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            elasticity: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            glossiness: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            viscocity: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            sliminess: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            blank: {\r\n                layout: \"one\",\r\n                format: \"blank\",\r\n                field: {\r\n                    label: \"\",\r\n                    readOnly: true\r\n                }\r\n            },\r\n            smoothness: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            hardness: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            toughness: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            defensive: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            offensive: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            range: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            waterresistance: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            heatresistance: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            insulation: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            skill: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            }\r\n        },\r\n        forms: [\"lightgroupinfo\"]\r\n    };\r\n\r\n    forms.item = {\r\n        label: \"Item\",\r\n        fields: {\r\n            name: {\r\n                layout: 'third'\r\n            },\r\n            quality: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            category: {\r\n                layout: 'one'\r\n            },\r\n            type: {\r\n                layout: 'one'\r\n            },\r\n            inuse: {\r\n                layout: 'one'\r\n            },\r\n            qualities: {\r\n                layout: 'half',\r\n                format: 'table',\r\n                form: forms.entitylist2\r\n\r\n            }\r\n        },\r\n        forms: [\"itemStatisticsRef\", \"lightgroupinfo\"]\r\n    };\r\n\r\n    forms.wearable = {\r\n        label: \"Wearable\",\r\n        fields: {\r\n            name: {\r\n                layout: 'third'\r\n            },\r\n            level: {\r\n                layout: 'third',\r\n                label: \"Level\",\r\n                field: {\r\n                    type: \"list\",\r\n                    limit: [\"NONE\", \"INTERNAL\", \"UNDER\", \"ON\", \"BASE\", \"ACCENT\", \"SUIT\", \"GARNITURE\", \"ACCESSORY\", \"OVER\", \"OUTER\", \"FULL_BODY\", \"ENCLOSURE\", \"UNKNOWN\"],\r\n                    default: \"BASE\"\r\n                }\r\n            },\r\n            gender: {\r\n                layout: 'third',\r\n                field: {\r\n                    label: 'Gender',\r\n                    type: 'list',\r\n                    limit: ['male', 'female', 'unisex']\r\n                }\r\n            },\r\n            category: {\r\n                layout: 'one',\r\n                label: \"Category\",\r\n                field: {\r\n                    default: \"clothing\"\r\n                }\r\n            },\r\n            fabric: {\r\n                label: \"Fabric\",\r\n                layout: 'one'\r\n            },\r\n            color: {\r\n                layout: 'third',\r\n                format: 'picker',\r\n                label: \"Color\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"data.color\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"color\"\r\n                    }\r\n                }\r\n            },\r\n            pattern: {\r\n                layout: 'one',\r\n                format: 'picker',\r\n                label: \"Pattern\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"data.data\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"pattern\"\r\n                    }\r\n                }\r\n            },\r\n\r\n            inuse: {\r\n                layout: 'one'\r\n            },\r\n            qualities: {\r\n                layout: 'half',\r\n                format: 'table',\r\n                autocreate: true,\r\n                form: forms.entitylist2\r\n            },\r\n            location: {\r\n                layout: \"half\",\r\n                format: \"textlist\"\r\n            }\r\n\r\n\r\n        },\r\n        forms: [\"lightgroupinfo\"]\r\n    };\r\n    forms.itemStatisticsRef = {\r\n        label: \"Statistics\",\r\n        model: true,\r\n        property: \"statistics\",\r\n        fields: {\r\n            statistics: {\r\n                layout: \"full\",\r\n                form: forms.itemStatistics\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    forms.itemStatistics = {\r\n        label: \"Statistics\",\r\n        fields: {\r\n            damage: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            protection: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            range: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.statisticsRef = {\r\n        label: \"Statistics\",\r\n        model: true,\r\n        property: \"statistics\",\r\n        fields: {\r\n            statistics: {\r\n                layout: \"full\",\r\n                form: forms.statistics\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n    forms.statistics = {\r\n        label: \"Statistics\",\r\n        fields: {\r\n            physicalStrength: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            physicalEndurance: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            manualDexterity: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            agility: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            speed: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            mentalStrength: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            mentalEndurance: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            intelligence: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            wisdom: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            perception: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            creativity: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            spirituality: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            charisma: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            luck: {\r\n                layout: 'one',\r\n                format: 'range'\r\n            },\r\n            magic: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                readOnly: true\r\n            },\r\n            science: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                readOnly: true\r\n            },\r\n            willpower: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                readOnly: true\r\n            },\r\n            reaction: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                readOnly: true\r\n            },\r\n            save: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                readOnly: true\r\n            },\r\n            health: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                readOnly: true\r\n            },\r\n            maximumHealth: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                readOnly: true\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n    forms.narrativeRef = {\r\n        label: \"Narrative\",\r\n        model: true,\r\n        property: \"narrative\",\r\n        fields: {\r\n            narrative: {\r\n                layout: \"full\",\r\n                form: forms.narrative\r\n            }\r\n        }\r\n    }\r\n    forms.personalityRef = {\r\n        label: \"Personality\",\r\n        model: true,\r\n        property: \"personality\",\r\n        fields: {\r\n            personality: {\r\n                layout: \"full\",\r\n                form: forms.personality\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.profileRef = {\r\n        label: \"Profile\",\r\n        model: true,\r\n        property: \"profile\",\r\n        fields: {\r\n            profile: {\r\n                layout: \"full\",\r\n                form: forms.profile\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.profile = {\r\n        label: \"Profile\",\r\n        fields: {\r\n            portrait: {\r\n                layout: 'one',\r\n                format: 'image',\r\n                field: {\r\n                    label: \"Profile\",\r\n                    pickerType: \"data.data\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"portrait\"\r\n                    }\r\n                }\r\n            },\r\n            pickProfile: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'run_circle',\r\n                requiredAttributes: [],\r\n                field: {\r\n                    label: \"Pick Profile\",\r\n                    command: pickProfile\r\n                }\r\n            },\r\n            pickVoice: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'run_circle',\r\n                requiredAttributes: [],\r\n                field: {\r\n                    label: \"Pick Voice\",\r\n                    pickerType: \"identity.voice\",\r\n                    command: pickVoice\r\n                }\r\n            },\r\n            voice: {\r\n                layout: 'one',\r\n                format: 'picker',\r\n                label: \"Voice\",\r\n                field: {\r\n                    readOnly: false,\r\n                    requiredAttributes: [],\r\n                    pickerType: \"identity.voice\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"voice\",\r\n                        path: \"~/Voices\"\r\n                    }\r\n                }\r\n            }\r\n            \r\n        }\r\n    };\r\n\r\n    forms.personality = {\r\n        label: \"Personality\",\r\n        fields: {\r\n            openness: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                skipValidation: true\r\n            },\r\n            conscientiousness: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                skipValidation: true\r\n            },\r\n            extraversion: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                skipValidation: true\r\n            },\r\n            agreeableness: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                skipValidation: true\r\n            },\r\n            neuroticism: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                skipValidation: true\r\n            },\r\n            blank: {\r\n                layout: \"one\",\r\n                format: \"blank\",\r\n                field: {\r\n                    label: \"\",\r\n                    readOnly: true\r\n                }\r\n            },\r\n            machiavellianism: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                skipValidation: true\r\n            },\r\n            narcissism: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                skipValidation: true\r\n            },\r\n            psychopathy: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                skipValidation: true\r\n            },\r\n            sadism: {\r\n                layout: 'one',\r\n                format: 'range',\r\n                skipValidation: true\r\n            },\r\n            sloanKey: {\r\n                layout: 'one',\r\n                readOnly: true\r\n            },\r\n            sloanCardinal: {\r\n                layout: 'one',\r\n                readOnly: true\r\n\r\n            },\r\n            mbtiKey: {\r\n                layout: 'one',\r\n                readOnly: true\r\n            },\r\n            darkTetradKey: {\r\n                layout: 'one',\r\n                readOnly: true\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.narrative = {\r\n        label: \"Narrative\",\r\n        fields: {\r\n            objectId: {\r\n                layout: 'full',\r\n                label: \"Object Id\",\r\n                readOnly: true\r\n            },\r\n            physicalDescription: {\r\n                layout: 'full',\r\n                label: \"Description\",\r\n                format: 'print'\r\n            },\r\n            statisticsDescription: {\r\n                layout: 'full',\r\n                label: \"Statistics\",\r\n                format: 'print'\r\n            },\r\n            outfitDescription: {\r\n                layout: 'full',\r\n                label: \"Current Outfit\",\r\n                format: 'print'\r\n            },\r\n            armamentDescription: {\r\n                layout: 'full',\r\n                label: \"Armament\",\r\n                format: 'print'\r\n            },\r\n            alignmentDescription: {\r\n                layout: 'full',\r\n                label: \"Alignment\",\r\n                format: 'print'\r\n            },\r\n            darkTetradDescription: {\r\n                layout: 'full',\r\n                label: \"Dark Tetrad\",\r\n                format: 'print'\r\n            },\r\n            sloanDescription: {\r\n                layout: 'full',\r\n                label: \"Sloan\",\r\n                format: 'print'\r\n            },\r\n            mbtiDescription: {\r\n                layout: 'full',\r\n                label: \"Meyers-Briggs\",\r\n                format: 'print'\r\n            },\r\n            sdPrompt: {\r\n                layout: 'full',\r\n                label: \"SD Prompt\",\r\n                format: 'print'\r\n            },\r\n            sdNegativePrompt: {\r\n                layout: 'full',\r\n                label: \"SD Negative Prompt\",\r\n                format: 'print'\r\n            }\r\n        }\r\n    };\r\n\r\n    /// TODO: This whole nonsense is a WIP while migrating from the old to new model definition, and the UI updates being made around those changes.\r\n    let prc = am7model.getModel(\"olio.llm.promptRaceConfig\");\r\n    let prcr = am7model.getModelField(prc, \"raceType\");\r\n    prcr.type = \"list\";\r\n    prcr.limit = [\"L\", \"W\", \"X\", \"Y\", \"Z\", \"R\", \"S\", \"M\"];\r\n    forms.races = {\r\n        form: forms.promptRaceConfig,\r\n        standardUpdate: true\r\n    };\r\n    forms.promptRaceConfig = {\r\n        label: \"Race\",\r\n        format: \"table\",\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                altIcon: 'check',\r\n                altCondition: ['edit'],\r\n                function: 'newEntry',\r\n                altFunction: 'checkEntry'\r\n            },\r\n            edit: {\r\n                label: 'Edit',\r\n                icon: 'edit',\r\n                function: 'editEntry',\r\n                condition: ['select']\r\n            },\r\n            cancel: {\r\n                label: 'Cancel',\r\n                icon: 'cancel',\r\n                function: 'cancelEntry',\r\n                condition: ['select', 'edit']\r\n            }\r\n\r\n        },\r\n\r\n        fields: {\r\n            raceType: {\r\n                layout: \"third\",\r\n                field: {\r\n                    type: \"list\",\r\n                    label: \"Race\",\r\n                    limit: [\"L\", \"W\", \"X\", \"Y\", \"Z\", \"R\", \"S\"]\r\n                }\r\n            },\r\n            race: {\r\n                layout: \"two-thirds\",\r\n                format: \"textlist\"\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.promptConfig = {\r\n        label: \"Prompt\",\r\n        fields: {\r\n            name: {\r\n                layout: \"one\",\r\n                dragAndDrop: true\r\n            },\r\n            systemPrompt: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'run_circle',\r\n                requiredAttributes: [\"!objectId\"],\r\n                field: {\r\n                    label: \"Load Default\",\r\n                    command: getSystemPrompt\r\n                }\r\n            },\r\n            blank: {\r\n                layout: \"two-thirds\",\r\n                format: \"blank\",\r\n                field: {\r\n                    label: \"\",\r\n                    readOnly: true\r\n                }\r\n            },\r\n            setting: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            scene: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            races: {\r\n                format: \"table\",\r\n                layout: \"full\",\r\n                form: forms.promptRaceConfig\r\n            }\r\n        },\r\n        forms: [\"systemPromptConfig\", \"assistantPromptConfig\", \"userPromptConfig\", \"groupinfo\", \"attributes\"]\r\n    };\r\n    forms.systemPromptConfig = {\r\n        label: \"System Prompt\",\r\n        fields: {\r\n            system: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            systemCensorWarning: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            systemNlp: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            systemAnalyze: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            malePerspective: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            femalePerspective: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            episodeRule: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            }\r\n        },\r\n        forms: []\r\n    };\r\n    forms.assistantPromptConfig = {\r\n        label: \"Assistant Prompt\",\r\n        fields: {\r\n            assistant: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            assistantCensorWarning: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            assistantNlp: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            assistantAnalyze: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            assistantReminder: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            }\r\n        },\r\n        forms: []\r\n    };\r\n\r\n    forms.userPromptConfig = {\r\n        label: \"User Prompt\",\r\n        fields: {\r\n            user: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            userConsentPrefix: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            userConsentRating: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            userConsentNlp: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            userAnalyze: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            userReminder: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            },\r\n            userCitation: {\r\n                layout: \"full\",\r\n                format: \"textlist\"\r\n            }\r\n        },\r\n        forms: []\r\n    };\r\n    forms.chatOptionsRef = {\r\n        label: \"Options\",\r\n        model: true,\r\n        property: \"chatOptions\",\r\n        fields: {\r\n            chatOptions: {\r\n                layout: \"full\",\r\n                form: forms.chatOptions\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    forms.chatOptions = {\r\n        label: \"Options\",\r\n        fields: {\r\n            temperature: {\r\n                label: \"Temperature\",\r\n                layout: 'third',\r\n                format: \"range\"\r\n            },\r\n            top_p: {\r\n                label: \"Top P\",\r\n                layout: 'third',\r\n                format: \"range\"\r\n            },\r\n            num_ctx: {\r\n                label: \"Maximum Tokens\",\r\n                layout: 'third',\r\n                format: \"range\"\r\n            },\r\n            typical_p: {\r\n                label: \"Presence Penalty\",\r\n                layout: 'third',\r\n                format: \"range\"\r\n            },\r\n            repeat_penalty: {\r\n                label: \"Frequency Penalty\",\r\n                layout: 'third',\r\n                format: \"range\"\r\n            }\r\n\r\n        }\r\n    };\r\n    forms.chatConfig = {\r\n        label: \"Chat Configuration\",\r\n        fields: {\r\n            name: {\r\n                layout: \"one\",\r\n                dragAndDrop: true\r\n            },\r\n            model: {\r\n                layout: \"one\",\r\n                label: \"Model Name\"\r\n            },\r\n            analyzeModel: {\r\n                layout: \"one\",\r\n                label: \"Analyze Model\"\r\n            },\r\n            rating: {\r\n                layout: \"one\",\r\n                field: {\r\n                    type: \"list\",\r\n                    label: \"Rating\",\r\n                    limit: [\"E\", \"E10\", \"T\", \"M\", \"AO\", \"RC\"]\r\n                }\r\n            },\r\n            startMode: {\r\n                layout: \"one\",\r\n                field: {\r\n                    label: 'Who Starts?',\r\n                    type: 'list',\r\n                    limit: ['none', 'system', 'user']\r\n                }\r\n            },\r\n            /*\r\n            blank : {\r\n                layout : \"one\",\r\n                format: \"blank\",\r\n                field: {\r\n                    label: \"\",\r\n                    readOnly: true\r\n                }\r\n            },\r\n            */\r\n            policy: {\r\n                layout: 'one',\r\n                format: 'picker',\r\n                field: {\r\n                    format: 'picker',\r\n                    pickerType: \"policy.policy\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"policy\"\r\n                    },\r\n                    label: \"Policy\"\r\n                }\r\n            },\r\n            serverUrl:{\r\n                layout: \"third\"\r\n            },\r\n            apiVersion: {\r\n                layout: \"one\"\r\n            },\r\n            serviceType: {\r\n                layout: \"one\",\r\n                label: \"Service Type\",\r\n                field:{\r\n                    type: \"list\",\r\n                    limit: [\"OPENAI\", \"OLLAMA\"]\r\n                }\r\n            },\r\n            apiKey:{\r\n                layout: \"third\",\r\n                type: \"password\"\r\n            },\r\n            systemCharacter: {\r\n                layout: 'third',\r\n                format: 'picker',\r\n                label: \"System Character\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"olio.charPerson\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"systemCharacter\"\r\n                    }\r\n                }\r\n            },\r\n            userCharacter: {\r\n                layout: 'third',\r\n                format: 'picker',\r\n                label: \"User Character\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"olio.charPerson\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"userCharacter\"\r\n                    }\r\n                }\r\n            },\r\n            setting: {\r\n                layout: \"third\",\r\n                label: \"Setting\"\r\n            },\r\n            stream: {\r\n                layout: \"one\"\r\n            },\r\n            assist: {\r\n                layout: \"one\"\r\n            },\r\n\r\n            prune: {\r\n                layout: \"one\"\r\n            },\r\n            remindEvery: {\r\n                layout: \"one\",\r\n                label: \"Remind Every\"\r\n            },\r\n            keyframeEvery: {\r\n                layout: \"one\",\r\n                label: \"Keyframe Every\"\r\n            },\r\n            messageTrim: {\r\n                layout: \"one\",\r\n                label: \"Message Trim\"\r\n            },\r\n\r\n            includeScene: {\r\n                layout: \"one\",\r\n                label: \"Include Scene\"\r\n            },\r\n            scene: {\r\n                layout: \"third\",\r\n                label: \"Scene\"\r\n            },\r\n            useNLP: {\r\n                layout: \"one\"\r\n            },\r\n            nlpCommand: {\r\n                layout: \"third\",\r\n                label: \"Command\"\r\n            },\r\n\r\n        },\r\n        forms: [\"episodectl\", \"chatOptionsRef\", \"groupinfo\", \"attributes\"]\r\n\r\n    };\r\n\r\n    forms.episodes = {\r\n        label: \"Episodes\",\r\n        format: \"table\",\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                altIcon: 'check',\r\n                altCondition: ['edit'],\r\n                function: 'newEntry',\r\n                altFunction: 'checkEntry'\r\n            },\r\n            edit: {\r\n                label: 'Edit',\r\n                icon: 'edit',\r\n                function: 'editEntry',\r\n                condition: ['select']\r\n            },\r\n            cancel: {\r\n                label: 'Cancel',\r\n                icon: 'cancel',\r\n                function: 'cancelEntry',\r\n                condition: ['select', 'edit']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteEntry',\r\n                condition: ['select']\r\n            }\r\n\r\n        },\r\n        fields: {\r\n            number: {\r\n                layout: \"one\",\r\n                label: \"Number\"\r\n            },\r\n            completed: {\r\n                layout: \"one\",\r\n                label: \"Completed\"\r\n            },\r\n            name: {\r\n                layout: \"one\",\r\n                label: \"Name\"\r\n            },\r\n            theme: {\r\n                layout: \"one\",\r\n                label: \"Theme\"\r\n            },\r\n            stages: {\r\n                layout: \"full\",\r\n                format: \"textlist\",\r\n                label: \"Stages\"\r\n            }\r\n        }\r\n    };\r\n    forms.episodectl = {\r\n        label: \"Episodes\",\r\n        format: \"table\",\r\n        fields: {\r\n            episodes: {\r\n                layout: 'full',\r\n                form: forms.episodes\r\n            }\r\n        }\r\n    };\r\n    forms.charPersonRel = {\r\n        label: \"Relations\",\r\n        fields: {\r\n            partners: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            dependents: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            },\r\n            accounts: {\r\n                layout: \"third\",\r\n                form: forms.entitylist\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.models.push({\r\n        name: \"imageView\",\r\n        icon: \"image\",\r\n        label: \"Image\",\r\n        fields: [\r\n            { name: \"image\", type: \"model\", baseModel: \"data.data\" }\r\n        ]\r\n    });\r\n\r\n    forms.imageView = {\r\n        label: \"Image\",\r\n        fields: {\r\n            image: {\r\n                layout: \"full\",\r\n                format: \"image\"\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.models.push({\r\n        name: \"imageGallery\",\r\n        icon: \"photo_library\",\r\n        label: \"Gallery\",\r\n        fields: [\r\n            { name: \"images\", type: \"list\", baseModel: \"data.data\" },\r\n            { name: \"currentIndex\", type: \"int\", default: 0 }\r\n        ]\r\n    });\r\n\r\n    forms.imageGallery = {\r\n        label: \"Gallery\",\r\n        fields: {\r\n            images: {\r\n                layout: \"full\",\r\n                format: \"gallery\"\r\n            }\r\n        }\r\n    };\r\n\r\n    forms.openaiRequest = {\r\n        label: \"OpenAI Request\",\r\n        fields: {\r\n            model: {\r\n                layout: 'one'\r\n            },\r\n            vectorize: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'polyline',\r\n                requiredAttributes: [\"objectId\"],\r\n                field: {\r\n                    label: \"Vectorize\",\r\n                    command: page.components.dialog.vectorize\r\n                }\r\n            },\r\n            summarize: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'summarize',\r\n                requiredAttributes: [\"objectId\"],\r\n                field: {\r\n                    label: \"Summarize\",\r\n                    command: page.components.dialog.summarize\r\n                }\r\n            }\r\n            /*\r\n            ,\r\n            messages: {\r\n                format: \"table\",\r\n                form: forms.openaiMessages\r\n            }\r\n            */\r\n        },\r\n        forms: [\"openaiMessages\", \"lightgroupinfo\", \"attributes\"]\r\n    }\r\n\r\n\r\n\r\n    forms.openaiMessage = {\r\n        label: \"Chat Message\",\r\n        format: \"table\",\r\n        standardUpdate: true,\r\n        commands: {\r\n            new: {\r\n                label: 'New',\r\n                icon: 'add',\r\n                altIcon: 'check',\r\n                altCondition: ['edit'],\r\n                function: 'newEntry',\r\n                altFunction: 'checkEntry'\r\n            },\r\n            edit: {\r\n                label: 'Edit',\r\n                icon: 'edit',\r\n                function: 'editEntry',\r\n                condition: ['select']\r\n            },\r\n            cancel: {\r\n                label: 'Cancel',\r\n                icon: 'cancel',\r\n                function: 'cancelEntry',\r\n                condition: ['select', 'edit']\r\n            },\r\n            delete: {\r\n                label: 'Delete',\r\n                icon: 'delete_outline',\r\n                function: 'deleteEntry',\r\n                condition: ['select']\r\n            }\r\n\r\n        },\r\n        fields: {\r\n            role: {\r\n                layout: \"one\"\r\n            },\r\n            pruned: {\r\n                layout: \"one\"\r\n            },\r\n            content: {\r\n                layout: \"two-thirds\",\r\n                format: \"textarea\"\r\n            }\r\n        }\r\n    };\r\n    \r\n    forms.openaiMessages = {\r\n        label: \"Chat Messages\",\r\n        format: \"table\",\r\n        fields: {\r\n            messages: {\r\n                layout: 'full',\r\n                form: forms.openaiMessage\r\n            }\r\n        }\r\n    };\r\n\r\n    let voice = am7model.getModel(\"identity.voice\");\r\n    voice.fields.push({\r\n        name: \"sampleText\",\r\n        label: \"Sample Text\",\r\n        type: \"string\",\r\n        default: \"My voice is my passport, verify me.\",\r\n        virtual: true,\r\n        ephemeral: true\r\n    });\r\n    voice.fields.push({\r\n        name: \"sampleAudio\",\r\n        label: \"Sample Audio\",\r\n        type: \"model\",\r\n        baseModel: \"data.data\",\r\n        virtual: true,\r\n        ephemeral: true\r\n    });\r\n\r\n   forms.voice = {\r\n        label: \"Voice Form\",\r\n        fields: {\r\n            name: {\r\n                layout: \"one\"\r\n            },\r\n            engine: {\r\n                label: \"Engine\",\r\n                layout: \"one\",\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['piper', 'xtts']\r\n                }\r\n            },\r\n            speaker: {\r\n                label: \"Speaker\",\r\n                layout: \"one\",\r\n                field: {\r\n                    type: 'list',\r\n                    limit: ['Unknown', 'jenny', 'cori-high', 'clean100', 'en_US-libritts_r-medium', 'en_GB-alba-medium', 'en_US-kristin-medium']\r\n                }\r\n            },\r\n            speakerId: {\r\n                label: \"Speaker Id\",\r\n                layout: \"one\"\r\n            },\r\n            voiceSample: {\r\n                layout: 'one',\r\n                format: 'picker',\r\n                label: \"Voice Sample\",\r\n                field: {\r\n                    format: \"picker\",\r\n                    pickerType: \"data.data\",\r\n                    pickerProperty: {\r\n                        selected: \"{object}\",\r\n                        entity: \"voiceSample\",\r\n                        path: \"~/Voices\"\r\n                    }\r\n                }\r\n            },\r\n            speed: {\r\n                label: \"Speed\",\r\n                layout: \"one\",\r\n                format: \"range\"\r\n            },\r\n            sampleText:{\r\n                layout: \"third\"\r\n            },\r\n            createSample: {\r\n                format: \"button\",\r\n                layout: \"one\",\r\n                icon: 'run_circle',\r\n                requiredAttributes: [],\r\n                field: {\r\n                    label: \"Test Voice\",\r\n                    command: testVoice\r\n                }\r\n            },\r\n            sampleAudio: {\r\n                layout: 'one',\r\n                format: 'audio'\r\n            }\r\n\r\n\r\n        },\r\n        forms: [\"grouptypeinfo\", \"attributes\"]\r\n    };\r\n\r\n    forms.commands = {\r\n        character,\r\n        createCharacter,\r\n        characterWizard,\r\n        rollCharacter,\r\n        narrate\r\n    };\r\n    am7model.forms = forms;\r\n\r\n    // Dynamically update SD model field limits from the server\r\n    if (typeof am7sd !== \"undefined\" && am7sd.fetchModels) {\r\n        am7sd.fetchModels().then(function(models) {\r\n            if (models && models.length > 0) {\r\n                let mf = am7model.getModelField(\"olio.sd.config\", \"model\");\r\n                if (mf) mf.limit = models;\r\n                let rf = am7model.getModelField(\"olio.sd.config\", \"refinerModel\");\r\n                if (rf) rf.limit = models;\r\n                if (forms.sdConfig && forms.sdConfig.fields) {\r\n                    if (forms.sdConfig.fields.model && forms.sdConfig.fields.model.field) {\r\n                        forms.sdConfig.fields.model.field.limit = models;\r\n                    }\r\n                    if (forms.sdConfig.fields.refinerModel && forms.sdConfig.fields.refinerModel.field) {\r\n                        forms.sdConfig.fields.refinerModel.field.limit = models;\r\n                    }\r\n                }\r\n                if (forms.sdConfigOverrides && forms.sdConfigOverrides.fields) {\r\n                    if (forms.sdConfigOverrides.fields.model && forms.sdConfigOverrides.fields.model.field) {\r\n                        forms.sdConfigOverrides.fields.model.field.limit = models;\r\n                    }\r\n                    if (forms.sdConfigOverrides.fields.refinerModel && forms.sdConfigOverrides.fields.refinerModel.field) {\r\n                        forms.sdConfigOverrides.fields.refinerModel.field.limit = models;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n}());\n\n;/* === client/view.js === */\n(function () {\r\n\r\n    function getDefaultValuesForField(field) {\r\n        let v = [];\r\n        switch (field.type) {\r\n            case \"list\":\r\n                v = field.limit || [];\r\n                break;\r\n            case \"enum\":\r\n                if (field.filter) v = field.enum.filter((v) => v.match(field.filter));\r\n                else if (field.baseClass) {\r\n                    let jsName = field.baseClass.substring(field.baseClass.lastIndexOf(\".\") + 1);\r\n                    v = am7model.enums[jsName.substring(0, 1).toLowerCase() + jsName.substring(1)];\r\n                }\r\n                else v = field.enum;\r\n\r\n                break;\r\n            default:\r\n                // console.warn(\"Unhandled type\", field.type);\r\n                break;\r\n        }\r\n        return v;\r\n    }\r\n\r\n\r\n    function getFormatForType(type) {\r\n        let format = \"text\";\r\n        switch (type) {\r\n            case \"list\":\r\n            case \"enum\":\r\n                format = \"select\";\r\n                break;\r\n            case \"zonetime\":\r\n            case \"timestamp\":\r\n            case \"datetime\":\r\n                format = \"datetime-local\";\r\n                break;\r\n            case \"boolean\":\r\n                format = \"checkbox\";\r\n                break;\r\n            default:\r\n                /// console.log(\"Default \" + type + \" to \" + format);\r\n                break;\r\n        }\r\n        return format;\r\n    }\r\n\r\n    function getActionView(fld, inst) {\r\n        let a = inst.form.commands[fld];\r\n        return m(\"div\", [\r\n            m(\"button\", {\r\n                class: \"page-dialog-button\",\r\n                onclick: function () {\r\n                    inst.action(a.action);\r\n                }\r\n            }, [\r\n                m(\"span\", {\r\n                    class: \"material-symbols-outlined material-symbols-outlined-white md-18 mr-4\"\r\n                }, [a.icon]),\r\n                m(\"span\", {\r\n                    class: \"\"\r\n                }, [a.label]),\r\n            ])\r\n        ])\r\n    }\r\n\r\n    function getValidationErrorLabel(txt){\r\n        return m(\"span\", {class: \"p-1 block text-sm rounded bg-red-400\"}, txt)\r\n    }\r\n\r\n    function getFieldView(fld, inst) {\r\n        let f = inst.field(fld);\r\n        let ff = inst.formField(fld);\r\n        if(ff && ff.hide){\r\n            return m(\"span\", \"\");\r\n        }\r\n        let annot = \"\";\r\n        if(inst.validationErrors[fld]){\r\n            annot = getValidationErrorLabel(inst.validationErrors[fld]);\r\n        }\r\n        return m(\"div\", [\r\n            m(\"label\", {\r\n                class: \"block\",\r\n                for: fld\r\n            }, [\r\n                inst.label(fld)\r\n            ]),\r\n            (f ? getField(fld, inst) : m(\"span\", { class: \"bold\" }, \"Invalid field: \" + fld)),\r\n            annot\r\n        ]);\r\n    }\r\n    function getField(fld, inst) {\r\n        let props = {\r\n            oninput: inst.handleChange(fld),\r\n            placeholder: inst.placeholder(fld),\r\n            name: fld\r\n        };\r\n        let fprops = inst.viewProperties(fld);\r\n        if (fprops) {\r\n            props = Object.assign(fprops, props);\r\n        }\r\n        let defVal;\r\n        if (inst.api[fld]) {\r\n            defVal = inst.api[fld]();\r\n        }\r\n\r\n        let type = inst.formField(fld, \"format\") || inst.formField(fld, \"type\") || \"text\";\r\n        let cls = \"text-field-full\";\r\n        let useType = type;\r\n        if (type == \"list\") {\r\n            let ofld = inst.formField(fld, \"limit\") || inst.formField(fld, \"values\") || [];\r\n            if(inst.field(fld).type == \"list\" && ofld.length == 0 && defVal instanceof Array){\r\n                ofld = defVal;\r\n            }\r\n            return m(\"select\", { onchange: inst.handleChange(fld), class: \"select-field-full\" },\r\n                ofld.map((o, i) => m(\"option\", { value: o, selected: (o == inst.api[fld]()) }, o)),\r\n            );\r\n        }\r\n        if (type == \"boolean\") {\r\n            useType = \"checkbox\";\r\n            cls = \"check-field\";\r\n        }\r\n        let iprops = {\r\n            class: cls,\r\n            type: useType,\r\n            value: defVal\r\n        };\r\n        if (useType == \"checkbox\") {\r\n            props.oninput = undefined;\r\n            props.onchange = inst.handleChange(fld);\r\n            iprops.checked = defVal;\r\n        }\r\n        return m(\"input\", Object.assign(iprops, props));\r\n    }\r\n\r\n    function form(inst) {\r\n\r\n        let vf = inst.form;\r\n\r\n        let el = Array.from(Object.entries(vf.fields).map(([k, f]) => {\r\n            let x = inst.design(k);\r\n            if (!x) {\r\n                x = getFieldView(k, inst);\r\n            }\r\n            return [k, x];\r\n        }), ([key, value]) => value);\r\n        let el2 = Array.from(Object.entries(vf.commands || {}).map(([k, c]) => {\r\n            return [k, getActionView(k, inst)];\r\n        }), ([key, value]) => value);\r\n        el.push(...el2);\r\n\r\n        let v = [m(\"h3\", {\r\n            class: \"box-title\"\r\n        }, [\r\n            icon(inst),\r\n            label(inst)\r\n        ]),\r\n        m(\"div\", {\r\n            class: \"mt-4\"\r\n        },\r\n            el\r\n        )\r\n        ];\r\n        return v;\r\n    }\r\n\r\n    function icon(v) {\r\n        if (v.icon()) {\r\n            return m(\"span\", {\r\n                class: \"material-symbols-outlined mr-4\"\r\n            }, [v.icon()]);\r\n        }\r\n        return \"\";\r\n    }\r\n    function label(v) {\r\n        if (v.label()) {\r\n            return m(\"span\", {}, [v.label()]);\r\n        }\r\n        return \"\";\r\n    }\r\n\r\n    let basePath = \"~\";\r\n\r\n    function getBasePathByType(s) {\r\n        let m = am7model.getModel(s);\r\n        if (!m || !m.group) return basePath;\r\n        return basePath + \"/\" + m.group;\r\n    }\r\n    let worldView = {\r\n        \"Population\": \"olio.charPerson\",\r\n        \"Characters\": \"olio.charPerson\"\r\n    }\r\n    function getTypeByPath(sPath) {\r\n        let subPath = sPath.substring(sPath.lastIndexOf(\"/\") + 1);\r\n        let outT;\r\n        let aP = am7model.models.filter(m => m.group && m.group == subPath);\r\n        if (aP.length) outT = aP[0].name;\r\n        if (!outT && worldView[subPath]) {\r\n            outT = worldView[subPath];\r\n        }\r\n        return outT;\r\n    }\r\n\r\n    function getPathForType(type) {\r\n        let path = getBasePathByType(type);\r\n        if (path != null) path = path.replace(/^~/, page.user.homeDirectory.path);\r\n        return path;\r\n    }\r\n\r\n    function viewQuery(inst) {\r\n        if (typeof inst == \"string\") inst = am7model.newInstance(inst);\r\n        let q = am7client.newQuery(inst.model.name);\r\n        q.entity.request = getViewFields(inst);\r\n\r\n        let oidf = inst.fields.filter(f => f.name == \"objectId\");\r\n        let idf = inst.fields.filter(f => f.name == \"id\");\r\n        let id;\r\n        if (oidf.length) {\r\n            id = oidf[0];\r\n        }\r\n        else if (idf.length) {\r\n            id = idf[0];\r\n        }\r\n        let idv;\r\n        if (id && inst.api[id.name] && (idv = inst.api[id.name]()) && idv != null) {\r\n            q.field(id.name, inst.api[id.name]());\r\n        }\r\n        /*\r\n        if(page.user){\r\n            q.field(\"organizationId\", page.user.organizationId);\r\n        }\r\n        */\r\n        return q;\r\n    }\r\n\r\n    function getViewFields(inst) {\r\n        if (typeof inst == \"string\") inst = am7model.newInstance(inst);\r\n        return getFormFieldNames(inst.model.name, inst.form);\r\n    }\r\n\r\n    function getFormFieldNames(model, form) {\r\n        let a = [];\r\n        if (!form || !form.fields) return a;\r\n        a = Object.keys(form.fields).filter(f => {\r\n            let mf = am7model.getModelField(model, f);\r\n            return (mf && !mf.ephemeral);\r\n        }).map(k => k);\r\n        if (form.query) a.push(...form.query);\r\n\r\n        if (am7model.inherits(model, \"system.organizationExt\")) {\r\n            a.push(\"organizationPath\");\r\n            a.push(\"organizationId\");\r\n        }\r\n        if (am7model.inherits(model, \"system.primaryKey\")) {\r\n            a.push(\"id\");\r\n        }\r\n\r\n        if (am7model.isParent(model)) {\r\n            if (am7model.hasField(model, \"path\")) a.push(\"path\");\r\n            a.push(\"parentId\");\r\n        }\r\n        if (am7model.isGroup(model) && model != 'auth.group') {\r\n            a.push(\"groupPath\");\r\n            a.push(\"groupId\");\r\n        }\r\n        if (form.forms) {\r\n            form.forms.forEach(f => {\r\n                a.push(...getFormFieldNames(model, am7model.forms[f]));\r\n            });\r\n        }\r\n        return a.filter((v, i, z) => z.indexOf(v) == i);\r\n    }\r\n\r\n    function getFormField(form, name) {\r\n        let field;\r\n        if (form) {\r\n            field = form.fields[name];\r\n            if (!field) {\r\n                let ff = (form.forms || []);\r\n                for (let fo in ff) {\r\n                    let f = ff[fo];\r\n                    field = am7model.forms[f].fields[name];\r\n                    if (field) {\r\n                        break;\r\n                    }\r\n                };\r\n            }\r\n        }\r\n        return field;\r\n    }\r\n\r\n    function typeToModel(type) {\r\n        let ot = type;\r\n        if (!type) {\r\n            return type;\r\n        }\r\n        switch (type.toLowerCase()) {\r\n            case \"account\":\r\n                ot = \"identity.account\";\r\n                break;\r\n            case \"user\":\r\n                ot = \"system.user\";\r\n                break;\r\n            case \"person\":\r\n                ot = \"identity.person\";\r\n                break;\r\n            case \"unknown\":\r\n                ot = \"common.nameId\";\r\n                break;\r\n        }\r\n        return ot;\r\n    }\r\n\r\n    /// TODO: There's currently a bug where if a picker is based on a type, and restricted by the type value, then if the type list displays initially without being redrawn, the type\r\n    /// value will still be the default - currently the work around is display these fields on a secondary tab\r\n    function showField(inst, ref, useName) {\r\n        let show = true;\r\n        let entity = inst?.entity;\r\n\r\n        if (ref.requiredRoles) {\r\n            show = false;\r\n            let rctx = page.context().roles;\r\n            ref.requiredRoles.forEach((a, i) => {\r\n                if (rctx[a] === true) show = true;\r\n            });\r\n        }\r\n        if (show && entity && ref.requiredAttributes) {\r\n            let showCount = 0;\r\n            ref.requiredAttributes.forEach((a, i) => {\r\n                let a2 = a;\r\n                let invert = (a2.match(/^!/) != null);\r\n                if (invert) {\r\n                    a2 = a2.replace(/^!/, \"\");\r\n                }\r\n\r\n                let reqVal;\r\n                if (ref.requiredValues) {\r\n                    reqVal = ref.requiredValues[i];\r\n                }\r\n                if (ref.referField) {\r\n                    let mat;\r\n                    if (useName && (mat = useName.match(/(-\\d+)$/)) != null) {\r\n                        a2 = a2 + mat[1];\r\n                    }\r\n                    let e = document.querySelector('[name=' + a2 + ']');\r\n                    if (e && e.type == 'checkbox') {\r\n                        if (e.checked || invert) showCount++;\r\n                    }\r\n                    else if (e) {\r\n                        let reqVals = (reqVal ? reqVal.split(\"|\") : [undefined]);\r\n                        let showTotal = 0;\r\n                        reqVals.forEach((v2) => {\r\n                            if (\r\n                                (v2 && e.value == v2)\r\n                                ||\r\n                                (!v2 && e.value)\r\n                            ) {\r\n                                showTotal++;\r\n                            }\r\n                        });\r\n                        if (reqVal) {\r\n                            if (reqVal.indexOf(\"|\") > -1 && showTotal > 0) showCount++;\r\n                            else if (showTotal == reqVals.length) showCount++;\r\n                        }\r\n                        else if (showTotal > 0) {\r\n                            showCount++;\r\n                        }\r\n                    }\r\n                    else {\r\n                        //console.log(\"Else: \" + a2);\r\n                    }\r\n                }\r\n                else if ((reqVal && entity[a2] != reqVal) || (!reqVal && ((!invert && !entity[a2]) || (invert && entity[a2])))) {\r\n                    //console.log(\"Else...\");\r\n                    //show = false;\r\n                }\r\n                else {\r\n                    showCount++;\r\n                }\r\n            });\r\n            show = ref.requiredAttributes.length == showCount;\r\n        }\r\n        return show;\r\n    }\r\n\r\n    function isBinary(entity, mt){\r\n        let contentType = mt;\r\n        if(contentType || (entity && (contentType = entity.contentType))){\r\n            return (\r\n                !contentType.match(/^text/gi)\r\n                &&\r\n                !contentType.match(/application\\/json/)\r\n                &&\r\n                !contentType.match(/javascript$/gi)\r\n            );\r\n        }\r\n        return false;\r\n    }\r\n\r\n    let am7view = {\r\n        errorLabel: getValidationErrorLabel,\r\n        form,\r\n        fieldView: getFieldView,\r\n        formField: getFormField,\r\n        viewFields: getViewFields,\r\n        field: getField,\r\n        label,\r\n        icon,\r\n        viewQuery,\r\n        fieldNames: getFormFieldNames,\r\n        path: getBasePathByType,\r\n        pathForType: getPathForType,\r\n        typeByPath: getTypeByPath,\r\n        typeToModel,\r\n        defaultValuesForField: getDefaultValuesForField,\r\n        getFormatForType,\r\n        showField,\r\n        basePath: (s) => {\r\n            if (s) {\r\n                basePath = s;\r\n            }\r\n            return basePath;\r\n        },\r\n        isBinary\r\n    };\r\n\r\n    if (typeof module != \"undefined\") {\r\n        module.am7view = am7view;\r\n    } else {\r\n        window.am7view = am7view;\r\n    }\r\n}());\n\n;/* === client/viewExtensions.js === */\n(function () {\r\n    /// Extensions to am7view to support custom field renderers\r\n    /// This allows formats like \"image\", \"video\", \"pdf\" etc. to use custom rendering logic\r\n\r\n    /// Storage for custom renderers\r\n    if (!am7view.customRenderers) {\r\n        am7view.customRenderers = {};\r\n    }\r\n\r\n    /// Register a custom renderer for a format type\r\n    am7view.registerCustomRenderer = function(formatName, renderFunction) {\r\n        am7view.customRenderers[formatName] = renderFunction;\r\n    };\r\n\r\n    /// Enhanced getField that checks for custom renderers\r\n    let originalGetField = am7view.field;\r\n\r\n    am7view.field = function(fld, inst) {\r\n        // Get the format for this field\r\n        let format = inst.formField(fld, \"format\");\r\n\r\n        // Check if there's a custom renderer for this format\r\n        if (format && am7view.customRenderers[format]) {\r\n            return am7view.customRenderers[format](inst, fld);\r\n        }\r\n\r\n        // Fall back to original implementation\r\n        return originalGetField(fld, inst);\r\n    };\r\n\r\n    /// Enhanced fieldView that supports custom renderers\r\n    let originalFieldView = am7view.fieldView;\r\n\r\n    am7view.fieldView = function(fld, inst) {\r\n        let f = inst.field(fld);\r\n        let ff = inst.formField(fld);\r\n\r\n        if (ff && ff.hide) {\r\n            return m(\"span\", \"\");\r\n        }\r\n\r\n        // Check for custom renderer\r\n        let format = inst.formField(fld, \"format\");\r\n        if (format && am7view.customRenderers[format]) {\r\n            let annot = \"\";\r\n            if (inst.validationErrors[fld]) {\r\n                annot = am7view.errorLabel(inst.validationErrors[fld]);\r\n            }\r\n\r\n            // For custom renderers, wrap in a div with label if showLabel is not false\r\n            let showLabel = ff ? (ff.showLabel !== false) : true;\r\n\r\n            if (showLabel) {\r\n                return m(\"div\", [\r\n                    m(\"label\", {\r\n                        class: \"block\",\r\n                        for: fld\r\n                    }, [\r\n                        inst.label(fld)\r\n                    ]),\r\n                    am7view.customRenderers[format](inst, fld),\r\n                    annot\r\n                ]);\r\n            } else {\r\n                return m(\"div\", [\r\n                    am7view.customRenderers[format](inst, fld),\r\n                    annot\r\n                ]);\r\n            }\r\n        }\r\n\r\n        // Fall back to original implementation\r\n        return originalFieldView(fld, inst);\r\n    };\r\n\r\n    /// Helper to determine renderer based on object properties\r\n    am7view.selectObjectRenderer = function(object) {\r\n        // Check for portrait\r\n        if (object.profile && object.profile.portrait && object.profile.portrait.contentType) {\r\n            return \"portrait\";\r\n        }\r\n\r\n        // Check model\r\n        let model = object[am7model.jsonModelKey];\r\n        if (model) {\r\n            switch(model) {\r\n                case 'note':\r\n                    return \"markdown\";\r\n                case 'form':\r\n                    return \"form\";\r\n                case 'message':\r\n                    return \"messageContent\";\r\n            }\r\n        }\r\n\r\n        // Check content type\r\n        let mt = object.contentType || \"\";\r\n        if (mt.match(/^image/) || mt.match(/webp$/)) {\r\n            return \"image\";\r\n        }\r\n        if (mt.match(/^video/)) {\r\n            return \"video\";\r\n        }\r\n        if (mt.match(/^audio/)) {\r\n            return \"audio\";\r\n        }\r\n        if (mt.match(/^text/)) {\r\n            return \"text\";\r\n        }\r\n        if (mt.match(/pdf$/)) {\r\n            return \"pdf\";\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    /// Create an instance for object viewing\r\n    am7view.prepareObjectView = function(object, attrs) {\r\n        let model = attrs[am7model.jsonModelKey] || object[am7model.jsonModelKey];\r\n\r\n        if (!model) {\r\n            console.warn(\"No model specified for object view\");\r\n            return null;\r\n        }\r\n\r\n        // Determine the appropriate renderer\r\n        let rendererType = am7view.selectObjectRenderer(object);\r\n\r\n        if (!rendererType) {\r\n            console.warn(\"No renderer found for object\", object);\r\n            return null;\r\n        }\r\n\r\n        // Create a synthetic entity for the view\r\n        let entity = {\r\n            [am7model.jsonModelKey]: \"view.objectDisplay\",\r\n            objectId: object.objectId,\r\n            active: attrs.active !== false,\r\n            maxMode: attrs.maxMode || false,\r\n            viewType: rendererType,\r\n            _sourceObject: object\r\n        };\r\n\r\n        // Merge object properties\r\n        Object.assign(entity, object);\r\n\r\n        // Get appropriate form\r\n        let formName = rendererType + \"View\";\r\n        let form = am7model.forms[formName];\r\n\r\n        if (!form) {\r\n            console.warn(\"No form found for renderer type:\", rendererType);\r\n            return null;\r\n        }\r\n\r\n        // Prepare instance\r\n        let inst = am7model.prepareInstance(entity, form);\r\n\r\n        return inst;\r\n    };\r\n\r\n}());\r\n\n\n;/* === client/decorator.js === */\n(function () {\r\n\r\n    function getFileTypeIcon(p, i) {\r\n        let mtIco = \"\";\r\n        if (p.contentType && p.name.indexOf(\".\") > 0) {\r\n            let ext = p.name.substring(p.name.lastIndexOf(\".\") + 1, p.name.length).toLowerCase();\r\n            mtIco = m(\"span\", { class: \"fontLabel\" + (i && i > 0 ? \"-\" + i : \"\") + \" fiv-cla fiv-icon-\" + ext });\r\n        }\r\n        return mtIco;\r\n    }\r\n\r\n    function getThumbnail(ctl, p){\r\n        let type = am7model.getModel(p[am7model.jsonModelKey]);\r\n        let ico = \"question_mark\";\r\n        if (type && type.icon) ico = type.icon;\r\n        let gridMode = ctl.gridMode;\r\n        let icon;\r\n        if (p.profile && p.profile.portrait && p.profile.portrait.contentType) {\r\n          let pp = p.profile.portrait;\r\n          let icoPath = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + pp.groupPath + \"/\" + pp.name + \"/\" + (gridMode == 1 ? \"256x256\" : \"512x512\");\r\n          if (gridMode == 2 && (pp.contentType.match(/gif$/) || pp.contentType.match(/webp$/))) icoPath = g_application_path + \"/media/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + pp.groupPath + \"/\" + pp.name;\r\n          let icoCls = \"image-grid-image carousel-item-img\";\r\n          icon = m(\"img\", { class: icoCls, src: icoPath });\r\n        }\r\n        else if (p.contentType && p.contentType.match(/^image/)) {\r\n          let icoPath = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + p.groupPath + \"/\" + p.name + \"/\" + (gridMode == 1 ? \"256x256\" : \"512x512\");\r\n          if(p.dataBytesStore && p.dataBytesStore.length){\r\n            icoPath = \"data:\" + p.contentType + \";base64,\" + p.dataBytesStore;\r\n          }\r\n          if (gridMode == 2 && (p.contentType.match(/gif$/) || p.contentType.match(/webp$/))) icoPath = g_application_path + \"/media/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + p.groupPath + \"/\" + p.name;\r\n          let icoCls = \"image-grid-image carousel-item-img\";\r\n          icon = m(\"img\", { class: icoCls, src: icoPath });\r\n        }\r\n        else if(p.contentType && p.name.indexOf(\".\") > 0){\r\n           let ext = p.name.substring(p.name.lastIndexOf(\".\") + 1, p.name.length);\r\n            icon = m(\"span\", { class: \"fontLabel-\" + (gridMode == 1 ? \"6\" : \"10\") + \" fiv-cla fiv-icon-\" + ext });\r\n        }\r\n        else {\r\n          //icon = m(\"span\", { class: \"material-symbols-outlined material-icons-48\" }, ico);\r\n        let icoCls = \"material-symbols-outlined\";\r\n        let col = \"\";\r\n        let sty = \"\";\r\n        if (p.hex) {\r\n            icoCls = \"material-icons\";\r\n            col = \" stroke-slate-50\";\r\n            sty = \"color: \" + p.hex + \";\";\r\n        }\r\n\r\n        icon = m(\"span\", { style: sty, class: icoCls + \" material-icons-72\" + (icoCls ? \" \" + icoCls : \"\") + col }, ico);\r\n        \r\n        }\r\n        return icon;\r\n    }\r\n\r\n    function getIcon(p) {\r\n        let type = am7model.getModel(p[am7model.jsonModelKey]);\r\n        let ico = \"question_mark\";\r\n        if (type && type.icon) ico = type.icon;\r\n        let icon;\r\n        let icoCls = \"\";\r\n        if (p[am7model.jsonModelKey] == \"message.spool\") {\r\n            if (p.spoolStatus == \"ERROR\") {\r\n                icoCls = \"text-red-600\";\r\n                ico = \"quickreply\";\r\n            }\r\n            else if (p.spoolStates == \"ACKNOWLEGED_RECEIPT\") {\r\n                ico = \"mark_chat_read\";\r\n            }\r\n            else if (p.spoolStates == \"TRANSMITTED\" || p.spoolStatus == \"SPOOLED\") {\r\n                icoCls = \"text-green-600\";\r\n                ico = \"mark_chat_unread\";\r\n            }\r\n\r\n        }\r\n        if (p.profile && p.profile.portrait && p.profile.portrait.contentType) {\r\n            let icoPath = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + p.profile.portrait.groupPath + \"/\" + p.profile.portrait.name + \"/48x48\";\r\n\r\n            icon = m(\"img\", { height: 48, width: 48, src: icoPath });\r\n        }\r\n        else if (p.contentType && p.contentType.match(/^image/)) {\r\n            let icoPath = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + p.groupPath + \"/\" + p.name + \"/48x48\";\r\n            if (p.dataBytesStore && p.dataBytesStore.length) {\r\n                icoPath = \"data:\" + p.contentType + \";base64,\" + p.dataBytesStore;\r\n            }\r\n            icon = m(\"img\", { height: 48, width: 48, src: icoPath });\r\n        }\r\n        else if(p.contentType && p.name && p.name.indexOf(\".\") > 0){\r\n            icon = getFileTypeIcon(p, 3);\r\n        }\r\n        else {\r\n            icoCls = \"material-symbols-outlined\";\r\n            let col = \"\";\r\n            let sty = \"\";\r\n            if (p.hex) {\r\n                icoCls = \"material-icons\";\r\n                col = \" stroke-slate-50\";\r\n                sty = \"color: \" + p.hex + \";\";\r\n            }\r\n\r\n            icon = m(\"span\", { style: sty, class: icoCls + \" material-icons-48\" + (icoCls ? \" \" + icoCls : \"\") + col }, ico);\r\n        }\r\n        return icon;\r\n    };\r\n\r\n\r\n\r\n    function getFavoriteStyle(p) {\r\n        let isFavcls = \"\";\r\n        if (page.isFavorite(p)) {\r\n            isFavcls = \" material-symbols-outlined-red filled\";\r\n        }\r\n        return isFavcls\r\n    }\r\n\r\n    function getPolarListItem(ctl, p) {\r\n        let icon = am7decorator.icon(p);\r\n        let cls = \"result-item\";\r\n        let dcls;\r\n        let dnd = page.components.dnd;\r\n        let pagination = ctl.pagination;\r\n        dcls = dnd.doDragDecorate(p);\r\n        if (dcls) cls += \" \" + dcls;\r\n\r\n        if (!dcls && pagination.state(p).checked) {\r\n            cls += \" result-item-active\";\r\n        }\r\n        let useName = am7client.getAttributeValue(p, 'name', p.name) || (p.objectId);\r\n\r\n        let supplData = \"\";\r\n        if (p.contentType) supplData = p.contentType;\r\n        else if (p.type) supplData = p.type;\r\n        else if (p.description) supplData = p.description;\r\n        else if (p.spoolStatus) supplData = p.spoolStatus;\r\n        let attr = \"\";\r\n        let dndProp = page.components.dnd.dragProps(p);\r\n        attr = \"[draggable]\";\r\n        let isFavcls = getFavoriteStyle(p);\r\n        let mtIco = am7decorator.fileIcon(p);\r\n        return m(\"li\" + attr, dndProp,\r\n            [\r\n                m(\"div\", {\r\n                    rid: \"item-\" + p.objectId,\r\n                    onselectstart: function () { return false; },\r\n                    ondblclick: function () { if (ctl.containerMode) ctl.down(p); else ctl.open(p); },\r\n                    onclick: function () { ctl.select(p) },\r\n                    class: cls\r\n                }, [\r\n                    m(\"div\", { class: \"flex-polar\" }, [\r\n                        m(\"div\", { class: \"label\" }, [useName]),\r\n                        m(\"div\", { class: \"label\" }, [\"Tags\"]),\r\n                        m(\"div\", { class: \"polar-label\" }, [\r\n                            m(\"span\", { class: \"tweak-box\" }, [\r\n                                mtIco\r\n                            ])\r\n                        ])\r\n                    ]),\r\n                    m(\"div\", { class: \"flex-polar-2\" }, [\r\n                        m(\"div\", { class: \"meta-container\" }, [\r\n                            m(\"div\", { class: \"meta-item\" }, [\r\n                                icon,\r\n                                m(\"span\", { class: \"ml-2\" }, supplData),\r\n                                m(\"span\", { class: \"ml-2\" }, (p.modifiedDate ? \" \" + (new Date(p.modifiedDate)).toLocaleDateString(\"en-US\", { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' }) : \"\"))\r\n                            ])\r\n                        ]),\r\n                        m(\"div\", { class: \"annotation\" }, [\r\n                            m(\"span\", {\r\n                                class: \"cursor-pointer material-symbols-outlined\" + isFavcls, onclick: function (e) {\r\n                                    e.preventDefault();\r\n                                    page.favorite(p).then((b) => {\r\n                                        m.redraw();\r\n                                    });\r\n                                    return false;\r\n                                }\r\n                            }, \"favorite\")\r\n                        ])\r\n                    ])\r\n                ])\r\n            ]);\r\n    }\r\n\r\n    function getPolarListView(ctl, rset){\r\n      let results = (rset || []).map((p) => {\r\n        return getPolarListItem(ctl, p);\r\n      });\r\n      return m(\"ul\", { rid: 'resultList', onscroll: ctl.onscroll, class: \"list-results-overflow\" }, results);\r\n    }\r\n\r\n    let defaultHeaderMap = [\r\n        \"_rowNum\",\r\n        \"_icon\",\r\n        \"id\",\r\n        \"name\",\r\n        \"modifiedDate\",\r\n        \"age\",\r\n        \"gender\",\r\n        /// Need to correctly plan out embedded fields\r\n        //\"userCharacter.name\",\r\n        // \"_thumbnail\",\r\n        \"_tags\",\r\n        \"_favorite\"\r\n    ];\r\n    \r\n    function getHeaders(type, map){\r\n        return (map || defaultHeaderMap).filter((h) => {\r\n            if(h == \"_tags\" && type == \"data.tag\") return false;\r\n            return am7model.hasField(type, h) || h.match(/^_/);\r\n        });\r\n    }\r\n\r\n    function getHeadersView(ctl, map){\r\n        let type = ctl.listType;\r\n        let mod = am7model.getModel(type);\r\n        let pages = ctl.pagination.pages();\r\n        let headers = getHeaders(type, map).map((h) => {\r\n            \r\n            let fld = am7model.getModelField(type, h);\r\n            let lbl = fld?.label || h;\r\n            if(h.match(/^_/)){\r\n                lbl = \"\";\r\n                if(h == \"_tags\"){\r\n                    lbl = \"Tags\";\r\n                }\r\n            }\r\n            let ico = \"\";\r\n            if (h == \"_icon\" && mod.icon) {\r\n                ico = m(\"span\", { class: \"material-icons-cm material-symbols-outlined\" }, mod.icon);\r\n            }\r\n            else if(h == \"_rowNum\"){\r\n                \r\n                function selectHandler(){\r\n                    let pages = ctl.pagination.pages();\r\n                    pages.pageResults[pages.currentPage].forEach((v) => {\r\n                        pages.pageState[v.objectId] = {checked:true};\r\n                    });\r\n                }\r\n                ico = m(\"span\", { onclick: selectHandler, class: \"material-icons-cm material-symbols-outlined\" }, \"tag\");\r\n            }\r\n            let cw = getCellStyle(ctl, h);\r\n            let sortButton = \"\";\r\n            //if(pages.sort == h){\r\n            if(!h.match(/^_/)){\r\n                let sico = \"swap_vert\";\r\n                let icoCls = \"text-red-200\";\r\n                if(pages.sort == h){\r\n                    sico = (pages.order == \"ascending\" ? \"arrow_upward\" : \"arrow_downward\");\r\n                    icoCls = \"text-blue-700\";\r\n                }\r\n                sortButton = m(\"span\", { class: \"mr-2 material-icons-cm material-symbols-outlined \" + icoCls, onclick: function(){\r\n                    if(pages.sort == h){\r\n                        pages.order = (pages.order == \"ascending\" ? \"descending\" : \"ascending\");\r\n                    }\r\n                    else{\r\n                        pages.sort = h;\r\n                        pages.order = \"ascending\";\r\n                    }\r\n                }}, sico);\r\n            }\r\n            return m(\"th\", {class: cw}, [ico, sortButton, lbl]);\r\n        });\r\n        return m(\"thead\", m(\"tr\", {class: \"tabular-header\"}, headers));\r\n    }\r\n\r\n    function getTabularRow(ctl, p, idx, map) {\r\n        let isFavcls = getFavoriteStyle(p);\r\n        let dcls = page.components.dnd.doDragDecorate(p);\r\n        let cls = \"tabular-row\";\r\n        if(ctl.pagination.state(p).checked){\r\n            cls += \" tabular-row-active\";\r\n        }\r\n        if (dcls) cls += \" \" + dcls;\r\n        let props = Object.assign(page.components.dnd.dragProps(p), {\r\n            class: cls,\r\n            onselectstart: function () { return false; },\r\n            ondblclick: function () { if (ctl.containerMode) ctl.down(p); else ctl.open(p); },\r\n            onclick: function () { ctl.select(p) }\r\n        });\r\n        let attr = \"[draggable]\";\r\n        return m(\"tr\" + attr, props, getHeaders(ctl.listType, map).map((h) => {\r\n            let cw = getCellStyle(ctl, h);\r\n            if(h == \"_thumbnail\") {\r\n                return m(\"td\", { class: {class: cw}, }, [getThumbnail(ctl, p)]);\r\n            }\r\n            else if(h == \"_icon\") {\r\n                return m(\"td\", { class: cw}, [getIcon(p)]);\r\n            }\r\n            else if(h == \"_tags\"){\r\n                let rawTags = p.tags || [];\r\n                // Filter out null/undefined tags or tags without names\r\n                let allTags = rawTags.filter((t) => {\r\n                    if (!t || !t.name) {\r\n                        console.warn(\"Invalid tag found on object:\", p.objectId || p.id, \"tag:\", t);\r\n                        return false;\r\n                    }\r\n                    return true;\r\n                });\r\n                let maxVisible = 3;\r\n                let visibleTags = allTags.slice(0, maxVisible);\r\n                let remainingCount = allTags.length - maxVisible;\r\n\r\n                let tagElements = visibleTags.map((t) => {\r\n                    return m(\"span\", { class: \"tag-pill\", title: t.name }, t.name);\r\n                });\r\n\r\n                if (remainingCount > 0) {\r\n                    tagElements.push(m(\"span\", {\r\n                        class: \"tag-pill tag-more\",\r\n                        title: allTags.slice(maxVisible).map(t => t.name).join(\", \")\r\n                    }, \"+\" + remainingCount));\r\n                }\r\n\r\n                return m(\"td\", { class: cw + \" tags-cell\" }, tagElements);\r\n            }\r\n            else if(h == \"_favorite\"){\r\n                return m(\"td\", {class: cw},  m(\"span\", {\r\n                    class: \"cursor-pointer material-symbols-outlined\" + isFavcls, onclick: function (e) {\r\n                        e.preventDefault();\r\n                        page.favorite(p).then((b) => {\r\n                            m.redraw();\r\n                        });\r\n                        return false;\r\n                    }\r\n                }, \"favorite\"));\r\n            }\r\n            else if(h == \"_rowNum\"){\r\n                return m(\"td\", {class: cw}, (parseInt(ctl.pagination.pages().startRecord) + 1) + idx);\r\n            };\r\n            \r\n\r\n            return m(\"td\",{class: cw}, getFormattedValue(ctl, p, h));\r\n        }));\r\n    \r\n    }\r\n    \r\n    function getCellStyle(ctl, h){\r\n        let w = \"\";\r\n        if(h == \"_icon\" || h == \"id\" || h == \"_rowNum\"){\r\n            w = \"w-14\";\r\n        }\r\n        else if(h == \"_favorite\"){\r\n            w = \"w-12\"\r\n        }\r\n\r\n        if(h == \"id\" || h == \"_rowNum\"){\r\n            w += \" align-right\";\r\n        }\r\n        else{\r\n            w += \" align-center\";\r\n        }\r\n        return w;\r\n    }\r\n\r\n    function getFormattedValue(ctl, p, h){\r\n        if(h.match(/^_/)){\r\n            console.warn(\"Unhandled special column: \" + h);\r\n            return \"\";\r\n        }\r\n        let ah = h.split(\".\");\r\n        let lastFld;\r\n        let val;\r\n        let om = p;\r\n        for(let i = 0; i < ah.length; i++){\r\n            let um;\r\n            if(lastFld){\r\n                um = am7model.getModelField(lastFld.baseModel, ah[i]);\r\n            }\r\n            else{\r\n                um = am7model.getModelField(p[am7model.jsonModelKey], ah[i]);\r\n            }\r\n\r\n            if(!um){\r\n                console.warn(\"Couldn't find field\", ah[i]);\r\n                return;\r\n            }\r\n\r\n            if(um.type == \"timestamp\"){\r\n                //  { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' }\r\n                val = (om[um.name] ? \" \" + (new Date(om[um.name])).toLocaleDateString(\"en-US\", {year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric' }) : \"\");\r\n            }\r\n\r\n            else if(um.type == \"model\"){\r\n                if(!om[um.name]){\r\n                    console.warn(\"Couldn't find model for field\", um.name, \"in\", p);\r\n                    return \"\";\r\n                }\r\n                lastFld = um;\r\n                om = om[um.name];\r\n            }\r\n            else{\r\n                val = om[um.name];\r\n            }\r\n\r\n        }\r\n        return val;\r\n    }\r\n\r\n    function getTabularView(ctl, rset){\r\n        let results = (rset || []).map((p, i) => {\r\n          return getTabularRow(ctl, p, i);\r\n        });\r\n        if(results.length == 0){\r\n            return \"\";\r\n        }\r\n\r\n        let table = m(\"table\", { class: \"tabular-results-table\" }, [ getHeadersView(ctl), m(\"tbody\", results)]);\r\n\r\n\r\n        return m(\"div\", { rid: 'resultList', onscroll: ctl.onscroll, class: \"tabular-results-overflow\" },\r\n            table\r\n        );\r\n      }\r\n\r\n    function getGridListItem(ctl, p) {\r\n        let type = am7model.getModel(p[am7model.jsonModelKey]);\r\n        let ico = \"question_mark\";\r\n        let gridMode = ctl.gridMode;\r\n        let showInfo = ctl.info;\r\n        if (type && type.icon) ico = type.icon;\r\n        let icon = getThumbnail(ctl, p);\r\n\r\n        let cls = (gridMode == 1 ? \"image-grid-item-tile\" : \"image-grid-item-1\");\r\n        if (ctl.pagination.state(p).checked) {\r\n          cls += \" image-grid-item-active\";\r\n        }\r\n        let title = \"\";\r\n        let footer = \"\";\r\n        if (showInfo) {\r\n          title = m(\"p\", { class: \"card-title\" }, p.name);\r\n          if (ctl.showIconFooter) footer = m(\"p\", { class: \"card-footer\" }, 'footer');\r\n        }\r\n\r\n        let gridCellCls = \"image-grid-item-content-32\";\r\n        if (gridMode == 2) gridCellCls = \"image-grid-item-1\";\r\n        let attr = \"\";\r\n        let props = Object.assign(page.components.dnd.dragProps(p),{\r\n          ondblclick: function () {\r\n            if (ctl.containerMode) ctl.down(p);\r\n            else ctl.open(p);\r\n          },\r\n          onclick: function () {\r\n            ctl.select(p);\r\n          },\r\n          class: cls\r\n        });\r\n        attr = \"[draggable]\";\r\n\r\n        return m(\"div\" + attr, props, [title, m(\"div\", { class: gridCellCls }, icon), footer]);\r\n    }\r\n\r\n    function displayIndicators(ctl) {\r\n        let results = [];\r\n        let pages = ctl.pagination.pages();\r\n        if (pages.pageResults[pages.currentPage]) results = pages.pageResults[pages.currentPage].map((p, i) => {\r\n          let cls = \"material-symbols-outlined carousel-bullet\";\r\n          let ico = \"radio_button_unchecked\";\r\n          if (i == pages.currentItem) {\r\n            cls += \" carousel-bullet-active\";\r\n            ico = \"radio_button_checked\";\r\n          }\r\n          return m(\"li\", { onclick: function () { ctl.moveTo(i); }, class: \"carousel-indicator\" }, [\r\n            m(\"span\", { class: cls }, ico)\r\n          ]);\r\n        });\r\n  \r\n        return m(\"ul\", { class: \"carousel-indicators\" }, [\r\n          m(\"li\", { onclick: function () { ctl.pagination.prev(ctl.embeddedMode || ctl.pickerMode); }, class: \"carousel-indicator\" }, [\r\n            m(\"span\", { class: \"material-symbols-outlined carousel-bullet\" }, \"arrow_back\")\r\n          ]),\r\n          results,\r\n          m(\"li\", { onclick: function () { ctl.pagination.next(ctl.embeddedMode || ctl.pickerMode); }, class: \"carousel-indicator\" }, [\r\n            m(\"span\", { class: \"material-symbols-outlined carousel-bullet\" }, \"arrow_forward\")\r\n          ])\r\n        ]);\r\n      }\r\n\r\n      function displayObjects(ctl) {\r\n  \r\n        let results = [];\r\n        let pages = ctl.pagination.pages();\r\n        let pr = pages.pageResults[pages.currentPage];\r\n        /// let cls = 'carousel-item carousel-item-abs';\r\n        if (pr) {\r\n          results = pr.map((p, i) => {\r\n            return m(page.components.object, { view: ctl.listPage, app:undefined, object: p, model: ctl.listType, active: (pages.currentItem == i), maxMode: ctl.maxMode, inner: true });\r\n          });\r\n        }\r\n        return results;\r\n  \r\n      }\r\n\r\n    function getGridListView(ctl) {\r\n        let results = [];\r\n        let gridMode = ctl.gridMode;\r\n        let pages = ctl.pagination.pages();\r\n        if (pages.pageResults[pages.currentPage]) results = pages.pageResults[pages.currentPage].map((p, i) => {\r\n         return getGridListItem(ctl, p);\r\n        });\r\n  \r\n        return m(\"div\", { class: 'h-full overflow-hidden' }, m(\"div\", { class: (gridMode == 1 ? 'image-grid-tile' : 'image-grid-5') }, results));\r\n    }\r\n    function getCarouselItem(ctl) {\r\n        let pages = ctl.pagination.pages();\r\n        let pr = ctl.results();\r\n        let uimarkers = [];\r\n        if (!ctl.embeddedMode || ctl.fullMode) {\r\n            uimarkers = [\r\n            m(\"span\", { onclick: ctl.toggleCarouselFull, class: \"carousel-full\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, (ctl.fullMode ? \"close_fullscreen\" : \"open_in_new\"))]),\r\n            m(\"span\", { onclick: ctl.toggleCarouselMax, class: \"carousel-max\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, (ctl.maxMode ? \"photo_size_select_small\" : \"aspect_ratio\"))]),\r\n            m(\"span\", { onclick: ctl.toggleInfo, class: \"carousel-info\" }, [m(\"span\", { class: \"material-symbols-outlined\" + (ctl.info ? \"\" : \"-outlined\") }, (ctl.info ? \"info\" : \"info\"))]),\r\n            m(\"span\", { onclick: function () { ctl.edit(pr[pages.currentItem]); }, class: \"carousel-edit\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, \"edit\")]),\r\n            m(\"span\", { onclick: ctl.toggleCarousel, class: \"carousel-exit\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, \"close\")]),\r\n            m(\"span\", { onclick: function () { ctl.move(-1); }, class: \"carousel-prev\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, \"arrow_back\")]),\r\n            m(\"span\", { onclick: function () { ctl.move(1); }, class: \"carousel-next\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, \"arrow_forward\")]),\r\n            ];\r\n        }\r\n        return m(\"div\", { class: \"carousel\" }, [\r\n            m(\"div\", { class: \"carousel-inner\" },\r\n            [\r\n                displayObjects(ctl),\r\n                uimarkers,\r\n                displayIndicators(ctl)\r\n            ]\r\n            )\r\n        ]);\r\n\r\n    }\r\n\r\n    function getCarouselView(ctl) {\r\n\r\n        /// set the current item value to the end of the array when paginating back while in carousel mode\r\n        // console.log(\"Current item: \" + pages.currentItem + \" / \" + pagination.requesting);\r\n        return m(\"div\", { class: \"content-outer\" }, [(ctl.fullMode ? \"\" : m(page.components.navigation)),\r\n        m(\"div\", { class: \"content-main\" }, [\r\n          getCarouselItem(ctl)\r\n        ])\r\n        ]);\r\n      }\r\n    \r\n\r\n    let am7dec = {\r\n        map: () => defaultHeaderMap,\r\n        icon: getIcon,\r\n        fileIcon: getFileTypeIcon,\r\n        tabularView: getTabularView,\r\n        polarListItem: getPolarListItem,\r\n        polarListView: getPolarListView,\r\n        gridListView: getGridListView,\r\n        gridListItem: getGridListItem,\r\n        carouselView: getCarouselView,\r\n        carouselItem: getCarouselItem\r\n    };\r\n\r\n    if (typeof module != \"undefined\") {\r\n        module.am7decorator = am7dec;\r\n    } else {\r\n        window.am7decorator = am7dec;\r\n    }\r\n}());\n\n;/* === client/chat.js === */\n(function () {\r\n\r\n    async function deleteChat(s, force, fHandler) {\r\n        async function chatHandler() {\r\n            if (s.session) {\r\n            let q = am7client.newQuery(s.sessionType);\r\n            q.field(\"id\", s.session.id);\r\n            try {\r\n                let qr = await page.search(q);\r\n                if (qr && qr.results && qr.results.length > 0) {\r\n                page.toast(\"info\", \"Deleting session data - \" + qr.results[0].objectId);\r\n                await page.deleteObject(s.sessionType, qr.results[0].objectId);\r\n                }\r\n                else {\r\n                page.toast(\"error\", \"Failed to find session data to delete\", 5000);\r\n                console.error(\"Failed to delete session data\", qr);\r\n                }\r\n            }\r\n            catch (e) {\r\n                page.toast(\"error\", \"Error deleting session data\", 5000);\r\n                console.error(\"Error deleting session data\", e);\r\n            }\r\n\r\n            }\r\n            else {\r\n            console.warn(\"No session data found\");\r\n            }\r\n            // console.log(\"Deleting request\", s.objectId);\r\n            await page.deleteObject(s[am7model.jsonModelKey], s.objectId);\r\n            if (fHandler) fHandler(s);\r\n        }\r\n        if(!force){\r\n            page.components.dialog.confirm(\"Delete chat \" + s + \"?\", chatHandler);\r\n        }\r\n        else{\r\n            chatHandler();\r\n        }\r\n    }\r\n\r\n\r\n    async function getChatRequest(requestName, chatCfg, promptCfg) {\r\n        let grp = await page.findObject(\"auth.group\", \"data\", \"~/ChatRequests\");\r\n        let q = am7view.viewQuery(am7model.newInstance(\"olio.llm.chatRequest\", am7model.forms.chatRequest));\r\n        q.field(\"groupId\", grp.id);\r\n        q.field(\"name\", requestName);\r\n        q.cache(false);\r\n        q.entity.request.push(\"session\", \"sessionType\", \"chatConfig\", \"promptConfig\", \"objectId\");\r\n        let req;\r\n        let qr = await page.search(q);\r\n        if (!qr || !qr.results || qr.results.length == 0) {\r\n            let chatReq = {\r\n                schema: \"olio.llm.chatRequest\",\r\n                name: requestName,\r\n                chatConfig: { objectId: chatCfg.objectId },\r\n                promptConfig: { objectId: promptCfg.objectId },\r\n                uid: page.uid()\r\n            };\r\n\r\n            req = await m.request({ method: 'POST', url: g_application_path + \"/rest/chat/new\", withCredentials: true, body: chatReq });\r\n        }\r\n        else if (qr && qr.results && qr.results.length > 0) {\r\n            req = qr.results[0];\r\n        }\r\n        console.log(req);\r\n\r\n        return req;\r\n\r\n    }\r\n\r\n    async function makeChat(sName, sModel, sServerUrl, sServiceType){\r\n        let grp = await page.findObject(\"auth.group\", \"data\", \"~/Chat\");\r\n        let q = am7view.viewQuery(am7model.newInstance(\"olio.llm.chatConfig\"));\r\n        q.field(\"groupId\", grp.id);\r\n        q.field(\"name\", sName);\r\n        q.cache(false);\r\n        let cfg;\r\n        let qr = await page.search(q);\r\n        if(!qr || !qr.results || qr.results.length == 0){\r\n            let icfg = am7model.newInstance(\"olio.llm.chatConfig\");\r\n            icfg.api.groupId(grp.id);\r\n            icfg.api.groupPath(grp.path);\r\n            icfg.api.name(sName);\r\n            icfg.api.model(sModel);\r\n            icfg.api.messageTrim(6);\r\n            icfg.api.serverUrl(sServerUrl);\r\n            icfg.api.serviceType(sServiceType);\r\n            await page.createObject(icfg.entity);\r\n            qr = await page.search(q);\r\n        }\r\n        if(qr?.results.length > 0){\r\n            cfg = qr.results[0];\r\n        }\r\n\r\n        if(!cfg){\r\n            page.toast(\"Error\", \"Could not create chat config\");\r\n        }\r\n\r\n        return cfg;\r\n    }\r\n\r\n    async function makePrompt(sName, aSystem){\r\n        let grp = await page.findObject(\"auth.group\", \"data\", \"~/Chat\");\r\n        let q = am7view.viewQuery(am7model.newInstance(\"olio.llm.promptConfig\"));\r\n        q.field(\"groupId\", grp.id);\r\n        q.field(\"name\", sName);\r\n        q.cache(false);\r\n        let cfg;\r\n        let qr = await page.search(q);\r\n        if(!qr || !qr.results || qr.results.length == 0){\r\n            let icfg = am7model.newInstance(\"olio.llm.promptConfig\");\r\n            icfg.api.groupId(grp.id);\r\n            icfg.api.groupPath(grp.path);\r\n            icfg.api.name(sName);\r\n            icfg.entity.system = aSystem;\r\n            await page.createObject(icfg.entity);\r\n            qr = await page.search(q);\r\n        }\r\n        if(qr?.results.length > 0){\r\n            cfg = qr.results[0];\r\n        }\r\n\r\n        if(!cfg){\r\n            page.toast(\"Error\", \"Could not create prompt config\");\r\n        }\r\n\r\n        return cfg;\r\n    }\r\n\r\n    async function chat(chat, msg) {\r\n        if (!chat) {\r\n            page.toast(\"error\", \"Chat request is not defined.\");\r\n            return;\r\n        }\r\n        if (!chat.chatConfig || !chat.promptConfig) {\r\n            page.toast(\"error\", \"Chat request is missing the prompt or chat config.\");\r\n            return;\r\n        }\r\n        chat.message = msg;\r\n        chat.uid = page.uid();\r\n        //console.log(chat);\r\n        return await m.request({ method: 'POST', url: g_application_path + \"/rest/chat/text\", withCredentials: true, body: chat });\r\n    }\r\n\r\n    let am7chat = {\r\n        makePrompt,\r\n        makeChat,\r\n        getChatRequest,\r\n        deleteChat,\r\n        chat\r\n    };\r\n\r\n    if (typeof module != \"undefined\") {\r\n        module.am7chat = am7chat;\r\n    } else {\r\n        window.am7chat = am7chat;\r\n    }\r\n}());\n\n;/* === client/view/cardGame/constants/gameConstants.js === */\n/**\r\n * CardGame Constants  All game configuration, type definitions, and balance data\r\n * Extracted from the monolithic cardGame-v2.js into a standalone module.\r\n *\r\n * Exposes: window.CardGame.Constants\r\n */\r\n(function() {\r\n\r\n    window.CardGame = window.CardGame || {};\r\n\r\n    //  Card Type Configuration \r\n    const CARD_TYPES = {\r\n        character:  { color: \"#B8860B\", bg: \"#FDF5E6\", icon: \"shield\",        label: \"Character\" },\r\n        apparel:    { color: \"#808080\", bg: \"#F5F5F5\", icon: \"checkroom\",      label: \"Apparel\" },\r\n        item:       { color: \"#2E7D32\", bg: \"#F1F8E9\", icon: \"swords\",         label: \"Item\" },\r\n        action:     { color: \"#C62828\", bg: \"#FFF3F0\", icon: \"bolt\",           label: \"Action\" },\r\n        talk:       { color: \"#1565C0\", bg: \"#E3F2FD\", icon: \"chat_bubble\",    label: \"Talk\" },\r\n        encounter:  { color: \"#6A1B9A\", bg: \"#F3E5F5\", icon: \"blur_on\",       label: \"Encounter\" },\r\n        skill:      { color: \"#E65100\", bg: \"#FFF3E0\", icon: \"star\",           label: \"Skill\" },\r\n        magic:      { color: \"#00695C\", bg: \"#E0F2F1\", icon: \"auto_fix_high\",  label: \"Magic Effect\" }\r\n    };\r\n\r\n    //  Template/Utility Art Types \r\n    const TEMPLATE_TYPES = {\r\n        cardFront:  { color: \"#795548\", icon: \"crop_portrait\",    label: \"Card Front\" },\r\n        cardBack:   { color: \"#546E7A\", icon: \"flip_to_back\",     label: \"Card Back\" },\r\n        background: { color: \"#33691E\", icon: \"landscape\",        label: \"Background\" },\r\n        tabletop:   { color: \"#5D4037\", icon: \"table_restaurant\", label: \"Tabletop\" }\r\n    };\r\n\r\n    //  Sub-Icons for Item Subtypes \r\n    const ITEM_SUBTYPE_ICONS = {\r\n        weapon:     \"swords\",\r\n        consumable: \"science\"\r\n    };\r\n\r\n    //  Card Render Configuration (Phase 7.0 consolidation) \r\n    // Defines fields to render for each card type\r\n    const CARD_RENDER_CONFIG = {\r\n        apparel: {\r\n            placeholderIcon: \"checkroom\",\r\n            headerField: { field: \"slot\", default: \"Body\", icon: \"back_hand\", showRarity: true },\r\n            details: [\r\n                { type: \"stats\", fields: [\"def\", \"hpBonus\"], labels: { def: \"DEF +\", hpBonus: \"HP +\" } },\r\n                { field: \"special\", icon: \"auto_awesome\" },\r\n                { field: \"flavor\", type: \"flavor\" }\r\n            ],\r\n            footer: [{ field: \"durability\", icon: \"build\", suffix: \" Dur\", default: \"\\u221E\" }]\r\n        },\r\n        weapon: {\r\n            placeholderIcon: \"swords\",\r\n            headerField: { field: \"slot\", default: \"Hand (1H)\", icon: \"back_hand\", showRarity: true },\r\n            details: [\r\n                { type: \"stats\", fields: [\"atk\", \"range\"], labels: { atk: \"ATK +\" }, defaults: { range: \"Melee\" }, atkClass: \"cg2-mod-atk\" },\r\n                { field: \"damageType\", icon: \"flash_on\", default: \"Slashing\" },\r\n                { field: \"requires\", icon: \"key\", type: \"requires\" },\r\n                { field: \"special\", icon: \"auto_awesome\" }\r\n            ],\r\n            footer: [{ field: \"durability\", icon: \"build\", suffix: \" Dur\", default: \"\\u221E\" }]\r\n        },\r\n        consumable: {\r\n            placeholderIcon: \"science\",\r\n            headerField: { label: \"Consumable\", icon: \"science\", showRarity: true },\r\n            details: [\r\n                { field: \"effect\", icon: \"auto_awesome\" },\r\n                { type: \"warning\", text: \"USE IT OR LOSE IT\" }\r\n            ],\r\n            footer: []\r\n        },\r\n        action: {\r\n            placeholderIcon: \"bolt\",\r\n            placeholderColor: \"#C62828\",\r\n            details: [\r\n                { field: \"actionType\", icon: \"category\", default: \"Offensive\" },\r\n                { field: \"stackWith\", icon: \"layers\" },\r\n                { field: \"roll\", icon: \"casino\", class: \"cg2-roll\" },\r\n                { field: \"onHit\", icon: \"gps_fixed\" }\r\n            ],\r\n            footer: [{ field: \"energyCost\", icon: \"bolt\", suffix: \" Energy\", default: 0, class: \"cg2-energy-cost\" }]\r\n        },\r\n        talk: {\r\n            placeholderIcon: \"chat_bubble\",\r\n            placeholderColor: \"#1565C0\",\r\n            details: [\r\n                { label: \"Social\", icon: \"category\" },\r\n                { label: \"LLM chat + CHA mod\", icon: \"computer\" },\r\n                { label: \"1d20 + CHA vs target\", icon: \"casino\" },\r\n                { label: \"Required for communication\", icon: \"block\", class: \"cg2-card-warning\" }\r\n            ],\r\n            footer: [{ field: \"energyCost\", icon: \"bolt\", suffix: \" Energy\", default: 5, class: \"cg2-energy-cost\" }]\r\n        },\r\n        encounter: {\r\n            placeholderIcon: \"blur_on\",\r\n            placeholderColor: \"#6A1B9A\",\r\n            headerField: { field: \"subtype\", default: \"Threat\", icon: \"warning\", showRarity: true },\r\n            details: [\r\n                { field: \"difficulty\", icon: \"signal_cellular_alt\", prefix: \"DC \" },\r\n                { type: \"stats\", fields: [\"atk\", \"def\", \"hp\"], labels: { atk: \"ATK +\", def: \"DEF +\", hp: \"HP \" }, atkClass: \"cg2-mod-atk\" },\r\n                { field: \"behavior\", icon: \"psychology_alt\" },\r\n                { field: \"loot\", icon: \"inventory_2\", type: \"array\" }\r\n            ],\r\n            footer: []\r\n        },\r\n        skill: {\r\n            placeholderIcon: \"star\",\r\n            placeholderColor: \"#E65100\",\r\n            details: [\r\n                { field: \"category\", icon: \"psychology\", default: \"Combat\" },\r\n                { field: \"modifier\", icon: \"tune\" },\r\n                { field: \"requires\", icon: \"key\", type: \"requires\" },\r\n                { field: \"tier\", icon: \"military_tech\" }\r\n            ],\r\n            footer: [{ label: \"Unlimited\", icon: \"all_inclusive\", class: \"cg2-uses\" }]\r\n        },\r\n        magic: {\r\n            placeholderIcon: \"auto_fix_high\",\r\n            placeholderColor: \"#00695C\",\r\n            details: [\r\n                { field: \"effectType\", icon: \"category\", default: \"Offensive\" },\r\n                { field: \"skillType\", icon: \"psychology\", default: \"Imperial\" },\r\n                { field: \"requires\", icon: \"key\", type: \"requires\" },\r\n                { field: \"effect\", icon: \"auto_awesome\" },\r\n                { field: \"stackWith\", icon: \"layers\" }\r\n            ],\r\n            footer: [\r\n                { field: \"energyCost\", icon: \"bolt\", suffix: \" Energy\", default: 0, class: \"cg2-energy-cost\" },\r\n                { field: \"reusable\", icon: \"sync\", altIcon: \"local_fire_department\", trueLabel: \"Reusable\", falseLabel: \"Consumable\" }\r\n            ]\r\n        }\r\n    };\r\n\r\n    //  Game Phases \r\n    const GAME_PHASES = {\r\n        INITIATIVE: \"initiative\",\r\n        EQUIP: \"equip\",\r\n        THREAT_RESPONSE: \"threat_response\",  // Phase for responding to beginning/end threats\r\n        DRAW_PLACEMENT: \"draw_placement\",\r\n        RESOLUTION: \"resolution\",\r\n        CLEANUP: \"cleanup\",\r\n        END_THREAT: \"end_threat\"  // Phase for responding to end-of-round threats\r\n    };\r\n\r\n    //  Status Effects \r\n    const STATUS_EFFECTS = {\r\n        STUNNED: {\r\n            id: \"stunned\",\r\n            name: \"Stunned\",\r\n            icon: \"star\",\r\n            color: \"#FFC107\",\r\n            description: \"Skip next action\",\r\n            duration: 1,\r\n            durationType: \"turns\"\r\n        },\r\n        POISONED: {\r\n            id: \"poisoned\",\r\n            name: \"Poisoned\",\r\n            icon: \"skull\",\r\n            color: \"#8BC34A\",\r\n            description: \"-2 HP at turn start\",\r\n            duration: 3,\r\n            durationType: \"turns\",\r\n            onTurnStart: (actor) => {\r\n                actor.hp = Math.max(0, actor.hp - 2);\r\n                return { message: \"Poison deals 2 damage\", damage: 2 };\r\n            }\r\n        },\r\n        SHIELDED: {\r\n            id: \"shielded\",\r\n            name: \"Shielded\",\r\n            icon: \"shield\",\r\n            color: \"#2196F3\",\r\n            description: \"+3 DEF\",\r\n            duration: 1,\r\n            durationType: \"untilHit\",\r\n            defBonus: 3\r\n        },\r\n        WEAKENED: {\r\n            id: \"weakened\",\r\n            name: \"Weakened\",\r\n            icon: \"trending_down\",\r\n            color: \"#9C27B0\",\r\n            description: \"-2 to all rolls\",\r\n            duration: 2,\r\n            durationType: \"turns\",\r\n            rollPenalty: -2\r\n        },\r\n        ENRAGED: {\r\n            id: \"enraged\",\r\n            name: \"Enraged\",\r\n            icon: \"local_fire_department\",\r\n            color: \"#F44336\",\r\n            description: \"+3 ATK, -2 DEF\",\r\n            duration: 2,\r\n            durationType: \"turns\",\r\n            atkBonus: 3,\r\n            defPenalty: -2\r\n        },\r\n        BURNING: {\r\n            id: \"burning\",\r\n            name: \"Burning\",\r\n            icon: \"whatshot\",\r\n            color: \"#FF5722\",\r\n            description: \"-3 HP at turn start\",\r\n            duration: 2,\r\n            durationType: \"turns\",\r\n            onTurnStart: (actor) => {\r\n                actor.hp = Math.max(0, actor.hp - 3);\r\n                return { message: \"Burn deals 3 damage\", damage: 3 };\r\n            }\r\n        },\r\n        BLEEDING: {\r\n            id: \"bleeding\",\r\n            name: \"Bleeding\",\r\n            icon: \"water_drop\",\r\n            color: \"#E53935\",\r\n            description: \"-1 HP at turn start\",\r\n            duration: 4,\r\n            durationType: \"turns\",\r\n            onTurnStart: (actor) => {\r\n                actor.hp = Math.max(0, actor.hp - 1);\r\n                return { message: \"Bleed deals 1 damage\", damage: 1 };\r\n            }\r\n        },\r\n        REGENERATING: {\r\n            id: \"regenerating\",\r\n            name: \"Regenerating\",\r\n            icon: \"spa\",\r\n            color: \"#4CAF50\",\r\n            description: \"+2 HP at turn start\",\r\n            duration: 3,\r\n            durationType: \"turns\",\r\n            onTurnStart: (actor) => {\r\n                actor.hp = Math.min(actor.maxHp, actor.hp + 2);\r\n                return { message: \"Regen restores 2 HP\", damage: 0 };\r\n            }\r\n        },\r\n        FORTIFIED: {\r\n            id: \"fortified\",\r\n            name: \"Fortified\",\r\n            icon: \"fort\",\r\n            color: \"#1565C0\",\r\n            description: \"+2 DEF, +1 ATK\",\r\n            duration: 2,\r\n            durationType: \"turns\",\r\n            defBonus: 2,\r\n            atkBonus: 1\r\n        },\r\n        INSPIRED: {\r\n            id: \"inspired\",\r\n            name: \"Inspired\",\r\n            icon: \"auto_awesome\",\r\n            color: \"#FFB300\",\r\n            description: \"+2 to all rolls\",\r\n            duration: 2,\r\n            durationType: \"turns\",\r\n            rollBonus: 2\r\n        }\r\n    };\r\n\r\n    //  Combat Outcomes \r\n    const COMBAT_OUTCOMES = {\r\n        CRITICAL_HIT:    { label: \"Critical Hit!\", damageMultiplier: 2, effect: \"Nat 20! Double damage + reward card\", isCriticalHit: true },\r\n        DEVASTATING:     { label: \"Devastating!\", damageMultiplier: 1.5, effect: \"massive damage\" },\r\n        STRONG_HIT:      { label: \"Strong Hit\", damageMultiplier: 1, effect: \"full damage\" },\r\n        GLANCING_HIT:    { label: \"Glancing Hit\", damageMultiplier: 0.5, effect: \"half damage\" },\r\n        CLASH:           { label: \"Clash!\", damageMultiplier: 0, effect: \"both take 1 damage\", bothTakeDamage: 1 },\r\n        DEFLECT:         { label: \"Deflected\", damageMultiplier: 0, effect: \"no damage\" },\r\n        PARRY:           { label: \"Parried!\", damageMultiplier: 0, effect: \"defender may counter\", allowCounter: true },\r\n        CRITICAL_PARRY:  { label: \"Perfect Parry!\", damageMultiplier: -0.25, effect: \"Nat 20! Counter attack + reward card\", isCriticalParry: true, allowCounter: true },\r\n        CRITICAL_MISS:   { label: \"Critical Miss!\", damageMultiplier: -0.5, effect: \"Nat 1! Attacker takes damage + stunned\", isCriticalCounter: true }\r\n    };\r\n\r\n    //  Card Templates (for new card creation in deck builder) \r\n    const CARD_TEMPLATES = {\r\n        action: {\r\n            type: \"action\", name: \"\", actionType: \"Offensive\",\r\n            stackWith: \"\", roll: \"\", onHit: \"\", energyCost: 0\r\n        },\r\n        \"item-weapon\": {\r\n            type: \"item\", subtype: \"weapon\", name: \"\", fabric: \"\",\r\n            slot: \"Hand (1H)\", rarity: \"COMMON\", atk: 3, range: \"Melee\",\r\n            damageType: \"Slashing\", requires: {}, special: null, durability: 8\r\n        },\r\n        \"item-consumable\": {\r\n            type: \"item\", subtype: \"consumable\", name: \"\", fabric: \"\",\r\n            rarity: \"COMMON\", effect: \"\"\r\n        },\r\n        apparel: {\r\n            type: \"apparel\", name: \"\", fabric: \"\",\r\n            slot: \"Body\", rarity: \"COMMON\", def: 1, hpBonus: 0,\r\n            durability: 5, special: null\r\n        },\r\n        skill: {\r\n            type: \"skill\", name: \"\", category: \"Combat\",\r\n            modifier: \"\", requires: {}, tier: \"COMMON\"\r\n        },\r\n        magic: {\r\n            type: \"magic\", name: \"\", effectType: \"Offensive\",\r\n            skillType: \"Imperial\", requires: {},\r\n            effect: \"\", stackWith: \"\", energyCost: 4, reusable: true\r\n        }\r\n    };\r\n\r\n    //  Theme Defaults \r\n    const THEME_DEFAULTS = {\r\n        \"high-fantasy\": {\r\n            name: \"High Fantasy\",\r\n            backgroundPrompt: \"Vast fantasy kingdom with ancient stone castles, enchanted forests, magical aurora in the sky, crystalline mountains, epic fantasy landscape\",\r\n            promptSuffix: \"high fantasy, vibrant colors, detailed illustration\"\r\n        },\r\n        \"dark-medieval\": {\r\n            name: \"Dark Medieval\",\r\n            backgroundPrompt: \"Grim medieval fortress on a windswept moor, dark stone walls, overcast stormy skies, torchlit battlements, desolate and foreboding landscape\",\r\n            promptSuffix: \"dark medieval, muted earth tones, gritty realism\"\r\n        },\r\n        \"sci-fi\": {\r\n            name: \"Sci-Fi\",\r\n            backgroundPrompt: \"Futuristic space station orbiting a gas giant, nebula backdrop, holographic displays, chrome corridors, sweeping sci-fi vista\",\r\n            promptSuffix: \"science fiction, cinematic lighting, sleek futuristic design\"\r\n        },\r\n        \"post-apocalypse\": {\r\n            name: \"Post Apocalypse\",\r\n            backgroundPrompt: \"Ruined cityscape overgrown with vegetation, crumbling skyscrapers, dusty wasteland, abandoned vehicles, harsh survival outpost\",\r\n            promptSuffix: \"post-apocalyptic, desaturated palette, gritty detail\"\r\n        }\r\n    };\r\n\r\n    //  Default Theme Configuration \r\n    const DEFAULT_THEME = {\r\n        themeId: \"high-fantasy\",\r\n        name: \"High Fantasy\",\r\n        version: \"1.0\",\r\n        artStyle: {\r\n            backgroundPrompt: THEME_DEFAULTS[\"high-fantasy\"].backgroundPrompt,\r\n            promptSuffix: THEME_DEFAULTS[\"high-fantasy\"].promptSuffix,\r\n            colorPalette: {\r\n                character: \"#B8860B\", apparel: \"#808080\", item: \"#2E7D32\",\r\n                action: \"#C62828\", talk: \"#1565C0\", encounter: \"#6A1B9A\",\r\n                skill: \"#E65100\", magic: \"#00695C\"\r\n            }\r\n        },\r\n        balance: {\r\n            hpMax: 20, moraleMax: 20,\r\n            apFormula: \"floor(END / 5) + 1\",\r\n            initiativeFormula: \"1d20 + AGI\"\r\n        }\r\n    };\r\n\r\n    //  Level-Up Stats and Descriptions \r\n    const LEVEL_UP_STATS = [\"STR\", \"AGI\", \"END\", \"INT\", \"MAG\", \"CHA\"];\r\n\r\n    const STAT_DESCRIPTIONS = {\r\n        STR: \"Strength \\u2014 melee damage\",\r\n        AGI: \"Agility \\u2014 initiative rolls\",\r\n        END: \"Endurance \\u2014 action points\",\r\n        INT: \"Intelligence \\u2014 skill effects\",\r\n        MAG: \"Magic \\u2014 energy pool & spells\",\r\n        CHA: \"Charisma \\u2014 talk & morale\"\r\n    };\r\n\r\n    //  Expose on CardGame namespace \r\n    window.CardGame.Constants = {\r\n        CARD_TYPES,\r\n        TEMPLATE_TYPES,\r\n        ITEM_SUBTYPE_ICONS,\r\n        CARD_RENDER_CONFIG,\r\n        GAME_PHASES,\r\n        STATUS_EFFECTS,\r\n        COMBAT_OUTCOMES,\r\n        CARD_TEMPLATES,\r\n        THEME_DEFAULTS,\r\n        DEFAULT_THEME,\r\n        LEVEL_UP_STATS,\r\n        STAT_DESCRIPTIONS\r\n    };\r\n\r\n    console.log('[CardGame] Constants loaded (' + Object.keys(window.CardGame.Constants).length + ' exports)');\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/state/storage.js === */\n(function() {\r\n    \"use strict\";\r\n\r\n    //  data.data CRUD Helpers \r\n    // Shared utilities for all storage objects (deck, game saves, campaign)\r\n    const DECK_BASE_PATH = \"~/CardGame\";\r\n\r\n    function encodeJson(data) {\r\n        return btoa(unescape(encodeURIComponent(JSON.stringify(data))));\r\n    }\r\n    function decodeJson(encoded) {\r\n        return JSON.parse(decodeURIComponent(escape(atob(encoded))));\r\n    }\r\n\r\n    // Upsert a named data.data record in a group (create-or-update pattern)\r\n    async function upsertDataRecord(groupPath, fileName, data) {\r\n        let grp = await page.makePath(\"auth.group\", \"DATA\", groupPath);\r\n        if (!grp) { console.error(\"[CardGame v2] Could not create group:\", groupPath); return null; }\r\n        let encoded = encodeJson(data);\r\n\r\n        let q = am7view.viewQuery(\"data.data\");\r\n        q.field(\"groupId\", grp.id);\r\n        q.field(\"name\", fileName);\r\n        let qr = await page.search(q);\r\n\r\n        if (qr?.results?.length) {\r\n            let existing = qr.results[0];\r\n            existing.dataBytesStore = encoded;\r\n            existing.compressionType = \"none\";\r\n            return await page.patchObject(existing);\r\n        }\r\n        let obj = am7model.newPrimitive(\"data.data\");\r\n        obj.name = fileName;\r\n        obj.contentType = \"application/json\";\r\n        obj.compressionType = \"none\";\r\n        obj.groupId = grp.id;\r\n        obj.groupPath = grp.path;\r\n        obj.dataBytesStore = encoded;\r\n        return await page.createObject(obj);\r\n    }\r\n\r\n    // Load a named data.data record from a group\r\n    async function loadDataRecord(groupPath, fileName, createGroup) {\r\n        let grp = createGroup\r\n            ? await page.makePath(\"auth.group\", \"DATA\", groupPath)\r\n            : await page.findObject(\"auth.group\", \"DATA\", groupPath);\r\n        if (!grp) return null;\r\n        let q = am7view.viewQuery(\"data.data\");\r\n        q.field(\"groupId\", grp.id);\r\n        q.field(\"name\", fileName);\r\n        let qr = await page.search(q);\r\n        if (qr?.results?.length && qr.results[0].dataBytesStore) {\r\n            return decodeJson(qr.results[0].dataBytesStore);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    // Query all data.data records in a group\r\n    async function listDataRecords(groupPath) {\r\n        let grp = await page.findObject(\"auth.group\", \"DATA\", groupPath);\r\n        if (!grp) return [];\r\n        let q = am7view.viewQuery(\"data.data\");\r\n        q.field(\"groupId\", grp.id);\r\n        let qr = await page.search(q);\r\n        return qr?.results || [];\r\n    }\r\n\r\n    //  Deck Storage \r\n    const deckStorage = {\r\n        async save(deckName, data) {\r\n            try {\r\n                let saved = await upsertDataRecord(DECK_BASE_PATH + \"/\" + deckName, \"deck.json\", data);\r\n                console.log(\"[CardGame v2] Deck saved:\", deckName);\r\n                return saved;\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to save deck:\", deckName, e);\r\n                return null;\r\n            }\r\n        },\r\n\r\n        async load(deckName) {\r\n            try {\r\n                return await loadDataRecord(DECK_BASE_PATH + \"/\" + deckName, \"deck.json\", true);\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to load deck:\", deckName, e);\r\n                return null;\r\n            }\r\n        },\r\n\r\n        async list() {\r\n            try {\r\n                let grp = await page.makePath(\"auth.group\", \"DATA\", DECK_BASE_PATH);\r\n                if (!grp) return [];\r\n                let q = am7view.viewQuery(\"auth.group\");\r\n                q.field(\"parentId\", grp.id);\r\n                let qr = await page.search(q);\r\n                return (qr?.results || []).map(g => g.name);\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to list decks:\", e);\r\n                return [];\r\n            }\r\n        },\r\n\r\n        async remove(deckName) {\r\n            try {\r\n                let grp = await page.findObject(\"auth.group\", \"DATA\", DECK_BASE_PATH + \"/\" + deckName);\r\n                if (!grp) return false;\r\n                await page.deleteObject(\"auth.group\", grp.objectId);\r\n                console.log(\"[CardGame v2] Deck removed:\", deckName);\r\n                return true;\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to remove deck:\", deckName, e);\r\n                return false;\r\n            }\r\n        }\r\n    };\r\n\r\n    //  Game Save Storage \r\n    // Auto-saves game state to ~/CardGame/{deckName}/saves/ with rolling backups\r\n\r\n    function serializeGameState(state) {\r\n        let s = JSON.parse(JSON.stringify(state));\r\n        // Strip non-serializable / transient fields\r\n        delete s.turnTimer;\r\n        delete s.narrationText;\r\n        delete s.narrationTime;\r\n        return s;\r\n    }\r\n\r\n    function deserializeGameState(saveData) {\r\n        let state = saveData.gameState;\r\n        state.turnTimer = null;\r\n        state.narrationText = null;\r\n        state.narrationTime = null;\r\n        state.isPaused = false;\r\n        return state;\r\n    }\r\n\r\n    const gameStorage = {\r\n        _savesPath(deckName) { return DECK_BASE_PATH + \"/\" + deckName + \"/saves\"; },\r\n\r\n        async save(deckName, state) {\r\n            try {\r\n                let saveData = {\r\n                    version: 1,\r\n                    timestamp: new Date().toISOString(),\r\n                    deckName,\r\n                    roundNumber: state.round,\r\n                    phase: state.phase,\r\n                    gameState: serializeGameState(state)\r\n                };\r\n                let groupPath = this._savesPath(deckName);\r\n                let grp = await page.makePath(\"auth.group\", \"DATA\", groupPath);\r\n                if (!grp) return null;\r\n\r\n                let obj = am7model.newPrimitive(\"data.data\");\r\n                obj.name = \"save-\" + Date.now() + \".json\";\r\n                obj.contentType = \"application/json\";\r\n                obj.compressionType = \"none\";\r\n                obj.groupId = grp.id;\r\n                obj.groupPath = grp.path;\r\n                obj.dataBytesStore = encodeJson(saveData);\r\n                let saved = await page.createObject(obj);\r\n\r\n                // Keep only last 3 saves\r\n                await this.cleanupOldSaves(deckName, 3);\r\n                return saved;\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to save game:\", deckName, e);\r\n                return null;\r\n            }\r\n        },\r\n\r\n        async load(deckName) {\r\n            try {\r\n                let saves = await this.list(deckName);\r\n                if (saves.length === 0) return null;\r\n                let latest = saves[0];\r\n                if (latest.dataBytesStore) {\r\n                    return decodeJson(latest.dataBytesStore);\r\n                }\r\n                return null;\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to load game save:\", deckName, e);\r\n                return null;\r\n            }\r\n        },\r\n\r\n        async list(deckName) {\r\n            try {\r\n                let records = await listDataRecords(this._savesPath(deckName));\r\n                return records\r\n                    .filter(r => r.name?.startsWith(\"save-\"))\r\n                    .sort((a, b) => b.name.localeCompare(a.name));\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to list saves:\", deckName, e);\r\n                return [];\r\n            }\r\n        },\r\n\r\n        async deleteAll(deckName) {\r\n            try {\r\n                let grp = await page.findObject(\"auth.group\", \"DATA\", this._savesPath(deckName));\r\n                if (grp) await page.deleteObject(\"auth.group\", grp.objectId);\r\n            } catch (e) {\r\n                console.warn(\"[CardGame v2] Failed to delete saves:\", deckName, e);\r\n            }\r\n        },\r\n\r\n        async cleanupOldSaves(deckName, keepCount) {\r\n            try {\r\n                let saves = await this.list(deckName);\r\n                for (let i = keepCount; i < saves.length; i++) {\r\n                    await page.deleteObject(\"data.data\", saves[i].objectId);\r\n                }\r\n            } catch (e) {\r\n                console.warn(\"[CardGame v2] Save cleanup failed:\", e);\r\n            }\r\n        }\r\n    };\r\n\r\n    //  Campaign Storage \r\n    // Persists character progression across games at ~/CardGame/{deckName}/campaign.json\r\n\r\n    function createCampaignData(characterCard) {\r\n        return {\r\n            version: 1,\r\n            characterId: characterCard.sourceId || characterCard._tempId || null,\r\n            characterName: characterCard.name || \"Unknown\",\r\n            level: 1,\r\n            xp: 0,\r\n            totalGamesPlayed: 0,\r\n            wins: 0,\r\n            losses: 0,\r\n            statGains: {},\r\n            pendingLevelUps: 0\r\n        };\r\n    }\r\n\r\n    const campaignStorage = {\r\n        async save(deckName, campaignData) {\r\n            try {\r\n                let saved = await upsertDataRecord(DECK_BASE_PATH + \"/\" + deckName, \"campaign.json\", campaignData);\r\n                console.log(\"[CardGame v2] Campaign saved:\", deckName, \"Level\", campaignData.level, \"XP\", campaignData.xp);\r\n                return saved;\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to save campaign:\", deckName, e);\r\n                return null;\r\n            }\r\n        },\r\n\r\n        async load(deckName) {\r\n            try {\r\n                return await loadDataRecord(DECK_BASE_PATH + \"/\" + deckName, \"campaign.json\", false);\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to load campaign:\", deckName, e);\r\n                return null;\r\n            }\r\n        }\r\n    };\r\n\r\n    //  Campaign XP & Level System \r\n    function calculateXP(state, isVictory) {\r\n        let xp = 0;\r\n        xp += state.round * 10;                    // 10 XP per round played\r\n        if (isVictory) xp += 50;                    // Victory bonus\r\n        xp += Math.max(0, state.player.hp) * 2;    // HP bonus (surviving health)\r\n        return xp;\r\n    }\r\n\r\n    async function saveCampaignProgress(state, isVictory, xpGain) {\r\n        let deckName = state.deckName;\r\n        let campaign = await campaignStorage.load(deckName);\r\n        if (!campaign) {\r\n            campaign = createCampaignData(state.player.character);\r\n        }\r\n        campaign.totalGamesPlayed++;\r\n        if (isVictory) campaign.wins++;\r\n        else campaign.losses++;\r\n        campaign.xp += xpGain;\r\n\r\n        // Check for level up (every 100 XP, max level 10)\r\n        let newLevel = Math.min(10, Math.floor(campaign.xp / 100) + 1);\r\n        if (newLevel > campaign.level) {\r\n            campaign.pendingLevelUps = (campaign.pendingLevelUps || 0) + (newLevel - campaign.level);\r\n            campaign.level = newLevel;\r\n        }\r\n\r\n        await campaignStorage.save(deckName, campaign);\r\n        return campaign;\r\n    }\r\n\r\n    // Apply campaign stat gains to a game state's player character\r\n    function applyCampaignBonuses(state, campaign) {\r\n        if (!campaign?.statGains || !state?.player?.character?.stats) return;\r\n        let stats = state.player.character.stats;\r\n        for (let [stat, gain] of Object.entries(campaign.statGains)) {\r\n            if (typeof stats[stat] === \"number\") {\r\n                stats[stat] += gain;\r\n            }\r\n        }\r\n        // Recalculate derived values from updated stats\r\n        let end = stats.END ?? stats.end ?? 12;\r\n        state.player.ap = Math.max(2, Math.floor(end / 5) + 1);\r\n        state.player.maxAp = state.player.ap;\r\n        let mag = stats.MAG ?? stats.mag ?? 12;\r\n        state.player.energy = mag;\r\n        state.player.maxEnergy = mag;\r\n        console.log(\"[CardGame v2] Campaign bonuses applied:\", JSON.stringify(campaign.statGains),\r\n            \"-> AP:\", state.player.ap, \"Energy:\", state.player.energy);\r\n    }\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.Storage = {\r\n        DECK_BASE_PATH,\r\n        encodeJson, decodeJson,\r\n        upsertDataRecord, loadDataRecord, listDataRecords,\r\n        deckStorage, gameStorage, campaignStorage,\r\n        createCampaignData, calculateXP, saveCampaignProgress, applyCampaignBonuses,\r\n        serializeGameState, deserializeGameState\r\n    };\r\n})();\r\n\n\n;/* === client/view/cardGame/rendering/cardComponents.js === */\n// Card Game v2  Rendering: Card Components\r\n// Extracted from cardGame-v2.js: rarityStars, NeedBar, StatBlock, cornerIcon, cardTypeIcon, iconDetail, D20Dice\r\n(function() {\r\n    \"use strict\";\r\n    const C = window.CardGame.Constants;\r\n\r\n    //  Rarity Display \r\n    function rarityStars(rarity) {\r\n        let n = ({ COMMON: 1, UNCOMMON: 2, RARE: 3, EPIC: 4, LEGENDARY: 5 })[rarity] || 1;\r\n        return Array.from({ length: 5 }, (_, i) =>\r\n            m(\"span\", { class: \"cg2-rarity-star\" + (i < n ? \" cg2-rarity-star-active\" : \"\") }, \"\\u2605\")\r\n        );\r\n    }\r\n\r\n    //  Need Bar Component \r\n    function NeedBar() {\r\n        return {\r\n            view(vnode) {\r\n                let { label, current, max, color, abbrev } = vnode.attrs;\r\n                let pct = Math.max(0, Math.min(100, (current / max) * 100));\r\n                return m(\"div\", { class: \"cg2-need-row\" }, [\r\n                    m(\"span\", { class: \"cg2-need-label\" }, abbrev || label),\r\n                    m(\"div\", { class: \"cg2-need-track\" }, [\r\n                        m(\"div\", { class: \"cg2-need-fill\", style: { width: pct + \"%\", background: color } })\r\n                    ]),\r\n                    m(\"span\", { class: \"cg2-need-value\" }, current + \"/\" + max)\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Stat Block Component \r\n    function StatBlock() {\r\n        return {\r\n            view(vnode) {\r\n                let stats = vnode.attrs.stats;\r\n                let order = [[\"STR\", \"AGI\", \"END\"], [\"INT\", \"MAG\", \"CHA\"]];\r\n                return m(\"div\", { class: \"cg2-stat-grid\" },\r\n                    order.map(row =>\r\n                        m(\"div\", { class: \"cg2-stat-row\" },\r\n                            row.map(s =>\r\n                                m(\"div\", { class: \"cg2-stat-cell\" }, [\r\n                                    m(\"span\", { class: \"cg2-stat-abbrev\" }, s),\r\n                                    m(\"span\", { class: \"cg2-stat-val\" }, stats[s] || 0)\r\n                                ])\r\n                            )\r\n                        )\r\n                    )\r\n                );\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Corner Icon Helper \r\n    function cornerIcon(type, position) {\r\n        let cfg = C.CARD_TYPES[type] || C.CARD_TYPES.item;\r\n        let icon = cfg.icon;\r\n        if (type === \"item\") icon = C.ITEM_SUBTYPE_ICONS.weapon; // default; overridden per card\r\n        let style = {\r\n            position: \"absolute\", color: cfg.color,\r\n            lineHeight: \"1\"\r\n        };\r\n        if (position === \"top-left\")     { style.top = \"6px\"; style.left = \"8px\"; }\r\n        if (position === \"top-right\")    { style.top = \"6px\"; style.right = \"8px\"; }\r\n        if (position === \"bottom-right\") { style.bottom = \"6px\"; style.right = \"8px\"; style.transform = \"rotate(180deg)\"; }\r\n        return m(\"span\", { class: \"material-symbols-outlined cg2-corner-icon\", style }, icon);\r\n    }\r\n\r\n    // Get icon for card type (for stack display)\r\n    function cardTypeIcon(type) {\r\n        let cfg = C.CARD_TYPES[type] || C.CARD_TYPES.item;\r\n        return cfg.icon;\r\n    }\r\n\r\n    // Helper: render a detail row with icon instead of text prefix\r\n    function iconDetail(icon, text, extraClass) {\r\n        if (!text) return null;\r\n        return m(\"div\", { class: \"cg2-card-detail cg2-icon-detail\" + (extraClass ? \" \" + extraClass : \"\") }, [\r\n            m(\"span\", { class: \"material-symbols-outlined cg2-detail-icon\" }, icon),\r\n            m(\"span\", text)\r\n        ]);\r\n    }\r\n\r\n    //  D20 Dice Component (inline SVG with embedded number) \r\n    function D20Dice() {\r\n        return {\r\n            view(vnode) {\r\n                let { value, rolling, winner } = vnode.attrs;\r\n                let displayVal = value || \"?\";\r\n\r\n                // SVG paths from d20-1435790057.svg\r\n                return m(\"div\", {\r\n                    class: \"cg2-d20-wrap\" + (rolling ? \" cg2-d20-rolling\" : \" cg2-d20-final\") + (winner ? \" cg2-d20-winner\" : \"\")\r\n                }, [\r\n                    m(\"svg\", {\r\n                        viewBox: \"0 0 360 360\",\r\n                        class: \"cg2-d20-svg\",\r\n                        xmlns: \"http://www.w3.org/2000/svg\"\r\n                    }, [\r\n                        // Main blue faces\r\n                        m(\"g\", { fill: \"#3372A0\" }, [\r\n                            m(\"polygon\", { points: \"178.3,13.9 38.6,94.5 178.3,105.8\" }),\r\n                            m(\"polygon\", { points: \"34.8,104.6 34.8,263.4 93.4,252.3\" }),\r\n                            m(\"polygon\", { points: \"177.2,109.1 35.7,97.7 96,249.7\" }),\r\n                            m(\"polygon\", { points: \"261.3,251.9 180,111 98.7,251.9\" }),\r\n                            m(\"polygon\", { points: \"181.7,13.9 181.7,105.8 321.4,94.5\" }),\r\n                            m(\"polygon\", { points: \"264,249.7 324.3,97.7 182.8,109.1\" }),\r\n                            m(\"polygon\", { points: \"188,343.7 322.1,266.2 264.9,255.4\" }),\r\n                            m(\"polygon\", { points: \"325.2,263.4 325.2,104.6 266.6,252.3\" }),\r\n                            m(\"polygon\", { points: \"99.5,255.2 180,347.7 260.5,255.2\" }),\r\n                            m(\"polygon\", { points: \"37.9,266.2 172,343.7 95.1,255.4\" })\r\n                        ]),\r\n                        // White highlights\r\n                        m(\"g\", { fill: \"#FFFFFF\", opacity: \"0.25\" }, [\r\n                            m(\"polygon\", { points: \"178.3,13.9 38.6,94.5 68.1,96.9\" }),\r\n                            m(\"polygon\", { points: \"34.8,104.6 34.8,263.4 43.3,261.8\" }),\r\n                            m(\"polygon\", { points: \"108.5,228.1 35.7,97.7 96,249.7\" }),\r\n                            m(\"polygon\", { points: \"192.9,133.4 180,111 98.7,251.9 116.9,251.9\" }),\r\n                            m(\"polygon\", { points: \"181.7,13.9 181.7,105.8 209.3,103.6\" }),\r\n                            m(\"polygon\", { points: \"195.5,131.1 324.3,97.7 182.8,109.1\" }),\r\n                            m(\"polygon\", { points: \"188,343.7 282.5,258.7 264.9,255.4\" }),\r\n                            m(\"polygon\", { points: \"282.3,255.2 325.2,104.6 266.6,252.3\" }),\r\n                            m(\"polygon\", { points: \"99.5,255.2 180,347.7 118,255.4\" }),\r\n                            m(\"polygon\", { points: \"37.9,266.2 103.7,265.3 95.1,255.4\" })\r\n                        ]),\r\n                        // Dark outline\r\n                        m(\"path\", { fill: \"#303030\", d: \"M328.4,99.6c0-3.1-1.7-6-4.4-7.6L183.9,11.3c-2.4-1.4-5.4-1.4-7.9,0L35.6,92.9c-2.5,1.5-4.1,4.2-4.1,7.1l-0.1,161.8c0,2.8,1.5,5.4,3.9,6.8L176.1,350c2.4,1.4,5.3,1.4,7.7,0l140.8-81.3c2.4-1.4,3.9-4,3.9-6.8L328.4,99.6z M267.1,250.9l55.8-140.4c0.5-1.2,2.3-0.9,2.3,0.4v150.9c0,0.8-0.7,1.3-1.4,1.2L268,252.5C267.3,252.4,266.8,251.6,267.1,250.9z M102.2,255.2h155.7c1,0,1.6,1.2,0.9,2l-77.8,89.4c-0.5,0.6-1.4,0.6-1.8,0l-77.8-89.4C100.6,256.5,101.1,255.2,102.2,255.2z M181.1,112.9L260.2,250c0.5,0.8-0.1,1.8-1.1,1.8H100.8c-0.9,0-1.5-1-1.1-1.8l79.2-137.2C179.4,112.1,180.6,112.1,181.1,112.9z M184.7,109l137.7-11.1c0.9-0.1,1.6,0.8,1.2,1.7l-58.7,147.8c-0.4,0.9-1.7,1-2.2,0.2l-78.9-136.7C183.3,110,183.8,109,184.7,109z M95.1,247.3L36.4,99.5c-0.3-0.8,0.3-1.7,1.2-1.7L175.3,109c0.9,0.1,1.4,1,1,1.8L97.3,247.5C96.8,248.4,95.5,248.3,95.1,247.3z M181.7,104.5V16c0-0.9,1-1.5,1.8-1.1L318,92.6c1,0.6,0.7,2.2-0.5,2.3L183,105.7C182.3,105.8,181.7,105.2,181.7,104.5z M178.3,16v88.5c0,0.7-0.6,1.3-1.3,1.2L42.5,94.8c-1.2-0.1-1.5-1.7-0.5-2.3l134.5-77.6C177.3,14.5,178.3,15.1,178.3,16z M92,252.5l-55.8,10.6c-0.7,0.1-1.4-0.4-1.4-1.2V111c0-1.3,1.9-1.7,2.3-0.4l55.8,140.4C93.2,251.6,92.7,252.4,92,252.5z M41.1,265.6l53.3-10.1c0.4-0.1,0.9,0.1,1.1,0.4l71.7,82.3c0.9,1-0.3,2.5-1.5,1.9l-125-72.2C39.7,267.3,40,265.8,41.1,265.6z M265.6,255.5l53.3,10.1c1.1,0.2,1.4,1.7,0.4,2.2l-125,72.2c-1.2,0.7-2.4-0.8-1.5-1.9l71.7-82.3C264.7,255.6,265.1,255.4,265.6,255.5z\" }),\r\n                        // Number text - centered on the front face\r\n                        m(\"text\", {\r\n                            x: \"180\",\r\n                            y: \"200\",\r\n                            \"text-anchor\": \"middle\",\r\n                            \"dominant-baseline\": \"middle\",\r\n                            fill: \"#FFFFFF\",\r\n                            \"font-size\": displayVal.toString().length > 1 ? \"70\" : \"80\",\r\n                            \"font-weight\": \"900\",\r\n                            \"font-family\": \"Arial, sans-serif\",\r\n                            style: \"text-shadow: 0 2px 4px rgba(0,0,0,0.5)\"\r\n                        }, displayVal)\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.Rendering = window.CardGame.Rendering || {};\r\n    Object.assign(window.CardGame.Rendering, {\r\n        rarityStars, NeedBar, StatBlock, cornerIcon, cardTypeIcon, iconDetail, D20Dice\r\n    });\r\n})();\r\n\n\n;/* === client/view/cardGame/rendering/cardFace.js === */\n// Card Game v2  Rendering: Card Face Renderers\r\n// Extracted from cardGame-v2.js: renderCharacterBody, renderCharacterBackBody, renderCardBody,\r\n// renderCompactStats, isCardIncomplete, CardFace, CardBack\r\n(function() {\r\n    \"use strict\";\r\n    const C = window.CardGame.Constants;\r\n    const R = window.CardGame.Rendering;\r\n\r\n    //  Card Face Renderers (per type) \r\n\r\n    function renderCharacterBody(card, options) {\r\n        let stats = card.stats || {};\r\n        let noPreview = options?.noPreview;\r\n        return [\r\n            m(\"div\", { class: \"cg2-card-image-area\" },\r\n                card.portraitUrl\r\n                    ? m(\"img\", {\r\n                        src: card.portraitUrl, class: \"cg2-card-img\",\r\n                        style: noPreview ? {} : { cursor: \"pointer\" },\r\n                        onclick: noPreview ? null : function(e) { e.stopPropagation(); CardGame.Rendering.showImagePreview(card.portraitUrl); }\r\n                    })\r\n                    : m(\"span\", { class: \"material-symbols-outlined cg2-placeholder-icon\", style: { color: \"#B8860B\" } }, \"person\")\r\n            ),\r\n            m(\"div\", { class: \"cg2-card-details\" }, [\r\n                m(\"div\", { class: \"cg2-card-detail cg2-icon-detail\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined cg2-detail-icon\" }, \"badge\"),\r\n                    m(\"span\", (card.gender ? card.gender.charAt(0).toUpperCase() + \" \" : \"\") + (card.race || \"\")),\r\n                    card.age ? m(\"span\", { style: { marginLeft: \"auto\", opacity: 0.7 } }, card.age + \" yrs\") : null\r\n                ]),\r\n                card.alignment ? R.iconDetail(\"balance\", card.alignment.replace(/_/g, \" \")) : null,\r\n                m(R.StatBlock, { stats })\r\n            ]),\r\n            m(\"div\", { class: \"cg2-card-footer\", style: { borderTop: \"none\" } }, [\r\n                m(\"span\", { style: { fontSize: \"9px\", color: \"#999\", fontStyle: \"italic\" } }, \"click to flip\")\r\n            ])\r\n        ];\r\n    }\r\n\r\n    function renderCharacterBackBody(card, bgImage) {\r\n        let stats = card.stats || {};\r\n        let needs = card.needs || {};\r\n        let equip = card.equipped || {};\r\n        let skills = card.activeSkills || [];\r\n        let backStyle = { borderColor: \"#B8860B\" };\r\n        if (bgImage) {\r\n            backStyle.backgroundImage = \"url('\" + bgImage + \"')\";\r\n            backStyle.backgroundSize = \"cover\";\r\n            backStyle.backgroundPosition = \"center\";\r\n        }\r\n        return m(\"div\", { class: \"cg2-card cg2-card-front cg2-char-back\", style: backStyle }, [\r\n            R.cornerIcon(\"character\", \"top-left\"),\r\n            R.cornerIcon(\"character\", \"top-right\"),\r\n            m(\"div\", { class: \"cg2-char-back-title\" }, card.name || \"Unknown\"),\r\n            m(\"div\", { class: \"cg2-card-body\" }, [\r\n                m(R.NeedBar, { label: \"Health\", abbrev: \"HP\", current: needs.hp || 20, max: 20, color: \"#e53935\" }),\r\n                m(R.NeedBar, { label: \"Energy\", abbrev: \"NRG\", current: needs.energy || 14, max: stats.MAG || 14, color: \"#1E88E5\" }),\r\n                m(R.NeedBar, { label: \"Morale\", abbrev: \"MRL\", current: needs.morale || 20, max: 20, color: \"#43A047\" }),\r\n                m(\"div\", { class: \"cg2-divider\" }),\r\n                m(\"div\", { class: \"cg2-equip-row\" }, [\r\n                    m(\"span\", { class: \"cg2-section-label\" }, \"Skill Slots:\"),\r\n                    m(\"span\", skills.map(s => m(\"span\", { class: \"cg2-slot\" + (s ? \" cg2-slot-filled\" : \"\") }, s ? s.name : \"\\u2013\")))\r\n                ]),\r\n                m(\"div\", { class: \"cg2-equip-row\" }, [\r\n                    m(\"span\", { class: \"cg2-section-label\" }, \"Equip:\"),\r\n                    m(\"span\", [\"head\", \"body\", \"handL\", \"handR\", \"feet\", \"ring\", \"back\"].map(slot =>\r\n                        m(\"span\", {\r\n                            class: \"cg2-slot\" + (equip[slot] ? \" cg2-slot-filled\" : \"\"),\r\n                            title: slot\r\n                        }, equip[slot] ? equip[slot].name : slot.charAt(0).toUpperCase())\r\n                    ))\r\n                ]),\r\n                m(\"div\", { style: { marginTop: \"auto\", textAlign: \"center\", fontSize: \"10px\", color: \"#999\", fontStyle: \"italic\" } }, \"click to flip\")\r\n            ]),\r\n            R.cornerIcon(\"character\", \"bottom-right\")\r\n        ]);\r\n    }\r\n\r\n    //  Unified Card Body Renderer (Phase 7.0) \r\n    // Uses CARD_RENDER_CONFIG to render card body based on type\r\n    function renderCardBody(card, type, options) {\r\n        let config = C.CARD_RENDER_CONFIG[type];\r\n        if (!config) return [m(\"div\", \"Unknown type: \" + type)];\r\n\r\n        let imageUrl = card.imageUrl || card.portraitUrl;\r\n        let placeholderColor = config.placeholderColor || C.CARD_TYPES[type]?.color;\r\n        let noPreview = options?.noPreview;\r\n\r\n        // Image area\r\n        let imageArea = m(\"div\", { class: \"cg2-card-image-area\" },\r\n            imageUrl\r\n                ? m(\"img\", {\r\n                    src: imageUrl,\r\n                    class: \"cg2-card-img\",\r\n                    style: noPreview ? {} : { cursor: \"pointer\" },\r\n                    onclick: noPreview ? null : function(e) { e.stopPropagation(); CardGame.Rendering.showImagePreview(imageUrl); }\r\n                })\r\n                : m(\"span\", {\r\n                    class: \"material-symbols-outlined cg2-placeholder-icon\",\r\n                    style: placeholderColor ? { color: placeholderColor } : {}\r\n                }, config.placeholderIcon)\r\n        );\r\n\r\n        // Details section\r\n        let details = [];\r\n\r\n        // Header field (first row with slot/type + rarity)\r\n        if (config.headerField) {\r\n            let hf = config.headerField;\r\n            let value = hf.label || card[hf.field] || hf.default;\r\n            details.push(m(\"div\", { class: \"cg2-card-detail cg2-icon-detail\" }, [\r\n                m(\"span\", { class: \"material-symbols-outlined cg2-detail-icon\" }, hf.icon),\r\n                m(\"span\", value),\r\n                hf.showRarity ? m(\"span\", { class: \"cg2-rarity\", style: { marginLeft: \"auto\" } }, R.rarityStars(card.rarity)) : null\r\n            ]));\r\n        }\r\n\r\n        // Render each detail field\r\n        if (config.details) {\r\n            for (let d of config.details) {\r\n                if (d.type === \"stats\") {\r\n                    // Stats line (multiple stats in one row)\r\n                    let statElements = d.fields\r\n                        .filter(f => card[f] != null)\r\n                        .map(f => m(\"span\", {\r\n                            class: \"cg2-mod\" + (f === \"atk\" && d.atkClass ? \" \" + d.atkClass : \"\")\r\n                        }, (d.labels?.[f] || \"\") + card[f]));\r\n                    // Add defaults for fields that need them\r\n                    if (d.defaults) {\r\n                        for (let [k, v] of Object.entries(d.defaults)) {\r\n                            if (!card[k] && !statElements.find(el => el.text?.includes(k))) {\r\n                                statElements.push(m(\"span\", { class: \"cg2-mod\" }, v));\r\n                            }\r\n                        }\r\n                    }\r\n                    if (statElements.length) {\r\n                        details.push(m(\"div\", { class: \"cg2-card-stats-line\" }, statElements));\r\n                    }\r\n                } else if (d.type === \"requires\" && card.requires && Object.keys(card.requires).length) {\r\n                    details.push(R.iconDetail(d.icon, Object.entries(card.requires).map(([k, v]) => k + \" \" + v).join(\", \")));\r\n                } else if (d.type === \"array\" && card[d.field]?.length) {\r\n                    details.push(R.iconDetail(d.icon, card[d.field].join(\", \")));\r\n                } else if (d.type === \"flavor\" && card[d.field]) {\r\n                    details.push(m(\"div\", { class: \"cg2-flavor\" }, \"\\u201C\" + card[d.field] + \"\\u201D\"));\r\n                } else if (d.type === \"warning\") {\r\n                    details.push(m(\"div\", { class: \"cg2-use-or-lose\" }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"12px\", marginRight: \"4px\" } }, \"warning\"),\r\n                        d.text\r\n                    ]));\r\n                } else if (d.label) {\r\n                    // Static label\r\n                    details.push(R.iconDetail(d.icon, d.label, d.class));\r\n                } else if (d.field) {\r\n                    // Dynamic field\r\n                    let value = card[d.field];\r\n                    if (value == null && d.default != null) value = d.default;\r\n                    if (value != null) {\r\n                        let text = (d.prefix || \"\") + value + (d.suffix || \"\");\r\n                        details.push(R.iconDetail(d.icon, text, d.class));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Footer section\r\n        let footer = null;\r\n        if (config.footer && config.footer.length) {\r\n            let footerItems = [];\r\n            for (let f of config.footer) {\r\n                if (f.label) {\r\n                    footerItems.push(R.iconDetail(f.icon, f.label, f.class));\r\n                } else if (f.field === \"reusable\") {\r\n                    // Boolean toggle for reusable/consumable\r\n                    let isReusable = card.reusable;\r\n                    footerItems.push(R.iconDetail(isReusable ? f.icon : f.altIcon, isReusable ? f.trueLabel : f.falseLabel));\r\n                } else {\r\n                    let value = card[f.field];\r\n                    if (value == null && f.default != null) value = f.default;\r\n                    if (value != null) {\r\n                        let text = (f.prefix || \"\") + value + (f.suffix || \"\");\r\n                        footerItems.push(R.iconDetail(f.icon, text, f.class));\r\n                    }\r\n                }\r\n            }\r\n            if (footerItems.length) {\r\n                footer = m(\"div\", { class: \"cg2-card-footer\" }, footerItems);\r\n            }\r\n        }\r\n\r\n        return [imageArea, m(\"div\", { class: \"cg2-card-details\" }, details), footer];\r\n    }\r\n\r\n    //  Render compact stats for action bar display \r\n    function renderCompactStats(card, type) {\r\n        if (!card) return null;\r\n        let stats = [];\r\n\r\n        switch (type) {\r\n            case \"action\":\r\n                if (card.roll) stats.push(m(\"span\", { class: \"cg2-compact-stat\", title: \"Roll\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined\" }, \"casino\"), card.roll\r\n                ]));\r\n                if (card.onHit) stats.push(m(\"span\", { class: \"cg2-compact-stat cg2-compact-effect\", title: \"On Hit\" }, card.onHit));\r\n                break;\r\n            case \"skill\":\r\n                if (card.modifier) stats.push(m(\"span\", { class: \"cg2-compact-stat\", title: \"Modifier\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined\" }, \"tune\"), card.modifier\r\n                ]));\r\n                if (card.skillType) stats.push(m(\"span\", { class: \"cg2-compact-stat\" }, card.skillType));\r\n                break;\r\n            case \"magic\":\r\n                if (card.effect) stats.push(m(\"span\", { class: \"cg2-compact-stat cg2-compact-effect\" }, card.effect));\r\n                if (card.manaCost) stats.push(m(\"span\", { class: \"cg2-compact-stat\", title: \"Mana\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined\" }, \"water_drop\"), card.manaCost\r\n                ]));\r\n                break;\r\n            case \"item\":\r\n                if (card.subtype === \"weapon\" && card.atk) {\r\n                    stats.push(m(\"span\", { class: \"cg2-compact-stat\", title: \"Attack\" }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined\" }, \"swords\"), \" \" + card.atk\r\n                    ]));\r\n                }\r\n                if (card.subtype === \"armor\" && card.def) {\r\n                    stats.push(m(\"span\", { class: \"cg2-compact-stat\", title: \"Defense\" }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined\" }, \"shield\"), \" \" + card.def\r\n                    ]));\r\n                }\r\n                if (card.effect) stats.push(m(\"span\", { class: \"cg2-compact-stat cg2-compact-effect\" }, card.effect));\r\n                break;\r\n            case \"talk\":\r\n                stats.push(m(\"span\", { class: \"cg2-compact-stat\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined\" }, \"chat_bubble\"), \" CHA\"\r\n                ]));\r\n                break;\r\n            case \"encounter\":\r\n                if (card.atk) stats.push(m(\"span\", { class: \"cg2-compact-stat\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined\" }, \"swords\"), \" \" + card.atk\r\n                ]));\r\n                if (card.def) stats.push(m(\"span\", { class: \"cg2-compact-stat\" }, [\r\n                    m(\"span\", { class: \"material-symbols-outlined\" }, \"shield\"), \" \" + card.def\r\n                ]));\r\n                break;\r\n            case \"character\":\r\n                let s = card.stats || {};\r\n                if (s.STR) stats.push(m(\"span\", { class: \"cg2-compact-stat\" }, \"STR \" + s.STR));\r\n                if (s.AGI) stats.push(m(\"span\", { class: \"cg2-compact-stat\" }, \"AGI \" + s.AGI));\r\n                if (s.END) stats.push(m(\"span\", { class: \"cg2-compact-stat\" }, \"END \" + s.END));\r\n                break;\r\n        }\r\n\r\n        return stats.length > 0 ? stats : null;\r\n    }\r\n\r\n    //  Check if card is incomplete (missing clear effect) \r\n    function isCardIncomplete(card) {\r\n        if (!card) return true;\r\n        let type = card.type;\r\n        // Character cards are complete if they have stats\r\n        if (type === \"character\") return !card.stats;\r\n        // Action/skill/magic/talk need effect or clear mechanics\r\n        if (type === \"action\") return !card.onHit && !card.roll && !card.effect;\r\n        if (type === \"skill\") return !card.modifier && !card.effect;\r\n        if (type === \"magic\") return !card.effect;\r\n        if (type === \"talk\") return !card.effect && !card.speechType;\r\n        // Items need effect or stats\r\n        if (type === \"item\") return !card.effect && !card.atk && !card.def;\r\n        // Apparel needs def or effect\r\n        if (type === \"apparel\") return !card.def && !card.effect;\r\n        // Encounters need behavior or stats\r\n        if (type === \"encounter\") return !card.behavior && !card.atk;\r\n        return false;\r\n    }\r\n\r\n    //  CardFace Component \r\n    function CardFace() {\r\n        return {\r\n            view(vnode) {\r\n                let card = vnode.attrs.card;\r\n                if (!card || !card.type) return m(\"div.cg2-card.cg2-card-empty\", \"No card\");\r\n                let type = card.type;\r\n                let cfg = C.CARD_TYPES[type] || C.CARD_TYPES.item;\r\n                let compact = vnode.attrs.compact;\r\n                let full = vnode.attrs.full;\r\n                let incomplete = isCardIncomplete(card);\r\n\r\n                // Determine render type: character is special (has StatBlock),\r\n                // items use subtype, others use unified renderer\r\n                let renderType = type;\r\n                if (type === \"item\") {\r\n                    renderType = card.subtype === \"consumable\" ? \"consumable\" : \"weapon\";\r\n                }\r\n\r\n                // Options for render functions (e.g., noPreview disables image click)\r\n                let renderOpts = { noPreview: vnode.attrs.noPreview };\r\n\r\n                // Use unified renderCardBody for types with config, special handling for character\r\n                let bodyFn = type === \"character\"\r\n                    ? () => renderCharacterBody(card, renderOpts)\r\n                    : (C.CARD_RENDER_CONFIG[renderType]\r\n                        ? () => renderCardBody(card, renderType, renderOpts)\r\n                        : () => [m(\"div\", \"Unknown type: \" + type)]);\r\n                let cardStyle = { borderColor: cfg.color };\r\n                if (vnode.attrs.bgImage) {\r\n                    cardStyle.backgroundImage = \"linear-gradient(rgba(255,255,255,0.5),rgba(255,255,255,0.5)), url('\" + vnode.attrs.bgImage + \"')\";\r\n                    cardStyle.backgroundSize = \"cover, cover\";\r\n                    cardStyle.backgroundPosition = \"center, center\";\r\n                }\r\n                let sizeClass = compact ? \" cg2-card-compact\" : (full ? \" cg2-card-full\" : \"\");\r\n                let cardClass = \"cg2-card cg2-card-front cg2-card-\" + type + sizeClass;\r\n\r\n                // For compact cards, render a minimal body with image and key stats\r\n                let compactBody = null;\r\n                if (compact) {\r\n                    compactBody = m(\"div\", { class: \"cg2-card-body cg2-card-body-compact\" }, [\r\n                        // Show image if available\r\n                        card.imageUrl ? m(\"div\", { class: \"cg2-card-image-area cg2-compact-image\" },\r\n                            m(\"img\", { src: card.imageUrl, class: \"cg2-card-img\" })\r\n                        ) : null,\r\n                        // Show condensed stats based on type\r\n                        m(\"div\", { class: \"cg2-compact-stats\" }, renderCompactStats(card, type))\r\n                    ]);\r\n                }\r\n\r\n                return m(\"div\", {\r\n                    class: cardClass,\r\n                    style: cardStyle\r\n                }, [\r\n                    R.cornerIcon(type, \"top-left\"),\r\n                    R.cornerIcon(type, \"top-right\"),\r\n                    // Incomplete indicator (yellow asterisk)\r\n                    incomplete ? m(\"div\", {\r\n                        class: \"cg2-incomplete-badge\",\r\n                        title: \"Card effect incomplete - needs definition\"\r\n                    }, \"*\") : null,\r\n                    m(\"div\", { class: \"cg2-card-name\", style: { color: cfg.color } }, card.name || \"Unnamed\"),\r\n                    compact ? compactBody : m(\"div\", { class: \"cg2-card-body\" }, bodyFn(card)),\r\n                    R.cornerIcon(type, \"bottom-right\")\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  CardBack Component \r\n    function CardBack() {\r\n        return {\r\n            view(vnode) {\r\n                let type = vnode.attrs.type || \"item\";\r\n                let cfg = C.CARD_TYPES[type] || C.CARD_TYPES.item;\r\n                return m(\"div\", {\r\n                    class: \"cg2-card cg2-card-back\",\r\n                    style: { background: cfg.color, borderColor: cfg.color }\r\n                }, [\r\n                    m(\"div\", { class: \"cg2-back-pattern\" }),\r\n                    m(\"span\", { class: \"material-symbols-outlined cg2-back-icon\" }, cfg.icon),\r\n                    m(\"div\", { class: \"cg2-back-label\" }, cfg.label)\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    window.CardGame.Rendering = window.CardGame.Rendering || {};\r\n    Object.assign(window.CardGame.Rendering, {\r\n        renderCharacterBody, renderCharacterBackBody, renderCardBody,\r\n        renderCompactStats, isCardIncomplete, CardFace, CardBack\r\n    });\r\n})();\r\n\n\n;/* === client/view/cardGame/rendering/overlays.js === */\n// Card Game v2  Rendering: Overlay Components\r\n// Extracted from cardGame-v2.js: ImagePreviewOverlay, CardPreviewOverlay, GalleryPickerOverlay\r\n(function() {\r\n    \"use strict\";\r\n\r\n    //  Image Preview Overlay \r\n    let previewImageUrl = null;\r\n\r\n    function showImagePreview(url) {\r\n        if (!url) return;\r\n        // Upgrade to larger thumbnail size for preview\r\n        previewImageUrl = url.replace(/\\/\\d+x\\d+/, \"/512x512\");\r\n        m.redraw();\r\n    }\r\n\r\n    function closeImagePreview() {\r\n        previewImageUrl = null;\r\n        m.redraw();\r\n    }\r\n\r\n    function ImagePreviewOverlay() {\r\n        return {\r\n            view() {\r\n                if (!previewImageUrl) return null;\r\n                return m(\"div\", {\r\n                    class: \"cg2-image-preview-overlay\",\r\n                    onclick: closeImagePreview\r\n                }, [\r\n                    m(\"img\", {\r\n                        src: previewImageUrl,\r\n                        style: { maxWidth: \"90vw\", maxHeight: \"90vh\", objectFit: \"contain\", borderRadius: \"8px\", boxShadow: \"0 4px 24px rgba(0,0,0,0.5)\" }\r\n                    }),\r\n                    m(\"span\", {\r\n                        class: \"material-symbols-outlined\",\r\n                        style: { position: \"absolute\", top: \"16px\", right: \"16px\", color: \"#fff\", fontSize: \"32px\", cursor: \"pointer\" }\r\n                    }, \"close\")\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Card Preview Overlay \r\n    let previewCard = null;\r\n    let previewFlipped = false;\r\n\r\n    function showCardPreview(card) {\r\n        if (!card) return;\r\n        previewCard = card;\r\n        previewFlipped = false;  // Always start showing front\r\n        m.redraw();\r\n    }\r\n\r\n    function closeCardPreview() {\r\n        previewCard = null;\r\n        previewFlipped = false;\r\n        m.redraw();\r\n    }\r\n\r\n    function CardPreviewOverlay() {\r\n        return {\r\n            view() {\r\n                if (!previewCard) return null;\r\n                let R = window.CardGame.Rendering;\r\n                let ctx = window.CardGame.ctx || {};\r\n                let viewingDeck = ctx.viewingDeck;\r\n\r\n                let cardFrontBg = viewingDeck && viewingDeck.cardFrontImageUrl\r\n                    ? viewingDeck.cardFrontImageUrl : null;\r\n                let cardBackBg = viewingDeck && viewingDeck.cardBackImageUrl\r\n                    ? viewingDeck.cardBackImageUrl : null;\r\n\r\n                // Build back side content - card art or generic back\r\n                let backContent;\r\n                if (previewCard.imageUrl || previewCard.portraitUrl) {\r\n                    let artUrl = (previewCard.imageUrl || previewCard.portraitUrl).replace(/\\/\\d+x\\d+/, \"/512x512\");\r\n                    backContent = m(\"div\", {\r\n                        class: \"cg2-card cg2-card-full cg2-preview-back\",\r\n                        style: {\r\n                            backgroundImage: cardBackBg ? \"url('\" + cardBackBg + \"')\" : \"none\",\r\n                            backgroundSize: \"cover\",\r\n                            display: \"flex\",\r\n                            alignItems: \"center\",\r\n                            justifyContent: \"center\"\r\n                        }\r\n                    }, [\r\n                        m(\"img\", {\r\n                            src: artUrl,\r\n                            class: \"cg2-preview-back-art\"\r\n                        })\r\n                    ]);\r\n                } else {\r\n                    // No art - show card back design\r\n                    backContent = m(\"div\", {\r\n                        class: \"cg2-card cg2-card-full cg2-preview-back\",\r\n                        style: {\r\n                            backgroundImage: cardBackBg ? \"url('\" + cardBackBg + \"')\" : \"none\",\r\n                            backgroundSize: \"cover\",\r\n                            display: \"flex\",\r\n                            alignItems: \"center\",\r\n                            justifyContent: \"center\"\r\n                        }\r\n                    }, [\r\n                        m(\"div\", { class: \"cg2-card-back-design\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:64px;opacity:0.5\" }, \"style\")\r\n                        ])\r\n                    ]);\r\n                }\r\n\r\n                return m(\"div\", {\r\n                    class: \"cg2-card-preview-overlay\",\r\n                    onclick: closeCardPreview\r\n                }, [\r\n                    m(\"div\", {\r\n                        class: \"cg2-card-preview-container cg2-preview-flipper\" + (previewFlipped ? \" cg2-flipped\" : \"\"),\r\n                        onclick(e) {\r\n                            e.stopPropagation();\r\n                            previewFlipped = !previewFlipped;\r\n                        }\r\n                    }, [\r\n                        // Front face\r\n                        m(\"div\", { class: \"cg2-preview-face cg2-preview-front\" }, [\r\n                            m(R.CardFace, { card: previewCard, bgImage: cardFrontBg, full: true })\r\n                        ]),\r\n                        // Back face\r\n                        m(\"div\", { class: \"cg2-preview-face cg2-preview-back-face\" }, [\r\n                            backContent\r\n                        ])\r\n                    ]),\r\n                    m(\"div\", { class: \"cg2-preview-hint\" }, \"Click card to flip\"),\r\n                    m(\"span\", {\r\n                        class: \"material-symbols-outlined cg2-preview-close\",\r\n                        onclick: closeCardPreview\r\n                    }, \"close\")\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Gallery Picker Overlay \r\n    let galleryPickerCard = null;    // card being picked for\r\n    let galleryImages = [];\r\n    let galleryLoading = false;\r\n\r\n    async function openGalleryPicker(card) {\r\n        if (!card) return;\r\n        if (!card.sourceId && card._sourceChar) {\r\n            page.toast(\"info\", \"Save deck first to access gallery for generated characters\");\r\n            return;\r\n        }\r\n        if (!card.sourceId) return;\r\n        galleryLoading = true;\r\n        galleryPickerCard = card;\r\n        galleryImages = [];\r\n        m.redraw();\r\n        try {\r\n            let ctx = window.CardGame.ctx || {};\r\n            let fetchCharPerson = ctx.fetchCharPerson;\r\n            let char = fetchCharPerson ? await fetchCharPerson(card.sourceId) : null;\r\n            if (char && char.profile && char.profile.portrait && char.profile.portrait.groupId) {\r\n                let q = am7client.newQuery(\"data.data\");\r\n                q.field(\"groupId\", char.profile.portrait.groupId);\r\n                q.entity.request.push(\"id\", \"objectId\", \"name\", \"groupId\", \"groupPath\", \"contentType\");\r\n                q.range(0, 100);\r\n                q.sort(\"createdDate\");\r\n                q.order(\"descending\");\r\n                let qr = await page.search(q);\r\n                if (qr && qr.results) {\r\n                    galleryImages = qr.results.filter(r => r.contentType && r.contentType.match(/^image\\//i));\r\n                }\r\n            }\r\n            if (!galleryImages.length) {\r\n                page.toast(\"warn\", \"No gallery images found for \" + card.name);\r\n                galleryPickerCard = null;\r\n            }\r\n        } catch (e) {\r\n            console.error(\"[CardGame v2] Gallery load failed\", e);\r\n            page.toast(\"error\", \"Failed to load gallery\");\r\n            galleryPickerCard = null;\r\n        }\r\n        galleryLoading = false;\r\n        m.redraw();\r\n    }\r\n\r\n    function closeGalleryPicker() {\r\n        galleryPickerCard = null;\r\n        galleryImages = [];\r\n        m.redraw();\r\n    }\r\n\r\n    function GalleryPickerOverlay() {\r\n        return {\r\n            view() {\r\n                if (!galleryPickerCard) return null;\r\n                let ctx = window.CardGame.ctx || {};\r\n                let viewingDeck = ctx.viewingDeck;\r\n                let deckStorage = ctx.deckStorage;\r\n                let orgPath = am7client.dotPath(am7client.currentOrganization);\r\n\r\n                return m(\"div\", {\r\n                    class: \"cg2-image-preview-overlay\",\r\n                    style: { cursor: \"default\" },\r\n                    onclick: closeGalleryPicker\r\n                }, [\r\n                    m(\"div\", {\r\n                        class: \"cg2-gallery-dialog\",\r\n                        onclick(e) { e.stopPropagation(); }\r\n                    }, [\r\n                        m(\"div\", { style: { display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\", marginBottom: \"12px\" } }, [\r\n                            m(\"span\", { style: { fontWeight: 700, fontSize: \"14px\" } }, \"Pick Portrait: \" + (galleryPickerCard.name || \"Character\")),\r\n                            m(\"span\", {\r\n                                class: \"material-symbols-outlined\",\r\n                                style: { cursor: \"pointer\", fontSize: \"20px\", color: \"#888\" },\r\n                                onclick: closeGalleryPicker\r\n                            }, \"close\")\r\n                        ]),\r\n                        galleryLoading\r\n                            ? m(\"div\", { style: { textAlign: \"center\", padding: \"24px\" } }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined cg2-spin\", style: { fontSize: \"24px\" } }, \"progress_activity\"),\r\n                                \" Loading...\"\r\n                            ])\r\n                            : m(\"div\", { style: { display: \"flex\", flexWrap: \"wrap\", gap: \"8px\" } },\r\n                                galleryImages.map(function (img) {\r\n                                    let src = g_application_path + \"/thumbnail/\" + orgPath + \"/data.data\" + img.groupPath + \"/\" + img.name + \"/96x96\";\r\n                                    let fullSrc = g_application_path + \"/thumbnail/\" + orgPath + \"/data.data\" + img.groupPath + \"/\" + img.name + \"/256x256\";\r\n                                    let selected = galleryPickerCard.portraitUrl && galleryPickerCard.portraitUrl.indexOf(\"/\" + img.name + \"/\") !== -1;\r\n                                    return m(\"img\", {\r\n                                        src: src,\r\n                                        width: 96, height: 96,\r\n                                        style: {\r\n                                            objectFit: \"cover\", borderRadius: \"6px\", cursor: \"pointer\",\r\n                                            border: \"3px solid \" + (selected ? \"#B8860B\" : \"transparent\"),\r\n                                            transition: \"border-color 0.15s\"\r\n                                        },\r\n                                        title: img.name,\r\n                                        onclick: function () {\r\n                                            galleryPickerCard.portraitUrl = fullSrc + \"?t=\" + Date.now();\r\n                                            // Save deck with new portrait\r\n                                            if (viewingDeck && deckStorage) {\r\n                                                let safeName = (viewingDeck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n                                                deckStorage.save(safeName, viewingDeck);\r\n                                            }\r\n                                            closeGalleryPicker();\r\n                                            page.toast(\"success\", \"Portrait updated\");\r\n                                        }\r\n                                    });\r\n                                })\r\n                            )\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.Rendering = window.CardGame.Rendering || {};\r\n    Object.assign(window.CardGame.Rendering, {\r\n        showImagePreview, closeImagePreview, ImagePreviewOverlay,\r\n        showCardPreview, closeCardPreview, CardPreviewOverlay,\r\n        openGalleryPicker, closeGalleryPicker, GalleryPickerOverlay\r\n    });\r\n})();\r\n\n\n;/* === client/view/cardGame/services/characters.js === */\n/**\r\n * CardGame Characters Service  Character loading, stat mapping, card assembly,\r\n * generation, and persistence.\r\n *\r\n * Extracted from the monolithic cardGame-v2.js (lines ~1086-1721).\r\n * Handles all character-related operations for the card game deck builder.\r\n *\r\n * Exposes: window.CardGame.Characters\r\n *\r\n * Dependencies:\r\n *   - window.CardGame.Constants (DEFAULT_THEME)\r\n *   - window.CardGame.ctx (shared mutable context: activeTheme, deckNameInput)\r\n *   - AM7 globals: am7view, am7client, am7model, page, g_application_path, m\r\n */\r\n(function() {\r\n\r\n    window.CardGame = window.CardGame || {};\r\n\r\n    //  Mutable state (accessed by UI) \r\n    let availableCharacters = [];\r\n    let charsLoading = false;\r\n    let selectedChars = [];\r\n    let characterTemplates = null;\r\n    let generatingCharacters = false;\r\n\r\n    //  Helper: resolve activeTheme from shared context \r\n    function getActiveTheme() {\r\n        return (CardGame.ctx && CardGame.ctx.activeTheme) || CardGame.Constants.DEFAULT_THEME;\r\n    }\r\n\r\n    //  Helper: resolve deckNameInput from shared context \r\n    function getDeckNameInput() {\r\n        return (CardGame.ctx && CardGame.ctx.deckNameInput) || \"\";\r\n    }\r\n\r\n    //  Stat Utilities \r\n\r\n    function statVal(v, fallback) { return (v != null && v !== undefined) ? v : fallback; }\r\n\r\n    function mapStats(statistics) {\r\n        if (!statistics) return { STR: 8, AGI: 8, END: 8, INT: 8, MAG: 8, CHA: 8 };\r\n        // If statistics is only partially loaded (objectId ref without values), return defaults\r\n        if (statistics.objectId && statistics.physicalStrength == null && statistics.agility == null) {\r\n            return { STR: 8, AGI: 8, END: 8, INT: 8, MAG: 8, CHA: 8 };\r\n        }\r\n        return {\r\n            STR: statVal(statistics.physicalStrength, 8),\r\n            AGI: statVal(statistics.agility, 8),\r\n            END: statVal(statistics.physicalEndurance, 8),\r\n            INT: statVal(statistics.intelligence, 8),\r\n            MAG: statVal(statistics.magic, 8),\r\n            CHA: statVal(statistics.charisma, 8)\r\n        };\r\n    }\r\n\r\n    // Resolve partially-loaded statistics (secondary query when only objectId is present)\r\n    async function resolveStatistics(charObj) {\r\n        if (!charObj || !charObj.statistics) return;\r\n        let s = charObj.statistics;\r\n        if (s.objectId && s.physicalStrength == null && s.agility == null) {\r\n            try {\r\n                let sq = am7view.viewQuery(\"olio.statistics\");\r\n                sq.field(\"objectId\", s.objectId);\r\n                let sqr = await page.search(sq);\r\n                if (sqr && sqr.results && sqr.results.length > 0) {\r\n                    charObj.statistics = sqr.results[0];\r\n                    console.log(\"[CardGame v2] Resolved statistics for \" + (charObj.name || charObj.objectId));\r\n                }\r\n            } catch (e) {\r\n                console.warn(\"[CardGame v2] Failed to resolve statistics\", e);\r\n            }\r\n        }\r\n    }\r\n\r\n    function clampStat(v) { return Math.max(1, Math.min(20, Math.round(v))); }\r\n\r\n    // AM7 fields can be enums (objects), lists (arrays), or strings; safely coerce to string\r\n    function str(v) {\r\n        if (Array.isArray(v)) return v[0] || \"\";\r\n        return typeof v === \"string\" ? v : (v && v.name ? v.name : String(v || \"\"));\r\n    }\r\n\r\n    //  Portrait URL Helper \r\n\r\n    function getPortraitUrl(char, size) {\r\n        if (!char || !char.profile || !char.profile.portrait) return null;\r\n        let pp = char.profile.portrait;\r\n        if (!pp.groupPath || !pp.name) return null;\r\n        return g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) +\r\n            \"/data.data\" + pp.groupPath + \"/\" + pp.name + \"/\" + (size || \"256x256\");\r\n    }\r\n\r\n    //  Character ID Helper \r\n\r\n    function getCharId(char) {\r\n        return char.objectId || char._tempId || char.id || (char.entity && char.entity.objectId);\r\n    }\r\n\r\n    //  Fetch fresh charPerson by objectId (with profile + statistics) \r\n\r\n    async function fetchCharPerson(objectId) {\r\n        let q = am7view.viewQuery(\"olio.charPerson\");\r\n        q.field(\"objectId\", objectId);\r\n        q.range(0, 1);\r\n        q.entity.request.push(\"profile\", \"store\", \"statistics\");\r\n        let qr = await page.search(q);\r\n        if (qr && qr.results && qr.results.length) {\r\n            am7model.updateListModel(qr.results);\r\n            let char = qr.results[0];\r\n            await resolveStatistics(char);\r\n            return char;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    //  Refresh a character card from its source object \r\n\r\n    async function refreshCharacterCard(card) {\r\n        let fresh;\r\n        if (card._sourceChar) {\r\n            // Use in-memory source for temp/generated characters\r\n            fresh = card._sourceChar;\r\n        } else if (card.sourceId) {\r\n            am7client.clearCache(\"olio.charPerson\");\r\n            am7client.clearCache(\"data.data\");\r\n            fresh = await fetchCharPerson(card.sourceId);\r\n        }\r\n        if (!fresh) return false;\r\n        let stats = mapStats(fresh.statistics);\r\n        Object.keys(stats).forEach(k => { stats[k] = clampStat(stats[k]); });\r\n        card.name = fresh.name || card.name;\r\n        card.gender = str(fresh.gender) || card.gender || null;\r\n        card.race = (str(fresh.race) || \"HUMAN\").toUpperCase();\r\n        card.alignment = (str(fresh.alignment) || \"NEUTRAL\").replace(/_/g, \" \");\r\n        card.age = fresh.age || card.age;\r\n        card.stats = stats;\r\n        card.needs = { hp: 20, energy: stats.MAG, morale: 20 };\r\n        // Preserve custom/generated portrait URLs (identified by artObjectId)\r\n        let hasCustomPortrait = !!card.artObjectId;\r\n        if (!hasCustomPortrait) {\r\n            card.portraitUrl = getPortraitUrl(fresh, \"256x256\");\r\n            if (card.portraitUrl) card.portraitUrl += \"?t=\" + Date.now();\r\n        }\r\n        return true;\r\n    }\r\n\r\n    //  Character Card Builder (single char -> card data) \r\n\r\n    function assembleCharacterCard(char) {\r\n        let stats = mapStats(char.statistics);\r\n        Object.keys(stats).forEach(k => { stats[k] = clampStat(stats[k]); });\r\n        return {\r\n            type: \"character\", name: char.name || \"Unknown\",\r\n            gender: str(char.gender) || null,\r\n            race: (str(char.race) || \"HUMAN\").toUpperCase(),\r\n            alignment: (str(char.alignment) || \"NEUTRAL\").replace(/_/g, \" \"),\r\n            age: char.age || null,\r\n            level: 1,\r\n            stats,\r\n            needs: { hp: 20, energy: stats.MAG, morale: 20 },\r\n            equipped: { head: null, body: null, handL: null, handR: null, feet: null, ring: null, back: null },\r\n            activeSkills: [null, null, null, null],\r\n            portraitUrl: getPortraitUrl(char, \"256x256\"),\r\n            sourceId: char.objectId || null,  // Only real objectId, not _tempId\r\n            _sourceChar: char._tempId ? char : null  // Keep full object for temp chars\r\n        };\r\n    }\r\n\r\n    //  Per-Character Equipment Cards \r\n\r\n    function assembleCharEquipment(char) {\r\n        let stats = mapStats(char.statistics);\r\n        Object.keys(stats).forEach(k => { stats[k] = clampStat(stats[k]); });\r\n        let activeTheme = getActiveTheme();\r\n        let cn = (activeTheme && activeTheme.cardNames) || {};\r\n\r\n        let apparelCards = [];\r\n        if (char.store && char.store.apparel) {\r\n            let active = char.store.apparel.filter(a => a.wearables && a.wearables.some(w => w.inuse));\r\n            active.slice(0, 3).forEach(ap => {\r\n                let slots = [];\r\n                (ap.wearables || []).filter(w => w.inuse).forEach(w => {\r\n                    (w.location || []).forEach(loc => { if (!slots.includes(loc)) slots.push(loc); });\r\n                });\r\n                let slot = \"Body\";\r\n                if (slots.includes(\"head\")) slot = \"Head\";\r\n                else if (slots.includes(\"foot\") || slots.includes(\"feet\")) slot = \"Feet\";\r\n                else if (slots.includes(\"back\")) slot = \"Back\";\r\n                else if (slots.includes(\"finger\")) slot = \"Ring\";\r\n                apparelCards.push({\r\n                    type: \"apparel\",\r\n                    name: ap.name || (\"Apparel \" + (apparelCards.length + 1)),\r\n                    slot, rarity: \"COMMON\", def: 1 + Math.floor(Math.random() * 3),\r\n                    hpBonus: 0, durability: 5, special: null\r\n                });\r\n            });\r\n        }\r\n        if (apparelCards.length === 0) {\r\n            apparelCards.push(\r\n                { type: \"apparel\", name: cn.bodyArmor || \"Leather Armor\", slot: \"Body\", rarity: \"COMMON\", def: 2, hpBonus: 0, durability: 5, special: null },\r\n                { type: \"apparel\", name: cn.boots || \"Worn Boots\", slot: \"Feet\", rarity: \"COMMON\", def: 1, hpBonus: 0, durability: 4, special: null }\r\n            );\r\n        }\r\n\r\n        let mw = cn.meleeWeapon || {};\r\n        let rw = cn.rangedWeapon || {};\r\n        let weaponCard = {\r\n            type: \"item\", subtype: \"weapon\", name: mw.name || \"Short Sword\",\r\n            slot: \"Hand (1H)\", rarity: \"COMMON\", atk: 3, range: \"Melee\",\r\n            damageType: mw.damageType || \"Slashing\", requires: { STR: 6 }, special: null, durability: 8\r\n        };\r\n        if (stats.AGI > stats.STR) {\r\n            weaponCard = {\r\n                type: \"item\", subtype: \"weapon\", name: rw.name || \"Hunting Bow\",\r\n                slot: \"Hand (2H)\", rarity: \"COMMON\", atk: 3, range: \"Ranged\",\r\n                damageType: rw.damageType || \"Piercing\", requires: { AGI: 6 }, special: null, durability: 8\r\n            };\r\n        }\r\n\r\n        let ss = cn.strSkill || {};\r\n        let as = cn.agiSkill || {};\r\n        let ds = cn.defaultSkill || {};\r\n        let skillCards = [];\r\n        if (stats.STR >= 10) {\r\n            skillCards.push({ type: \"skill\", name: ss.name || \"Swordsmanship\", category: ss.category || \"Combat\", modifier: ss.modifier || \"+2 to Attack rolls with Slashing weapons\", requires: { STR: 10 }, tier: \"COMMON\" });\r\n        }\r\n        if (stats.AGI >= 10) {\r\n            skillCards.push({ type: \"skill\", name: as.name || \"Quick Reflexes\", category: as.category || \"Defense\", modifier: as.modifier || \"+2 to Flee and initiative rolls\", requires: { AGI: 10 }, tier: \"COMMON\" });\r\n        }\r\n        if (skillCards.length === 0) {\r\n            skillCards.push({ type: \"skill\", name: ds.name || \"Survival\", category: ds.category || \"Survival\", modifier: ds.modifier || \"+1 to Investigate and Rest rolls\", requires: {}, tier: \"COMMON\" });\r\n        }\r\n\r\n        let hm = cn.healMagic || {};\r\n        let im = cn.intMagic || {};\r\n        let magicCards = [];\r\n        if (stats.MAG >= 10) {\r\n            magicCards.push({\r\n                type: \"magic\", name: hm.name || \"Healing Light\", effectType: hm.effectType || \"Restorative\", skillType: hm.skillType || \"Imperial\",\r\n                requires: { MAG: 10 }, effect: hm.effect || \"Restore 6 HP to self or ally\",\r\n                stackWith: \"Character + Action (Use Item) + \" + (hm.skillType || \"Imperial\") + \" skill\", energyCost: 6, reusable: true\r\n            });\r\n        }\r\n        if (stats.INT >= 12) {\r\n            magicCards.push({\r\n                type: \"magic\", name: im.name || \"Mind Read\", effectType: im.effectType || \"Discovery\", skillType: im.skillType || \"Psionic\",\r\n                requires: { INT: 12 }, effect: im.effect || \"View opponent's next planned action stack\",\r\n                stackWith: \"Character + Action (Investigate)\", energyCost: 4, reusable: true\r\n            });\r\n        }\r\n\r\n        return { apparelCards, weaponCard, skillCards, magicCards };\r\n    }\r\n\r\n    //  Shuffle Utility \r\n\r\n    function shuffle(arr) {\r\n        let a = [...arr];\r\n        for (let i = a.length - 1; i > 0; i--) {\r\n            let j = Math.floor(Math.random() * (i + 1));\r\n            [a[i], a[j]] = [a[j], a[i]];\r\n        }\r\n        return a;\r\n    }\r\n\r\n    //  Starter Deck Assembly (multi-character) \r\n\r\n    function assembleStarterDeck(chars, theme) {\r\n        if (!Array.isArray(chars)) chars = [chars];\r\n\r\n        let allCards = [];\r\n        let charNames = [];\r\n        let activeTheme = getActiveTheme();\r\n\r\n        // Per-character: character card + their equipment/skills/magic\r\n        chars.forEach(char => {\r\n            let characterCard = assembleCharacterCard(char);\r\n            let equip = assembleCharEquipment(char);\r\n\r\n            // Equip gear onto character card\r\n            let bodyAp = equip.apparelCards.find(a => a.slot === \"Body\");\r\n            if (bodyAp) characterCard.equipped.body = { name: bodyAp.name };\r\n            let feetAp = equip.apparelCards.find(a => a.slot === \"Feet\");\r\n            if (feetAp) characterCard.equipped.feet = { name: feetAp.name };\r\n            characterCard.equipped.handR = { name: equip.weaponCard.name };\r\n            if (equip.skillCards.length > 0) characterCard.activeSkills[0] = { name: equip.skillCards[0].name };\r\n\r\n            allCards.push(characterCard, ...equip.apparelCards, equip.weaponCard, ...equip.skillCards, ...equip.magicCards);\r\n            charNames.push(char.name || \"Unknown\");\r\n        });\r\n\r\n        // Shared deck cards (one set regardless of player count)\r\n        let curTheme = theme || activeTheme;\r\n        let themeConsumables = (curTheme && curTheme.starterDeck && curTheme.starterDeck.consumables) || [];\r\n        let consumables = [];\r\n        if (themeConsumables.length > 0) {\r\n            themeConsumables.forEach(c => {\r\n                for (let i = 0; i < (c.count || 1); i++) {\r\n                    consumables.push({ type: \"item\", subtype: \"consumable\", name: c.name, rarity: \"COMMON\", effect: c.effect || \"\" });\r\n                }\r\n            });\r\n        } else {\r\n            consumables = [\r\n                { type: \"item\", subtype: \"consumable\", name: \"Ration\", rarity: \"COMMON\", effect: \"Restore 3 Energy\" },\r\n                { type: \"item\", subtype: \"consumable\", name: \"Ration\", rarity: \"COMMON\", effect: \"Restore 3 Energy\" },\r\n                { type: \"item\", subtype: \"consumable\", name: \"Health Potion\", rarity: \"COMMON\", effect: \"Restore 8 HP\" },\r\n                { type: \"item\", subtype: \"consumable\", name: \"Bandage\", rarity: \"COMMON\", effect: \"Restore 4 HP\" },\r\n                { type: \"item\", subtype: \"consumable\", name: \"Torch\", rarity: \"COMMON\", effect: \"+2 to Investigate rolls this round\" }\r\n            ];\r\n        }\r\n        let actionCards = [\r\n            { type: \"action\", name: \"Attack\", actionType: \"Offensive\", stackWith: \"Character + Weapon (required) + Skill (optional)\", roll: \"1d20 + STR + ATK vs target DEF\", onHit: \"Deal weapon ATK + STR as damage\", energyCost: 0 },\r\n            { type: \"action\", name: \"Flee\", actionType: \"Movement\", stackWith: \"Character only\", roll: \"1d20 + AGI vs encounter difficulty\", onHit: \"Escape the encounter\", energyCost: 0 },\r\n            { type: \"action\", name: \"Investigate\", actionType: \"Discovery\", stackWith: \"Character + Skill (optional)\", roll: \"1d20 + INT vs hidden threshold\", onHit: \"Reveal hidden items or information\", energyCost: 0 },\r\n            { type: \"action\", name: \"Trade\", actionType: \"Social\", stackWith: \"Character + Item(s) to offer\", roll: null, onHit: \"CHA determines price modifier\", energyCost: 0 },\r\n            { type: \"action\", name: \"Rest\", actionType: \"Recovery\", stackWith: \"Character only (no other actions)\", roll: null, onHit: \"Restore +2 HP, +3 Energy\", energyCost: 0 },\r\n            { type: \"action\", name: \"Use Item\", actionType: \"Utility\", stackWith: \"Character + Consumable item\", roll: null, onHit: \"Apply item effect\", energyCost: 0 },\r\n            { type: \"action\", name: \"Craft\", actionType: \"Creation\", stackWith: \"Character + Materials + Skill\", roll: \"1d20 + INT vs recipe difficulty\", onHit: \"Create new item\", energyCost: 2 }\r\n        ];\r\n        let talkCard = { type: \"talk\", name: \"Talk\", energyCost: 5 };\r\n\r\n        allCards.push(...consumables, ...actionCards, talkCard);\r\n\r\n        let themeName = (theme || activeTheme).name || (theme || activeTheme).themeId || \"high-fantasy\";\r\n        let deckName = \"\";\r\n        return {\r\n            themeId: (theme || activeTheme).themeId || \"high-fantasy\",\r\n            deckName: deckName,\r\n            characterNames: charNames,\r\n            characterIds: chars.map(c => getCharId(c)),\r\n            portraitUrl: getPortraitUrl(chars[0], \"128x128\"),\r\n            createdAt: new Date().toISOString(),\r\n            cardCount: allCards.length,\r\n            cards: allCards\r\n        };\r\n    }\r\n\r\n    //  Load Characters \r\n    // Characters come from the deck's own Characters folder or are generated\r\n    // No longer loads from Olio Population\r\n\r\n    async function loadAvailableCharacters() {\r\n        if (charsLoading) return;\r\n        charsLoading = true;\r\n        m.redraw();\r\n        try {\r\n            let allChars = [];\r\n            let seenIds = new Set();\r\n            let deckNameInput = getDeckNameInput();\r\n\r\n            // Load from deck's Characters folder if we have a deck name\r\n            if (deckNameInput) {\r\n                try {\r\n                    let deckCharDir = await page.findObject(\"auth.group\", \"data\", \"~/CardGame/\" + deckNameInput + \"/Characters\");\r\n                    if (deckCharDir) {\r\n                        let q = am7view.viewQuery(\"olio.charPerson\");\r\n                        q.field(\"groupId\", deckCharDir.id);\r\n                        q.range(0, 8);  // Max 8 characters per deck\r\n                        q.entity.request.push(\"profile\", \"store\", \"statistics\");\r\n                        let qr = await page.search(q);\r\n                        if (qr && qr.results && qr.results.length) {\r\n                            am7model.updateListModel(qr.results);\r\n                            qr.results.forEach(ch => {\r\n                                let cid = getCharId(ch);\r\n                                if (cid && !seenIds.has(cid)) {\r\n                                    seenIds.add(cid);\r\n                                    allChars.push(ch);\r\n                                }\r\n                            });\r\n                            console.log(\"[CardGame v2] Loaded \" + qr.results.length + \" characters from deck folder\");\r\n                        }\r\n                    }\r\n                } catch (de) {\r\n                    console.warn(\"[CardGame v2] Could not load deck characters:\", de);\r\n                }\r\n            }\r\n\r\n            // Resolve partially-loaded statistics for all characters\r\n            for (let ch of allChars) {\r\n                await resolveStatistics(ch);\r\n            }\r\n\r\n            availableCharacters = allChars;\r\n            if (allChars.length === 0) {\r\n                console.log(\"[CardGame v2] No characters found - will need to generate\");\r\n            } else {\r\n                console.log(\"[CardGame v2] Total available characters: \" + allChars.length);\r\n            }\r\n        } catch (e) {\r\n            console.error(\"[CardGame v2] Failed to load characters\", e);\r\n            page.toast(\"error\", \"Failed to load characters\");\r\n        }\r\n        charsLoading = false;\r\n        m.redraw();\r\n    }\r\n\r\n    //  Character Generation \r\n\r\n    async function loadCharacterTemplates() {\r\n        if (characterTemplates) return characterTemplates;\r\n        try {\r\n            characterTemplates = await m.request({\r\n                method: 'GET',\r\n                url: 'media/cardGame/character-templates.json'\r\n            });\r\n            return characterTemplates;\r\n        } catch (e) {\r\n            console.error('[CardGame] Failed to load character templates:', e);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    // Generate balanced characters from templates for a deck\r\n    // Characters are kept in memory until deck is saved - no server persistence during build\r\n    async function generateCharactersFromTemplates(themeId, count) {\r\n        if (count === undefined) count = 8;\r\n        const templates = await loadCharacterTemplates();\r\n        if (!templates || !templates.templates) {\r\n            page.toast('error', 'Character templates not available');\r\n            return [];\r\n        }\r\n\r\n        generatingCharacters = true;\r\n        m.redraw();\r\n\r\n        // Shuffle and select unique templates\r\n        const shuffled = [...templates.templates].sort(() => Math.random() - 0.5);\r\n        const selectedTemplates = shuffled.slice(0, Math.min(count, shuffled.length));\r\n\r\n        const characters = [];\r\n\r\n        for (const template of selectedTemplates) {\r\n            try {\r\n                // Roll character from server - gets random name, gender, stats, apparel\r\n                const gender = Math.random() > 0.5 ? 'male' : 'female';\r\n                const rolled = await am7model.forms.commands.rollCharacter(undefined, undefined, gender);\r\n\r\n                if (!rolled) {\r\n                    console.warn('[CardGame] Failed to roll character for template:', template.id);\r\n                    continue;\r\n                }\r\n\r\n                // Apply template modifications\r\n                rolled.alignment = template.alignment;\r\n                rolled.personality = template.personality || [];\r\n                rolled.age = Math.floor(Math.random() * 38) + 18;  // Age 18-55\r\n\r\n                // Get theme-specific trade\r\n                const themeClass = template.themeVariants?.[themeId]?.trade || template.class;\r\n                rolled.trades = [themeClass];\r\n\r\n                // Add template reference for later use\r\n                rolled._templateId = template.id;\r\n                rolled._templateClass = template.class;\r\n\r\n                // Generate a temporary ID for in-memory tracking\r\n                rolled._tempId = \"temp-\" + template.id + \"-\" + Date.now() + \"-\" + Math.random().toString(36).slice(2, 11);\r\n\r\n                characters.push(rolled);\r\n                console.log('[CardGame] Generated character:', rolled.name, 'as', themeClass);\r\n            } catch (e) {\r\n                console.error('[CardGame] Error generating character from template:', template.id, e);\r\n            }\r\n        }\r\n\r\n        page.toast('success', `Generated ${characters.length} characters`);\r\n        generatingCharacters = false;\r\n        m.redraw();\r\n        return characters;\r\n    }\r\n\r\n    // Persist generated characters to server when saving deck\r\n    async function persistGeneratedCharacters(characters, deckName) {\r\n        if (!characters || !characters.length) return [];\r\n\r\n        let charDir;\r\n        try {\r\n            charDir = await page.makePath(\"auth.group\", \"data\", \"~/CardGame/\" + deckName + \"/Characters\");\r\n            console.log('[CardGame] Characters folder:', charDir.path, 'id:', charDir.id);\r\n        } catch (e) {\r\n            console.error('[CardGame] Failed to create deck Characters folder:', e);\r\n            return [];\r\n        }\r\n\r\n        const persisted = [];\r\n        for (const char of characters) {\r\n            // Skip if already persisted (has objectId)\r\n            if (char.objectId) {\r\n                persisted.push(char);\r\n                continue;\r\n            }\r\n\r\n            try {\r\n                // Check if character already exists\r\n                let existing = await page.searchFirst(\"olio.charPerson\", charDir.id, char.name);\r\n                if (existing) {\r\n                    console.log('[CardGame] Character already exists:', char.name);\r\n                    persisted.push(existing);\r\n                    continue;\r\n                }\r\n\r\n                // Prepare entity with proper schema\r\n                let charN = am7model.prepareEntity(char, \"olio.charPerson\", true);\r\n\r\n                // Prepare nested wearables and qualities\r\n                if (charN.store && charN.store.apparel && charN.store.apparel[0] && charN.store.apparel[0].wearables) {\r\n                    let w = charN.store.apparel[0].wearables;\r\n                    for (let i = 0; i < w.length; i++) {\r\n                        w[i] = am7model.prepareEntity(w[i], \"olio.wearable\", false);\r\n                        if (w[i].qualities && w[i].qualities[0]) {\r\n                            w[i].qualities[0] = am7model.prepareEntity(w[i].qualities[0], \"olio.quality\", false);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Set the parent group to deck's Characters folder (both id and path required)\r\n                charN.groupId = charDir.id;\r\n                charN.groupPath = charDir.path;\r\n\r\n                // Create the character\r\n                let created = await page.createObject(charN);\r\n                if (created) {\r\n                    // Reload to get full object with objectId\r\n                    let saved = await page.searchFirst(\"olio.charPerson\", charDir.id, char.name);\r\n                    if (saved) {\r\n                        persisted.push(saved);\r\n                        console.log('[CardGame] Persisted character:', saved.name);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error('[CardGame] Error persisting character:', char.name, e);\r\n            }\r\n        }\r\n        return persisted;\r\n    }\r\n\r\n    //  Convert charPerson to card format \r\n\r\n    function charPersonToCard(charPerson) {\r\n        const stats = charPerson.statistics || {};\r\n        return {\r\n            id: charPerson.objectId,\r\n            objectId: charPerson.objectId,\r\n            type: \"character\",\r\n            name: charPerson.name || (charPerson.firstName + \" \" + charPerson.lastName),\r\n            gender: charPerson.gender,\r\n            race: charPerson.race,\r\n            age: charPerson.age,\r\n            alignment: charPerson.alignment,\r\n            trade: charPerson.trades?.[0] || \"\",\r\n            portraitUrl: charPerson.profile?.portrait?.groupPath && charPerson.profile?.portrait?.name ?\r\n                g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) +\r\n                \"/data.data\" + charPerson.profile.portrait.groupPath + \"/\" + charPerson.profile.portrait.name + \"/256x256\" : null,\r\n            stats: {\r\n                STR: stats.physicalStrength || 10,\r\n                AGI: stats.agility || 10,\r\n                END: stats.physicalEndurance || 10,\r\n                INT: stats.intelligence || 10,\r\n                MAG: stats.magic || stats.creativity || 10,\r\n                CHA: stats.charisma || 10\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Refresh all character cards in a deck \r\n\r\n    async function refreshAllCharacters(deck) {\r\n        if (!deck || !deck.cards) return;\r\n        let charCards = deck.cards.filter(c => c.type === \"character\" && (c.sourceId || c._sourceChar));\r\n        let refreshed = 0;\r\n        for (let card of charCards) {\r\n            let ok = await refreshCharacterCard(card);\r\n            if (ok) refreshed++;\r\n        }\r\n        if (refreshed > 0) {\r\n            console.log(\"[CardGame v2] Refreshed \" + refreshed + \" character cards from source\");\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    //  Expose on CardGame namespace \r\n\r\n    window.CardGame.Characters = {\r\n        // State (mutable, accessed by UI)\r\n        state: {\r\n            get availableCharacters() { return availableCharacters; },\r\n            set availableCharacters(v) { availableCharacters = v; },\r\n            get charsLoading() { return charsLoading; },\r\n            set charsLoading(v) { charsLoading = v; },\r\n            get selectedChars() { return selectedChars; },\r\n            set selectedChars(v) { selectedChars = v; },\r\n            get characterTemplates() { return characterTemplates; },\r\n            set characterTemplates(v) { characterTemplates = v; },\r\n            get generatingCharacters() { return generatingCharacters; },\r\n            set generatingCharacters(v) { generatingCharacters = v; }\r\n        },\r\n        // Stat utilities\r\n        statVal,\r\n        mapStats,\r\n        resolveStatistics,\r\n        clampStat,\r\n        str,\r\n        // Portrait / ID helpers\r\n        getPortraitUrl,\r\n        getCharId,\r\n        // Character CRUD\r\n        fetchCharPerson,\r\n        refreshCharacterCard,\r\n        assembleCharacterCard,\r\n        // Equipment assembly\r\n        assembleCharEquipment,\r\n        // Deck assembly\r\n        assembleStarterDeck,\r\n        // Character loading\r\n        loadAvailableCharacters,\r\n        // Character generation\r\n        loadCharacterTemplates,\r\n        generateCharactersFromTemplates,\r\n        persistGeneratedCharacters,\r\n        // Utility\r\n        charPersonToCard,\r\n        refreshAllCharacters,\r\n        shuffle\r\n    };\r\n\r\n    console.log('[CardGame] Characters service loaded (' +\r\n        Object.keys(window.CardGame.Characters).length + ' exports)');\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/services/themes.js === */\n/**\r\n * CardGame Themes Service  Theme loading, configuration, outfit application, and theme editor\r\n * Extracted from the monolithic cardGame-v2.js into a standalone module.\r\n *\r\n * Dependencies:\r\n *   - CardGame.Constants (THEME_DEFAULTS, DEFAULT_THEME)\r\n *   - CardGame.Storage (deckStorage, upsertDataRecord, loadDataRecord, listDataRecords, DECK_BASE_PATH)\r\n *   - CardGame.Characters (str, refreshCharacterCard)  [loaded after this module]\r\n *\r\n * Exposes: window.CardGame.Themes\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n\r\n    //  State \r\n    let activeTheme = CardGame.Constants.DEFAULT_THEME;\r\n    let themeLoading = false;\r\n    let colorCache = {};\r\n    let applyingOutfits = false;\r\n\r\n    //  Theme Loading \r\n\r\n    async function loadThemeConfig(themeId) {\r\n        let id = themeId || \"high-fantasy\";\r\n        try {\r\n            let resp = await m.request({\r\n                method: \"GET\",\r\n                url: \"/media/cardGame/\" + id + \".json\"\r\n            });\r\n            if (resp && resp.themeId) {\r\n                // Merge theme defaults for backgroundPrompt/promptSuffix if not in JSON\r\n                let td = CardGame.Constants.THEME_DEFAULTS[resp.themeId];\r\n                if (td) {\r\n                    if (!resp.artStyle) resp.artStyle = {};\r\n                    if (!resp.artStyle.backgroundPrompt) resp.artStyle.backgroundPrompt = td.backgroundPrompt;\r\n                    if (!resp.artStyle.promptSuffix) resp.artStyle.promptSuffix = td.promptSuffix;\r\n                }\r\n                activeTheme = resp;\r\n                console.log(\"[CardGame v2] Theme loaded:\", resp.themeId);\r\n                return resp;\r\n            }\r\n        } catch (e) {\r\n            console.warn(\"[CardGame v2] Theme config not found, using default. (\" + id + \")\", e);\r\n        }\r\n        // Build a theme from THEME_DEFAULTS if available, otherwise use DEFAULT_THEME\r\n        let td = CardGame.Constants.THEME_DEFAULTS[id];\r\n        if (td && id !== \"high-fantasy\") {\r\n            activeTheme = {\r\n                themeId: id,\r\n                name: td.name,\r\n                version: \"1.0\",\r\n                artStyle: {\r\n                    backgroundPrompt: td.backgroundPrompt,\r\n                    promptSuffix: td.promptSuffix,\r\n                    colorPalette: CardGame.Constants.DEFAULT_THEME.artStyle.colorPalette\r\n                },\r\n                balance: CardGame.Constants.DEFAULT_THEME.balance\r\n            };\r\n        } else {\r\n            activeTheme = CardGame.Constants.DEFAULT_THEME;\r\n        }\r\n        return activeTheme;\r\n    }\r\n\r\n    //  Color Lookup (for outfit system) \r\n    // Lookup colors from /Library/Colors, cache results\r\n\r\n    async function lookupColor(colorName) {\r\n        if (!colorName) return null;\r\n        let key = colorName.charAt(0).toUpperCase() + colorName.slice(1).toLowerCase();\r\n        if (colorCache[key]) return colorCache[key];\r\n        let grp = await page.findObject(\"auth.group\", \"data\", \"/Library/Colors\");\r\n        if (!grp) {\r\n            console.warn(\"[CardGame v2] /Library/Colors group not found\");\r\n            return null;\r\n        }\r\n        let q = am7view.viewQuery(\"data.color\");\r\n        q.field(\"groupId\", grp.id);\r\n        let qf = q.field(\"name\", key);\r\n        qf.comparator = \"like\";\r\n        q.range(0, 1);\r\n        let qr = await page.search(q);\r\n        if (qr && qr.results && qr.results.length) {\r\n            colorCache[key] = { id: qr.results[0].id };\r\n            return colorCache[key];\r\n        }\r\n        console.warn(\"[CardGame v2] Color not found:\", key);\r\n        return null;\r\n    }\r\n\r\n    //  Theme Outfit System \r\n    // Applies theme-defined outfits to character cards in a deck\r\n\r\n    async function applyThemeOutfits(deck, theme, skipSave) {\r\n        if (!deck || !deck.cards || applyingOutfits) return;\r\n        let thm = theme || activeTheme;\r\n        if (!thm.outfits) {\r\n            page.toast(\"warn\", \"Theme has no outfit definitions\");\r\n            return;\r\n        }\r\n        applyingOutfits = true;\r\n        m.redraw();\r\n\r\n        let charCards = deck.cards.filter(c => c.type === \"character\" && c.sourceId);\r\n        if (!charCards.length) {\r\n            page.toast(\"warn\", \"No character cards with source IDs\");\r\n            applyingOutfits = false;\r\n            m.redraw();\r\n            return;\r\n        }\r\n\r\n        let categories = [\"scrappy\", \"functional\", \"fancy\"];\r\n        let processed = 0;\r\n\r\n        // Find Apparel and Wearables in player-relative paths\r\n        let apparelDir = await page.findObject(\"auth.group\", \"data\", \"~/Apparel\");\r\n        if (!apparelDir) {\r\n            page.toast(\"error\", \"Apparel directory not found at ~/Apparel\");\r\n            applyingOutfits = false;\r\n            m.redraw();\r\n            return;\r\n        }\r\n        let wearableDir = await page.findObject(\"auth.group\", \"data\", \"~/Wearables\");\r\n        if (!wearableDir) {\r\n            page.toast(\"error\", \"Wearables directory not found at ~/Wearables\");\r\n            applyingOutfits = false;\r\n            m.redraw();\r\n            return;\r\n        }\r\n\r\n        for (let card of charCards) {\r\n            try {\r\n                page.toast(\"info\", \"Outfitting \" + card.name + \"...\", -1);\r\n\r\n                // Load full character with all nested store/apparel/wearable data\r\n                am7client.clearCache(\"olio.charPerson\");\r\n                am7client.clearCache(\"olio.apparel\");\r\n                am7client.clearCache(\"olio.wearable\");\r\n                am7client.clearCache(\"olio.store\");\r\n                let char = await am7client.getFull(\"olio.charPerson\", card.sourceId);\r\n                if (!char) {\r\n                    console.warn(\"[CardGame v2] Could not fetch char:\", card.sourceId);\r\n                    continue;\r\n                }\r\n\r\n                // Determine gender for outfit selection\r\n                let gender = CardGame.Characters.str(char.gender).toLowerCase();\r\n                if (gender !== \"male\" && gender !== \"female\") gender = \"male\";\r\n                let genderOutfits = thm.outfits[gender];\r\n                if (!genderOutfits) {\r\n                    console.warn(\"[CardGame v2] No outfits for gender:\", gender);\r\n                    continue;\r\n                }\r\n\r\n                // Pick random category\r\n                let cat = categories[Math.floor(Math.random() * categories.length)];\r\n                let outfitDef = genderOutfits[cat];\r\n                if (!outfitDef) {\r\n                    console.warn(\"[CardGame v2] No outfit for category:\", cat);\r\n                    continue;\r\n                }\r\n\r\n                let storeObjId = char.store ? char.store.objectId : null;\r\n                if (!storeObjId) {\r\n                    console.warn(\"[CardGame v2] No store for char:\", card.name);\r\n                    continue;\r\n                }\r\n\r\n                // 2. Deactivate ALL current apparel from the full store data\r\n                let existingApparel = (char.store.apparel || []);\r\n                for (let ap of existingApparel) {\r\n                    // Deactivate wearables first\r\n                    if (ap.wearables && ap.wearables.length) {\r\n                        let wPatches = ap.wearables.filter(w => w.inuse).map(w =>\r\n                            page.patchObject({ schema: \"olio.wearable\", id: w.id, inuse: false })\r\n                        );\r\n                        if (wPatches.length) await Promise.all(wPatches);\r\n                    }\r\n                    // Deactivate apparel\r\n                    if (ap.inuse) {\r\n                        await page.patchObject({ schema: \"olio.apparel\", id: ap.id, inuse: false });\r\n                    }\r\n                    // Remove old apparel from store membership so it won't interfere\r\n                    await new Promise(res => {\r\n                        am7client.member(\"olio.store\", storeObjId, \"apparel\", \"olio.apparel\", ap.objectId, false, res);\r\n                    });\r\n                }\r\n\r\n                // 2b. Clear existing items from store\r\n                let storeItemList = await new Promise(res => {\r\n                    am7client.members(\"olio.store\", storeObjId, \"olio.item\", 0, 50, res);\r\n                });\r\n                if (storeItemList && storeItemList.length) {\r\n                    for (let itemRef of storeItemList) {\r\n                        await new Promise(res => {\r\n                            am7client.member(\"olio.store\", storeObjId, \"items\", \"olio.item\", itemRef.objectId, false, res);\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // 2c. Clear existing inventory entries from store\r\n                let storeInvList = await new Promise(res => {\r\n                    am7client.members(\"olio.store\", storeObjId, \"olio.inventoryEntry\", 0, 50, res);\r\n                });\r\n                if (storeInvList && storeInvList.length) {\r\n                    for (let invRef of storeInvList) {\r\n                        await new Promise(res => {\r\n                            am7client.member(\"olio.store\", storeObjId, \"inventory\", \"olio.inventoryEntry\", invRef.objectId, false, res);\r\n                        });\r\n                    }\r\n                }\r\n\r\n                // 3. Create apparel in the world-level Apparel directory\r\n                let apparel = {\r\n                    schema: \"olio.apparel\",\r\n                    groupId: apparelDir.id,\r\n                    name: outfitDef.name,\r\n                    type: outfitDef.type || \"casual\",\r\n                    gender: outfitDef.gender || gender\r\n                };\r\n                let createdApparel = await page.createObject(apparel);\r\n                if (!createdApparel) {\r\n                    console.warn(\"[CardGame v2] Failed to create apparel for\", card.name);\r\n                    continue;\r\n                }\r\n\r\n                // 4. Create wearables in the world-level Wearables directory\r\n                let createdWearables = [];\r\n                for (let wDef of outfitDef.wearables) {\r\n                    let colorRef = await lookupColor(wDef.color);\r\n                    let wearable = {\r\n                        schema: \"olio.wearable\",\r\n                        groupId: wearableDir.id,\r\n                        name: wDef.name,\r\n                        location: wDef.location,\r\n                        fabric: wDef.fabric,\r\n                        gender: wDef.gender || gender,\r\n                        level: wDef.level || \"SUIT\"\r\n                    };\r\n                    if (colorRef) wearable.color = colorRef;\r\n                    let created = await page.createObject(wearable);\r\n                    if (created) createdWearables.push(created);\r\n                }\r\n\r\n                // 5. Link wearables to apparel via membership\r\n                for (let cw of createdWearables) {\r\n                    await page.member(\"olio.apparel\", createdApparel.objectId, \"olio.wearable\", cw.objectId, true);\r\n                }\r\n\r\n                // 6. Link apparel to store via membership (field name: \"apparel\")\r\n                await new Promise(res => {\r\n                    am7client.member(\"olio.store\", storeObjId, \"apparel\", \"olio.apparel\", createdApparel.objectId, true, res);\r\n                });\r\n\r\n                // 7. Patch inuse = true on all wearables and the apparel\r\n                let inusePatches = createdWearables.map(cw =>\r\n                    page.patchObject({ schema: \"olio.wearable\", id: cw.id, inuse: true })\r\n                );\r\n                inusePatches.push(\r\n                    page.patchObject({ schema: \"olio.apparel\", id: createdApparel.id, inuse: true })\r\n                );\r\n                await Promise.all(inusePatches);\r\n\r\n                // 8. Clear caches so subsequent reads reflect new state\r\n                am7client.clearCache(\"olio.wearable\");\r\n                am7client.clearCache(\"olio.apparel\");\r\n                am7client.clearCache(\"olio.store\");\r\n                am7client.clearCache(\"olio.charPerson\");\r\n\r\n                // 9. Update narrative to reflect new outfit for imaging\r\n                await m.request({ method: 'GET', url: am7client.base() + \"/olio/olio.charPerson/\" + card.sourceId + \"/narrate\", withCredentials: true });\r\n\r\n                // 10. Refresh character card data\r\n                await CardGame.Characters.refreshCharacterCard(card);\r\n                processed++;\r\n                console.log(\"[CardGame v2] Applied \" + cat + \" outfit to \" + card.name);\r\n\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to outfit \" + card.name, e);\r\n                page.clearToast();  // Clear indefinite progress toast\r\n                page.toast(\"error\", \"Failed to outfit \" + card.name);\r\n            }\r\n        }\r\n\r\n        applyingOutfits = false;\r\n        page.clearToast();  // Clear indefinite progress toast\r\n        if (processed > 0) {\r\n            if (!skipSave) {\r\n                let safeName = (deck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n                await CardGame.Storage.deckStorage.save(safeName, deck);\r\n            }\r\n            page.toast(\"success\", \"Applied outfits to \" + processed + \" character(s)\");\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    //  Theme Storage \r\n    // Persists custom themes at ~/CardGame/themes/\r\n\r\n    const THEME_STORAGE_PATH = CardGame.Storage.DECK_BASE_PATH + \"/themes\";\r\n\r\n    const themeStorage = {\r\n        async save(themeId, themeData) {\r\n            try {\r\n                return await CardGame.Storage.upsertDataRecord(THEME_STORAGE_PATH, themeId + \".json\", themeData);\r\n            } catch (e) {\r\n                console.error(\"[CardGame v2] Failed to save theme:\", themeId, e);\r\n                return null;\r\n            }\r\n        },\r\n        async load(themeId) {\r\n            try {\r\n                return await CardGame.Storage.loadDataRecord(THEME_STORAGE_PATH, themeId + \".json\", false);\r\n            } catch (e) {\r\n                return null;\r\n            }\r\n        },\r\n        async list() {\r\n            try {\r\n                let records = await CardGame.Storage.listDataRecords(THEME_STORAGE_PATH);\r\n                return records.filter(r => r.name?.endsWith(\".json\")).map(r => r.name.replace(\".json\", \"\"));\r\n            } catch (e) {\r\n                return [];\r\n            }\r\n        },\r\n        async remove(themeId) {\r\n            try {\r\n                let grp = await page.findObject(\"auth.group\", \"DATA\", THEME_STORAGE_PATH);\r\n                if (!grp) return;\r\n                let q = am7view.viewQuery(\"data.data\");\r\n                q.field(\"groupId\", grp.id);\r\n                q.field(\"name\", themeId + \".json\");\r\n                let qr = await page.search(q);\r\n                if (qr?.results?.length) {\r\n                    await page.deleteObject(\"data.data\", qr.results[0].objectId);\r\n                }\r\n            } catch (e) {\r\n                console.warn(\"[CardGame v2] Failed to remove theme:\", themeId, e);\r\n            }\r\n        }\r\n    };\r\n\r\n    //  Theme List Loading \r\n\r\n    let themeEditorState = {\r\n        themes: [],        // [{ name, themeId, isCustom, isBuiltin }]\r\n        loading: false,\r\n        editingTheme: null, // Full theme JSON being edited\r\n        editingName: \"\",\r\n        jsonText: \"\",\r\n        jsonError: null,\r\n        dirty: false\r\n    };\r\n\r\n    async function loadThemeList() {\r\n        themeEditorState.loading = true;\r\n        m.redraw();\r\n        let builtins = [\"high-fantasy\", \"dark-medieval\", \"sci-fi\", \"post-apocalypse\"];\r\n        let custom = await themeStorage.list();\r\n        themeEditorState.themes = [\r\n            ...builtins.map(id => ({ themeId: id, name: id.replace(/-/g, \" \").replace(/\\b\\w/g, c => c.toUpperCase()), isBuiltin: true, isCustom: false })),\r\n            ...custom.filter(id => !builtins.includes(id)).map(id => ({ themeId: id, name: id.replace(/-/g, \" \").replace(/\\b\\w/g, c => c.toUpperCase()), isBuiltin: false, isCustom: true }))\r\n        ];\r\n        themeEditorState.loading = false;\r\n        m.redraw();\r\n    }\r\n\r\n    async function editTheme(themeId, isBuiltin) {\r\n        let themeData;\r\n        if (isBuiltin) {\r\n            // Load from active theme config and card pool\r\n            await loadThemeConfig(themeId);\r\n            themeData = {\r\n                themeId: themeId + \"-custom\",\r\n                name: activeTheme.name + \" (Custom)\",\r\n                description: activeTheme.description || \"\",\r\n                sdSuffix: activeTheme.sdSuffix || \"\",\r\n                narratorProfile: \"arena-announcer\",\r\n                cardPool: activeTheme.cardPool || []\r\n            };\r\n        } else {\r\n            themeData = await themeStorage.load(themeId);\r\n            if (!themeData) themeData = { themeId, name: themeId, cardPool: [] };\r\n        }\r\n        themeEditorState.editingTheme = themeData;\r\n        themeEditorState.editingName = themeData.name || themeId;\r\n        themeEditorState.jsonText = JSON.stringify(themeData, null, 2);\r\n        themeEditorState.jsonError = null;\r\n        themeEditorState.dirty = false;\r\n        m.redraw();\r\n    }\r\n\r\n    function createNewTheme() {\r\n        let template = {\r\n            themeId: \"custom-\" + Date.now(),\r\n            name: \"My Custom Theme\",\r\n            description: \"A custom card game theme\",\r\n            sdSuffix: \"fantasy art, detailed illustration\",\r\n            narratorProfile: \"arena-announcer\",\r\n            cardPool: [\r\n                { type: \"action\", name: \"Attack\", subtype: \"melee\", effect: \"Standard melee attack\", rarity: \"COMMON\" },\r\n                { type: \"action\", name: \"Rest\", effect: \"Restore 2 HP, 3 Energy, 2 Morale\", rarity: \"COMMON\" },\r\n                { type: \"talk\", name: \"Persuade\", speechType: \"Diplomacy\", effect: \"CHA vs CHA for morale damage\", rarity: \"COMMON\" },\r\n                { type: \"skill\", name: \"Custom Skill\", modifier: \"+2 to Attack rolls\", rarity: \"UNCOMMON\" },\r\n                { type: \"magic\", name: \"Custom Spell\", effect: \"Deal 10 damage\", energyCost: 5, requires: { MAG: 8 }, rarity: \"RARE\" },\r\n                { type: \"item\", subtype: \"weapon\", name: \"Custom Weapon\", atk: 3, range: \"Melee\", damageType: \"Slashing\", rarity: \"COMMON\" },\r\n                { type: \"item\", subtype: \"armor\", name: \"Custom Armor\", def: 2, rarity: \"COMMON\" },\r\n                { type: \"item\", subtype: \"consumable\", name: \"Health Potion\", effect: \"Restore 15 HP\", rarity: \"UNCOMMON\" },\r\n                { type: \"apparel\", name: \"Custom Garb\", def: 1, slot: \"Body\", rarity: \"COMMON\" },\r\n                { type: \"encounter\", name: \"Custom Encounter\", atk: 3, def: 2, hp: 15, behavior: \"Attacks randomly\", loot: \"UNCOMMON\", rarity: \"UNCOMMON\" }\r\n            ]\r\n        };\r\n        themeEditorState.editingTheme = template;\r\n        themeEditorState.editingName = template.name;\r\n        themeEditorState.jsonText = JSON.stringify(template, null, 2);\r\n        themeEditorState.jsonError = null;\r\n        themeEditorState.dirty = true;\r\n        m.redraw();\r\n    }\r\n\r\n    //  Theme Editor UI Component \r\n\r\n    function ThemeEditorUI() {\r\n        return {\r\n            oninit() { loadThemeList(); },\r\n            view() {\r\n                // Editing view\r\n                if (themeEditorState.editingTheme) {\r\n                    let theme = themeEditorState.editingTheme;\r\n                    let cardCount = 0;\r\n                    try { cardCount = JSON.parse(themeEditorState.jsonText).cardPool?.length || 0; } catch (e) { /* parse error handled below */ }\r\n\r\n                    return m(\"div\", { class: \"cg2-theme-editor\" }, [\r\n                        m(\"div\", { class: \"cg2-toolbar\" }, [\r\n                            m(\"button\", { class: \"cg2-btn\", onclick() { themeEditorState.editingTheme = null; m.redraw(); } }, \"\\u2190 Back\"),\r\n                            m(\"span\", { style: { fontWeight: 700, fontSize: \"16px\", marginLeft: \"8px\" } }, \"Theme Editor\"),\r\n                            m(\"span\", { style: { fontSize: \"11px\", color: \"#888\", marginLeft: \"8px\" } }, cardCount + \" cards in pool\"),\r\n                            themeEditorState.dirty ? m(\"span\", { style: { fontSize: \"11px\", color: \"#E65100\", marginLeft: \"8px\" } }, \"(unsaved changes)\") : null,\r\n                            m(\"button\", {\r\n                                class: \"cg2-btn cg2-btn-primary\", style: { marginLeft: \"auto\" },\r\n                                disabled: !!themeEditorState.jsonError,\r\n                                async onclick() {\r\n                                    try {\r\n                                        let parsed = JSON.parse(themeEditorState.jsonText);\r\n                                        parsed.name = themeEditorState.editingName;\r\n                                        await themeStorage.save(parsed.themeId, parsed);\r\n                                        themeEditorState.editingTheme = parsed;\r\n                                        themeEditorState.dirty = false;\r\n                                        page.toast(\"success\", \"Theme saved: \" + parsed.name);\r\n                                        loadThemeList();\r\n                                    } catch (e) {\r\n                                        page.toast(\"error\", \"Save failed: \" + e.message);\r\n                                    }\r\n                                }\r\n                            }, \"Save Theme\")\r\n                        ]),\r\n\r\n                        // Theme name input\r\n                        m(\"div\", { style: { padding: \"8px 16px\", display: \"flex\", gap: \"12px\", alignItems: \"center\" } }, [\r\n                            m(\"label\", { style: { fontWeight: 600, fontSize: \"13px\" } }, \"Name:\"),\r\n                            m(\"input\", {\r\n                                class: \"cg2-input\", style: { flex: 1 },\r\n                                value: themeEditorState.editingName,\r\n                                oninput(e) { themeEditorState.editingName = e.target.value; themeEditorState.dirty = true; }\r\n                            }),\r\n                            m(\"label\", { style: { fontWeight: 600, fontSize: \"13px\" } }, \"ID:\"),\r\n                            m(\"span\", { style: { fontSize: \"12px\", color: \"#888\" } }, theme.themeId)\r\n                        ]),\r\n\r\n                        // JSON error indicator\r\n                        themeEditorState.jsonError ? m(\"div\", { style: { padding: \"4px 16px\", color: \"#c62828\", fontSize: \"12px\" } }, themeEditorState.jsonError) : null,\r\n\r\n                        // JSON editor\r\n                        m(\"textarea\", {\r\n                            class: \"cg2-json-editor\",\r\n                            value: themeEditorState.jsonText,\r\n                            oninput(e) {\r\n                                themeEditorState.jsonText = e.target.value;\r\n                                themeEditorState.dirty = true;\r\n                                try {\r\n                                    JSON.parse(e.target.value);\r\n                                    themeEditorState.jsonError = null;\r\n                                } catch (err) {\r\n                                    themeEditorState.jsonError = \"JSON Error: \" + err.message;\r\n                                }\r\n                            },\r\n                            spellcheck: false\r\n                        }),\r\n\r\n                        // Card Effect Builder (interactive helper)\r\n                        m(\"div\", { class: \"cg2-effect-builder\" }, [\r\n                            m(\"h3\", { style: { margin: \"0 0 8px\", fontSize: \"14px\" } }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"4px\" } }, \"build\"),\r\n                                \"Card Effect Builder\"\r\n                            ]),\r\n                            m(\"p\", { style: { fontSize: \"11px\", color: \"#666\", margin: \"0 0 8px\" } },\r\n                                \"Click effect tokens to build a parseable effect string. Copy into your card's effect field.\"),\r\n                            m(\"div\", { class: \"cg2-effect-tokens\" }, [\r\n                                m(\"span\", { class: \"cg2-effect-section-label\" }, \"DAMAGE:\"),\r\n                                ...[5, 10, 15, 20, 25].map(n =>\r\n                                    m(\"button\", { class: \"cg2-effect-token cg2-effect-token-damage\", onclick() { themeEditorState.effectPreview = (themeEditorState.effectPreview || \"\") + \"Deal \" + n + \" damage. \"; m.redraw(); } }, \"Deal \" + n)\r\n                                ),\r\n                                m(\"span\", { class: \"cg2-effect-section-label\" }, \"DRAIN:\"),\r\n                                ...[5, 10, 15].map(n =>\r\n                                    m(\"button\", { class: \"cg2-effect-token cg2-effect-token-damage\", onclick() { themeEditorState.effectPreview = (themeEditorState.effectPreview || \"\") + \"Drain \" + n + \" health. \"; m.redraw(); } }, \"Drain \" + n)\r\n                                ),\r\n                                m(\"span\", { class: \"cg2-effect-section-label\" }, \"HEALING:\"),\r\n                                ...[5, 10, 15, 20].map(n =>\r\n                                    m(\"button\", { class: \"cg2-effect-token cg2-effect-token-heal\", onclick() { themeEditorState.effectPreview = (themeEditorState.effectPreview || \"\") + \"Restore \" + n + \" HP. \"; m.redraw(); } }, \"Heal \" + n)\r\n                                ),\r\n                                ...[3, 5, 8].map(n =>\r\n                                    m(\"button\", { class: \"cg2-effect-token cg2-effect-token-heal\", onclick() { themeEditorState.effectPreview = (themeEditorState.effectPreview || \"\") + \"Restore \" + n + \" Energy. \"; m.redraw(); } }, \"Energy \" + n)\r\n                                ),\r\n                                ...[3, 5, 10].map(n =>\r\n                                    m(\"button\", { class: \"cg2-effect-token cg2-effect-token-heal\", onclick() { themeEditorState.effectPreview = (themeEditorState.effectPreview || \"\") + \"Restore \" + n + \" Morale. \"; m.redraw(); } }, \"Morale \" + n)\r\n                                ),\r\n                                m(\"span\", { class: \"cg2-effect-section-label\" }, \"STATUS (enemy):\"),\r\n                                ...[\"Stun\", \"Poison\", \"Burn\", \"Bleed\", \"Weaken\"].map(s =>\r\n                                    m(\"button\", { class: \"cg2-effect-token cg2-effect-token-debuff\", onclick() { themeEditorState.effectPreview = (themeEditorState.effectPreview || \"\") + s + \" target. \"; m.redraw(); } }, s)\r\n                                ),\r\n                                m(\"span\", { class: \"cg2-effect-section-label\" }, \"BUFF (self):\"),\r\n                                ...[\"Shield\", \"Enrage\", \"Fortify\", \"Inspire\", \"Regenerate\"].map(s =>\r\n                                    m(\"button\", { class: \"cg2-effect-token cg2-effect-token-buff\", onclick() { themeEditorState.effectPreview = (themeEditorState.effectPreview || \"\") + s + \" self. \"; m.redraw(); } }, s)\r\n                                ),\r\n                                m(\"span\", { class: \"cg2-effect-section-label\" }, \"UTILITY:\"),\r\n                                ...[1, 2, 3].map(n =>\r\n                                    m(\"button\", { class: \"cg2-effect-token cg2-effect-token-util\", onclick() { themeEditorState.effectPreview = (themeEditorState.effectPreview || \"\") + \"Draw \" + n + \" cards. \"; m.redraw(); } }, \"Draw \" + n)\r\n                                ),\r\n                                m(\"button\", { class: \"cg2-effect-token cg2-effect-token-util\", onclick() { themeEditorState.effectPreview = (themeEditorState.effectPreview || \"\") + \"Cure all poisons. \"; m.redraw(); } }, \"Cure\"),\r\n                            ]),\r\n                            // Preview with validation\r\n                            themeEditorState.effectPreview ? m(\"div\", { class: \"cg2-effect-preview\" }, [\r\n                                m(\"div\", { style: { display: \"flex\", alignItems: \"center\", gap: \"8px\", marginBottom: \"4px\" } }, [\r\n                                    m(\"strong\", { style: { fontSize: \"11px\" } }, \"Preview:\"),\r\n                                    m(\"button\", { class: \"cg2-btn cg2-btn-sm\", onclick() {\r\n                                        if (navigator.clipboard) navigator.clipboard.writeText(themeEditorState.effectPreview.trim());\r\n                                        else page.toast(\"info\", themeEditorState.effectPreview.trim());\r\n                                    } }, \"Copy\"),\r\n                                    m(\"button\", { class: \"cg2-btn cg2-btn-sm\", onclick() { themeEditorState.effectPreview = \"\"; m.redraw(); } }, \"Clear\")\r\n                                ]),\r\n                                m(\"code\", { style: { fontSize: \"12px\", display: \"block\", padding: \"6px 8px\", background: \"rgba(0,0,0,0.05)\", borderRadius: \"4px\" } }, themeEditorState.effectPreview.trim()),\r\n                                m(\"div\", { style: { fontSize: \"10px\", marginTop: \"4px\" } }, (() => {\r\n                                    let parsed = CardGame.Engine.parseEffect(themeEditorState.effectPreview);\r\n                                    let parts = [];\r\n                                    if (parsed.damage) parts.push(\"DMG:\" + parsed.damage);\r\n                                    if (parsed.healHp) parts.push(\"HEAL:\" + parsed.healHp + \" HP\");\r\n                                    if (parsed.restoreEnergy) parts.push(\"+\" + parsed.restoreEnergy + \" Energy\");\r\n                                    if (parsed.restoreMorale) parts.push(\"+\" + parsed.restoreMorale + \" Morale\");\r\n                                    if (parsed.draw) parts.push(\"DRAW:\" + parsed.draw);\r\n                                    if (parsed.cure) parts.push(\"CURE\");\r\n                                    if (parsed.statusEffects) parsed.statusEffects.forEach(s => parts.push(s.id.toUpperCase() + \"\\u2192\" + s.target));\r\n                                    return parts.length > 0\r\n                                        ? m(\"span\", { style: { color: \"#2E7D32\" } }, \"\\u2713 Parsed: \" + parts.join(\", \"))\r\n                                        : m(\"span\", { style: { color: \"#c62828\" } }, \"\\u2717 No mechanical effects detected\");\r\n                                })())\r\n                            ]) : null,\r\n                            // Skill modifier builder\r\n                            m(\"div\", { style: { marginTop: \"8px\", borderTop: \"1px solid rgba(0,0,0,0.08)\", paddingTop: \"8px\" } }, [\r\n                                m(\"strong\", { style: { fontSize: \"11px\" } }, \"Skill Modifier Templates:\"),\r\n                                m(\"div\", { class: \"cg2-effect-tokens\", style: { marginTop: \"4px\" } }, [\r\n                                    ...[\"Attack\", \"Defense\", \"Talk/Social\", \"Flee/Initiative\", \"Investigate\", \"Craft\", \"Magic/Spell\"].map(act =>\r\n                                        m(\"button\", { class: \"cg2-effect-token cg2-effect-token-skill\", onclick() {\r\n                                            themeEditorState.effectPreview = \"+2 to \" + act + \" rolls\";\r\n                                            m.redraw();\r\n                                        } }, \"+2 \" + act)\r\n                                    )\r\n                                ])\r\n                            ])\r\n                        ]),\r\n\r\n                        // Card Pool Quick Reference\r\n                        m(\"div\", { class: \"cg2-theme-reference\" }, [\r\n                            m(\"h3\", \"Card Pool Reference\"),\r\n                            m(\"p\", { style: { fontSize: \"11px\", color: \"#666\" } }, \"Each card in the cardPool array needs these fields:\"),\r\n                            m(\"pre\", { style: { fontSize: \"10px\", background: \"rgba(0,0,0,0.05)\", padding: \"8px\", borderRadius: \"6px\", overflow: \"auto\", maxHeight: \"200px\" } },\r\n`SKILL:   { type:\"skill\", name, modifier:\"+N to Attack/Defense/Talk/Flee/Investigate/Craft/Magic\", rarity }\r\n  \\u2192 modifier MUST contain +N and a keyword: attack, combat, melee, defense, parry, talk, social,\r\n    flee, escape, initiative, investigate, search, craft, magic, spell, etc.\r\n\r\nMAGIC:   { type:\"magic\", name, effect, energyCost, requires:{MAG:N}, rarity }\r\n  \\u2192 PARSEABLE EFFECTS (combine any):\r\n    \"Deal N damage\" \\u2014 direct damage to target\r\n    \"Drain N\"       \\u2014 damage target + heal self same amount\r\n    \"Heal N\" / \"Restore N HP\"   \\u2014 heal owner\r\n    \"Restore N Energy/Morale\"   \\u2014 restore resources\r\n    \"Draw N\"        \\u2014 draw N extra cards\r\n    \"Stun/Poison/Burn/Bleed/Weaken target\" \\u2014 debuff target\r\n    \"Shield/Enrage/Fortify/Inspire/Regenerate self\" \\u2014 buff self\r\n    \"Cure/Cleanse\"  \\u2014 remove negative statuses\r\n\r\nITEM:    Weapon:     { type:\"item\", subtype:\"weapon\", name, atk:N, range, damageType, rarity }\r\n         Armor:      { type:\"item\", subtype:\"armor\", name, def:N, rarity }\r\n         Consumable: { type:\"item\", subtype:\"consumable\", name, effect:(same as magic), rarity }\r\nAPPAREL: { type:\"apparel\", name, def:N, hpBonus:N, slot:\"Body|Head|Feet\", rarity }\r\nACTION:  { type:\"action\", name:\"Attack|Rest|Guard|Flee\", effect, rarity }\r\nTALK:    { type:\"talk\", name, speechType, effect, rarity }\r\nENCOUNTER: { type:\"encounter\", name, atk:N, def:N, hp:N, behavior, loot:\"RARITY\", rarity }\r\n\r\nRARITY:  \"COMMON\" | \"UNCOMMON\" | \"RARE\" | \"EPIC\" | \"LEGENDARY\"\r\n\r\nSTATUS EFFECTS: stunned(1t), poisoned(3t, -2HP/t), burning(2t, -3HP/t),\r\n  bleeding(4t, -1HP/t), shielded(+3 DEF until hit), weakened(2t, -2 rolls),\r\n  enraged(2t, +3ATK -2DEF), fortified(2t, +2DEF +1ATK),\r\n  inspired(2t, +2 rolls), regenerating(3t, +2HP/t)`)\r\n                        ])\r\n                    ]);\r\n                }\r\n\r\n                // Theme list view\r\n                return m(\"div\", { class: \"cg2-theme-editor\" }, [\r\n                    m(\"div\", { class: \"cg2-toolbar\" }, [\r\n                        m(\"button\", { class: \"cg2-btn\", onclick() { CardGame.Themes.navigateBack(); } }, \"\\u2190 Back\"),\r\n                        m(\"span\", { style: { fontWeight: 700, fontSize: \"16px\", marginLeft: \"8px\" } }, \"Theme Editor\"),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\", style: { marginLeft: \"auto\" },\r\n                            onclick() { createNewTheme(); }\r\n                        }, [m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"3px\" } }, \"add\"), \"New Theme\"]),\r\n                        themeEditorState.loading ? m(\"span\", { class: \"cg2-loading\" }, \"Loading...\") : null\r\n                    ]),\r\n                    m(\"div\", { class: \"cg2-theme-list\" },\r\n                        themeEditorState.themes.map(t =>\r\n                            m(\"div\", { class: \"cg2-theme-list-item\" }, [\r\n                                m(\"div\", { class: \"cg2-theme-list-name\" }, [\r\n                                    t.name,\r\n                                    t.isBuiltin ? m(\"span\", { class: \"cg2-theme-badge-builtin\" }, \"Built-in\") : null,\r\n                                    t.isCustom ? m(\"span\", { class: \"cg2-theme-badge-custom\" }, \"Custom\") : null\r\n                                ]),\r\n                                m(\"div\", { class: \"cg2-theme-list-actions\" }, [\r\n                                    m(\"button\", { class: \"cg2-btn\", onclick() { editTheme(t.themeId, t.isBuiltin); } },\r\n                                        t.isBuiltin ? \"Customize\" : \"Edit\"),\r\n                                    t.isCustom ? m(\"button\", {\r\n                                        class: \"cg2-btn cg2-btn-danger\",\r\n                                        onclick() {\r\n                                            page.components.dialog.confirm(\"Delete theme '\" + t.name + \"'?\", async function(ok) {\r\n                                                if (ok) {\r\n                                                    await themeStorage.remove(t.themeId);\r\n                                                    loadThemeList();\r\n                                                }\r\n                                            });\r\n                                        }\r\n                                    }, \"Delete\") : null\r\n                                ])\r\n                            ])\r\n                        ),\r\n                        themeEditorState.themes.length === 0 ? m(\"div\", { class: \"cg2-empty-state\" }, \"No themes found.\") : null\r\n                    )\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Expose on CardGame namespace \r\n    window.CardGame.Themes = {\r\n        state: {\r\n            get activeTheme() { return activeTheme; },\r\n            set activeTheme(v) { activeTheme = v; },\r\n            get themeLoading() { return themeLoading; },\r\n            set themeLoading(v) { themeLoading = v; },\r\n            get colorCache() { return colorCache; },\r\n            get applyingOutfits() { return applyingOutfits; },\r\n            set applyingOutfits(v) { applyingOutfits = v; }\r\n        },\r\n        loadThemeConfig,\r\n        lookupColor,\r\n        applyThemeOutfits,\r\n        getActiveTheme: () => activeTheme,\r\n        // Theme editor\r\n        themeStorage,\r\n        themeEditorState,\r\n        loadThemeList,\r\n        editTheme,\r\n        createNewTheme,\r\n        ThemeEditorUI,\r\n        // Navigation callback  set by CardGameApp to wire screen changes\r\n        navigateBack: function() { console.warn(\"[CardGame] navigateBack not wired\"); }\r\n    };\r\n\r\n    console.log('[CardGame] Themes service loaded');\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/services/artPipeline.js === */\n/**\r\n * CardGame Art Pipeline Service -- SD prompt building, art generation queue,\r\n * background/tabletop generation, template art, and image sequence generation.\r\n *\r\n * Extracted from the monolithic cardGame-v2.js (lines ~2400-3614).\r\n * Handles all image generation operations for the card game.\r\n *\r\n * Exposes: window.CardGame.ArtPipeline\r\n *\r\n * Dependencies:\r\n *   - window.CardGame.Constants (DEFAULT_THEME)\r\n *   - window.CardGame.ctx (shared mutable context: viewingDeck, gameState, activeTheme)\r\n *   - window.CardGame.Storage (deckStorage)\r\n *   - window.CardGame.Characters (refreshCharacterCard)\r\n *   - window.am7sd (global from sdConfig.js)\r\n *   - AM7 globals: am7view, am7client, am7model, am7olio, page, g_application_path, m\r\n */\r\n(function() {\r\n\r\n    window.CardGame = window.CardGame || {};\r\n\r\n    const ART_BASE_PATH = \"~/CardGame/Art\";\r\n\r\n    //  Convenience accessors for shared context \r\n    function getActiveTheme() {\r\n        return (CardGame.ctx && CardGame.ctx.activeTheme) || CardGame.Constants.DEFAULT_THEME;\r\n    }\r\n    function getViewingDeck() {\r\n        return CardGame.ctx ? CardGame.ctx.viewingDeck : null;\r\n    }\r\n    function getDeckStorage() {\r\n        return CardGame.Storage ? CardGame.Storage.deckStorage : null;\r\n    }\r\n    function getGameState() {\r\n        return CardGame.ctx ? CardGame.ctx.gameState : null;\r\n    }\r\n\r\n    //  Prompt Builder \r\n    // Build SD prompts from card data + theme art style\r\n\r\n    function styleLabel(style) {\r\n        switch (style) {\r\n            case \"photograph\": return \"photograph\";\r\n            case \"movie\":      return \"movie still\";\r\n            case \"selfie\":     return \"selfie\";\r\n            case \"anime\":      return \"anime illustration\";\r\n            case \"portrait\":   return \"studio portrait\";\r\n            case \"comic\":      return \"comic book illustration\";\r\n            case \"digitalArt\": return \"digital artwork\";\r\n            case \"fashion\":    return \"fashion photograph\";\r\n            case \"vintage\":    return \"vintage photograph\";\r\n            case \"art\":        return \"painting\";\r\n            default:           return \"illustration\";\r\n        }\r\n    }\r\n\r\n    // Descriptive prompt snippets for action cards by name (hardcoded fallbacks)\r\n    let ACTION_PROMPTS = {\r\n        \"Attack\":      \"a warrior mid-strike with weapon raised\",\r\n        \"Strike\":      \"a warrior mid-strike with weapon raised\",\r\n        \"Flee\":        \"a person running away from danger, motion blur\",\r\n        \"Investigate\": \"a person with lantern searching for clues in shadows\",\r\n        \"Trade\":       \"two merchants exchanging goods at a market stall\",\r\n        \"Rest\":        \"a weary traveler resting by a warm campfire\",\r\n        \"Use Item\":    \"hands holding a glowing magical item\",\r\n        \"Craft\":       \"hands crafting an item at a workbench with tools\",\r\n        \"Guard\":       \"a warrior in defensive stance with shield raised\",\r\n        \"Feint\":       \"a cunning fighter making a deceptive move\"\r\n    };\r\n\r\n    // Descriptive prompt snippets for talk cards by name (hardcoded fallbacks)\r\n    let TALK_PROMPTS = {\r\n        \"Talk\":     \"two people in animated conversation\",\r\n        \"Taunt\":    \"a confident figure taunting an opponent with a smirk\",\r\n        \"Persuade\": \"a charming speaker convincing a skeptical listener\"\r\n    };\r\n\r\n    // Attempt to load extended prompts from external JSON\r\n    (function loadExternalPrompts() {\r\n        m.request({\r\n            method: \"GET\",\r\n            url: \"media/cardGame/prompts/art-prompts.json\",\r\n            withCredentials: false,\r\n            deserialize: function(v) { try { return JSON.parse(v); } catch(e) { return null; } }\r\n        }).then(function(data) {\r\n            if (data) {\r\n                if (data.actionPrompts && typeof data.actionPrompts === \"object\") {\r\n                    Object.assign(ACTION_PROMPTS, data.actionPrompts);\r\n                    console.log(\"[CardGame ArtPipeline] Loaded external ACTION_PROMPTS:\", Object.keys(data.actionPrompts).length, \"entries\");\r\n                }\r\n                if (data.talkPrompts && typeof data.talkPrompts === \"object\") {\r\n                    Object.assign(TALK_PROMPTS, data.talkPrompts);\r\n                    console.log(\"[CardGame ArtPipeline] Loaded external TALK_PROMPTS:\", Object.keys(data.talkPrompts).length, \"entries\");\r\n                }\r\n            }\r\n        }).catch(function(e) {\r\n            console.warn(\"[CardGame ArtPipeline] Could not load art-prompts.json, using hardcoded fallbacks:\", e.message || e);\r\n        });\r\n    })();\r\n\r\n    function buildCardPrompt(card, theme, style, customSuffix) {\r\n        let suffix = customSuffix ||\r\n            (theme && theme.artStyle && theme.artStyle.promptSuffix) ||\r\n            \"high fantasy, vibrant colors, detailed illustration\";\r\n\r\n        // Character cards -- server builds its own prompt from person data\r\n        if (card.type === \"character\") {\r\n            let prompt = \"Portrait of \" + (card.name || \"a warrior\") + \", \" +\r\n                (card.race || \"human\").toLowerCase() + \" \" +\r\n                (card.alignment || \"\").toLowerCase() +\r\n                (card.age ? \", age \" + card.age : \"\") +\r\n                \", RPG character card art, facing viewer\";\r\n            return prompt + \", \" + suffix;\r\n        }\r\n\r\n        let sLabel = styleLabel(style);\r\n        let baseName = card.name || card.type;\r\n        let typeName = (card.fabric || card.material) ? (card.fabric || card.material) + \" \" + baseName : baseName;\r\n\r\n        // Action cards - use descriptive scene prompts\r\n        if (card.type === \"action\") {\r\n            let scene = ACTION_PROMPTS[card.name] || \"a dramatic action scene depicting \" + baseName.toLowerCase();\r\n            return \"Close-up \" + sLabel + \" of ((\" + scene + \")), \" + suffix;\r\n        }\r\n\r\n        // Talk cards - use conversation/speech prompts\r\n        if (card.type === \"talk\") {\r\n            let scene = TALK_PROMPTS[card.name] || \"two people engaged in \" + baseName.toLowerCase();\r\n            return \"Close-up \" + sLabel + \" of ((\" + scene + \")), \" + suffix;\r\n        }\r\n\r\n        // Skill cards - mystical glyph/ability representation\r\n        if (card.type === \"skill\") {\r\n            return \"Close-up \" + sLabel + \" of ((mystical glowing glyph representing \" + baseName.toLowerCase() + \" ability)), ornate magical symbol, \" + suffix;\r\n        }\r\n\r\n        // Item cards - show the item itself\r\n        if (card.type === \"item\") {\r\n            if (card.subtype === \"weapon\") {\r\n                return \"Close-up \" + sLabel + \" of ((\" + typeName + \")), detailed weapon, \" + suffix;\r\n            } else if (card.subtype === \"armor\") {\r\n                return \"Close-up \" + sLabel + \" of ((\" + typeName + \")), detailed armor piece, \" + suffix;\r\n            } else if (card.subtype === \"consumable\") {\r\n                return \"Close-up \" + sLabel + \" of ((\" + typeName + \")), magical potion or item on a table, \" + suffix;\r\n            } else if (card.subtype === \"material\") {\r\n                return \"Close-up \" + sLabel + \" of ((raw \" + typeName + \")), crafting material, \" + suffix;\r\n            }\r\n            return \"Close-up \" + sLabel + \" of ((\" + typeName + \")), detailed item, \" + suffix;\r\n        }\r\n\r\n        // Default fallback for any other card type\r\n        return \"Close-up \" + sLabel + \" of ((\" + typeName + \")), \" + suffix;\r\n    }\r\n\r\n    //  Image Generation Queue State \r\n    let artQueue = [];          // { card, cardIndex, status, result, error }\r\n    let artProcessing = false;\r\n    let artCompleted = 0;\r\n    let artTotal = 0;\r\n    let artPaused = false;\r\n    let artDir = null;          // cached ~/CardGame/Art/{themeId} group\r\n    let backgroundImageId = null;   // objectId of generated background (used as img2img basis)\r\n    let backgroundThumbUrl = null;  // thumbnail URL of background\r\n    let backgroundPrompt = null;    // prompt used for the background (used as imageSetting for character cards)\r\n    let backgroundGenerating = false;\r\n    let tabletopImageId = null;     // objectId of tabletop surface image\r\n    let tabletopThumbUrl = null;    // thumbnail URL of tabletop\r\n    let tabletopGenerating = false;\r\n    let flippedCards = {};          // { cardIndex: true } for character cards showing back\r\n    let cardFrontImageUrl = null;   // background image for card faces\r\n    let cardBackImageUrl = null;    // background image for card backs\r\n    let cardFrontGenerating = false; // status for card front template generation\r\n    let cardBackGenerating = false;  // status for card back template generation\r\n\r\n    //  Image Sequence State \r\n    let sequenceCardId = null;   // sourceId of card currently sequencing\r\n    let sequenceProgress = \"\";\r\n\r\n    //  SD Config Overrides \r\n    // Each override tab is a proper olio.sd.config instance with model defaults,\r\n    // rendered via the standard form system (am7model.prepareInstance + forms.sdConfigOverrides).\r\n    // Card-type tabs inherit from _default -- only fields the user explicitly\r\n    // changed (different from _default) are applied as type-specific overrides.\r\n\r\n    function newSdOverride() {\r\n        return am7model.newPrimitive(\"olio.sd.config\");\r\n    }\r\n    function defaultSdOverrides() {\r\n        // Only _default is pre-populated; other tabs lazily inherit from _default\r\n        // when first visited (see getSdOverrideInst)\r\n        return { _default: newSdOverride() };\r\n    }\r\n    let sdOverrides = defaultSdOverrides();\r\n    let sdConfigExpanded = false;\r\n    let sdConfigTab = \"_default\";\r\n\r\n    //  Per-deck Game Config (LLM, Voice) \r\n    let gameConfigExpanded = false;\r\n    let voiceProfiles = [];       // Cached identity.voice records\r\n    let voiceProfilesLoaded = false;\r\n\r\n    async function loadVoiceProfiles() {\r\n        if (voiceProfilesLoaded) return voiceProfiles;\r\n        try {\r\n            let q = am7view.viewQuery(am7model.newInstance(\"identity.voice\"));\r\n            let qr = await page.search(q);\r\n            voiceProfiles = qr?.results || [];\r\n            voiceProfilesLoaded = true;\r\n            console.log(\"[CardGame ArtPipeline] Voice profiles loaded:\", voiceProfiles.length);\r\n            m.redraw();\r\n        } catch (e) {\r\n            console.warn(\"[CardGame ArtPipeline] Failed to load voice profiles:\", e);\r\n            voiceProfiles = [];\r\n        }\r\n        return voiceProfiles;\r\n    }\r\n\r\n    function getDeckGameConfig(deck) {\r\n        if (!deck) return {};\r\n        if (!deck.gameConfig) deck.gameConfig = {};\r\n        return deck.gameConfig;\r\n    }\r\n\r\n    // Return only fields where the card-type override differs from _default.\r\n    // This prevents card-type model defaults from overwriting _default settings.\r\n    function getCardTypeDelta(key) {\r\n        let ov = sdOverrides[key];\r\n        let def = sdOverrides._default;\r\n        if (!ov || !def || key === \"_default\") return ov;\r\n        let delta = {};\r\n        let hasChanges = false;\r\n        for (let k in ov) {\r\n            if (k === am7model.jsonModelKey) continue;\r\n            if (ov[k] !== def[k]) {\r\n                delta[k] = ov[k];\r\n                hasChanges = true;\r\n            }\r\n        }\r\n        return hasChanges ? delta : null;\r\n    }\r\n\r\n    // Prepared instances for form rendering -- keyed by tab name\r\n    let sdOverrideInsts = {};\r\n    let sdOverrideViews = {};\r\n    function getSdOverrideInst(key) {\r\n        if (!sdOverrideInsts[key]) {\r\n            let entity = sdOverrides[key];\r\n            // For non-default tabs without saved data, start from current _default\r\n            if (!entity && key !== \"_default\" && sdOverrides._default) {\r\n                entity = JSON.parse(JSON.stringify(sdOverrides._default));\r\n                entity[am7model.jsonModelKey] = \"olio.sd.config\";\r\n                sdOverrides[key] = entity;\r\n            }\r\n            if (!entity || !entity[am7model.jsonModelKey]) {\r\n                entity = am7model.prepareEntity(entity || {}, \"olio.sd.config\");\r\n                sdOverrides[key] = entity;\r\n            }\r\n            sdOverrideInsts[key] = am7model.prepareInstance(entity, am7model.forms.sdConfigOverrides);\r\n            sdOverrideViews[key] = page.views.object();\r\n        }\r\n        return sdOverrideInsts[key];\r\n    }\r\n    function resetSdOverrideInsts() {\r\n        sdOverrideInsts = {};\r\n        sdOverrideViews = {};\r\n    }\r\n\r\n    //  Art Directory & Deck Helpers \r\n\r\n    function currentDeckSafeName() {\r\n        let viewingDeck = getViewingDeck();\r\n        return viewingDeck && viewingDeck.deckName\r\n            ? viewingDeck.deckName.replace(/[^a-zA-Z0-9_\\-]/g, \"_\")\r\n            : null;\r\n    }\r\n\r\n    async function ensureArtDir(themeId) {\r\n        if (artDir) return artDir;\r\n        let deckKey = currentDeckSafeName();\r\n        let subdir = deckKey || (themeId || \"high-fantasy\");\r\n        let path = ART_BASE_PATH + \"/\" + subdir;\r\n        artDir = await page.makePath(\"auth.group\", \"DATA\", path);\r\n        return artDir;\r\n    }\r\n\r\n    //  Background Generation \r\n    // Generate a background image to use as img2img basis for card art\r\n    async function generateBackground(theme) {\r\n        let am7sd = window.am7sd;\r\n        let activeTheme = getActiveTheme();\r\n        let t = theme || activeTheme;\r\n        let bgOv = sdOverrides.background;\r\n        // Use the background override prompt if set, otherwise fall back to theme or default\r\n        let bgPrompt = (bgOv && bgOv.description) || (t.artStyle && t.artStyle.backgroundPrompt) || \"Fantasy landscape, epic panoramic view, vibrant colors\";\r\n\r\n        backgroundGenerating = true;\r\n        m.redraw();\r\n\r\n        try {\r\n            let dir = await ensureArtDir(t.themeId);\r\n            if (!dir) throw new Error(\"Could not create art directory\");\r\n\r\n            let entity = await am7sd.buildEntity({\r\n                description: bgPrompt,\r\n                bodyStyle: \"landscape\",\r\n                seed: -1,\r\n                groupPath: dir.path,\r\n                imageName: \"background-\" + t.themeId + \"-\" + Date.now() + \".png\"\r\n            });\r\n            am7sd.applyOverrides(entity, sdOverrides._default);\r\n            am7sd.applyOverrides(entity, getCardTypeDelta(\"background\"));\r\n            am7sd.fillStyleDefaults(entity);\r\n\r\n            let result = await m.request({\r\n                method: \"POST\",\r\n                url: g_application_path + \"/rest/olio/generateArt\",\r\n                body: entity,\r\n                withCredentials: true,\r\n                extract: function(xhr) {\r\n                    let body = null;\r\n                    try { body = JSON.parse(xhr.responseText); } catch(e) {}\r\n                    if (xhr.status !== 200) {\r\n                        throw new Error((body && body.error) || \"HTTP \" + xhr.status);\r\n                    }\r\n                    return body;\r\n                }\r\n            });\r\n\r\n            if (!result || !result.objectId) throw new Error(\"Background generation returned no result\");\r\n\r\n            backgroundImageId = result.objectId;\r\n            backgroundPrompt = bgPrompt;\r\n            backgroundThumbUrl = g_application_path + \"/thumbnail/\" +\r\n                am7client.dotPath(am7client.currentOrganization) +\r\n                \"/data.data\" + (result.groupPath || dir.path) + \"/\" + result.name + \"/256x256\";\r\n\r\n            // Save background reference on the deck\r\n            let viewingDeck = getViewingDeck();\r\n            let deckStorage = getDeckStorage();\r\n            if (viewingDeck) {\r\n                viewingDeck.backgroundImageId = backgroundImageId;\r\n                viewingDeck.backgroundPrompt = backgroundPrompt;\r\n                viewingDeck.backgroundThumbUrl = backgroundThumbUrl;\r\n                let safeName = (viewingDeck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n                if (deckStorage) await deckStorage.save(safeName, viewingDeck);\r\n            }\r\n\r\n            page.toast(\"success\", \"Background generated\");\r\n            console.log(\"[CardGame ArtPipeline] Background generated:\", backgroundImageId);\r\n        } catch (e) {\r\n            console.error(\"[CardGame ArtPipeline] Background generation failed:\", e);\r\n            page.toast(\"error\", \"Background failed: \" + (e.message || \"Unknown error\"));\r\n        }\r\n\r\n        backgroundGenerating = false;\r\n        m.redraw();\r\n    }\r\n\r\n    //  Tabletop Generation \r\n    // Generate a tabletop surface image for the game play area\r\n    async function generateTabletop(theme) {\r\n        let am7sd = window.am7sd;\r\n        let activeTheme = getActiveTheme();\r\n        let t = theme || activeTheme;\r\n        let ttOv = sdOverrides.tabletop;\r\n        // Use tabletop override prompt if set, otherwise use theme setting or default\r\n        let ttPrompt = (ttOv && ttOv.description) ||\r\n            (t.artStyle && t.artStyle.tabletopPrompt) ||\r\n            \"Wooden table surface with subtle texture, warm lighting, top-down view, game table\";\r\n\r\n        tabletopGenerating = true;\r\n        m.redraw();\r\n\r\n        try {\r\n            let dir = await ensureArtDir(t.themeId);\r\n            if (!dir) throw new Error(\"Could not create art directory\");\r\n\r\n            let entity = await am7sd.buildEntity({\r\n                description: ttPrompt,\r\n                bodyStyle: \"landscape\",\r\n                seed: -1,\r\n                groupPath: dir.path,\r\n                imageName: \"tabletop-\" + t.themeId + \"-\" + Date.now() + \".png\"\r\n            });\r\n            am7sd.applyOverrides(entity, sdOverrides._default);\r\n            am7sd.applyOverrides(entity, getCardTypeDelta(\"tabletop\"));\r\n            am7sd.fillStyleDefaults(entity);\r\n\r\n            let result = await m.request({\r\n                method: \"POST\",\r\n                url: g_application_path + \"/rest/olio/generateArt\",\r\n                body: entity,\r\n                withCredentials: true,\r\n                extract: function(xhr) {\r\n                    let body = null;\r\n                    try { body = JSON.parse(xhr.responseText); } catch(e) {}\r\n                    if (xhr.status !== 200) {\r\n                        throw new Error((body && body.error) || \"HTTP \" + xhr.status);\r\n                    }\r\n                    return body;\r\n                }\r\n            });\r\n\r\n            if (!result || !result.objectId) throw new Error(\"Tabletop generation returned no result\");\r\n\r\n            tabletopImageId = result.objectId;\r\n            tabletopThumbUrl = g_application_path + \"/thumbnail/\" +\r\n                am7client.dotPath(am7client.currentOrganization) +\r\n                \"/data.data\" + (result.groupPath || dir.path) + \"/\" + result.name + \"/256x256\";\r\n\r\n            // Save tabletop reference on the deck\r\n            let viewingDeck = getViewingDeck();\r\n            let deckStorage = getDeckStorage();\r\n            if (viewingDeck) {\r\n                viewingDeck.tabletopImageId = tabletopImageId;\r\n                viewingDeck.tabletopThumbUrl = tabletopThumbUrl;\r\n                let safeName = (viewingDeck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n                if (deckStorage) await deckStorage.save(safeName, viewingDeck);\r\n            }\r\n\r\n            page.toast(\"success\", \"Tabletop generated\");\r\n            console.log(\"[CardGame ArtPipeline] Tabletop generated:\", tabletopImageId);\r\n        } catch (e) {\r\n            console.error(\"[CardGame ArtPipeline] Tabletop generation failed:\", e);\r\n            page.toast(\"error\", \"Tabletop failed: \" + (e.message || \"Unknown error\"));\r\n        }\r\n\r\n        tabletopGenerating = false;\r\n        m.redraw();\r\n    }\r\n\r\n    //  SD Entity Builder \r\n    // Build a SD config entity for a card, merging theme per-type overrides.\r\n    // Uses am7sd to fetch the random template (with full style fields intact)\r\n    // and apply overrides without destroying style-specific prompt composition.\r\n    async function buildSdEntity(card, theme) {\r\n        let am7sd = window.am7sd;\r\n        let activeTheme = getActiveTheme();\r\n        let entity = await am7sd.buildEntity();\r\n        let t = theme || activeTheme;\r\n\r\n        // Apply theme sdConfig defaults, then type-specific overrides\r\n        let artCfg = t.artStyle && t.artStyle.sdConfig;\r\n        if (artCfg) {\r\n            if (artCfg[\"default\"]) Object.assign(entity, artCfg[\"default\"]);\r\n            if (artCfg[card.type])  Object.assign(entity, artCfg[card.type]);\r\n        }\r\n\r\n        entity.seed = -1;\r\n\r\n        // Apply user SD overrides first so style is final before building prompt\r\n        am7sd.applyOverrides(entity, sdOverrides._default);\r\n        am7sd.applyOverrides(entity, getCardTypeDelta(card.type));\r\n        am7sd.fillStyleDefaults(entity);\r\n\r\n        // Tab-specific or default prompt used as the \"in ___\" suffix\r\n        let typeOv = sdOverrides[card.type];\r\n        let defOv = sdOverrides._default;\r\n        let customSuffix = (typeOv && typeOv.description) || (defOv && defOv.description) || null;\r\n        entity.description = buildCardPrompt(card, t, entity.style, customSuffix);\r\n\r\n        // For character cards, the server builds its own prompt from person data\r\n        // and uses imageSetting for the scene/location.\r\n        // Default to the theme's background prompt so characters match the setting.\r\n        if (card.type === \"character\") {\r\n            let setting = backgroundPrompt ||\r\n                          (t.artStyle && t.artStyle.backgroundPrompt);\r\n            if (setting) {\r\n                entity.imageSetting = setting;\r\n            }\r\n        }\r\n\r\n        // Attach background reference image if available\r\n        if (backgroundImageId) {\r\n            entity.referenceImageId = backgroundImageId;\r\n            if (!entity.denoisingStrength || entity.denoisingStrength >= 1.0) {\r\n                entity.denoisingStrength = 0.7;\r\n            }\r\n        }\r\n\r\n        console.log(\"[CardGame ArtPipeline] buildSdEntity:\", card.type, card.name,\r\n            \"style:\", entity.style, \"imageSetting:\", entity.imageSetting,\r\n            \"cfg:\", entity.cfg, \"denoise:\", entity.denoisingStrength,\r\n            \"model:\", entity.model, \"ref:\", entity.referenceImageId || \"none\",\r\n            \"w:\", entity.width, \"h:\", entity.height);\r\n\r\n        return entity;\r\n    }\r\n\r\n    //  Single Card Art Generation \r\n    // Generate art for a single card -- character portraits use the reimage endpoint\r\n    async function generateCardArt(card, theme) {\r\n        let am7sd = window.am7sd;\r\n        let activeTheme = getActiveTheme();\r\n\r\n        // Character portraits: use the charPerson/reimage endpoint with SD config\r\n        if (card.type === \"character\" && card.sourceId) {\r\n            let sdEntity = await buildSdEntity(card, theme);\r\n            // POST with sdConfig so the server can apply referenceImageId, model, style, etc.\r\n            let result = await m.request({\r\n                method: \"POST\",\r\n                url: g_application_path + \"/rest/olio/olio.charPerson/\" + card.sourceId + \"/reimage\",\r\n                body: sdEntity,\r\n                withCredentials: true\r\n            });\r\n            // Build URL from result image using groupPath + name (required by thumbnail servlet)\r\n            let thumbUrl = null;\r\n            console.log(\"[CardGame ArtPipeline] Reimage result:\", JSON.stringify({\r\n                objectId: result?.objectId, groupPath: result?.groupPath, name: result?.name\r\n            }));\r\n            if (result && result.groupPath && result.name) {\r\n                let orgPath = am7client.dotPath(am7client.currentOrganization);\r\n                thumbUrl = g_application_path + \"/thumbnail/\" + orgPath +\r\n                    \"/data.data\" + result.groupPath + \"/\" + result.name + \"/256x256?t=\" + Date.now();\r\n                console.log(\"[CardGame ArtPipeline] Built thumbUrl:\", thumbUrl);\r\n            } else {\r\n                console.warn(\"[CardGame ArtPipeline] Reimage result missing groupPath or name, cannot build URL\");\r\n            }\r\n            return { reimaged: true, sourceId: card.sourceId, thumbUrl: thumbUrl, objectId: result?.objectId, groupPath: result?.groupPath, name: result?.name };\r\n        }\r\n\r\n        // All other card types: use the generateArt endpoint (txt2img from prompt)\r\n        let dir = await ensureArtDir((theme || activeTheme).themeId);\r\n        if (!dir) throw new Error(\"Could not create art directory\");\r\n\r\n        let sdEntity = await buildSdEntity(card, theme);\r\n        // Add groupPath and imageName for the generateArt endpoint\r\n        sdEntity.groupPath = dir.path;\r\n        sdEntity.imageName = (card.name || \"card\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\") + \"-\" + Date.now() + \".png\";\r\n\r\n        let result = await m.request({\r\n            method: \"POST\",\r\n            url: g_application_path + \"/rest/olio/generateArt\",\r\n            body: sdEntity,\r\n            withCredentials: true,\r\n            extract: function(xhr) {\r\n                let body = null;\r\n                try { body = JSON.parse(xhr.responseText); } catch(e) {}\r\n                if (xhr.status !== 200) {\r\n                    throw new Error((body && body.error) || \"HTTP \" + xhr.status);\r\n                }\r\n                return body;\r\n            }\r\n        });\r\n\r\n        console.log(\"[CardGame ArtPipeline] generateArt response:\", JSON.stringify({\r\n            objectId: result && result.objectId, name: result && result.name,\r\n            groupPath: result && result.groupPath, groupId: result && result.groupId\r\n        }));\r\n\r\n        if (!result || !result.objectId) throw new Error(\"generateArt returned no result\");\r\n\r\n        // Move result into art directory if server put it elsewhere\r\n        if (result.groupId && dir.id && result.groupId !== dir.id) {\r\n            await page.moveObject(result, dir);\r\n            result.groupId = dir.id;\r\n            result.groupPath = dir.path;\r\n        }\r\n\r\n        // Build thumbnail URL for card use -- use dir.path as fallback\r\n        let gp = result.groupPath || dir.path;\r\n        let rname = result.name || sdEntity.imageName;\r\n        let thumbUrl = g_application_path + \"/thumbnail/\" +\r\n            am7client.dotPath(am7client.currentOrganization) +\r\n            \"/data.data\" + gp + \"/\" + rname + \"/256x256?t=\" + Date.now();\r\n\r\n        console.log(\"[CardGame ArtPipeline] Card art URL:\", thumbUrl);\r\n        return { objectId: result.objectId, name: rname, groupPath: gp, thumbUrl: thumbUrl };\r\n    }\r\n\r\n    //  Template Art Generation \r\n    // Generate template art for card front/back backgrounds\r\n    async function generateTemplateArt(side) {\r\n        let am7sd = window.am7sd;\r\n        let activeTheme = getActiveTheme();\r\n        let theme = activeTheme;\r\n        let configKey = side === \"front\" ? \"cardFront\" : \"cardBack\";\r\n        let ov = sdOverrides[configKey];\r\n        let defOv = sdOverrides._default;\r\n\r\n        // Use tab-specific prompt, then _default prompt, then hardcoded fallback\r\n        let prompt;\r\n        if (ov && ov.description) {\r\n            prompt = ov.description;\r\n        } else if (defOv && defOv.description) {\r\n            prompt = defOv.description;\r\n        } else {\r\n            let suffix = (theme.artStyle && theme.artStyle.promptSuffix) || \"fantasy illustration\";\r\n            prompt = side === \"front\"\r\n                ? \"ornate card face design, decorative parchment border, golden filigree frame, card game template, \" + suffix\r\n                : \"ornate card back design, intricate repeating pattern, card game template, \" + suffix;\r\n        }\r\n\r\n        // Set generating status for this side\r\n        if (side === \"front\") cardFrontGenerating = true;\r\n        else cardBackGenerating = true;\r\n        m.redraw();\r\n\r\n        try {\r\n            let dir = await ensureArtDir(theme.themeId);\r\n            if (!dir) throw new Error(\"Could not create art directory\");\r\n            let sdEntity = await am7sd.buildEntity({\r\n                description: prompt,\r\n                seed: -1,\r\n                imageName: \"card-\" + side + \"-\" + (theme.themeId || \"default\") + \"-\" + Date.now() + \".png\",\r\n                groupPath: dir.path\r\n            });\r\n            am7sd.applyOverrides(sdEntity, sdOverrides._default);\r\n            am7sd.applyOverrides(sdEntity, getCardTypeDelta(configKey));\r\n            am7sd.fillStyleDefaults(sdEntity);\r\n            if (backgroundImageId) {\r\n                sdEntity.referenceImageId = backgroundImageId;\r\n                if (!sdEntity.denoisingStrength || sdEntity.denoisingStrength >= 1.0) sdEntity.denoisingStrength = 0.7;\r\n            }\r\n\r\n            console.log(\"[CardGame ArtPipeline] generateTemplateArt:\", side, configKey, sdEntity);\r\n\r\n            let result = await m.request({\r\n                method: \"POST\",\r\n                url: g_application_path + \"/rest/olio/generateArt\",\r\n                body: sdEntity,\r\n                withCredentials: true,\r\n                extract: function(xhr) {\r\n                    let body = null;\r\n                    try { body = JSON.parse(xhr.responseText); } catch(e) {}\r\n                    if (xhr.status !== 200) {\r\n                        throw new Error((body && body.error) || \"HTTP \" + xhr.status);\r\n                    }\r\n                    return body;\r\n                }\r\n            });\r\n\r\n            if (!result || !result.objectId) throw new Error(\"Template art returned no result\");\r\n\r\n            let gp = result.groupPath || dir.path;\r\n            let rname = result.name || sdEntity.imageName;\r\n            let thumbUrl = g_application_path + \"/thumbnail/\" +\r\n                am7client.dotPath(am7client.currentOrganization) +\r\n                \"/data.data\" + gp + \"/\" + rname + \"/512x768?t=\" + Date.now();\r\n            let viewingDeck = getViewingDeck();\r\n            let deckStorage = getDeckStorage();\r\n            if (side === \"front\") {\r\n                cardFrontImageUrl = thumbUrl;\r\n                if (viewingDeck) viewingDeck.cardFrontImageUrl = thumbUrl;\r\n            } else {\r\n                cardBackImageUrl = thumbUrl;\r\n                if (viewingDeck) viewingDeck.cardBackImageUrl = thumbUrl;\r\n            }\r\n            // Auto-save deck with new template URLs\r\n            if (viewingDeck && deckStorage) {\r\n                let safeName = (viewingDeck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n                await deckStorage.save(safeName, viewingDeck);\r\n            }\r\n            page.toast(\"success\", \"Card \" + side + \" art generated\");\r\n        } catch (e) {\r\n            console.error(\"[CardGame ArtPipeline] Template art failed:\", e);\r\n            page.toast(\"error\", \"Card \" + side + \" art failed: \" + (e.message || \"Unknown error\"));\r\n        }\r\n\r\n        // Clear generating status\r\n        if (side === \"front\") cardFrontGenerating = false;\r\n        else cardBackGenerating = false;\r\n        m.redraw();\r\n    }\r\n\r\n    //  Art Queue Processing \r\n    // Process the art queue one item at a time\r\n    async function processArtQueue() {\r\n        let activeTheme = getActiveTheme();\r\n        let viewingDeck = getViewingDeck();\r\n        let deckStorage = getDeckStorage();\r\n        let gameState = getGameState();\r\n\r\n        if (artProcessing || artPaused) return;\r\n        let next = artQueue.find(j => j.status === \"pending\");\r\n        if (!next) {\r\n            artProcessing = false;\r\n            if (artCompleted > 0) {\r\n                page.toast(\"success\", \"Art generation complete: \" + artCompleted + \" of \" + artTotal + \" images\");\r\n                // Save deck with updated image URLs\r\n                if (viewingDeck && deckStorage) {\r\n                    let safeName = (viewingDeck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n                    await deckStorage.save(safeName, viewingDeck);\r\n                    console.log(\"[CardGame ArtPipeline] Deck saved with updated art URLs\");\r\n                }\r\n            }\r\n            m.redraw();\r\n            return;\r\n        }\r\n\r\n        artProcessing = true;\r\n        next.status = \"processing\";\r\n        m.redraw();\r\n\r\n        try {\r\n            let result = await generateCardArt(next.card, activeTheme);\r\n            next.status = \"complete\";\r\n            next.result = result;\r\n            artCompleted++;\r\n\r\n            // Update the card in the deck with the image URL\r\n            if (viewingDeck && viewingDeck.cards && viewingDeck.cards[next.cardIndex]) {\r\n                let deckCard = viewingDeck.cards[next.cardIndex];\r\n                if (result.thumbUrl) {\r\n                    // For character cards, set portraitUrl; for others, set imageUrl\r\n                    if (result.reimaged) {\r\n                        deckCard.portraitUrl = result.thumbUrl;\r\n                        deckCard.artObjectId = result.objectId;\r\n                    } else {\r\n                        deckCard.imageUrl = result.thumbUrl;\r\n                        deckCard.artObjectId = result.objectId;\r\n                    }\r\n                } else if (result.reimaged && deckCard.sourceId) {\r\n                    // Fallback: re-fetch the charPerson to get the updated portrait\r\n                    if (CardGame.Characters && CardGame.Characters.refreshCharacterCard) {\r\n                        await CardGame.Characters.refreshCharacterCard(deckCard);\r\n                    }\r\n                }\r\n\r\n                // Propagate art to duplicate cards in deck\r\n                if (next.duplicateIndices && next.duplicateIndices.length > 0 && result.thumbUrl) {\r\n                    next.duplicateIndices.forEach(dupeIdx => {\r\n                        let dupeCard = viewingDeck.cards[dupeIdx];\r\n                        if (dupeCard) {\r\n                            if (result.reimaged) {\r\n                                dupeCard.portraitUrl = result.thumbUrl;\r\n                            } else {\r\n                                dupeCard.imageUrl = result.thumbUrl;\r\n                            }\r\n                            dupeCard.artObjectId = result.objectId;\r\n                        }\r\n                    });\r\n                    console.log(\"[CardGame ArtPipeline] Shared art with \" + next.duplicateIndices.length + \" duplicate(s) of \" + deckCard.name);\r\n                }\r\n\r\n                // Propagate art to cards in active game state (hand, drawPile, discardPile)\r\n                if (gameState && result.thumbUrl) {\r\n                    propagateArtToGameState(deckCard.name, deckCard.type, result.thumbUrl, result.reimaged);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"[CardGame ArtPipeline] Art generation failed for:\", next.card.name, e);\r\n            next.status = \"failed\";\r\n            next.error = e.message || \"Unknown error\";\r\n        }\r\n\r\n        artProcessing = false;\r\n        m.redraw();\r\n\r\n        // Process next in queue\r\n        processArtQueue();\r\n    }\r\n\r\n    //  Game State Art Propagation \r\n    // Propagate generated art to cards in the active game state\r\n    function propagateArtToGameState(cardName, cardType, thumbUrl, isPortrait) {\r\n        let gameState = getGameState();\r\n        if (!gameState) return;\r\n\r\n        let updated = 0;\r\n        const updateCard = (card) => {\r\n            if (card && card.name === cardName && card.type === cardType) {\r\n                if (isPortrait) {\r\n                    card.portraitUrl = thumbUrl;\r\n                } else {\r\n                    card.imageUrl = thumbUrl;\r\n                }\r\n                updated++;\r\n            }\r\n        };\r\n\r\n        // Update player cards\r\n        if (gameState.player) {\r\n            (gameState.player.hand || []).forEach(updateCard);\r\n            (gameState.player.drawPile || []).forEach(updateCard);\r\n            (gameState.player.discardPile || []).forEach(updateCard);\r\n            (gameState.player.cardStack || []).forEach(updateCard);\r\n        }\r\n\r\n        // Update opponent cards\r\n        if (gameState.opponent) {\r\n            (gameState.opponent.hand || []).forEach(updateCard);\r\n            (gameState.opponent.drawPile || []).forEach(updateCard);\r\n            (gameState.opponent.discardPile || []).forEach(updateCard);\r\n            (gameState.opponent.cardStack || []).forEach(updateCard);\r\n        }\r\n\r\n        // Update action bar cards\r\n        if (gameState.actionBar?.positions) {\r\n            gameState.actionBar.positions.forEach(pos => {\r\n                if (pos.stack?.coreCard) updateCard(pos.stack.coreCard);\r\n                (pos.stack?.modifiers || []).forEach(updateCard);\r\n            });\r\n        }\r\n\r\n        // Update pot\r\n        (gameState.pot || []).forEach(updateCard);\r\n\r\n        if (updated > 0) {\r\n            console.log(\"[CardGame ArtPipeline] Propagated art to\", updated, \"card(s) in game state:\", cardName);\r\n        }\r\n    }\r\n\r\n    //  Card Deduplication \r\n    // Build a unique signature for a card to detect duplicates\r\n    function cardSignature(card) {\r\n        if (card.type === \"character\") {\r\n            // Characters are unique by sourceId or _sourceChar._tempId\r\n            return \"char:\" + (card.sourceId || (card._sourceChar && card._sourceChar._tempId) || card.name);\r\n        }\r\n        // Items/powers: type + name + material/fabric\r\n        return (card.type || \"\") + \":\" + (card.name || \"\") + \":\" + (card.fabric || card.material || \"\");\r\n    }\r\n\r\n    //  Deck Art Queue \r\n    // Queue art generation for all cards in a deck (including front/back templates)\r\n    async function queueDeckArt(deck) {\r\n        let activeTheme = getActiveTheme();\r\n\r\n        if (!deck || !deck.cards) return;\r\n        artQueue = [];\r\n        artCompleted = 0;\r\n        artTotal = 0;\r\n        artPaused = false;\r\n        artDir = null;\r\n\r\n        // First, generate missing templates, background, and tabletop\r\n        let needFront = !deck.cardFrontImageUrl && !cardFrontImageUrl;\r\n        let needBack = !deck.cardBackImageUrl && !cardBackImageUrl;\r\n        let needBg = !deck.backgroundImageId && !backgroundImageId;\r\n        let needTabletop = !deck.tabletopImageId && !tabletopImageId;\r\n        let preGenCount = (needFront ? 1 : 0) + (needBack ? 1 : 0) + (needBg ? 1 : 0) + (needTabletop ? 1 : 0);\r\n\r\n        if (preGenCount > 0) {\r\n            console.log(\"[CardGame ArtPipeline] Generating \" + preGenCount + \" missing template/environment images first...\");\r\n            if (needFront) {\r\n                artTotal++; m.redraw();\r\n                console.log(\"[CardGame ArtPipeline] Generating card front template...\");\r\n                await generateTemplateArt(\"front\");\r\n                artCompleted++; m.redraw();\r\n            }\r\n            if (needBack) {\r\n                artTotal++; m.redraw();\r\n                console.log(\"[CardGame ArtPipeline] Generating card back template...\");\r\n                await generateTemplateArt(\"back\");\r\n                artCompleted++; m.redraw();\r\n            }\r\n            if (needBg) {\r\n                artTotal++; m.redraw();\r\n                console.log(\"[CardGame ArtPipeline] Generating background...\");\r\n                await generateBackground(activeTheme);\r\n                artCompleted++; m.redraw();\r\n            }\r\n            if (needTabletop) {\r\n                artTotal++; m.redraw();\r\n                console.log(\"[CardGame ArtPipeline] Generating tabletop...\");\r\n                await generateTabletop(activeTheme);\r\n                artCompleted++; m.redraw();\r\n            }\r\n        }\r\n\r\n        // Track unique cards and their duplicates\r\n        let uniqueCards = {};  // signature -> { cardIndex, duplicateIndices: [] }\r\n\r\n        deck.cards.forEach((card, i) => {\r\n            // Skip cards that already have art\r\n            if (card.type === \"character\" && card.portraitUrl) return;\r\n            if (card.type !== \"character\" && card.imageUrl) return;\r\n\r\n            let sig = cardSignature(card);\r\n            if (uniqueCards[sig]) {\r\n                // This is a duplicate - will share art with the first one\r\n                uniqueCards[sig].duplicateIndices.push(i);\r\n            } else {\r\n                // First occurrence - queue for generation\r\n                uniqueCards[sig] = { cardIndex: i, duplicateIndices: [] };\r\n                artQueue.push({ card: card, cardIndex: i, status: \"pending\", result: null, error: null, duplicateIndices: [] });\r\n                artTotal++;\r\n            }\r\n        });\r\n\r\n        // Attach duplicate indices to queued items\r\n        artQueue.forEach(job => {\r\n            let sig = cardSignature(job.card);\r\n            if (uniqueCards[sig]) {\r\n                job.duplicateIndices = uniqueCards[sig].duplicateIndices;\r\n            }\r\n        });\r\n\r\n        let dupeCount = Object.values(uniqueCards).reduce((sum, u) => sum + u.duplicateIndices.length, 0);\r\n        if (dupeCount > 0) {\r\n            console.log(\"[CardGame ArtPipeline] Found \" + dupeCount + \" duplicate cards that will share art\");\r\n        }\r\n\r\n        if (artTotal === 0) {\r\n            page.toast(\"info\", \"All cards already have art\");\r\n            return;\r\n        }\r\n\r\n        console.log(\"[CardGame ArtPipeline] Queued \" + artTotal + \" unique cards for art generation\");\r\n        processArtQueue();\r\n    }\r\n\r\n    //  Art Progress Save / Pause / Resume / Cancel \r\n    async function saveArtProgress() {\r\n        let viewingDeck = getViewingDeck();\r\n        let deckStorage = getDeckStorage();\r\n        if (viewingDeck && deckStorage && artCompleted > 0) {\r\n            let safeName = (viewingDeck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n            await deckStorage.save(safeName, viewingDeck);\r\n            console.log(\"[CardGame ArtPipeline] Deck saved with \" + artCompleted + \" completed art images\");\r\n        }\r\n    }\r\n\r\n    async function pauseArtQueue() {\r\n        artPaused = true;\r\n        await saveArtProgress();\r\n        page.toast(\"info\", \"Art generation paused. Progress saved (\" + artCompleted + \" of \" + artTotal + \")\");\r\n        m.redraw();\r\n    }\r\n\r\n    function resumeArtQueue() {\r\n        artPaused = false;\r\n        m.redraw();\r\n        processArtQueue();\r\n    }\r\n\r\n    async function cancelArtQueue() {\r\n        artQueue.forEach(j => { if (j.status === \"pending\") j.status = \"cancelled\"; });\r\n        artPaused = false;\r\n        artProcessing = false;\r\n        await saveArtProgress();\r\n        if (artCompleted > 0) {\r\n            page.toast(\"info\", \"Art generation cancelled. Progress saved (\" + artCompleted + \" of \" + artTotal + \")\");\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    //  Image Sequence Generation (apparel dress-up progression) \r\n    async function generateImageSequence(card) {\r\n        let activeTheme = getActiveTheme();\r\n        let viewingDeck = getViewingDeck();\r\n        let deckStorage = getDeckStorage();\r\n\r\n        if (!card || sequenceCardId) return;\r\n        if (!card.sourceId && card._sourceChar) {\r\n            page.toast(\"info\", \"Save deck first to generate images for generated characters\");\r\n            return;\r\n        }\r\n        if (!card.sourceId) return;\r\n        sequenceCardId = card.sourceId;\r\n        sequenceProgress = \"Loading character...\";\r\n        page.toast(\"info\", \"Image Sequence: Loading character...\", -1);\r\n        m.redraw();\r\n\r\n        try {\r\n            // Load character to get store reference\r\n            am7client.clearCache(\"olio.charPerson\");\r\n            let char = await page.searchFirst(\"olio.charPerson\", undefined, undefined, card.sourceId);\r\n            if (!char || !char.store || !char.store.objectId) throw new Error(\"Could not load character store\");\r\n\r\n            // Use getFull on store to get apparel with proper inuse flags\r\n            await am7client.clearCache(\"olio.store\");\r\n            let sto = await am7client.getFull(\"olio.store\", char.store.objectId);\r\n            if (!sto || !sto.apparel || !sto.apparel.length) {\r\n                throw new Error(\"No apparel found in store\");\r\n            }\r\n\r\n            let activeApparel = sto.apparel.find(a => a.inuse) || sto.apparel[0];\r\n\r\n            // Use getFull on apparel to get wearables with proper inuse flags\r\n            await am7client.clearCache(\"olio.apparel\");\r\n            let fullApparel = await am7client.getFull(\"olio.apparel\", activeApparel.objectId);\r\n            if (!fullApparel || !fullApparel.wearables || !fullApparel.wearables.length) {\r\n                throw new Error(\"No wearables found in apparel\");\r\n            }\r\n            let wears = fullApparel.wearables;\r\n\r\n            // Get sorted unique wear levels\r\n            let lvls = [...new Set(wears.sort((a, b) => {\r\n                let aL = am7model.enums.wearLevelEnumType.findIndex(we => we == a.level.toUpperCase());\r\n                let bL = am7model.enums.wearLevelEnumType.findIndex(we => we == b.level.toUpperCase());\r\n                return aL < bL ? -1 : aL > bL ? 1 : 0;\r\n            }).map(w => w.level.toUpperCase()))];\r\n\r\n            if (!lvls.length) throw new Error(\"No wear levels found\");\r\n\r\n            // Dress down completely\r\n            sequenceProgress = \"Dressing down...\";\r\n            page.toast(\"info\", \"Image Sequence: Dressing down...\", -1);\r\n            m.redraw();\r\n            let dressedDown = true;\r\n            while (dressedDown === true) {\r\n                dressedDown = await am7olio.dressApparel(activeApparel, false);\r\n            }\r\n\r\n            // Update narrative to reflect fully undressed state\r\n            am7client.clearCache(\"olio.charPerson\");\r\n            await m.request({ method: 'GET', url: am7client.base() + \"/olio/olio.charPerson/\" + card.sourceId + \"/narrate\", withCredentials: true });\r\n\r\n            let images = [];\r\n            let totalImages = lvls.length + 1; // +1 for undressed\r\n            let baseSeed = -1;\r\n\r\n            // Build base SD entity for character reimage\r\n            let sdBase = await buildSdEntity(card, activeTheme);\r\n\r\n            // Generate first image fully undressed (NONE level)\r\n            sequenceProgress = \"Generating image 1 of \" + totalImages + \" (NONE)...\";\r\n            page.toast(\"info\", \"Image Sequence: Generating 1 of \" + totalImages + \" (NONE)...\", -1);\r\n            m.redraw();\r\n\r\n            let sdEntity = Object.assign({}, sdBase);\r\n            sdEntity.seed = baseSeed;\r\n\r\n            let x = await m.request({\r\n                method: \"POST\",\r\n                url: g_application_path + \"/rest/olio/olio.charPerson/\" + card.sourceId + \"/reimage\",\r\n                body: sdEntity,\r\n                withCredentials: true\r\n            });\r\n\r\n            if (x) {\r\n                let seedAttr = (x.attributes || []).filter(a => a.name == \"seed\");\r\n                if (seedAttr.length) baseSeed = seedAttr[0].value;\r\n                await am7client.patchAttribute(x, \"wearLevel\", \"NONE/0\");\r\n                images.push(x);\r\n            }\r\n\r\n            // Generate image at each wear level (dressing up progressively)\r\n            for (let i = 0; i < lvls.length; i++) {\r\n                await am7olio.dressApparel(activeApparel, true);\r\n\r\n                // Update narrative so reimage reflects the new clothing state\r\n                am7client.clearCache(\"olio.charPerson\");\r\n                await m.request({ method: 'GET', url: am7client.base() + \"/olio/olio.charPerson/\" + card.sourceId + \"/narrate\", withCredentials: true });\r\n\r\n                sequenceProgress = \"Generating image \" + (images.length + 1) + \" of \" + totalImages + \" (\" + lvls[i] + \")...\";\r\n                page.toast(\"info\", \"Image Sequence: Generating \" + (images.length + 1) + \" of \" + totalImages + \" (\" + lvls[i] + \")...\", -1);\r\n                m.redraw();\r\n\r\n                let useSeed = (parseInt(baseSeed) + images.length);\r\n                sdEntity = Object.assign({}, sdBase);\r\n                sdEntity.seed = useSeed;\r\n\r\n                let x = await m.request({\r\n                    method: \"POST\",\r\n                    url: g_application_path + \"/rest/olio/olio.charPerson/\" + card.sourceId + \"/reimage\",\r\n                    body: sdEntity,\r\n                    withCredentials: true\r\n                });\r\n\r\n                if (!x) {\r\n                    page.toast(\"error\", \"Failed to create image at level \" + lvls[i]);\r\n                    break;\r\n                }\r\n\r\n                // Tag image with wear level\r\n                let levelIndex = am7model.enums.wearLevelEnumType.findIndex(we => we == lvls[i]);\r\n                await am7client.patchAttribute(x, \"wearLevel\", lvls[i] + \"/\" + levelIndex);\r\n\r\n                images.push(x);\r\n            }\r\n\r\n            sequenceProgress = \"\";\r\n            sequenceCardId = null;\r\n            m.redraw();\r\n\r\n            page.clearToast();  // Clear indefinite progress toast\r\n            if (images.length > 0) {\r\n                page.toast(\"success\", \"Created \" + images.length + \" images for \" + card.name);\r\n\r\n                // Update card portrait to the LAST generated image (fully dressed)\r\n                let lastImage = images[images.length - 1];\r\n                if (lastImage && lastImage.groupPath && lastImage.name) {\r\n                    let orgPath = am7client.dotPath(am7client.currentOrganization);\r\n                    card.portraitUrl = g_application_path + \"/thumbnail/\" + orgPath +\r\n                        \"/data.data\" + lastImage.groupPath + \"/\" + lastImage.name + \"/256x256?t=\" + Date.now();\r\n                    console.log(\"[CardGame ArtPipeline] Updated card portrait to last sequence image:\", card.portraitUrl);\r\n\r\n                    // Save the deck with updated portrait\r\n                    if (viewingDeck && deckStorage) {\r\n                        let safeName = (viewingDeck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n                        await deckStorage.save(safeName, viewingDeck);\r\n                    }\r\n                }\r\n\r\n                m.redraw();\r\n            } else {\r\n                page.toast(\"warn\", \"No images were generated\");\r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(\"[CardGame ArtPipeline] Image sequence failed:\", e);\r\n            page.clearToast();  // Clear indefinite progress toast\r\n            page.toast(\"error\", \"Image sequence failed: \" + e.message);\r\n            sequenceProgress = \"\";\r\n            sequenceCardId = null;\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    //  Art Queue Progress Bar Component \r\n    function ArtQueueProgress() {\r\n        return {\r\n            view() {\r\n                // Show progress for any active generation (queue, background, tabletop, sequence)\r\n                let pending = artQueue.filter(j => j.status === \"pending\").length;\r\n                let processing = artQueue.filter(j => j.status === \"processing\").length;\r\n                let failed = artQueue.filter(j => j.status === \"failed\").length;\r\n                let done = artQueue.filter(j => j.status === \"complete\").length;\r\n                let queueActive = pending > 0 || processing > 0;\r\n                let envActive = backgroundGenerating || tabletopGenerating || cardFrontGenerating || cardBackGenerating;\r\n                let seqActive = !!sequenceCardId;\r\n                let anyActive = queueActive || envActive || seqActive;\r\n\r\n                // Total includes pre-gen (artCompleted tracks those) + queued cards\r\n                let totalDone = artCompleted + done;\r\n                let pct = artTotal > 0 ? Math.min(100, Math.round((totalDone / artTotal) * 100)) : 0;\r\n\r\n                // Nothing to show if no work has been started\r\n                if (artTotal === 0 && !envActive && !seqActive) return null;\r\n\r\n                // Build current status message\r\n                let currentMsg = null;\r\n                if (backgroundGenerating) currentMsg = \"Generating background...\";\r\n                else if (tabletopGenerating) currentMsg = \"Generating tabletop...\";\r\n                else if (cardFrontGenerating) currentMsg = \"Generating card front template...\";\r\n                else if (cardBackGenerating) currentMsg = \"Generating card back template...\";\r\n                else if (seqActive) currentMsg = sequenceProgress || \"Generating image sequence...\";\r\n                else if (processing > 0) {\r\n                    let current = artQueue.find(j => j.status === \"processing\");\r\n                    currentMsg = current ? (current.card.name || \"Card\") : \"Processing...\";\r\n                }\r\n\r\n                let statusText = anyActive ? \"Generating Art...\" : (failed > 0 ? \"Generation Complete (with errors)\" : \"Generation Complete\");\r\n\r\n                return m(\"div\", { class: \"cg2-art-progress\" }, [\r\n                    m(\"div\", { class: \"cg2-art-progress-header\" }, [\r\n                        m(\"span\", { style: { fontWeight: 700, fontSize: \"13px\" } }, statusText),\r\n                        m(\"span\", { style: { fontSize: \"12px\", color: \"#888\" } },\r\n                            totalDone + \" / \" + artTotal + (failed > 0 ? \" (\" + failed + \" failed)\" : \"\"))\r\n                    ]),\r\n                    m(\"div\", { class: \"cg2-art-progress-bar\" }, [\r\n                        m(\"div\", { class: \"cg2-art-progress-fill\" + (anyActive ? \" cg2-art-progress-fill-active\" : \"\"),\r\n                            style: { width: pct + \"%\" } })\r\n                    ]),\r\n                    currentMsg ? m(\"div\", { class: \"cg2-art-progress-current\" }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined cg2-spin\", style: { fontSize: \"14px\" } }, \"progress_activity\"),\r\n                        \" \" + currentMsg\r\n                    ]) : null,\r\n                    queueActive ? m(\"div\", { class: \"cg2-art-progress-actions\" }, [\r\n                        artPaused\r\n                            ? m(\"button\", { class: \"cg2-btn\", onclick: resumeArtQueue }, \"Resume\")\r\n                            : m(\"button\", { class: \"cg2-btn\", onclick: pauseArtQueue }, \"Pause\"),\r\n                        m(\"button\", { class: \"cg2-btn cg2-btn-danger\", onclick: cancelArtQueue }, \"Cancel\")\r\n                    ]) : null,\r\n                    // Show failed items with retry\r\n                    failed > 0 ? m(\"div\", { class: \"cg2-art-failures\" },\r\n                        artQueue.filter(j => j.status === \"failed\").map(j =>\r\n                            m(\"div\", { class: \"cg2-art-fail-item\" }, [\r\n                                m(\"span\", j.card.name + \": \" + (j.error || \"Failed\")),\r\n                                m(\"button\", {\r\n                                    class: \"cg2-btn\",\r\n                                    style: { fontSize: \"10px\", padding: \"1px 6px\" },\r\n                                    onclick() { j.status = \"pending\"; j.error = null; processArtQueue(); }\r\n                                }, \"Retry\")\r\n                            ])\r\n                        )\r\n                    ) : null\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Public API \r\n    window.CardGame.ArtPipeline = {\r\n        state: {\r\n            get artQueue() { return artQueue; },\r\n            set artQueue(v) { artQueue = v; },\r\n            get artProcessing() { return artProcessing; },\r\n            set artProcessing(v) { artProcessing = v; },\r\n            get artCompleted() { return artCompleted; },\r\n            set artCompleted(v) { artCompleted = v; },\r\n            get artTotal() { return artTotal; },\r\n            set artTotal(v) { artTotal = v; },\r\n            get artPaused() { return artPaused; },\r\n            set artPaused(v) { artPaused = v; },\r\n            get artDir() { return artDir; },\r\n            set artDir(v) { artDir = v; },\r\n            get backgroundImageId() { return backgroundImageId; },\r\n            set backgroundImageId(v) { backgroundImageId = v; },\r\n            get backgroundThumbUrl() { return backgroundThumbUrl; },\r\n            set backgroundThumbUrl(v) { backgroundThumbUrl = v; },\r\n            get backgroundPrompt() { return backgroundPrompt; },\r\n            set backgroundPrompt(v) { backgroundPrompt = v; },\r\n            get backgroundGenerating() { return backgroundGenerating; },\r\n            set backgroundGenerating(v) { backgroundGenerating = v; },\r\n            get tabletopImageId() { return tabletopImageId; },\r\n            set tabletopImageId(v) { tabletopImageId = v; },\r\n            get tabletopThumbUrl() { return tabletopThumbUrl; },\r\n            set tabletopThumbUrl(v) { tabletopThumbUrl = v; },\r\n            get tabletopGenerating() { return tabletopGenerating; },\r\n            set tabletopGenerating(v) { tabletopGenerating = v; },\r\n            get cardFrontImageUrl() { return cardFrontImageUrl; },\r\n            set cardFrontImageUrl(v) { cardFrontImageUrl = v; },\r\n            get cardBackImageUrl() { return cardBackImageUrl; },\r\n            set cardBackImageUrl(v) { cardBackImageUrl = v; },\r\n            get cardFrontGenerating() { return cardFrontGenerating; },\r\n            set cardFrontGenerating(v) { cardFrontGenerating = v; },\r\n            get cardBackGenerating() { return cardBackGenerating; },\r\n            set cardBackGenerating(v) { cardBackGenerating = v; },\r\n            get sequenceCardId() { return sequenceCardId; },\r\n            set sequenceCardId(v) { sequenceCardId = v; },\r\n            get sequenceProgress() { return sequenceProgress; },\r\n            set sequenceProgress(v) { sequenceProgress = v; },\r\n            get sdOverrides() { return sdOverrides; },\r\n            set sdOverrides(v) { sdOverrides = v; },\r\n            get sdConfigExpanded() { return sdConfigExpanded; },\r\n            set sdConfigExpanded(v) { sdConfigExpanded = v; },\r\n            get sdConfigTab() { return sdConfigTab; },\r\n            set sdConfigTab(v) { sdConfigTab = v; },\r\n            get gameConfigExpanded() { return gameConfigExpanded; },\r\n            set gameConfigExpanded(v) { gameConfigExpanded = v; },\r\n            get voiceProfiles() { return voiceProfiles; },\r\n            set voiceProfiles(v) { voiceProfiles = v; },\r\n            get voiceProfilesLoaded() { return voiceProfilesLoaded; },\r\n            set voiceProfilesLoaded(v) { voiceProfilesLoaded = v; },\r\n            get flippedCards() { return flippedCards; },\r\n            set flippedCards(v) { flippedCards = v; },\r\n            get sdOverrideInsts() { return sdOverrideInsts; },\r\n            set sdOverrideInsts(v) { sdOverrideInsts = v; },\r\n            get sdOverrideViews() { return sdOverrideViews; },\r\n            set sdOverrideViews(v) { sdOverrideViews = v; }\r\n        },\r\n        // Prompt building\r\n        styleLabel,\r\n        buildCardPrompt,\r\n        // SD entity builder\r\n        buildSdEntity,\r\n        // Art directory\r\n        ensureArtDir,\r\n        // Environment generation\r\n        generateBackground,\r\n        generateTabletop,\r\n        // Card art generation\r\n        generateCardArt,\r\n        generateTemplateArt,\r\n        // Queue management\r\n        processArtQueue,\r\n        queueDeckArt,\r\n        saveArtProgress,\r\n        pauseArtQueue,\r\n        resumeArtQueue,\r\n        cancelArtQueue,\r\n        // Game state propagation\r\n        propagateArtToGameState,\r\n        cardSignature,\r\n        // Image sequence\r\n        generateImageSequence,\r\n        // SD config overrides\r\n        newSdOverride,\r\n        defaultSdOverrides,\r\n        getCardTypeDelta,\r\n        getSdOverrideInst,\r\n        resetSdOverrideInsts,\r\n        // Game config\r\n        loadVoiceProfiles,\r\n        getDeckGameConfig,\r\n        currentDeckSafeName,\r\n        // UI Component\r\n        ArtQueueProgress\r\n    };\r\n\r\n    console.log('[CardGame] ArtPipeline service loaded (' +\r\n        Object.keys(window.CardGame.ArtPipeline).length + ' exports)');\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/engine/effects.js === */\n/**\r\n * CardGame Engine - Status Effects & Effect Parsing\r\n * Manages application/removal/ticking of status effects on actors,\r\n * and provides a unified parser for card effect strings (damage, heal, status, etc.)\r\n *\r\n * Depends on: CardGame.Constants (STATUS_EFFECTS)\r\n * Exposes: window.CardGame.Engine.{applyStatusEffect, removeStatusEffect, hasStatusEffect,\r\n *   getStatusModifiers, processStatusEffectsTurnStart, tickStatusEffects, onActorHit,\r\n *   parseEffect, applyParsedEffects, isEffectParseable, SKILL_ACTION_KEYWORDS, getStackSkillMod}\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.Engine = window.CardGame.Engine || {};\r\n\r\n    const C = window.CardGame.Constants;\r\n\r\n    //  Status Effect Management \r\n\r\n    // Apply a status effect to an actor\r\n    function applyStatusEffect(actor, effectId, sourceName) {\r\n        if (!actor.statusEffects) actor.statusEffects = [];\r\n        let effectDef = C.STATUS_EFFECTS[effectId.toUpperCase()];\r\n        if (!effectDef) {\r\n            console.warn(\"[CardGame v2] Unknown status effect:\", effectId);\r\n            return false;\r\n        }\r\n        // Check if already has this effect (refresh duration instead of stacking)\r\n        let existing = actor.statusEffects.find(e => e.id === effectDef.id);\r\n        if (existing) {\r\n            existing.turnsRemaining = effectDef.duration;\r\n            console.log(\"[CardGame v2] Refreshed\", effectDef.name, \"on\", actor.character?.name || \"actor\");\r\n            return true;\r\n        }\r\n        // Add new effect\r\n        actor.statusEffects.push({\r\n            id: effectDef.id,\r\n            name: effectDef.name,\r\n            icon: effectDef.icon,\r\n            color: effectDef.color,\r\n            turnsRemaining: effectDef.duration,\r\n            durationType: effectDef.durationType,\r\n            source: sourceName || \"Unknown\"\r\n        });\r\n        console.log(\"[CardGame v2] Applied\", effectDef.name, \"to\", actor.character?.name || \"actor\");\r\n        return true;\r\n    }\r\n\r\n    // Remove a status effect from an actor\r\n    function removeStatusEffect(actor, effectId) {\r\n        if (!actor.statusEffects) return;\r\n        let idx = actor.statusEffects.findIndex(e => e.id === effectId);\r\n        if (idx >= 0) {\r\n            let removed = actor.statusEffects.splice(idx, 1)[0];\r\n            console.log(\"[CardGame v2] Removed\", removed.name, \"from\", actor.character?.name || \"actor\");\r\n        }\r\n    }\r\n\r\n    // Check if actor has a specific status effect\r\n    function hasStatusEffect(actor, effectId) {\r\n        if (!actor.statusEffects) return false;\r\n        return actor.statusEffects.some(e => e.id === effectId);\r\n    }\r\n\r\n    // Get total status effect modifiers for an actor\r\n    function getStatusModifiers(actor) {\r\n        let mods = { atk: 0, def: 0, roll: 0 };\r\n        if (!actor.statusEffects) return mods;\r\n        actor.statusEffects.forEach(effect => {\r\n            let def = C.STATUS_EFFECTS[effect.id.toUpperCase()];\r\n            if (def) {\r\n                if (def.atkBonus) mods.atk += def.atkBonus;\r\n                if (def.defBonus) mods.def += def.defBonus;\r\n                if (def.defPenalty) mods.def += def.defPenalty;\r\n                if (def.rollPenalty) mods.roll += def.rollPenalty;\r\n                if (def.rollBonus) mods.roll += def.rollBonus;\r\n            }\r\n        });\r\n        return mods;\r\n    }\r\n\r\n    // Process status effects at turn start (for effects like poison)\r\n    function processStatusEffectsTurnStart(actor) {\r\n        if (!actor.statusEffects) return [];\r\n        let messages = [];\r\n        actor.statusEffects.forEach(effect => {\r\n            let def = C.STATUS_EFFECTS[effect.id.toUpperCase()];\r\n            if (def && def.onTurnStart) {\r\n                let result = def.onTurnStart(actor);\r\n                if (result && result.message) {\r\n                    messages.push({ effect: effect.name, message: result.message });\r\n                }\r\n            }\r\n        });\r\n        return messages;\r\n    }\r\n\r\n    // Tick down status effect durations (call at end of turn/round)\r\n    function tickStatusEffects(actor) {\r\n        if (!actor.statusEffects) return;\r\n        actor.statusEffects = actor.statusEffects.filter(effect => {\r\n            if (effect.durationType === \"turns\") {\r\n                effect.turnsRemaining--;\r\n                if (effect.turnsRemaining <= 0) {\r\n                    console.log(\"[CardGame v2]\", effect.name, \"expired on\", actor.character?.name || \"actor\");\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n    }\r\n\r\n    // Remove \"until hit\" effects when actor is hit\r\n    function onActorHit(actor) {\r\n        if (!actor.statusEffects) return;\r\n        actor.statusEffects = actor.statusEffects.filter(effect => {\r\n            if (effect.durationType === \"untilHit\") {\r\n                console.log(\"[CardGame v2]\", effect.name, \"removed (hit) from\", actor.character?.name || \"actor\");\r\n                return false;\r\n            }\r\n            return true;\r\n        });\r\n    }\r\n\r\n    //  Unified Effect Parser \r\n    // Parses an effect string and returns all recognized mechanical effects.\r\n    // Used by magic, consumable, and custom card evaluation.\r\n    // Supported patterns:\r\n    //   \"Deal N damage\"        -> { damage: N }\r\n    //   \"Heal N\" / \"Restore N HP\"  -> { healHp: N }\r\n    //   \"Restore N Energy\"     -> { restoreEnergy: N }\r\n    //   \"Restore N Morale\"     -> { restoreMorale: N }\r\n    //   \"Drain N\"              -> { damage: N, healHp: N }  (damage + self-heal)\r\n    //   \"Draw N\"               -> { draw: N }\r\n    //   \"Burn\" / \"Ignite\"      -> { status: \"burning\", target: \"enemy\" }\r\n    //   \"Bleed\"                -> { status: \"bleeding\", target: \"enemy\" }\r\n    //   \"Stun\"                 -> { status: \"stunned\", target: \"enemy\" }\r\n    //   \"Poison\"               -> { status: \"poisoned\", target: \"enemy\" }\r\n    //   \"Shield\" / \"Protect\"   -> { status: \"shielded\", target: \"self\" }\r\n    //   \"Enrage\" / \"Fury\"      -> { status: \"enraged\", target: \"self\" }\r\n    //   \"Weaken\"               -> { status: \"weakened\", target: \"enemy\" }\r\n    //   \"Fortify\" / \"Bolster\"  -> { status: \"fortified\", target: \"self\" }\r\n    //   \"Inspire\"              -> { status: \"inspired\", target: \"self\" }\r\n    //   \"Regenerate\" / \"Regen\" -> { status: \"regenerating\", target: \"self\" }\r\n    //   \"Cure\" / \"Cleanse\"     -> { cure: true }  (removes negative status)\r\n    function parseEffect(effectStr) {\r\n        if (!effectStr) return {};\r\n        let e = effectStr.toLowerCase();\r\n        let result = {};\r\n\r\n        // Numeric extractions\r\n        let damageMatch = effectStr.match(/deal\\s+(\\d+)/i);\r\n        if (damageMatch) result.damage = parseInt(damageMatch[1], 10);\r\n\r\n        let drainMatch = effectStr.match(/drain\\s+(\\d+)/i);\r\n        if (drainMatch) {\r\n            let val = parseInt(drainMatch[1], 10);\r\n            result.damage = (result.damage || 0) + val;\r\n            result.healHp = (result.healHp || 0) + val;\r\n        }\r\n\r\n        let healMatch = effectStr.match(/heal\\s+(\\d+)|restore\\s+(\\d+)\\s+hp/i);\r\n        if (healMatch) result.healHp = (result.healHp || 0) + parseInt(healMatch[1] || healMatch[2], 10);\r\n\r\n        let energyMatch = effectStr.match(/restore\\s+(\\d+)\\s+energy/i);\r\n        if (energyMatch) result.restoreEnergy = parseInt(energyMatch[1], 10);\r\n\r\n        let moraleMatch = effectStr.match(/restore\\s+(\\d+)\\s+morale/i);\r\n        if (moraleMatch) result.restoreMorale = parseInt(moraleMatch[1], 10);\r\n\r\n        let drawMatch = effectStr.match(/draw\\s+(\\d+)/i);\r\n        if (drawMatch) result.draw = parseInt(drawMatch[1], 10);\r\n\r\n        // Status effect keywords -> { statusEffects: [{id, target}] }\r\n        let statuses = [];\r\n        if (e.includes(\"stun\"))                                    statuses.push({ id: \"stunned\", target: \"enemy\" });\r\n        if (e.includes(\"poison\"))                                  statuses.push({ id: \"poisoned\", target: \"enemy\" });\r\n        if (e.includes(\"burn\") || e.includes(\"ignite\"))            statuses.push({ id: \"burning\", target: \"enemy\" });\r\n        if (e.includes(\"bleed\"))                                   statuses.push({ id: \"bleeding\", target: \"enemy\" });\r\n        if (e.includes(\"weaken\"))                                  statuses.push({ id: \"weakened\", target: \"enemy\" });\r\n        if (e.includes(\"shield\") || e.includes(\"protect\"))         statuses.push({ id: \"shielded\", target: \"self\" });\r\n        if (e.includes(\"enrage\") || e.includes(\"fury\"))            statuses.push({ id: \"enraged\", target: \"self\" });\r\n        if (e.includes(\"fortify\") || e.includes(\"bolster\"))        statuses.push({ id: \"fortified\", target: \"self\" });\r\n        if (e.includes(\"inspire\"))                                 statuses.push({ id: \"inspired\", target: \"self\" });\r\n        if (e.includes(\"regenerat\") || e.includes(\"regen\"))        statuses.push({ id: \"regenerating\", target: \"self\" });\r\n        if (statuses.length > 0) result.statusEffects = statuses;\r\n\r\n        // Cure/cleanse\r\n        if (e.includes(\"cure\") || e.includes(\"cleanse\") || e.includes(\"purify\")) result.cure = true;\r\n\r\n        return result;\r\n    }\r\n\r\n    // Apply parsed effects to owner/target actors\r\n    function applyParsedEffects(parsed, owner, target, sourceName) {\r\n        let log = [];\r\n        if (parsed.damage && target) {\r\n            let dmgResult = window.CardGame.Engine.applyDamage(target, parsed.damage);\r\n            log.push(sourceName + \" deals \" + dmgResult.finalDamage + \" damage\");\r\n        }\r\n        if (parsed.healHp && owner) {\r\n            let before = owner.hp;\r\n            owner.hp = Math.min(owner.maxHp, owner.hp + parsed.healHp);\r\n            log.push(sourceName + \" heals \" + (owner.hp - before) + \" HP\");\r\n        }\r\n        if (parsed.restoreEnergy && owner) {\r\n            owner.energy = Math.min(owner.maxEnergy, owner.energy + parsed.restoreEnergy);\r\n            log.push(sourceName + \" restores \" + parsed.restoreEnergy + \" Energy\");\r\n        }\r\n        if (parsed.restoreMorale && owner) {\r\n            owner.morale = Math.min(owner.maxMorale, owner.morale + parsed.restoreMorale);\r\n            log.push(sourceName + \" restores \" + parsed.restoreMorale + \" Morale\");\r\n        }\r\n        if (parsed.draw && owner) {\r\n            window.CardGame.Engine.drawCardsForActor(owner, parsed.draw);\r\n            log.push(sourceName + \" draws \" + parsed.draw + \" card(s)\");\r\n        }\r\n        if (parsed.statusEffects) {\r\n            parsed.statusEffects.forEach(se => {\r\n                let actor = se.target === \"self\" ? owner : target;\r\n                if (actor) applyStatusEffect(actor, se.id, sourceName);\r\n                log.push(sourceName + \" applies \" + se.id + \" to \" + (se.target === \"self\" ? \"self\" : \"target\"));\r\n            });\r\n        }\r\n        if (parsed.cure && owner) {\r\n            // Remove all negative status effects from owner\r\n            let negatives = [\"stunned\", \"poisoned\", \"burning\", \"bleeding\", \"weakened\"];\r\n            negatives.forEach(id => removeStatusEffect(owner, id));\r\n            log.push(sourceName + \" cures negative effects\");\r\n        }\r\n        return log;\r\n    }\r\n\r\n    // Check if an effect string has any mechanically parseable content\r\n    function isEffectParseable(effectStr) {\r\n        let parsed = parseEffect(effectStr);\r\n        return Object.keys(parsed).length > 0;\r\n    }\r\n\r\n    // Skill action keyword map: actionType -> keywords that match\r\n    const SKILL_ACTION_KEYWORDS = {\r\n        attack:     [\"attack\", \"combat\", \"melee\", \"strike\", \"offensive\"],\r\n        defense:    [\"defense\", \"defend\", \"parry\", \"block\", \"defensive\"],\r\n        talk:       [\"talk\", \"social\", \"charisma\", \"persuade\", \"diplomacy\", \"speech\"],\r\n        initiative: [\"initiative\", \"speed\", \"first\"],\r\n        investigate:[\"investigate\", \"search\", \"discover\", \"perception\"],\r\n        flee:       [\"flee\", \"escape\", \"evasion\", \"retreat\"],\r\n        craft:      [\"craft\", \"create\", \"forge\", \"build\"],\r\n        magic:      [\"magic\", \"spell\", \"cast\", \"arcane\", \"psionic\"]\r\n    };\r\n\r\n    function getStackSkillMod(stack, actionType) {\r\n        if (!stack || !stack.modifiers) return 0;\r\n        let total = 0;\r\n        let keywords = SKILL_ACTION_KEYWORDS[actionType] || [actionType];\r\n        stack.modifiers.forEach(mod => {\r\n            if (mod.type === \"skill\" && mod.modifier) {\r\n                let match = mod.modifier.match(/\\+(\\d+)/);\r\n                if (match) {\r\n                    let modLower = mod.modifier.toLowerCase();\r\n                    if (keywords.some(kw => modLower.includes(kw))) {\r\n                        total += parseInt(match[1], 10);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        return total;\r\n    }\r\n\r\n    //  Export \r\n    Object.assign(window.CardGame.Engine, {\r\n        applyStatusEffect,\r\n        removeStatusEffect,\r\n        hasStatusEffect,\r\n        getStatusModifiers,\r\n        processStatusEffectsTurnStart,\r\n        tickStatusEffects,\r\n        onActorHit,\r\n        parseEffect,\r\n        applyParsedEffects,\r\n        isEffectParseable,\r\n        SKILL_ACTION_KEYWORDS,\r\n        getStackSkillMod\r\n    });\r\n\r\n    console.log('[CardGame] Engine/effects loaded');\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/engine/combat.js === */\n/**\r\n * CardGame Engine - Combat System\r\n * Dice utilities, actor stat helpers, attack/defense rolls, damage calculation,\r\n * and the main combat resolver with dual-wield, criticals, and counter-attacks.\r\n *\r\n * Depends on: CardGame.Constants (COMBAT_OUTCOMES), CardGame.Engine (effects)\r\n * Exposes: window.CardGame.Engine.{DiceUtils, rollD20, rollInitiative,\r\n *   getActorATK, isDualWielding, getWeaponATKs, getActorDEF,\r\n *   rollAttack, rollDefense, getCombatOutcome, COMBAT_OUTCOMES,\r\n *   calculateDamage, applyDamage, resolveCombat}\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.Engine = window.CardGame.Engine || {};\r\n\r\n    const C = window.CardGame.Constants;\r\n    const E = window.CardGame.Engine;  // effects module (loaded before this)\r\n\r\n    //  Dice Utilities (Phase 7.0) \r\n    // Centralized dice rolling for testability and consistency\r\n    const DiceUtils = {\r\n        // Roll a die with specified sides (default d20)\r\n        roll(sides = 20) {\r\n            return Math.floor(Math.random() * sides) + 1;\r\n        },\r\n\r\n        // Roll with a single modifier, returning breakdown\r\n        rollWithMod(stat = 0, statName = \"\") {\r\n            const raw = this.roll(20);\r\n            const total = raw + stat;\r\n            const breakdown = statName ? `${raw} + ${stat} ${statName} = ${total}` : `${raw} + ${stat} = ${total}`;\r\n            return { raw, modifier: stat, total, breakdown, isCrit: raw === 20, isFumble: raw === 1 };\r\n        },\r\n\r\n        // Initiative roll (d20 + AGI)\r\n        initiative(stats) {\r\n            const raw = this.roll(20);\r\n            const modifier = (stats && stats.AGI) || 0;\r\n            return { raw, modifier, total: raw + modifier };\r\n        }\r\n    };\r\n\r\n    // Backwards compatibility\r\n    function rollD20() {\r\n        return DiceUtils.roll(20);\r\n    }\r\n\r\n    function rollInitiative(stats) {\r\n        return DiceUtils.initiative(stats);\r\n    }\r\n\r\n    //  Actor Stat Helpers \r\n\r\n    // Get total ATK bonus from actor's card stack (weapons)\r\n    function getActorATK(actor) {\r\n        let total = 0;\r\n        (actor.cardStack || []).forEach(card => {\r\n            if (card.atk) total += card.atk;\r\n        });\r\n        return total;\r\n    }\r\n\r\n    // Check if actor is dual-wielding (two one-handed weapons)\r\n    function isDualWielding(actor) {\r\n        let oneHandedWeapons = (actor.cardStack || []).filter(card =>\r\n            card.type === \"item\" &&\r\n            card.subtype === \"weapon\" &&\r\n            card.slot &&\r\n            card.slot.includes(\"1H\")\r\n        );\r\n        return oneHandedWeapons.length >= 2;\r\n    }\r\n\r\n    // Get ATK values for each weapon (for dual wield separate rolls)\r\n    function getWeaponATKs(actor) {\r\n        let weapons = (actor.cardStack || []).filter(card =>\r\n            card.type === \"item\" &&\r\n            card.subtype === \"weapon\" &&\r\n            card.atk\r\n        );\r\n        return weapons.map(w => ({ name: w.name, atk: w.atk || 0 }));\r\n    }\r\n\r\n    // Get total DEF bonus from actor's card stack (armor, apparel)\r\n    function getActorDEF(actor) {\r\n        let total = 0;\r\n        (actor.cardStack || []).forEach(card => {\r\n            if (card.def) total += card.def;\r\n        });\r\n        return total;\r\n    }\r\n\r\n    //  Combat Rolls \r\n\r\n    // Roll attack: 1d20 + STR + weapon ATK + skill mods (from stack) + status effects\r\n    function rollAttack(attacker, stack) {\r\n        let raw = rollD20();\r\n        let stats = attacker.character.stats || {};\r\n        let strMod = stats.STR || 0;\r\n        let atkBonus = getActorATK(attacker);\r\n        let skillMod = E.getStackSkillMod(stack, \"attack\");\r\n\r\n        // Add status effect modifiers\r\n        let statusMods = E.getStatusModifiers(attacker);\r\n        let statusAtkMod = statusMods.atk + statusMods.roll;\r\n\r\n        let total = raw + strMod + atkBonus + skillMod + statusAtkMod;\r\n\r\n        let breakdown = `${raw} + ${strMod} STR + ${atkBonus} ATK`;\r\n        if (skillMod) breakdown += ` + ${skillMod} Skill`;\r\n        if (statusAtkMod) breakdown += ` + ${statusAtkMod} Status`;\r\n        breakdown += ` = ${total}`;\r\n\r\n        return {\r\n            raw,\r\n            strMod,\r\n            atkBonus,\r\n            skillMod,\r\n            statusMod: statusAtkMod,\r\n            total,\r\n            formula: \"1d20 + STR + ATK\" + (skillMod ? \" + Skill\" : \"\") + (statusAtkMod ? \" + Status\" : \"\"),\r\n            breakdown\r\n        };\r\n    }\r\n\r\n    // Roll defense: 1d20 + END + armor DEF + weapon parry (if applicable) + status effects\r\n    function rollDefense(defender) {\r\n        let raw = rollD20();\r\n        let stats = defender.character.stats || {};\r\n        let endMod = stats.END || 0;\r\n        let defBonus = getActorDEF(defender);\r\n        // Parry: check if defender has a weapon with parry property\r\n        let parryBonus = 0;\r\n        (defender.cardStack || []).forEach(card => {\r\n            if (card.parry) parryBonus += card.parry;\r\n        });\r\n\r\n        // Add status effect modifiers\r\n        let statusMods = E.getStatusModifiers(defender);\r\n        let statusDefMod = statusMods.def + statusMods.roll;\r\n\r\n        let total = raw + endMod + defBonus + parryBonus + statusDefMod;\r\n\r\n        let breakdown = `${raw} + ${endMod} END + ${defBonus} DEF`;\r\n        if (parryBonus) breakdown += ` + ${parryBonus} Parry`;\r\n        if (statusDefMod) breakdown += ` + ${statusDefMod} Status`;\r\n        breakdown += ` = ${total}`;\r\n\r\n        return {\r\n            raw,\r\n            endMod,\r\n            defBonus,\r\n            parryBonus,\r\n            statusMod: statusDefMod,\r\n            total,\r\n            formula: \"1d20 + END + DEF\" + (parryBonus ? \" + Parry\" : \"\") + (statusDefMod ? \" + Status\" : \"\"),\r\n            breakdown\r\n        };\r\n    }\r\n\r\n    //  Combat Outcomes \r\n\r\n    // Outcome table (based on roll difference + natural 1/20)\r\n    // Uses the constants from COMBAT_OUTCOMES but kept as local ref for the resolver\r\n    const COMBAT_OUTCOMES = C.COMBAT_OUTCOMES;\r\n\r\n    function getCombatOutcome(attackRoll, defenseRoll) {\r\n        let diff = attackRoll.total - defenseRoll.total;\r\n        let attackNat = attackRoll.raw;\r\n        let defenseNat = defenseRoll.raw;\r\n\r\n        // Natural 20 on attack = Critical Hit (always)\r\n        if (attackNat === 20) return { ...COMBAT_OUTCOMES.CRITICAL_HIT, diff };\r\n\r\n        // Natural 1 on attack = Critical Miss (always)\r\n        if (attackNat === 1) return { ...COMBAT_OUTCOMES.CRITICAL_MISS, diff };\r\n\r\n        // Natural 20 on defense with successful block = Critical Parry (with reward)\r\n        if (defenseNat === 20 && diff <= 0) return { ...COMBAT_OUTCOMES.CRITICAL_PARRY, diff };\r\n\r\n        // Diff-based outcomes (no criticals)\r\n        if (diff >= 10) return { ...COMBAT_OUTCOMES.DEVASTATING, diff };\r\n        if (diff >= 5)  return { ...COMBAT_OUTCOMES.STRONG_HIT, diff };\r\n        if (diff >= 1)  return { ...COMBAT_OUTCOMES.GLANCING_HIT, diff };\r\n        if (diff === 0) return { ...COMBAT_OUTCOMES.CLASH, diff };\r\n        if (diff >= -4) return { ...COMBAT_OUTCOMES.DEFLECT, diff };\r\n        return { ...COMBAT_OUTCOMES.PARRY, diff };\r\n    }\r\n\r\n    //  Damage Calculation \r\n\r\n    // Calculate damage: base = weapon ATK + STR, modified by outcome\r\n    function calculateDamage(attacker, outcome) {\r\n        let stats = attacker.character.stats || {};\r\n        let strMod = stats.STR || 0;\r\n        let weaponAtk = getActorATK(attacker);\r\n        let baseDamage = weaponAtk + strMod;\r\n\r\n        // Apply outcome multiplier\r\n        let finalDamage = Math.floor(baseDamage * outcome.damageMultiplier);\r\n        // Minimum 1 damage on any successful hit\r\n        if (outcome.damageMultiplier > 0 && finalDamage < 1) finalDamage = 1;\r\n\r\n        return {\r\n            baseDamage,\r\n            multiplier: outcome.damageMultiplier,\r\n            finalDamage,\r\n            breakdown: `(${weaponAtk} ATK + ${strMod} STR) \\u00D7 ${outcome.damageMultiplier} = ${finalDamage}`\r\n        };\r\n    }\r\n\r\n    // Apply damage to a target actor\r\n    function applyDamage(actor, damage) {\r\n        let def = getActorDEF(actor);\r\n        let reduced = Math.max(1, damage - def);  // Minimum 1 damage\r\n        actor.hp = Math.max(0, actor.hp - reduced);\r\n\r\n        // Remove \"until hit\" status effects (like shielded)\r\n        E.onActorHit(actor);\r\n\r\n        return {\r\n            rawDamage: damage,\r\n            armorReduction: def,\r\n            finalDamage: reduced,\r\n            newHp: actor.hp\r\n        };\r\n    }\r\n\r\n    //  Main Combat Resolver \r\n\r\n    // Resolve combat between attacker and defender\r\n    function resolveCombat(attackerActor, defenderActor, stack) {\r\n        // Check for dual wield (two one-handed weapons = two attack rolls)\r\n        let dualWield = isDualWielding(attackerActor);\r\n        let weapons = dualWield ? getWeaponATKs(attackerActor) : null;\r\n\r\n        let attackRoll = rollAttack(attackerActor, stack);\r\n        let defenseRoll = rollDefense(defenderActor);\r\n        let outcome = getCombatOutcome(attackRoll, defenseRoll);\r\n        let damage = calculateDamage(attackerActor, outcome);\r\n        let damageResult = null;\r\n        let selfDamageResult = null;\r\n\r\n        // Dual wield: second attack roll\r\n        let secondAttack = null;\r\n        if (dualWield && weapons && weapons.length >= 2) {\r\n            // Second attack uses the second weapon's ATK\r\n            let secondRoll = rollAttack(attackerActor, stack);\r\n            let secondOutcome = getCombatOutcome(secondRoll, defenseRoll);\r\n            let secondDamage = calculateDamage(attackerActor, secondOutcome);\r\n\r\n            secondAttack = {\r\n                weaponName: weapons[1].name,\r\n                attackRoll: secondRoll,\r\n                outcome: secondOutcome,\r\n                damage: secondDamage,\r\n                damageResult: null\r\n            };\r\n\r\n            // Apply second attack damage\r\n            if (secondOutcome.damageMultiplier > 0) {\r\n                secondAttack.damageResult = applyDamage(defenderActor, secondDamage.finalDamage);\r\n            }\r\n\r\n            // Tag first attack with weapon name\r\n            if (weapons[0]) {\r\n                attackRoll.weaponName = weapons[0].name;\r\n            }\r\n\r\n            console.log(\"[CardGame v2] DUAL WIELD: Second attack with\", weapons[1].name, \"- Roll:\", secondRoll.total, \"Outcome:\", secondOutcome.label);\r\n        }\r\n\r\n        // Apply effects based on outcome (first/main attack)\r\n        let criticalEffects = { itemDropped: null, attackerStunned: false, rewardCard: null };\r\n\r\n        if (outcome.damageMultiplier > 0) {\r\n            // Hit - apply damage to defender\r\n            damageResult = applyDamage(defenderActor, damage.finalDamage);\r\n\r\n            // Critical Hit: ALWAYS reward the attacker with an elevated item card\r\n            if (outcome.isCriticalHit) {\r\n                // Generate a special elevated item as reward\r\n                let rewardCard = E.generateCriticalReward(\"attack\", attackerActor);\r\n                attackerActor.hand.push(rewardCard);\r\n                criticalEffects.rewardCard = rewardCard;\r\n                console.log(\"[CardGame v2] CRITICAL HIT! Reward card:\", rewardCard.name);\r\n\r\n                // ALSO 50% chance to make defender drop an item\r\n                if (defenderActor.cardStack && defenderActor.cardStack.length > 0 && Math.random() < 0.5) {\r\n                    let droppableItems = defenderActor.cardStack.filter(c =>\r\n                        c.type === \"item\" || c.type === \"apparel\"\r\n                    );\r\n                    if (droppableItems.length > 0) {\r\n                        let droppedItem = droppableItems[Math.floor(Math.random() * droppableItems.length)];\r\n                        let idx = defenderActor.cardStack.indexOf(droppedItem);\r\n                        if (idx >= 0) {\r\n                            defenderActor.cardStack.splice(idx, 1);\r\n                            // Add to pot via context (gameState passed externally)\r\n                            let gs = CardGame.ctx?.gameState;\r\n                            if (gs) gs.pot.push(droppedItem);\r\n                            criticalEffects.itemDropped = droppedItem;\r\n                            console.log(\"[CardGame v2] CRITICAL HIT! Item also dropped:\", droppedItem.name);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        } else if (outcome.damageMultiplier < 0) {\r\n            // Critical counter - attacker takes damage\r\n            selfDamageResult = applyDamage(attackerActor, damage.finalDamage * -1);\r\n\r\n            // Critical Counter: stun the attacker (skip next action)\r\n            if (outcome.isCriticalCounter) {\r\n                E.applyStatusEffect(attackerActor, \"stunned\", \"Critical Counter\");\r\n                criticalEffects.attackerStunned = true;\r\n                console.log(\"[CardGame v2] CRITICAL COUNTER! Attacker stunned\");\r\n            }\r\n\r\n            // Critical Parry: defender gets a reward card\r\n            if (outcome.isCriticalParry) {\r\n                let rewardCard = E.generateCriticalReward(\"defense\", defenderActor);\r\n                defenderActor.hand.push(rewardCard);\r\n                criticalEffects.rewardCard = rewardCard;\r\n                console.log(\"[CardGame v2] CRITICAL PARRY! Reward card:\", rewardCard.name);\r\n            }\r\n        } else if (outcome.bothTakeDamage) {\r\n            // Clash - both take fixed damage\r\n            damageResult = applyDamage(defenderActor, outcome.bothTakeDamage);\r\n            selfDamageResult = applyDamage(attackerActor, outcome.bothTakeDamage);\r\n        }\r\n\r\n        let result = {\r\n            attackRoll,\r\n            defenseRoll,\r\n            outcome,\r\n            damage,\r\n            damageResult,\r\n            selfDamageResult,\r\n            attackerName: attackerActor.character.name || \"Attacker\",\r\n            defenderName: defenderActor.character.name || \"Defender\",\r\n            // Dual wield info\r\n            dualWield: dualWield,\r\n            secondAttack: secondAttack,\r\n            // Critical effects\r\n            criticalEffects: criticalEffects\r\n        };\r\n\r\n        console.log(\"[CardGame v2] Combat resolved:\", result);\r\n        return result;\r\n    }\r\n\r\n    // Check if game is over (either actor HP <= 0)\r\n    function checkGameOver(state) {\r\n        let gs = state || (window.CardGame.ctx ? window.CardGame.ctx.gameState : null);\r\n        if (!gs) return null;\r\n        if (gs.player.hp <= 0) return \"opponent\";\r\n        if (gs.opponent.hp <= 0) return \"player\";\r\n        return null;\r\n    }\r\n\r\n    //  Export \r\n    Object.assign(window.CardGame.Engine, {\r\n        DiceUtils,\r\n        rollD20,\r\n        rollInitiative,\r\n        getActorATK,\r\n        isDualWielding,\r\n        getWeaponATKs,\r\n        getActorDEF,\r\n        rollAttack,\r\n        rollDefense,\r\n        getCombatOutcome,\r\n        calculateDamage,\r\n        applyDamage,\r\n        resolveCombat,\r\n        checkGameOver\r\n    });\r\n\r\n    console.log('[CardGame] Engine/combat loaded');\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/engine/encounters.js === */\n/**\r\n * CardGame Engine - Encounter & Threat System\r\n * Threat creature generation, critical rewards, scenario cards,\r\n * and beginning/end-of-round threat checks.\r\n *\r\n * Depends on: CardGame.Engine (effects, combat)\r\n * Exposes: window.CardGame.Engine.{loadBalanceData, getThreatCreatures, getScenarioCards,\r\n *   generateCriticalReward, createThreatEncounter, checkNat1Threats, insertBeginningThreats,\r\n *   drawScenarioCard, checkEndThreat, THREAT_CREATURES, SCENARIO_CARDS}\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.Engine = window.CardGame.Engine || {};\r\n\r\n    //  Balance Data Loader \r\n    // Load balance data from external JSON (optional override of defaults)\r\n    let balanceData = null;\r\n    async function loadBalanceData() {\r\n        if (balanceData) return balanceData;\r\n        try {\r\n            balanceData = await m.request({ method: \"GET\", url: \"media/cardGame/game-balance.json\" });\r\n        } catch(e) {\r\n            console.warn(\"[CardGame] Could not load game-balance.json, using defaults\");\r\n            balanceData = {};  // Will fall back to hardcoded defaults\r\n        }\r\n        return balanceData;\r\n    }\r\n\r\n    //  Threat Creatures \r\n    const THREAT_CREATURES = [\r\n        { name: \"Wolf\", atk: 2, def: 1, hp: 8, imageIcon: \"pets\" },\r\n        { name: \"Goblin Scout\", atk: 3, def: 1, hp: 10, imageIcon: \"face\" },\r\n        { name: \"Giant Spider\", atk: 2, def: 2, hp: 12, imageIcon: \"bug_report\" },\r\n        { name: \"Bandit\", atk: 4, def: 2, hp: 15, imageIcon: \"person_alert\" },\r\n        { name: \"Dire Wolf\", atk: 5, def: 2, hp: 18, imageIcon: \"pets\" },\r\n        { name: \"Orc Warrior\", atk: 6, def: 3, hp: 20, imageIcon: \"shield_person\" }\r\n    ];\r\n\r\n    function getThreatCreatures() {\r\n        return balanceData?.threatCreatures || THREAT_CREATURES;\r\n    }\r\n\r\n    //  Scenario Cards \r\n    const SCENARIO_CARDS = [\r\n        { name: \"Peaceful Respite\", effect: \"no_threat\", description: \"The area is calm. No threats emerge.\", weight: 40 },\r\n        { name: \"Distant Howling\", effect: \"no_threat\", description: \"You hear something in the distance, but nothing approaches.\", weight: 25 },\r\n        { name: \"Ambush!\", effect: \"threat\", description: \"Enemies emerge from hiding!\", threatBonus: 0, weight: 15 },\r\n        { name: \"Elite Patrol\", effect: \"threat\", description: \"A stronger foe appears!\", threatBonus: 2, weight: 10 },\r\n        { name: \"Wandering Monster\", effect: \"threat\", description: \"A creature stumbles upon you.\", threatBonus: -1, weight: 8 },\r\n        { name: \"Boss Encounter\", effect: \"threat\", description: \"A fearsome opponent blocks your path!\", threatBonus: 4, weight: 2 }\r\n    ];\r\n\r\n    function getScenarioCards() {\r\n        return balanceData?.scenarioCards || SCENARIO_CARDS;\r\n    }\r\n\r\n    //  Critical Rewards \r\n\r\n    /**\r\n     * Generate a reward card for critical success (nat 20)\r\n     * Tries to pull a rare/epic card from deck, falls back to stat bonus\r\n     * @param {string} type - \"attack\" or \"defense\"\r\n     * @param {Object} actor - The actor receiving the reward\r\n     * @returns {Object} Generated reward card\r\n     */\r\n    function generateCriticalReward(type, actor) {\r\n        // Try to find a rare/epic card from the draw pile\r\n        let rarityOrder = [\"LEGENDARY\", \"EPIC\", \"RARE\", \"UNCOMMON\"];\r\n        let drawPile = actor.drawPile || [];\r\n\r\n        // Look for items/apparel matching the type\r\n        let typeMatch = type === \"attack\"\r\n            ? c => c.type === \"item\" && (c.subtype === \"weapon\" || c.atk > 0)\r\n            : c => (c.type === \"item\" || c.type === \"apparel\") && (c.subtype === \"armor\" || c.def > 0);\r\n\r\n        for (let rarity of rarityOrder) {\r\n            let candidates = drawPile.filter(c =>\r\n                c.rarity === rarity && typeMatch(c)\r\n            );\r\n            if (candidates.length > 0) {\r\n                let reward = { ...candidates[Math.floor(Math.random() * candidates.length)] };\r\n                // Remove from draw pile\r\n                let idx = drawPile.findIndex(c => c.name === reward.name);\r\n                if (idx >= 0) drawPile.splice(idx, 1);\r\n\r\n                reward.id = \"crit-reward-\" + Date.now();\r\n                reward.isCriticalReward = true;\r\n                console.log(\"[CardGame v2] Critical reward from deck:\", reward.name);\r\n                return reward;\r\n            }\r\n        }\r\n\r\n        // Fallback: generate a simple stat bonus consumable\r\n        let bonus = type === \"attack\"\r\n            ? { type: \"item\", subtype: \"consumable\", name: \"Critical Bonus\", atk: 3, rarity: \"RARE\",\r\n                effect: \"+3 ATK this round\" }\r\n            : { type: \"item\", subtype: \"consumable\", name: \"Critical Bonus\", def: 3, rarity: \"RARE\",\r\n                effect: \"+3 DEF this round\" };\r\n\r\n        bonus.id = \"crit-reward-\" + Date.now();\r\n        bonus.isCriticalReward = true;\r\n        console.log(\"[CardGame v2] Critical reward (fallback):\", bonus.name);\r\n        return bonus;\r\n    }\r\n\r\n    //  Threat Encounter Creation \r\n\r\n    /**\r\n     * Create a threat encounter based on difficulty\r\n     * @param {number} difficulty - Threat difficulty (affects stats and loot)\r\n     * @returns {Object} Threat encounter object\r\n     */\r\n    function createThreatEncounter(difficulty) {\r\n        let creatures = getThreatCreatures();\r\n        // Pick a creature based on difficulty\r\n        let creatureIdx = Math.min(Math.floor(difficulty / 2), creatures.length - 1);\r\n        let base = creatures[creatureIdx];\r\n\r\n        // Scale stats based on difficulty\r\n        let scaleFactor = 1 + (difficulty - 4) * 0.1;\r\n        let threat = {\r\n            type: \"encounter\",\r\n            subtype: \"threat\",\r\n            name: base.name,\r\n            difficulty: difficulty,\r\n            atk: Math.round(base.atk * scaleFactor),\r\n            def: Math.round(base.def * scaleFactor),\r\n            hp: Math.round(base.hp * scaleFactor),\r\n            maxHp: Math.round(base.hp * scaleFactor),\r\n            imageIcon: base.imageIcon,\r\n            isThreat: true\r\n        };\r\n\r\n        // Determine loot rarity based on difficulty\r\n        if (difficulty <= 4) {\r\n            threat.lootRarity = \"COMMON\";\r\n            threat.lootCount = 1;\r\n        } else if (difficulty <= 8) {\r\n            threat.lootRarity = \"UNCOMMON\";\r\n            threat.lootCount = 1;\r\n        } else {\r\n            threat.lootRarity = \"RARE\";\r\n            threat.lootCount = 2;  // 1 rare + 1 common\r\n        }\r\n\r\n        return threat;\r\n    }\r\n\r\n    //  Beginning Threat Checks \r\n\r\n    /**\r\n     * Check for Nat 1 on initiative and create beginning threats\r\n     * @param {Object} state - The current game state\r\n     * @returns {Array} Array of threat objects with target info\r\n     */\r\n    function checkNat1Threats(state) {\r\n        if (!state || !state.initiative) return [];\r\n\r\n        let threats = [];\r\n        let difficulty = state.round + 2;  // Beginning threat difficulty = round + 2\r\n\r\n        // Check player for Nat 1\r\n        if (state.initiative.playerRoll && state.initiative.playerRoll.raw === 1) {\r\n            let threat = createThreatEncounter(difficulty);\r\n            threat.target = \"player\";  // Threat attacks the fumbler\r\n            threats.push(threat);\r\n            console.log(\"[CardGame v2] BEGINNING THREAT! Player rolled Nat 1 - spawning\", threat.name);\r\n        }\r\n\r\n        // Check opponent for Nat 1\r\n        if (state.initiative.opponentRoll && state.initiative.opponentRoll.raw === 1) {\r\n            let threat = createThreatEncounter(difficulty);\r\n            threat.target = \"opponent\";  // Threat attacks the fumbler\r\n            threats.push(threat);\r\n            console.log(\"[CardGame v2] BEGINNING THREAT! Opponent rolled Nat 1 - spawning\", threat.name);\r\n        }\r\n\r\n        // Max 2 beginning threats (one per player Nat 1)\r\n        return threats.slice(0, 2);\r\n    }\r\n\r\n    /**\r\n     * Store beginning threats for THREAT_RESPONSE phase\r\n     * (No longer inserts into action bar - combat handled in separate phase)\r\n     * @param {Object} state - The current game state\r\n     * @param {Array} threats - Array of threat objects\r\n     */\r\n    function insertBeginningThreats(state, threats) {\r\n        if (!state || !threats || threats.length === 0) return;\r\n\r\n        // Store threats for THREAT_RESPONSE phase\r\n        state.beginningThreats = threats;\r\n\r\n        console.log(\"[CardGame v2] Beginning threats queued for response phase:\", threats.length, \"threats\");\r\n    }\r\n\r\n    //  Scenario Card Drawing \r\n\r\n    /**\r\n     * Draw a scenario card using weighted random selection\r\n     * @returns {Object} Selected scenario card\r\n     */\r\n    function drawScenarioCard() {\r\n        let cards = getScenarioCards();\r\n        let totalWeight = cards.reduce((sum, card) => sum + card.weight, 0);\r\n        let roll = Math.random() * totalWeight;\r\n        let cumulative = 0;\r\n\r\n        for (let card of cards) {\r\n            cumulative += card.weight;\r\n            if (roll <= cumulative) {\r\n                return { ...card };\r\n            }\r\n        }\r\n        return { ...cards[0] };  // Fallback\r\n    }\r\n\r\n    //  End-of-Round Threat Check \r\n\r\n    /**\r\n     * Check for end-of-round threat from scenario card\r\n     * @param {Object} state - The current game state\r\n     * @returns {Object|null} End threat info or null if no threat\r\n     */\r\n    function checkEndThreat(state) {\r\n        let scenario = drawScenarioCard();\r\n        console.log(\"[CardGame v2] Scenario card drawn:\", scenario.name);\r\n\r\n        if (scenario.effect === \"threat\") {\r\n            let difficulty = state.round + 3 + (scenario.threatBonus || 0);\r\n            let threat = createThreatEncounter(difficulty);\r\n            // End threats target the round loser (or random on tie)\r\n            if (state.roundWinner === \"tie\") {\r\n                threat.target = Math.random() < 0.5 ? \"player\" : \"opponent\";\r\n            } else {\r\n                threat.target = state.roundWinner === \"player\" ? \"opponent\" : \"player\";\r\n            }\r\n            return {\r\n                scenario: scenario,\r\n                threat: threat\r\n            };\r\n        }\r\n\r\n        return { scenario: scenario, threat: null };\r\n    }\r\n\r\n    //  Export \r\n    Object.assign(window.CardGame.Engine, {\r\n        loadBalanceData,\r\n        getThreatCreatures,\r\n        getScenarioCards,\r\n        THREAT_CREATURES,\r\n        SCENARIO_CARDS,\r\n        generateCriticalReward,\r\n        createThreatEncounter,\r\n        checkNat1Threats,\r\n        insertBeginningThreats,\r\n        drawScenarioCard,\r\n        checkEndThreat\r\n    });\r\n\r\n    console.log('[CardGame] Engine/encounters loaded');\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/engine/actions.js === */\n/**\r\n * CardGame Engine - Action Resolution\r\n * Pot system (ante/claim), hoarding prevention (lethargy/exhausted),\r\n * card drawing, action bar placement/removal, and initial stack dealing.\r\n *\r\n * Depends on: CardGame.Constants (GAME_PHASES), CardGame.Engine (effects, combat, encounters)\r\n * Exposes: window.CardGame.Engine.{anteCard, claimPot, addToPot,\r\n *   checkLethargy, checkExhausted,\r\n *   drawCardsForActor, ensureOffensiveCard,\r\n *   isCoreCardType, isModifierCardType, placeCard, removeCardFromPosition,\r\n *   dealInitialStack, shuffle}\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.Engine = window.CardGame.Engine || {};\r\n\r\n    const C = window.CardGame.Constants;\r\n\r\n    //  Array Shuffle (Fisher-Yates) \r\n    function shuffle(arr) {\r\n        let a = arr.slice();\r\n        for (let i = a.length - 1; i > 0; i--) {\r\n            let j = Math.floor(Math.random() * (i + 1));\r\n            [a[i], a[j]] = [a[j], a[i]];\r\n        }\r\n        return a;\r\n    }\r\n\r\n    //  Pot System \r\n\r\n    // Ante: Each player puts a random card from hand into the pot\r\n    function anteCard(state, actor, actorName) {\r\n        if (!actor.hand || actor.hand.length === 0) {\r\n            console.log(\"[CardGame v2]\", actorName, \"has no cards to ante\");\r\n            return null;\r\n        }\r\n        // Pick a random card from hand\r\n        let idx = Math.floor(Math.random() * actor.hand.length);\r\n        let card = actor.hand.splice(idx, 1)[0];\r\n        state.pot.push(card);\r\n        console.log(\"[CardGame v2]\", actorName, \"anted\", card.name, \"to pot\");\r\n        return card;\r\n    }\r\n\r\n    // Round winner claims all cards in the pot\r\n    function claimPot(state, winner) {\r\n        if (!state.pot || state.pot.length === 0) return;\r\n        let winnerActor = winner === \"player\" ? state.player : state.opponent;\r\n        state.pot.forEach(card => {\r\n            winnerActor.discardPile.push(card);\r\n        });\r\n        console.log(\"[CardGame v2]\", winner, \"claimed pot with\", state.pot.length, \"cards\");\r\n        state.pot = [];\r\n    }\r\n\r\n    // Add a card to the pot (for mid-round drops)\r\n    function addToPot(state, card, reason) {\r\n        if (!card) return;\r\n        state.pot.push(card);\r\n        console.log(\"[CardGame v2] Added\", card.name, \"to pot (\" + reason + \")\");\r\n    }\r\n\r\n    //  Hoarding Prevention \r\n\r\n    /**\r\n     * Lethargy Check (at cleanup)\r\n     * If actor holds 2+ copies of the same action type and played 0 this round,\r\n     * keep 1 copy and return the rest to the encounter deck.\r\n     * @param {Object} state - The current game state\r\n     * @param {Object} actor - The actor to check\r\n     * @param {string} actorName - Display name for logging\r\n     * @returns {Array} Array of {actionType, stripped} objects\r\n     */\r\n    function checkLethargy(state, actor, actorName) {\r\n        if (!actor.hand || actor.hand.length === 0) return [];\r\n\r\n        let typesPlayed = actor.typesPlayedThisRound || {};\r\n        let results = [];\r\n\r\n        // Count action cards by name (only action type cards)\r\n        let actionCounts = {};\r\n        actor.hand.forEach(card => {\r\n            if (card.type === \"action\") {\r\n                let key = card.name;\r\n                actionCounts[key] = (actionCounts[key] || 0) + 1;\r\n            }\r\n        });\r\n\r\n        // Check each action type with 2+ copies\r\n        Object.keys(actionCounts).forEach(actionType => {\r\n            let count = actionCounts[actionType];\r\n            let played = typesPlayed[actionType] || 0;\r\n\r\n            // Lethargy: 2+ copies AND 0 played this round\r\n            if (count >= 2 && played === 0) {\r\n                let stripped = count - 1;  // Keep 1, strip the rest\r\n                let removed = 0;\r\n\r\n                // Remove extras from hand and add to encounter deck\r\n                for (let i = actor.hand.length - 1; i >= 0 && removed < stripped; i--) {\r\n                    let card = actor.hand[i];\r\n                    if (card.type === \"action\" && card.name === actionType) {\r\n                        actor.hand.splice(i, 1);\r\n                        // Return to encounter deck\r\n                        if (state.encounterDeck) {\r\n                            state.encounterDeck.push(card);\r\n                        }\r\n                        removed++;\r\n                    }\r\n                }\r\n\r\n                if (removed > 0) {\r\n                    results.push({ actionType, stripped: removed });\r\n                    console.log(\"[CardGame v2] LETHARGY:\", actorName, \"- stripped\", removed, actionType, \"card(s)\");\r\n                }\r\n            }\r\n        });\r\n\r\n        // Shuffle encounter deck after adding cards\r\n        if (results.length > 0 && state.encounterDeck) {\r\n            state.encounterDeck = shuffle(state.encounterDeck);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Exhausted Check (during resolution)\r\n     * If actor played 2+ of a type this round, last one failed, and holds 2+ extras in hand,\r\n     * keep 1 extra and return the rest to encounter deck.\r\n     * @param {Object} state - The current game state\r\n     * @param {Object} actor - The actor to check\r\n     * @param {string} actorName - Display name for logging\r\n     * @param {string} failedActionType - The action type that failed\r\n     * @returns {Object|null} { actionType, stripped } or null if no trigger\r\n     */\r\n    function checkExhausted(state, actor, actorName, failedActionType) {\r\n        if (!actor.hand || !failedActionType) return null;\r\n\r\n        let typesPlayed = actor.typesPlayedThisRound || {};\r\n        let playedCount = typesPlayed[failedActionType] || 0;\r\n\r\n        // Must have played 2+ of this type\r\n        if (playedCount < 2) return null;\r\n\r\n        // Count how many of this type remain in hand\r\n        let handCount = actor.hand.filter(c => c.type === \"action\" && c.name === failedActionType).length;\r\n\r\n        // Exhausted: played 2+, failed, and hold 2+ extras in hand\r\n        if (handCount >= 2) {\r\n            let stripped = handCount - 1;  // Keep 1, strip the rest\r\n            let removed = 0;\r\n\r\n            for (let i = actor.hand.length - 1; i >= 0 && removed < stripped; i--) {\r\n                let card = actor.hand[i];\r\n                if (card.type === \"action\" && card.name === failedActionType) {\r\n                    actor.hand.splice(i, 1);\r\n                    if (state.encounterDeck) {\r\n                        state.encounterDeck.push(card);\r\n                    }\r\n                    removed++;\r\n                }\r\n            }\r\n\r\n            if (removed > 0) {\r\n                // Shuffle encounter deck\r\n                if (state.encounterDeck) {\r\n                    state.encounterDeck = shuffle(state.encounterDeck);\r\n                }\r\n                console.log(\"[CardGame v2] EXHAUSTED:\", actorName, \"- stripped\", removed, failedActionType, \"card(s)\");\r\n                return { actionType: failedActionType, stripped: removed };\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    //  Draw Cards Helper \r\n    function drawCardsForActor(actor, count) {\r\n        for (let i = 0; i < count; i++) {\r\n            // If draw pile empty, shuffle discard into draw\r\n            if (actor.drawPile.length === 0 && actor.discardPile.length > 0) {\r\n                actor.drawPile = shuffle([...actor.discardPile]);\r\n                actor.discardPile = [];\r\n                console.log(\"[CardGame v2] Reshuffled discard pile into draw pile\");\r\n            }\r\n\r\n            if (actor.drawPile.length > 0) {\r\n                let card = actor.drawPile.shift();\r\n                actor.hand.push(card);\r\n                console.log(\"[CardGame v2] Drew card:\", card.name);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Ensure actor has at least one offensive card (Attack) in hand.\r\n     * If not, find one from draw/discard pile or create a basic Attack.\r\n     */\r\n    function ensureOffensiveCard(actor, actorName) {\r\n        // Check if hand already has an Attack card\r\n        let hasAttack = actor.hand.some(c => c.type === \"action\" && c.name === \"Attack\");\r\n        if (hasAttack) return;\r\n\r\n        // Try to find Attack in draw pile\r\n        let attackIdx = actor.drawPile.findIndex(c => c.type === \"action\" && c.name === \"Attack\");\r\n        if (attackIdx >= 0) {\r\n            let attackCard = actor.drawPile.splice(attackIdx, 1)[0];\r\n            actor.hand.push(attackCard);\r\n            console.log(\"[CardGame v2]\", actorName, \"guaranteed Attack card from draw pile\");\r\n            return;\r\n        }\r\n\r\n        // Try discard pile\r\n        attackIdx = actor.discardPile.findIndex(c => c.type === \"action\" && c.name === \"Attack\");\r\n        if (attackIdx >= 0) {\r\n            let attackCard = actor.discardPile.splice(attackIdx, 1)[0];\r\n            actor.hand.push(attackCard);\r\n            console.log(\"[CardGame v2]\", actorName, \"guaranteed Attack card from discard pile\");\r\n            return;\r\n        }\r\n\r\n        // Last resort: create a basic Attack card\r\n        let basicAttack = {\r\n            type: \"action\",\r\n            name: \"Attack\",\r\n            effect: \"Roll ATK vs DEF. Deal STR damage on hit.\",\r\n            rarity: \"COMMON\"\r\n        };\r\n        actor.hand.push(basicAttack);\r\n        console.log(\"[CardGame v2]\", actorName, \"granted basic Attack card (none in deck)\");\r\n    }\r\n\r\n    //  Placement Actions \r\n\r\n    // Determine if a card type can be a core card (action that drives the stack)\r\n    function isCoreCardType(cardType) {\r\n        return cardType === \"action\" || cardType === \"talk\" || cardType === \"magic\";\r\n    }\r\n\r\n    // Determine if a card type can be a modifier (stacks on top of core)\r\n    // Note: magic is NOT a modifier - it's a core action like attack/talk\r\n    function isModifierCardType(cardType) {\r\n        return cardType === \"skill\" || cardType === \"item\";\r\n    }\r\n\r\n    function placeCard(state, positionIndex, card, forceModifier) {\r\n        if (!state) return false;\r\n        if (state.phase !== C.GAME_PHASES.DRAW_PLACEMENT) return false;\r\n        forceModifier = forceModifier || false;\r\n\r\n        let pos = state.actionBar.positions.find(p => p.index === positionIndex);\r\n        if (!pos) return false;\r\n\r\n        // Check ownership\r\n        let currentPlayer = state.currentTurn;\r\n        if (pos.owner !== currentPlayer) {\r\n            console.warn(\"[CardGame v2] Cannot place on opponent's position\");\r\n            return false;\r\n        }\r\n\r\n        let actor = currentPlayer === \"player\" ? state.player : state.opponent;\r\n\r\n        // Determine if this card should be a modifier or core\r\n        let isModifier = forceModifier;\r\n        let hasExistingCore = pos.stack && pos.stack.coreCard;\r\n\r\n        if (!forceModifier && hasExistingCore) {\r\n            // Position already has a core card\r\n            // Core action types (action, talk, magic) cannot be stacked - reject them\r\n            if (card.type === \"action\" || card.type === \"talk\" || card.type === \"magic\") {\r\n                console.warn(\"[CardGame v2] Cannot stack multiple action cards - position already has:\", pos.stack.coreCard.name);\r\n                if (typeof page !== \"undefined\" && page.toast) page.toast(\"warn\", \"Position already has an action card\");\r\n                return false;\r\n            } else if (isModifierCardType(card.type)) {\r\n                // Modifiers (skill, item) can be added to existing stack\r\n                isModifier = true;\r\n            } else {\r\n                console.warn(\"[CardGame v2] Position already has a core card, and\", card.type, \"cannot be a modifier\");\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // Double-check stack state after potential removal\r\n        if (!isModifier && pos.stack && pos.stack.coreCard) {\r\n            console.error(\"[CardGame v2] Stack still has core card after removal - blocking duplicate\");\r\n            return false;\r\n        }\r\n\r\n        if (isModifier) {\r\n            // Add modifier to existing stack (no AP cost for modifiers)\r\n            if (!pos.stack || !pos.stack.coreCard) {\r\n                console.warn(\"[CardGame v2] No core card to modify - place an action first\");\r\n                return false;\r\n            }\r\n            pos.stack.modifiers.push(card);\r\n            console.log(\"[CardGame v2] Added modifier\", card.name, \"to stack at position\", positionIndex);\r\n        } else {\r\n            // Place core card (action/talk/magic)\r\n            if (!isCoreCardType(card.type)) {\r\n                // Skill dropped on empty slot - can't be core\r\n                console.warn(\"[CardGame v2]\", card.type, \"cards need an action card first\");\r\n                return false;\r\n            }\r\n\r\n            // Check AP for core cards\r\n            if (actor.apUsed >= actor.ap) {\r\n                console.warn(\"[CardGame v2] No AP remaining\");\r\n                return false;\r\n            }\r\n\r\n            // Check energy cost\r\n            if (card.energyCost && card.energyCost > actor.energy) {\r\n                console.warn(\"[CardGame v2] Not enough energy for\", card.name);\r\n                return false;\r\n            }\r\n\r\n            pos.stack = { coreCard: card, modifiers: [] };\r\n            actor.apUsed++;\r\n\r\n            // Deduct energy if needed\r\n            if (card.energyCost) {\r\n                actor.energy -= card.energyCost;\r\n            }\r\n\r\n            // Track action type for hoarding prevention (Lethargy/Exhausted)\r\n            let actionKey = card.name;  // Use card name as the action type key\r\n            if (!actor.typesPlayedThisRound) actor.typesPlayedThisRound = {};\r\n            actor.typesPlayedThisRound[actionKey] = (actor.typesPlayedThisRound[actionKey] || 0) + 1;\r\n\r\n            console.log(\"[CardGame v2] Placed core card\", card.name, \"at position\", positionIndex);\r\n        }\r\n\r\n        // Remove card from hand\r\n        if (currentPlayer === \"player\") {\r\n            let idx = state.player.hand.findIndex(c => c === card || (c.name === card.name && c.type === card.type));\r\n            if (idx >= 0) state.player.hand.splice(idx, 1);\r\n        }\r\n\r\n        m.redraw();\r\n        // Player manually ends turn - no auto-commit\r\n        return true;\r\n    }\r\n\r\n    function removeCardFromPosition(state, positionIndex, skipRedraw) {\r\n        if (!state) return false;\r\n        if (state.phase !== C.GAME_PHASES.DRAW_PLACEMENT) return false;\r\n        skipRedraw = skipRedraw || false;\r\n\r\n        let pos = state.actionBar.positions.find(p => p.index === positionIndex);\r\n        if (!pos || !pos.stack) return false;\r\n\r\n        let currentPlayer = state.currentTurn;\r\n        if (pos.owner !== currentPlayer) return false;\r\n\r\n        let actor = currentPlayer === \"player\" ? state.player : state.opponent;\r\n\r\n        // Return cards to hand and refund costs\r\n        if (pos.stack.coreCard) {\r\n            actor.hand.push(pos.stack.coreCard);\r\n            actor.apUsed = Math.max(0, actor.apUsed - 1);\r\n\r\n            // Refund energy cost\r\n            if (pos.stack.coreCard.energyCost) {\r\n                actor.energy = Math.min(actor.maxEnergy, actor.energy + pos.stack.coreCard.energyCost);\r\n            }\r\n\r\n            // Remove from types played tracking\r\n            let actionKey = pos.stack.coreCard.name;\r\n            if (actor.typesPlayedThisRound && actor.typesPlayedThisRound[actionKey]) {\r\n                actor.typesPlayedThisRound[actionKey]--;\r\n                if (actor.typesPlayedThisRound[actionKey] <= 0) {\r\n                    delete actor.typesPlayedThisRound[actionKey];\r\n                }\r\n            }\r\n\r\n            console.log(\"[CardGame v2] Removed\", pos.stack.coreCard.name, \"from position\", positionIndex);\r\n        }\r\n\r\n        // Return modifiers to hand\r\n        pos.stack.modifiers.forEach(mod => actor.hand.push(mod));\r\n\r\n        pos.stack = null;\r\n        if (!skipRedraw) m.redraw();\r\n        return true;\r\n    }\r\n\r\n    //  Deal Initial Stack \r\n    // Deal initial modifier cards to character stack (weapon + armor + apparel)\r\n    function dealInitialStack(apparelCards, itemCards) {\r\n        let stack = [];\r\n\r\n        // 1. Always add a weapon - find one from deck or create basic\r\n        let weapons = itemCards.filter(i => i.subtype === \"weapon\");\r\n        if (weapons.length > 0) {\r\n            stack.push(shuffle([...weapons])[0]);\r\n        } else {\r\n            stack.push({\r\n                type: \"item\", subtype: \"weapon\", name: \"Basic Blade\",\r\n                slot: \"Hand (1H)\", rarity: \"COMMON\", atk: 2, range: \"Melee\",\r\n                damageType: \"Slashing\", effect: \"+2 ATK\"\r\n            });\r\n        }\r\n\r\n        // 2. Always add armor - find one from deck or create basic\r\n        let armors = itemCards.filter(i => i.subtype === \"armor\");\r\n        if (armors.length > 0) {\r\n            stack.push(shuffle([...armors])[0]);\r\n        } else {\r\n            stack.push({\r\n                type: \"item\", subtype: \"armor\", name: \"Basic Armor\",\r\n                slot: \"Body\", rarity: \"COMMON\", def: 2,\r\n                effect: \"+2 DEF\"\r\n            });\r\n        }\r\n\r\n        // 3. Add 1 random apparel card if available, or basic garb\r\n        if (apparelCards.length > 0) {\r\n            let shuffledApparel = shuffle([...apparelCards]);\r\n            stack.push(shuffledApparel[0]);\r\n        } else {\r\n            stack.push({ type: \"apparel\", name: \"Basic Garb\", slot: \"Body\", def: 1, effect: \"+1 DEF\" });\r\n        }\r\n\r\n        console.log(\"[CardGame v2] Initial card stack:\", stack.map(c => c.name));\r\n        return stack;\r\n    }\r\n\r\n    //  Export \r\n    Object.assign(window.CardGame.Engine, {\r\n        anteCard,\r\n        claimPot,\r\n        addToPot,\r\n        checkLethargy,\r\n        checkExhausted,\r\n        drawCardsForActor,\r\n        ensureOffensiveCard,\r\n        isCoreCardType,\r\n        isModifierCardType,\r\n        placeCard,\r\n        removeCardFromPosition,\r\n        dealInitialStack,\r\n        shuffle\r\n    });\r\n\r\n    console.log('[CardGame] Engine/actions loaded');\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/state/gameState.js === */\n/**\r\n * CardGame State - Game State Creation & Phase Management\r\n * Manages game state lifecycle: creation, phase transitions, initiative,\r\n * threat combat, resolution, narration, and round management.\r\n *\r\n * Extracted from the monolithic cardGame-v2.js.\r\n *\r\n * Dependencies (loaded before this module):\r\n *   - CardGame.Constants   (GAME_PHASES, STATUS_EFFECTS)\r\n *   - CardGame.Engine      (combat: rollD20, rollInitiative, rollAttack, rollDefense,\r\n *                           getCombatOutcome, calculateDamage, applyDamage, resolveCombat,\r\n *                           getStackSkillMod)\r\n *   - CardGame.Engine      (effects: applyStatusEffect, tickStatusEffects,\r\n *                           processStatusEffectsTurnStart, parseEffect, applyParsedEffects)\r\n *   - CardGame.Engine      (encounters: checkNat1Threats, insertBeginningThreats)\r\n *   - CardGame.Engine      (actions: drawCardsForActor, ensureOffensiveCard, dealInitialStack,\r\n *                           checkExhausted, checkGameOver, anteCard)\r\n *   - CardGame.Characters  (shuffle)\r\n *   - CardGame.AI          (CardGameDirector, CardGameNarrator, aiPlaceCards)\r\n *   - CardGame.AI          (ChatManager, Voice  may not be extracted yet)\r\n *   - CardGame.Themes      (getActiveTheme)\r\n *   - CardGame.Storage     (campaignStorage)\r\n *   - AM7 globals: m, g_application_path, page\r\n *\r\n * Exposes: window.CardGame.GameState\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.GameState = window.CardGame.GameState || {};\r\n\r\n    //  Shorthand references to sibling modules \r\n    // These resolve at call-time so load order only matters for the IIFE body.\r\n    const C  = () => window.CardGame.Constants;\r\n    const E  = () => window.CardGame.Engine;\r\n    const Ch = () => window.CardGame.Characters;\r\n    const AI = () => window.CardGame.AI;\r\n    const Th = () => window.CardGame.Themes;\r\n    const St = () => window.CardGame.Storage;\r\n\r\n    //  LLM Connectivity \r\n    let llmStatus = { checked: false, available: false, error: null };\r\n\r\n    async function checkLlmConnectivity() {\r\n        llmStatus = { checked: false, available: false, error: null };\r\n        m.redraw();\r\n        try {\r\n            // Test LLM connectivity by fetching chat prompt endpoint\r\n            let response = await m.request({\r\n                method: 'GET',\r\n                url: g_application_path + \"/rest/chat/prompt\",\r\n                withCredentials: true\r\n            });\r\n            llmStatus = { checked: true, available: true, error: null };\r\n            console.log(\"[CardGame v2] LLM connectivity check passed\");\r\n        } catch (err) {\r\n            llmStatus = { checked: true, available: false, error: err.message || \"LLM service unavailable\" };\r\n            console.warn(\"[CardGame v2] LLM connectivity check failed:\", err);\r\n        }\r\n        m.redraw();\r\n        return llmStatus.available;\r\n    }\r\n\r\n    //  Game State Model \r\n    let gameState = null;  // null when not in game\r\n    let gameCharSelection = null;  // { characters: [], selected: null } when picking character\r\n\r\n    //  Initiative Animation State \r\n    let initAnimState = {\r\n        countdown: 3,           // Countdown from 3\r\n        rolling: false,         // Whether dice are animating\r\n        rollComplete: false,    // Whether final roll is shown\r\n        playerDiceFace: 1,      // Current displayed face during animation\r\n        opponentDiceFace: 1,\r\n        animInterval: null      // Animation interval ID\r\n    };\r\n\r\n    function resetInitAnimState() {\r\n        if (initAnimState.animInterval) clearInterval(initAnimState.animInterval);\r\n        initAnimState = {\r\n            countdown: 3,\r\n            rolling: false,\r\n            rollComplete: false,\r\n            playerDiceFace: 1,\r\n            opponentDiceFace: 1,\r\n            animInterval: null\r\n        };\r\n    }\r\n\r\n    function startInitiativeAnimation() {\r\n        resetInitAnimState();\r\n\r\n        // Start countdown\r\n        let countdownInterval = setInterval(() => {\r\n            initAnimState.countdown--;\r\n            m.redraw();\r\n\r\n            if (initAnimState.countdown <= 0) {\r\n                clearInterval(countdownInterval);\r\n                // Start dice rolling animation\r\n                initAnimState.rolling = true;\r\n                initAnimState.animInterval = setInterval(() => {\r\n                    initAnimState.playerDiceFace = Math.floor(Math.random() * 20) + 1;\r\n                    initAnimState.opponentDiceFace = Math.floor(Math.random() * 20) + 1;\r\n                    m.redraw();\r\n                }, 80);\r\n\r\n                // After 2 seconds of rolling, show final result\r\n                setTimeout(() => {\r\n                    clearInterval(initAnimState.animInterval);\r\n                    initAnimState.rolling = false;\r\n                    initAnimState.rollComplete = true;\r\n                    runInitiativePhase();  // Actually compute the roll\r\n                    m.redraw();\r\n                }, 2000);\r\n            }\r\n        }, 1000);\r\n    }\r\n\r\n    //  Game State Creation \r\n    function createGameState(deck, selectedCharacter) {\r\n        const shuffle = Ch().shuffle;\r\n        const dealInitialStack = E().dealInitialStack;\r\n        const ensureOffensiveCard = E().ensureOffensiveCard;\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n\r\n        // Use selected character or find first one\r\n        let cards = deck.cards || [];\r\n        let allCharacters = cards.filter(c => c.type === \"character\");\r\n        let playerCharCard = selectedCharacter || allCharacters[0];\r\n\r\n        if (!playerCharCard) {\r\n            console.error(\"[CardGame v2] No character card found in deck\");\r\n            return null;\r\n        }\r\n\r\n        // Pick an opponent from remaining characters, or create a generic one\r\n        let otherChars = allCharacters.filter(c => c !== playerCharCard);\r\n        let opponentCharCard = otherChars.length > 0\r\n            ? otherChars[Math.floor(Math.random() * otherChars.length)]\r\n            : null;\r\n\r\n        // Calculate initial AP from END: floor(END/5) + 1, minimum 2 AP\r\n        // Check for both uppercase and lowercase stat names, with proper numeric validation\r\n        let playerStats = playerCharCard.stats || {};\r\n        let rawPlayerEnd = playerStats.END ?? playerStats.end ?? playerStats.endurance;\r\n        let playerEnd = (typeof rawPlayerEnd === \"number\" && rawPlayerEnd > 0) ? rawPlayerEnd : 12;  // Default 12 = 3 AP\r\n        let playerAp = Math.max(2, Math.floor(playerEnd / 5) + 1);  // Minimum 2 AP for playability\r\n\r\n        // Calculate initial energy from MAG\r\n        let rawPlayerMag = playerStats.MAG ?? playerStats.mag ?? playerStats.magic;\r\n        let playerMag = (typeof rawPlayerMag === \"number\" && rawPlayerMag > 0) ? rawPlayerMag : 12;\r\n\r\n        console.log(\"[CardGame v2] Player character:\", playerCharCard.name, \"raw stats:\", JSON.stringify(playerStats));\r\n        console.log(\"[CardGame v2] Player END:\", playerEnd, \"(raw:\", rawPlayerEnd, \")  AP:\", playerAp, \"| MAG:\", playerMag);\r\n\r\n        // Opponent stats - use actual opponent character if available\r\n        let opponentStats = opponentCharCard\r\n            ? Object.assign({}, opponentCharCard.stats || {})\r\n            : Object.assign({}, playerStats);\r\n        let rawOppEnd = opponentStats.END ?? opponentStats.end ?? opponentStats.endurance;\r\n        let opponentEnd = (typeof rawOppEnd === \"number\" && rawOppEnd > 0) ? rawOppEnd : 12;\r\n        let opponentAp = Math.max(2, Math.floor(opponentEnd / 5) + 1);  // Minimum 2 AP\r\n        let rawOppMag = opponentStats.MAG ?? opponentStats.mag ?? opponentStats.magic;\r\n        let opponentMag = (typeof rawOppMag === \"number\" && rawOppMag > 0) ? rawOppMag : 12;\r\n\r\n        console.log(\"[CardGame v2] Opponent END:\", opponentEnd, \"(raw:\", rawOppEnd, \")  AP:\", opponentAp, \"| MAG:\", opponentMag);\r\n\r\n        // Separate cards by type (cards already defined above)\r\n        let actionCards = cards.filter(c => c.type === \"action\");\r\n        let talkCards = cards.filter(c => c.type === \"talk\");\r\n        let itemCards = shuffle(cards.filter(c => c.type === \"item\"));\r\n        let apparelCards = shuffle(cards.filter(c => c.type === \"apparel\"));\r\n        let skillCards = cards.filter(c => c.type === \"skill\");\r\n        let magicCards = cards.filter(c => c.type === \"magic\");\r\n        let encounterCards = cards.filter(c => c.type === \"encounter\");\r\n\r\n        // Split items and apparel for player vs opponent (so they get different equipment)\r\n        let itemMid = Math.ceil(itemCards.length / 2);\r\n        let apparelMid = Math.ceil(apparelCards.length / 2);\r\n        let playerItems = itemCards.slice(0, itemMid);\r\n        let opponentItems = itemCards.slice(itemMid);\r\n        let playerApparel = apparelCards.slice(0, apparelMid);\r\n        let opponentApparel = apparelCards.slice(apparelMid);\r\n\r\n        // Create playable card pool (actions, skills, magic, talk)\r\n        let playableCards = [...actionCards, ...talkCards, ...skillCards, ...magicCards];\r\n\r\n        console.log(\"[CardGame v2] Card counts - action:\", actionCards.length,\r\n            \"talk:\", talkCards.length, \"skill:\", skillCards.length,\r\n            \"magic:\", magicCards.length, \"playable total:\", playableCards.length);\r\n\r\n        // If deck has no playable cards, create basic cards\r\n        if (playableCards.length === 0) {\r\n            console.log(\"[CardGame v2] No playable cards in deck, using default starter cards\");\r\n            playableCards = [\r\n                { type: \"action\", name: \"Attack\", actionType: \"Offensive\", energyCost: 0 },\r\n                { type: \"action\", name: \"Attack\", actionType: \"Offensive\", energyCost: 0 },\r\n                { type: \"action\", name: \"Guard\", actionType: \"Defensive\", energyCost: 0 },\r\n                { type: \"action\", name: \"Guard\", actionType: \"Defensive\", energyCost: 0 },\r\n                { type: \"action\", name: \"Rest\", actionType: \"Recovery\", energyCost: 0 },\r\n                { type: \"action\", name: \"Rest\", actionType: \"Recovery\", energyCost: 0 },\r\n                { type: \"action\", name: \"Feint\", actionType: \"Utility\", energyCost: 0 },\r\n                { type: \"talk\", name: \"Taunt\", speechType: \"Provoke\", energyCost: 0 },\r\n                { type: \"talk\", name: \"Persuade\", speechType: \"Charm\", energyCost: 0 }\r\n            ];\r\n        }\r\n\r\n        // Create draw piles for both sides (shuffle and split)\r\n        let shuffledPool = shuffle([...playableCards, ...playableCards]); // Double the pool\r\n        let midPoint = Math.floor(shuffledPool.length / 2);\r\n        let playerDrawPile = shuffledPool.slice(0, midPoint);\r\n        let opponentDrawPile = shuffledPool.slice(midPoint);\r\n\r\n        // Deal initial hands (5 cards each)\r\n        let initialHandSize = 5;\r\n        let playerHand = playerDrawPile.splice(0, initialHandSize);\r\n        let opponentHand = opponentDrawPile.splice(0, initialHandSize);\r\n\r\n        console.log(\"[CardGame v2] Initial hands dealt - player:\", playerHand.length, \"opponent:\", opponentHand.length);\r\n        console.log(\"[CardGame v2] Player hand:\", playerHand.map(c => c.name));\r\n        console.log(\"[CardGame v2] Draw piles - player:\", playerDrawPile.length, \"opponent:\", opponentDrawPile.length);\r\n\r\n        let state = {\r\n            // Meta\r\n            deckName: deck.deckName,\r\n            themeId: deck.themeId,\r\n            startedAt: Date.now(),\r\n\r\n            // Round tracking\r\n            round: 1,\r\n            phase: GAME_PHASES.INITIATIVE,\r\n\r\n            // Initiative\r\n            initiative: {\r\n                playerRoll: null,      // { raw, modifier, total }\r\n                opponentRoll: null,\r\n                winner: null,          // \"player\" | \"opponent\"\r\n                playerPositions: [],   // [1,3,5,...] or [2,4,6,...]\r\n                opponentPositions: []\r\n            },\r\n\r\n            // Action Bar\r\n            actionBar: {\r\n                totalPositions: 0,\r\n                positions: [],  // [{ owner, stack, resolved }]\r\n                resolveIndex: -1  // current resolution position (-1 = not started)\r\n            },\r\n\r\n            // Player state\r\n            player: {\r\n                character: playerCharCard,\r\n                hp: 20,\r\n                maxHp: 20,\r\n                energy: playerMag,\r\n                maxEnergy: playerMag,\r\n                morale: 20,\r\n                maxMorale: 20,\r\n                ap: playerAp,\r\n                maxAp: playerAp,\r\n                apUsed: 0,\r\n                hand: playerHand,\r\n                drawPile: playerDrawPile,\r\n                discardPile: [],\r\n                // Card stack: modifier cards placed on character (apparel, items, buffs)\r\n                cardStack: dealInitialStack(playerApparel, playerItems),\r\n                roundPoints: 0,\r\n                statusEffects: [],  // Active status effects (stunned, poisoned, etc.)\r\n                typesPlayedThisRound: {}  // Track action types played this round for hoarding prevention\r\n            },\r\n\r\n            // Opponent state (AI) - use actual character from deck if available\r\n            opponent: {\r\n                name: opponentCharCard ? (opponentCharCard.name || \"Opponent\") : \"Challenger\",\r\n                character: opponentCharCard || {\r\n                    type: \"character\",\r\n                    name: \"Challenger\",\r\n                    race: \"UNKNOWN\",\r\n                    alignment: \"NEUTRAL\",\r\n                    level: 1,\r\n                    stats: opponentStats,\r\n                    needs: { hp: 20, energy: opponentMag, morale: 20 },\r\n                    equipped: { head: null, body: null, handL: null, handR: null, feet: null, ring: null, back: null },\r\n                    activeSkills: [null, null, null, null],\r\n                    portraitUrl: null\r\n                },\r\n                hp: 20,\r\n                maxHp: 20,\r\n                energy: opponentMag,\r\n                maxEnergy: opponentMag,\r\n                morale: 20,\r\n                maxMorale: 20,\r\n                ap: opponentAp,\r\n                maxAp: opponentAp,\r\n                apUsed: 0,\r\n                hand: opponentHand,\r\n                drawPile: opponentDrawPile,\r\n                discardPile: [],\r\n                // Card stack: modifier cards placed on character\r\n                cardStack: dealInitialStack(opponentApparel, opponentItems),\r\n                roundPoints: 0,\r\n                statusEffects: [],  // Active status effects (stunned, poisoned, etc.)\r\n                typesPlayedThisRound: {}  // Track action types played this round for hoarding prevention\r\n            },\r\n\r\n            // Encounter deck (shuffled)\r\n            encounterDeck: shuffle([...encounterCards]),\r\n\r\n            // Round pot\r\n            pot: [],\r\n\r\n            // Timing\r\n            turnTimer: null,\r\n            isPaused: false,\r\n\r\n            // Turn tracking for draw/placement\r\n            currentTurn: null,  // \"player\" | \"opponent\"\r\n            turnActions: [],    // log of actions this placement phase\r\n\r\n            // Beginning threats (from Nat 1 on initiative)\r\n            beginningThreats: [],\r\n\r\n            // Threat response state\r\n            threatResponse: {\r\n                active: false,\r\n                type: null,        // \"beginning\" | \"end\"\r\n                threats: [],       // Array of active threats\r\n                responder: null,   // \"player\" | \"opponent\" - who gets to respond\r\n                bonusAP: 0,        // AP for threat response (limited)\r\n                defenseStack: null,// Stack placed for defense\r\n                resolved: false\r\n            },\r\n\r\n            // Chat state (Phase 8)\r\n            chat: {\r\n                active: false,\r\n                unlocked: false,   // True when Talk card is active (Silence Rule)\r\n                messages: [],      // [{ role: \"player\"|\"npc\", text, timestamp }]\r\n                npcName: null,\r\n                inputText: \"\",\r\n                pending: false,    // Waiting for LLM response\r\n                talkCard: null,    // The Talk card that opened this chat\r\n                talkPosition: null // The action bar position for resolution\r\n            }\r\n        };\r\n\r\n        // Ensure each player has at least one Attack card in starting hand\r\n        ensureOffensiveCard(state.player, \"Player\");\r\n        ensureOffensiveCard(state.opponent, \"Opponent\");\r\n\r\n        return state;\r\n    }\r\n\r\n    //  LLM Component State \r\n    let gameDirector = null;\r\n    let gameNarrator = null;\r\n    let gameChatManager = null;\r\n    let gameVoice = null;\r\n    let gameAnnouncerVoice = null;  // Separate voice instance for announcer\r\n\r\n    // Initialize LLM components (Director and Narrator) for a game\r\n    async function initializeLLMComponents(state, deck) {\r\n        const activeTheme = Th()?.getActiveTheme?.() || { themeId: \"high-fantasy\" };\r\n        const themeId = deck?.themeId || activeTheme?.themeId || \"high-fantasy\";\r\n        const opponentChar = state?.opponent?.character;\r\n        const gc = deck?.gameConfig || {};\r\n        const narrationEnabled = gc.narrationEnabled !== false;       // Default: enabled\r\n        const opponentVoiceEnabled = gc.opponentVoiceEnabled === true; // Default: disabled\r\n        const opponentVoiceProfileId = gc.opponentVoiceProfileId || null;\r\n        const announcerEnabled = gc.announcerEnabled === true;         // Default: disabled\r\n        const announcerProfile = gc.announcerProfile || \"arena-announcer\";\r\n        const announcerVoiceEnabled = gc.announcerVoiceEnabled === true;\r\n        const announcerVoiceProfileId = gc.announcerVoiceProfileId || null;\r\n\r\n        console.log(\"[CardGame v2] Game config: llm=\" + narrationEnabled\r\n            + \" oppVoice=\" + opponentVoiceEnabled + \" (profile=\" + (opponentVoiceProfileId || \"default\") + \")\"\r\n            + \" announcer=\" + announcerEnabled + \" (style=\" + announcerProfile + \" voice=\" + announcerVoiceEnabled + \")\");\r\n\r\n        // Resolve AI classes  may come from extracted modules or monolith fallback\r\n        const CardGameDirector = AI()?.CardGameDirector;\r\n        const CardGameNarrator = AI()?.CardGameNarrator;\r\n        const CardGameChatManager = AI()?.CardGameChatManager;\r\n        const CardGameVoice = AI()?.CardGameVoice;\r\n\r\n        // Initialize AI Director (optional - falls back to FIFO if unavailable)\r\n        if (CardGameDirector) {\r\n            try {\r\n                gameDirector = new CardGameDirector();\r\n                const directorOk = await gameDirector.initialize(opponentChar, themeId);\r\n                if (!directorOk) {\r\n                    console.log(\"[CardGame v2] LLM Director unavailable, using fallback AI\");\r\n                    gameDirector = null;\r\n                }\r\n            } catch (err) {\r\n                console.warn(\"[CardGame v2] Failed to initialize Director:\", err);\r\n                gameDirector = null;\r\n            }\r\n        } else {\r\n            gameDirector = null;\r\n        }\r\n\r\n        // Initialize Announcer narrator (optional -- separate from opponent)\r\n        if (announcerEnabled && narrationEnabled && CardGameNarrator) {\r\n            try {\r\n                gameNarrator = new CardGameNarrator();\r\n                const narratorOk = await gameNarrator.initialize(announcerProfile, themeId);\r\n                if (!narratorOk) {\r\n                    console.log(\"[CardGame v2] Announcer LLM unavailable, using fallback narration\");\r\n                    gameNarrator = null;\r\n                }\r\n            } catch (err) {\r\n                console.warn(\"[CardGame v2] Failed to initialize Announcer:\", err);\r\n                gameNarrator = null;\r\n            }\r\n        } else if (!announcerEnabled) {\r\n            console.log(\"[CardGame v2] Announcer disabled by deck config\");\r\n            gameNarrator = null;\r\n        } else {\r\n            console.log(\"[CardGame v2] LLM disabled  announcer uses fallback text\");\r\n            gameNarrator = null;\r\n        }\r\n\r\n        // Always trigger game start narration (uses fallback if announcer unavailable)\r\n        narrateGameStart();\r\n\r\n        // Initialize Chat Manager for Talk cards / opponent dialogue (requires LLM enabled)\r\n        if (narrationEnabled && CardGameChatManager) {\r\n            try {\r\n                gameChatManager = new CardGameChatManager();\r\n                const chatOk = await gameChatManager.initialize(opponentChar, themeId);\r\n                if (!chatOk) {\r\n                    console.log(\"[CardGame v2] LLM Chat Manager unavailable, Talk cards use fallback. Error:\", gameChatManager?.lastError);\r\n                    gameChatManager = null;\r\n                } else {\r\n                    console.log(\"[CardGame v2] Chat Manager initialized successfully\");\r\n                }\r\n            } catch (err) {\r\n                console.warn(\"[CardGame v2] Failed to initialize Chat Manager:\", err);\r\n                gameChatManager = null;\r\n            }\r\n        } else {\r\n            gameChatManager = null;\r\n        }\r\n\r\n        // Initialize Opponent Voice (the opponent character's TTS voice)\r\n        if (CardGameVoice) {\r\n            try {\r\n                gameVoice = new CardGameVoice();\r\n                await gameVoice.initialize({\r\n                    subtitlesOnly: !opponentVoiceEnabled,\r\n                    voiceProfileId: opponentVoiceProfileId,\r\n                    volume: 1.0\r\n                });\r\n            } catch (err) {\r\n                console.warn(\"[CardGame v2] Failed to initialize opponent voice:\", err);\r\n                gameVoice = null;\r\n            }\r\n        } else {\r\n            gameVoice = null;\r\n        }\r\n\r\n        // Initialize Announcer Voice (separate TTS for commentary)\r\n        if (announcerEnabled && announcerVoiceEnabled && CardGameVoice) {\r\n            try {\r\n                gameAnnouncerVoice = new CardGameVoice();\r\n                await gameAnnouncerVoice.initialize({\r\n                    subtitlesOnly: false,\r\n                    voiceProfileId: announcerVoiceProfileId,\r\n                    volume: 1.0\r\n                });\r\n            } catch (err) {\r\n                console.warn(\"[CardGame v2] Failed to initialize announcer voice:\", err);\r\n                gameAnnouncerVoice = null;\r\n            }\r\n        } else {\r\n            gameAnnouncerVoice = null;\r\n        }\r\n    }\r\n\r\n    //  Unified Narration System \r\n    // Centralized narration with LLM and fallback support\r\n\r\n    // Build emotion context from Poker Face (mood ring) if available\r\n    function buildEmotionContext() {\r\n        const emotion = (page?.components?.moodRing?.enabled?.()) ? page.components.moodRing.emotion() : null;\r\n        if (!emotion || emotion === \"neutral\") return null;\r\n\r\n        const emotionDescriptions = {\r\n            happy: \"appears pleased\",\r\n            sad: \"looks dejected\",\r\n            angry: \"seems frustrated\",\r\n            fear: \"appears nervous\",\r\n            surprise: \"looks startled\",\r\n            disgust: \"seems unimpressed\"\r\n        };\r\n\r\n        return {\r\n            emotion,\r\n            description: emotionDescriptions[emotion] || null\r\n        };\r\n    }\r\n\r\n    async function triggerNarration(trigger, extraContext = {}) {\r\n        if (!gameState) return;\r\n        console.log(\"[CardGame v2] triggerNarration called:\", trigger);\r\n\r\n        const playerName = gameState.player?.character?.name || \"Player\";\r\n        const opponentName = gameState.opponent?.character?.name || \"Opponent\";\r\n        const baseContext = { playerName, opponentName };\r\n\r\n        // Build trigger-specific context\r\n        let context, fallbackText;\r\n        switch (trigger) {\r\n            case \"game_start\":\r\n                context = { ...baseContext, round: 1 };\r\n                fallbackText = `The arena awaits! ${playerName} faces ${opponentName} in a battle of wits and steel. Let the cards decide your fate!`;\r\n                break;\r\n\r\n            case \"game_end\": {\r\n                const isVictory = extraContext.winner === \"player\";\r\n                const winnerName = isVictory ? playerName : opponentName;\r\n                const loserName = isVictory ? opponentName : playerName;\r\n                context = { winner: winnerName, loser: loserName, isPlayerVictory: isVictory, rounds: gameState.round };\r\n                fallbackText = isVictory\r\n                    ? `Victory! ${playerName} stands triumphant over ${opponentName} after ${gameState.round} rounds of fierce combat!`\r\n                    : `Defeat... ${opponentName} has bested ${playerName}. The arena falls silent after ${gameState.round} rounds.`;\r\n                break;\r\n            }\r\n\r\n            case \"round_start\":\r\n                context = {\r\n                    ...baseContext,\r\n                    roundNumber: gameState.round,\r\n                    playerHp: gameState.player.hp,\r\n                    opponentHp: gameState.opponent.hp,\r\n                    playerEnergy: gameState.player.energy,\r\n                    opponentEnergy: gameState.opponent.energy\r\n                };\r\n                if (gameState.round <= 1) return; // Round 1 uses game_start\r\n                const tension = (gameState.player.hp < 10 || gameState.opponent.hp < 10)\r\n                    ? \" The tension mounts as both combatants show signs of wear.\" : \"\";\r\n                fallbackText = `Round ${gameState.round} begins!${tension}`;\r\n                break;\r\n\r\n            case \"round_end\": {\r\n                const roundWinner = extraContext.roundWinner || \"tie\";\r\n                const winName = roundWinner === \"player\" ? playerName : roundWinner === \"opponent\" ? opponentName : \"Neither\";\r\n                context = {\r\n                    ...baseContext,\r\n                    roundNumber: gameState.round,\r\n                    roundWinner: winName,\r\n                    playerHp: gameState.player.hp,\r\n                    opponentHp: gameState.opponent.hp\r\n                };\r\n                fallbackText = roundWinner === \"tie\"\r\n                    ? `Round ${gameState.round} ends in a stalemate!`\r\n                    : `${winName} takes Round ${gameState.round}!`;\r\n                break;\r\n            }\r\n\r\n            case \"resolution\": {\r\n                const attackerName = extraContext.attackerName || (extraContext.isPlayerAttack ? playerName : opponentName);\r\n                const defenderName = extraContext.defenderName || (extraContext.isPlayerAttack ? opponentName : playerName);\r\n                const outcome = extraContext.outcome || \"Hit\";\r\n                const damage = extraContext.damage || 0;\r\n                context = {\r\n                    ...baseContext,\r\n                    attackerName, defenderName, outcome, damage,\r\n                    roundNumber: gameState.round\r\n                };\r\n                if (outcome === \"CRIT\") {\r\n                    fallbackText = `Critical hit! ${attackerName} devastates ${defenderName} for ${damage} damage!`;\r\n                } else if (outcome === \"MISS\" || damage <= 0) {\r\n                    fallbackText = `${defenderName} deflects ${attackerName}'s assault!`;\r\n                } else {\r\n                    fallbackText = `${attackerName} strikes ${defenderName} for ${damage} damage!`;\r\n                }\r\n                break;\r\n            }\r\n\r\n            default:\r\n                context = { ...baseContext, ...extraContext };\r\n                fallbackText = null;\r\n        }\r\n\r\n        // Add Poker Face emotion context if available\r\n        const emotionCtx = buildEmotionContext();\r\n        if (emotionCtx) {\r\n            context.playerEmotion = emotionCtx.emotion;\r\n            context.playerEmotionDesc = emotionCtx.description;\r\n        }\r\n\r\n        // Try LLM narration\r\n        let narrationText = null;\r\n        if (gameNarrator?.initialized) {\r\n            try {\r\n                const narration = await gameNarrator.narrate(trigger, context);\r\n                if (narration?.text) {\r\n                    narrationText = narration.text;\r\n                }\r\n            } catch (e) {\r\n                console.warn(`[CardGame v2] ${trigger} narration failed:`, e);\r\n            }\r\n        }\r\n\r\n        // Use fallback if LLM failed\r\n        const finalText = narrationText || fallbackText;\r\n        if (!finalText) return;\r\n\r\n        // Show subtitle\r\n        showNarrationSubtitle(finalText);\r\n\r\n        // Speak with announcer voice (narration/commentary uses announcer, not opponent)\r\n        if (gameAnnouncerVoice?.enabled && !gameAnnouncerVoice.subtitlesOnly) {\r\n            gameAnnouncerVoice.speak(finalText);\r\n        }\r\n    }\r\n\r\n    // Convenience wrappers for backward compatibility\r\n    function narrateGameStart() { return triggerNarration(\"game_start\"); }\r\n    function narrateGameEnd(winner) { return triggerNarration(\"game_end\", { winner }); }\r\n    function narrateRoundStart() { return triggerNarration(\"round_start\"); }\r\n    function narrateRoundEnd(roundWinner) { return triggerNarration(\"round_end\", { roundWinner }); }\r\n\r\n    // Show narrator text as a subtitle overlay\r\n    function showNarrationSubtitle(text) {\r\n        if (!text) return;\r\n        console.log(\"[CardGame v2] showNarrationSubtitle:\", text.substring(0, 80) + (text.length > 80 ? \"...\" : \"\"));\r\n        // Store in game state for UI to display\r\n        if (gameState) {\r\n            gameState.narrationText = text;\r\n            gameState.narrationTime = Date.now();\r\n            m.redraw();\r\n\r\n            // Auto-hide after 8 seconds (extended for readability)\r\n            setTimeout(() => {\r\n                if (gameState && gameState.narrationTime && Date.now() - gameState.narrationTime >= 7900) {\r\n                    gameState.narrationText = null;\r\n                    m.redraw();\r\n                }\r\n            }, 8000);\r\n        }\r\n    }\r\n\r\n    //  Initiative Phase \r\n    function runInitiativePhase() {\r\n        if (!gameState) return;\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n        const rollInitiative = E().rollInitiative;\r\n        const checkNat1Threats = E().checkNat1Threats;\r\n        const insertBeginningThreats = E().insertBeginningThreats;\r\n\r\n        let playerStats = gameState.player.character.stats || {};\r\n        let opponentStats = gameState.opponent.character.stats || {};\r\n\r\n        gameState.initiative.playerRoll = rollInitiative(playerStats);\r\n        gameState.initiative.opponentRoll = rollInitiative(opponentStats);\r\n\r\n        // Determine winner (re-roll ties handled here simply by random)\r\n        let pTotal = gameState.initiative.playerRoll.total;\r\n        let oTotal = gameState.initiative.opponentRoll.total;\r\n\r\n        if (pTotal > oTotal) {\r\n            gameState.initiative.winner = \"player\";\r\n        } else if (oTotal > pTotal) {\r\n            gameState.initiative.winner = \"opponent\";\r\n        } else {\r\n            // Tie-breaker: random\r\n            gameState.initiative.winner = Math.random() < 0.5 ? \"player\" : \"opponent\";\r\n        }\r\n\r\n        // Calculate total positions - each player gets exactly their AP number of slots\r\n        let playerAp = gameState.player.ap;\r\n        let opponentAp = gameState.opponent.ap;\r\n        let totalPositions = playerAp + opponentAp;\r\n\r\n        // Assign positions: interleave winner and loser, but each gets exactly their AP count\r\n        // Winner acts at positions 1, 3, 5... up to their AP count\r\n        // Loser acts at positions 2, 4, 6... up to their AP count\r\n        let winnerAp = gameState.initiative.winner === \"player\" ? playerAp : opponentAp;\r\n        let loserAp = gameState.initiative.winner === \"player\" ? opponentAp : playerAp;\r\n\r\n        let winnerPositions = [];\r\n        let loserPositions = [];\r\n        let pos = 1;\r\n        let wCount = 0, lCount = 0;\r\n\r\n        // Interleave: winner first, then loser, alternating until both filled\r\n        while (wCount < winnerAp || lCount < loserAp) {\r\n            if (wCount < winnerAp) {\r\n                winnerPositions.push(pos++);\r\n                wCount++;\r\n            }\r\n            if (lCount < loserAp) {\r\n                loserPositions.push(pos++);\r\n                lCount++;\r\n            }\r\n        }\r\n\r\n        if (gameState.initiative.winner === \"player\") {\r\n            gameState.initiative.playerPositions = winnerPositions;\r\n            gameState.initiative.opponentPositions = loserPositions;\r\n        } else {\r\n            gameState.initiative.playerPositions = loserPositions;\r\n            gameState.initiative.opponentPositions = winnerPositions;\r\n        }\r\n\r\n        // Build action bar positions\r\n        gameState.actionBar.totalPositions = totalPositions;\r\n        gameState.actionBar.positions = [];\r\n        for (let i = 1; i <= totalPositions; i++) {\r\n            let owner = gameState.initiative.playerPositions.includes(i) ? \"player\" : \"opponent\";\r\n            gameState.actionBar.positions.push({\r\n                index: i,\r\n                owner: owner,\r\n                stack: null,  // { coreCard, modifiers: [] }\r\n                resolved: false\r\n            });\r\n        }\r\n\r\n        // Check for Nat 1 (critical initiative failure) - triggers beginning threats\r\n        let beginningThreats = checkNat1Threats(gameState);\r\n        if (beginningThreats.length > 0) {\r\n            insertBeginningThreats(gameState, beginningThreats);\r\n        }\r\n\r\n        console.log(\"[CardGame v2] Initiative:\", gameState.initiative);\r\n        m.redraw();\r\n    }\r\n\r\n    //  Phase Transitions \r\n    function advancePhase() {\r\n        if (!gameState) return;\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n\r\n        // Handle phase-specific transitions\r\n        if (gameState.phase === GAME_PHASES.INITIATIVE) {\r\n            // Check if there are beginning threats that need response\r\n            if (gameState.beginningThreats && gameState.beginningThreats.length > 0) {\r\n                enterThreatResponsePhase(\"beginning\");\r\n            } else {\r\n                enterDrawPlacementPhase();\r\n            }\r\n        } else if (gameState.phase === GAME_PHASES.THREAT_RESPONSE) {\r\n            // Threat response complete - resolve the threat combat, then continue to placement\r\n            resolveThreatCombat();\r\n        } else if (gameState.phase === GAME_PHASES.DRAW_PLACEMENT) {\r\n            gameState.phase = GAME_PHASES.RESOLUTION;\r\n            gameState.actionBar.resolveIndex = 0;\r\n            console.log(\"[CardGame v2] Phase advanced to:\", gameState.phase);\r\n            // Auto-start resolution\r\n            setTimeout(() => {\r\n                if (gameState && gameState.phase === GAME_PHASES.RESOLUTION) {\r\n                    advanceResolution();\r\n                }\r\n            }, 500);\r\n        } else if (gameState.phase === GAME_PHASES.RESOLUTION) {\r\n            gameState.phase = GAME_PHASES.CLEANUP;\r\n            console.log(\"[CardGame v2] Phase advanced to:\", gameState.phase);\r\n        } else if (gameState.phase === GAME_PHASES.CLEANUP) {\r\n            // Check for end-of-round threat before starting next round\r\n            if (gameState.endThreatResult && gameState.endThreatResult.threat && !gameState.endThreatResult.responded) {\r\n                enterEndThreatPhase();\r\n            } else {\r\n                startNextRound();\r\n            }\r\n        } else if (gameState.phase === GAME_PHASES.END_THREAT) {\r\n            // End threat response complete - resolve it, then start next round\r\n            resolveEndThreatCombat();\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    function enterDrawPlacementPhase() {\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n        const aiPlaceCards = AI()?.aiPlaceCards;\r\n\r\n        gameState.phase = GAME_PHASES.DRAW_PLACEMENT;\r\n        gameState.currentTurn = gameState.initiative.winner;\r\n        console.log(\"[CardGame v2] Phase advanced to:\", gameState.phase, \"- Current turn:\", gameState.currentTurn);\r\n\r\n        // If AI goes first, trigger AI placement\r\n        if (gameState.currentTurn === \"opponent\") {\r\n            setTimeout(() => {\r\n                if (gameState && gameState.phase === GAME_PHASES.DRAW_PLACEMENT) {\r\n                    console.log(\"[CardGame v2] Triggering AI placement (goes first)\");\r\n                    if (aiPlaceCards) aiPlaceCards();\r\n                    m.redraw();\r\n                }\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    function enterThreatResponsePhase(type) {\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n\r\n        console.log(\"[CardGame v2] Entering threat response phase for:\", type, \"threats\");\r\n        gameState.phase = GAME_PHASES.THREAT_RESPONSE;\r\n\r\n        // Determine who responds - the fumbler(s) who triggered the threat\r\n        let responders = [];\r\n        gameState.beginningThreats.forEach(threat => {\r\n            if (!responders.includes(threat.target)) {\r\n                responders.push(threat.target);\r\n            }\r\n        });\r\n\r\n        // Set up threat response state\r\n        gameState.threatResponse = {\r\n            active: true,\r\n            type: type,\r\n            threats: gameState.beginningThreats.slice(),\r\n            responder: responders[0] || \"player\",  // First responder\r\n            responderQueue: responders,\r\n            bonusAP: 2,  // Limited AP for threat defense\r\n            defenseStack: [],\r\n            resolved: false\r\n        };\r\n\r\n        // Give responder bonus AP for defense\r\n        let responder = gameState.threatResponse.responder === \"player\" ? gameState.player : gameState.opponent;\r\n        responder.threatResponseAP = gameState.threatResponse.bonusAP;\r\n\r\n        console.log(\"[CardGame v2] Threat response:\", gameState.threatResponse.responder, \"gets\", gameState.threatResponse.bonusAP, \"AP to defend\");\r\n    }\r\n\r\n    function enterEndThreatPhase() {\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n\r\n        console.log(\"[CardGame v2] Entering end threat phase\");\r\n        gameState.phase = GAME_PHASES.END_THREAT;\r\n\r\n        // Responder is the threat's target (the one being attacked)\r\n        let threat = gameState.endThreatResult.threat;\r\n        let responder = threat.target;\r\n\r\n        gameState.threatResponse = {\r\n            active: true,\r\n            type: \"end\",\r\n            threats: [threat],\r\n            responder: responder,\r\n            bonusAP: 2,  // Bonus AP for end threat response\r\n            defenseStack: [],\r\n            resolved: false\r\n        };\r\n\r\n        // Give responder (defender) bonus AP\r\n        let actor = responder === \"player\" ? gameState.player : gameState.opponent;\r\n        actor.threatResponseAP = gameState.threatResponse.bonusAP;\r\n\r\n        console.log(\"[CardGame v2] End threat response:\", responder, \"must defend against\", threat.name);\r\n    }\r\n\r\n    //  Threat Combat \r\n    function resolveThreatCombat() {\r\n        const rollAttack = E().rollAttack;\r\n        const rollDefense = E().rollDefense;\r\n        const getCombatOutcome = E().getCombatOutcome;\r\n        const calculateDamage = E().calculateDamage;\r\n        const applyDamage = E().applyDamage;\r\n        const checkGameOver = E().checkGameOver;\r\n\r\n        console.log(\"[CardGame v2] resolveThreatCombat called, phase:\", gameState?.phase,\r\n            \"threatResponse:\", !!gameState?.threatResponse,\r\n            \"threats:\", gameState?.threatResponse?.threats?.length || 0);\r\n\r\n        if (!gameState || !gameState.threatResponse) {\r\n            console.warn(\"[CardGame v2] resolveThreatCombat: No threat response state\");\r\n            return;\r\n        }\r\n\r\n        let threats = gameState.threatResponse.threats;\r\n        let defenseStack = gameState.threatResponse.defenseStack || [];\r\n\r\n        if (!threats || threats.length === 0) {\r\n            console.warn(\"[CardGame v2] resolveThreatCombat: No threats to resolve\");\r\n            // Still need to advance phase\r\n            gameState.threatResponse.resolved = true;\r\n            gameState.threatResponse.active = false;\r\n            gameState.player.threatResponseAP = 0;\r\n            gameState.opponent.threatResponseAP = 0;\r\n            enterDrawPlacementPhase();\r\n            return;\r\n        }\r\n\r\n        // Resolve each threat as combat\r\n        threats.forEach(threat => {\r\n            let targetActor = threat.target === \"player\" ? gameState.player : gameState.opponent;\r\n\r\n            // Build threat attacker object\r\n            let threatAttacker = {\r\n                name: threat.name,\r\n                character: {\r\n                    name: threat.name,\r\n                    stats: { STR: threat.atk, END: threat.def }\r\n                },\r\n                hp: threat.hp,\r\n                maxHp: threat.maxHp,\r\n                cardStack: [{ type: \"item\", subtype: \"weapon\", atk: threat.atk }]\r\n            };\r\n\r\n            // Check if defender has a defense stack\r\n            let defenderStack = defenseStack.filter(card => card.target === threat.target);\r\n            targetActor.cardStack = defenderStack;\r\n\r\n            // Roll combat\r\n            let attackRoll = rollAttack(threatAttacker, []);\r\n            let defenseRoll = rollDefense(targetActor);\r\n            let outcome = getCombatOutcome(attackRoll, defenseRoll);\r\n\r\n            console.log(\"[CardGame v2] Threat combat:\", threat.name, \"vs\", threat.target, \"- Outcome:\", outcome.label);\r\n\r\n            if (outcome.damageMultiplier > 0) {\r\n                // Threat hit\r\n                let damage = calculateDamage(threatAttacker, outcome);\r\n                let damageResult = applyDamage(targetActor, damage.finalDamage);\r\n                console.log(\"[CardGame v2] Threat dealt\", damage.finalDamage, \"damage to\", threat.target);\r\n\r\n                // Store result for UI\r\n                if (!gameState.threatResults) gameState.threatResults = [];\r\n                gameState.threatResults.push({\r\n                    threatName: threat.name,\r\n                    target: threat.target,\r\n                    outcome: \"hit\",\r\n                    damage: damage.finalDamage,\r\n                    attackRoll,\r\n                    defenseRoll,\r\n                    combatOutcome: outcome\r\n                });\r\n            } else {\r\n                // Defender blocked/parried\r\n                console.log(\"[CardGame v2]\", threat.target, \"defended against\", threat.name);\r\n\r\n                // Grant loot on successful defense\r\n                let lootCard = {\r\n                    type: \"item\",\r\n                    subtype: \"consumable\",\r\n                    name: \"Threat Loot (\" + threat.lootRarity + \")\",\r\n                    rarity: threat.lootRarity,\r\n                    effect: threat.lootRarity === \"RARE\" ? \"Restore 5 HP\" : \"Restore 3 HP\",\r\n                    flavor: \"Spoils from defeating \" + threat.name\r\n                };\r\n                targetActor.hand.push(lootCard);\r\n\r\n                if (!gameState.threatResults) gameState.threatResults = [];\r\n                gameState.threatResults.push({\r\n                    threatName: threat.name,\r\n                    target: threat.target,\r\n                    outcome: \"defeated\",\r\n                    loot: lootCard,\r\n                    attackRoll,\r\n                    defenseRoll,\r\n                    combatOutcome: outcome\r\n                });\r\n            }\r\n        });\r\n\r\n        // Clear threat response and continue to placement\r\n        gameState.threatResponse.resolved = true;\r\n        gameState.threatResponse.active = false;\r\n\r\n        // Clear threat response AP\r\n        gameState.player.threatResponseAP = 0;\r\n        gameState.opponent.threatResponseAP = 0;\r\n\r\n        // Check for game over after threat combat\r\n        let winner = checkGameOver(gameState);\r\n        if (winner) {\r\n            console.log(\"[CardGame v2] Game over from threat combat - winner:\", winner);\r\n            gameState.winner = winner;\r\n            gameState.phase = \"GAME_OVER\";\r\n            m.redraw();\r\n            return;\r\n        }\r\n\r\n        // Continue to draw/placement phase\r\n        enterDrawPlacementPhase();\r\n    }\r\n\r\n    function resolveEndThreatCombat() {\r\n        const rollAttack = E().rollAttack;\r\n        const rollDefense = E().rollDefense;\r\n        const getCombatOutcome = E().getCombatOutcome;\r\n        const calculateDamage = E().calculateDamage;\r\n        const applyDamage = E().applyDamage;\r\n        const checkGameOver = E().checkGameOver;\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n\r\n        if (!gameState || !gameState.endThreatResult || !gameState.endThreatResult.threat) {\r\n            startNextRound();\r\n            return;\r\n        }\r\n\r\n        let threat = gameState.endThreatResult.threat;\r\n        let responder = gameState.threatResponse?.responder || gameState.roundWinner;\r\n        let responderActor = responder === \"player\" ? gameState.player : gameState.opponent;\r\n        let defenseStack = gameState.threatResponse?.defenseStack || [];\r\n\r\n        // Build threat attacker object\r\n        let threatAttacker = {\r\n            name: threat.name,\r\n            character: {\r\n                name: threat.name,\r\n                stats: { STR: threat.atk, END: threat.def }\r\n            },\r\n            hp: threat.hp,\r\n            maxHp: threat.maxHp,\r\n            cardStack: [{ type: \"item\", subtype: \"weapon\", atk: threat.atk }]\r\n        };\r\n\r\n        // Assign defense stack\r\n        responderActor.cardStack = defenseStack;\r\n\r\n        // Roll combat\r\n        let attackRoll = rollAttack(threatAttacker, []);\r\n        let defenseRoll = rollDefense(responderActor);\r\n        let outcome = getCombatOutcome(attackRoll, defenseRoll);\r\n\r\n        console.log(\"[CardGame v2] End threat combat:\", threat.name, \"vs\", responder, \"- Outcome:\", outcome.label);\r\n\r\n        if (outcome.damageMultiplier > 0) {\r\n            // Threat hit\r\n            let damage = calculateDamage(threatAttacker, outcome);\r\n            applyDamage(responderActor, damage.finalDamage);\r\n            gameState.endThreatResult.damageDealt = damage.finalDamage;\r\n            gameState.endThreatResult.combatResult = { attackRoll, defenseRoll, outcome, damage };\r\n            console.log(\"[CardGame v2] End threat dealt\", damage.finalDamage, \"damage to\", responder);\r\n        } else {\r\n            // Defender won\r\n            gameState.endThreatResult.damageDealt = 0;\r\n            gameState.endThreatResult.combatResult = { attackRoll, defenseRoll, outcome, defended: true };\r\n\r\n            // Grant loot\r\n            let lootCard = {\r\n                type: \"item\",\r\n                subtype: \"consumable\",\r\n                name: \"End Threat Loot (\" + threat.lootRarity + \")\",\r\n                rarity: threat.lootRarity,\r\n                effect: \"Restore 4 HP\",\r\n                flavor: \"Spoils from defeating \" + threat.name\r\n            };\r\n            responderActor.hand.push(lootCard);\r\n            gameState.endThreatResult.loot = lootCard;\r\n            console.log(\"[CardGame v2]\", responder, \"defeated end threat, earned loot\");\r\n        }\r\n\r\n        gameState.endThreatResult.responded = true;\r\n\r\n        // Clear threat response state\r\n        if (gameState.threatResponse) {\r\n            gameState.threatResponse.active = false;\r\n            gameState.threatResponse.resolved = true;\r\n        }\r\n\r\n        // Clear threat response AP\r\n        gameState.player.threatResponseAP = 0;\r\n        gameState.opponent.threatResponseAP = 0;\r\n\r\n        // Check for game over after end threat combat\r\n        let winner = checkGameOver(gameState);\r\n        if (winner) {\r\n            console.log(\"[CardGame v2] Game over from end threat - winner:\", winner);\r\n            gameState.winner = winner;\r\n            gameState.phase = \"GAME_OVER\";\r\n            m.redraw();\r\n            return;\r\n        }\r\n\r\n        // Return to cleanup phase to show the result before next round\r\n        gameState.phase = GAME_PHASES.CLEANUP;\r\n        console.log(\"[CardGame v2] End threat resolved, returning to cleanup to show result\");\r\n        m.redraw();\r\n    }\r\n\r\n    // Place a card in threat response defense stack\r\n    function placeThreatDefenseCard(card) {\r\n        if (!gameState || !gameState.threatResponse || !gameState.threatResponse.active) return false;\r\n\r\n        let responder = gameState.threatResponse.responder;\r\n        let actor = responder === \"player\" ? gameState.player : gameState.opponent;\r\n\r\n        // Check AP\r\n        let apCost = 1;\r\n        if ((actor.threatResponseAP || 0) < apCost) {\r\n            console.log(\"[CardGame v2] Not enough threat response AP\");\r\n            return false;\r\n        }\r\n\r\n        // Deduct AP and add to defense stack\r\n        actor.threatResponseAP -= apCost;\r\n        gameState.threatResponse.defenseStack.push({\r\n            ...card,\r\n            target: gameState.threatResponse.threats[0]?.target || responder\r\n        });\r\n\r\n        // Remove from hand\r\n        let handIndex = actor.hand.indexOf(card);\r\n        if (handIndex >= 0) {\r\n            actor.hand.splice(handIndex, 1);\r\n        }\r\n\r\n        console.log(\"[CardGame v2] Placed threat defense card:\", card.name);\r\n        m.redraw();\r\n        return true;\r\n    }\r\n\r\n    // Skip threat response and let combat resolve\r\n    function skipThreatResponse() {\r\n        if (!gameState || !gameState.threatResponse) return;\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n\r\n        console.log(\"[CardGame v2] Skipping threat response\");\r\n\r\n        if (gameState.phase === GAME_PHASES.THREAT_RESPONSE) {\r\n            resolveThreatCombat();\r\n        } else if (gameState.phase === GAME_PHASES.END_THREAT) {\r\n            resolveEndThreatCombat();\r\n        }\r\n    }\r\n\r\n    //  Round Management \r\n    function startNextRound() {\r\n        if (!gameState) return;\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n        const checkGameOver = E().checkGameOver;\r\n        const tickStatusEffects = E().tickStatusEffects;\r\n        const processStatusEffectsTurnStart = E().processStatusEffectsTurnStart;\r\n        const drawCardsForActor = E().drawCardsForActor;\r\n        const ensureOffensiveCard = E().ensureOffensiveCard;\r\n        const anteCard = E().anteCard;\r\n\r\n        // Check for game over BEFORE starting next round\r\n        let winner = checkGameOver(gameState);\r\n        if (winner) {\r\n            console.log(\"[CardGame v2] Game over detected at round start - winner:\", winner);\r\n            gameState.winner = winner;\r\n            gameState.phase = \"GAME_OVER\";\r\n            m.redraw();\r\n            return;\r\n        }\r\n\r\n        // Tick down status effect durations at end of round\r\n        tickStatusEffects(gameState.player);\r\n        tickStatusEffects(gameState.opponent);\r\n\r\n        // Process turn-start effects (like poison damage)\r\n        let playerEffects = processStatusEffectsTurnStart(gameState.player);\r\n        let opponentEffects = processStatusEffectsTurnStart(gameState.opponent);\r\n        if (playerEffects.length > 0 || opponentEffects.length > 0) {\r\n            console.log(\"[CardGame v2] Status effects triggered:\", { player: playerEffects, opponent: opponentEffects });\r\n        }\r\n\r\n        // Check again after status effects (poison could kill)\r\n        winner = checkGameOver(gameState);\r\n        if (winner) {\r\n            console.log(\"[CardGame v2] Game over from status effects - winner:\", winner);\r\n            gameState.winner = winner;\r\n            gameState.phase = \"GAME_OVER\";\r\n            m.redraw();\r\n            return;\r\n        }\r\n\r\n        gameState.round++;\r\n        gameState.phase = GAME_PHASES.INITIATIVE;\r\n\r\n        // Reset AP\r\n        gameState.player.apUsed = 0;\r\n        gameState.opponent.apUsed = 0;\r\n\r\n        // Reset round points\r\n        gameState.player.roundPoints = 0;\r\n        gameState.opponent.roundPoints = 0;\r\n\r\n        // Reset hoarding prevention tracking\r\n        gameState.player.typesPlayedThisRound = {};\r\n        gameState.opponent.typesPlayedThisRound = {};\r\n        gameState.exhaustedThisRound = [];\r\n        gameState.playerLethargy = [];\r\n        gameState.opponentLethargy = [];\r\n\r\n        // Clear action bar\r\n        gameState.actionBar.positions = [];\r\n        gameState.actionBar.resolveIndex = -1;\r\n\r\n        // Clear beginning threats from previous round\r\n        gameState.beginningThreats = [];\r\n\r\n        // Clear pot (winner claimed it)\r\n        gameState.pot = [];\r\n\r\n        // Auto-draw at start of rounds 2+\r\n        // Draw cards to refill hand (up to 5 cards, draw difference)\r\n        let targetHandSize = 5;\r\n        let playerDraw = Math.max(0, targetHandSize - gameState.player.hand.length);\r\n        let opponentDraw = Math.max(0, targetHandSize - gameState.opponent.hand.length);\r\n\r\n        if (playerDraw > 0) {\r\n            console.log(\"[CardGame v2] Round\", gameState.round, \"- Player draws\", playerDraw, \"cards\");\r\n            drawCardsForActor(gameState.player, playerDraw);\r\n        }\r\n        if (opponentDraw > 0) {\r\n            console.log(\"[CardGame v2] Round\", gameState.round, \"- Opponent draws\", opponentDraw, \"cards\");\r\n            drawCardsForActor(gameState.opponent, opponentDraw);\r\n        }\r\n\r\n        // Ensure each player has at least one Attack card\r\n        ensureOffensiveCard(gameState.player, \"Player\");\r\n        ensureOffensiveCard(gameState.opponent, \"Opponent\");\r\n\r\n        // Mandatory ante: each player puts 1 random card into pot\r\n        anteCard(gameState.player, \"Player\");\r\n        anteCard(gameState.opponent, \"Opponent\");\r\n\r\n        // Reset initiative animation state so it replays\r\n        resetInitAnimState();\r\n\r\n        // Clear previous initiative results\r\n        gameState.initiative.playerRoll = null;\r\n        gameState.initiative.opponentRoll = null;\r\n        gameState.initiative.winner = null;\r\n\r\n        console.log(\"[CardGame v2] Starting round\", gameState.round, \"- Pot has\", gameState.pot.length, \"cards\");\r\n        m.redraw();\r\n\r\n        // Trigger round start narration (non-blocking)\r\n        if (gameState.round > 1) {\r\n            narrateRoundStart();\r\n        }\r\n\r\n        // Start initiative animation for round 2+ (oninit won't fire again)\r\n        setTimeout(() => {\r\n            if (gameState && gameState.phase === GAME_PHASES.INITIATIVE) {\r\n                startInitiativeAnimation();\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    //  Campaign State \r\n    // Module-level campaign state (loaded at game start, used in sidebar/game-over)\r\n    let activeCampaign = null;\r\n    let levelUpState = null; // { campaign, statsSelected: [], onComplete: fn }\r\n\r\n    // Apply campaign stat gains to a game state's player character\r\n    function applyCampaignBonuses(state, campaign) {\r\n        if (!campaign?.statGains || !state?.player?.character?.stats) return;\r\n        let stats = state.player.character.stats;\r\n        for (let [stat, gain] of Object.entries(campaign.statGains)) {\r\n            if (typeof stats[stat] === \"number\") {\r\n                stats[stat] += gain;\r\n            }\r\n        }\r\n        // Recalculate derived values from updated stats\r\n        let end = stats.END ?? stats.end ?? 12;\r\n        state.player.ap = Math.max(2, Math.floor(end / 5) + 1);\r\n        state.player.maxAp = state.player.ap;\r\n        let mag = stats.MAG ?? stats.mag ?? 12;\r\n        state.player.energy = mag;\r\n        state.player.maxEnergy = mag;\r\n        console.log(\"[CardGame v2] Campaign bonuses applied:\", JSON.stringify(campaign.statGains),\r\n            \"\\u2192 AP:\", state.player.ap, \"Energy:\", state.player.energy);\r\n    }\r\n\r\n    //  Resolution Animation State \r\n    let resolutionAnimating = false;\r\n    let resolutionPhase = \"idle\";  // \"idle\" | \"rolling\" | \"result\" | \"done\"\r\n    let resolutionDiceFaces = { attack: 1, defense: 1 };\r\n    let resolutionDiceInterval = null;\r\n    let currentCombatResult = null;\r\n\r\n    //  Resolution Driver \r\n    // The main resolution phase driver  handles combat, rest, guard, flee,\r\n    // investigate, trade, craft, talk, magic action types.\r\n    function advanceResolution() {\r\n        if (!gameState) return;\r\n        const GAME_PHASES = C().GAME_PHASES;\r\n        if (gameState.phase !== GAME_PHASES.RESOLUTION) return;\r\n        if (resolutionAnimating) return;\r\n\r\n        const rollD20 = E().rollD20;\r\n        const rollAttack = E().rollAttack;\r\n        const rollDefense = E().rollDefense;\r\n        const getCombatOutcome = E().getCombatOutcome;\r\n        const calculateDamage = E().calculateDamage;\r\n        const applyDamage = E().applyDamage;\r\n        const resolveCombat = E().resolveCombat;\r\n        const checkGameOver = E().checkGameOver;\r\n        const checkExhausted = E().checkExhausted;\r\n        const drawCardsForActor = E().drawCardsForActor;\r\n        const applyStatusEffect = E().applyStatusEffect;\r\n        const parseEffect = E().parseEffect;\r\n        const applyParsedEffects = E().applyParsedEffects;\r\n        const getStackSkillMod = E().getStackSkillMod;\r\n        // openTalkChat may come from UI module or monolith\r\n        const openTalkChat = window.CardGame.UI?.openTalkChat || window.CardGame._openTalkChat;\r\n\r\n        let bar = gameState.actionBar;\r\n        if (bar.resolveIndex >= bar.positions.length) {\r\n            // Resolution complete - check for game over\r\n            let winner = checkGameOver(gameState);\r\n            if (winner) {\r\n                gameState.winner = winner;\r\n                gameState.phase = \"GAME_OVER\";\r\n                m.redraw();\r\n                return;\r\n            }\r\n            advancePhase();\r\n            return;\r\n        }\r\n\r\n        let pos = bar.positions[bar.resolveIndex];\r\n        if (pos.resolved) {\r\n            bar.resolveIndex++;\r\n            advanceResolution();\r\n            return;\r\n        }\r\n\r\n        // Check if this is a threat position (beginning threat from Nat 1)\r\n        let isThreat = pos.isThreat && pos.threat;\r\n\r\n        // Determine if this is a combat action\r\n        let card = pos.stack?.coreCard;\r\n        let isAttack = (card && card.name === \"Attack\") || isThreat;\r\n\r\n        if (isAttack) {\r\n            // Combat resolution with dice animation\r\n            resolutionAnimating = true;\r\n            resolutionPhase = \"rolling\";\r\n            currentCombatResult = null;\r\n\r\n            // Start dice animation\r\n            resolutionDiceInterval = setInterval(() => {\r\n                resolutionDiceFaces.attack = rollD20();\r\n                resolutionDiceFaces.defense = rollD20();\r\n                m.redraw();\r\n            }, 80);\r\n\r\n            m.redraw();\r\n\r\n            // After 1.5 seconds, resolve the combat\r\n            setTimeout(() => {\r\n                clearInterval(resolutionDiceInterval);\r\n                resolutionDiceInterval = null;\r\n\r\n                // Determine attacker and defender\r\n                let attacker, defender;\r\n                if (isThreat) {\r\n                    // Threat attacks the player who fumbled (rolled Nat 1)\r\n                    attacker = {\r\n                        name: pos.threat.name,\r\n                        character: {\r\n                            name: pos.threat.name,\r\n                            stats: { STR: pos.threat.atk, END: pos.threat.def }\r\n                        },\r\n                        hp: pos.threat.hp,\r\n                        maxHp: pos.threat.maxHp,\r\n                        cardStack: [{ type: \"item\", subtype: \"weapon\", atk: pos.threat.atk }]\r\n                    };\r\n                    defender = pos.target === \"player\" ? gameState.player : gameState.opponent;\r\n                } else {\r\n                    attacker = pos.owner === \"player\" ? gameState.player : gameState.opponent;\r\n                    defender = pos.owner === \"player\" ? gameState.opponent : gameState.player;\r\n                }\r\n\r\n                // Resolve combat (pass stack for skill modifiers)\r\n                resolveCombat(attacker, defender, pos.stack);\r\n                resolutionPhase = \"result\";\r\n\r\n                // Trigger narrator for resolution (non-blocking, with fallback)\r\n                if (currentCombatResult) {\r\n                    triggerNarration(\"resolution\", {\r\n                        isPlayerAttack: pos.owner === \"player\",\r\n                        attackerName: isThreat ? pos.threat?.name : (pos.owner === \"player\" ? gameState.player.character?.name : gameState.opponent.character?.name),\r\n                        defenderName: isThreat ? (pos.target === \"player\" ? gameState.player.character?.name : gameState.opponent.character?.name) : (pos.owner === \"player\" ? gameState.opponent.character?.name : gameState.player.character?.name),\r\n                        outcome: currentCombatResult.outcome?.label || \"Hit\",\r\n                        damage: currentCombatResult.damageDealt || 0\r\n                    });\r\n                }\r\n\r\n                m.redraw();\r\n\r\n                // After showing result, mark as resolved\r\n                setTimeout(() => {\r\n                    pos.resolved = true;\r\n                    pos.combatResult = currentCombatResult;\r\n                    resolutionAnimating = false;\r\n                    resolutionPhase = \"done\";\r\n                    bar.resolveIndex++;\r\n\r\n                    // Exhausted check: if attack failed (miss/counter), check for hoarding\r\n                    if (currentCombatResult && currentCombatResult.outcome.damageMultiplier <= 0) {\r\n                        let actionType = pos.stack?.coreCard?.name;\r\n                        let ownerKey = pos.owner;\r\n                        let ownerActor = ownerKey === \"player\" ? gameState.player : gameState.opponent;\r\n                        let ownerName = ownerKey === \"player\" ? \"Player\" : \"Opponent\";\r\n\r\n                        let exhaustedResult = checkExhausted(ownerActor, ownerName, actionType);\r\n                        if (exhaustedResult) {\r\n                            // Store for UI display\r\n                            if (!gameState.exhaustedThisRound) gameState.exhaustedThisRound = [];\r\n                            gameState.exhaustedThisRound.push({\r\n                                owner: ownerKey,\r\n                                actionType: exhaustedResult.actionType,\r\n                                stripped: exhaustedResult.stripped\r\n                            });\r\n                            console.log(\"[CardGame v2] Exhausted triggered for\", ownerName, \"- stripped\", exhaustedResult.stripped, exhaustedResult.actionType);\r\n                        }\r\n                    }\r\n\r\n                    // Handle threat resolution outcome\r\n                    if (isThreat && pos.threat) {\r\n                        let targetActor = pos.target === \"player\" ? gameState.player : gameState.opponent;\r\n                        let targetName = pos.target === \"player\" ? \"Player\" : \"Opponent\";\r\n\r\n                        // Check if defender won (threat missed or was countered)\r\n                        if (currentCombatResult && currentCombatResult.outcome.damageMultiplier <= 0) {\r\n                            // Defender survived/won - grant loot\r\n                            console.log(\"[CardGame v2]\", targetName, \"defeated the threat! Loot earned:\", pos.threat.lootRarity);\r\n\r\n                            // Create loot card based on threat rarity\r\n                            let lootCard = {\r\n                                type: \"item\",\r\n                                subtype: \"consumable\",\r\n                                name: \"Threat Loot (\" + pos.threat.lootRarity + \")\",\r\n                                rarity: pos.threat.lootRarity,\r\n                                effect: pos.threat.lootRarity === \"RARE\" ? \"Restore 5 HP\" : \"Restore 3 HP\",\r\n                                flavor: \"Spoils from defeating \" + pos.threat.name\r\n                            };\r\n                            targetActor.hand.push(lootCard);\r\n\r\n                            // Store threat result for UI\r\n                            if (!gameState.threatResults) gameState.threatResults = [];\r\n                            gameState.threatResults.push({\r\n                                threatName: pos.threat.name,\r\n                                target: pos.target,\r\n                                outcome: \"defeated\",\r\n                                loot: lootCard.name\r\n                            });\r\n                        } else {\r\n                            // Threat hit the defender\r\n                            console.log(\"[CardGame v2]\", targetName, \"was hit by\", pos.threat.name);\r\n\r\n                            if (!gameState.threatResults) gameState.threatResults = [];\r\n                            gameState.threatResults.push({\r\n                                threatName: pos.threat.name,\r\n                                target: pos.target,\r\n                                outcome: \"hit\",\r\n                                damage: currentCombatResult?.damageResult?.finalDamage || 0\r\n                            });\r\n                        }\r\n                    }\r\n\r\n                    // Move played cards to owner's discard pile (or return magic to hand)\r\n                    if (pos.stack && pos.stack.coreCard && !isThreat) {\r\n                        let owner = pos.owner === \"player\" ? gameState.player : gameState.opponent;\r\n                        let coreCard = pos.stack.coreCard;\r\n\r\n                        // Magic cards return to hand (reusable)\r\n                        if (coreCard.type === \"magic\" && coreCard.reusable !== false) {\r\n                            owner.hand.push(coreCard);\r\n                            console.log(\"[CardGame v2] Magic card\", coreCard.name, \"returned to hand\");\r\n                        } else {\r\n                            owner.discardPile.push(coreCard);\r\n                        }\r\n\r\n                        // Modifiers always go to discard\r\n                        pos.stack.modifiers.forEach(mod => owner.discardPile.push(mod));\r\n                    }\r\n\r\n                    // Check for game over after each combat\r\n                    let winner = checkGameOver(gameState);\r\n                    if (winner) {\r\n                        gameState.winner = winner;\r\n                        gameState.phase = \"GAME_OVER\";\r\n                        m.redraw();\r\n                        return;\r\n                    }\r\n\r\n                    m.redraw();\r\n\r\n                    // Auto-advance after 3 seconds total between actions\r\n                    if (bar.resolveIndex < bar.positions.length) {\r\n                        setTimeout(() => advanceResolution(), 1500);  // 1.5s after result shown\r\n                    } else {\r\n                        setTimeout(() => advancePhase(), 1000);\r\n                    }\r\n                }, 1500);  // Show result for 1.5 seconds (total ~3s per action)\r\n            }, 1500);  // Roll dice for 1.5 seconds\r\n        } else {\r\n            // Non-combat action (Rest, Flee, etc.) - simple resolution\r\n            resolutionAnimating = true;\r\n            currentCombatResult = null;\r\n\r\n            setTimeout(() => {\r\n                pos.resolved = true;\r\n                resolutionAnimating = false;\r\n                bar.resolveIndex++;\r\n\r\n                // Handle non-combat actions\r\n                if (card) {\r\n                    let owner = pos.owner === \"player\" ? gameState.player : gameState.opponent;\r\n                    let target = pos.owner === \"player\" ? gameState.opponent : gameState.player;\r\n\r\n                    // Rest action: restore HP and Energy\r\n                    if (card.name === \"Rest\") {\r\n                        let hpBefore = owner.hp;\r\n                        let energyBefore = owner.energy;\r\n                        let moraleBefore = owner.morale;\r\n                        owner.hp = Math.min(owner.maxHp, owner.hp + 2);\r\n                        owner.energy = Math.min(owner.maxEnergy, owner.energy + 3);\r\n                        owner.morale = Math.min(owner.maxMorale, owner.morale + 2);\r\n                        console.log(\"[CardGame v2]\", pos.owner, \"rested:\",\r\n                            \"HP\", hpBefore, \"->\", owner.hp, \"(max:\" + owner.maxHp + \")\",\r\n                            \"| Energy\", energyBefore, \"->\", owner.energy,\r\n                            \"| Morale\", moraleBefore, \"->\", owner.morale);\r\n                    } else {\r\n                        console.log(\"[CardGame v2] Non-combat action card:\", card.name, card.type);\r\n                    }\r\n\r\n                    // Guard/Defend action: gain shielded status\r\n                    if (card.name === \"Guard\" || card.name === \"Defend\") {\r\n                        applyStatusEffect(owner, \"shielded\", card.name);\r\n                        console.log(\"[CardGame v2]\", pos.owner, \"is now shielded (+3 DEF until hit)\");\r\n                    }\r\n\r\n                    // Flee action: AGI roll to escape (forfeit pot, end combat)\r\n                    if (card.name === \"Flee\" || card.name === \"Escape\") {\r\n                        let ownerAgi = owner.character.stats?.AGI || 10;\r\n                        let fleeRoll = rollD20() + ownerAgi;\r\n                        let fleeDC = 12;  // Base difficulty, could be modified by encounter\r\n\r\n                        if (fleeRoll >= fleeDC) {\r\n                            console.log(\"[CardGame v2]\", pos.owner, \"fled successfully! Roll:\", fleeRoll, \"vs DC\", fleeDC);\r\n                            // Forfeit pot to opponent\r\n                            if (gameState.pot.length > 0) {\r\n                                let other = pos.owner === \"player\" ? gameState.opponent : gameState.player;\r\n                                gameState.pot.forEach(c => other.discardPile.push(c));\r\n                                gameState.pot = [];\r\n                                console.log(\"[CardGame v2] Pot forfeited to\", pos.owner === \"player\" ? \"opponent\" : \"player\");\r\n                            }\r\n                            // End the round early (skip remaining actions)\r\n                            bar.resolveIndex = bar.positions.length;\r\n                        } else {\r\n                            console.log(\"[CardGame v2]\", pos.owner, \"flee failed! Roll:\", fleeRoll, \"vs DC\", fleeDC);\r\n                            // Failed flee - lose morale\r\n                            owner.morale = Math.max(0, owner.morale - 2);\r\n                        }\r\n                    }\r\n\r\n                    // Investigate action: INT roll to reveal information\r\n                    if (card.name === \"Investigate\" || card.name === \"Search\") {\r\n                        let ownerInt = owner.character.stats?.INT || 10;\r\n                        let investRoll = rollD20() + ownerInt;\r\n                        let investDC = 10;\r\n\r\n                        if (investRoll >= investDC) {\r\n                            console.log(\"[CardGame v2]\", pos.owner, \"investigated successfully! Roll:\", investRoll);\r\n                            // Draw an extra card as reward\r\n                            drawCardsForActor(owner, 1);\r\n                        } else {\r\n                            console.log(\"[CardGame v2]\", pos.owner, \"investigation found nothing. Roll:\", investRoll);\r\n                        }\r\n                    }\r\n\r\n                    // Use Item action: apply consumable effect\r\n                    if (card.type === \"item\" && card.subtype === \"consumable\") {\r\n                        // Use unified effect parser for consumable effects\r\n                        let parsed = parseEffect(card.effect || \"\");\r\n                        let log = applyParsedEffects(parsed, owner, target, card.name);\r\n                        log.forEach(msg => console.log(\"[CardGame v2]\", pos.owner, \"used:\", msg));\r\n                        // Consumables are NOT returned to hand - they stay in discard\r\n                    }\r\n\r\n                    // Feint action: weaken opponent's next defense\r\n                    if (card.name === \"Feint\") {\r\n                        applyStatusEffect(target, \"weakened\", card.name);\r\n                        console.log(\"[CardGame v2]\", pos.owner, \"feinted! Target is weakened (-2 all rolls)\");\r\n                    }\r\n\r\n                    // Trade action: exchange items (vs AI: auto-decline unless items offered)\r\n                    if (card.name === \"Trade\") {\r\n                        let offeredItems = (pos.stack?.modifiers || []).filter(m => m.type === \"item\");\r\n                        if (offeredItems.length > 0) {\r\n                            // AI evaluates trade: 50% accept if items of equal or greater value offered\r\n                            let acceptChance = 0.5;\r\n                            if (Math.random() < acceptChance) {\r\n                                // Accept: AI gives a random item from hand in exchange\r\n                                let aiItems = target.hand.filter(c => c.type === \"item\");\r\n                                if (aiItems.length > 0) {\r\n                                    let giveItem = aiItems[Math.floor(Math.random() * aiItems.length)];\r\n                                    target.hand = target.hand.filter(c => c !== giveItem);\r\n                                    owner.hand.push(giveItem);\r\n                                    // Give offered items to AI\r\n                                    offeredItems.forEach(item => {\r\n                                        owner.hand = owner.hand.filter(c => c !== item);\r\n                                        target.hand.push(item);\r\n                                    });\r\n                                    console.log(\"[CardGame v2] Trade accepted!\", owner.name, \"gave\", offeredItems.map(i => i.name).join(\", \"), \"received\", giveItem.name);\r\n                                    pos.tradeResult = { accepted: true, gave: offeredItems, received: [giveItem] };\r\n                                } else {\r\n                                    console.log(\"[CardGame v2] Trade declined - AI has no items to trade\");\r\n                                    pos.tradeResult = { accepted: false, reason: \"No items available\" };\r\n                                }\r\n                            } else {\r\n                                console.log(\"[CardGame v2] Trade declined by opponent\");\r\n                                pos.tradeResult = { accepted: false, reason: \"Declined\" };\r\n                            }\r\n                        } else {\r\n                            console.log(\"[CardGame v2] Trade failed - no items offered\");\r\n                            pos.tradeResult = { accepted: false, reason: \"No items offered\" };\r\n                        }\r\n                    }\r\n\r\n                    // Craft action: INT roll to create item from materials\r\n                    if (card.name === \"Craft\") {\r\n                        let ownerInt = owner.character.stats?.INT || 10;\r\n                        let materials = (pos.stack?.modifiers || []).filter(m => m.type === \"item\" && m.subtype === \"material\");\r\n\r\n                        if (materials.length >= 2) {\r\n                            let craftRoll = rollD20() + ownerInt;\r\n                            let craftDC = 12 + (materials.length * 2);  // Harder with more materials\r\n\r\n                            if (craftRoll >= craftDC) {\r\n                                // Success: create item based on materials\r\n                                let craftedItem = {\r\n                                    type: \"item\",\r\n                                    subtype: \"consumable\",\r\n                                    name: \"Crafted \" + materials[0].name + \" Potion\",\r\n                                    effect: \"Restore \" + (5 + materials.length) + \" HP\",\r\n                                    rarity: materials.length >= 3 ? \"RARE\" : \"COMMON\",\r\n                                    flavor: \"Crafted from \" + materials.map(m => m.name).join(\" + \")\r\n                                };\r\n                                owner.hand.push(craftedItem);\r\n                                // Remove materials from hand\r\n                                materials.forEach(mat => {\r\n                                    owner.hand = owner.hand.filter(c => c !== mat);\r\n                                });\r\n                                console.log(\"[CardGame v2] Crafting success! Roll:\", craftRoll, \"vs DC\", craftDC, \"- Created:\", craftedItem.name);\r\n                                pos.craftResult = { success: true, roll: craftRoll, dc: craftDC, created: craftedItem };\r\n                            } else {\r\n                                console.log(\"[CardGame v2] Crafting failed. Roll:\", craftRoll, \"vs DC\", craftDC);\r\n                                // Lose one material on failure\r\n                                if (materials.length > 0) {\r\n                                    let lostMat = materials[0];\r\n                                    owner.hand = owner.hand.filter(c => c !== lostMat);\r\n                                    owner.discardPile.push(lostMat);\r\n                                }\r\n                                pos.craftResult = { success: false, roll: craftRoll, dc: craftDC };\r\n                            }\r\n                        } else {\r\n                            console.log(\"[CardGame v2] Crafting failed - need at least 2 materials\");\r\n                            pos.craftResult = { success: false, reason: \"Insufficient materials\" };\r\n                        }\r\n                    }\r\n\r\n                    // Talk action: Open chat UI for player, dice roll for AI\r\n                    if (card.type === \"talk\") {\r\n                        if (pos.owner === \"player\") {\r\n                            // Player Talk: Open chat UI (Phase 8)\r\n                            // Chat works with or without LLM - will use fallback responses if needed\r\n                            console.log(\"[CardGame v2] Opening Talk chat. LLM available:\", !!gameChatManager?.initialized);\r\n                            if (openTalkChat) openTalkChat(card, bar.resolveIndex);\r\n                            // Resolution continues when chat ends\r\n                            return;  // Don't auto-advance - chat will handle it\r\n                        } else {\r\n                            // Opponent Talk: Use dice roll\r\n                            let ownerCha = owner.character.stats?.CHA || 10;\r\n                            let targetCha = target.character.stats?.CHA || 10;\r\n                            let skillMod = getStackSkillMod(pos.stack, \"talk\");\r\n\r\n                            let ownerRoll = rollD20() + ownerCha + skillMod;\r\n                            let targetRoll = rollD20() + targetCha;\r\n\r\n                            if (ownerRoll > targetRoll) {\r\n                                let moraleDmg = Math.max(1, Math.floor((ownerRoll - targetRoll) / 2));\r\n                                target.morale = Math.max(0, target.morale - moraleDmg);\r\n                                owner.morale = Math.min(owner.maxMorale, owner.morale + 1);\r\n                                console.log(\"[CardGame v2]\", pos.owner, \"Talk success! Target morale -\" + moraleDmg + \", own +1\");\r\n                            } else {\r\n                                owner.morale = Math.max(0, owner.morale - 1);\r\n                                console.log(\"[CardGame v2]\", pos.owner, \"Talk failed. Own morale -1\");\r\n                            }\r\n\r\n                            if (target.morale <= 0) {\r\n                                console.log(\"[CardGame v2] Target surrendered due to morale!\");\r\n                                gameState.winner = pos.owner;\r\n                                gameState.phase = \"GAME_OVER\";\r\n                                m.redraw();\r\n                                return;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Magic card resolution\r\n                    if (card.type === \"magic\") {\r\n                        let ownerStats = owner.character.stats || {};\r\n                        let fizzled = false;\r\n\r\n                        // Check stat requirements (fizzle if not met)\r\n                        if (card.requires) {\r\n                            for (let stat in card.requires) {\r\n                                let required = card.requires[stat];\r\n                                let actual = ownerStats[stat] || 0;\r\n                                if (actual < required) {\r\n                                    fizzled = true;\r\n                                    console.log(\"[CardGame v2] Spell fizzled!\", card.name, \"requires\", stat, required, \"but actor has\", actual);\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        if (!fizzled) {\r\n                            // Use unified effect parser for all magic effects\r\n                            let parsed = parseEffect(card.effect || \"\");\r\n                            let log = applyParsedEffects(parsed, owner, target, card.name);\r\n                            log.forEach(msg => console.log(\"[CardGame v2]\", pos.owner, \"cast:\", msg));\r\n\r\n                            // Check for defeat after damage\r\n                            if (parsed.damage && target.hp <= 0) {\r\n                                gameState.winner = pos.owner;\r\n                                gameState.phase = \"GAME_OVER\";\r\n                                m.redraw();\r\n                                return;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // Move played cards to discard pile OR return magic to hand\r\n                    if (card.type === \"magic\" && card.reusable !== false) {\r\n                        // Magic cards return to hand (reusable)\r\n                        owner.hand.push(card);\r\n                        console.log(\"[CardGame v2] Magic card\", card.name, \"returned to hand\");\r\n                    } else {\r\n                        owner.discardPile.push(card);\r\n                    }\r\n\r\n                    // Modifiers always go to discard\r\n                    if (pos.stack.modifiers) {\r\n                        pos.stack.modifiers.forEach(mod => owner.discardPile.push(mod));\r\n                    }\r\n                }\r\n\r\n                m.redraw();\r\n\r\n                // Auto-advance after ~3 seconds total\r\n                if (bar.resolveIndex < bar.positions.length) {\r\n                    setTimeout(() => advanceResolution(), 2000);\r\n                } else {\r\n                    setTimeout(() => advancePhase(), 1000);\r\n                }\r\n            }, 1000);  // Show action result for 1 second\r\n        }\r\n\r\n        m.redraw();\r\n    }\r\n\r\n    //  Export \r\n    window.CardGame.GameState = {\r\n        // Mutable state (accessed via getters/setters for encapsulation)\r\n        state: {\r\n            get gameState() { return gameState; },\r\n            set gameState(v) { gameState = v; },\r\n            get gameCharSelection() { return gameCharSelection; },\r\n            set gameCharSelection(v) { gameCharSelection = v; },\r\n            get initAnimState() { return initAnimState; },\r\n            set initAnimState(v) { initAnimState = v; },\r\n            get llmStatus() { return llmStatus; },\r\n            set llmStatus(v) { llmStatus = v; },\r\n            get gameDirector() { return gameDirector; },\r\n            set gameDirector(v) { gameDirector = v; },\r\n            get gameNarrator() { return gameNarrator; },\r\n            set gameNarrator(v) { gameNarrator = v; },\r\n            get gameChatManager() { return gameChatManager; },\r\n            set gameChatManager(v) { gameChatManager = v; },\r\n            get gameVoice() { return gameVoice; },\r\n            set gameVoice(v) { gameVoice = v; },\r\n            get gameAnnouncerVoice() { return gameAnnouncerVoice; },\r\n            set gameAnnouncerVoice(v) { gameAnnouncerVoice = v; },\r\n            get activeCampaign() { return activeCampaign; },\r\n            set activeCampaign(v) { activeCampaign = v; },\r\n            get levelUpState() { return levelUpState; },\r\n            set levelUpState(v) { levelUpState = v; },\r\n            // Resolution animation sub-state (read by UI renderers)\r\n            get resolutionAnimating() { return resolutionAnimating; },\r\n            set resolutionAnimating(v) { resolutionAnimating = v; },\r\n            get resolutionPhase() { return resolutionPhase; },\r\n            set resolutionPhase(v) { resolutionPhase = v; },\r\n            get resolutionDiceFaces() { return resolutionDiceFaces; },\r\n            set resolutionDiceFaces(v) { resolutionDiceFaces = v; },\r\n            get currentCombatResult() { return currentCombatResult; },\r\n            set currentCombatResult(v) { currentCombatResult = v; }\r\n        },\r\n\r\n        // Convenience getters/setters\r\n        getGameState: () => gameState,\r\n        setGameState: (s) => { gameState = s; },\r\n        getGameCharSelection: () => gameCharSelection,\r\n        setGameCharSelection: (s) => { gameCharSelection = s; },\r\n\r\n        // LLM connectivity\r\n        checkLlmConnectivity,\r\n\r\n        // Game state creation\r\n        createGameState,\r\n\r\n        // LLM component initialization\r\n        initializeLLMComponents,\r\n\r\n        // Narration system\r\n        triggerNarration,\r\n        narrateGameStart,\r\n        narrateGameEnd,\r\n        narrateRoundStart,\r\n        narrateRoundEnd,\r\n        showNarrationSubtitle,\r\n        buildEmotionContext,\r\n\r\n        // Initiative\r\n        resetInitAnimState,\r\n        startInitiativeAnimation,\r\n        runInitiativePhase,\r\n\r\n        // Phase transitions\r\n        advancePhase,\r\n        enterDrawPlacementPhase,\r\n        enterThreatResponsePhase,\r\n        enterEndThreatPhase,\r\n\r\n        // Threat combat\r\n        resolveThreatCombat,\r\n        resolveEndThreatCombat,\r\n        placeThreatDefenseCard,\r\n        skipThreatResponse,\r\n\r\n        // Round management\r\n        startNextRound,\r\n\r\n        // Campaign\r\n        applyCampaignBonuses,\r\n\r\n        // Resolution driver\r\n        advanceResolution\r\n    };\r\n\r\n    console.log('[CardGame] State/gameState loaded (' +\r\n        Object.keys(window.CardGame.GameState).length + ' exports)');\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/ai/llmBase.js === */\n/**\r\n * CardGame AI -- LLM Base Class\r\n * Shared LLM infrastructure for Director, Narrator, and Chat.\r\n * Extracted from cardGame-v2.js (lines ~6449-6617).\r\n *\r\n * Exposes: window.CardGame.AI.CardGameLLM\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.AI = window.CardGame.AI || {};\r\n\r\n    //  CardGameLLM Base Class \r\n    // Shared LLM infrastructure for Director, Narrator, and Chat\r\n    class CardGameLLM {\r\n        constructor() {\r\n            this.chatRequest = null;\r\n            this.chatConfig = null;\r\n            this.promptConfig = null;\r\n            this.initialized = false;\r\n            this.lastError = null;\r\n        }\r\n\r\n        // Find the ~/Chat directory\r\n        static async findChatDir() {\r\n            const chatDir = await page.findObject(\"auth.group\", \"DATA\", \"~/Chat\");\r\n            if (!chatDir) {\r\n                console.warn(\"[CardGameLLM] ~/Chat not found\");\r\n            }\r\n            return chatDir;\r\n        }\r\n\r\n        // Get the \"Open Chat\" template config\r\n        static async getOpenChatTemplate(chatDir) {\r\n            const chatConfigs = await am7client.list(\"olio.llm.chatConfig\", chatDir.objectId, null, 0, 0);\r\n            const templateCfg = chatConfigs.find(c => c.name === \"Open Chat\");\r\n            if (!templateCfg) {\r\n                console.warn(\"[CardGameLLM] 'Open Chat' config not found\");\r\n                return null;\r\n            }\r\n            return am7client.getFull(\"olio.llm.chatConfig\", templateCfg.objectId);\r\n        }\r\n\r\n        // Ensure a prompt config exists (create or find) using am7chat.makePrompt\r\n        static async ensurePromptConfig(chatDir, name, systemPrompt) {\r\n            try {\r\n                // Delegate to am7chat.makePrompt which correctly handles\r\n                // the 'system' array field and create-or-find logic\r\n                let cfg = await am7chat.makePrompt(name, [systemPrompt]);\r\n                return cfg;\r\n            } catch (err) {\r\n                console.error(\"[CardGameLLM] ensurePromptConfig failed:\", err);\r\n                return null;\r\n            }\r\n        }\r\n\r\n        // Ensure a chat config exists (find existing or create from template)\r\n        static async ensureChatConfig(chatDir, template, name, temperature) {\r\n            try {\r\n                // Search for existing config using page API (same pattern as am7chat.makeChat)\r\n                let q = am7view.viewQuery(am7model.newInstance(\"olio.llm.chatConfig\"));\r\n                q.field(\"groupId\", chatDir.id);\r\n                q.field(\"name\", name);\r\n                q.cache(false);\r\n                let qr = await page.search(q);\r\n\r\n                if (qr?.results?.length > 0) {\r\n                    return qr.results[0];\r\n                }\r\n\r\n                // Clone from template and create via page API\r\n                let icfg = am7model.newInstance(\"olio.llm.chatConfig\");\r\n                icfg.api.groupId(chatDir.id);\r\n                icfg.api.groupPath(chatDir.path);\r\n                icfg.api.name(name);\r\n                // Copy relevant fields from template\r\n                if (template.model) icfg.api.model(template.model);\r\n                if (template.serverUrl) icfg.api.serverUrl(template.serverUrl);\r\n                if (template.serviceType) icfg.api.serviceType(template.serviceType);\r\n                if (template.messageTrim) icfg.api.messageTrim(template.messageTrim);\r\n                await page.createObject(icfg.entity);\r\n\r\n                // Re-search to get the created object\r\n                qr = await page.search(q);\r\n                if (qr?.results?.length > 0) {\r\n                    return qr.results[0];\r\n                }\r\n                return null;\r\n            } catch (err) {\r\n                console.error(\"[CardGameLLM] ensureChatConfig failed:\", err);\r\n                return null;\r\n            }\r\n        }\r\n\r\n        // Extract text content from LLM response\r\n        static extractContent(response) {\r\n            if (!response) return \"\";\r\n            if (response.messages?.length > 0) {\r\n                const lastMsg = response.messages[response.messages.length - 1];\r\n                return lastMsg.content || lastMsg.text || \"\";\r\n            }\r\n            return response.content || response.text || String(response);\r\n        }\r\n\r\n        // Clean JSON from LLM response (strip markdown, fix common issues)\r\n        static cleanJsonResponse(content) {\r\n            if (!content) return null;\r\n\r\n            let cleaned = content\r\n                .replace(/```json\\s*/gi, \"\")\r\n                .replace(/```\\s*/g, \"\")\r\n                .replace(/^[^{]*/, \"\")\r\n                .replace(/[^}]*$/, \"\")\r\n                .trim();\r\n\r\n            if (!cleaned) return null;\r\n\r\n            // Fix common JSON issues\r\n            cleaned = cleaned\r\n                .replace(/,(\\s*[}\\]])/g, \"$1\")\r\n                .replace(/'/g, '\"');\r\n\r\n            return cleaned;\r\n        }\r\n\r\n        // Initialize LLM with standard pattern\r\n        async initializeLLM(chatName, promptName, systemPrompt, temperature) {\r\n            try {\r\n                // Check if am7chat is available\r\n                if (typeof am7chat === \"undefined\" || !am7chat) {\r\n                    this.lastError = \"am7chat not available\";\r\n                    console.warn(\"[CardGameLLM] am7chat not available - LLM features disabled\");\r\n                    return false;\r\n                }\r\n\r\n                const chatDir = await CardGameLLM.findChatDir();\r\n                if (!chatDir) {\r\n                    this.lastError = \"~/Chat directory not found\";\r\n                    return false;\r\n                }\r\n\r\n                const template = await CardGameLLM.getOpenChatTemplate(chatDir);\r\n                if (!template) {\r\n                    this.lastError = \"Open Chat template not found\";\r\n                    return false;\r\n                }\r\n\r\n                this.promptConfig = await CardGameLLM.ensurePromptConfig(chatDir, promptName, systemPrompt);\r\n                if (!this.promptConfig) {\r\n                    this.lastError = \"Failed to create prompt config\";\r\n                    return false;\r\n                }\r\n\r\n                this.chatConfig = await CardGameLLM.ensureChatConfig(chatDir, template, chatName, temperature);\r\n                if (!this.chatConfig) {\r\n                    this.lastError = \"Failed to create chat config\";\r\n                    return false;\r\n                }\r\n\r\n                this.chatRequest = await am7chat.getChatRequest(chatName, this.chatConfig, this.promptConfig);\r\n                this.initialized = !!this.chatRequest;\r\n                if (!this.initialized) {\r\n                    this.lastError = \"Failed to get chat request\";\r\n                }\r\n                return this.initialized;\r\n            } catch (err) {\r\n                this.lastError = err.message || String(err);\r\n                console.error(\"[CardGameLLM] initializeLLM failed:\", err);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        // Send a message and get response\r\n        async chat(prompt) {\r\n            if (!this.initialized || !this.chatRequest) return null;\r\n            try {\r\n                return await am7chat.chat(this.chatRequest, prompt);\r\n            } catch (err) {\r\n                this.lastError = err.message;\r\n                throw err;\r\n            }\r\n        }\r\n    }\r\n\r\n    window.CardGame.AI.CardGameLLM = CardGameLLM;\r\n\r\n    console.log(\"[CardGame] AI/llmBase loaded\");\r\n}());\r\n\n\n;/* === client/view/cardGame/ai/director.js === */\n/**\r\n * CardGame AI -- Director (LLM-powered AI Opponent)\r\n * Extracted from cardGame-v2.js (lines ~6619-6806, 6971-7006, 7282-7424).\r\n *\r\n * Includes:\r\n *   - CardGameDirector  (extends CardGameLLM)\r\n *   - applyAIDecision   (applies director's JSON to game state)\r\n *   - aiPlaceCards       (async entry point -- tries LLM then FIFO fallback)\r\n *   - checkPlacementComplete (advances turn / phase when both sides done)\r\n *\r\n * Depends on (via CardGame namespace -- late-bound):\r\n *   CardGame.AI.CardGameLLM          (llmBase.js)\r\n *   CardGame.Engine.isCoreCardType   (engine/combat.js -- future)\r\n *   CardGame.Engine.drawCardsForActor(engine/actions.js -- future)\r\n *   CardGame.State.gameState         (state/gameState.js -- future)\r\n *   CardGame.Engine.advancePhase     (engine/actions.js -- future)\r\n *   CardGame.Engine.checkGameOver    (engine/combat.js -- future)\r\n *   CardGame.Constants.GAME_PHASES   (constants/gameConstants.js)\r\n *\r\n * Exposes: window.CardGame.AI.{ CardGameDirector, applyAIDecision,\r\n *                                 aiPlaceCards, checkPlacementComplete }\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.AI = window.CardGame.AI || {};\r\n\r\n    const CardGameLLM = window.CardGame.AI.CardGameLLM;\r\n\r\n    //  Lazy accessors for cross-module dependencies \r\n    // These modules may not be loaded yet when this file is parsed;\r\n    // we resolve them at call-time so load order doesn't matter.\r\n    function getGameState()      { return window.CardGame.State?.gameState; }\r\n    function getConstants()      { return window.CardGame.Constants; }\r\n    function isCoreCardType(t)   { return window.CardGame.Engine?.isCoreCardType?.(t); }\r\n    function drawCardsForActor(a, n) { return window.CardGame.Engine?.drawCardsForActor?.(a, n); }\r\n    function advancePhase()      { return window.CardGame.Engine?.advancePhase?.(); }\r\n    function checkGameOver()     { return window.CardGame.Engine?.checkGameOver?.(); }\r\n\r\n    //  Load external prompts (optional) \r\n    let directorPrompts = null;\r\n\r\n    async function loadDirectorPrompts() {\r\n        if (directorPrompts) return directorPrompts;\r\n        try {\r\n            directorPrompts = await m.request({\r\n                method: \"GET\",\r\n                url: \"media/cardGame/prompts/director-system.json\"\r\n            });\r\n        } catch (e) {\r\n            console.warn(\"[CardGameDirector] Could not load director prompts, using defaults\");\r\n            directorPrompts = null;\r\n        }\r\n        return directorPrompts;\r\n    }\r\n\r\n    //  CardGameDirector \r\n    // LLM-powered AI opponent decision making\r\n    let gameDirector = null;\r\n\r\n    class CardGameDirector extends CardGameLLM {\r\n        constructor() {\r\n            super();\r\n            this.personality = null;\r\n            this.lastDirective = null;\r\n            this.consecutiveErrors = 0;\r\n        }\r\n\r\n        async initialize(opponentChar, themeId) {\r\n            console.log(\"[CardGameDirector] Initializing for theme:\", themeId);\r\n            await loadDirectorPrompts();\r\n            this.personality = this._extractPersonality(opponentChar);\r\n            const systemPrompt = this._buildSystemPrompt(opponentChar, themeId);\r\n            const ok = await this.initializeLLM(\r\n                \"CardGame AI Opponent\",\r\n                \"CardGame AI Prompt\",\r\n                systemPrompt,\r\n                0.4  // Low temperature for consistent decisions\r\n            );\r\n            if (ok) console.log(\"[CardGameDirector] Initialized successfully\");\r\n            return ok;\r\n        }\r\n\r\n        _extractPersonality(charPerson) {\r\n            if (!charPerson) return \"balanced\";\r\n            const alignment = charPerson.alignment || \"\";\r\n            if (alignment.includes(\"EVIL\") || alignment.includes(\"CHAOTIC\")) return \"aggressive\";\r\n            if (alignment.includes(\"LAWFUL\") || alignment.includes(\"GOOD\")) return \"tactical\";\r\n            return \"balanced\";\r\n        }\r\n\r\n        _buildSystemPrompt(opponentChar, themeId) {\r\n            // Use loaded prompts if available\r\n            if (directorPrompts?.systemPrompt) {\r\n                let prompt = directorPrompts.systemPrompt;\r\n                const name = opponentChar?.name || \"AI Opponent\";\r\n                const personality = this.personality || \"balanced\";\r\n                // Substitute template variables\r\n                prompt = prompt.replace(/\\{name\\}/g, name)\r\n                               .replace(/\\{themeId\\}/g, themeId || \"unknown\")\r\n                               .replace(/\\{personality\\}/g, personality);\r\n                return prompt;\r\n            }\r\n\r\n            // Hardcoded fallback\r\n            const name = opponentChar?.name || \"AI Opponent\";\r\n            const personality = this.personality || \"balanced\";\r\n\r\n            return `You are ${name}, an AI opponent in a card game. Theme: ${themeId}.\r\nPersonality: ${personality}\r\n\r\nYou receive game state JSON and respond with placement decision JSON.\r\nGoal: reduce player HP or morale to 0.\r\n\r\nResponse format:\r\n{\"stacks\":[{\"position\":2,\"coreCard\":\"Attack\"}],\"strategy\":\"brief\"}\r\n\r\nRules:\r\n- \"position\" must be from availablePositions array\r\n- \"coreCard\" must match a card name in your hand exactly\r\n- Optional: \"modifiers\" array of skill card names from hand\r\n- Place up to your AP cards\r\n- Consider energy costs\r\n\r\nReply with ONLY the JSON object, no markdown or text.`;\r\n        }\r\n\r\n        async requestPlacement(gameState) {\r\n            if (!this.initialized || !this.chatRequest) {\r\n                return this._fifoFallback(gameState);\r\n            }\r\n\r\n            const prompt = this._buildPlacementPrompt(gameState);\r\n\r\n            try {\r\n                const response = await am7chat.chat(this.chatRequest, prompt);\r\n                const content = CardGameLLM.extractContent(response);\r\n                const directive = this._parseDirective(content);\r\n\r\n                if (directive && directive.stacks) {\r\n                    this.lastDirective = directive;\r\n                    this.consecutiveErrors = 0;\r\n                    console.log(\"[CardGameDirector] LLM decision:\", directive);\r\n                    return directive;\r\n                }\r\n\r\n                // Retry once on parse failure\r\n                console.warn(\"[CardGameDirector] Parse failed, retrying...\");\r\n                const retryResponse = await am7chat.chat(this.chatRequest, prompt + \"\\n\\nIMPORTANT: Output ONLY valid JSON, no markdown.\");\r\n                const retryContent = CardGameLLM.extractContent(retryResponse);\r\n                const retryDirective = this._parseDirective(retryContent);\r\n\r\n                if (retryDirective && retryDirective.stacks) {\r\n                    this.lastDirective = retryDirective;\r\n                    return retryDirective;\r\n                }\r\n\r\n                page.toast(\"warn\", \"AI decision unclear, using default\");\r\n                return this._fifoFallback(gameState);\r\n\r\n            } catch (err) {\r\n                this.consecutiveErrors++;\r\n                this.lastError = err.message;\r\n                console.error(\"[CardGameDirector] Placement request failed:\", err);\r\n\r\n                if (this.consecutiveErrors === 1) {\r\n                    page.toast(\"warn\", \"AI unavailable, using default placement\");\r\n                }\r\n\r\n                return this._fifoFallback(gameState);\r\n            }\r\n        }\r\n\r\n        _buildPlacementPrompt(gameState) {\r\n            const opp = gameState.opponent;\r\n            const player = gameState.player;\r\n\r\n            return JSON.stringify({\r\n                type: \"placement\",\r\n                round: gameState.roundNumber,\r\n                yourTurn: gameState.currentTurn === \"opponent\",\r\n                ai: {\r\n                    ap: opp.ap - opp.apUsed,\r\n                    energy: opp.needs?.energy || 14,\r\n                    hp: opp.needs?.hp || 20,\r\n                    morale: opp.needs?.morale || 20,\r\n                    hand: opp.hand.map(c => ({\r\n                        name: c.name,\r\n                        type: c.type,\r\n                        energyCost: c.energyCost || 0,\r\n                        atk: c.atk,\r\n                        effect: c.effect || c.onHit\r\n                    }))\r\n                },\r\n                player: {\r\n                    hp: player.needs?.hp || 20,\r\n                    energy: player.needs?.energy || 14,\r\n                    morale: player.needs?.morale || 20\r\n                },\r\n                availablePositions: gameState.initiative.opponentPositions\r\n            }, null, 0);\r\n        }\r\n\r\n        _parseDirective(content) {\r\n            if (!content) return null;\r\n            console.log(\"[CardGameDirector] Raw response:\", content.substring(0, 200));\r\n\r\n            const cleaned = CardGameLLM.cleanJsonResponse(content);\r\n            if (!cleaned) {\r\n                console.warn(\"[CardGameDirector] No JSON found in response\");\r\n                return null;\r\n            }\r\n\r\n            try {\r\n                const parsed = JSON.parse(cleaned);\r\n                if (parsed?.stacks && Array.isArray(parsed.stacks)) {\r\n                    return parsed;\r\n                }\r\n                console.warn(\"[CardGameDirector] Invalid structure - missing stacks array\");\r\n                return null;\r\n            } catch (e) {\r\n                console.warn(\"[CardGameDirector] JSON parse failed:\", e.message);\r\n                return null;\r\n            }\r\n        }\r\n\r\n        _fifoFallback(gameState) {\r\n            // Reuse existing simple AI logic\r\n            const opp = gameState.opponent;\r\n            const positions = gameState.initiative.opponentPositions;\r\n            const coreCards = opp.hand.filter(c => isCoreCardType(c.type));\r\n\r\n            const stacks = [];\r\n            let cardsUsed = [];\r\n\r\n            for (const posIdx of positions) {\r\n                if (stacks.length >= opp.ap - opp.apUsed) break;\r\n                if (coreCards.length === 0) break;\r\n\r\n                const playable = coreCards.find(c => c.name === \"Attack\") ||\r\n                                coreCards.find(c => c.type === \"action\") ||\r\n                                coreCards[0];\r\n\r\n                if (playable && (!playable.energyCost || playable.energyCost <= opp.needs?.energy)) {\r\n                    stacks.push({\r\n                        position: posIdx,\r\n                        coreCard: playable.name,\r\n                        modifiers: [],\r\n                        target: \"player\"\r\n                    });\r\n                    coreCards.splice(coreCards.indexOf(playable), 1);\r\n                    cardsUsed.push(playable);\r\n                }\r\n            }\r\n\r\n            return { stacks, fallback: true };\r\n        }\r\n    }\r\n\r\n    //  Apply AI Decision \r\n    // Apply AI decision from CardGameDirector to game state\r\n    function applyAIDecision(decision) {\r\n        const gameState = getGameState();\r\n        if (!gameState || !decision || !decision.stacks) return;\r\n\r\n        const opp = gameState.opponent;\r\n\r\n        for (const stack of decision.stacks) {\r\n            const pos = gameState.actionBar.positions.find(p => p.index === stack.position);\r\n            if (!pos || pos.stack) continue;\r\n\r\n            // Find the core card by name\r\n            const coreCard = opp.hand.find(c => c.name === stack.coreCard);\r\n            if (!coreCard) continue;\r\n\r\n            // Check energy\r\n            if (coreCard.energyCost && coreCard.energyCost > (opp.needs?.energy || 0)) continue;\r\n\r\n            // Find modifier cards\r\n            const modifiers = (stack.modifiers || [])\r\n                .map(name => opp.hand.find(c => c.name === name))\r\n                .filter(Boolean);\r\n\r\n            // Place the stack\r\n            pos.stack = { coreCard, modifiers };\r\n            opp.apUsed++;\r\n\r\n            if (coreCard.energyCost) {\r\n                opp.needs.energy = (opp.needs.energy || 14) - coreCard.energyCost;\r\n            }\r\n\r\n            // Remove cards from hand\r\n            opp.hand = opp.hand.filter(c => c !== coreCard && !modifiers.includes(c));\r\n\r\n            console.log(\"[CardGame v2] AI placed:\", coreCard.name, \"at position\", stack.position);\r\n        }\r\n    }\r\n\r\n    //  Simple AI Card Placement \r\n    // Now with optional LLM integration via CardGameDirector\r\n    async function aiPlaceCards() {\r\n        const gameState = getGameState();\r\n        if (!gameState) return;\r\n\r\n        let opp = gameState.opponent;\r\n        let positions = gameState.initiative.opponentPositions;\r\n\r\n        console.log(\"[CardGame v2] AI placing cards. Hand:\", opp.hand.length, \"AP:\", opp.ap - opp.apUsed);\r\n\r\n        // Try LLM-based placement if director is available\r\n        if (gameDirector && gameDirector.initialized) {\r\n            try {\r\n                const decision = await gameDirector.requestPlacement(gameState);\r\n                if (decision && decision.stacks && !decision.fallback) {\r\n                    applyAIDecision(decision);\r\n                    checkPlacementComplete();\r\n                    m.redraw();\r\n                    return;\r\n                }\r\n            } catch (err) {\r\n                console.warn(\"[CardGame v2] Director placement failed, using fallback:\", err);\r\n            }\r\n        }\r\n\r\n        // Fallback: Simple FIFO placement\r\n        let coreCards = opp.hand.filter(c => isCoreCardType(c.type));\r\n        let modifierCards = opp.hand.filter(c => c.type === \"skill\");\r\n\r\n        // Phase 1: Place core cards (actions, talk, magic) on available positions\r\n        for (let posIdx of positions) {\r\n            if (opp.apUsed >= opp.ap) break;\r\n            if (coreCards.length === 0) break;\r\n\r\n            let pos = gameState.actionBar.positions.find(p => p.index === posIdx);\r\n            if (!pos || pos.stack) continue;\r\n\r\n            // Find a playable core card (prefer Attack)\r\n            let playable = coreCards.find(c => c.name === \"Attack\") ||\r\n                          coreCards.find(c => c.type === \"action\") ||\r\n                          coreCards[0];\r\n\r\n            if (playable) {\r\n                // Check energy cost\r\n                if (playable.energyCost && playable.energyCost > opp.energy) {\r\n                    coreCards = coreCards.filter(c => c !== playable);\r\n                    continue;\r\n                }\r\n\r\n                pos.stack = { coreCard: playable, modifiers: [] };\r\n                opp.apUsed++;\r\n\r\n                if (playable.energyCost) {\r\n                    opp.energy -= playable.energyCost;\r\n                }\r\n\r\n                // Remove from hand and tracking arrays\r\n                let idx = opp.hand.indexOf(playable);\r\n                if (idx >= 0) opp.hand.splice(idx, 1);\r\n                coreCards = coreCards.filter(c => c !== playable);\r\n\r\n                console.log(\"[CardGame v2] AI placed core:\", playable.name, \"at position\", posIdx);\r\n            }\r\n        }\r\n\r\n        // Phase 2: Add skill modifiers to placed stacks (no AP cost)\r\n        for (let posIdx of positions) {\r\n            if (modifierCards.length === 0) break;\r\n\r\n            let pos = gameState.actionBar.positions.find(p => p.index === posIdx);\r\n            if (!pos || !pos.stack || !pos.stack.coreCard) continue;\r\n\r\n            // Add one skill modifier to this stack\r\n            let skill = modifierCards.shift();\r\n            if (skill) {\r\n                pos.stack.modifiers.push(skill);\r\n                let idx = opp.hand.indexOf(skill);\r\n                if (idx >= 0) opp.hand.splice(idx, 1);\r\n                console.log(\"[CardGame v2] AI added modifier:\", skill.name, \"to position\", posIdx);\r\n            }\r\n        }\r\n\r\n        // If AI still has AP but can't place anything, try drawing first\r\n        let remainingCores = opp.hand.filter(c => isCoreCardType(c.type));\r\n        let playableCores = remainingCores.filter(c => !c.energyCost || c.energyCost <= opp.energy);\r\n        let emptyPositions = positions.filter(posIdx => {\r\n            let pos = gameState.actionBar.positions.find(p => p.index === posIdx);\r\n            return pos && !pos.stack;\r\n        });\r\n\r\n        // If can't place but have AP and draw pile has cards, draw one\r\n        if (opp.apUsed < opp.ap && playableCores.length === 0 && emptyPositions.length > 0 && opp.drawPile.length > 0) {\r\n            console.log(\"[CardGame v2] AI drawing a card (no playable cores)\");\r\n            drawCardsForActor(opp, 1);\r\n            // Check again for playable cores after draw\r\n            remainingCores = opp.hand.filter(c => isCoreCardType(c.type));\r\n            playableCores = remainingCores.filter(c => !c.energyCost || c.energyCost <= opp.energy);\r\n        }\r\n\r\n        // Forfeit if still can't place after potential draw\r\n        if (opp.apUsed < opp.ap && (playableCores.length === 0 || emptyPositions.length === 0)) {\r\n            console.log(\"[CardGame v2] AI forfeiting remaining AP - playable cores:\", playableCores.length,\r\n                \"(total cores:\", remainingCores.length, \") empty positions:\", emptyPositions.length, \"energy:\", opp.energy);\r\n            opp.apUsed = opp.ap;  // Mark as fully used\r\n        }\r\n\r\n        // AI placement done, switch back to player or end placement\r\n        checkPlacementComplete();\r\n    }\r\n\r\n    //  Check Placement Complete \r\n    function checkPlacementComplete() {\r\n        const gameState = getGameState();\r\n        if (!gameState) return;\r\n        const GAME_PHASES = getConstants()?.GAME_PHASES;\r\n\r\n        let playerDone = gameState.player.apUsed >= gameState.player.ap;\r\n        let opponentDone = gameState.opponent.apUsed >= gameState.opponent.ap;\r\n\r\n        console.log(\"[CardGame v2] checkPlacementComplete - Player done:\", playerDone, \"Opponent done:\", opponentDone);\r\n\r\n        if (playerDone && opponentDone) {\r\n            console.log(\"[CardGame v2] Both done, advancing to resolution in 800ms\");\r\n            // Brief delay so player can see their last card placed\r\n            setTimeout(() => {\r\n                const gs = getGameState();\r\n                if (gs && GAME_PHASES && gs.phase === GAME_PHASES.DRAW_PLACEMENT) {\r\n                    advancePhase(); // Move to resolution\r\n                }\r\n            }, 800);\r\n        } else {\r\n            gameState.currentTurn = playerDone ? \"opponent\" : \"player\";\r\n            console.log(\"[CardGame v2] Turn switched to:\", gameState.currentTurn);\r\n            m.redraw();\r\n\r\n            // If it's now the opponent's turn and they have AP, trigger AI\r\n            if (gameState.currentTurn === \"opponent\" && !opponentDone) {\r\n                setTimeout(() => {\r\n                    const gs = getGameState();\r\n                    if (gs && GAME_PHASES && gs.phase === GAME_PHASES.DRAW_PLACEMENT) {\r\n                        console.log(\"[CardGame v2] Triggering AI placement continuation\");\r\n                        aiPlaceCards();\r\n                        m.redraw();\r\n                    }\r\n                }, 500);\r\n            }\r\n        }\r\n    }\r\n\r\n    //  Director singleton accessor \r\n    function getDirector() { return gameDirector; }\r\n    function setDirector(d) { gameDirector = d; }\r\n\r\n    //  Expose on CardGame.AI namespace \r\n    Object.assign(window.CardGame.AI, {\r\n        CardGameDirector,\r\n        applyAIDecision,\r\n        aiPlaceCards,\r\n        checkPlacementComplete,\r\n        getDirector,\r\n        setDirector\r\n    });\r\n\r\n    console.log(\"[CardGame] AI/director loaded\");\r\n}());\r\n\n\n;/* === client/view/cardGame/ai/narrator.js === */\n/**\r\n * CardGame AI -- Narrator (LLM-powered Narration)\r\n * Extracted from cardGame-v2.js (lines ~6808-6969).\r\n *\r\n * Includes:\r\n *   - CardGameNarrator  (extends CardGameLLM)\r\n *\r\n * Depends on:\r\n *   CardGame.AI.CardGameLLM  (llmBase.js)\r\n *\r\n * Exposes: window.CardGame.AI.CardGameNarrator\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.AI = window.CardGame.AI || {};\r\n\r\n    const CardGameLLM = window.CardGame.AI.CardGameLLM;\r\n\r\n    //  Load external prompts (optional) \r\n    let narratorPrompts = null;\r\n\r\n    async function loadNarratorPrompts() {\r\n        if (narratorPrompts) return narratorPrompts;\r\n        try {\r\n            narratorPrompts = await m.request({\r\n                method: \"GET\",\r\n                url: \"media/cardGame/prompts/narrator-system.json\"\r\n            });\r\n        } catch (e) {\r\n            console.warn(\"[CardGameNarrator] Could not load narrator prompts, using defaults\");\r\n            narratorPrompts = null;\r\n        }\r\n        return narratorPrompts;\r\n    }\r\n\r\n    //  CardGameNarrator \r\n    // LLM-powered narration at key game moments\r\n    let gameNarrator = null;\r\n\r\n    class CardGameNarrator extends CardGameLLM {\r\n        static TRIGGER_POINTS = {\r\n            GAME_START: \"game_start\",\r\n            ROUND_START: \"round_start\",\r\n            ENCOUNTER_REVEAL: \"encounter_reveal\",\r\n            STACK_REVEAL: \"stack_reveal\",\r\n            RESOLUTION: \"resolution\",\r\n            ROUND_END: \"round_end\",\r\n            GAME_END: \"game_end\"\r\n        };\r\n\r\n        static PROFILES = {\r\n            \"arena-announcer\": {\r\n                name: \"Arena Announcer\",\r\n                personality: \"Bombastic sports commentator. Over-the-top excitement, play-by-play analysis.\",\r\n                maxSentences: { game_start: 3, round_start: 2, resolution: 4, round_end: 1, game_end: 3 }\r\n            },\r\n            \"dungeon-master\": {\r\n                name: \"Dungeon Master\",\r\n                personality: \"Classic tabletop DM. Atmospheric, descriptive, world-building.\",\r\n                maxSentences: { game_start: 3, round_start: 2, resolution: 4, round_end: 2, game_end: 3 }\r\n            },\r\n            \"war-correspondent\": {\r\n                name: \"War Correspondent\",\r\n                personality: \"Gritty battlefield reporter. Terse, factual with emotional undertones.\",\r\n                maxSentences: { game_start: 2, round_start: 1, resolution: 3, round_end: 1, game_end: 2 }\r\n            },\r\n            \"bard\": {\r\n                name: \"Bard\",\r\n                personality: \"Poetic narrator. Speaks in rhythm, references lore, foreshadows.\",\r\n                maxSentences: { game_start: 3, round_start: 2, resolution: 5, round_end: 2, game_end: 4 }\r\n            }\r\n        };\r\n\r\n        constructor() {\r\n            super();\r\n            this.profile = \"arena-announcer\";\r\n            this.lastNarration = null;\r\n            this.enabled = true;\r\n        }\r\n\r\n        async initialize(profileId, themeId) {\r\n            this.profile = profileId || \"arena-announcer\";\r\n            await loadNarratorPrompts();\r\n\r\n            // Merge loaded profiles into PROFILES if available\r\n            if (narratorPrompts?.profiles) {\r\n                Object.assign(CardGameNarrator.PROFILES, narratorPrompts.profiles);\r\n            }\r\n\r\n            const profileConfig = CardGameNarrator.PROFILES[this.profile];\r\n            const systemPrompt = this._buildNarratorPrompt(profileConfig, themeId);\r\n            const ok = await this.initializeLLM(\r\n                \"CardGame Narrator\",\r\n                \"CardGame Narrator Prompt\",\r\n                systemPrompt,\r\n                0.7  // Higher temperature for creative narration\r\n            );\r\n            if (ok) console.log(\"[CardGameNarrator] Initialized with profile:\", this.profile);\r\n            return ok;\r\n        }\r\n\r\n        _buildNarratorPrompt(profileConfig, themeId) {\r\n            // Use loaded prompts if available\r\n            if (narratorPrompts?.systemPrompt) {\r\n                let prompt = narratorPrompts.systemPrompt;\r\n                prompt = prompt.replace(/\\{profileName\\}/g, profileConfig.name)\r\n                               .replace(/\\{themeId\\}/g, themeId || \"unknown\")\r\n                               .replace(/\\{personality\\}/g, profileConfig.personality);\r\n                return prompt;\r\n            }\r\n\r\n            // Hardcoded fallback\r\n            return `You are a ${profileConfig.name} narrating a card game battle. Theme: ${themeId}.\r\n\r\nPersonality: ${profileConfig.personality}\r\n\r\nYou will receive game events and must provide brief, engaging narration.\r\nKeep responses concise - usually 1-3 sentences.\r\nMatch the tone to the event (dramatic for combat, tense for close calls).\r\n\r\nFor RESOLUTION events, also suggest a scene for image generation:\r\nAdd a line starting with \"IMAGE:\" describing a single dramatic moment.\r\n\r\nRespond with plain text narration only. No JSON, no markdown.`;\r\n        }\r\n\r\n        async narrate(trigger, context) {\r\n            if (!this.enabled || !this.initialized || !this.chatRequest) {\r\n                return { text: null, imagePrompt: null };\r\n            }\r\n\r\n            try {\r\n                const prompt = this._buildTriggerPrompt(trigger, context);\r\n                const response = await this.chat(prompt);\r\n                const content = CardGameLLM.extractContent(response);\r\n                const parsed = this._parseNarration(content);\r\n                this.lastNarration = parsed;\r\n                return parsed;\r\n            } catch (err) {\r\n                console.error(\"[CardGameNarrator] Narration failed:\", err);\r\n                return { text: null, imagePrompt: null };\r\n            }\r\n        }\r\n\r\n        _buildTriggerPrompt(trigger, context) {\r\n            const profile = CardGameNarrator.PROFILES[this.profile];\r\n            const maxSentences = profile?.maxSentences?.[trigger] || 3;\r\n\r\n            let prompt = `EVENT: ${trigger.toUpperCase()}\\n`;\r\n\r\n            switch (trigger) {\r\n                case \"game_start\":\r\n                    prompt += `A new battle begins!\\n`;\r\n                    prompt += `${context.playerName} faces ${context.opponentName}\\n`;\r\n                    prompt += `Introduce both combatants dramatically.\\n`;\r\n                    break;\r\n\r\n                case \"game_end\":\r\n                    prompt += `The battle is over after ${context.rounds} rounds!\\n`;\r\n                    prompt += `Winner: ${context.winner}\\n`;\r\n                    prompt += `Defeated: ${context.loser}\\n`;\r\n                    prompt += context.isPlayerVictory\r\n                        ? `Celebrate the player's triumph!\\n`\r\n                        : `Acknowledge the player's defeat with dignity.\\n`;\r\n                    break;\r\n\r\n                case \"round_start\":\r\n                    prompt += `Round ${context.roundNumber}\\n`;\r\n                    prompt += `Player HP: ${context.playerHp}/20, Opponent HP: ${context.opponentHp}/20\\n`;\r\n                    break;\r\n\r\n                case \"resolution\":\r\n                    prompt += `Player played: ${context.playerStack || \"nothing\"}\\n`;\r\n                    prompt += `Player roll: ${context.playerRoll?.raw || \"?\"} + mods = ${context.playerRoll?.total || \"?\"}\\n`;\r\n                    prompt += `Opponent played: ${context.opponentStack || \"nothing\"}\\n`;\r\n                    prompt += `Opponent roll: ${context.opponentRoll?.raw || \"?\"} + mods = ${context.opponentRoll?.total || \"?\"}\\n`;\r\n                    prompt += `Result: ${context.outcome} (${context.damage || 0} damage)\\n`;\r\n                    break;\r\n\r\n                case \"round_end\":\r\n                    prompt += `Round ${context.roundNumber} complete\\n`;\r\n                    prompt += `Player HP: ${context.playerHp}, Opponent HP: ${context.opponentHp}\\n`;\r\n                    break;\r\n            }\r\n\r\n            // Add Poker Face emotion hint if available\r\n            if (context.playerEmotion && context.playerEmotionDesc) {\r\n                prompt += `\\nPOKER FACE: The player ${context.playerEmotionDesc}. Work this into your narration subtly.`;\r\n            }\r\n\r\n            prompt += `\\nNarrate in ${maxSentences} sentences or less.`;\r\n            if (trigger === \"resolution\") {\r\n                prompt += `\\nAlso add \"IMAGE:\" line for scene generation.`;\r\n            }\r\n\r\n            return prompt;\r\n        }\r\n\r\n        _parseNarration(content) {\r\n            const lines = content.split(\"\\n\");\r\n            let text = \"\";\r\n            let imagePrompt = null;\r\n\r\n            for (const line of lines) {\r\n                if (line.trim().toUpperCase().startsWith(\"IMAGE:\")) {\r\n                    imagePrompt = line.replace(/^IMAGE:\\s*/i, \"\").trim();\r\n                } else if (line.trim()) {\r\n                    text += (text ? \" \" : \"\") + line.trim();\r\n                }\r\n            }\r\n\r\n            return { text, imagePrompt };\r\n        }\r\n    }\r\n\r\n    //  Narrator singleton accessor \r\n    function getNarrator() { return gameNarrator; }\r\n    function setNarrator(n) { gameNarrator = n; }\r\n\r\n    //  Expose on CardGame.AI namespace \r\n    Object.assign(window.CardGame.AI, {\r\n        CardGameNarrator,\r\n        getNarrator,\r\n        setNarrator\r\n    });\r\n\r\n    console.log(\"[CardGame] AI/narrator loaded\");\r\n}());\r\n\n\n;/* === client/view/cardGame/ai/chatManager.js === */\n/**\r\n * CardGame AI -- Chat Manager (LLM-powered NPC Conversation)\r\n * Extracted from cardGame-v2.js (lines ~7008-7146).\r\n *\r\n * Includes:\r\n *   - CardGameChatManager  (extends CardGameLLM)\r\n *\r\n * Depends on:\r\n *   CardGame.AI.CardGameLLM  (llmBase.js)\r\n *\r\n * Exposes: window.CardGame.AI.CardGameChatManager\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.AI = window.CardGame.AI || {};\r\n\r\n    const CardGameLLM = window.CardGame.AI.CardGameLLM;\r\n\r\n    //  Load external prompts (optional) \r\n    let chatPrompts = null;\r\n\r\n    async function loadChatPrompts() {\r\n        if (chatPrompts) return chatPrompts;\r\n        try {\r\n            chatPrompts = await m.request({\r\n                method: \"GET\",\r\n                url: \"media/cardGame/prompts/chat-system.json\"\r\n            });\r\n        } catch (e) {\r\n            console.warn(\"[CardGameChatManager] Could not load chat prompts, using defaults\");\r\n            chatPrompts = null;\r\n        }\r\n        return chatPrompts;\r\n    }\r\n\r\n    //  CardGameChatManager \r\n    // LLM-powered NPC conversation for Talk cards\r\n    let gameChatManager = null;\r\n\r\n    class CardGameChatManager extends CardGameLLM {\r\n        constructor() {\r\n            super();\r\n            this.npcName = null;\r\n            this.npcPersonality = null;\r\n            this.interactionHistory = [];\r\n            this.currentConversation = [];\r\n            this.chatActive = false;\r\n        }\r\n\r\n        async initialize(npcCharacter, themeId) {\r\n            this.npcName = npcCharacter?.name || \"NPC\";\r\n            this.npcPersonality = this._extractNpcPersonality(npcCharacter);\r\n            await loadChatPrompts();\r\n            const systemPrompt = this._buildChatPrompt(npcCharacter, themeId);\r\n\r\n            const ok = await this.initializeLLM(\r\n                \"CardGame NPC Chat\",\r\n                \"CardGame NPC Chat Prompt\",\r\n                systemPrompt,\r\n                0.8  // Higher temperature for varied dialogue\r\n            );\r\n            if (ok) console.log(\"[CardGameChatManager] Initialized for NPC:\", this.npcName);\r\n            return ok;\r\n        }\r\n\r\n        _extractNpcPersonality(charPerson) {\r\n            if (!charPerson) return { tone: \"neutral\", traits: [] };\r\n            const traits = charPerson.personality?.split(\",\").map(t => t.trim()) || [];\r\n            const alignment = charPerson.alignment || \"NEUTRAL\";\r\n            let tone = \"neutral\";\r\n            if (alignment.includes(\"EVIL\")) tone = \"hostile\";\r\n            else if (alignment.includes(\"GOOD\")) tone = \"friendly\";\r\n            else if (alignment.includes(\"CHAOTIC\")) tone = \"unpredictable\";\r\n            return { tone, traits, alignment };\r\n        }\r\n\r\n        _buildChatPrompt(npcCharacter, themeId) {\r\n            const name = npcCharacter?.name || \"Unknown\";\r\n            const desc = npcCharacter?.description || \"\";\r\n            const personality = this.npcPersonality;\r\n\r\n            // Use loaded prompts if available\r\n            if (chatPrompts?.systemPrompt) {\r\n                let prompt = chatPrompts.systemPrompt;\r\n                prompt = prompt.replace(/\\{name\\}/g, name)\r\n                               .replace(/\\{themeId\\}/g, themeId || \"unknown\")\r\n                               .replace(/\\{description\\}/g, desc)\r\n                               .replace(/\\{traits\\}/g, personality.traits.join(\", \") || \"mysterious\")\r\n                               .replace(/\\{tone\\}/g, personality.tone);\r\n                return prompt;\r\n            }\r\n\r\n            // Hardcoded fallback\r\n            return `You are ${name}, an NPC in a card game battle. Theme: ${themeId}.\r\n${desc ? `Description: ${desc}` : \"\"}\r\nPersonality traits: ${personality.traits.join(\", \") || \"mysterious\"}\r\nDisposition: ${personality.tone}\r\n\r\nYou are being addressed by your opponent during combat via a Talk card.\r\nRespond in character with 1-3 sentences. Stay true to your personality.\r\n${personality.tone === \"hostile\" ? \"You are hostile but can be persuaded.\" : \"\"}\r\n${personality.tone === \"friendly\" ? \"You are open to conversation.\" : \"\"}\r\n\r\nIf the player is trying to:\r\n- Taunt: React according to your personality (angry, amused, dismissive)\r\n- Persuade: Consider their words but stay in character\r\n- Intimidate: Show fear or defiance based on your traits\r\n- Negotiate: Be open or closed depending on alignment\r\n\r\nRespond naturally in character. No game mechanics, just dialogue.`;\r\n        }\r\n\r\n        async startConversation() {\r\n            this.chatActive = true;\r\n            this.currentConversation = [];\r\n            console.log(\"[CardGameChatManager] Conversation started with:\", this.npcName);\r\n            return true;\r\n        }\r\n\r\n        async sendMessage(playerMessage) {\r\n            if (!this.initialized || !this.chatActive) {\r\n                return { text: \"...\", error: true };\r\n            }\r\n\r\n            try {\r\n                // Build context with recent conversation\r\n                const contextMessages = this.currentConversation.slice(-4)\r\n                    .map(m => `${m.role === \"player\" ? \"Player\" : this.npcName}: ${m.text}`)\r\n                    .join(\"\\n\");\r\n\r\n                const prompt = contextMessages\r\n                    ? `Previous exchange:\\n${contextMessages}\\n\\nPlayer: ${playerMessage}\\n\\n${this.npcName}:`\r\n                    : `Player: ${playerMessage}\\n\\n${this.npcName}:`;\r\n\r\n                const response = await this.chat(prompt);\r\n                const npcReply = CardGameLLM.extractContent(response).trim();\r\n\r\n                // Store in conversation history\r\n                this.currentConversation.push({ role: \"player\", text: playerMessage });\r\n                this.currentConversation.push({ role: \"npc\", text: npcReply });\r\n\r\n                return { text: npcReply, speaker: this.npcName };\r\n            } catch (err) {\r\n                console.error(\"[CardGameChatManager] Message failed:\", err);\r\n                return { text: \"...\", error: true };\r\n            }\r\n        }\r\n\r\n        async concludeConversation() {\r\n            this.chatActive = false;\r\n\r\n            // Create interaction record for future context\r\n            const interaction = {\r\n                timestamp: Date.now(),\r\n                npcName: this.npcName,\r\n                messages: [...this.currentConversation],\r\n                outcome: this._evaluateOutcome()\r\n            };\r\n\r\n            this.interactionHistory.push(interaction);\r\n            console.log(\"[CardGameChatManager] Conversation concluded. Outcome:\", interaction.outcome);\r\n\r\n            return interaction;\r\n        }\r\n\r\n        _evaluateOutcome() {\r\n            // Simple heuristic based on conversation length and content\r\n            const msgCount = this.currentConversation.length;\r\n            if (msgCount === 0) return \"silent\";\r\n            if (msgCount <= 2) return \"brief\";\r\n            if (msgCount <= 4) return \"moderate\";\r\n            return \"extensive\";\r\n        }\r\n\r\n        loadInteractionHistory(history) {\r\n            this.interactionHistory = history || [];\r\n        }\r\n\r\n        getInteractionSummary() {\r\n            return this.interactionHistory.map(i => ({\r\n                npc: i.npcName,\r\n                when: new Date(i.timestamp).toLocaleDateString(),\r\n                outcome: i.outcome,\r\n                preview: i.messages[0]?.text?.substring(0, 50) + \"...\"\r\n            }));\r\n        }\r\n    }\r\n\r\n    //  ChatManager singleton accessor \r\n    function getChatManager() { return gameChatManager; }\r\n    function setChatManager(cm) { gameChatManager = cm; }\r\n\r\n    //  Expose on CardGame.AI namespace \r\n    Object.assign(window.CardGame.AI, {\r\n        CardGameChatManager,\r\n        getChatManager,\r\n        setChatManager\r\n    });\r\n\r\n    console.log(\"[CardGame] AI/chatManager loaded\");\r\n}());\r\n\n\n;/* === client/view/cardGame/ai/voice.js === */\n/**\r\n * CardGame AI -- Voice Synthesis & Emotion Detection\r\n * Extracted from cardGame-v2.js (lines ~7148-7280).\r\n *\r\n * Includes:\r\n *   - CardGameVoice          (TTS with queue, Web Audio API)\r\n *   - getPlayerEmotion       (Poker Face / moodRing integration)\r\n *   - getPlayerMoodColor     (mood colour from biometric)\r\n *   - buildEmotionContext     (builds context object for narrator)\r\n *\r\n * Depends on (optional, gracefully degrades):\r\n *   page.components.audio     (audio infrastructure)\r\n *   page.components.moodRing  (emotion / biometric capture)\r\n *   CardGame.UI.showNarrationSubtitle  (ui/phaseUI.js -- future)\r\n *\r\n * Exposes: window.CardGame.AI.{ CardGameVoice,\r\n *            getPlayerEmotion, getPlayerMoodColor, buildEmotionContext }\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.AI = window.CardGame.AI || {};\r\n\r\n    // Lazy accessor for showNarrationSubtitle (lives in a UI module loaded later)\r\n    function showNarrationSubtitle(text) {\r\n        if (typeof window.CardGame.UI?.showNarrationSubtitle === \"function\") {\r\n            window.CardGame.UI.showNarrationSubtitle(text);\r\n        } else {\r\n            console.log(\"[CardGameVoice] Subtitle:\", text);\r\n        }\r\n    }\r\n\r\n    //  CardGameVoice \r\n    // Voice synthesis for narrator using existing audio infrastructure\r\n    let gameVoice = null;\r\n\r\n    class CardGameVoice {\r\n        constructor() {\r\n            this.enabled = false;\r\n            this.voiceProfileId = null;\r\n            this.volume = 1.0;\r\n            this.speaking = false;\r\n            this.queue = [];\r\n            this.subtitlesOnly = false;\r\n        }\r\n\r\n        async initialize(voiceConfig) {\r\n            // Check if audio infrastructure exists\r\n            if (typeof page?.components?.audio?.createAudioSource !== \"function\") {\r\n                console.log(\"[CardGameVoice] Audio infrastructure not available, subtitles only\");\r\n                this.subtitlesOnly = true;\r\n                this.enabled = true;\r\n                return true;\r\n            }\r\n\r\n            this.voiceProfileId = voiceConfig?.voiceProfileId || null;\r\n            this.volume = voiceConfig?.volume ?? 1.0;\r\n            this.subtitlesOnly = voiceConfig?.subtitlesOnly ?? false;\r\n            this.enabled = true;\r\n\r\n            console.log(\"[CardGameVoice] Initialized. Profile:\", this.voiceProfileId || \"default\");\r\n            return true;\r\n        }\r\n\r\n        async speak(text, options = {}) {\r\n            if (!this.enabled || !text) return;\r\n            if (this.subtitlesOnly) {\r\n                // Just show subtitles without audio\r\n                showNarrationSubtitle(text);\r\n                return;\r\n            }\r\n\r\n            // Queue if already speaking\r\n            if (this.speaking) {\r\n                this.queue.push({ text, options });\r\n                return;\r\n            }\r\n\r\n            this.speaking = true;\r\n            const name = \"cardgame-voice-\" + Date.now();\r\n\r\n            try {\r\n                // Use page.components.audio if available\r\n                const audioComponent = page?.components?.audio;\r\n                if (audioComponent?.createAudioSource) {\r\n                    const source = await audioComponent.createAudioSource(name, this.voiceProfileId, text);\r\n                    if (source) {\r\n                        await this._playAudioSource(source);\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                console.warn(\"[CardGameVoice] Speech synthesis failed:\", err);\r\n            } finally {\r\n                this.speaking = false;\r\n                // Process queue\r\n                if (this.queue.length > 0) {\r\n                    const next = this.queue.shift();\r\n                    this.speak(next.text, next.options);\r\n                }\r\n            }\r\n        }\r\n\r\n        async _playAudioSource(source) {\r\n            return new Promise((resolve) => {\r\n                if (!source?.source || !source?.context) {\r\n                    resolve();\r\n                    return;\r\n                }\r\n\r\n                const sourceNode = source.context.createBufferSource();\r\n                sourceNode.buffer = source.buffer;\r\n\r\n                // Apply volume\r\n                const gainNode = source.context.createGain();\r\n                gainNode.gain.value = this.volume;\r\n\r\n                sourceNode.connect(gainNode);\r\n                gainNode.connect(source.context.destination);\r\n\r\n                sourceNode.onended = () => resolve();\r\n                sourceNode.start();\r\n            });\r\n        }\r\n\r\n        setVolume(level) {\r\n            this.volume = Math.max(0, Math.min(1, level));\r\n        }\r\n\r\n        stop() {\r\n            this.queue = [];\r\n            // Note: Stopping mid-playback would require tracking active source nodes\r\n        }\r\n    }\r\n\r\n    //  Poker Face Integration (Emotion Capture) \r\n    // Uses moodRing component for emotion detection\r\n\r\n    function getPlayerEmotion() {\r\n        if (!page?.components?.moodRing?.enabled()) return null;\r\n        return page.components.moodRing.emotion();\r\n    }\r\n\r\n    function getPlayerMoodColor() {\r\n        if (!page?.components?.moodRing?.enabled()) return null;\r\n        return page.components.moodRing.moodColor();\r\n    }\r\n\r\n    // Build emotion context for narrator\r\n    function buildEmotionContext() {\r\n        const emotion = getPlayerEmotion();\r\n        if (!emotion || emotion === \"neutral\") return null;\r\n\r\n        const emotionDescriptions = {\r\n            happy: \"appears pleased\",\r\n            sad: \"looks dejected\",\r\n            angry: \"seems frustrated\",\r\n            fear: \"appears nervous\",\r\n            surprise: \"looks startled\",\r\n            disgust: \"seems unimpressed\"\r\n        };\r\n\r\n        return {\r\n            emotion,\r\n            description: emotionDescriptions[emotion] || null\r\n        };\r\n    }\r\n\r\n    //  Voice singleton accessor \r\n    function getVoice() { return gameVoice; }\r\n    function setVoice(v) { gameVoice = v; }\r\n\r\n    //  Expose on CardGame.AI namespace \r\n    Object.assign(window.CardGame.AI, {\r\n        CardGameVoice,\r\n        getPlayerEmotion,\r\n        getPlayerMoodColor,\r\n        buildEmotionContext,\r\n        getVoice,\r\n        setVoice\r\n    });\r\n\r\n    console.log(\"[CardGame] AI/voice loaded\");\r\n}());\r\n\n\n;/* === client/view/cardGame/ui/deckList.js === */\n/**\r\n * CardGame UI - Deck List\r\n * Deck loading, saving, deleting, viewing, playing, and the DeckList component.\r\n * Extracted from the monolithic cardGame-v2.js (lines ~1437-1888).\r\n *\r\n * Dependencies:\r\n *   - CardGame.Storage (deckStorage, gameStorage, campaignStorage)\r\n *   - CardGame.Themes (loadThemeConfig)\r\n *   - CardGame.Characters (refreshAllCharacters, selectedChars, persistGeneratedCharacters)\r\n *   - CardGame.ctx (shared mutable context: screen, viewingDeck, buildingDeck, etc.)\r\n *\r\n * Exposes: window.CardGame.UI.{deckListState, loadSavedDecks, saveDeck, deleteDeck,\r\n *   viewDeck, playDeck, resumeGame, refreshAllCharacters, DeckList}\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.UI = window.CardGame.UI || {};\r\n\r\n    //  State \r\n    let savedDecks = [];\r\n    let decksLoading = false;\r\n\r\n    //  Helpers: resolve shared context \r\n    function ctx() { return window.CardGame.ctx || {}; }\r\n    function storage() { return window.CardGame.Storage || {}; }\r\n    function themes() { return window.CardGame.Themes || {}; }\r\n    function chars() { return window.CardGame.Characters || {}; }\r\n\r\n    //  Load Saved Decks \r\n    async function loadSavedDecks() {\r\n        if (decksLoading) return;\r\n        decksLoading = true;\r\n        m.redraw();\r\n        try {\r\n            let deckStorage = storage().deckStorage;\r\n            let gameStorage = storage().gameStorage;\r\n            let campaignStorage = storage().campaignStorage;\r\n            let names = await deckStorage.list();\r\n            let decks = [];\r\n            for (let name of names) {\r\n                let data = await deckStorage.load(name);\r\n                if (data) {\r\n                    // Check for saved games and campaign data\r\n                    let savesList = await gameStorage.list(name);\r\n                    let campaign = await campaignStorage.load(name);\r\n                    decks.push({\r\n                        deckName: data.deckName || name,\r\n                        themeId: data.themeId || null,\r\n                        characterNames: data.characterNames || (data.characterName ? [data.characterName] : [\"Unknown\"]),\r\n                        portraitUrl: data.portraitUrl || null,\r\n                        createdAt: data.createdAt || null,\r\n                        cardCount: data.cardCount || (data.cards ? data.cards.length : 0),\r\n                        storageName: name,\r\n                        // Include art URLs for deck list display\r\n                        cardBackImageUrl: data.cardBackImageUrl || null,\r\n                        cardFrontImageUrl: data.cardFrontImageUrl || null,\r\n                        backgroundThumbUrl: data.backgroundThumbUrl || null,\r\n                        // Save/campaign metadata\r\n                        hasSave: savesList.length > 0,\r\n                        lastSaveRound: savesList.length > 0 ? null : null, // populated below\r\n                        campaign: campaign || null\r\n                    });\r\n                }\r\n            }\r\n            savedDecks = decks;\r\n            console.log(\"[CardGame v2] Loaded \" + savedDecks.length + \" saved decks\");\r\n            let screen = ctx().screen;\r\n            let buildingDeck = ctx().buildingDeck;\r\n            if (savedDecks.length === 0 && screen === \"deckList\" && !buildingDeck) {\r\n                ctx().screen = \"builder\";\r\n                ctx().builderStep = 1;\r\n                chars().state.selectedChars = [];\r\n                ctx().builtDeck = null;\r\n            }\r\n        } catch (e) {\r\n            console.error(\"[CardGame v2] Failed to load decks\", e);\r\n        }\r\n        decksLoading = false;\r\n        m.redraw();\r\n    }\r\n\r\n    //  Save Deck \r\n    async function saveDeck(deck) {\r\n        if (!deck) return;\r\n        ctx().buildingDeck = true;\r\n        m.redraw();\r\n        let safeName = (deck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n\r\n        // Persist any generated characters that haven't been saved yet\r\n        let selectedChars = chars().state.selectedChars;\r\n        if (selectedChars && selectedChars.length > 0) {\r\n            const unpersisted = selectedChars.filter(ch => ch._tempId && !ch.objectId);\r\n            if (unpersisted.length > 0) {\r\n                page.toast(\"info\", \"Saving characters...\");\r\n                const persisted = await chars().persistGeneratedCharacters(unpersisted, safeName);\r\n                // Update selectedChars with persisted versions\r\n                for (const p of persisted) {\r\n                    const idx = selectedChars.findIndex(ch => ch._tempId && ch.name === p.name);\r\n                    if (idx >= 0) {\r\n                        selectedChars[idx] = p;\r\n                    }\r\n                }\r\n                // Update deck's character card references with real sourceId\r\n                if (deck.cards) {\r\n                    for (const card of deck.cards) {\r\n                        if (card.type === \"character\" && card._sourceChar && card._sourceChar._tempId) {\r\n                            const match = persisted.find(p => p.name === card.name);\r\n                            if (match && match.objectId) {\r\n                                card.sourceId = match.objectId;\r\n                                delete card._sourceChar;  // No longer needed\r\n                                console.log('[CardGame] Updated card sourceId for:', card.name, match.objectId);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                // Update playerCharacter reference\r\n                if (deck.playerCharacter && deck.playerCharacter._sourceChar) {\r\n                    const match = persisted.find(p => p.name === deck.playerCharacter.name);\r\n                    if (match && match.objectId) {\r\n                        deck.playerCharacter.sourceId = match.objectId;\r\n                        delete deck.playerCharacter._sourceChar;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        let deckStorage = storage().deckStorage;\r\n        let result = await deckStorage.save(safeName, deck);\r\n        ctx().buildingDeck = false;\r\n        if (result) {\r\n            page.toast(\"success\", \"Deck saved: \" + deck.deckName);\r\n            ctx().builtDeck = null;\r\n            chars().state.selectedChars = [];\r\n            m.redraw();\r\n            await viewDeck(safeName);\r\n        } else {\r\n            page.toast(\"error\", \"Failed to save deck\");\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    //  Delete Deck \r\n    async function deleteDeck(storageName) {\r\n        let deckStorage = storage().deckStorage;\r\n        let ok = await deckStorage.remove(storageName);\r\n        if (ok) {\r\n            page.toast(\"success\", \"Deck deleted\");\r\n            await loadSavedDecks();\r\n        } else {\r\n            page.toast(\"error\", \"Failed to delete deck\");\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    //  View Deck \r\n    async function viewDeck(storageName) {\r\n        let deckStorage = storage().deckStorage;\r\n        let data = await deckStorage.load(storageName);\r\n        if (data) {\r\n            ctx().viewingDeck = data;\r\n            ctx().cardFrontImageUrl = data.cardFrontImageUrl || null;\r\n            ctx().cardBackImageUrl = data.cardBackImageUrl || null;\r\n            ctx().flippedCards = {};\r\n            ctx().artDir = null;\r\n            // Load the deck's theme so prompts use the correct suffix\r\n            if (data.themeId) {\r\n                await themes().loadThemeConfig(data.themeId);\r\n            }\r\n            ctx().screen = \"deckView\";\r\n            m.redraw();\r\n            // Auto-refresh character cards from source objects\r\n            await refreshAllCharacters(data);\r\n        } else {\r\n            page.toast(\"error\", \"Failed to load deck\");\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    //  Play Deck (start game directly) \r\n    async function playDeck(storageName) {\r\n        let deckStorage = storage().deckStorage;\r\n        let gameStorage = storage().gameStorage;\r\n        let data = await deckStorage.load(storageName);\r\n        if (data) {\r\n            ctx().viewingDeck = data;\r\n            // Load the deck's theme\r\n            if (data.themeId) {\r\n                await themes().loadThemeConfig(data.themeId);\r\n            }\r\n            // Clear old saves when starting a new game\r\n            await gameStorage.deleteAll(storageName);\r\n            // Reset game state and character selection for fresh start\r\n            ctx().gameState = null;\r\n            ctx().gameCharSelection = null;\r\n            ctx().activeCampaign = null;\r\n            ctx().screen = \"game\";\r\n            m.redraw();\r\n        } else {\r\n            page.toast(\"error\", \"Failed to load deck\");\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    //  Resume Game \r\n    async function resumeGame(storageName) {\r\n        let gameStorage = storage().gameStorage;\r\n        let deckStorage = storage().deckStorage;\r\n        let campaignStorage = storage().campaignStorage;\r\n        let saveData = await gameStorage.load(storageName);\r\n        if (!saveData) {\r\n            page.toast(\"error\", \"No save found\");\r\n            return;\r\n        }\r\n        let data = await deckStorage.load(storageName);\r\n        if (!data) {\r\n            page.toast(\"error\", \"Failed to load deck for resume\");\r\n            return;\r\n        }\r\n        ctx().viewingDeck = data;\r\n        if (data.themeId) {\r\n            await themes().loadThemeConfig(data.themeId);\r\n        }\r\n        ctx().gameState = storage().deserializeGameState(saveData);\r\n        ctx().gameCharSelection = null;\r\n        ctx().activeCampaign = await campaignStorage.load(storageName);\r\n        ctx().screen = \"game\";\r\n        // Re-initialize LLM components for resumed game\r\n        if (typeof ctx().initializeLLMComponents === \"function\") {\r\n            ctx().initializeLLMComponents(ctx().gameState, ctx().viewingDeck);\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    //  Refresh All Characters \r\n    async function refreshAllCharacters(deck) {\r\n        if (!deck || !deck.cards) return;\r\n        let charCards = deck.cards.filter(c => c.type === \"character\" && (c.sourceId || c._sourceChar));\r\n        let refreshed = 0;\r\n        for (let card of charCards) {\r\n            let ok = await chars().refreshCharacterCard(card);\r\n            if (ok) refreshed++;\r\n        }\r\n        if (refreshed > 0) {\r\n            console.log(\"[CardGame v2] Refreshed \" + refreshed + \" character cards from source\");\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    //  Deck List Component \r\n    function DeckList() {\r\n        return {\r\n            view() {\r\n                return m(\"div\", [\r\n                    m(\"div\", { class: \"cg2-toolbar\" }, [\r\n                        m(\"span\", { style: { fontWeight: 700, fontSize: \"16px\" } }, \"Your Decks\"),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\",\r\n                            onclick() {\r\n                                ctx().screen = \"builder\";\r\n                                ctx().builderStep = 1;\r\n                                chars().state.selectedChars = [];\r\n                                ctx().builtDeck = null;\r\n                                ctx().deckNameInput = \"\";\r\n                                m.redraw();\r\n                            }\r\n                        }, [m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"4px\" } }, \"add\"), \"New Deck\"]),\r\n                        m(\"span\", { style: { flex: 1 } }),\r\n                        m(\"button\", { class: \"cg2-btn cg2-btn-sm\", onclick() { themes().loadThemeList(); ctx().screen = \"themeEditor\"; m.redraw(); } }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"2px\" } }, \"palette\"),\r\n                            \" Themes\"\r\n                        ]),\r\n                        m(\"button\", { class: \"cg2-btn cg2-btn-sm\", style: { marginLeft: \"4px\" }, onclick() { ctx().testDeck = null; ctx().testDeckName = null; ctx().screen = \"test\"; m.redraw(); } }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"2px\" } }, \"science\"),\r\n                            \" Test\"\r\n                        ]),\r\n                        decksLoading ? m(\"span\", { class: \"cg2-loading\", style: { marginLeft: \"4px\" } }, \"Loading...\") : null\r\n                    ]),\r\n                    savedDecks.length === 0 && !decksLoading\r\n                        ? m(\"div\", { class: \"cg2-empty-state\" }, \"No decks yet. Create one to get started.\")\r\n                        : m(\"div\", { class: \"cg2-deck-grid cg2-deck-grid-cards\" },\r\n                            savedDecks.map(d => {\r\n                                // Use card back image if available\r\n                                let cardBackUrl = d.cardBackImageUrl;\r\n\r\n                                return m(\"div\", { class: \"cg2-deck-item\" }, [\r\n                                    // Card back display (hand card size)\r\n                                    m(\"div\", { class: \"cg2-deck-card-back\" }, [\r\n                                        cardBackUrl\r\n                                            ? m(\"div\", {\r\n                                                class: \"cg2-deck-back-image\",\r\n                                                style: {\r\n                                                    backgroundImage: \"url('\" + cardBackUrl + \"')\",\r\n                                                    backgroundSize: \"cover\",\r\n                                                    backgroundPosition: \"center\"\r\n                                                }\r\n                                            })\r\n                                            : m(\"div\", { class: \"cg2-deck-back-default\" }, [\r\n                                                m(\"div\", { class: \"cg2-back-pattern\" }),\r\n                                                m(\"span\", { class: \"material-symbols-outlined cg2-back-icon\" }, \"playing_cards\"),\r\n                                                m(\"div\", { class: \"cg2-back-label\" }, d.themeId || \"Deck\")\r\n                                            ])\r\n                                    ]),\r\n                                    // Deck name + campaign info\r\n                                    m(\"div\", { class: \"cg2-deck-name\" }, d.deckName),\r\n                                    d.campaign ? m(\"div\", { class: \"cg2-deck-campaign-info\" }, [\r\n                                        m(\"span\", { class: \"cg2-campaign-level\" }, \"Lv.\" + d.campaign.level),\r\n                                        m(\"span\", { class: \"cg2-campaign-xp\" }, d.campaign.xp + \" XP\"),\r\n                                        m(\"span\", { class: \"cg2-campaign-record\" }, d.campaign.wins + \"W/\" + d.campaign.losses + \"L\")\r\n                                    ]) : null,\r\n                                    // Action buttons\r\n                                    m(\"div\", { class: \"cg2-deck-actions\" }, [\r\n                                        d.hasSave ? m(\"button\", {\r\n                                            class: \"cg2-btn cg2-btn-accent\",\r\n                                            onclick: () => resumeGame(d.storageName),\r\n                                            title: \"Resume saved game\"\r\n                                        }, [\r\n                                            m(\"span\", { class: \"material-symbols-outlined\" }, \"restore\"),\r\n                                            \" Resume\"\r\n                                        ]) : null,\r\n                                        m(\"button\", {\r\n                                            class: \"cg2-btn cg2-btn-primary\",\r\n                                            onclick: () => playDeck(d.storageName),\r\n                                            title: d.hasSave ? \"Start a new game (deletes save)\" : \"Start a game with this deck\"\r\n                                        }, [\r\n                                            m(\"span\", { class: \"material-symbols-outlined\" }, \"play_arrow\"),\r\n                                            d.hasSave ? \" New Game\" : \" Play\"\r\n                                        ]),\r\n                                        m(\"button\", { class: \"cg2-btn\", onclick: () => viewDeck(d.storageName) }, \"View\"),\r\n                                        m(\"button\", { class: \"cg2-btn cg2-btn-danger\", onclick: () => deleteDeck(d.storageName) }, \"Delete\")\r\n                                    ])\r\n                                ]);\r\n                            })\r\n                        )\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Expose on CardGame namespace \r\n    Object.assign(window.CardGame.UI, {\r\n        deckListState: {\r\n            get savedDecks() { return savedDecks; },\r\n            set savedDecks(v) { savedDecks = v; },\r\n            get decksLoading() { return decksLoading; },\r\n            set decksLoading(v) { decksLoading = v; }\r\n        },\r\n        loadSavedDecks,\r\n        saveDeck,\r\n        deleteDeck,\r\n        viewDeck,\r\n        playDeck,\r\n        resumeGame,\r\n        refreshAllCharacters,\r\n        DeckList\r\n    });\r\n\r\n    console.log('[CardGame] UI/deckList module loaded');\r\n\r\n})();\r\n\n\n;/* === client/view/cardGame/ui/builder.js === */\n/**\r\n * CardGame UI - Builder Steps\r\n * Theme selection, character picker, card editor, and review/build steps.\r\n * Extracted from the monolithic cardGame-v2.js (lines ~1890-2396).\r\n *\r\n * Dependencies:\r\n *   - CardGame.Constants (CARD_TYPES)\r\n *   - CardGame.Themes (loadThemeConfig, applyThemeOutfits, state.activeTheme, state.applyingOutfits)\r\n *   - CardGame.Characters (state.*, getPortraitUrl, mapStats, getCharId, clampStat, str,\r\n *                          generateCharactersFromTemplates, persistGeneratedCharacters,\r\n *                          assembleStarterDeck)\r\n *   - CardGame.Rendering (CardFace)\r\n *   - CardGame.UI (saveDeck)\r\n *   - CardGame.ctx (shared mutable context: screen, buildingDeck, builtDeck, deckNameInput, builderStep)\r\n *\r\n * Exposes: window.CardGame.UI.{builderState, BuilderThemeStep, BuilderCharacterStep,\r\n *   BuilderReviewStep, CardEditorFields}\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.UI = window.CardGame.UI || {};\r\n\r\n    const C = window.CardGame.Constants;\r\n\r\n    //  State \r\n    let editingCard = null;         // card object being edited (null = not editing)\r\n    let editingCardIndex = -1;      // index in builtDeck.cards (-1 = new card)\r\n    let addCardTypeOpen = false;    // dropdown open for \"Add Card\" type selector\r\n\r\n    //  Helpers: resolve shared context \r\n    function ctx() { return window.CardGame.ctx || {}; }\r\n    function themes() { return window.CardGame.Themes || {}; }\r\n    function chars() { return window.CardGame.Characters || {}; }\r\n\r\n    // Card type templates for new cards\r\n    let CARD_TEMPLATES = {\r\n        action: {\r\n            type: \"action\", name: \"\", actionType: \"Offensive\",\r\n            stackWith: \"\", roll: \"\", onHit: \"\", energyCost: 0\r\n        },\r\n        \"item-weapon\": {\r\n            type: \"item\", subtype: \"weapon\", name: \"\", fabric: \"\",\r\n            slot: \"Hand (1H)\", rarity: \"COMMON\", atk: 3, range: \"Melee\",\r\n            damageType: \"Slashing\", requires: {}, special: null, durability: 8\r\n        },\r\n        \"item-consumable\": {\r\n            type: \"item\", subtype: \"consumable\", name: \"\", fabric: \"\",\r\n            rarity: \"COMMON\", effect: \"\"\r\n        },\r\n        apparel: {\r\n            type: \"apparel\", name: \"\", fabric: \"\",\r\n            slot: \"Body\", rarity: \"COMMON\", def: 1, hpBonus: 0,\r\n            durability: 5, special: null\r\n        },\r\n        skill: {\r\n            type: \"skill\", name: \"\", category: \"Combat\",\r\n            modifier: \"\", requires: {}, tier: \"COMMON\"\r\n        },\r\n        magic: {\r\n            type: \"magic\", name: \"\", effectType: \"Offensive\",\r\n            skillType: \"Imperial\", requires: {},\r\n            effect: \"\", stackWith: \"\", energyCost: 4, reusable: true\r\n        }\r\n    };\r\n\r\n    //  Card Editor Functions \r\n\r\n    function startAddCard(templateKey) {\r\n        editingCard = JSON.parse(JSON.stringify(CARD_TEMPLATES[templateKey]));\r\n        editingCardIndex = -1;\r\n        addCardTypeOpen = false;\r\n        m.redraw();\r\n    }\r\n\r\n    function startEditCard(card, index) {\r\n        editingCard = JSON.parse(JSON.stringify(card));\r\n        editingCardIndex = index;\r\n        m.redraw();\r\n    }\r\n\r\n    function saveEditingCard() {\r\n        let builtDeck = ctx().builtDeck;\r\n        if (!editingCard || !builtDeck) return;\r\n        // Build display name from fabric + name if fabric present\r\n        if (editingCard.fabric && editingCard.name && !editingCard.name.startsWith(editingCard.fabric)) {\r\n            editingCard._displayName = editingCard.fabric + \" \" + editingCard.name;\r\n        }\r\n        if (editingCardIndex >= 0) {\r\n            builtDeck.cards[editingCardIndex] = editingCard;\r\n        } else {\r\n            builtDeck.cards.push(editingCard);\r\n        }\r\n        builtDeck.cardCount = builtDeck.cards.length;\r\n        editingCard = null;\r\n        editingCardIndex = -1;\r\n        m.redraw();\r\n    }\r\n\r\n    function cancelEditingCard() {\r\n        editingCard = null;\r\n        editingCardIndex = -1;\r\n        m.redraw();\r\n    }\r\n\r\n    function deleteCard(index) {\r\n        let builtDeck = ctx().builtDeck;\r\n        if (!builtDeck) return;\r\n        builtDeck.cards.splice(index, 1);\r\n        builtDeck.cardCount = builtDeck.cards.length;\r\n        m.redraw();\r\n    }\r\n\r\n    // Simple field editor for card properties\r\n    function cardField(label, key, opts) {\r\n        opts = opts || {};\r\n        let val = editingCard[key];\r\n        if (opts.type === \"number\") {\r\n            return m(\"div\", { class: \"cg2-edit-field\" }, [\r\n                m(\"label\", label),\r\n                m(\"input\", {\r\n                    type: \"number\", value: val || 0,\r\n                    min: opts.min || 0, max: opts.max || 999,\r\n                    oninput(e) { editingCard[key] = parseFloat(e.target.value) || 0; }\r\n                })\r\n            ]);\r\n        }\r\n        if (opts.type === \"select\") {\r\n            return m(\"div\", { class: \"cg2-edit-field\" }, [\r\n                m(\"label\", label),\r\n                m(\"select\", {\r\n                    value: val || \"\",\r\n                    onchange(e) { editingCard[key] = e.target.value; }\r\n                }, (opts.options || []).map(o => m(\"option\", { value: o }, o)))\r\n            ]);\r\n        }\r\n        // Default: text\r\n        return m(\"div\", { class: \"cg2-edit-field\" }, [\r\n            m(\"label\", label),\r\n            m(\"input\", {\r\n                type: \"text\", value: val || \"\",\r\n                placeholder: opts.placeholder || \"\",\r\n                oninput(e) { editingCard[key] = e.target.value; }\r\n            })\r\n        ]);\r\n    }\r\n\r\n    //  CardEditorFields Component \r\n    function CardEditorFields() {\r\n        return {\r\n            view() {\r\n                if (!editingCard) return null;\r\n                let t = editingCard.type;\r\n                let sub = editingCard.subtype;\r\n                let fields = [\r\n                    cardField(\"Name\", \"name\", { placeholder: \"Card name\" })\r\n                ];\r\n\r\n                if (t === \"action\") {\r\n                    fields.push(\r\n                        cardField(\"Action Type\", \"actionType\", { type: \"select\", options: [\"Offensive\", \"Movement\", \"Discovery\", \"Social\", \"Recovery\", \"Utility\", \"Creation\"] }),\r\n                        cardField(\"Stack With\", \"stackWith\", { placeholder: \"e.g. Character + Weapon\" }),\r\n                        cardField(\"Roll\", \"roll\", { placeholder: \"e.g. 1d20 + STR\" }),\r\n                        cardField(\"On Hit\", \"onHit\", { placeholder: \"Effect on success\" }),\r\n                        cardField(\"Energy Cost\", \"energyCost\", { type: \"number\", min: 0, max: 20 })\r\n                    );\r\n                } else if (t === \"item\" && sub === \"weapon\") {\r\n                    fields.push(\r\n                        cardField(\"Material\", \"fabric\", { placeholder: \"e.g. steel, iron\" }),\r\n                        cardField(\"Slot\", \"slot\", { type: \"select\", options: [\"Hand (1H)\", \"Hand (2H)\"] }),\r\n                        cardField(\"Rarity\", \"rarity\", { type: \"select\", options: [\"COMMON\", \"UNCOMMON\", \"RARE\", \"EPIC\", \"LEGENDARY\"] }),\r\n                        cardField(\"ATK\", \"atk\", { type: \"number\", min: 0, max: 20 }),\r\n                        cardField(\"Range\", \"range\", { type: \"select\", options: [\"Melee\", \"Ranged\", \"Reach\"] }),\r\n                        cardField(\"Damage Type\", \"damageType\", { type: \"select\", options: [\"Slashing\", \"Piercing\", \"Bludgeoning\", \"Fire\", \"Ice\", \"Lightning\", \"Poison\"] }),\r\n                        cardField(\"Special\", \"special\", { placeholder: \"Special ability (optional)\" }),\r\n                        cardField(\"Durability\", \"durability\", { type: \"number\", min: 1, max: 99 })\r\n                    );\r\n                } else if (t === \"item\" && sub === \"consumable\") {\r\n                    fields.push(\r\n                        cardField(\"Material\", \"fabric\", { placeholder: \"e.g. herbal, glass\" }),\r\n                        cardField(\"Rarity\", \"rarity\", { type: \"select\", options: [\"COMMON\", \"UNCOMMON\", \"RARE\", \"EPIC\", \"LEGENDARY\"] }),\r\n                        cardField(\"Effect\", \"effect\", { placeholder: \"e.g. Restore 8 HP\" })\r\n                    );\r\n                } else if (t === \"apparel\") {\r\n                    fields.push(\r\n                        cardField(\"Material\", \"fabric\", { placeholder: \"e.g. leather, wool\" }),\r\n                        cardField(\"Slot\", \"slot\", { type: \"select\", options: [\"Head\", \"Body\", \"Feet\", \"Back\", \"Ring\", \"Hand\"] }),\r\n                        cardField(\"Rarity\", \"rarity\", { type: \"select\", options: [\"COMMON\", \"UNCOMMON\", \"RARE\", \"EPIC\", \"LEGENDARY\"] }),\r\n                        cardField(\"DEF\", \"def\", { type: \"number\", min: 0, max: 20 }),\r\n                        cardField(\"HP Bonus\", \"hpBonus\", { type: \"number\", min: 0, max: 20 }),\r\n                        cardField(\"Special\", \"special\", { placeholder: \"Special ability (optional)\" }),\r\n                        cardField(\"Durability\", \"durability\", { type: \"number\", min: 1, max: 99 })\r\n                    );\r\n                } else if (t === \"skill\") {\r\n                    fields.push(\r\n                        cardField(\"Category\", \"category\", { type: \"select\", options: [\"Combat\", \"Defense\", \"Survival\", \"Social\", \"Crafting\", \"Discovery\", \"Magic\"] }),\r\n                        cardField(\"Modifier\", \"modifier\", { placeholder: \"e.g. +2 to Attack rolls\" }),\r\n                        cardField(\"Tier\", \"tier\", { type: \"select\", options: [\"COMMON\", \"UNCOMMON\", \"RARE\", \"EPIC\", \"LEGENDARY\"] })\r\n                    );\r\n                } else if (t === \"magic\") {\r\n                    fields.push(\r\n                        cardField(\"Effect Type\", \"effectType\", { type: \"select\", options: [\"Offensive\", \"Defensive\", \"Restorative\", \"Discovery\", \"Utility\"] }),\r\n                        cardField(\"Skill Type\", \"skillType\", { type: \"select\", options: [\"Imperial\", \"Undead\", \"Psionic\", \"Elemental\", \"Nature\"] }),\r\n                        cardField(\"Effect\", \"effect\", { placeholder: \"e.g. Deal 6 fire damage\" }),\r\n                        cardField(\"Stack With\", \"stackWith\", { placeholder: \"e.g. Character + Action\" }),\r\n                        cardField(\"Energy Cost\", \"energyCost\", { type: \"number\", min: 0, max: 20 }),\r\n                        cardField(\"Reusable\", \"reusable\", { type: \"select\", options: [\"true\", \"false\"] })\r\n                    );\r\n                }\r\n\r\n                return m(\"div\", { class: \"cg2-card-editor\" }, [\r\n                    m(\"div\", { class: \"cg2-card-editor-header\" }, [\r\n                        m(\"span\", { style: { fontWeight: 700, fontSize: \"14px\" } },\r\n                            editingCardIndex >= 0 ? \"Edit Card\" : \"Add Card\"),\r\n                        m(\"span\", {\r\n                            class: \"material-symbols-outlined\",\r\n                            style: { cursor: \"pointer\", fontSize: \"18px\", color: \"#888\" },\r\n                            onclick: cancelEditingCard\r\n                        }, \"close\")\r\n                    ]),\r\n                    m(\"div\", { class: \"cg2-card-editor-fields\" }, fields),\r\n                    m(\"div\", { class: \"cg2-card-editor-actions\" }, [\r\n                        m(\"button\", { class: \"cg2-btn\", onclick: cancelEditingCard }, \"Cancel\"),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\",\r\n                            disabled: !editingCard.name || !editingCard.name.trim(),\r\n                            onclick: saveEditingCard\r\n                        }, editingCardIndex >= 0 ? \"Update\" : \"Add to Deck\")\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Builder Step 1: Theme Select \r\n    function BuilderThemeStep() {\r\n        return {\r\n            view() {\r\n                return m(\"div\", [\r\n                    m(\"div\", { class: \"cg2-section-title\" }, \"Step 1: Select Theme\"),\r\n                    m(\"div\", { class: \"cg2-theme-grid\" }, [\r\n                        themeOption(\"high-fantasy\", \"High Fantasy\", \"Classic high fantasy with vibrant magic and epic adventures\", \"auto_fix_high\"),\r\n                        themeOption(\"dark-medieval\", \"Dark Medieval\", \"Gritty medieval setting with low magic and high mortality\", \"skull\"),\r\n                        themeOption(\"sci-fi\", \"Sci-Fi\", \"Far-future space setting with psionic powers and tech items\", \"rocket_launch\"),\r\n                        themeOption(\"post-apocalypse\", \"Post Apocalypse\", \"Harsh wasteland survival with scavenged gear and mutant threats\", \"destruction\")\r\n                    ]),\r\n                    m(\"div\", { class: \"cg2-builder-nav\" }, [\r\n                        m(\"button\", { class: \"cg2-btn\", onclick: () => { ctx().screen = \"deckList\"; m.redraw(); } }, \"Cancel\"),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\",\r\n                            onclick() { ctx().builderStep = 2; chars().loadAvailableCharacters(); m.redraw(); }\r\n                        }, \"Next: Select Character \\u2192\")\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    function themeOption(id, name, desc, icon) {\r\n        let activeTheme = themes().state.activeTheme;\r\n        let selected = activeTheme.themeId === id;\r\n        return m(\"div\", {\r\n            class: \"cg2-theme-card\" + (selected ? \" cg2-theme-selected\" : \"\"),\r\n            onclick() {\r\n                themes().loadThemeConfig(id);\r\n                m.redraw();\r\n            }\r\n        }, [\r\n            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"32px\", color: selected ? \"#B8860B\" : \"#888\" } }, icon),\r\n            m(\"div\", { class: \"cg2-theme-name\" }, name),\r\n            m(\"div\", { class: \"cg2-theme-desc\" }, desc),\r\n            selected ? m(\"div\", { class: \"cg2-theme-badge\" }, \"\\u2713 Selected\") : null\r\n        ]);\r\n    }\r\n\r\n    //  Builder Step 2: Character Picker \r\n    function BuilderCharacterStep() {\r\n        return {\r\n            view() {\r\n                let charsState = chars().state;\r\n                let availableCharacters = charsState.availableCharacters;\r\n                let selectedChars = charsState.selectedChars;\r\n                let charsLoading = charsState.charsLoading;\r\n                let generatingCharacters = charsState.generatingCharacters;\r\n                let activeTheme = themes().state.activeTheme;\r\n                let applyingOutfits = themes().state.applyingOutfits;\r\n                let buildingDeck = ctx().buildingDeck;\r\n                let deckNameInput = ctx().deckNameInput;\r\n\r\n                return m(\"div\", [\r\n                    m(\"div\", { class: \"cg2-section-title\" }, \"Step 2: Select Character for Deck\"),\r\n                    // Generate Characters panel (Phase 7.1)\r\n                    m(\"div\", { class: \"cg2-gen-panel\", style: { marginBottom: \"16px\", padding: \"12px\", background: \"#f9f9f9\", borderRadius: \"8px\", border: \"1px solid #e0e0e0\" } }, [\r\n                        m(\"div\", { style: { fontWeight: 600, marginBottom: \"8px\" } }, \"Quick Start: Generate Balanced Characters\"),\r\n                        m(\"p\", { style: { fontSize: \"12px\", color: \"#666\", margin: \"0 0 12px 0\" } },\r\n                            \"Creates 8 characters with balanced stats from templates. Each character has a unique name and appearance, but stats are balanced for fair gameplay.\"),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\",\r\n                            disabled: generatingCharacters,\r\n                            style: { display: \"flex\", alignItems: \"center\", gap: \"8px\" },\r\n                            async onclick() {\r\n                                if (generatingCharacters) return;\r\n                                const themeId = activeTheme?.themeId || \"high-fantasy\";\r\n                                const generated = await chars().generateCharactersFromTemplates(themeId, 8);\r\n                                if (generated.length > 0) {\r\n                                    // Add generated characters to available list and auto-select them\r\n                                    for (const charPerson of generated) {\r\n                                        charsState.availableCharacters.push(charPerson);\r\n                                        if (charsState.selectedChars.length < 8) {\r\n                                            charsState.selectedChars.push(charPerson);\r\n                                        }\r\n                                    }\r\n                                }\r\n                                m.redraw();\r\n                            }\r\n                        }, [\r\n                            generatingCharacters\r\n                                ? m(\"span\", { class: \"material-symbols-outlined cg2-spin\" }, \"progress_activity\")\r\n                                : m(\"span\", { class: \"material-symbols-outlined\" }, \"auto_awesome\"),\r\n                            generatingCharacters ? \"Generating...\" : \"Generate 8 Characters\"\r\n                        ])\r\n                    ]),\r\n                    charsLoading\r\n                        ? m(\"div\", { class: \"cg2-loading\" }, \"Loading characters...\")\r\n                        : m(\"div\", { class: \"cg2-char-grid\" }, [\r\n                            ...availableCharacters.map(ch => charPickerCard(ch)),\r\n                            m(\"div\", {\r\n                                class: \"cg2-char-card cg2-char-card-new\",\r\n                                disabled: generatingCharacters,\r\n                                async onclick() {\r\n                                    if (generatingCharacters) return;\r\n                                    const themeId = activeTheme?.themeId || \"high-fantasy\";\r\n                                    const generated = await chars().generateCharactersFromTemplates(themeId, 1);\r\n                                    if (generated.length > 0) {\r\n                                        charsState.availableCharacters.push(generated[0]);\r\n                                        if (charsState.selectedChars.length < 8) {\r\n                                            charsState.selectedChars.push(generated[0]);\r\n                                        }\r\n                                    }\r\n                                    m.redraw();\r\n                                }\r\n                            }, [\r\n                                generatingCharacters\r\n                                    ? m(\"span\", { class: \"material-symbols-outlined cg2-spin\", style: { fontSize: \"48px\", color: \"#888\" } }, \"progress_activity\")\r\n                                    : m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"48px\", color: \"#888\" } }, \"add_circle\"),\r\n                                m(\"div\", { style: { fontWeight: 600, marginTop: \"8px\" } }, \"Add One\"),\r\n                                m(\"div\", { style: { fontSize: \"10px\", color: \"#999\" } }, \"Generate Character\")\r\n                            ])\r\n                        ]),\r\n                    selectedChars.length ? [\r\n                        m(\"div\", { class: \"cg2-section-title\", style: { marginTop: \"16px\" } },\r\n                            \"Selected: \" + selectedChars.length + \" of 8 characters\"),\r\n                        m(\"div\", { class: \"cg2-selected-chips\" },\r\n                            selectedChars.map(ch => {\r\n                                let portrait = chars().getPortraitUrl(ch, \"128x128\");\r\n                                return m(\"div\", { class: \"cg2-selected-chip\", key: chars().getCharId(ch) }, [\r\n                                    portrait\r\n                                        ? m(\"img\", { src: portrait })\r\n                                        : m(\"span\", { class: \"cg2-chip-icon\" }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"person\")),\r\n                                    m(\"span\", ch.name || \"Unnamed\"),\r\n                                    m(\"span\", {\r\n                                        class: \"cg2-chip-remove material-symbols-outlined\",\r\n                                        onclick(e) {\r\n                                            e.stopPropagation();\r\n                                            charsState.selectedChars = charsState.selectedChars.filter(s => chars().getCharId(s) !== chars().getCharId(ch));\r\n                                            m.redraw();\r\n                                        }\r\n                                    }, \"close\")\r\n                                ]);\r\n                            })\r\n                        )\r\n                    ] : null,\r\n                    m(\"div\", { class: \"cg2-builder-nav\" }, [\r\n                        m(\"button\", { class: \"cg2-btn\", onclick: () => { ctx().builderStep = 1; m.redraw(); } }, \"\\u2190 Back\"),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\",\r\n                            disabled: !selectedChars.length || applyingOutfits || buildingDeck,\r\n                            async onclick() {\r\n                                if (!selectedChars.length || applyingOutfits || buildingDeck) return;\r\n\r\n                                // Persist any generated characters first (need real IDs for outfits)\r\n                                const unpersisted = selectedChars.filter(ch => ch._tempId && !ch.objectId);\r\n                                if (unpersisted.length > 0) {\r\n                                    // Need a deck name to persist characters\r\n                                    let tempDeckName = deckNameInput.trim() || \"Deck_\" + Date.now();\r\n                                    ctx().buildingDeck = true;\r\n                                    m.redraw();\r\n                                    page.toast(\"info\", \"Saving characters...\");\r\n                                    const persisted = await chars().persistGeneratedCharacters(unpersisted, tempDeckName);\r\n                                    // Update selectedChars with persisted versions (have objectId now)\r\n                                    for (const p of persisted) {\r\n                                        const idx = selectedChars.findIndex(ch => ch._tempId && ch.name === p.name);\r\n                                        if (idx >= 0) {\r\n                                            selectedChars[idx] = p;\r\n                                        }\r\n                                    }\r\n                                    ctx().deckNameInput = tempDeckName;\r\n                                    ctx().buildingDeck = false;\r\n                                }\r\n\r\n                                ctx().builtDeck = chars().assembleStarterDeck(selectedChars, activeTheme);\r\n                                ctx().builtDeck.deckName = deckNameInput || ctx().builtDeck.deckName;\r\n                                if (activeTheme && activeTheme.outfits) {\r\n                                    await themes().applyThemeOutfits(ctx().builtDeck, activeTheme, true);\r\n                                }\r\n                                ctx().builderStep = 3;\r\n                                m.redraw();\r\n                            }\r\n                        }, buildingDeck ? \"Saving Characters...\" : (applyingOutfits ? \"Applying Outfits...\" : \"Next: Review Deck \\u2192\"))\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    function charPickerCard(ch) {\r\n        let portrait = chars().getPortraitUrl(ch, \"128x128\");\r\n        let stats = chars().mapStats(ch.statistics);\r\n        let chId = chars().getCharId(ch);\r\n        let selectedChars = chars().state.selectedChars;\r\n        let isSelected = selectedChars.some(s => chars().getCharId(s) === chId);\r\n        return m(\"div\", {\r\n            class: \"cg2-char-card\" + (isSelected ? \" cg2-char-selected\" : \"\"),\r\n            onclick() {\r\n                if (isSelected) {\r\n                    chars().state.selectedChars = selectedChars.filter(s => chars().getCharId(s) !== chId);\r\n                } else if (selectedChars.length < 8) {\r\n                    chars().state.selectedChars = [...selectedChars, ch];\r\n                } else {\r\n                    page.toast(\"warn\", \"Maximum 8 characters per deck\");\r\n                }\r\n                m.redraw();\r\n            }\r\n        }, [\r\n            m(\"div\", { class: \"cg2-char-portrait\" },\r\n                portrait\r\n                    ? m(\"img\", { src: portrait })\r\n                    : m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"48px\", color: \"#B8860B\" } }, \"person\")\r\n            ),\r\n            m(\"div\", { class: \"cg2-char-name\" }, ch.name || \"Unnamed\"),\r\n            m(\"div\", { class: \"cg2-char-meta\" }, [\r\n                chars().str(ch.gender).charAt(0).toUpperCase(),\r\n                \" \",\r\n                chars().str(ch.race).replace(/_/g, \" \"),\r\n                ch.age ? \", \" + ch.age : \"\",\r\n                ch.trades && ch.trades[0] ? \" - \" + ch.trades[0] : \"\"\r\n            ]),\r\n            m(\"div\", { class: \"cg2-char-stats-mini\" }, [\r\n                [\"STR\", \"AGI\", \"END\"].map(s => m(\"span\", { key: s }, s + \":\" + chars().clampStat(stats[s]))),\r\n                m(\"br\"),\r\n                [\"INT\", \"MAG\", \"CHA\"].map(s => m(\"span\", { key: s }, s + \":\" + chars().clampStat(stats[s])))\r\n            ]),\r\n            isSelected ? m(\"div\", { class: \"cg2-char-badge\" }, \"\\u2713\") : null,\r\n            ch._customChar ? m(\"div\", { class: \"cg2-char-source-badge\" }, \"Custom\") : null,\r\n            ch._tempId ? m(\"div\", { class: \"cg2-char-source-badge\", style: { background: \"#4a7c59\" } }, \"Generated\") : null\r\n        ]);\r\n    }\r\n\r\n    //  Builder Step 3: Review & Build \r\n    function BuilderReviewStep() {\r\n        return {\r\n            view() {\r\n                let builtDeck = ctx().builtDeck;\r\n                let buildingDeck = ctx().buildingDeck;\r\n                let deckNameInput = ctx().deckNameInput;\r\n                let CARD_TYPES = C.CARD_TYPES;\r\n                let CardFace = window.CardGame.Rendering.CardFace;\r\n\r\n                if (!builtDeck) return m(\"div\", \"No deck assembled\");\r\n                let cards = builtDeck.cards || [];\r\n                let charCard = cards.find(c => c.type === \"character\");\r\n                return m(\"div\", [\r\n                    m(\"div\", { class: \"cg2-section-title\" }, \"Step 3: Review & Build Deck\"),\r\n                    m(\"div\", { class: \"cg2-deck-name-row\" }, [\r\n                        m(\"label\", { class: \"cg2-deck-name-label\" }, \"Deck Name\"),\r\n                        m(\"input\", {\r\n                            class: \"cg2-deck-name-input\",\r\n                            type: \"text\",\r\n                            value: deckNameInput,\r\n                            oninput(e) { ctx().deckNameInput = e.target.value; },\r\n                            placeholder: \"Enter a name for this deck\"\r\n                        })\r\n                    ]),\r\n                    m(\"div\", { class: \"cg2-review-summary\" }, [\r\n                        m(\"span\", { class: \"cg2-review-stat\" }, \"Theme: \" + (builtDeck.themeId || \"high-fantasy\")),\r\n                        m(\"span\", { class: \"cg2-review-stat\" }, \"Characters: \" + (builtDeck.characterNames || []).join(\", \")),\r\n                        m(\"span\", { class: \"cg2-review-stat\" }, \"Cards: \" + cards.length),\r\n                        charCard ? m(\"span\", { class: \"cg2-review-stat\" }, \"HP: \" + charCard.needs.hp + \" | NRG: \" + charCard.needs.energy + \" | MRL: \" + charCard.needs.morale) : null\r\n                    ]),\r\n                    // Add Card toolbar\r\n                    m(\"div\", { class: \"cg2-toolbar\", style: { justifyContent: \"space-between\" } }, [\r\n                        m(\"div\", { class: \"cg2-section-title\", style: { margin: 0 } }, \"All Cards\"),\r\n                        m(\"div\", { style: { position: \"relative\" } }, [\r\n                            m(\"button\", {\r\n                                class: \"cg2-btn cg2-btn-primary\",\r\n                                style: { fontSize: \"11px\" },\r\n                                onclick() { addCardTypeOpen = !addCardTypeOpen; m.redraw(); }\r\n                            }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"3px\" } }, \"add\"),\r\n                                \"Add Card\"\r\n                            ]),\r\n                            addCardTypeOpen ? m(\"div\", { class: \"cg2-add-card-dropdown\" },\r\n                                [\r\n                                    { key: \"action\", label: \"Action\", icon: \"bolt\", color: CARD_TYPES.action.color },\r\n                                    { key: \"item-weapon\", label: \"Weapon\", icon: \"swords\", color: CARD_TYPES.item.color },\r\n                                    { key: \"item-consumable\", label: \"Consumable\", icon: \"science\", color: CARD_TYPES.item.color },\r\n                                    { key: \"apparel\", label: \"Apparel\", icon: \"checkroom\", color: CARD_TYPES.apparel.color },\r\n                                    { key: \"skill\", label: \"Skill\", icon: \"star\", color: CARD_TYPES.skill.color },\r\n                                    { key: \"magic\", label: \"Magic Effect\", icon: \"auto_fix_high\", color: CARD_TYPES.magic.color }\r\n                                ].map(item =>\r\n                                    m(\"div\", {\r\n                                        class: \"cg2-add-card-option\",\r\n                                        onclick() { startAddCard(item.key); }\r\n                                    }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", color: item.color, marginRight: \"6px\" } }, item.icon),\r\n                                        item.label\r\n                                    ])\r\n                                )\r\n                            ) : null\r\n                        ])\r\n                    ]),\r\n                    // Card editor panel (shown when editing/adding)\r\n                    editingCard ? m(CardEditorFields) : null,\r\n                    // Card grid with edit/delete overlays\r\n                    m(\"div\", { class: \"cg2-card-grid\" },\r\n                        cards.map((card, i) => {\r\n                            let isCharacter = card.type === \"character\";\r\n                            return m(\"div\", { class: \"cg2-card-art-wrapper\", key: card.name + \"-\" + i }, [\r\n                                m(CardFace, { card, full: true }),\r\n                                !isCharacter ? m(\"div\", { class: \"cg2-card-edit-actions\" }, [\r\n                                    m(\"button\", {\r\n                                        class: \"cg2-card-action-btn\",\r\n                                        title: \"Edit card\",\r\n                                        onclick(e) { e.stopPropagation(); startEditCard(card, i); }\r\n                                    }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"edit\")),\r\n                                    m(\"button\", {\r\n                                        class: \"cg2-card-action-btn cg2-card-action-btn-danger\",\r\n                                        title: \"Remove card\",\r\n                                        onclick(e) { e.stopPropagation(); deleteCard(i); }\r\n                                    }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"delete\"))\r\n                                ]) : null\r\n                            ]);\r\n                        })\r\n                    ),\r\n                    m(\"div\", { class: \"cg2-builder-nav\" }, [\r\n                        m(\"button\", { class: \"cg2-btn\", onclick: () => { ctx().builderStep = 2; m.redraw(); } }, \"\\u2190 Back\"),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\",\r\n                            disabled: buildingDeck || !deckNameInput.trim(),\r\n                            onclick() {\r\n                                ctx().builtDeck.deckName = deckNameInput.trim();\r\n                                CardGame.UI.saveDeck(ctx().builtDeck);\r\n                            }\r\n                        }, buildingDeck ? \"Saving...\" : \"Build & Save Deck\")\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Expose on CardGame namespace \r\n    Object.assign(window.CardGame.UI, {\r\n        builderState: {\r\n            get editingCard() { return editingCard; },\r\n            set editingCard(v) { editingCard = v; },\r\n            get editingCardIndex() { return editingCardIndex; },\r\n            set editingCardIndex(v) { editingCardIndex = v; },\r\n            get addCardTypeOpen() { return addCardTypeOpen; },\r\n            set addCardTypeOpen(v) { addCardTypeOpen = v; }\r\n        },\r\n        BuilderThemeStep,\r\n        BuilderCharacterStep,\r\n        BuilderReviewStep,\r\n        CardEditorFields\r\n    });\r\n\r\n    console.log('[CardGame] UI/builder module loaded');\r\n\r\n})();\r\n\n\n;/* === client/view/cardGame/ui/deckView.js === */\n/**\r\n * CardGame UI - Deck View / Editor with Art Generation Controls\r\n * Card grid display with flip capability, art generation controls (queue all,\r\n * single card, background, tabletop, card front/back), SD Config panel with\r\n * override tabs, Game Config panel (LLM, voice settings), and refresh/outfit controls.\r\n *\r\n * Extracted from cardGame-v2.js (lines ~9906-10584).\r\n *\r\n * Depends on:\r\n *   - CardGame.Constants (CARD_TYPES, TEMPLATE_TYPES)\r\n *   - CardGame.Rendering (CardFace, showImagePreview, ImagePreviewOverlay, GalleryPickerOverlay,\r\n *                         renderCharacterBackBody)\r\n *   - CardGame.ctx (viewingDeck, screen, gameState, activeTheme, artQueue, artCompleted,\r\n *                   artTotal, artPaused, artDir, backgroundImageId, backgroundThumbUrl,\r\n *                   backgroundPrompt, backgroundGenerating, tabletopImageId, tabletopThumbUrl,\r\n *                   tabletopGenerating, cardFrontImageUrl, cardBackImageUrl, cardFrontGenerating,\r\n *                   cardBackGenerating, flippedCards, sdOverrides, sdOverrideInsts,\r\n *                   sdOverrideViews, sdConfigExpanded, sdConfigTab, gameConfigExpanded,\r\n *                   voiceProfiles, voiceProfilesLoaded, applyingOutfits, sequenceCardId,\r\n *                   sequenceProgress, gameCharSelection)\r\n *   - CardGame.Services (refreshAllCharacters, refreshCharacterCard, applyThemeOutfits,\r\n *                        queueDeckArt, cancelArtQueue, processArtQueue, generateBackground,\r\n *                        generateTabletop, generateTemplateArt, generateImageSequence,\r\n *                        openGalleryPicker, buildCardPrompt, loadVoiceProfiles, loadThemeConfig)\r\n *   - CardGame.Storage (deckStorage)\r\n *   - CardGame.Actions (newSdOverride, defaultSdOverrides, resetSdOverrideInsts,\r\n *                       getSdOverrideInst, getDeckGameConfig, currentDeckSafeName,\r\n *                       ArtQueueProgress)\r\n *   - CardGame.AI (CardGameNarrator)\r\n *\r\n * Exposes: window.CardGame.UI.DeckView\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.UI = window.CardGame.UI || {};\r\n\r\n    const C = window.CardGame.Constants;\r\n\r\n    function DeckView() {\r\n        return {\r\n            oninit() {\r\n                let ctx = window.CardGame.ctx || {};\r\n                let viewingDeck = ctx.viewingDeck;\r\n\r\n                // Restore background reference from saved deck\r\n                if (viewingDeck && viewingDeck.backgroundImageId) {\r\n                    ctx.backgroundImageId = viewingDeck.backgroundImageId;\r\n                    ctx.backgroundPrompt = viewingDeck.backgroundPrompt || null;\r\n                    ctx.backgroundThumbUrl = viewingDeck.backgroundThumbUrl || null;\r\n                } else {\r\n                    ctx.backgroundImageId = null;\r\n                    ctx.backgroundPrompt = null;\r\n                    ctx.backgroundThumbUrl = null;\r\n                }\r\n                // Restore tabletop reference from saved deck\r\n                if (viewingDeck && viewingDeck.tabletopImageId) {\r\n                    ctx.tabletopImageId = viewingDeck.tabletopImageId;\r\n                    ctx.tabletopThumbUrl = viewingDeck.tabletopThumbUrl || null;\r\n                } else {\r\n                    ctx.tabletopImageId = null;\r\n                    ctx.tabletopThumbUrl = null;\r\n                }\r\n                // Restore SD overrides from saved deck\r\n                if (viewingDeck && viewingDeck.sdOverrides) {\r\n                    let saved = viewingDeck.sdOverrides;\r\n                    ctx.sdOverrides = { _default: CardGame.ArtPipeline.newSdOverride() };\r\n                    // Merge saved _default with model defaults\r\n                    if (saved._default) Object.assign(ctx.sdOverrides._default, saved._default);\r\n                    // Restore any explicitly-saved non-default tabs\r\n                    Object.keys(saved).forEach(k => {\r\n                        if (k !== \"_default\" && saved[k]) {\r\n                            let copy = JSON.parse(JSON.stringify(saved[k]));\r\n                            copy[am7model.jsonModelKey] = \"olio.sd.config\";\r\n                            ctx.sdOverrides[k] = copy;\r\n                        }\r\n                    });\r\n                } else {\r\n                    ctx.sdOverrides = CardGame.ArtPipeline.defaultSdOverrides();\r\n                }\r\n                CardGame.ArtPipeline.resetSdOverrideInsts();\r\n                ctx.sdConfigExpanded = false;\r\n                ctx.sdConfigTab = \"_default\";\r\n                ctx.gameConfigExpanded = false;\r\n                ctx.flippedCards = {};\r\n            },\r\n            view() {\r\n                let ctx = window.CardGame.ctx || {};\r\n                let viewingDeck = ctx.viewingDeck;\r\n                let activeTheme = ctx.activeTheme;\r\n                let CARD_TYPES = C.CARD_TYPES;\r\n                let TEMPLATE_TYPES = C.TEMPLATE_TYPES;\r\n                let R = window.CardGame.Rendering;\r\n\r\n                if (!viewingDeck) return m(\"div\", \"No deck loaded\");\r\n                let allCards = viewingDeck.cards || [];\r\n\r\n                // Get unique cards by signature (name + type + subtype)\r\n                let uniqueMap = {};\r\n                allCards.forEach((card, i) => {\r\n                    let sig = card.name + \"|\" + card.type + \"|\" + (card.subtype || \"\");\r\n                    if (!uniqueMap[sig]) {\r\n                        uniqueMap[sig] = { card, index: i, count: 1 };\r\n                    } else {\r\n                        uniqueMap[sig].count++;\r\n                    }\r\n                });\r\n                let uniqueCards = Object.values(uniqueMap);\r\n\r\n                let artQueue = ctx.artQueue || [];\r\n                let backgroundGenerating = ctx.backgroundGenerating;\r\n                let tabletopGenerating = ctx.tabletopGenerating;\r\n                let cardFrontGenerating = ctx.cardFrontGenerating;\r\n                let cardBackGenerating = ctx.cardBackGenerating;\r\n                let sequenceCardId = ctx.sequenceCardId;\r\n                let backgroundImageId = ctx.backgroundImageId;\r\n                let backgroundThumbUrl = ctx.backgroundThumbUrl;\r\n                let tabletopImageId = ctx.tabletopImageId;\r\n                let tabletopThumbUrl = ctx.tabletopThumbUrl;\r\n                let cardFrontImageUrl = ctx.cardFrontImageUrl;\r\n                let cardBackImageUrl = ctx.cardBackImageUrl;\r\n                let flippedCards = ctx.flippedCards || {};\r\n                let sdOverrides = ctx.sdOverrides || {};\r\n                let sdOverrideInsts = ctx.sdOverrideInsts || {};\r\n                let sdConfigExpanded = ctx.sdConfigExpanded;\r\n                let sdConfigTab = ctx.sdConfigTab || \"_default\";\r\n                let gameConfigExpanded = ctx.gameConfigExpanded;\r\n                let voiceProfiles = ctx.voiceProfiles || [];\r\n                let voiceProfilesLoaded = ctx.voiceProfilesLoaded;\r\n                let applyingOutfits = ctx.applyingOutfits;\r\n\r\n                let queueActive = artQueue.some(j => j.status === \"pending\" || j.status === \"processing\");\r\n                let busy = queueActive || backgroundGenerating || tabletopGenerating || cardFrontGenerating || cardBackGenerating || !!sequenceCardId;\r\n                return m(\"div\", [\r\n                    m(\"div\", { class: \"cg2-toolbar\" }, [\r\n                        m(\"button\", { class: \"cg2-btn\", onclick: () => { ctx.screen = \"deckList\"; ctx.viewingDeck = null; CardGame.ArtPipeline.cancelArtQueue(); ctx.artTotal = 0; ctx.backgroundImageId = null; ctx.backgroundThumbUrl = null; m.redraw(); } }, \"\\u2190 Back to Decks\"),\r\n                        m(\"span\", { style: { fontWeight: 700, fontSize: \"16px\", marginLeft: \"8px\" } }, viewingDeck.deckName || \"Deck\"),\r\n                        viewingDeck.themeId ? m(\"span\", { class: \"cg2-deck-theme-badge\", style: { marginLeft: \"8px\" } }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"12px\", verticalAlign: \"middle\", marginRight: \"3px\" } }, \"auto_fix_high\"),\r\n                            viewingDeck.themeId.replace(/-/g, \" \").replace(/\\b\\w/g, c => c.toUpperCase())\r\n                        ]) : null,\r\n                        m(\"span\", { style: { color: \"#888\", fontSize: \"12px\", marginLeft: \"12px\" } }, uniqueCards.length + \" unique / \" + allCards.length + \" total\"),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn\", style: { marginLeft: \"auto\", fontSize: \"11px\" },\r\n                            disabled: busy,\r\n                            title: \"Re-fetch all character data from source objects\",\r\n                            async onclick() {\r\n                                await CardGame.Characters.refreshAllCharacters(viewingDeck);\r\n                                page.toast(\"success\", \"Character data refreshed\");\r\n                                m.redraw();\r\n                            }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"3px\" } }, \"sync\"),\r\n                            \"Refresh Data\"\r\n                        ]),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn\", style: { fontSize: \"11px\", marginLeft: \"4px\" },\r\n                            disabled: busy || applyingOutfits,\r\n                            title: \"Create theme-appropriate outfits and assign to characters\",\r\n                            async onclick() {\r\n                                await CardGame.Themes.applyThemeOutfits(viewingDeck, activeTheme);\r\n                            }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"3px\" } }, \"checkroom\"),\r\n                            applyingOutfits ? \"Outfitting...\" : \"Apply Theme Outfits\"\r\n                        ]),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\",\r\n                            style: { fontSize: \"11px\", marginLeft: \"8px\" },\r\n                            disabled: busy,\r\n                            title: \"Start a new game with this deck\",\r\n                            onclick() {\r\n                                ctx.gameState = null; // Reset any existing game\r\n                                ctx.gameCharSelection = null; // Reset character selection\r\n                                ctx.screen = \"game\";\r\n                                m.redraw();\r\n                            }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"3px\" } }, \"play_arrow\"),\r\n                            \"Play Game\"\r\n                        ]),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-sm\",\r\n                            style: { fontSize: \"11px\", marginLeft: \"4px\" },\r\n                            disabled: busy,\r\n                            title: \"Run tests using this deck\",\r\n                            onclick() {\r\n                                let deckName = viewingDeck?.deckName || viewingDeck?.storageName || null;\r\n                                if (CardGame.TestMode && CardGame.TestMode.setTestDeck) {\r\n                                    CardGame.TestMode.setTestDeck(viewingDeck, deckName);\r\n                                }\r\n                                ctx.screen = \"test\";\r\n                                m.redraw();\r\n                            }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"3px\" } }, \"science\"),\r\n                            \"Test\"\r\n                        ])\r\n                    ]),\r\n                    // SD Config panel (per-type)\r\n                    m(\"div\", { class: \"cg2-sd-panel\" }, [\r\n                        m(\"div\", {\r\n                            class: \"cg2-sd-panel-header\",\r\n                            onclick() { ctx.sdConfigExpanded = !ctx.sdConfigExpanded; m.redraw(); }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", marginRight: \"6px\", transition: \"transform 0.2s\", transform: ctx.sdConfigExpanded ? \"rotate(90deg)\" : \"\" } }, \"chevron_right\"),\r\n                            m(\"span\", { style: { fontWeight: 600, fontSize: \"13px\" } }, \"SD Config\"),\r\n                            (() => {\r\n                                let insts = ctx.sdOverrideInsts || {};\r\n                                let active = Object.keys(insts).filter(k => {\r\n                                    return insts[k] && insts[k].changes && insts[k].changes.length > 0;\r\n                                });\r\n                                return active.length\r\n                                    ? m(\"span\", { style: { fontSize: \"10px\", color: \"#2E7D32\", marginLeft: \"8px\" } }, active.length + \" type\" + (active.length > 1 ? \"s\" : \"\") + \" modified\")\r\n                                    : null;\r\n                            })()\r\n                        ]),\r\n                        ctx.sdConfigExpanded ? m(\"div\", { class: \"cg2-sd-panel-body\" }, [\r\n                            // Type tabs\r\n                            m(\"div\", { class: \"cg2-sd-tabs\" }, [\r\n                                m(\"span\", {\r\n                                    class: \"cg2-sd-tab\" + (ctx.sdConfigTab === \"_default\" ? \" cg2-sd-tab-active\" : \"\"),\r\n                                    onclick() { ctx.sdConfigTab = \"_default\"; m.redraw(); }\r\n                                }, \"Default\"),\r\n                                ...Object.keys(CARD_TYPES).map(t =>\r\n                                    m(\"span\", {\r\n                                        class: \"cg2-sd-tab\" + (ctx.sdConfigTab === t ? \" cg2-sd-tab-active\" : \"\"),\r\n                                        style: { borderBottomColor: ctx.sdConfigTab === t ? CARD_TYPES[t].color : \"transparent\" },\r\n                                        onclick() { ctx.sdConfigTab = t; m.redraw(); }\r\n                                    }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"12px\", marginRight: \"2px\", color: CARD_TYPES[t].color } }, CARD_TYPES[t].icon),\r\n                                        CARD_TYPES[t].label\r\n                                    ])\r\n                                ),\r\n                                m(\"span\", { class: \"cg2-sd-tab-sep\" }),\r\n                                ...Object.keys(TEMPLATE_TYPES).map(t =>\r\n                                    m(\"span\", {\r\n                                        class: \"cg2-sd-tab\" + (ctx.sdConfigTab === t ? \" cg2-sd-tab-active\" : \"\"),\r\n                                        style: { borderBottomColor: ctx.sdConfigTab === t ? TEMPLATE_TYPES[t].color : \"transparent\" },\r\n                                        onclick() { ctx.sdConfigTab = t; m.redraw(); }\r\n                                    }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"12px\", marginRight: \"2px\", color: TEMPLATE_TYPES[t].color } }, TEMPLATE_TYPES[t].icon),\r\n                                        TEMPLATE_TYPES[t].label\r\n                                    ])\r\n                                )\r\n                            ]),\r\n                            // Fields rendered via standard form system\r\n                            (() => {\r\n                                let inst = CardGame.ArtPipeline.getSdOverrideInst(ctx.sdConfigTab);\r\n                                let sdOvViews = ctx.sdOverrideViews || {};\r\n                                let ov = sdOvViews[ctx.sdConfigTab];\r\n                                return m(ov.view, {\r\n                                    freeForm: true,\r\n                                    freeFormType: \"olio.sd.config\",\r\n                                    freeFormEntity: inst.entity,\r\n                                    freeFormInstance: inst\r\n                                });\r\n                            })(),\r\n                            m(\"div\", { style: { display: \"flex\", justifyContent: \"space-between\", marginTop: \"6px\" } }, [\r\n                                m(\"button\", {\r\n                                    class: \"cg2-btn\", style: { fontSize: \"11px\" },\r\n                                    onclick() {\r\n                                        ctx.sdOverrides = CardGame.ArtPipeline.defaultSdOverrides();\r\n                                        CardGame.ArtPipeline.resetSdOverrideInsts();\r\n                                        ctx.sdConfigTab = \"_default\";\r\n                                        m.redraw();\r\n                                    }\r\n                                }, \"Reset All\"),\r\n                                m(\"div\", { style: { display: \"flex\", gap: \"6px\" } }, [\r\n                                    m(\"button\", {\r\n                                        class: \"cg2-btn\", style: { fontSize: \"11px\" },\r\n                                        onclick() {\r\n                                            if (ctx.sdConfigTab === \"_default\") {\r\n                                                ctx.sdOverrides[ctx.sdConfigTab] = CardGame.ArtPipeline.newSdOverride();\r\n                                            } else {\r\n                                                // Reset card type to a copy of _default\r\n                                                let copy = JSON.parse(JSON.stringify(ctx.sdOverrides._default));\r\n                                                copy[am7model.jsonModelKey] = \"olio.sd.config\";\r\n                                                ctx.sdOverrides[ctx.sdConfigTab] = copy;\r\n                                            }\r\n                                            let insts = ctx.sdOverrideInsts || {};\r\n                                            let views = ctx.sdOverrideViews || {};\r\n                                            delete insts[ctx.sdConfigTab];\r\n                                            delete views[ctx.sdConfigTab];\r\n                                            m.redraw();\r\n                                        }\r\n                                    }, \"Clear \" + (ctx.sdConfigTab === \"_default\" ? \"Default\" : (CARD_TYPES[ctx.sdConfigTab] || TEMPLATE_TYPES[ctx.sdConfigTab] || {}).label || ctx.sdConfigTab)),\r\n                                    m(\"button\", {\r\n                                        class: \"cg2-btn cg2-btn-primary\", style: { fontSize: \"11px\" },\r\n                                        async onclick() {\r\n                                            if (viewingDeck) {\r\n                                                // Fill any undefined types from _default before saving\r\n                                                let allKeys = Object.keys(CARD_TYPES).concat(Object.keys(TEMPLATE_TYPES));\r\n                                                let overrides = ctx.sdOverrides || {};\r\n                                                allKeys.forEach(k => {\r\n                                                    if (!overrides[k]) {\r\n                                                        overrides[k] = JSON.parse(JSON.stringify(overrides._default));\r\n                                                        overrides[k][am7model.jsonModelKey] = \"olio.sd.config\";\r\n                                                    }\r\n                                                });\r\n                                                viewingDeck.sdOverrides = JSON.parse(JSON.stringify(overrides));\r\n                                                let safeName = (viewingDeck.deckName || \"deck\").replace(/[^a-zA-Z0-9_\\-]/g, \"_\");\r\n                                                await CardGame.Storage.deckStorage.save(safeName, viewingDeck);\r\n                                                page.toast(\"success\", \"SD config saved to deck\");\r\n                                            }\r\n                                        }\r\n                                    }, \"Save to Deck\")\r\n                                ])\r\n                            ])\r\n                        ]) : null\r\n                    ]),\r\n                    //  Game Config panel (LLM, Voice) \r\n                    m(\"div\", { class: \"cg2-sd-panel\" }, [\r\n                        m(\"div\", {\r\n                            class: \"cg2-sd-panel-header\",\r\n                            onclick() {\r\n                                ctx.gameConfigExpanded = !ctx.gameConfigExpanded;\r\n                                if (ctx.gameConfigExpanded && !ctx.voiceProfilesLoaded) CardGame.ArtPipeline.loadVoiceProfiles();\r\n                                m.redraw();\r\n                            }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", marginRight: \"6px\", transition: \"transform 0.2s\", transform: ctx.gameConfigExpanded ? \"rotate(90deg)\" : \"\" } }, \"chevron_right\"),\r\n                            m(\"span\", { style: { fontWeight: 600, fontSize: \"13px\" } }, \"Game Config\"),\r\n                            (() => {\r\n                                let gc = CardGame.ArtPipeline.getDeckGameConfig(viewingDeck);\r\n                                let tags = [];\r\n                                if (gc.narrationEnabled === false) tags.push(\"LLM off\");\r\n                                if (gc.opponentVoiceEnabled) tags.push(\"opponent voice\");\r\n                                if (gc.announcerEnabled) tags.push(\"announcer\" + (gc.announcerVoiceEnabled ? \" +voice\" : \"\"));\r\n                                return tags.length > 0 ? m(\"span\", { style: { marginLeft: \"8px\", fontSize: \"11px\", color: \"#888\" } }, tags.join(\" \\u00b7 \")) : null;\r\n                            })()\r\n                        ]),\r\n                        ctx.gameConfigExpanded ? m(\"div\", { style: { padding: \"12px 16px\" } }, (() => {\r\n                            let gc = CardGame.ArtPipeline.getDeckGameConfig(viewingDeck);\r\n                            let vProfiles = ctx.voiceProfiles || [];\r\n                            let vLoaded = ctx.voiceProfilesLoaded;\r\n                            let voiceProfilePicker = (label, valueKey, icon) => m(\"div\", { class: \"cg2-config-row\", style: { paddingLeft: \"24px\" } }, [\r\n                                m(\"label\", { class: \"cg2-config-label\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"6px\" } }, icon || \"mic\"),\r\n                                    label\r\n                                ]),\r\n                                m(\"div\", { class: \"cg2-config-control\" }, [\r\n                                    vProfiles.length > 0\r\n                                        ? m(\"select\", {\r\n                                            class: \"cg2-config-select\",\r\n                                            value: gc[valueKey] || \"\",\r\n                                            onchange(e) { gc[valueKey] = e.target.value || null; m.redraw(); }\r\n                                        }, [\r\n                                            m(\"option\", { value: \"\" }, \"-- Default Voice (Piper) --\"),\r\n                                            ...vProfiles.map(vp =>\r\n                                                m(\"option\", { value: vp.objectId },\r\n                                                    vp.name || ((vp.engine || \"piper\") + \" \\u2014 \" + (vp.speaker || \"default\")))\r\n                                            )\r\n                                        ])\r\n                                        : m(\"span\", { style: { fontSize: \"11px\", color: \"#999\" } },\r\n                                            vLoaded ? \"No voice profiles found \\u2014 default Piper voice will be used\" : \"Loading voice profiles...\")\r\n                                ])\r\n                            ]);\r\n\r\n                            return [\r\n                                //  LLM Narration toggle \r\n                                m(\"div\", { class: \"cg2-config-row\" }, [\r\n                                    m(\"label\", { class: \"cg2-config-label\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"6px\" } }, \"smart_toy\"),\r\n                                        \"LLM Patter\"\r\n                                    ]),\r\n                                    m(\"div\", { class: \"cg2-config-control\" }, [\r\n                                        m(\"button\", {\r\n                                            class: \"cg2-btn cg2-btn-sm\" + (gc.narrationEnabled !== false ? \" cg2-btn-active\" : \"\"),\r\n                                            onclick() { gc.narrationEnabled = gc.narrationEnabled === false ? true : false; m.redraw(); }\r\n                                        }, gc.narrationEnabled !== false ? \"Enabled\" : \"Disabled\"),\r\n                                        m(\"span\", { style: { fontSize: \"10px\", color: \"#999\", marginLeft: \"8px\" } },\r\n                                            gc.narrationEnabled !== false ? \"LLM generates dialogue and narration\" : \"Fallback text used instead of LLM\")\r\n                                    ])\r\n                                ]),\r\n\r\n                                //  Section: Opponent Voice \r\n                                m(\"div\", { class: \"cg2-config-section-label\" }, \"Opponent Voice\"),\r\n                                // Opponent voice enable/disable\r\n                                m(\"div\", { class: \"cg2-config-row\" }, [\r\n                                    m(\"label\", { class: \"cg2-config-label\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"6px\" } }, \"record_voice_over\"),\r\n                                        \"Voice\"\r\n                                    ]),\r\n                                    m(\"div\", { class: \"cg2-config-control\" }, [\r\n                                        m(\"button\", {\r\n                                            class: \"cg2-btn cg2-btn-sm\" + (gc.opponentVoiceEnabled ? \" cg2-btn-active\" : \"\"),\r\n                                            onclick() { gc.opponentVoiceEnabled = !gc.opponentVoiceEnabled; m.redraw(); }\r\n                                        }, gc.opponentVoiceEnabled ? \"Enabled\" : \"Disabled\"),\r\n                                        m(\"span\", { style: { fontSize: \"10px\", color: \"#999\", marginLeft: \"8px\" } },\r\n                                            gc.opponentVoiceEnabled ? \"Opponent speaks via TTS\" : \"Subtitles only\")\r\n                                    ])\r\n                                ]),\r\n                                // Opponent voice profile (shown when enabled)\r\n                                gc.opponentVoiceEnabled ? voiceProfilePicker(\"Voice Profile\", \"opponentVoiceProfileId\", \"person\") : null,\r\n\r\n                                //  Section: Announcer \r\n                                m(\"div\", { class: \"cg2-config-section-label\" }, \"Announcer\"),\r\n                                // Announcer enable/disable\r\n                                m(\"div\", { class: \"cg2-config-row\" }, [\r\n                                    m(\"label\", { class: \"cg2-config-label\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"6px\" } }, \"campaign\"),\r\n                                        \"Announcer\"\r\n                                    ]),\r\n                                    m(\"div\", { class: \"cg2-config-control\" }, [\r\n                                        m(\"button\", {\r\n                                            class: \"cg2-btn cg2-btn-sm\" + (gc.announcerEnabled ? \" cg2-btn-active\" : \"\"),\r\n                                            onclick() { gc.announcerEnabled = !gc.announcerEnabled; m.redraw(); }\r\n                                        }, gc.announcerEnabled ? \"Enabled\" : \"Disabled\"),\r\n                                        m(\"span\", { style: { fontSize: \"10px\", color: \"#999\", marginLeft: \"8px\" } },\r\n                                            gc.announcerEnabled ? \"Play-by-play commentary during game\" : \"No announcer commentary\")\r\n                                    ])\r\n                                ]),\r\n                                // Announcer style (shown when enabled)\r\n                                gc.announcerEnabled ? m(\"div\", { class: \"cg2-config-row\", style: { paddingLeft: \"24px\" } }, [\r\n                                    m(\"label\", { class: \"cg2-config-label\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"6px\" } }, \"style\"),\r\n                                        \"Style\"\r\n                                    ]),\r\n                                    m(\"div\", { class: \"cg2-config-control\" }, [\r\n                                        m(\"select\", {\r\n                                            class: \"cg2-config-select\",\r\n                                            value: gc.announcerProfile || \"arena-announcer\",\r\n                                            onchange(e) { gc.announcerProfile = e.target.value; m.redraw(); }\r\n                                        }, Object.entries(CardGame.AI.CardGameNarrator.PROFILES).map(([id, p]) =>\r\n                                            m(\"option\", { value: id }, p.name)\r\n                                        ))\r\n                                    ])\r\n                                ]) : null,\r\n                                // Announcer voice enable/disable (shown when announcer enabled)\r\n                                gc.announcerEnabled ? m(\"div\", { class: \"cg2-config-row\", style: { paddingLeft: \"24px\" } }, [\r\n                                    m(\"label\", { class: \"cg2-config-label\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"6px\" } }, \"volume_up\"),\r\n                                        \"Voice\"\r\n                                    ]),\r\n                                    m(\"div\", { class: \"cg2-config-control\" }, [\r\n                                        m(\"button\", {\r\n                                            class: \"cg2-btn cg2-btn-sm\" + (gc.announcerVoiceEnabled ? \" cg2-btn-active\" : \"\"),\r\n                                            onclick() { gc.announcerVoiceEnabled = !gc.announcerVoiceEnabled; m.redraw(); }\r\n                                        }, gc.announcerVoiceEnabled ? \"Enabled\" : \"Disabled\"),\r\n                                        m(\"span\", { style: { fontSize: \"10px\", color: \"#999\", marginLeft: \"8px\" } },\r\n                                            gc.announcerVoiceEnabled ? \"Announcer speaks via TTS\" : \"Text only\")\r\n                                    ])\r\n                                ]) : null,\r\n                                // Announcer voice profile (shown when announcer voice enabled)\r\n                                gc.announcerEnabled && gc.announcerVoiceEnabled ? voiceProfilePicker(\"Voice Profile\", \"announcerVoiceProfileId\", \"mic\") : null,\r\n\r\n                                // Save button\r\n                                m(\"div\", { style: { marginTop: \"12px\", textAlign: \"right\" } }, [\r\n                                    m(\"button\", {\r\n                                        class: \"cg2-btn cg2-btn-primary\",\r\n                                        style: { fontSize: \"11px\" },\r\n                                        async onclick() {\r\n                                            viewingDeck.gameConfig = gc;\r\n                                            let safeName = CardGame.ArtPipeline.currentDeckSafeName();\r\n                                            if (safeName) {\r\n                                                await CardGame.Storage.deckStorage.save(safeName, viewingDeck);\r\n                                                page.toast(\"success\", \"Game config saved\");\r\n                                            }\r\n                                        }\r\n                                    }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"3px\" } }, \"save\"),\r\n                                        \"Save Config\"\r\n                                    ])\r\n                                ])\r\n                            ];\r\n                        })()) : null\r\n                    ]),\r\n                    // Background Basis & Tabletop (side by side)\r\n                    m(\"div\", { class: \"cg2-bg-row\", style: { display: \"flex\", gap: \"12px\", margin: \"8px 0\", flexWrap: \"wrap\" } }, [\r\n                        // Background Basis (for card art)\r\n                        m(\"div\", { class: \"cg2-bg-panel\", style: { flex: \"1 1 200px\" } }, [\r\n                            m(\"div\", { class: \"cg2-bg-panel-left\" }, [\r\n                                m(\"span\", { style: { fontWeight: 700, fontSize: \"12px\" } }, \"Card Art Basis\"),\r\n                                backgroundThumbUrl ? m(\"img\", {\r\n                                    src: backgroundThumbUrl, class: \"cg2-bg-thumb\",\r\n                                    style: { cursor: \"pointer\" },\r\n                                    onclick() { R.showImagePreview(backgroundThumbUrl); }\r\n                                }) : null\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-bg-panel-right\" }, [\r\n                                m(\"button\", {\r\n                                    class: \"cg2-btn\",\r\n                                    disabled: busy,\r\n                                    onclick() { CardGame.ArtPipeline.generateBackground(activeTheme); }\r\n                                }, [\r\n                                    backgroundGenerating\r\n                                        ? m(\"span\", { class: \"material-symbols-outlined cg2-spin\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"4px\" } }, \"progress_activity\")\r\n                                        : m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"4px\" } }, \"landscape\"),\r\n                                    backgroundGenerating ? \"...\" : (backgroundImageId ? \"Regen\" : \"Gen\")\r\n                                ]),\r\n                                backgroundImageId ? m(\"button\", {\r\n                                    class: \"cg2-btn\",\r\n                                    disabled: busy,\r\n                                    onclick() { ctx.backgroundImageId = null; ctx.backgroundThumbUrl = null; m.redraw(); }\r\n                                }, \"\\u00d7\") : null\r\n                            ])\r\n                        ]),\r\n                        // Tabletop Surface (for game play area)\r\n                        m(\"div\", { class: \"cg2-bg-panel\", style: { flex: \"1 1 200px\" } }, [\r\n                            m(\"div\", { class: \"cg2-bg-panel-left\" }, [\r\n                                m(\"span\", { style: { fontWeight: 700, fontSize: \"12px\" } }, \"Tabletop\"),\r\n                                tabletopThumbUrl ? m(\"img\", {\r\n                                    src: tabletopThumbUrl, class: \"cg2-bg-thumb\",\r\n                                    style: { cursor: \"pointer\" },\r\n                                    onclick() { R.showImagePreview(tabletopThumbUrl); }\r\n                                }) : null\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-bg-panel-right\" }, [\r\n                                m(\"button\", {\r\n                                    class: \"cg2-btn\",\r\n                                    disabled: busy,\r\n                                    onclick() { CardGame.ArtPipeline.generateTabletop(activeTheme); }\r\n                                }, [\r\n                                    tabletopGenerating\r\n                                        ? m(\"span\", { class: \"material-symbols-outlined cg2-spin\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"4px\" } }, \"progress_activity\")\r\n                                        : m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"4px\" } }, \"table_restaurant\"),\r\n                                    tabletopGenerating ? \"...\" : (tabletopImageId ? \"Regen\" : \"Gen\")\r\n                                ]),\r\n                                tabletopImageId ? m(\"button\", {\r\n                                    class: \"cg2-btn\",\r\n                                    disabled: busy,\r\n                                    onclick() { ctx.tabletopImageId = null; ctx.tabletopThumbUrl = null; m.redraw(); }\r\n                                }, \"\\u00d7\") : null\r\n                            ])\r\n                        ])\r\n                    ]),\r\n                    // Art toolbar\r\n                    m(\"div\", { class: \"cg2-toolbar\" }, [\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\",\r\n                            disabled: busy,\r\n                            title: \"Generate art only for cards that don't have images yet\",\r\n                            onclick() { CardGame.ArtPipeline.queueDeckArt(viewingDeck); }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"4px\" } }, \"auto_awesome\"),\r\n                            queueActive ? \"Generating...\" : \"Generate Missing Art\"\r\n                        ]),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-danger\",\r\n                            style: { marginLeft: \"4px\" },\r\n                            disabled: busy,\r\n                            title: \"Clear all existing art and regenerate every card (including front/back)\",\r\n                            onclick() {\r\n                                // Clear all card art\r\n                                allCards.forEach(c => { delete c.imageUrl; delete c.artObjectId; delete c.portraitUrl; });\r\n                                // Clear front/back template art\r\n                                ctx.cardFrontImageUrl = null;\r\n                                ctx.cardBackImageUrl = null;\r\n                                // Clear background and tabletop\r\n                                ctx.backgroundImageId = null;\r\n                                ctx.backgroundThumbUrl = null;\r\n                                ctx.tabletopImageId = null;\r\n                                ctx.tabletopThumbUrl = null;\r\n                                if (viewingDeck) {\r\n                                    delete viewingDeck.cardFrontImageUrl;\r\n                                    delete viewingDeck.cardBackImageUrl;\r\n                                    delete viewingDeck.backgroundImageId;\r\n                                    delete viewingDeck.backgroundThumbUrl;\r\n                                    delete viewingDeck.tabletopImageId;\r\n                                    delete viewingDeck.tabletopThumbUrl;\r\n                                }\r\n                                CardGame.ArtPipeline.queueDeckArt(viewingDeck);\r\n                            }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"16px\", verticalAlign: \"middle\", marginRight: \"4px\" } }, \"refresh\"),\r\n                            \"Regen All\"\r\n                        ]),\r\n                        backgroundImageId\r\n                            ? m(\"span\", { style: { marginLeft: \"auto\", fontSize: \"11px\", color: \"#666\" } }, \"Cards will use background as img2img basis\")\r\n                            : null\r\n                    ]),\r\n                    // Art generation progress\r\n                    m(CardGame.ArtPipeline.ArtQueueProgress),\r\n                    // Card grid -- card front, card back, then all card faces\r\n                    m(\"div\", { class: \"cg2-card-grid\" }, [\r\n                        // Card Front template\r\n                        m(\"div\", { class: \"cg2-card-art-wrapper\", key: \"card-front\" }, [\r\n                            m(\"div\", {\r\n                                class: \"cg2-card cg2-card-front cg2-card-front-bg\",\r\n                                style: cardFrontImageUrl ? { backgroundImage: \"url('\" + cardFrontImageUrl + \"')\", backgroundSize: \"cover\", backgroundPosition: \"center\" } : {},\r\n                                onclick() { if (cardFrontImageUrl) R.showImagePreview(cardFrontImageUrl); }\r\n                            }, cardFrontImageUrl ? null : [\r\n                                // Only show placeholder content when no image\r\n                                m(\"div\", { class: \"cg2-back-pattern\" }),\r\n                                m(\"span\", { class: \"material-symbols-outlined cg2-back-icon\" }, \"style\"),\r\n                                m(\"div\", { class: \"cg2-back-label\" }, \"CARD FRONT\")\r\n                            ]),\r\n                            // Generation status overlay\r\n                            cardFrontGenerating ? m(\"div\", { class: \"cg2-card-art-overlay\" }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined cg2-spin\" }, \"progress_activity\"),\r\n                                m(\"div\", \"Generating...\")\r\n                            ]) : null,\r\n                            !busy && !cardFrontGenerating ? m(\"div\", { class: \"cg2-card-actions\" }, [\r\n                                m(\"button\", {\r\n                                    class: \"cg2-card-action-btn\",\r\n                                    title: \"Generate card front background\",\r\n                                    onclick(e) { e.stopPropagation(); CardGame.ArtPipeline.generateTemplateArt(\"front\"); }\r\n                                }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"auto_awesome\"))\r\n                            ]) : null\r\n                        ]),\r\n                        // Card Back template\r\n                        m(\"div\", { class: \"cg2-card-art-wrapper\", key: \"card-back\" }, [\r\n                            m(\"div\", {\r\n                                class: \"cg2-card cg2-card-back\",\r\n                                style: cardBackImageUrl\r\n                                    ? { backgroundImage: \"url('\" + cardBackImageUrl + \"')\", backgroundSize: \"cover\", backgroundPosition: \"center\", borderColor: \"#B8860B\" }\r\n                                    : { background: CARD_TYPES.item.color, borderColor: CARD_TYPES.item.color },\r\n                                onclick() { if (cardBackImageUrl) R.showImagePreview(cardBackImageUrl); }\r\n                            }, cardBackImageUrl ? null : [\r\n                                // Only show placeholder content when no image\r\n                                m(\"div\", { class: \"cg2-back-pattern\" }),\r\n                                m(\"span\", { class: \"material-symbols-outlined cg2-back-icon\" }, CARD_TYPES.item.icon),\r\n                                m(\"div\", { class: \"cg2-back-label\" }, \"CARD BACK\")\r\n                            ]),\r\n                            // Generation status overlay\r\n                            cardBackGenerating ? m(\"div\", { class: \"cg2-card-art-overlay\" }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined cg2-spin\" }, \"progress_activity\"),\r\n                                m(\"div\", \"Generating...\")\r\n                            ]) : null,\r\n                            !busy && !cardBackGenerating ? m(\"div\", { class: \"cg2-card-actions\" }, [\r\n                                m(\"button\", {\r\n                                    class: \"cg2-card-action-btn\",\r\n                                    title: \"Generate card back background\",\r\n                                    onclick(e) { e.stopPropagation(); CardGame.ArtPipeline.generateTemplateArt(\"back\"); }\r\n                                }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"auto_awesome\"))\r\n                            ]) : null\r\n                        ]),\r\n                        // Card faces (unique cards only)\r\n                        ...uniqueCards.map(({ card, index: i, count }) => {\r\n                            let artJob = artQueue.find(j => j.cardIndex === i);\r\n                            let isGenerating = artJob && artJob.status === \"processing\";\r\n                            let hasArt = card.imageUrl || (card.type === \"character\" && card.portraitUrl);\r\n                            let isChar = card.type === \"character\";\r\n                            let isFlipped = isChar && flippedCards[i];\r\n\r\n                            let cardFront = m(\"div\", {\r\n                                class: isChar ? \"cg2-card-flip-front\" : \"\"\r\n                            }, m(R.CardFace, { card, bgImage: cardFrontImageUrl }));\r\n\r\n                            let cardBack = isChar ? m(\"div\", { class: \"cg2-card-flip-back\" }, R.renderCharacterBackBody(card, cardBackImageUrl)) : null;\r\n\r\n                            let cardContent;\r\n                            if (isChar) {\r\n                                cardContent = m(\"div\", {\r\n                                    class: \"cg2-card-flipper\" + (isFlipped ? \" cg2-flipped\" : \"\"),\r\n                                    onclick() { flippedCards[i] = !flippedCards[i]; }\r\n                                }, m(\"div\", { class: \"cg2-card-flipper-inner\" }, [cardFront, cardBack]));\r\n                            } else {\r\n                                cardContent = cardFront;\r\n                            }\r\n\r\n                            return m(\"div\", { class: \"cg2-card-art-wrapper\", key: card.name + \"-\" + i }, [\r\n                                cardContent,\r\n                                // Card count badge (if duplicates exist)\r\n                                count > 1 ? m(\"div\", { class: \"cg2-card-count-badge\" }, \"x\" + count) : null,\r\n                                hasArt ? m(\"div\", { class: \"cg2-card-art-badge\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"12px\" } }, \"image\"),\r\n                                    \" Art\"\r\n                                ]) : null,\r\n                                isGenerating ? m(\"div\", { class: \"cg2-card-art-overlay\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined cg2-spin\" }, \"progress_activity\"),\r\n                                    m(\"div\", \"Generating...\")\r\n                                ]) : null,\r\n                                artJob && artJob.status === \"failed\" ? m(\"div\", { class: \"cg2-card-art-overlay cg2-art-overlay-fail\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\" }, \"error\"),\r\n                                    m(\"div\", { style: { fontSize: \"10px\" } }, artJob.error || \"Failed\")\r\n                                ]) : null,\r\n                                // Image preview on click (non-character cards with art)\r\n                                !isChar && hasArt ? m(\"div\", {\r\n                                    class: \"cg2-card-art-badge\",\r\n                                    style: { cursor: \"pointer\", right: \"6px\", left: \"auto\", top: \"6px\" },\r\n                                    onclick() { R.showImagePreview(card.imageUrl); }\r\n                                }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"zoom_in\")) : null,\r\n                                // Per-card action buttons\r\n                                !busy ? m(\"div\", { class: \"cg2-card-actions\" }, [\r\n                                    // Reimage button\r\n                                    m(\"button\", {\r\n                                        class: \"cg2-card-action-btn\",\r\n                                        title: \"Regenerate art\\n\" + CardGame.ArtPipeline.buildCardPrompt(card, activeTheme),\r\n                                        onclick(e) {\r\n                                            e.stopPropagation();\r\n                                            delete card.imageUrl;\r\n                                            delete card.artObjectId;\r\n                                            if (card.type === \"character\") delete card.portraitUrl;\r\n                                            ctx.artQueue = [{ card, cardIndex: i, status: \"pending\", result: null, error: null }];\r\n                                            ctx.artCompleted = 0;\r\n                                            ctx.artTotal = 1;\r\n                                            ctx.artPaused = false;\r\n                                            ctx.artDir = null;\r\n                                            CardGame.ArtPipeline.processArtQueue();\r\n                                        }\r\n                                    }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"auto_awesome\")),\r\n                                    // Gallery picker (character cards only)\r\n                                    card.sourceId && card.type === \"character\" ? m(\"button\", {\r\n                                        class: \"cg2-card-action-btn\",\r\n                                        title: \"Pick portrait from gallery\",\r\n                                        onclick(e) {\r\n                                            e.stopPropagation();\r\n                                            CardGame.Rendering.openGalleryPicker(card);\r\n                                        }\r\n                                    }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"photo_library\")) : null,\r\n                                    // Image sequence (character cards only) -- dress-up progression\r\n                                    card.sourceId && card.type === \"character\" ? (function() {\r\n                                        let isThisCard = sequenceCardId === card.sourceId;\r\n                                        let seqProgress = ctx.sequenceProgress || \"\";\r\n                                        return m(\"button\", {\r\n                                            class: \"cg2-card-action-btn\",\r\n                                            title: isThisCard ? seqProgress : \"Generate apparel image sequence\",\r\n                                            disabled: !!sequenceCardId,\r\n                                            onclick(e) {\r\n                                                e.stopPropagation();\r\n                                                CardGame.ArtPipeline.generateImageSequence(card);\r\n                                            }\r\n                                        }, isThisCard ? m(\"span\", { class: \"material-symbols-outlined cg2-spin\", style: { fontSize: \"14px\" } }, \"progress_activity\")\r\n                                            : m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"burst_mode\"));\r\n                                    })() : null,\r\n                                    // Refresh data from source object (character cards only)\r\n                                    card.sourceId && card.type === \"character\" ? m(\"button\", {\r\n                                        class: \"cg2-card-action-btn\",\r\n                                        title: \"Refresh card data from source object\",\r\n                                        async onclick(e) {\r\n                                            e.stopPropagation();\r\n                                            let ok = await CardGame.Characters.refreshCharacterCard(card);\r\n                                            if (ok) {\r\n                                                page.toast(\"success\", \"Refreshed: \" + card.name);\r\n                                            } else {\r\n                                                page.toast(\"warn\", \"Could not refresh \" + card.name);\r\n                                            }\r\n                                            m.redraw();\r\n                                        }\r\n                                    }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"sync\")) : null,\r\n                                    // Source object link (character cards)\r\n                                    card.sourceId ? m(\"button\", {\r\n                                        class: \"cg2-card-action-btn\",\r\n                                        title: \"Open source object\",\r\n                                        onclick(e) {\r\n                                            e.stopPropagation();\r\n                                            window.open(\"#/view/olio.charPerson/\" + card.sourceId, \"_blank\");\r\n                                        }\r\n                                    }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"open_in_new\")) : null,\r\n                                    // Art object link (non-character cards with generated art)\r\n                                    !card.sourceId && card.artObjectId ? m(\"button\", {\r\n                                        class: \"cg2-card-action-btn\",\r\n                                        title: \"Open generated art object\",\r\n                                        onclick(e) {\r\n                                            e.stopPropagation();\r\n                                            window.open(\"#/view/data.data/\" + card.artObjectId, \"_blank\");\r\n                                        }\r\n                                    }, m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, \"open_in_new\")) : null\r\n                                ]) : null\r\n                            ]);\r\n                        })\r\n                    ]),\r\n                    m(R.ImagePreviewOverlay),\r\n                    m(R.GalleryPickerOverlay)\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    window.CardGame.UI.DeckView = DeckView;\r\n\r\n})();\r\n\n\n;/* === client/view/cardGame/ui/phaseUI.js === */\n// phaseUI.js  Phase UI components for card game\r\n// Initiative, Equip, Resolution, Cleanup phase displays\r\n(function() {\r\n    \"use strict\";\r\n\r\n    const NS = window.CardGame = window.CardGame || {};\r\n    NS.UI = NS.UI || {};\r\n\r\n    //  Initiative Phase UI \r\n    function InitiativePhaseUI() {\r\n        let playerFlipped = false;\r\n        let opponentFlipped = false;\r\n\r\n        return {\r\n            oninit() {\r\n                let gs = NS.GameState.state;\r\n                let initAnimState = gs.initAnimState;\r\n                if (!initAnimState.rolling && !initAnimState.rollComplete && initAnimState.countdown === 3) {\r\n                    gs.startInitiativeAnimation();\r\n                }\r\n            },\r\n            view() {\r\n                let gs = NS.GameState.state;\r\n                let gameState = gs.gameState;\r\n                if (!gameState) return null;\r\n\r\n                let GAME_PHASES = NS.Constants.GAME_PHASES;\r\n                let CardFace = NS.Rendering.CardFace;\r\n                let D20Dice = NS.Rendering.D20Dice;\r\n                let ctx = NS.ctx || {};\r\n\r\n                let init = gameState.initiative;\r\n                let anim = gs.initAnimState;\r\n                let player = gameState.player;\r\n                let opponent = gameState.opponent;\r\n\r\n                let showFlipped = anim.rolling || anim.rollComplete;\r\n\r\n                let viewingDeck = ctx.viewingDeck;\r\n                let cardFrontBg = viewingDeck && viewingDeck.cardFrontImageUrl ? viewingDeck.cardFrontImageUrl : null;\r\n                let cardBackBg = viewingDeck && viewingDeck.cardBackImageUrl ? viewingDeck.cardBackImageUrl : null;\r\n\r\n                function renderInitCard(who, character, roll, isWinner, diceFace, flipped) {\r\n                    let isFlipped = showFlipped || flipped;\r\n                    let isLoser = anim.rollComplete && !isWinner && init.winner;\r\n\r\n                    let backStyle = {};\r\n                    if (cardBackBg) {\r\n                        backStyle.backgroundImage = \"url('\" + cardBackBg + \"')\";\r\n                        backStyle.backgroundSize = \"cover\";\r\n                        backStyle.backgroundPosition = \"center\";\r\n                    }\r\n\r\n                    return m(\"div\", {\r\n                        class: \"cg2-init-card-wrap\" + (isFlipped ? \" cg2-init-flipped\" : \"\") +\r\n                            (isWinner ? \" cg2-init-winner-card\" : \"\") +\r\n                            (isLoser ? \" cg2-init-loser-card\" : \"\"),\r\n                        onclick() {\r\n                            if (anim.rollComplete) {\r\n                                if (who === \"player\") playerFlipped = !playerFlipped;\r\n                                else opponentFlipped = !opponentFlipped;\r\n                            }\r\n                        }\r\n                    }, [\r\n                        m(\"div\", { class: \"cg2-init-card-inner\" }, [\r\n                            m(\"div\", { class: \"cg2-init-card-front\" }, [\r\n                                m(CardFace, { card: character, bgImage: cardFrontBg, compact: true })\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-init-card-back\", style: backStyle }, [\r\n                                m(\"div\", { class: \"cg2-init-back-content\" }, [\r\n                                    m(\"div\", { class: \"cg2-init-back-label\" }, who === \"player\" ? \"You\" : \"Opponent\"),\r\n                                    m(\"div\", { class: \"cg2-dice-container\" }, [\r\n                                        m(D20Dice, {\r\n                                            value: anim.rolling ? diceFace : (roll ? roll.raw : \"?\"),\r\n                                            rolling: anim.rolling,\r\n                                            winner: isWinner && anim.rollComplete\r\n                                        })\r\n                                    ]),\r\n                                    roll && anim.rollComplete ? m(\"div\", { class: \"cg2-roll-breakdown\" }, [\r\n                                        m(\"span\", roll.raw),\r\n                                        m(\"span\", \" + \"),\r\n                                        m(\"span\", { class: \"cg2-mod\" }, roll.modifier),\r\n                                        m(\"span\", \" AGI = \"),\r\n                                        m(\"strong\", roll.total)\r\n                                    ]) : null,\r\n                                    anim.rollComplete && init.winner\r\n                                        ? (isWinner\r\n                                            ? m(\"div\", { class: \"cg2-init-winner-badge\" }, [\r\n                                                m(\"span\", { class: \"material-symbols-outlined\" }, \"star\"),\r\n                                                \" Winner!\"\r\n                                            ])\r\n                                            : m(\"div\", { class: \"cg2-init-loser-badge\" }, \"\\u2014\"))\r\n                                        : null\r\n                                ])\r\n                            ])\r\n                        ])\r\n                    ]);\r\n                }\r\n\r\n                // Countdown phase\r\n                if (anim.countdown > 0) {\r\n                    return m(\"div\", { class: \"cg2-phase-panel cg2-initiative-panel\" }, [\r\n                        m(\"h2\", \"Initiative Phase\"),\r\n                        m(\"p\", \"Preparing to roll for turn order...\"),\r\n                        m(\"div\", { class: \"cg2-init-cards\" }, [\r\n                            renderInitCard(\"player\", player.character, null, false, 1, false),\r\n                            m(\"div\", { class: \"cg2-init-vs\" }, \"VS\"),\r\n                            renderInitCard(\"opponent\", opponent.character, null, false, 1, false),\r\n                            m(\"div\", { class: \"cg2-init-countdown\" }, [\r\n                                m(\"div\", { class: \"cg2-countdown-number\" }, anim.countdown)\r\n                            ])\r\n                        ])\r\n                    ]);\r\n                }\r\n\r\n                // Rolling or results\r\n                return m(\"div\", { class: \"cg2-phase-panel cg2-initiative-panel\" }, [\r\n                    m(\"h2\", \"Initiative Phase\"),\r\n                    m(\"div\", { class: \"cg2-init-cards\" }, [\r\n                        renderInitCard(\"player\", player.character, init.playerRoll, init.winner === \"player\", anim.playerDiceFace, playerFlipped),\r\n                        m(\"div\", { class: \"cg2-init-vs\" }, \"VS\"),\r\n                        renderInitCard(\"opponent\", opponent.character, init.opponentRoll, init.winner === \"opponent\", anim.opponentDiceFace, opponentFlipped)\r\n                    ]),\r\n\r\n                    // Nat 1 warning\r\n                    anim.rollComplete && gameState.beginningThreats && gameState.beginningThreats.length > 0\r\n                        ? m(\"div\", { class: \"cg2-threat-warning\" }, [\r\n                            m(\"div\", { class: \"cg2-threat-warning-header\" }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined\" }, \"warning\"),\r\n                                \" CRITICAL FAILURE - THREAT TRIGGERED!\"\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-threat-rolls\", style: { fontSize: \"11px\", color: \"#c62828\", marginBottom: \"8px\" } }, [\r\n                                \"Rolls: You (\", init.playerRoll ? init.playerRoll.raw : \"?\", \") vs Opp (\",\r\n                                init.opponentRoll ? init.opponentRoll.raw : \"?\", \")\"\r\n                            ]),\r\n                            gameState.beginningThreats.map((threat, i) =>\r\n                                m(\"div\", { class: \"cg2-threat-warning-item\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:16px;vertical-align:middle\" }, threat.imageIcon || \"pets\"),\r\n                                    \" \", m(\"strong\", threat.name),\r\n                                    \" (Diff \", threat.difficulty, \") attacks \",\r\n                                    m(\"span\", { class: threat.target === \"player\" ? \"cg2-threat-target-you\" : \"cg2-threat-target-opp\" },\r\n                                        threat.target === \"player\" ? \"YOU\" : \"Opponent\"),\r\n                                    \" (rolled Nat 1)\"\r\n                                ])\r\n                            )\r\n                        ])\r\n                        : null\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Equip Phase UI \r\n    function EquipPhaseUI() {\r\n        return {\r\n            view() {\r\n                let gs = NS.GameState.state;\r\n                let gameState = gs.gameState;\r\n                if (!gameState) return null;\r\n\r\n                let player = gameState.player;\r\n                let equipped = player.equipped;\r\n\r\n                return m(\"div\", { class: \"cg2-phase-panel cg2-equip-panel\" }, [\r\n                    m(\"h2\", \"Equip Phase\"),\r\n                    m(\"p\", \"Adjust your equipment before combat. (Free action)\"),\r\n                    m(\"div\", { class: \"cg2-equip-slots\" }, [\r\n                        m(EquipSlot, { slot: \"head\", label: \"Head\", item: equipped.head }),\r\n                        m(EquipSlot, { slot: \"body\", label: \"Body\", item: equipped.body }),\r\n                        m(EquipSlot, { slot: \"handL\", label: \"Left Hand\", item: equipped.handL }),\r\n                        m(EquipSlot, { slot: \"handR\", label: \"Right Hand\", item: equipped.handR }),\r\n                        m(EquipSlot, { slot: \"feet\", label: \"Feet\", item: equipped.feet }),\r\n                        m(EquipSlot, { slot: \"ring\", label: \"Ring\", item: equipped.ring }),\r\n                        m(EquipSlot, { slot: \"back\", label: \"Back\", item: equipped.back })\r\n                    ]),\r\n                    m(\"button\", {\r\n                        class: \"cg2-btn cg2-btn-primary\",\r\n                        style: { marginTop: \"16px\" },\r\n                        onclick() { gs.advancePhase(); }\r\n                    }, \"Continue to Placement Phase\")\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    function EquipSlot() {\r\n        return {\r\n            view(vnode) {\r\n                let { slot, label, item } = vnode.attrs;\r\n                return m(\"div\", { class: \"cg2-equip-slot\" + (item ? \" cg2-slot-filled\" : \"\") }, [\r\n                    m(\"span\", { class: \"cg2-slot-label\" }, label),\r\n                    item\r\n                        ? m(\"span\", { class: \"cg2-slot-item\" }, item.name)\r\n                        : m(\"span\", { class: \"cg2-slot-empty\" }, \"Empty\")\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Resolution Phase UI \r\n    function ResolutionPhaseUI() {\r\n        return {\r\n            view() {\r\n                let gs = NS.GameState.state;\r\n                let gameState = gs.gameState;\r\n                if (!gameState) return null;\r\n\r\n                let D20Dice = NS.Rendering.D20Dice;\r\n\r\n                let bar = gameState.actionBar;\r\n                let currentPos = bar.positions[bar.resolveIndex];\r\n                let card = currentPos?.stack?.coreCard;\r\n                let isAttack = (card && card.name === \"Attack\") || currentPos?.isThreat;\r\n                let isThreat = currentPos?.isThreat;\r\n                let isRolling = gs.resolutionPhase === \"rolling\";\r\n                let showResult = gs.resolutionPhase === \"result\" || gs.resolutionPhase === \"done\";\r\n                let combat = gs.currentCombatResult;\r\n\r\n                // Generate descriptive action label\r\n                let actionLabel = \"\";\r\n                if (currentPos) {\r\n                    let ownerName = currentPos.owner === \"player\" ? \"Player\" : \"Opponent\";\r\n                    if (isThreat) {\r\n                        actionLabel = (currentPos.threat?.name || \"Threat\") + \" Attacks!\";\r\n                    } else if (card) {\r\n                        let actionVerb = card.name === \"Attack\" ? \"Attacks\" :\r\n                                        card.name === \"Rest\" ? \"Rests\" :\r\n                                        card.name === \"Flee\" ? \"Flees\" :\r\n                                        card.name === \"Guard\" ? \"Guards\" :\r\n                                        card.name === \"Investigate\" ? \"Investigates\" :\r\n                                        card.name === \"Craft\" ? \"Crafts\" :\r\n                                        card.name === \"Trade\" ? \"Trades\" :\r\n                                        card.type === \"talk\" ? \"Talks\" :\r\n                                        card.type === \"magic\" ? \"Casts \" + card.name :\r\n                                        \"Acts\";\r\n                        actionLabel = ownerName + \" \" + actionVerb + \"!\";\r\n                    }\r\n                }\r\n\r\n                if (!currentPos) {\r\n                    return m(\"div\", { class: \"cg2-resolution-complete\" }, \"All actions resolved!\");\r\n                }\r\n\r\n                // Combat overlay\r\n                return isAttack && (isRolling || showResult) ? m(\"div\", { class: \"cg2-combat-overlay\" }, [\r\n                    m(\"div\", { class: \"cg2-action-step-label\" }, [\r\n                        m(\"span\", { class: \"cg2-step-number\" }, \"Step \" + currentPos.index + \"/\" + bar.positions.length),\r\n                        m(\"span\", { class: \"cg2-step-action\" }, actionLabel)\r\n                    ]),\r\n                    m(\"div\", { class: \"cg2-combat-content\" }, [\r\n                        m(\"div\", { class: \"cg2-combat-header\" }, [\r\n                            m(\"span\", { class: \"cg2-combatant cg2-attacker\" },\r\n                                combat ? combat.attackerName : (isThreat ? (currentPos.threat?.name || \"Threat\") : (currentPos.owner === \"player\" ? \"You\" : \"Opponent\"))),\r\n                            m(\"span\", { class: \"cg2-combat-vs\" }, \"attacks\"),\r\n                            m(\"span\", { class: \"cg2-combatant cg2-defender\" },\r\n                                combat ? combat.defenderName : (isThreat ? (currentPos.target === \"player\" ? \"You\" : \"Opponent\") : (currentPos.owner === \"player\" ? \"Opponent\" : \"You\")))\r\n                        ]),\r\n                        m(\"div\", { class: \"cg2-combat-dice-row\" }, [\r\n                            m(\"div\", { class: \"cg2-combat-roll-card\" }, [\r\n                                m(\"div\", { class: \"cg2-roll-label\" }, \"Attack Roll\"),\r\n                                m(D20Dice, {\r\n                                    value: isRolling ? gs.resolutionDiceFaces.attack : (combat ? combat.attackRoll.raw : \"?\"),\r\n                                    rolling: isRolling,\r\n                                    winner: combat && showResult && combat.outcome.damageMultiplier > 0\r\n                                }),\r\n                                combat && showResult ? m(\"div\", { class: \"cg2-roll-breakdown\" }, [\r\n                                    m(\"span\", combat.attackRoll.raw),\r\n                                    m(\"span\", \" + \"),\r\n                                    m(\"span\", { class: \"cg2-mod\" }, combat.attackRoll.strMod + \" STR\"),\r\n                                    m(\"span\", \" + \"),\r\n                                    m(\"span\", { class: \"cg2-mod cg2-mod-atk\" }, combat.attackRoll.atkBonus + \" ATK\"),\r\n                                    combat.attackRoll.skillMod ? [\r\n                                        m(\"span\", \" + \"),\r\n                                        m(\"span\", { class: \"cg2-mod cg2-mod-skill\" }, combat.attackRoll.skillMod + \" Skill\")\r\n                                    ] : null,\r\n                                    combat.attackRoll.statusMod ? [\r\n                                        m(\"span\", \" + \"),\r\n                                        m(\"span\", { class: \"cg2-mod cg2-mod-status\" }, combat.attackRoll.statusMod + \" Status\")\r\n                                    ] : null,\r\n                                    m(\"span\", \" = \"),\r\n                                    m(\"strong\", combat.attackRoll.total)\r\n                                ]) : null\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-combat-vs-divider\" }, \"vs\"),\r\n                            m(\"div\", { class: \"cg2-combat-roll-card\" }, [\r\n                                m(\"div\", { class: \"cg2-roll-label\" }, \"Defense Roll\"),\r\n                                m(D20Dice, {\r\n                                    value: isRolling ? gs.resolutionDiceFaces.defense : (combat ? combat.defenseRoll.raw : \"?\"),\r\n                                    rolling: isRolling,\r\n                                    winner: combat && showResult && combat.outcome.damageMultiplier <= 0\r\n                                }),\r\n                                combat && showResult ? m(\"div\", { class: \"cg2-roll-breakdown\" }, [\r\n                                    m(\"span\", combat.defenseRoll.raw),\r\n                                    m(\"span\", \" + \"),\r\n                                    m(\"span\", { class: \"cg2-mod\" }, combat.defenseRoll.endMod + \" END\"),\r\n                                    m(\"span\", \" + \"),\r\n                                    m(\"span\", { class: \"cg2-mod cg2-mod-def\" }, combat.defenseRoll.defBonus + \" DEF\"),\r\n                                    combat.defenseRoll.parryBonus ? [\r\n                                        m(\"span\", \" + \"),\r\n                                        m(\"span\", { class: \"cg2-mod cg2-mod-parry\" }, combat.defenseRoll.parryBonus + \" Parry\")\r\n                                    ] : null,\r\n                                    combat.defenseRoll.statusMod ? [\r\n                                        m(\"span\", \" + \"),\r\n                                        m(\"span\", { class: \"cg2-mod cg2-mod-status\" }, combat.defenseRoll.statusMod + \" Status\")\r\n                                    ] : null,\r\n                                    m(\"span\", \" = \"),\r\n                                    m(\"strong\", combat.defenseRoll.total)\r\n                                ]) : null\r\n                            ])\r\n                        ]),\r\n                        m(\"div\", { class: \"cg2-outcome-area\" }, [\r\n                            combat && showResult ? m(\"div\", { class: \"cg2-combat-outcome\" }, [\r\n                                m(\"div\", {\r\n                                    class: \"cg2-outcome-label cg2-outcome-\" +\r\n                                        (combat.outcome.damageMultiplier > 0 ? \"hit\" :\r\n                                         combat.outcome.damageMultiplier < 0 ? \"counter\" : \"miss\")\r\n                                }, [\r\n                                    m(\"span\", { class: \"cg2-outcome-text\" }, combat.outcome.label),\r\n                                    m(\"span\", { class: \"cg2-outcome-diff\" },\r\n                                        \" (\" + (combat.outcome.diff >= 0 ? \"+\" : \"\") + combat.outcome.diff + \")\")\r\n                                ]),\r\n                                m(\"div\", { class: \"cg2-outcome-effect\" }, combat.outcome.effect),\r\n                                combat.damageResult ? m(\"div\", { class: \"cg2-damage-display\" }, [\r\n                                    m(\"span\", { class: \"cg2-damage-number cg2-damage-dealt\" },\r\n                                        \"-\" + combat.damageResult.finalDamage + \" HP\"),\r\n                                    m(\"span\", { class: \"cg2-damage-target\" },\r\n                                        \" to \" + combat.defenderName)\r\n                                ]) : null,\r\n                                combat.selfDamageResult ? m(\"div\", { class: \"cg2-damage-display\" }, [\r\n                                    m(\"span\", { class: \"cg2-damage-number cg2-damage-self\" },\r\n                                        \"-\" + combat.selfDamageResult.finalDamage + \" HP\"),\r\n                                    m(\"span\", { class: \"cg2-damage-target\" },\r\n                                        \" to \" + combat.attackerName + \" (counter!)\")\r\n                                ]) : null,\r\n                                combat.criticalEffects && (combat.criticalEffects.rewardCard || combat.criticalEffects.itemDropped || combat.criticalEffects.attackerStunned)\r\n                                    ? m(\"div\", { class: \"cg2-critical-effects\" }, [\r\n                                        combat.criticalEffects.rewardCard\r\n                                            ? m(\"div\", { class: \"cg2-critical-effect cg2-reward-earned\" }, [\r\n                                                m(\"span\", { class: \"material-symbols-outlined\" }, \"auto_awesome\"),\r\n                                                \" Reward: \", m(\"strong\", combat.criticalEffects.rewardCard.name),\r\n                                                m(\"span\", { class: \"cg2-reward-rarity cg2-rarity-\" + (combat.criticalEffects.rewardCard.rarity || \"common\") },\r\n                                                    \" [\" + (combat.criticalEffects.rewardCard.rarity || \"common\") + \"]\")\r\n                                            ]) : null,\r\n                                        combat.criticalEffects.itemDropped\r\n                                            ? m(\"div\", { class: \"cg2-critical-effect cg2-item-dropped\" }, [\r\n                                                m(\"span\", { class: \"material-symbols-outlined\" }, \"backpack\"),\r\n                                                \" Item dropped: \", m(\"strong\", combat.criticalEffects.itemDropped.name)\r\n                                            ]) : null,\r\n                                        combat.criticalEffects.attackerStunned\r\n                                            ? m(\"div\", { class: \"cg2-critical-effect cg2-attacker-stunned\" }, [\r\n                                                m(\"span\", { class: \"material-symbols-outlined\" }, \"flash_off\"),\r\n                                                \" \", m(\"strong\", combat.attackerName), \" STUNNED!\"\r\n                                            ]) : null\r\n                                    ]) : null\r\n                            ]) : m(\"div\", { class: \"cg2-outcome-pending\" }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined cg2-spin\" }, \"casino\"),\r\n                                \" Rolling dice...\"\r\n                            ])\r\n                        ])\r\n                    ])\r\n                ]) : m(\"div\", { class: \"cg2-non-combat-overlay\" }, [\r\n                    m(\"div\", { class: \"cg2-action-step-label\" }, [\r\n                        m(\"span\", { class: \"cg2-step-number\" }, \"Step \" + currentPos.index + \"/\" + bar.positions.length),\r\n                        m(\"span\", { class: \"cg2-step-action\" }, actionLabel)\r\n                    ]),\r\n                    m(\"div\", { class: \"cg2-combat-content\" }, [\r\n                        m(\"div\", { class: \"cg2-resolving-action\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined cg2-spin\" }, \"sync\"),\r\n                            \" Resolving \", card ? card.name : \"action\", \"...\"\r\n                        ]),\r\n                        m(\"div\", { class: \"cg2-resolution-progress\" },\r\n                            gs.resolutionAnimating ? \"Resolving...\" : \"Next action in 3s...\")\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Cleanup Phase UI \r\n    function CleanupPhaseUI() {\r\n        return {\r\n            oninit() {\r\n                let gs = NS.GameState.state;\r\n                let gameState = gs.gameState;\r\n                if (!gameState || gameState.cleanupApplied) return;\r\n\r\n                let playerPts = gameState.player.roundPoints;\r\n                let oppPts = gameState.opponent.roundPoints;\r\n\r\n                if (playerPts > oppPts) {\r\n                    gameState.roundWinner = \"player\";\r\n                    gameState.player.hpRecovery = 5;\r\n                    gameState.opponent.hpRecovery = 2;\r\n                    gameState.player.energyRecovery = 3;\r\n                    gameState.opponent.energyRecovery = 1;\r\n                } else if (oppPts > playerPts) {\r\n                    gameState.roundWinner = \"opponent\";\r\n                    gameState.player.hpRecovery = 2;\r\n                    gameState.opponent.hpRecovery = 5;\r\n                    gameState.player.energyRecovery = 1;\r\n                    gameState.opponent.energyRecovery = 3;\r\n                } else {\r\n                    gameState.roundWinner = \"tie\";\r\n                    gameState.player.hpRecovery = 2;\r\n                    gameState.opponent.hpRecovery = 2;\r\n                    gameState.player.energyRecovery = 2;\r\n                    gameState.opponent.energyRecovery = 2;\r\n                }\r\n\r\n                // Apply HP recovery\r\n                gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + gameState.player.hpRecovery);\r\n                gameState.opponent.hp = Math.min(gameState.opponent.maxHp, gameState.opponent.hp + gameState.opponent.hpRecovery);\r\n                // Apply Energy recovery\r\n                gameState.player.energy = Math.min(gameState.player.maxEnergy, gameState.player.energy + gameState.player.energyRecovery);\r\n                gameState.opponent.energy = Math.min(gameState.opponent.maxEnergy, gameState.opponent.energy + gameState.opponent.energyRecovery);\r\n\r\n                // Winner claims pot\r\n                if (gameState.roundWinner !== \"tie\") {\r\n                    gameState.potClaimed = gameState.pot.length;\r\n                    gs.claimPot(gameState.roundWinner);\r\n                } else {\r\n                    gameState.potClaimed = 0;\r\n                    console.log(\"[CardGame v2] Tie - pot carries over:\", gameState.pot.length, \"cards\");\r\n                }\r\n\r\n                // Lethargy check\r\n                gameState.playerLethargy = gs.checkLethargy(gameState.player, \"Player\");\r\n                gameState.opponentLethargy = gs.checkLethargy(gameState.opponent, \"Opponent\");\r\n\r\n                // End threat check\r\n                gameState.endThreatResult = gs.checkEndThreat();\r\n                if (gameState.endThreatResult && gameState.endThreatResult.threat) {\r\n                    gameState.endThreatResult.responded = false;\r\n                    console.log(\"[CardGame v2] End threat pending:\", gameState.endThreatResult.threat.name,\r\n                        \"- targets\", gameState.endThreatResult.threat.target);\r\n                }\r\n\r\n                gameState.cleanupApplied = true;\r\n                console.log(\"[CardGame v2] Cleanup - Round winner:\", gameState.roundWinner,\r\n                    \"| Player HP:\", gameState.player.hp, \"(+\" + gameState.player.hpRecovery + \")\",\r\n                    \"Energy:\", gameState.player.energy, \"(+\" + gameState.player.energyRecovery + \")\",\r\n                    \"| Opponent HP:\", gameState.opponent.hp, \"(+\" + gameState.opponent.hpRecovery + \")\",\r\n                    \"Energy:\", gameState.opponent.energy, \"(+\" + gameState.opponent.energyRecovery + \")\");\r\n\r\n                // Trigger round end narration\r\n                gs.narrateRoundEnd(gameState.roundWinner);\r\n\r\n                // Auto-save\r\n                let Storage = NS.Storage;\r\n                if (Storage && Storage.gameStorage) {\r\n                    Storage.gameStorage.save(gameState.deckName, gameState).then(saved => {\r\n                        if (saved) console.log(\"[CardGame v2] Auto-saved after round\", gameState.round);\r\n                    }).catch(e => console.warn(\"[CardGame v2] Auto-save failed:\", e));\r\n                }\r\n            },\r\n            view() {\r\n                let gs = NS.GameState.state;\r\n                let gameState = gs.gameState;\r\n                if (!gameState) return null;\r\n\r\n                let winnerText = gameState.roundWinner === \"player\" ? \"You win the round!\" :\r\n                                 gameState.roundWinner === \"opponent\" ? \"Opponent wins the round!\" :\r\n                                 \"Round is a tie!\";\r\n\r\n                return m(\"div\", { class: \"cg2-phase-panel cg2-cleanup-panel\" }, [\r\n                    m(\"h2\", \"Cleanup Phase\"),\r\n                    m(\"p\", \"Round \" + gameState.round + \" complete!\"),\r\n                    m(\"div\", { class: \"cg2-round-summary\" }, [\r\n                        m(\"div\", { class: \"cg2-round-winner \" + (gameState.roundWinner === \"player\" ? \"cg2-win\" : gameState.roundWinner === \"opponent\" ? \"cg2-lose\" : \"\") }, winnerText),\r\n                        m(\"div\", { class: \"cg2-round-points\" }, [\r\n                            m(\"span\", \"Your points: \" + gameState.player.roundPoints),\r\n                            m(\"span\", \" | \"),\r\n                            m(\"span\", \"Opponent: \" + gameState.opponent.roundPoints)\r\n                        ]),\r\n                        m(\"div\", { class: \"cg2-round-recovery\" }, [\r\n                            m(\"div\", { class: \"cg2-recovery-row\" }, [\r\n                                m(\"span\", { class: \"cg2-recovery-label\" }, \"HP:\"),\r\n                                m(\"span\", { class: gameState.roundWinner === \"player\" ? \"cg2-winner\" : \"\" },\r\n                                    \"You +\" + gameState.player.hpRecovery),\r\n                                m(\"span\", \" | \"),\r\n                                m(\"span\", { class: gameState.roundWinner === \"opponent\" ? \"cg2-winner\" : \"\" },\r\n                                    \"Opp +\" + gameState.opponent.hpRecovery)\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-recovery-row\" }, [\r\n                                m(\"span\", { class: \"cg2-recovery-label\" }, \"Energy:\"),\r\n                                m(\"span\", { class: gameState.roundWinner === \"player\" ? \"cg2-winner\" : \"\" },\r\n                                    \"You +\" + gameState.player.energyRecovery),\r\n                                m(\"span\", \" | \"),\r\n                                m(\"span\", { class: gameState.roundWinner === \"opponent\" ? \"cg2-winner\" : \"\" },\r\n                                    \"Opp +\" + gameState.opponent.energyRecovery)\r\n                            ])\r\n                        ]),\r\n                        gameState.potClaimed > 0 ? m(\"div\", { class: \"cg2-pot-claimed\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:14px;vertical-align:middle\" }, \"redeem\"),\r\n                            \" \", gameState.roundWinner === \"player\" ? \"You\" : \"Opponent\",\r\n                            \" claimed \", gameState.potClaimed, \" card\", gameState.potClaimed > 1 ? \"s\" : \"\", \" from the pot!\"\r\n                        ]) : null,\r\n                        gameState.pot.length > 0 ? m(\"div\", { class: \"cg2-pot-carries\" },\r\n                            \"Pot carries over: \" + gameState.pot.length + \" cards\"\r\n                        ) : null,\r\n                        (gameState.playerLethargy && gameState.playerLethargy.length > 0) ||\r\n                        (gameState.opponentLethargy && gameState.opponentLethargy.length > 0)\r\n                            ? m(\"div\", { class: \"cg2-lethargy-notice\" }, [\r\n                                m(\"div\", { class: \"cg2-lethargy-title\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:14px;vertical-align:middle\" }, \"hotel\"),\r\n                                    \" Lethargy\"\r\n                                ]),\r\n                                gameState.playerLethargy && gameState.playerLethargy.length > 0\r\n                                    ? m(\"div\", { class: \"cg2-lethargy-item cg2-lethargy-player\" },\r\n                                        \"You lost \" + gameState.playerLethargy.map(l => l.stripped + \" \" + l.actionType).join(\", \") + \" (hoarded, unplayed)\")\r\n                                    : null,\r\n                                gameState.opponentLethargy && gameState.opponentLethargy.length > 0\r\n                                    ? m(\"div\", { class: \"cg2-lethargy-item cg2-lethargy-opponent\" },\r\n                                        \"Opponent lost \" + gameState.opponentLethargy.map(l => l.stripped + \" \" + l.actionType).join(\", \") + \" (hoarded, unplayed)\")\r\n                                    : null\r\n                            ])\r\n                            : null,\r\n                        gameState.endThreatResult ? m(\"div\", { class: \"cg2-scenario-card\" }, [\r\n                            m(\"div\", { class: \"cg2-scenario-title\" }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:14px;vertical-align:middle\" },\r\n                                    gameState.endThreatResult.threat ? \"warning\" : \"eco\"),\r\n                                \" Scenario: \", gameState.endThreatResult.scenario.name\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-scenario-desc\" }, gameState.endThreatResult.scenario.description),\r\n                            gameState.endThreatResult.threat && !gameState.endThreatResult.responded\r\n                                ? m(\"div\", { class: \"cg2-end-threat cg2-end-threat-pending\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:16px;vertical-align:middle;color:#c62828\" },\r\n                                        gameState.endThreatResult.threat.imageIcon || \"pets\"),\r\n                                    \" \", m(\"strong\", gameState.endThreatResult.threat.name),\r\n                                    \" approaches! \",\r\n                                    m(\"span\", { class: gameState.roundWinner === \"player\" ? \"cg2-threat-target-you\" : \"cg2-threat-target-opp\" },\r\n                                        gameState.roundWinner === \"player\" || gameState.roundWinner === \"tie\" ? \"You\" : \"Opponent\"),\r\n                                    \" may prepare a defense.\"\r\n                                ])\r\n                                : null,\r\n                            gameState.endThreatResult.threat && gameState.endThreatResult.responded\r\n                                ? m(\"div\", { class: \"cg2-end-threat\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:16px;vertical-align:middle;color:#c62828\" },\r\n                                        gameState.endThreatResult.threat.imageIcon || \"pets\"),\r\n                                    \" \", m(\"strong\", gameState.endThreatResult.threat.name),\r\n                                    gameState.endThreatResult.damageDealt > 0\r\n                                        ? [\" dealt \", m(\"span\", { style: \"color:#c62828;font-weight:bold\" }, gameState.endThreatResult.damageDealt), \" damage!\"]\r\n                                        : [\" was \", m(\"span\", { style: \"color:#4CAF50;font-weight:bold\" }, \"defeated\"), \"!\"]\r\n                                ]) : null\r\n                        ]) : null\r\n                    ]),\r\n\r\n                    // Button - face threat or start next round\r\n                    gameState.endThreatResult && gameState.endThreatResult.threat && !gameState.endThreatResult.responded\r\n                        ? m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary cg2-btn-threat\",\r\n                            onclick() {\r\n                                gameState.cleanupApplied = false;\r\n                                gs.advancePhase();\r\n                            }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: \"vertical-align:middle;margin-right:4px\" }, \"shield\"),\r\n                            \"Face the Threat\"\r\n                        ])\r\n                        : m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\",\r\n                            onclick() {\r\n                                gameState.cleanupApplied = false;\r\n                                gs.advancePhase();\r\n                            }\r\n                        }, \"Start Round \" + (gameState.round + 1))\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Expose \r\n    NS.UI.InitiativePhaseUI = InitiativePhaseUI;\r\n    NS.UI.EquipPhaseUI = EquipPhaseUI;\r\n    NS.UI.EquipSlot = EquipSlot;\r\n    NS.UI.ResolutionPhaseUI = ResolutionPhaseUI;\r\n    NS.UI.CleanupPhaseUI = CleanupPhaseUI;\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/ui/threatUI.js === */\n/**\r\n * CardGame UI - Threat Response Phase\r\n * Shows threat card vs defender card, threat stats (ATK, DEF, HP, Loot),\r\n * defense stack, AI auto-response after delay, and player defense card placement.\r\n *\r\n * Extracted from cardGame-v2.js (lines ~8627-8790).\r\n *\r\n * Depends on:\r\n *   - CardGame.Constants (GAME_PHASES)\r\n *   - CardGame.ctx (gameState, viewingDeck)\r\n *   - CardGame.Actions (placeThreatDefenseCard, skipThreatResponse,\r\n *                       resolveThreatCombat, resolveEndThreatCombat)\r\n *\r\n * Exposes: window.CardGame.UI.ThreatResponseUI\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.UI = window.CardGame.UI || {};\r\n\r\n    //  Threat Response Phase UI \r\n    let threatAutoRespondScheduled = false;  // Guard against multiple auto-responds\r\n\r\n    function ThreatResponseUI() {\r\n        return {\r\n            oninit() {\r\n                // Reset auto-respond guard when component initializes\r\n                threatAutoRespondScheduled = false;\r\n            },\r\n            view() {\r\n                let ctx = window.CardGame.ctx || {};\r\n                let gameState = ctx.gameState;\r\n                let GAME_PHASES = CardGame.Constants.GAME_PHASES;\r\n\r\n                if (!gameState || !gameState.threatResponse || !gameState.threatResponse.active) {\r\n                    return null;\r\n                }\r\n\r\n                let tr = gameState.threatResponse;\r\n                let isEndThreat = tr.type === \"end\" || gameState.phase === GAME_PHASES.END_THREAT;\r\n                let responder = tr.responder;\r\n                let isPlayerResponder = responder === \"player\";\r\n                let actor = isPlayerResponder ? gameState.player : gameState.opponent;\r\n                let apRemaining = actor.threatResponseAP || 0;\r\n                let threats = tr.threats || [];\r\n                let defenseStack = tr.defenseStack || [];\r\n\r\n                // For AI opponent, auto-respond after delay (only schedule once)\r\n                if (!isPlayerResponder && !threatAutoRespondScheduled) {\r\n                    threatAutoRespondScheduled = true;\r\n                    console.log(\"[CardGame v2] Scheduling AI threat response\");\r\n                    setTimeout(() => {\r\n                        let gs = (window.CardGame.ctx || {}).gameState;\r\n                        if (gs && gs.threatResponse && gs.threatResponse.active) {\r\n                            // AI places a defensive card if available\r\n                            let aiActor = isPlayerResponder ? gs.player : gs.opponent;\r\n                            let defenseCards = aiActor.hand.filter(c =>\r\n                                c.type === \"action\" && (c.name === \"Block\" || c.name === \"Dodge\") ||\r\n                                c.type === \"item\" && c.subtype === \"armor\"\r\n                            );\r\n                            if (defenseCards.length > 0 && aiActor.threatResponseAP > 0) {\r\n                                CardGame.GameState.placeThreatDefenseCard(defenseCards[0]);\r\n                                m.redraw();\r\n                            } else {\r\n                                CardGame.GameState.skipThreatResponse();\r\n                            }\r\n                        }\r\n                        threatAutoRespondScheduled = false;  // Reset for next threat\r\n                    }, 1500);  // Give player time to see threat\r\n                }\r\n\r\n                // Get the threat and defender info\r\n                let threat = threats[0];\r\n                let defenderActor = threat?.target === \"player\" ? gameState.player : gameState.opponent;\r\n                let defenderName = threat?.target === \"player\" ? \"You\" : \"Opponent\";\r\n\r\n                return m(\"div\", { class: \"cg2-phase-panel cg2-threat-response-panel\" }, [\r\n                    m(\"h2\", isEndThreat ? \"End-of-Round Threat!\" : \"Threat Incoming!\"),\r\n                    m(\"p\", { class: \"cg2-threat-explain\" },\r\n                        isEndThreat\r\n                            ? (isPlayerResponder\r\n                                ? \"A threat emerges targeting you! Prepare to defend yourself!\"\r\n                                : \"A threat emerges targeting the opponent! They must defend...\")\r\n                            : (isPlayerResponder\r\n                                ? \"Your fumble attracted danger! Prepare to defend yourself!\"\r\n                                : \"Opponent's fumble attracted danger! They must defend...\")\r\n                    ),\r\n\r\n                    // Two-card layout like initiative phase\r\n                    m(\"div\", { class: \"cg2-init-cards cg2-threat-encounter\" }, [\r\n                        // Threat card (left)\r\n                        threat ? m(\"div\", { class: \"cg2-init-card-wrap cg2-threat-card-wrap\" }, [\r\n                            m(\"div\", { class: \"cg2-threat-encounter-card\" }, [\r\n                                m(\"div\", { class: \"cg2-threat-encounter-icon\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\" }, threat.imageIcon || \"pets\")\r\n                                ]),\r\n                                m(\"div\", { class: \"cg2-threat-encounter-name\" }, threat.name),\r\n                                m(\"div\", { class: \"cg2-threat-encounter-stats\" }, [\r\n                                    m(\"div\", { class: \"cg2-threat-stat-row\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\" }, \"swords\"),\r\n                                        m(\"span\", \"ATK \" + threat.atk)\r\n                                    ]),\r\n                                    m(\"div\", { class: \"cg2-threat-stat-row\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\" }, \"shield\"),\r\n                                        m(\"span\", \"DEF \" + threat.def)\r\n                                    ]),\r\n                                    m(\"div\", { class: \"cg2-threat-stat-row\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\" }, \"favorite\"),\r\n                                        m(\"span\", \"HP \" + threat.hp)\r\n                                    ])\r\n                                ]),\r\n                                m(\"div\", { class: \"cg2-threat-encounter-loot\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\" }, \"inventory_2\"),\r\n                                    \" \", threat.lootRarity, \" Loot\"\r\n                                ])\r\n                            ])\r\n                        ]) : null,\r\n\r\n                        // VS indicator\r\n                        m(\"div\", { class: \"cg2-init-vs cg2-threat-vs\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\" }, \"swords\"),\r\n                            m(\"div\", \"VS\")\r\n                        ]),\r\n\r\n                        // Defender card (right)\r\n                        m(\"div\", { class: \"cg2-init-card-wrap cg2-defender-card-wrap\" }, [\r\n                            m(\"div\", { class: \"cg2-defender-card\" + (isPlayerResponder ? \" cg2-defender-you\" : \"\") }, [\r\n                                m(\"div\", { class: \"cg2-defender-label\" }, defenderName),\r\n                                m(\"div\", { class: \"cg2-defender-stats\" }, [\r\n                                    m(\"div\", { class: \"cg2-defender-stat\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\" }, \"favorite\"),\r\n                                        \" HP: \", defenderActor?.hp || 0\r\n                                    ]),\r\n                                    m(\"div\", { class: \"cg2-defender-stat\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined\" }, \"shield\"),\r\n                                        \" END: \", defenderActor?.character?.stats?.END || 0\r\n                                    ])\r\n                                ]),\r\n\r\n                                // Defense stack display\r\n                                m(\"div\", { class: \"cg2-defender-stack-area\" }, [\r\n                                    m(\"div\", { class: \"cg2-defender-stack-label\" }, \"Defense Stack\"),\r\n                                    defenseStack.length > 0\r\n                                        ? m(\"div\", { class: \"cg2-defender-stack-cards\" },\r\n                                            defenseStack.map(card =>\r\n                                                m(\"div\", { class: \"cg2-defender-stack-card\" }, card.name)\r\n                                            )\r\n                                        )\r\n                                        : m(\"div\", { class: \"cg2-defender-stack-empty\" }, \"Empty - click cards below\")\r\n                                ]),\r\n\r\n                                // AP indicator\r\n                                isPlayerResponder ? m(\"div\", { class: \"cg2-defender-ap\" }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\" }, \"bolt\"),\r\n                                    \" \", apRemaining, \" / \", tr.bonusAP, \" AP\"\r\n                                ]) : null\r\n                            ])\r\n                        ])\r\n                    ]),\r\n\r\n                    // Action buttons\r\n                    isPlayerResponder ? m(\"div\", { class: \"cg2-threat-actions\" }, [\r\n                        apRemaining > 0\r\n                            ? m(\"button\", {\r\n                                class: \"cg2-btn cg2-btn-secondary\",\r\n                                onclick: function() { CardGame.GameState.skipThreatResponse(); }\r\n                            }, \"Skip Defense\")\r\n                            : null,\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary cg2-btn-threat\",\r\n                            onclick: function() {\r\n                                let gs = (window.CardGame.ctx || {}).gameState;\r\n                                let GP = CardGame.Constants.GAME_PHASES;\r\n                                console.log(\"[CardGame v2] Face Threat clicked, phase:\", gs ? gs.phase : \"null\");\r\n                                if (gs && gs.phase === GP.THREAT_RESPONSE) {\r\n                                    CardGame.GameState.resolveThreatCombat();\r\n                                } else if (gs && gs.phase === GP.END_THREAT) {\r\n                                    CardGame.GameState.resolveEndThreatCombat();\r\n                                } else {\r\n                                    console.warn(\"[CardGame v2] Face Threat: unexpected phase\", gs ? gs.phase : \"null\");\r\n                                    // Try to resolve anyway\r\n                                    if (gs && gs.threatResponse && gs.threatResponse.active) {\r\n                                        CardGame.GameState.resolveThreatCombat();\r\n                                    }\r\n                                }\r\n                            }\r\n                        }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: \"vertical-align: middle; margin-right: 4px\" }, \"shield\"),\r\n                            apRemaining > 0 ? \"Face Threat Now\" : \"Resolve Combat\"\r\n                        ])\r\n                    ]) : m(\"div\", { class: \"cg2-threat-waiting\" }, \"Opponent is preparing defense...\")\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    window.CardGame.UI.ThreatResponseUI = ThreatResponseUI;\r\n\r\n})();\r\n\n\n;/* === client/view/cardGame/ui/chatUI.js === */\n/**\r\n * CardGame UI - Talk/Chat Interface\r\n * Message display with player/NPC styling, text input and send button,\r\n * end conversation button, LLM integration with fallback responses,\r\n * and auto-scroll to bottom.\r\n *\r\n * Extracted from cardGame-v2.js (lines ~9233-9455).\r\n *\r\n * Depends on:\r\n *   - CardGame.Constants (GAME_PHASES)\r\n *   - CardGame.ctx (gameState, gameChatManager, gameVoice)\r\n *   - CardGame.Actions (advanceResolution)\r\n *\r\n * Exposes: window.CardGame.UI.TalkChatUI, window.CardGame.UI.openTalkChat\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.UI = window.CardGame.UI || {};\r\n\r\n    //  Talk Card Chat UI (Phase 8) \r\n    function TalkChatUI() {\r\n        let inputRef = null;\r\n\r\n        async function sendMessage() {\r\n            let ctx = window.CardGame.ctx || {};\r\n            let gameState = ctx.gameState;\r\n            let gameChatManager = ctx.gameChatManager;\r\n            let gameVoice = ctx.gameVoice;\r\n\r\n            if (!gameState?.chat?.active || gameState.chat.pending) return;\r\n            const text = gameState.chat.inputText?.trim();\r\n            if (!text) return;\r\n\r\n            // Add player message\r\n            gameState.chat.messages.push({\r\n                role: \"player\",\r\n                text: text,\r\n                timestamp: Date.now()\r\n            });\r\n            gameState.chat.inputText = \"\";\r\n            gameState.chat.pending = true;\r\n            m.redraw();\r\n\r\n            // Get NPC response\r\n            if (gameChatManager?.initialized) {\r\n                try {\r\n                    const response = await gameChatManager.sendMessage(text);\r\n                    if (response && !response.error) {\r\n                        gameState.chat.messages.push({\r\n                            role: \"npc\",\r\n                            text: response.text,\r\n                            speaker: response.speaker,\r\n                            timestamp: Date.now()\r\n                        });\r\n                        // Speak with opponent voice if available\r\n                        if (gameVoice?.enabled && !gameVoice.subtitlesOnly && response.text) {\r\n                            gameVoice.speak(response.text);\r\n                        }\r\n                    } else {\r\n                        // LLM returned error\r\n                        gameState.chat.messages.push({\r\n                            role: \"npc\",\r\n                            text: \"*looks at you thoughtfully but says nothing*\",\r\n                            timestamp: Date.now()\r\n                        });\r\n                    }\r\n                } catch (err) {\r\n                    console.warn(\"[TalkChatUI] Chat failed:\", err);\r\n                    gameState.chat.messages.push({\r\n                        role: \"npc\",\r\n                        text: \"*pauses, distracted*\",\r\n                        timestamp: Date.now()\r\n                    });\r\n                }\r\n            } else {\r\n                // Fallback: generate contextual responses based on NPC and player input\r\n                const npcName = gameState.chat.npcName || \"Opponent\";\r\n                const fallbackResponses = [\r\n                    `*${npcName} considers your words carefully*`,\r\n                    `*${npcName} narrows their eyes at you*`,\r\n                    `\"Hmm...\" *${npcName} seems unimpressed*`,\r\n                    `*${npcName} tilts their head, listening*`,\r\n                    `\"We shall see...\" *${npcName} mutters*`\r\n                ];\r\n                const randomResponse = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];\r\n                gameState.chat.messages.push({\r\n                    role: \"npc\",\r\n                    text: randomResponse,\r\n                    timestamp: Date.now()\r\n                });\r\n                console.log(\"[TalkChatUI] Using fallback response - LLM not initialized. Reason:\", gameChatManager?.lastError || \"gameChatManager is null\");\r\n            }\r\n\r\n            gameState.chat.pending = false;\r\n            m.redraw();\r\n\r\n            // Auto-scroll to bottom\r\n            setTimeout(() => {\r\n                const msgArea = document.querySelector(\".cg2-chat-messages\");\r\n                if (msgArea) msgArea.scrollTop = msgArea.scrollHeight;\r\n            }, 50);\r\n        }\r\n\r\n        function endChat() {\r\n            let ctx = window.CardGame.ctx || {};\r\n            let gameState = ctx.gameState;\r\n            let gameChatManager = ctx.gameChatManager;\r\n            let GAME_PHASES = CardGame.Constants.GAME_PHASES;\r\n\r\n            if (!gameState?.chat?.active) return;\r\n\r\n            // Conclude conversation\r\n            if (gameChatManager?.initialized) {\r\n                gameChatManager.concludeConversation();\r\n            }\r\n\r\n            // Calculate morale effect based on conversation\r\n            const msgCount = gameState.chat.messages.length;\r\n            const playerMsgs = gameState.chat.messages.filter(m => m.role === \"player\").length;\r\n\r\n            // Apply morale effects based on conversation quality\r\n            if (msgCount >= 4 && playerMsgs >= 2) {\r\n                // Good conversation: player gains morale, opponent loses some\r\n                gameState.player.morale = Math.min(gameState.player.maxMorale, gameState.player.morale + 2);\r\n                gameState.opponent.morale = Math.max(0, gameState.opponent.morale - 1);\r\n                page.toast(\"info\", \"Productive conversation! +2 morale\");\r\n            } else if (msgCount >= 2) {\r\n                // Brief exchange\r\n                gameState.player.morale = Math.min(gameState.player.maxMorale, gameState.player.morale + 1);\r\n                page.toast(\"info\", \"Brief exchange. +1 morale\");\r\n            }\r\n\r\n            // Mark Talk card position as resolved\r\n            if (gameState.chat.talkPosition !== null) {\r\n                const pos = gameState.actionBar.positions[gameState.chat.talkPosition];\r\n                if (pos) pos.resolved = true;\r\n            }\r\n\r\n            // Close chat (Silence Rule: lock chat again)\r\n            gameState.chat.active = false;\r\n            gameState.chat.unlocked = false;  // Silence Rule: chat locked until next Talk card\r\n            gameState.chat.messages = [];\r\n            gameState.chat.talkCard = null;\r\n            gameState.chat.talkPosition = null;\r\n\r\n            console.log(\"[CardGame v2] Chat ended (chat locked)\");\r\n            m.redraw();\r\n\r\n            // Continue resolution after chat ends\r\n            if (gameState.phase === GAME_PHASES.RESOLUTION) {\r\n                setTimeout(() => CardGame.GameState.advanceResolution(), 500);\r\n            }\r\n        }\r\n\r\n        return {\r\n            view() {\r\n                let ctx = window.CardGame.ctx || {};\r\n                let gameState = ctx.gameState;\r\n\r\n                if (!gameState?.chat?.active) return null;\r\n\r\n                const npcName = gameState.chat.npcName || \"Opponent\";\r\n                const npcPortrait = gameState.opponent?.character?.portraitUrl;\r\n\r\n                return m(\"div\", { class: \"cg2-chat-overlay\" }, [\r\n                    m(\"div\", { class: \"cg2-chat-panel\" }, [\r\n                        // Header\r\n                        m(\"div\", { class: \"cg2-chat-header\" }, [\r\n                            npcPortrait\r\n                                ? m(\"img\", { class: \"cg2-chat-portrait\", src: npcPortrait, alt: npcName })\r\n                                : m(\"span\", { class: \"material-symbols-outlined cg2-chat-portrait-icon\" }, \"person\"),\r\n                            m(\"span\", { class: \"cg2-chat-npc-name\" }, npcName),\r\n                            m(\"button\", {\r\n                                class: \"cg2-btn cg2-btn-sm\",\r\n                                onclick: endChat,\r\n                                title: \"End conversation\"\r\n                            }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined\" }, \"close\")\r\n                            ])\r\n                        ]),\r\n\r\n                        // Messages\r\n                        m(\"div\", { class: \"cg2-chat-messages\" },\r\n                            gameState.chat.messages.length === 0\r\n                                ? m(\"div\", { class: \"cg2-chat-hint\" }, `Start a conversation with ${npcName}...`)\r\n                                : gameState.chat.messages.map(msg =>\r\n                                    m(\"div\", {\r\n                                        class: \"cg2-chat-message cg2-chat-\" + msg.role\r\n                                    }, [\r\n                                        m(\"span\", { class: \"cg2-chat-speaker\" },\r\n                                            msg.role === \"player\" ? \"You\" : (msg.speaker || npcName)),\r\n                                        m(\"span\", { class: \"cg2-chat-text\" }, msg.text)\r\n                                    ])\r\n                                )\r\n                        ),\r\n\r\n                        // Input\r\n                        m(\"div\", { class: \"cg2-chat-input-area\" }, [\r\n                            m(\"input\", {\r\n                                type: \"text\",\r\n                                class: \"cg2-chat-input\",\r\n                                placeholder: \"Type your message...\",\r\n                                value: gameState.chat.inputText || \"\",\r\n                                disabled: gameState.chat.pending,\r\n                                oninput: e => { gameState.chat.inputText = e.target.value; },\r\n                                onkeydown: e => { if (e.key === \"Enter\") sendMessage(); },\r\n                                oncreate: v => { inputRef = v.dom; v.dom.focus(); }\r\n                            }),\r\n                            m(\"button\", {\r\n                                class: \"cg2-btn cg2-btn-primary cg2-chat-send\",\r\n                                onclick: sendMessage,\r\n                                disabled: gameState.chat.pending || !gameState.chat.inputText?.trim()\r\n                            }, gameState.chat.pending\r\n                                ? m(\"span\", { class: \"material-symbols-outlined cg2-spin\" }, \"sync\")\r\n                                : m(\"span\", { class: \"material-symbols-outlined\" }, \"send\")\r\n                            )\r\n                        ]),\r\n\r\n                        // End conversation button\r\n                        m(\"div\", { class: \"cg2-chat-actions\" }, [\r\n                            m(\"button\", {\r\n                                class: \"cg2-btn cg2-btn-secondary\",\r\n                                onclick: endChat\r\n                            }, \"End Conversation\")\r\n                        ])\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    // Open chat for Talk card\r\n    function openTalkChat(talkCard, positionIndex) {\r\n        let ctx = window.CardGame.ctx || {};\r\n        let gameState = ctx.gameState;\r\n        let gameChatManager = ctx.gameChatManager;\r\n\r\n        if (!gameState) return;\r\n\r\n        const npcName = gameState.opponent?.character?.name || \"Opponent\";\r\n\r\n        // Initialize chat state (Silence Rule: unlock chat)\r\n        gameState.chat.active = true;\r\n        gameState.chat.unlocked = true;  // Silence Rule: chat now available\r\n        gameState.chat.messages = [];\r\n        gameState.chat.npcName = npcName;\r\n        gameState.chat.inputText = \"\";\r\n        gameState.chat.pending = false;\r\n        gameState.chat.talkCard = talkCard;\r\n        gameState.chat.talkPosition = positionIndex;\r\n\r\n        // Start conversation in chat manager\r\n        if (gameChatManager?.initialized) {\r\n            gameChatManager.startConversation();\r\n        }\r\n\r\n        console.log(\"[CardGame v2] Talk chat opened with:\", npcName, \"(chat unlocked)\");\r\n        m.redraw();\r\n    }\r\n\r\n    window.CardGame.UI.TalkChatUI = TalkChatUI;\r\n    window.CardGame.UI.openTalkChat = openTalkChat;\r\n\r\n})();\r\n\n\n;/* === client/view/cardGame/ui/gameOverUI.js === */\n/**\r\n * CardGame UI - Game Over and Level Up\r\n * Victory/defeat screen with stats, campaign progress, level-up button.\r\n * Level-up UI shows 6 stats with descriptions, click to select 2, confirm button.\r\n *\r\n * Extracted from cardGame-v2.js (lines ~9457-9690).\r\n *\r\n * Depends on:\r\n *   - CardGame.Constants (GAME_PHASES)\r\n *   - CardGame.ctx (gameState, viewingDeck, activeCampaign, levelUpState, screen)\r\n *   - CardGame.Actions (createGameState, applyCampaignBonuses, initializeLLMComponents,\r\n *                       resetInitAnimState, startInitiativeAnimation, narrateGameEnd,\r\n *                       calculateXP, saveCampaignProgress)\r\n *   - CardGame.Storage (gameStorage, campaignStorage)\r\n *\r\n * Exposes: window.CardGame.UI.GameOverUI, window.CardGame.UI.LevelUpUI\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.UI = window.CardGame.UI || {};\r\n\r\n    //  Level Up Constants \r\n    const LEVEL_UP_STATS = [\"STR\", \"AGI\", \"END\", \"INT\", \"MAG\", \"CHA\"];\r\n    const STAT_DESCRIPTIONS = {\r\n        STR: \"Strength \\u2014 melee damage\",\r\n        AGI: \"Agility \\u2014 initiative rolls\",\r\n        END: \"Endurance \\u2014 action points\",\r\n        INT: \"Intelligence \\u2014 skill effects\",\r\n        MAG: \"Magic \\u2014 energy pool & spells\",\r\n        CHA: \"Charisma \\u2014 talk & morale\"\r\n    };\r\n\r\n    //  Game Over UI \r\n    function GameOverUI() {\r\n        let narratedEnd = false;\r\n        let campaignSaved = false;\r\n\r\n        return {\r\n            async oninit() {\r\n                let ctx = window.CardGame.ctx || {};\r\n                let gameState = ctx.gameState;\r\n                let activeCampaign = ctx.activeCampaign;\r\n\r\n                // Trigger end game narration once\r\n                if (!narratedEnd && gameState && gameState.winner) {\r\n                    narratedEnd = true;\r\n                    CardGame.GameState.narrateGameEnd(gameState.winner);\r\n                }\r\n                // Save campaign progress once\r\n                if (!campaignSaved && gameState && gameState.winner) {\r\n                    campaignSaved = true;\r\n                    let isVictory = gameState.winner === \"player\";\r\n                    let xpGain = CardGame.Storage.calculateXP(gameState, isVictory);\r\n                    gameState.xpGained = xpGain;\r\n                    ctx.activeCampaign = await CardGame.Storage.saveCampaignProgress(gameState, isVictory, xpGain);\r\n                    // Delete game saves on game end\r\n                    CardGame.Storage.gameStorage.deleteAll(gameState.deckName);\r\n                    m.redraw();\r\n                }\r\n            },\r\n            view() {\r\n                let ctx = window.CardGame.ctx || {};\r\n                let gameState = ctx.gameState;\r\n                let activeCampaign = ctx.activeCampaign;\r\n                let levelUpState = ctx.levelUpState;\r\n\r\n                // Show level-up dialog if pending\r\n                if (levelUpState) {\r\n                    return m(LevelUpUI);\r\n                }\r\n\r\n                let isVictory = gameState.winner === \"player\";\r\n                let player = gameState.player;\r\n                let opponent = gameState.opponent;\r\n                let rounds = gameState.round;\r\n\r\n                // Overlay on top of current game view\r\n                return m(\"div\", { class: \"cg2-game-over-overlay\" }, [\r\n                    m(\"div\", { class: \"cg2-game-over-panel\" }, [\r\n                        m(\"div\", {\r\n                            class: \"cg2-game-over-title \" + (isVictory ? \"cg2-victory\" : \"cg2-defeat\")\r\n                        }, isVictory ? \"Victory!\" : \"Defeat\"),\r\n\r\n                        m(\"div\", { class: \"cg2-game-over-subtitle\" },\r\n                            isVictory\r\n                                ? opponent.character.name + \" has been defeated!\"\r\n                                : \"You have been defeated by \" + opponent.character.name),\r\n\r\n                        m(\"div\", { class: \"cg2-game-over-stats\" }, [\r\n                            m(\"div\", { class: \"cg2-game-over-stat\" }, [\r\n                                m(\"div\", { class: \"cg2-game-over-stat-value\" }, rounds),\r\n                                m(\"div\", { class: \"cg2-game-over-stat-label\" }, \"Rounds\")\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-game-over-stat\" }, [\r\n                                m(\"div\", { class: \"cg2-game-over-stat-value\" }, player.hp + \"/\" + player.maxHp),\r\n                                m(\"div\", { class: \"cg2-game-over-stat-label\" }, \"Your HP\")\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-game-over-stat\" }, [\r\n                                m(\"div\", { class: \"cg2-game-over-stat-value\" }, opponent.hp + \"/\" + opponent.maxHp),\r\n                                m(\"div\", { class: \"cg2-game-over-stat-label\" }, \"Opponent HP\")\r\n                            ]),\r\n                            gameState.xpGained ? m(\"div\", { class: \"cg2-game-over-stat\" }, [\r\n                                m(\"div\", { class: \"cg2-game-over-stat-value cg2-xp-gain\" }, \"+\" + gameState.xpGained),\r\n                                m(\"div\", { class: \"cg2-game-over-stat-label\" }, \"XP Gained\")\r\n                            ]) : null\r\n                        ]),\r\n\r\n                        // Campaign progress bar\r\n                        activeCampaign ? m(\"div\", { class: \"cg2-game-over-campaign\" }, [\r\n                            m(\"div\", { class: \"cg2-campaign-progress\" }, [\r\n                                m(\"span\", \"Level \" + activeCampaign.level),\r\n                                m(\"span\", { class: \"cg2-campaign-xp-bar\" }, [\r\n                                    m(\"span\", { class: \"cg2-campaign-xp-fill\", style: { width: (activeCampaign.xp % 100) + \"%\" } }),\r\n                                ]),\r\n                                m(\"span\", activeCampaign.xp + \" XP\"),\r\n                            ]),\r\n                            m(\"div\", { class: \"cg2-campaign-record-line\" },\r\n                                activeCampaign.wins + \"W / \" + activeCampaign.losses + \"L (\" + activeCampaign.totalGamesPlayed + \" games)\")\r\n                        ]) : null,\r\n\r\n                        m(\"div\", { class: \"cg2-game-over-actions\" }, [\r\n                            // Level up button (if pending)\r\n                            activeCampaign?.pendingLevelUps > 0 ? m(\"button\", {\r\n                                class: \"cg2-btn cg2-btn-accent\",\r\n                                onclick() {\r\n                                    ctx.levelUpState = {\r\n                                        campaign: activeCampaign,\r\n                                        statsSelected: [],\r\n                                        remaining: 2\r\n                                    };\r\n                                    m.redraw();\r\n                                }\r\n                            }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined\" }, \"upgrade\"),\r\n                                \" Level Up! (+\" + (activeCampaign.pendingLevelUps * 2) + \" stats)\"\r\n                            ]) : null,\r\n                            m(\"button\", {\r\n                                class: \"cg2-btn cg2-btn-primary\",\r\n                                async onclick() {\r\n                                    let viewingDeck = ctx.viewingDeck;\r\n                                    // Restart with same characters\r\n                                    let playerChar = player.character;\r\n                                    ctx.gameState = CardGame.GameState.createGameState(viewingDeck, playerChar);\r\n                                    if (ctx.gameState) {\r\n                                        if (ctx.activeCampaign) CardGame.GameState.applyCampaignBonuses(ctx.gameState, ctx.activeCampaign);\r\n                                        CardGame.GameState.initializeLLMComponents(ctx.gameState, viewingDeck);\r\n                                        CardGame.GameState.resetInitAnimState();\r\n                                        CardGame.GameState.startInitiativeAnimation();\r\n                                    }\r\n                                    m.redraw();\r\n                                }\r\n                            }, \"Play Again\"),\r\n                            m(\"button\", {\r\n                                class: \"cg2-btn\",\r\n                                onclick() {\r\n                                    ctx.gameState = null;\r\n                                    ctx.activeCampaign = null;\r\n                                    // Restore deck view image state from viewingDeck\r\n                                    let viewingDeck = ctx.viewingDeck;\r\n                                    if (viewingDeck) {\r\n                                        ctx.backgroundImageId = viewingDeck.backgroundImageId || null;\r\n                                        ctx.backgroundPrompt = viewingDeck.backgroundPrompt || null;\r\n                                        ctx.backgroundThumbUrl = viewingDeck.backgroundThumbUrl || null;\r\n                                        ctx.tabletopImageId = viewingDeck.tabletopImageId || null;\r\n                                        ctx.tabletopThumbUrl = viewingDeck.tabletopThumbUrl || null;\r\n                                    }\r\n                                    ctx.screen = \"deckView\";\r\n                                    m.redraw();\r\n                                }\r\n                            }, \"Back to Deck\")\r\n                        ])\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Level Up UI Component \r\n    function LevelUpUI() {\r\n        return {\r\n            view() {\r\n                let ctx = window.CardGame.ctx || {};\r\n                let gameState = ctx.gameState;\r\n                let levelUpState = ctx.levelUpState;\r\n                let activeCampaign = ctx.activeCampaign;\r\n\r\n                if (!levelUpState) return null;\r\n                let { campaign, statsSelected, remaining } = levelUpState;\r\n                let playerStats = gameState?.player?.character?.stats || {};\r\n\r\n                return m(\"div\", { class: \"cg2-levelup-overlay\" }, [\r\n                    m(\"div\", { class: \"cg2-levelup-panel\" }, [\r\n                        m(\"h2\", { class: \"cg2-levelup-title\" }, \"Level Up!\"),\r\n                        m(\"p\", { class: \"cg2-levelup-subtitle\" },\r\n                            \"Level \" + campaign.level + \" reached! Choose \" + remaining + \" stat\" + (remaining > 1 ? \"s\" : \"\") + \" to increase.\"),\r\n\r\n                        m(\"div\", { class: \"cg2-levelup-stats\" },\r\n                            LEVEL_UP_STATS.map(stat => {\r\n                                let currentVal = playerStats[stat] || 0;\r\n                                let gained = (campaign.statGains?.[stat] || 0);\r\n                                let selectedCount = statsSelected.filter(s => s === stat).length;\r\n                                let isSelected = selectedCount > 0;\r\n\r\n                                return m(\"div\", {\r\n                                    class: \"cg2-stat-pick\" + (isSelected ? \" selected\" : \"\"),\r\n                                    onclick() {\r\n                                        if (remaining > 0) {\r\n                                            statsSelected.push(stat);\r\n                                            levelUpState.remaining--;\r\n                                        } else if (isSelected) {\r\n                                            // Deselect last instance\r\n                                            let idx = statsSelected.lastIndexOf(stat);\r\n                                            if (idx >= 0) {\r\n                                                statsSelected.splice(idx, 1);\r\n                                                levelUpState.remaining++;\r\n                                            }\r\n                                        }\r\n                                        m.redraw();\r\n                                    }\r\n                                }, [\r\n                                    m(\"div\", { class: \"cg2-stat-pick-name\" }, stat),\r\n                                    m(\"div\", { class: \"cg2-stat-pick-value\" }, currentVal + (selectedCount > 0 ? \" +\" + selectedCount : \"\")),\r\n                                    m(\"div\", { class: \"cg2-stat-pick-desc\" }, STAT_DESCRIPTIONS[stat]),\r\n                                    gained > 0 ? m(\"div\", { class: \"cg2-stat-pick-gained\" }, \"Campaign: +\" + gained) : null\r\n                                ]);\r\n                            })\r\n                        ),\r\n\r\n                        m(\"div\", { class: \"cg2-levelup-actions\" }, [\r\n                            m(\"button\", {\r\n                                class: \"cg2-btn cg2-btn-primary\",\r\n                                disabled: remaining > 0,\r\n                                async onclick() {\r\n                                    // Apply stat gains\r\n                                    for (let stat of statsSelected) {\r\n                                        campaign.statGains[stat] = (campaign.statGains[stat] || 0) + 1;\r\n                                    }\r\n                                    campaign.pendingLevelUps = Math.max(0, (campaign.pendingLevelUps || 1) - 1);\r\n\r\n                                    // Save updated campaign\r\n                                    let gs = (window.CardGame.ctx || {}).gameState;\r\n                                    await CardGame.Storage.campaignStorage.save(gs ? gs.deckName : \"\", campaign);\r\n                                    ctx.activeCampaign = campaign;\r\n\r\n                                    // Check if more level-ups pending\r\n                                    if (campaign.pendingLevelUps > 0) {\r\n                                        ctx.levelUpState = {\r\n                                            campaign,\r\n                                            statsSelected: [],\r\n                                            remaining: 2\r\n                                        };\r\n                                    } else {\r\n                                        ctx.levelUpState = null;\r\n                                    }\r\n                                    m.redraw();\r\n                                }\r\n                            }, remaining > 0 ? \"Select \" + remaining + \" more\" : \"Confirm\"),\r\n                            m(\"button\", {\r\n                                class: \"cg2-btn\",\r\n                                onclick() {\r\n                                    levelUpState.statsSelected = [];\r\n                                    levelUpState.remaining = 2;\r\n                                    m.redraw();\r\n                                }\r\n                            }, \"Reset\")\r\n                        ])\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    window.CardGame.UI.GameOverUI = GameOverUI;\r\n    window.CardGame.UI.LevelUpUI = LevelUpUI;\r\n\r\n})();\r\n\n\n;/* === client/view/cardGame/ui/gameView.js === */\n/**\r\n * CardGame UI - Game View Components\r\n * Main game container, character selection, sidebar, action bar, and hand tray.\r\n * Extracted from the monolithic cardGame-v2.js (lines ~7898-9903).\r\n *\r\n * Dependencies:\r\n *   - CardGame.Constants (GAME_PHASES)\r\n *   - CardGame.Storage (campaignStorage, gameStorage)\r\n *   - CardGame.Rendering (CardFace, CardBack, CardPreviewOverlay)\r\n *   - CardGame.Engine (drawCardsForActor)\r\n *   - CardGame.UI (InitiativePhaseUI, CleanupPhaseUI, ResolutionPhaseUI, etc.)\r\n *   - CardGame.ctx (shared mutable context: gameState, viewingDeck, screen, etc.)\r\n *\r\n * Exposes: window.CardGame.UI.{CharacterSelectUI, GameView, CharacterSidebar,\r\n *   FannedCardStack, ActionBar, HandTray, formatPhase, calcCharScore,\r\n *   gameViewState}\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.UI = window.CardGame.UI || {};\r\n\r\n    const GAME_PHASES = window.CardGame.Constants.GAME_PHASES;\r\n    const STATUS_EFFECTS = window.CardGame.Constants.STATUS_EFFECTS;\r\n\r\n    //  State \r\n    let handTrayFilter = \"all\";  // \"all\" | \"action\" | \"skill\" | \"magic\" | \"item\"\r\n    let stackFlipped = {};  // { \"player-0\": true, \"opponent-1\": false }\r\n\r\n    //  Helpers \r\n    function ctx() { return window.CardGame.ctx || {}; }\r\n    function storage() { return window.CardGame.Storage || {}; }\r\n    function rendering() { return window.CardGame.Rendering || {}; }\r\n\r\n    function formatPhase(phase) {\r\n        let labels = {\r\n            [GAME_PHASES.INITIATIVE]: \"Initiative\",\r\n            [GAME_PHASES.EQUIP]: \"Equip\",\r\n            [GAME_PHASES.THREAT_RESPONSE]: \"Threat!\",\r\n            [GAME_PHASES.DRAW_PLACEMENT]: \"Placement\",\r\n            [GAME_PHASES.RESOLUTION]: \"Resolution\",\r\n            [GAME_PHASES.CLEANUP]: \"Cleanup\",\r\n            [GAME_PHASES.END_THREAT]: \"End Threat!\",\r\n            \"GAME_OVER\": \"Game Over\"\r\n        };\r\n        return labels[phase] || phase;\r\n    }\r\n\r\n    //  Character Selection UI \r\n    // Calculate total stat score for a character\r\n    function calcCharScore(char) {\r\n        let stats = char.stats || {};\r\n        return (stats.STR || 0) + (stats.AGI || 0) + (stats.END || 0) +\r\n               (stats.INT || 0) + (stats.MAG || 0) + (stats.CHA || 0);\r\n    }\r\n\r\n    function CharacterSelectUI() {\r\n        return {\r\n            view() {\r\n                let gameCharSelection = ctx().gameCharSelection;\r\n                if (!gameCharSelection) return null;\r\n                let chars = gameCharSelection.characters || [];\r\n                let viewingDeck = ctx().viewingDeck;\r\n                let gameState = ctx().gameState;\r\n                let llmStatus = ctx().llmStatus || { checked: false, available: false };\r\n\r\n                // Calculate best and worst characters by total stats\r\n                let bestChar = null, worstChar = null;\r\n                let bestScore = -Infinity, worstScore = Infinity;\r\n                if (chars.length > 1) {\r\n                    chars.forEach(c => {\r\n                        let score = calcCharScore(c);\r\n                        if (score > bestScore) { bestScore = score; bestChar = c; }\r\n                        if (score < worstScore) { worstScore = score; worstChar = c; }\r\n                    });\r\n                    // Don't mark if all same score\r\n                    if (bestScore === worstScore) { bestChar = null; worstChar = null; }\r\n                }\r\n\r\n                // Get card front background from deck if available\r\n                let cardFrontBg = viewingDeck && viewingDeck.cardFrontImageUrl\r\n                    ? viewingDeck.cardFrontImageUrl : null;\r\n\r\n                // Get tabletop background from deck if available\r\n                let tabletopBg = viewingDeck && viewingDeck.tabletopThumbUrl\r\n                    ? viewingDeck.tabletopThumbUrl.replace(/\\/\\d+x\\d+$/, \"/1024x1024\")\r\n                    : null;\r\n\r\n                let containerStyle = tabletopBg ? {\r\n                    backgroundImage: \"url('\" + tabletopBg + \"')\",\r\n                    backgroundSize: \"cover\",\r\n                    backgroundPosition: \"center\"\r\n                } : {};\r\n\r\n                let CardFace = rendering().CardFace;\r\n                let createGameState = ctx().createGameState;\r\n                let applyCampaignBonuses = storage().applyCampaignBonuses;\r\n                let campaignStorage = storage().campaignStorage;\r\n                let initializeLLMComponents = ctx().initializeLLMComponents;\r\n\r\n                return m(\"div\", { class: \"cg2-game-container\", style: containerStyle }, [\r\n                    m(\"div\", { class: \"cg2-game-header\" }, [\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn\",\r\n                            onclick() {\r\n                                ctx().gameCharSelection = null;\r\n                                ctx().screen = \"deckView\";\r\n                                m.redraw();\r\n                            }\r\n                        }, \"\\u2190 Back\"),\r\n                        m(\"span\", { class: \"cg2-game-title\" }, \"Select Your Character\")\r\n                    ]),\r\n\r\n                    m(\"div\", { class: \"cg2-char-select-container\" }, [\r\n                        m(\"div\", { class: \"cg2-phase-panel\" }, [\r\n                            m(\"h2\", \"Choose Your Character\"),\r\n                            m(\"p\", \"Select which character you want to play (\" + chars.length + \" available). The other characters will be your opponents.\"),\r\n\r\n                            // LLM Status Indicator\r\n                            m(\"div\", { class: \"cg2-llm-status\" }, [\r\n                                !llmStatus.checked\r\n                                    ? m(\"span\", { class: \"cg2-llm-checking\" }, [\r\n                                        m(\"span\", { class: \"material-symbols-outlined cg2-spin\" }, \"sync\"),\r\n                                        \" Checking LLM connectivity...\"\r\n                                    ])\r\n                                    : llmStatus.available\r\n                                        ? m(\"span\", { class: \"cg2-llm-online\" }, [\r\n                                            m(\"span\", { class: \"material-symbols-outlined\" }, \"check_circle\"),\r\n                                            \" LLM Online\"\r\n                                        ])\r\n                                        : m(\"span\", { class: \"cg2-llm-offline\" }, [\r\n                                            m(\"span\", { class: \"material-symbols-outlined\" }, \"error\"),\r\n                                            \" LLM Offline - AI opponent will use basic strategy\"\r\n                                        ])\r\n                            ]),\r\n\r\n                            m(\"p\", { style: { marginBottom: \"16px\" } }, \"Click a character to start\"),\r\n\r\n                            m(\"div\", { class: \"cg2-char-select-grid\" },\r\n                                chars.map(char => {\r\n                                    let isBest = char === bestChar;\r\n                                    let isWorst = char === worstChar;\r\n                                    return m(\"div\", {\r\n                                        class: \"cg2-char-select-wrapper\",\r\n                                        async onclick() {\r\n                                            // Click to select and immediately start game\r\n                                            gameCharSelection.selected = char;\r\n                                            ctx().gameState = createGameState(viewingDeck, char);\r\n                                            ctx().gameCharSelection = null;\r\n                                            if (ctx().gameState) {\r\n                                                // Load and apply campaign bonuses\r\n                                                ctx().activeCampaign = await campaignStorage.load(viewingDeck.deckName || viewingDeck.storageName);\r\n                                                if (ctx().activeCampaign) applyCampaignBonuses(ctx().gameState, ctx().activeCampaign);\r\n                                                // Initialize LLM components in background (non-blocking)\r\n                                                if (typeof initializeLLMComponents === \"function\") {\r\n                                                    initializeLLMComponents(ctx().gameState, viewingDeck);\r\n                                                }\r\n                                                // Animation will trigger runInitiativePhase() when complete\r\n                                            }\r\n                                            m.redraw();\r\n                                        }\r\n                                    }, [\r\n                                        // Use CardFace for consistent card styling (card front bg, not portrait)\r\n                                        // noPreview: true prevents image click from opening preview instead of selecting\r\n                                        m(CardFace, { card: char, bgImage: cardFrontBg, noPreview: true }),\r\n                                        // Best character indicator (gold check)\r\n                                        isBest ? m(\"div\", { class: \"cg2-char-badge cg2-char-best\", title: \"Highest total stats\" }, [\r\n                                            m(\"span\", { class: \"material-symbols-outlined\" }, \"check_circle\")\r\n                                        ]) : null,\r\n                                        // Worst character indicator (red X)\r\n                                        isWorst ? m(\"div\", { class: \"cg2-char-badge cg2-char-worst\", title: \"Lowest total stats\" }, [\r\n                                            m(\"span\", { class: \"material-symbols-outlined\" }, \"cancel\")\r\n                                        ]) : null\r\n                                    ]);\r\n                                })\r\n                            )\r\n                        ])\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Game View Component \r\n    function GameView() {\r\n        return {\r\n            oninit() {\r\n                let gameState = ctx().gameState;\r\n                let viewingDeck = ctx().viewingDeck;\r\n                let gameCharSelection = ctx().gameCharSelection;\r\n                let llmStatus = ctx().llmStatus || {};\r\n\r\n                // Check LLM connectivity at game start\r\n                if (!llmStatus.checked && typeof ctx().checkLlmConnectivity === \"function\") {\r\n                    ctx().checkLlmConnectivity();\r\n                }\r\n\r\n                if (!gameState && viewingDeck) {\r\n                    // Always let player pick from all characters\r\n                    let allChars = (viewingDeck.cards || []).filter(c => c.type === \"character\");\r\n                    console.log(\"[CardGame v2] Game init - found \" + allChars.length + \" character cards:\", allChars.map(c => c.name));\r\n\r\n                    if (allChars.length > 0 && !gameCharSelection) {\r\n                        // Show character selection for ALL characters\r\n                        ctx().gameCharSelection = { characters: allChars, selected: null };\r\n                    } else if (gameCharSelection?.selected) {\r\n                        // Character selected - start game\r\n                        ctx().gameState = ctx().createGameState(viewingDeck, gameCharSelection.selected);\r\n                        ctx().gameCharSelection = null;\r\n                        if (ctx().gameState) {\r\n                            // Load and apply campaign bonuses (async, non-blocking)\r\n                            storage().campaignStorage.load(viewingDeck.deckName).then(c => {\r\n                                ctx().activeCampaign = c;\r\n                                if (c) storage().applyCampaignBonuses(ctx().gameState, c);\r\n                                m.redraw();\r\n                            });\r\n                            if (typeof ctx().initializeLLMComponents === \"function\") {\r\n                                ctx().initializeLLMComponents(ctx().gameState, viewingDeck);\r\n                            }\r\n                            // Animation will trigger runInitiativePhase() when complete\r\n                        }\r\n                    } else if (allChars.length === 0) {\r\n                        console.error(\"[CardGame v2] No characters in deck\");\r\n                    }\r\n                }\r\n            },\r\n            view() {\r\n                let gameState = ctx().gameState;\r\n                let gameCharSelection = ctx().gameCharSelection;\r\n                let viewingDeck = ctx().viewingDeck;\r\n                let initAnimState = ctx().initAnimState;\r\n\r\n                // Character selection screen\r\n                if (gameCharSelection && !gameState) {\r\n                    return m(CharacterSelectUI);\r\n                }\r\n\r\n                if (!gameState) {\r\n                    return m(\"div\", { class: \"cg2-game-error\" }, [\r\n                        m(\"h2\", \"Game Error\"),\r\n                        m(\"p\", \"No game state available. Please load a deck first.\"),\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn\",\r\n                            onclick() { ctx().screen = \"deckList\"; m.redraw(); }\r\n                        }, \"Back to Decks\")\r\n                    ]);\r\n                }\r\n\r\n                // Game Over is now rendered as an overlay, not a separate screen\r\n\r\n                let isPlacement = gameState.phase === GAME_PHASES.DRAW_PLACEMENT;\r\n                let isPlayerTurn = gameState.currentTurn === \"player\";\r\n                let player = gameState.player;\r\n\r\n                // Get tabletop background from deck if available\r\n                let tabletopBg = viewingDeck && viewingDeck.tabletopThumbUrl\r\n                    ? viewingDeck.tabletopThumbUrl.replace(/\\/\\d+x\\d+$/, \"/1024x1024\")\r\n                    : null;\r\n\r\n                let containerStyle = tabletopBg ? {\r\n                    backgroundImage: \"url('\" + tabletopBg + \"')\",\r\n                    backgroundSize: \"cover\",\r\n                    backgroundPosition: \"center\"\r\n                } : {};\r\n\r\n                // Resolve UI components from namespace\r\n                let InitiativePhaseUI = CardGame.UI.InitiativePhaseUI;\r\n                let ThreatResponseUI = CardGame.UI.ThreatResponseUI;\r\n                let CleanupPhaseUI = CardGame.UI.CleanupPhaseUI;\r\n                let TalkChatUI = CardGame.UI.TalkChatUI;\r\n                let GameOverUI = CardGame.UI.GameOverUI;\r\n\r\n                // Resolve engine functions from ctx\r\n                let advancePhase = ctx().advancePhase;\r\n                let drawCardsForActor = ctx().drawCardsForActor;\r\n                let checkPlacementComplete = ctx().checkPlacementComplete;\r\n                let endTurn = ctx().endTurn;\r\n\r\n                return m(\"div\", { class: \"cg2-game-container\", style: containerStyle }, [\r\n                    // Header with inline placement controls\r\n                    m(\"div\", { class: \"cg2-game-header\" }, [\r\n                        m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-sm\",\r\n                            onclick() {\r\n                                page.components.dialog.confirm(\"Exit game? Progress will be lost.\", function(ok) {\r\n                                    if (ok) {\r\n                                        ctx().gameState = null;\r\n                                        // Restore deck view image state from viewingDeck\r\n                                        if (viewingDeck) {\r\n                                            ctx().backgroundImageId = viewingDeck.backgroundImageId || null;\r\n                                            ctx().backgroundPrompt = viewingDeck.backgroundPrompt || null;\r\n                                            ctx().backgroundThumbUrl = viewingDeck.backgroundThumbUrl || null;\r\n                                            ctx().tabletopImageId = viewingDeck.tabletopImageId || null;\r\n                                            ctx().tabletopThumbUrl = viewingDeck.tabletopThumbUrl || null;\r\n                                        }\r\n                                        ctx().screen = \"deckView\";\r\n                                        m.redraw();\r\n                                    }\r\n                                });\r\n                            }\r\n                        }, \"\\u2190 Exit\"),\r\n                        m(\"span\", { class: \"cg2-round-badge\" }, \"R\" + gameState.round),\r\n\r\n                        // Compact status in header\r\n                        m(\"div\", { class: \"cg2-header-status\" }, [\r\n                            isPlacement ? m(\"span\", { class: \"cg2-header-ap\" }, [\r\n                                \"AP: \", m(\"strong\", (player.ap - player.apUsed) + \"/\" + player.ap)\r\n                            ]) : null,\r\n                            m(\"span\", { class: \"cg2-header-turn\" + (isPlayerTurn && isPlacement ? \" cg2-your-turn\" : \"\") },\r\n                                isPlacement ? (isPlayerTurn ? \"Your turn\" : \"Opponent...\") : \"\"\r\n                            )\r\n                        ]),\r\n\r\n                        m(\"span\", { class: \"cg2-phase-badge\" }, formatPhase(gameState.phase))\r\n                    ]),\r\n\r\n                    // Main game area\r\n                    m(\"div\", { class: \"cg2-game-main\" }, [\r\n                        // Left sidebar: Player character\r\n                        m(\"div\", { class: \"cg2-game-sidebar cg2-player-side\" }, [\r\n                            m(CharacterSidebar, { actor: gameState.player, label: \"You\" })\r\n                        ]),\r\n\r\n                        // Center: Phase UI + Action Bar\r\n                        m(\"div\", { class: \"cg2-game-center\" }, [\r\n                            // Phase-specific content\r\n                            m(\"div\", { class: \"cg2-phase-content\" }, [\r\n                                gameState.phase === GAME_PHASES.INITIATIVE && InitiativePhaseUI ? m(InitiativePhaseUI) : null,\r\n                                // Threat response phases\r\n                                (gameState.phase === GAME_PHASES.THREAT_RESPONSE || gameState.phase === GAME_PHASES.END_THREAT) && ThreatResponseUI\r\n                                    ? m(ThreatResponseUI)\r\n                                    : null,\r\n                                // Resolution overlay is now inside ActionBar\r\n                                gameState.phase === GAME_PHASES.CLEANUP && CleanupPhaseUI ? m(CleanupPhaseUI) : null,\r\n                                // Action Bar (visible in placement and resolution)\r\n                                (isPlacement || gameState.phase === GAME_PHASES.RESOLUTION)\r\n                                    ? m(ActionBar)\r\n                                    : null,\r\n\r\n                                // Narrator text overlay\r\n                                gameState.narrationText\r\n                                    ? m(\"div\", { class: \"cg2-narration-overlay\" }, [\r\n                                        m(\"div\", { class: \"cg2-narration-text\" }, [\r\n                                            m(\"span\", { class: \"material-symbols-outlined cg2-narration-icon\" }, \"campaign\"),\r\n                                            gameState.narrationText\r\n                                        ])\r\n                                    ])\r\n                                    : null,\r\n\r\n                                // Talk card chat overlay (Phase 8)\r\n                                gameState.chat?.active && TalkChatUI ? m(TalkChatUI) : null,\r\n\r\n                                // Game Over overlay\r\n                                gameState.winner && GameOverUI ? m(GameOverUI) : null\r\n                            ]),\r\n\r\n                            // Action Panel (hidden during resolution to avoid duplicate UI)\r\n                            gameState.phase !== GAME_PHASES.RESOLUTION ? m(\"div\", { class: \"cg2-action-panel\" }, [\r\n                                // Status message - dynamic based on phase and state\r\n                                m(\"div\", { class: \"cg2-action-status\" },\r\n                                    gameState.phase === GAME_PHASES.INITIATIVE\r\n                                        ? (initAnimState && initAnimState.rollComplete && gameState.initiative.winner\r\n                                            ? [\r\n                                                m(\"strong\", gameState.initiative.winner === \"player\" ? \"You win initiative! \" : \"Opponent wins initiative! \"),\r\n                                                m(\"span\", gameState.initiative.winner === \"player\"\r\n                                                    ? \"You go first (odd positions: 1, 3, 5...)\"\r\n                                                    : \"Opponent goes first. You get even positions (2, 4, 6...)\")\r\n                                            ]\r\n                                            : \"Rolling for initiative...\")\r\n                                        : (gameState.phase === GAME_PHASES.THREAT_RESPONSE || gameState.phase === GAME_PHASES.END_THREAT)\r\n                                            ? (gameState.threatResponse?.responder === \"player\"\r\n                                                ? \"Threat incoming! Click cards to defend.\"\r\n                                                : \"Opponent is responding to threat...\")\r\n                                            : gameState.phase === GAME_PHASES.DRAW_PLACEMENT\r\n                                                ? (isPlayerTurn ? \"Place cards on the action bar\" : \"Opponent is placing...\")\r\n                                                : gameState.phase === GAME_PHASES.RESOLUTION\r\n                                                    ? \"\" // Status shown in resolution overlay above\r\n                                                    : gameState.phase === GAME_PHASES.CLEANUP\r\n                                                        ? \"Round complete!\"\r\n                                                        : \"\"\r\n                                ),\r\n                                // Primary action button(s)\r\n                                m(\"div\", { class: \"cg2-action-buttons\" }, [\r\n                                    // Initiative phase: Continue button\r\n                                    gameState.phase === GAME_PHASES.INITIATIVE && initAnimState && initAnimState.rollComplete\r\n                                        ? m(\"button\", {\r\n                                            class: \"cg2-btn cg2-btn-primary cg2-action-btn-lg\",\r\n                                            onclick() { advancePhase(); }\r\n                                        }, \"Continue\")\r\n                                        : null,\r\n                                    // Placement phase: Draw and End Turn buttons\r\n                                    isPlacement && isPlayerTurn ? [\r\n                                        m(\"button\", {\r\n                                            class: \"cg2-btn cg2-action-btn-lg\",\r\n                                            disabled: player.drawPile.length === 0 || player.apUsed >= player.ap,\r\n                                            title: \"Draw a card (costs 1 AP)\",\r\n                                            onclick() {\r\n                                                if (player.apUsed < player.ap) {\r\n                                                    drawCardsForActor(player, 1);\r\n                                                    player.apUsed++;\r\n                                                    m.redraw();\r\n                                                }\r\n                                            }\r\n                                        }, [\r\n                                            m(\"span\", { class: \"material-symbols-outlined\" }, \"add_card\"),\r\n                                            \" Draw\"\r\n                                        ]),\r\n                                        m(\"button\", {\r\n                                            class: \"cg2-btn cg2-btn-primary cg2-action-btn-lg\",\r\n                                            onclick() {\r\n                                                checkPlacementComplete();\r\n                                                if (ctx().gameState.phase === GAME_PHASES.DRAW_PLACEMENT) {\r\n                                                    endTurn();\r\n                                                }\r\n                                            }\r\n                                        }, player.apUsed > 0 ? \"End Turn\" : \"Pass Turn\")\r\n                                    ] : null\r\n                                ])\r\n                            ]) : null\r\n                        ]),\r\n\r\n                        // Right sidebar: Opponent\r\n                        m(\"div\", { class: \"cg2-game-sidebar cg2-opponent-side\" }, [\r\n                            m(CharacterSidebar, { actor: gameState.opponent, label: \"Opponent\", isOpponent: true })\r\n                        ])\r\n                    ]),\r\n\r\n                    // Bottom: Hand Tray (visible in initiative, placement, and threat response phases)\r\n                    (gameState.phase === GAME_PHASES.INITIATIVE ||\r\n                     gameState.phase === GAME_PHASES.DRAW_PLACEMENT ||\r\n                     gameState.phase === GAME_PHASES.THREAT_RESPONSE ||\r\n                     gameState.phase === GAME_PHASES.END_THREAT)\r\n                        ? m(HandTray)\r\n                        : null\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Fanned Card Stack Component \r\n    function FannedCardStack() {\r\n        return {\r\n            view(vnode) {\r\n                let { cards, stackId, label, maxShow } = vnode.attrs;\r\n                let CardFace = rendering().CardFace;\r\n                let CardBack = rendering().CardBack;\r\n                maxShow = maxShow || 3;\r\n                let cardList = cards || [];\r\n\r\n                // Empty placeholder\r\n                if (cardList.length === 0) {\r\n                    return m(\"div\", { class: \"cg2-fanned-stack cg2-fanned-empty\" }, [\r\n                        m(\"div\", { class: \"cg2-stack-label\" }, label || \"Empty\"),\r\n                        m(\"div\", { class: \"cg2-stack-placeholder\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\" }, \"add_card\")\r\n                        ])\r\n                    ]);\r\n                }\r\n\r\n                return m(\"div\", { class: \"cg2-fanned-stack\" }, [\r\n                    m(\"div\", { class: \"cg2-stack-label\" }, (label || \"Stack\") + \" (\" + cardList.length + \")\"),\r\n                    m(\"div\", { class: \"cg2-fanned-cards\" },\r\n                        cardList.slice(0, maxShow).map((card, i) => {\r\n                            let flipKey = stackId + \"-\" + i;\r\n                            let isFlipped = stackFlipped[flipKey];\r\n                            let fanAngle = (i - (Math.min(cardList.length, maxShow) - 1) / 2) * 8;\r\n                            let fanOffset = i * 25;\r\n\r\n                            return m(\"div\", {\r\n                                key: flipKey,\r\n                                class: \"cg2-fanned-card-wrap\" + (isFlipped ? \" cg2-flipped\" : \"\"),\r\n                                style: {\r\n                                    zIndex: 10 + i,\r\n                                    transform: \"translateX(\" + fanOffset + \"px) rotate(\" + fanAngle + \"deg)\"\r\n                                },\r\n                                onclick(e) {\r\n                                    e.stopPropagation();\r\n                                    // Double-click to flip\r\n                                },\r\n                                ondblclick(e) {\r\n                                    e.stopPropagation();\r\n                                    stackFlipped[flipKey] = !stackFlipped[flipKey];\r\n                                    m.redraw();\r\n                                },\r\n                                title: card.name + (card.effect ? \": \" + card.effect : \"\") + \"\\n(Double-click to flip)\"\r\n                            }, [\r\n                                m(\"div\", { class: \"cg2-fanned-card-inner\" }, [\r\n                                    // Front face\r\n                                    m(\"div\", { class: \"cg2-fanned-face cg2-fanned-front\" },\r\n                                        m(CardFace, { card, compact: true })\r\n                                    ),\r\n                                    // Back face\r\n                                    m(\"div\", { class: \"cg2-fanned-face cg2-fanned-back\" },\r\n                                        m(CardBack, { type: card.type })\r\n                                    )\r\n                                ])\r\n                            ]);\r\n                        }),\r\n                        // Show \"+N more\" badge if more cards\r\n                        cardList.length > maxShow\r\n                            ? m(\"div\", { class: \"cg2-fanned-more\" }, \"+\" + (cardList.length - maxShow))\r\n                            : null\r\n                    )\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Character Sidebar Component \r\n    function CharacterSidebar() {\r\n        return {\r\n            view(vnode) {\r\n                let { actor, label, isOpponent } = vnode.attrs;\r\n                let char = actor.character || {};\r\n                let stackId = isOpponent ? \"opponent\" : \"player\";\r\n                let gameState = ctx().gameState;\r\n                let activeCampaign = ctx().activeCampaign;\r\n                let showCardPreview = rendering().showCardPreview || ctx().showCardPreview;\r\n\r\n                // HP/Energy/Morale percentages\r\n                let hpPct = Math.max(0, Math.min(100, (actor.hp / actor.maxHp) * 100));\r\n                let energyPct = Math.max(0, Math.min(100, (actor.energy / actor.maxEnergy) * 100));\r\n\r\n                return m(\"div\", { class: \"cg2-char-sidebar\" + (isOpponent ? \" cg2-opponent\" : \"\") }, [\r\n                    m(\"div\", { class: \"cg2-sidebar-label\" }, label),\r\n\r\n                    // Prominent game stats bar\r\n                    m(\"div\", { class: \"cg2-sidebar-stats\" }, [\r\n                        m(\"div\", { class: \"cg2-sidebar-stat cg2-stat-hp\" }, [\r\n                            m(\"span\", { class: \"cg2-stat-icon\" }, \"\\u2665\"),\r\n                            m(\"div\", { class: \"cg2-stat-bar\" }, [\r\n                                m(\"div\", { class: \"cg2-stat-fill cg2-hp-fill\", style: { width: hpPct + \"%\" } })\r\n                            ]),\r\n                            m(\"span\", { class: \"cg2-stat-val\" }, actor.hp + \"/\" + actor.maxHp)\r\n                        ]),\r\n                        m(\"div\", { class: \"cg2-sidebar-stat cg2-stat-energy\" }, [\r\n                            m(\"span\", { class: \"cg2-stat-icon\" }, \"\\u26A1\"),\r\n                            m(\"div\", { class: \"cg2-stat-bar\" }, [\r\n                                m(\"div\", { class: \"cg2-stat-fill cg2-energy-fill\", style: { width: energyPct + \"%\" } })\r\n                            ]),\r\n                            m(\"span\", { class: \"cg2-stat-val\" }, actor.energy + \"/\" + actor.maxEnergy)\r\n                        ])\r\n                    ]),\r\n\r\n                    // Character portrait (clickable for popup)\r\n                    m(\"div\", {\r\n                        class: \"cg2-sidebar-portrait\",\r\n                        onclick() { if (showCardPreview) showCardPreview(char); },\r\n                        title: \"Click to view full card\"\r\n                    }, [\r\n                        char.portraitUrl\r\n                            ? m(\"img\", { src: char.portraitUrl, class: \"cg2-portrait-img-sidebar\" })\r\n                            : m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:48px;color:#B8860B\" }, \"person\"),\r\n                        m(\"div\", { class: \"cg2-portrait-name\" }, char.name || \"Unknown\")\r\n                    ]),\r\n\r\n                    // Campaign level badge (player only)\r\n                    !isOpponent && activeCampaign ? m(\"div\", { class: \"cg2-campaign-badge\" }, [\r\n                        m(\"span\", { class: \"cg2-campaign-level\" }, \"Lv.\" + activeCampaign.level),\r\n                        m(\"span\", { class: \"cg2-campaign-xp\" }, activeCampaign.xp + \" XP\"),\r\n                        m(\"span\", { class: \"cg2-campaign-record\" }, activeCampaign.wins + \"W/\" + activeCampaign.losses + \"L\")\r\n                    ]) : null,\r\n\r\n                    // AP indicator\r\n                    m(\"div\", { class: \"cg2-ap-indicator\" }, [\r\n                        m(\"span\", \"AP: \"),\r\n                        m(\"span\", { class: \"cg2-ap-value\" }, (actor.ap - actor.apUsed) + \"/\" + actor.ap)\r\n                    ]),\r\n\r\n                    // Compact counts row\r\n                    m(\"div\", { class: \"cg2-hand-count\" }, [\r\n                        m(\"span\", { title: \"Cards in hand\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:12px;vertical-align:middle\" }, \"playing_cards\"),\r\n                            \" \" + (actor.hand ? actor.hand.length : 0)\r\n                        ]),\r\n                        m(\"span\", { title: \"Cards in deck\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:12px;vertical-align:middle\" }, \"layers\"),\r\n                            \" \" + (actor.drawPile ? actor.drawPile.length : 0)\r\n                        ])\r\n                    ]),\r\n\r\n                    // Opponent hand visual (stack of card backs)\r\n                    isOpponent && actor.hand && actor.hand.length > 0\r\n                        ? m(\"div\", { class: \"cg2-opp-hand-visual\" }, [\r\n                            m(\"div\", { class: \"cg2-opp-hand-stack\" },\r\n                                // Show up to 5 card backs in a fanned stack\r\n                                Array.from({ length: Math.min(actor.hand.length, 5) }).map((_, i) =>\r\n                                    m(\"div\", {\r\n                                        key: i,\r\n                                        class: \"cg2-opp-card-back\",\r\n                                        style: {\r\n                                            left: (i * 6) + \"px\",\r\n                                            top: (i * 2) + \"px\",\r\n                                            zIndex: i,\r\n                                            transform: \"rotate(\" + ((i - 2) * 3) + \"deg)\"\r\n                                        }\r\n                                    })\r\n                                )\r\n                            )\r\n                        ])\r\n                        : null,\r\n\r\n                    // Chat button (Silence Rule: locked unless Talk card active)\r\n                    isOpponent ? m(\"button\", {\r\n                        class: \"cg2-chat-btn\" + (gameState?.chat?.unlocked ? \" cg2-chat-unlocked\" : \" cg2-chat-locked\"),\r\n                        disabled: !gameState?.chat?.unlocked,\r\n                        title: gameState?.chat?.unlocked\r\n                            ? \"Chat with \" + (char.name || \"opponent\")\r\n                            : \"Play a Talk card to speak with your opponent\",\r\n                        onclick() {\r\n                            if (gameState?.chat?.unlocked && !gameState?.chat?.active) {\r\n                                // Re-open chat if unlocked but closed\r\n                                gameState.chat.active = true;\r\n                                m.redraw();\r\n                            }\r\n                        }\r\n                    }, [\r\n                        m(\"span\", { class: \"material-symbols-outlined\" }, \"chat\"),\r\n                        gameState?.chat?.unlocked ? \" Chat\" : \" Locked\"\r\n                    ]) : null,\r\n\r\n                    // Status effects display\r\n                    actor.statusEffects && actor.statusEffects.length > 0\r\n                        ? m(\"div\", { class: \"cg2-status-effects\" },\r\n                            actor.statusEffects.map(effect =>\r\n                                m(\"div\", {\r\n                                    key: effect.id,\r\n                                    class: \"cg2-status-effect\",\r\n                                    style: { borderColor: effect.color },\r\n                                    title: effect.name + \": \" + (STATUS_EFFECTS[effect.id.toUpperCase()]?.description || \"\") +\r\n                                           (effect.durationType === \"turns\" ? \" (\" + effect.turnsRemaining + \" turns)\" : \"\")\r\n                                }, [\r\n                                    m(\"span\", {\r\n                                        class: \"material-symbols-outlined cg2-status-icon\",\r\n                                        style: { color: effect.color }\r\n                                    }, effect.icon),\r\n                                    effect.durationType === \"turns\"\r\n                                        ? m(\"span\", { class: \"cg2-status-turns\" }, effect.turnsRemaining)\r\n                                        : null\r\n                                ])\r\n                            )\r\n                        )\r\n                        : null,\r\n\r\n                    // Fanned card stack (modifier cards on character)\r\n                    m(FannedCardStack, {\r\n                        cards: actor.cardStack,\r\n                        stackId: stackId + \"-mods\",\r\n                        label: \"Equip\",\r\n                        maxShow: 3\r\n                    })\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Action Bar Component \r\n    function ActionBar() {\r\n        return {\r\n            view() {\r\n                let gameState = ctx().gameState;\r\n                let viewingDeck = ctx().viewingDeck;\r\n                let bar = gameState.actionBar;\r\n                let isPlacement = gameState.phase === GAME_PHASES.DRAW_PLACEMENT;\r\n                let isResolution = gameState.phase === GAME_PHASES.RESOLUTION;\r\n                let cardFrontBg = viewingDeck?.cardFrontImageUrl || null;\r\n                let CardFace = rendering().CardFace;\r\n                let showCardPreview = rendering().showCardPreview || ctx().showCardPreview;\r\n                let placeCard = ctx().placeCard;\r\n                let removeCardFromPosition = ctx().removeCardFromPosition;\r\n                let ResolutionPhaseUI = CardGame.UI.ResolutionPhaseUI;\r\n\r\n                return m(\"div\", { class: \"cg2-action-bar\" }, [\r\n                    m(\"div\", { class: \"cg2-action-bar-label\" }, \"Action Bar\"),\r\n                    m(\"div\", { class: \"cg2-action-bar-track\" },\r\n                        bar.positions.map((pos, i) => {\r\n                            let isActive = isResolution && bar.resolveIndex === i;\r\n                            let isResolved = pos.resolved;\r\n                            let isPlayerPos = pos.owner === \"player\";\r\n                            let isThreatPos = pos.isThreat;\r\n                            let playerOutOfAP = gameState.player.apUsed >= gameState.player.ap;\r\n                            let canDrop = isPlacement && isPlayerPos && gameState.currentTurn === \"player\" && !isThreatPos;\r\n                            // Mark empty player positions as locked if out of AP\r\n                            let isLocked = isPlacement && isPlayerPos && !pos.stack && playerOutOfAP && !isThreatPos;\r\n\r\n                            return m(\"div\", {\r\n                                key: pos.index,\r\n                                class: \"cg2-action-position\" +\r\n                                       (isThreatPos ? \" cg2-threat-pos\" : (isPlayerPos ? \" cg2-player-pos\" : \" cg2-opponent-pos\")) +\r\n                                       (isActive ? \" cg2-active\" : \"\") +\r\n                                       (isResolved ? \" cg2-resolved\" : \"\") +\r\n                                       (isLocked ? \" cg2-locked\" : \"\") +\r\n                                       (canDrop && !isLocked ? \" cg2-droppable\" : \"\"),\r\n                                ondragover(e) {\r\n                                    if (canDrop && !isLocked) e.preventDefault();\r\n                                },\r\n                                ondrop(e) {\r\n                                    if (!canDrop || isLocked) return;\r\n                                    e.preventDefault();\r\n                                    let cardData = e.dataTransfer.getData(\"text/plain\");\r\n                                    try {\r\n                                        let card = JSON.parse(cardData);\r\n                                        placeCard(pos.index, card);\r\n                                    } catch (err) {\r\n                                        console.error(\"[CardGame v2] Drop error:\", err);\r\n                                    }\r\n                                }\r\n                            }, [\r\n                                m(\"div\", { class: \"cg2-pos-number\" }, isThreatPos ? \"T\" + pos.index : pos.index),\r\n                                m(\"div\", { class: \"cg2-pos-owner\" },\r\n                                    isThreatPos\r\n                                        ? [m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:12px;vertical-align:middle\" }, pos.threat?.imageIcon || \"warning\"), \" Threat\"]\r\n                                        : (isPlayerPos ? \"You\" : \"Opp\")),\r\n\r\n                                // Threat display\r\n                                isThreatPos && pos.threat\r\n                                    ? m(\"div\", { class: \"cg2-pos-threat\" }, [\r\n                                        m(\"div\", { class: \"cg2-threat-name\" }, pos.threat.name),\r\n                                        m(\"div\", { class: \"cg2-threat-stats\" }, [\r\n                                            m(\"span\", { title: \"Attack\" }, \"ATK \" + pos.threat.atk),\r\n                                            m(\"span\", { title: \"Defense\" }, \"DEF \" + pos.threat.def),\r\n                                            m(\"span\", { title: \"Hit Points\" }, \"HP \" + pos.threat.hp)\r\n                                        ]),\r\n                                        m(\"div\", { class: \"cg2-threat-target\" }, [\r\n                                            \"\\u2192 \",\r\n                                            m(\"span\", { class: pos.target === \"player\" ? \"cg2-threat-target-you\" : \"cg2-threat-target-opp\" },\r\n                                                pos.target === \"player\" ? \"You\" : \"Opponent\")\r\n                                        ])\r\n                                    ])\r\n                                    : pos.stack && pos.stack.coreCard\r\n                                        ? m(\"div\", { class: \"cg2-pos-stack\" }, [\r\n                                            // Core card as mini card (on top)\r\n                                            m(\"div\", {\r\n                                                class: \"cg2-pos-core-card\",\r\n                                                onclick(e) {\r\n                                                    e.stopPropagation();\r\n                                                    if (showCardPreview) showCardPreview(pos.stack.coreCard);\r\n                                                },\r\n                                                title: pos.stack.coreCard.name + (pos.stack.modifiers.length > 0 ? \" + \" + pos.stack.modifiers.length + \" modifier(s)\" : \"\") + \" (click to enlarge)\"\r\n                                            }, [\r\n                                                m(CardFace, { card: pos.stack.coreCard, bgImage: cardFrontBg, compact: true }),\r\n                                                // Stack count badge\r\n                                                pos.stack.modifiers.length > 0\r\n                                                    ? m(\"div\", { class: \"cg2-stack-count\" }, \"+\" + pos.stack.modifiers.length)\r\n                                                    : null,\r\n                                                // Remove button (only during placement phase for player's cards)\r\n                                                canDrop ? m(\"button\", {\r\n                                                    class: \"cg2-pos-remove-btn\",\r\n                                                    onclick(e) {\r\n                                                        e.stopPropagation();\r\n                                                        removeCardFromPosition(pos.index);\r\n                                                    },\r\n                                                    title: \"Remove card (return to hand)\"\r\n                                                }, m(\"span\", { class: \"material-symbols-outlined\" }, \"close\")) : null\r\n                                            ]),\r\n                                            // Modifier list (shown below for clarity)\r\n                                            pos.stack.modifiers.length > 0\r\n                                                ? m(\"div\", { class: \"cg2-pos-modifiers-list\" },\r\n                                                    pos.stack.modifiers.map((mod, mi) =>\r\n                                                        m(\"div\", {\r\n                                                            key: mi,\r\n                                                            class: \"cg2-pos-mod-item cg2-mod-\" + mod.type,\r\n                                                            onclick(e) {\r\n                                                                e.stopPropagation();\r\n                                                                if (showCardPreview) showCardPreview(mod);\r\n                                                            },\r\n                                                            title: mod.name + \" (click to enlarge)\"\r\n                                                        }, [\r\n                                                            m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:10px\" },\r\n                                                                mod.type === \"skill\" ? \"star\" : mod.type === \"magic\" ? \"auto_fix_high\" : \"category\"),\r\n                                                            \" \" + mod.name\r\n                                                        ])\r\n                                                    )\r\n                                                )\r\n                                                : null\r\n                                        ])\r\n                                        : m(\"div\", { class: \"cg2-pos-empty\" + (isLocked ? \" cg2-pos-locked\" : \"\") },\r\n                                            isLocked ? [m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:14px\" }, \"lock\"), \" No AP\"]\r\n                                                     : (canDrop ? \"Drop here\" : \"\\u2013\")),\r\n\r\n                                // Resolution marker\r\n                                isActive ? m(\"div\", { class: \"cg2-resolve-marker\" }, \"\\u25B6\") : null\r\n                            ]);\r\n                        })\r\n                    ),\r\n\r\n                    // Combat/Resolution overlay (inside action bar)\r\n                    isResolution && ResolutionPhaseUI ? m(ResolutionPhaseUI) : null\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Hand Tray Component \r\n    function HandTray() {\r\n        return {\r\n            view() {\r\n                let gameState = ctx().gameState;\r\n                let viewingDeck = ctx().viewingDeck;\r\n                let hand = gameState.player.hand || [];\r\n                let filteredHand = handTrayFilter === \"all\"\r\n                    ? hand\r\n                    : hand.filter(c => c.type === handTrayFilter);\r\n\r\n                // Get card front image from deck if available\r\n                let cardFrontBg = viewingDeck && viewingDeck.cardFrontImageUrl\r\n                    ? viewingDeck.cardFrontImageUrl : null;\r\n\r\n                let CardFace = rendering().CardFace;\r\n                let CardPreviewOverlay = rendering().CardPreviewOverlay;\r\n                let showCardPreview = rendering().showCardPreview || ctx().showCardPreview;\r\n                let placeThreatDefenseCard = ctx().placeThreatDefenseCard;\r\n\r\n                return m(\"div\", { class: \"cg2-hand-tray\" }, [\r\n                    // Header with label and filter tabs\r\n                    m(\"div\", { class: \"cg2-hand-header\" }, [\r\n                        m(\"span\", { class: \"cg2-hand-label\" }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined\", style: \"font-size:16px;vertical-align:middle;margin-right:4px\" }, \"playing_cards\"),\r\n                            \"Your Hand (\" + hand.length + \")\"\r\n                        ]),\r\n                        m(\"div\", { class: \"cg2-hand-tabs\" }, [\r\n                            [\"all\", \"action\", \"skill\", \"magic\", \"talk\"].map(f =>\r\n                                m(\"span\", {\r\n                                    class: \"cg2-hand-tab\" + (handTrayFilter === f ? \" cg2-tab-active\" : \"\"),\r\n                                    onclick() { handTrayFilter = f; }\r\n                                }, f.charAt(0).toUpperCase() + f.slice(1))\r\n                            )\r\n                        ])\r\n                    ]),\r\n\r\n                    // Cards - using compact card styling with click-to-preview\r\n                    m(\"div\", { class: \"cg2-hand-cards\" },\r\n                        filteredHand.length > 0\r\n                            ? filteredHand.map((card, i) => {\r\n                                // Check if in threat response mode\r\n                                let isThreatPhase = gameState.phase === GAME_PHASES.THREAT_RESPONSE ||\r\n                                                    gameState.phase === GAME_PHASES.END_THREAT;\r\n                                let isResponder = gameState.threatResponse?.responder === \"player\";\r\n                                let hasAP = (gameState.player.threatResponseAP || 0) > 0;\r\n                                let canPlaceDefense = isThreatPhase && isResponder && hasAP;\r\n\r\n                                return m(\"div\", {\r\n                                    key: card.name + \"-\" + i,\r\n                                    class: \"cg2-hand-card-wrapper\" + (canPlaceDefense ? \" cg2-defense-eligible\" : \"\"),\r\n                                    draggable: !isThreatPhase,\r\n                                    ondragstart(e) {\r\n                                        if (isThreatPhase) {\r\n                                            e.preventDefault();\r\n                                            return;\r\n                                        }\r\n                                        e.dataTransfer.setData(\"text/plain\", JSON.stringify(card));\r\n                                        e.dataTransfer.effectAllowed = \"move\";\r\n                                    },\r\n                                    onclick(e) {\r\n                                        e.stopPropagation();\r\n                                        // In threat response phase, clicking adds to defense stack\r\n                                        if (canPlaceDefense) {\r\n                                            if (placeThreatDefenseCard) placeThreatDefenseCard(card);\r\n                                            return;\r\n                                        }\r\n                                        if (showCardPreview) showCardPreview(card);\r\n                                    },\r\n                                    title: canPlaceDefense ? \"Click to add to defense\" : \"Click to enlarge, drag to place\"\r\n                                }, [\r\n                                    m(CardFace, { card, bgImage: cardFrontBg, compact: true }),\r\n                                    // Show art thumbnail if available\r\n                                    card.imageUrl ? m(\"img\", {\r\n                                        src: card.imageUrl,\r\n                                        class: \"cg2-card-art-thumb\"\r\n                                    }) : null\r\n                                ]);\r\n                            })\r\n                            : m(\"div\", { class: \"cg2-hand-empty\" }, \"No cards of this type\")\r\n                    ),\r\n                    // Card Preview Overlay\r\n                    CardPreviewOverlay ? m(CardPreviewOverlay) : null\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Expose on CardGame namespace \r\n    Object.assign(window.CardGame.UI, {\r\n        gameViewState: {\r\n            get handTrayFilter() { return handTrayFilter; },\r\n            set handTrayFilter(v) { handTrayFilter = v; },\r\n            get stackFlipped() { return stackFlipped; },\r\n            set stackFlipped(v) { stackFlipped = v; }\r\n        },\r\n        calcCharScore,\r\n        formatPhase,\r\n        CharacterSelectUI,\r\n        GameView,\r\n        FannedCardStack,\r\n        CharacterSidebar,\r\n        ActionBar,\r\n        HandTray\r\n    });\r\n\r\n    console.log('[CardGame] UI/gameView module loaded');\r\n\r\n})();\r\n\n\n;/* === client/view/cardGame/test/testMode.js === */\n/**\r\n * CardGame Test Mode - Comprehensive Test Suite\r\n * Phase 9: Runs tests across storage, narration, combat, card evaluation,\r\n * campaign, LLM, voice, and automated playthrough categories.\r\n *\r\n * Depends on:\r\n *   - window.CardGame.Constants (STATUS_EFFECTS, COMBAT_OUTCOMES)\r\n *   - window.CardGame.Storage (deckStorage, gameStorage, campaignStorage, encodeJson, decodeJson,\r\n *       createCampaignData, calculateXP, applyCampaignBonuses)\r\n *   - window.CardGame.Engine (rollD20, getActorATK, getActorDEF, getStackSkillMod, checkGameOver,\r\n *       parseEffect, applyParsedEffects, isEffectParseable, applyStatusEffect, removeStatusEffect,\r\n *       getStatusModifiers, createGameState, advancePhase, drawCardsForActor)\r\n *   - window.CardGame.AI (CardGameLLM, CardGameNarrator, checkLlmConnectivity, llmStatus,\r\n *       initializeLLMComponents, CardGameVoice)\r\n *   - window.CardGame.Rendering (CardFace)\r\n *   - window.CardGame.Themes (loadThemeConfig, activeTheme)\r\n *   - window.CardGame.ctx (shared mutable context: screen, viewingDeck, gameState,\r\n *       gameNarrator, gameDirector, gameChatManager, gameVoice, gameAnnouncerVoice)\r\n *\r\n * Exposes: window.CardGame.TestMode = {\r\n *   TEST_CATEGORIES, testState, testDeck, testDeckName,\r\n *   setTestDeck, clearTestDeck, runTestSuite, TestModeUI\r\n * }\r\n */\r\n(function() {\r\n    \"use strict\";\r\n\r\n    window.CardGame = window.CardGame || {};\r\n    window.CardGame.TestMode = window.CardGame.TestMode || {};\r\n\r\n    //  Aliases to other modules \r\n    function C()       { return window.CardGame.Constants; }\r\n    function S()       { return window.CardGame.Storage; }\r\n    function Eng()     { return window.CardGame.Engine || {}; }\r\n    function AI()      { return window.CardGame.AI || {}; }\r\n    function R()       { return window.CardGame.Rendering || {}; }\r\n    function Themes()  { return window.CardGame.Themes || {}; }\r\n    function GS()      { return window.CardGame.GameState || {}; }\r\n    function ctx()     { return window.CardGame.ctx || {}; }\r\n\r\n    //  Test Categories \r\n    const TEST_CATEGORIES = {\r\n        storage:     { label: \"Storage\",     icon: \"database\" },\r\n        narration:   { label: \"Narration\",   icon: \"campaign\" },\r\n        combat:      { label: \"Combat\",      icon: \"swords\" },\r\n        cards:       { label: \"Card Eval\",   icon: \"playing_cards\" },\r\n        campaign:    { label: \"Campaign\",    icon: \"military_tech\" },\r\n        llm:         { label: \"LLM\",         icon: \"smart_toy\" },\r\n        voice:       { label: \"Voice\",       icon: \"record_voice_over\" },\r\n        playthrough: { label: \"Playthrough\", icon: \"sports_esports\" }\r\n    };\r\n\r\n    //  State \r\n    let testDeck = null;       // Deck selected for testing (set from DeckView)\r\n    let testDeckName = null;\r\n\r\n    let testState = {\r\n        running: false,\r\n        logs: [],       // [{ time, category, message, status: \"info\"|\"pass\"|\"fail\"|\"warn\" }]\r\n        results: { pass: 0, fail: 0, warn: 0, skip: 0 },\r\n        currentTest: null,\r\n        completed: false,\r\n        selectedCategories: Object.keys(TEST_CATEGORIES),\r\n        autoPlaySpeed: 500  // ms between auto-play actions\r\n    };\r\n\r\n    //  Public setters for testDeck (called from DeckView / DeckList) \r\n    function setTestDeck(deck, name) {\r\n        testDeck = deck;\r\n        testDeckName = name;\r\n    }\r\n    function clearTestDeck() {\r\n        testDeck = null;\r\n        testDeckName = null;\r\n    }\r\n\r\n    //  Logging \r\n    function testLog(category, message, status) {\r\n        if (status === undefined) status = \"info\";\r\n        let entry = { time: new Date().toISOString().substring(11, 19), category: category, message: message, status: status };\r\n        testState.logs.push(entry);\r\n        if (status === \"pass\") testState.results.pass++;\r\n        else if (status === \"fail\") testState.results.fail++;\r\n        else if (status === \"warn\") testState.results.warn++;\r\n        console.log(\"[TestMode] [\" + category + \"] [\" + status + \"] \" + message);\r\n        m.redraw();\r\n    }\r\n\r\n    //  Main Test Suite \r\n    async function runTestSuite() {\r\n        testState.running = true;\r\n        testState.logs = [];\r\n        testState.results = { pass: 0, fail: 0, warn: 0, skip: 0 };\r\n        testState.completed = false;\r\n        m.redraw();\r\n\r\n        let cats = testState.selectedCategories;\r\n\r\n        // Resolve shorthand accessors\r\n        let storage = S();\r\n        let engine = Eng();\r\n        let gameState = GS();\r\n        let ai = AI();\r\n        let themes = Themes();\r\n        let context = ctx();\r\n\r\n        // Resolve the deck to use for testing\r\n        // Prefer testDeck (set from DeckView), otherwise load first available deck\r\n        let resolvedDeck = testDeck;\r\n        let resolvedDeckName = testDeckName;\r\n        if (!resolvedDeck) {\r\n            let deckNames = await storage.deckStorage.list();\r\n            if (deckNames.length > 0) {\r\n                resolvedDeckName = deckNames[0];\r\n                resolvedDeck = await storage.deckStorage.load(resolvedDeckName);\r\n            }\r\n        }\r\n        if (resolvedDeck) {\r\n            testLog(\"\", \"Using deck: \" + (resolvedDeck.deckName || resolvedDeckName), \"info\");\r\n            // Ensure the deck's theme is loaded so card pool analysis works\r\n            let activeTheme = themes.activeTheme ? themes.activeTheme() : null;\r\n            if (resolvedDeck.themeId && (!activeTheme || activeTheme.themeId !== resolvedDeck.themeId)) {\r\n                if (themes.loadThemeConfig) {\r\n                    await themes.loadThemeConfig(resolvedDeck.themeId);\r\n                    activeTheme = themes.activeTheme ? themes.activeTheme() : null;\r\n                }\r\n                testLog(\"\", \"Loaded theme: \" + (activeTheme?.name || resolvedDeck.themeId), \"info\");\r\n            }\r\n        } else {\r\n            testLog(\"\", \"No deck available for testing -- some tests will be skipped\", \"warn\");\r\n        }\r\n\r\n        //  Storage Tests \r\n        if (cats.includes(\"storage\")) {\r\n            testState.currentTest = \"Storage: CRUD operations\";\r\n            testLog(\"storage\", \"Testing storage CRUD...\");\r\n\r\n            try {\r\n                // Test encodeJson/decodeJson\r\n                let testData = { test: true, value: 42, nested: { arr: [1, 2, 3] } };\r\n                let encoded = storage.encodeJson(testData);\r\n                let decoded = storage.decodeJson(encoded);\r\n                if (decoded.test === true && decoded.value === 42 && decoded.nested.arr.length === 3) {\r\n                    testLog(\"storage\", \"encodeJson/decodeJson roundtrip\", \"pass\");\r\n                } else {\r\n                    testLog(\"storage\", \"encodeJson/decodeJson roundtrip failed\", \"fail\");\r\n                }\r\n\r\n                // Test deck list\r\n                let deckNames = await storage.deckStorage.list();\r\n                testLog(\"storage\", \"deckStorage.list() returned \" + deckNames.length + \" decks\", \"pass\");\r\n\r\n                // Test gameStorage.list for each deck\r\n                for (let name of deckNames.slice(0, 3)) {\r\n                    let saves = await storage.gameStorage.list(name);\r\n                    testLog(\"storage\", \"gameStorage.list('\" + name + \"') = \" + saves.length + \" saves\", \"pass\");\r\n                }\r\n\r\n                // Test campaignStorage for each deck\r\n                for (let name of deckNames.slice(0, 3)) {\r\n                    let campaign = await storage.campaignStorage.load(name);\r\n                    testLog(\"storage\", \"campaignStorage.load('\" + name + \"'): \" + (campaign ? \"Level \" + campaign.level : \"none\"), \"pass\");\r\n                }\r\n            } catch (e) {\r\n                testLog(\"storage\", \"Storage test error: \" + e.message, \"fail\");\r\n            }\r\n        }\r\n\r\n        //  Narration Tests \r\n        if (cats.includes(\"narration\")) {\r\n            testState.currentTest = \"Narration: triggers and display\";\r\n            testLog(\"narration\", \"Testing narration system...\");\r\n\r\n            // Test showNarrationSubtitle\r\n            let testText = \"[TEST] Narration subtitle test at \" + Date.now();\r\n            try {\r\n                // Access game state and narration functions from context\r\n                let gameState = context.gameState;\r\n                let showNarrationSubtitle = gameState.showNarrationSubtitle;\r\n                let triggerNarration = gameState.triggerNarration;\r\n                let gameNarrator = gameState.state.gameNarrator || null;\r\n\r\n                // Create temporary gameState for testing\r\n                let savedGs = gameState;\r\n                let tempGs = { narrationText: null, narrationTime: null, player: { character: { name: \"TestHero\" } }, opponent: { character: { name: \"TestVillain\" } }, round: 1 };\r\n\r\n                if (context.setGameState) context.setGameState(tempGs);\r\n                else if (window.CardGame.ctx) window.CardGame.ctx.gameState = tempGs;\r\n\r\n                if (showNarrationSubtitle) {\r\n                    showNarrationSubtitle(testText);\r\n                    let gs = context.gameState || tempGs;\r\n                    if (gs.narrationText === testText) {\r\n                        testLog(\"narration\", \"showNarrationSubtitle sets narrationText\", \"pass\");\r\n                    } else {\r\n                        testLog(\"narration\", \"showNarrationSubtitle did NOT set narrationText\", \"fail\");\r\n                    }\r\n                    // Timer is async and can't be verified synchronously\r\n                    testLog(\"narration\", \"Auto-hide timer scheduled (8s, cannot verify synchronously)\", \"info\");\r\n                    gs.narrationText = null;\r\n                } else {\r\n                    testLog(\"narration\", \"showNarrationSubtitle not available (module not yet extracted)\", \"warn\");\r\n                }\r\n\r\n                // Restore\r\n                if (context.setGameState) context.setGameState(savedGs);\r\n                else if (window.CardGame.ctx) window.CardGame.ctx.gameState = savedGs;\r\n            } catch (e) {\r\n                testLog(\"narration\", \"Narration test error: \" + e.message, \"fail\");\r\n            }\r\n\r\n            // Test triggerNarration fallback text\r\n            try {\r\n                let triggerNarration = gameState.triggerNarration;\r\n                let gameState = context.gameState;\r\n                let savedGs = gameState;\r\n                let savedNarrator = gameState.state.gameNarrator || null;\r\n\r\n                if (ai.setNarrator) ai.setNarrator(null); // Force fallback path\r\n                let tempGs = { narrationText: null, narrationTime: null, player: { character: { name: \"Hero\" }, hp: 15, energy: 10 }, opponent: { character: { name: \"Villain\" }, hp: 12, energy: 8 }, round: 3 };\r\n                if (window.CardGame.ctx) window.CardGame.ctx.gameState = tempGs;\r\n\r\n                if (triggerNarration) {\r\n                    await triggerNarration(\"game_start\");\r\n                    let gs = window.CardGame.ctx?.gameState || tempGs;\r\n                    if (gs.narrationText && gs.narrationText.includes(\"Hero\")) {\r\n                        testLog(\"narration\", \"game_start fallback text includes player name\", \"pass\");\r\n                    } else {\r\n                        testLog(\"narration\", \"game_start fallback text missing\", \"fail\");\r\n                    }\r\n                    gs.narrationText = null;\r\n                    await triggerNarration(\"round_start\");\r\n                    if (gs.narrationText && gs.narrationText.includes(\"Round 3\")) {\r\n                        testLog(\"narration\", \"round_start fallback for round 3\", \"pass\");\r\n                    } else {\r\n                        testLog(\"narration\", \"round_start fallback missing/wrong\", gs.round <= 1 ? \"pass\" : \"fail\");\r\n                    }\r\n                    gs.narrationText = null;\r\n                    await triggerNarration(\"resolution\", { isPlayerAttack: true, outcome: \"CRIT\", damage: 15 });\r\n                    if (gs.narrationText && gs.narrationText.includes(\"Critical\")) {\r\n                        testLog(\"narration\", \"resolution CRIT fallback text\", \"pass\");\r\n                    } else {\r\n                        testLog(\"narration\", \"resolution CRIT fallback missing\", \"fail\");\r\n                    }\r\n                } else {\r\n                    testLog(\"narration\", \"triggerNarration not available (module not yet extracted)\", \"warn\");\r\n                }\r\n\r\n                if (window.CardGame.ctx) window.CardGame.ctx.gameState = savedGs;\r\n                if (ai.setNarrator) ai.setNarrator(savedNarrator);\r\n            } catch (e) {\r\n                testLog(\"narration\", \"Narration fallback test error: \" + e.message, \"fail\");\r\n            }\r\n        }\r\n\r\n        //  Combat Tests \r\n        if (cats.includes(\"combat\")) {\r\n            testState.currentTest = \"Combat: dice, damage, game over\";\r\n            testLog(\"combat\", \"Testing combat mechanics...\");\r\n\r\n            // Test rollD20\r\n            let rolls = [];\r\n            for (let i = 0; i < 100; i++) rolls.push(engine.rollD20());\r\n            let minRoll = Math.min.apply(null, rolls);\r\n            let maxRoll = Math.max.apply(null, rolls);\r\n            if (minRoll >= 1 && maxRoll <= 20) {\r\n                testLog(\"combat\", \"rollD20: range [\" + minRoll + \",\" + maxRoll + \"] in 100 rolls\", \"pass\");\r\n            } else {\r\n                testLog(\"combat\", \"rollD20: out of range [\" + minRoll + \",\" + maxRoll + \"]\", \"fail\");\r\n            }\r\n\r\n            // Test checkGameOver\r\n            let savedGs = context.gameState;\r\n            let tempGs = { player: { hp: 5 }, opponent: { hp: 10 } };\r\n            if (window.CardGame.ctx) window.CardGame.ctx.gameState = tempGs;\r\n            if (engine.checkGameOver() === null) testLog(\"combat\", \"checkGameOver: no winner when both alive\", \"pass\");\r\n            else testLog(\"combat\", \"checkGameOver: false positive\", \"fail\");\r\n\r\n            tempGs.player.hp = 0;\r\n            if (engine.checkGameOver() === \"opponent\") testLog(\"combat\", \"checkGameOver: opponent wins when player HP=0\", \"pass\");\r\n            else testLog(\"combat\", \"checkGameOver: wrong winner for HP=0\", \"fail\");\r\n\r\n            tempGs.player.hp = 5;\r\n            tempGs.opponent.hp = -1;\r\n            if (engine.checkGameOver() === \"player\") testLog(\"combat\", \"checkGameOver: player wins when opponent HP<0\", \"pass\");\r\n            else testLog(\"combat\", \"checkGameOver: wrong winner for opponent HP<0\", \"fail\");\r\n            if (window.CardGame.ctx) window.CardGame.ctx.gameState = savedGs;\r\n\r\n            // Test getActorATK / getActorDEF\r\n            let testActor = { cardStack: [{ atk: 3 }, { def: 2 }, { atk: 1, def: 1 }] };\r\n            let totalAtk = engine.getActorATK(testActor);\r\n            let totalDef = engine.getActorDEF(testActor);\r\n            if (totalAtk === 4) testLog(\"combat\", \"getActorATK: 3+1=\" + totalAtk, \"pass\");\r\n            else testLog(\"combat\", \"getActorATK: expected 4, got \" + totalAtk, \"fail\");\r\n            if (totalDef === 3) testLog(\"combat\", \"getActorDEF: 2+1=\" + totalDef, \"pass\");\r\n            else testLog(\"combat\", \"getActorDEF: expected 3, got \" + totalDef, \"fail\");\r\n\r\n            // Test getStackSkillMod\r\n            let testStack = { modifiers: [\r\n                { type: \"skill\", modifier: \"+2 to Attack rolls\" },\r\n                { type: \"skill\", modifier: \"+3 to defense\" }\r\n            ] };\r\n            let atkMod = engine.getStackSkillMod(testStack, \"attack\");\r\n            let defMod = engine.getStackSkillMod(testStack, \"defense\");\r\n            if (atkMod === 2) testLog(\"combat\", \"getStackSkillMod(attack): +2\", \"pass\");\r\n            else testLog(\"combat\", \"getStackSkillMod(attack): expected 2, got \" + atkMod, \"fail\");\r\n            if (defMod === 3) testLog(\"combat\", \"getStackSkillMod(defense): +3\", \"pass\");\r\n            else testLog(\"combat\", \"getStackSkillMod(defense): expected 3, got \" + defMod, \"fail\");\r\n        }\r\n\r\n        //  Card Evaluation Tests \r\n        if (cats.includes(\"cards\")) {\r\n            testState.currentTest = \"Card Eval: unified effect parser\";\r\n            testLog(\"cards\", \"Testing unified parseEffect() engine...\");\r\n\r\n            // Test all supported effect patterns\r\n            let testEffects = [\r\n                { effect: \"Deal 15 fire damage\",            check: function(p) { return p.damage === 15; } },\r\n                { effect: \"Restore 30 HP\",                  check: function(p) { return p.healHp === 30; } },\r\n                { effect: \"Restore 25 Energy\",              check: function(p) { return p.restoreEnergy === 25; } },\r\n                { effect: \"Restore 10 Morale\",              check: function(p) { return p.restoreMorale === 10; } },\r\n                { effect: \"Heal 8\",                         check: function(p) { return p.healHp === 8; } },\r\n                { effect: \"Drain 12 health\",                check: function(p) { return p.damage === 12 && p.healHp === 12; } },\r\n                { effect: \"Draw 2 cards\",                   check: function(p) { return p.draw === 2; } },\r\n                { effect: \"Stun target for 1 turn\",         check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"stunned\"; }); } },\r\n                { effect: \"Poison enemy for 3 turns\",       check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"poisoned\"; }); } },\r\n                { effect: \"Shield self\",                    check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"shielded\" && s.target === \"self\"; }); } },\r\n                { effect: \"Enrage for bonus damage\",        check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"enraged\"; }); } },\r\n                { effect: \"Burn the enemy with fire\",       check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"burning\"; }); } },\r\n                { effect: \"Cause bleeding wounds\",          check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"bleeding\"; }); } },\r\n                { effect: \"Weaken enemy defenses\",          check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"weakened\"; }); } },\r\n                { effect: \"Fortify your defenses\",          check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"fortified\"; }); } },\r\n                { effect: \"Inspire allies to fight\",        check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"inspired\"; }); } },\r\n                { effect: \"Regenerate health over time\",    check: function(p) { return p.statusEffects?.some(function(s) { return s.id === \"regenerating\"; }); } },\r\n                { effect: \"Cleanse all poisons\",            check: function(p) { return p.cure === true; } },\r\n                { effect: \"Deal 20 and stun target\",        check: function(p) { return p.damage === 20 && p.statusEffects?.some(function(s) { return s.id === \"stunned\"; }); } },\r\n                { effect: \"Restore 5 HP and 3 Energy\",      check: function(p) { return p.healHp === 5 && p.restoreEnergy === 3; } }\r\n            ];\r\n\r\n            for (let t of testEffects) {\r\n                let parsed = engine.parseEffect(t.effect);\r\n                let ok = t.check(parsed);\r\n                testLog(\"cards\", \"parseEffect('\" + t.effect + \"') -> \" + JSON.stringify(parsed), ok ? \"pass\" : \"fail\");\r\n            }\r\n\r\n            // Test isEffectParseable\r\n            let parseableEffects = [\"Deal 10 damage\", \"Restore 5 HP\", \"Stun target\", \"Drain 8\"];\r\n            let unparseableEffects = [\"View opponent's next action\", \"+2 to Investigate rolls this round\", \"Attacks lowest HP character first\"];\r\n            for (let e of parseableEffects) {\r\n                testLog(\"cards\", \"isParseable('\" + e + \"')\", engine.isEffectParseable(e) ? \"pass\" : \"fail\");\r\n            }\r\n            for (let e of unparseableEffects) {\r\n                testLog(\"cards\", \"isNotParseable('\" + e + \"')\", !engine.isEffectParseable(e) ? \"pass\" : \"fail\");\r\n            }\r\n\r\n            // Test skill modifier parsing with expanded keywords\r\n            let skillTests = [\r\n                { mod: \"+2 to Attack rolls\", action: \"attack\", expect: 2 },\r\n                { mod: \"+3 to Defense\", action: \"defense\", expect: 3 },\r\n                { mod: \"+1 to social interactions\", action: \"talk\", expect: 1 },\r\n                { mod: \"+2 to melee strikes\", action: \"attack\", expect: 2 },\r\n                { mod: \"+2 to Flee and initiative rolls\", action: \"flee\", expect: 2 },\r\n                { mod: \"+1 to Investigate and Rest rolls\", action: \"investigate\", expect: 1 },\r\n                { mod: \"+2 to spell casting\", action: \"magic\", expect: 2 }\r\n            ];\r\n            for (let s of skillTests) {\r\n                let stack = { modifiers: [{ type: \"skill\", modifier: s.mod }] };\r\n                let result = engine.getStackSkillMod(stack, s.action);\r\n                testLog(\"cards\", \"SkillMod('\" + s.mod + \"', '\" + s.action + \"') = \" + result, result === s.expect ? \"pass\" : \"fail\");\r\n            }\r\n\r\n            // Analyze active theme card pool for gaps\r\n            let activeTheme = themes.activeTheme ? themes.activeTheme() : null;\r\n            if (activeTheme?.cardPool) {\r\n                let pool = activeTheme.cardPool;\r\n                let types = {};\r\n                (pool || []).forEach(function(c) { types[c.type] = (types[c.type] || 0) + 1; });\r\n                testLog(\"cards\", \"Theme '\" + activeTheme.name + \"' card pool: \" + JSON.stringify(types), \"info\");\r\n\r\n                // Check skills have valid modifier patterns\r\n                for (let sk of (pool || []).filter(function(c) { return c.type === \"skill\"; })) {\r\n                    let hasNumericMod = sk.modifier && sk.modifier.match(/\\+(\\d+)/);\r\n                    testLog(\"cards\", \"Skill '\" + sk.name + \"': \" + (sk.modifier || \"none\"), hasNumericMod ? \"pass\" : \"warn\");\r\n                }\r\n                // Check magic have parseable effects\r\n                for (let mg of (pool || []).filter(function(c) { return c.type === \"magic\"; })) {\r\n                    let parseable = engine.isEffectParseable(mg.effect);\r\n                    testLog(\"cards\", \"Magic '\" + mg.name + \"': \" + (mg.effect || \"\").substring(0, 50), parseable ? \"pass\" : \"warn\");\r\n                }\r\n                // Check consumables have parseable effects\r\n                for (let con of (pool || []).filter(function(c) { return c.type === \"item\" && c.subtype === \"consumable\"; })) {\r\n                    let parseable = engine.isEffectParseable(con.effect);\r\n                    testLog(\"cards\", \"Consumable '\" + con.name + \"': \" + (con.effect || \"\").substring(0, 50), parseable ? \"pass\" : \"warn\");\r\n                }\r\n            } else {\r\n                testLog(\"cards\", \"No active theme card pool loaded\", \"warn\");\r\n            }\r\n        }\r\n\r\n        //  Campaign Tests \r\n        if (cats.includes(\"campaign\")) {\r\n            testState.currentTest = \"Campaign: XP, levels, stat gains\";\r\n            testLog(\"campaign\", \"Testing campaign system...\");\r\n\r\n            // Test createCampaignData\r\n            let testChar = { name: \"TestHero\", sourceId: \"test-123\" };\r\n            let cd = storage.createCampaignData(testChar);\r\n            if (cd.level === 1 && cd.xp === 0 && cd.characterName === \"TestHero\") {\r\n                testLog(\"campaign\", \"createCampaignData defaults correct\", \"pass\");\r\n            } else {\r\n                testLog(\"campaign\", \"createCampaignData defaults wrong\", \"fail\");\r\n            }\r\n\r\n            // Test calculateXP\r\n            let testState1 = { round: 5, player: { hp: 15 } };\r\n            let xpWin = storage.calculateXP(testState1, true);\r\n            let xpLose = storage.calculateXP(testState1, false);\r\n            testLog(\"campaign\", \"calculateXP(5 rounds, 15hp, win)=\" + xpWin + \" (expect 130)\", xpWin === 130 ? \"pass\" : \"fail\");\r\n            testLog(\"campaign\", \"calculateXP(5 rounds, 15hp, loss)=\" + xpLose + \" (expect 80)\", xpLose === 80 ? \"pass\" : \"fail\");\r\n\r\n            // Test level calculation\r\n            let levels = [\r\n                { xp: 0, expect: 1 }, { xp: 99, expect: 1 }, { xp: 100, expect: 2 },\r\n                { xp: 250, expect: 3 }, { xp: 999, expect: 10 }, { xp: 1500, expect: 10 }\r\n            ];\r\n            for (let l of levels) {\r\n                let level = Math.min(10, Math.floor(l.xp / 100) + 1);\r\n                testLog(\"campaign\", \"XP \" + l.xp + \" -> Level \" + level + \" (expect \" + l.expect + \")\", level === l.expect ? \"pass\" : \"fail\");\r\n            }\r\n\r\n            // Test applyCampaignBonuses\r\n            let testGsState = {\r\n                player: {\r\n                    character: { stats: { STR: 10, AGI: 10, END: 15, INT: 10, MAG: 12, CHA: 10 } },\r\n                    ap: 4, maxAp: 4, energy: 12, maxEnergy: 12\r\n                }\r\n            };\r\n            let testCampaign = { statGains: { STR: 2, END: 5 } };\r\n            storage.applyCampaignBonuses(testGsState, testCampaign);\r\n            if (testGsState.player.character.stats.STR === 12 && testGsState.player.character.stats.END === 20) {\r\n                testLog(\"campaign\", \"applyCampaignBonuses: stats applied (STR 10->12, END 15->20)\", \"pass\");\r\n            } else {\r\n                testLog(\"campaign\", \"applyCampaignBonuses: stats wrong\", \"fail\");\r\n            }\r\n            // END=20 -> AP = floor(20/5)+1 = 5\r\n            if (testGsState.player.ap === 5) {\r\n                testLog(\"campaign\", \"applyCampaignBonuses: AP recalculated (END 20 -> AP 5)\", \"pass\");\r\n            } else {\r\n                testLog(\"campaign\", \"applyCampaignBonuses: AP not recalculated (got \" + testGsState.player.ap + \")\", \"fail\");\r\n            }\r\n        }\r\n\r\n        //  Character Stats & Integration Tests \r\n        if (cats.includes(\"cards\")) {\r\n            testState.currentTest = \"Integration: character stats, effects, save/load\";\r\n            testLog(\"cards\", \"Testing character stats from deck...\");\r\n\r\n            // Use the resolved deck for character stat validation\r\n            let charTestDecks = [];\r\n            if (resolvedDeck?.cards) {\r\n                charTestDecks.push({ name: resolvedDeck.deckName || resolvedDeckName, deck: resolvedDeck });\r\n            } else {\r\n                // Fallback: load available decks\r\n                let deckNames2 = await storage.deckStorage.list();\r\n                for (let dn of deckNames2.slice(0, 3)) {\r\n                    let d = await storage.deckStorage.load(dn);\r\n                    if (d?.cards) charTestDecks.push({ name: dn, deck: d });\r\n                }\r\n            }\r\n            for (let entry of charTestDecks) {\r\n                let dn = entry.name;\r\n                let deck = entry.deck;\r\n                let chars = (deck.cards || []).filter(function(c) { return c.type === \"character\"; });\r\n                if (chars.length === 0) {\r\n                    testLog(\"cards\", \"Deck '\" + dn + \"': no character cards\", \"warn\");\r\n                    continue;\r\n                }\r\n                for (let ch of chars) {\r\n                    let stats = ch.stats || {};\r\n                    let hasCore = [\"STR\", \"AGI\", \"END\", \"INT\", \"MAG\", \"CHA\"].filter(function(s) { return stats[s] !== undefined; });\r\n                    testLog(\"cards\", \"Char '\" + ch.name + \"': \" + hasCore.length + \"/6 core stats (\" + hasCore.join(\",\") + \")\",\r\n                        hasCore.length >= 4 ? \"pass\" : \"warn\");\r\n\r\n                    // Validate stat ranges (should be 1-30 for reasonable gameplay)\r\n                    let outOfRange = hasCore.filter(function(s) { return stats[s] < 1 || stats[s] > 30; });\r\n                    if (outOfRange.length > 0) {\r\n                        testLog(\"cards\", \"Char '\" + ch.name + \"': stats out of range [1-30]: \" + outOfRange.map(function(s) { return s + \"=\" + stats[s]; }).join(\", \"), \"warn\");\r\n                    } else if (hasCore.length > 0) {\r\n                        testLog(\"cards\", \"Char '\" + ch.name + \"': all stats in valid range\", \"pass\");\r\n                    }\r\n\r\n                    // Test createGameState with this deck (stats should not persist/mutate)\r\n                    if (gameState.createGameState) {\r\n                        let statsBefore = JSON.stringify(ch.stats);\r\n                        let gs = gameState.createGameState(deck, ch);\r\n                        let statsAfter = JSON.stringify(ch.stats);\r\n                        if (gs) {\r\n                            if (statsBefore === statsAfter) {\r\n                                testLog(\"cards\", \"createGameState: '\" + ch.name + \"' stats not mutated\", \"pass\");\r\n                            } else {\r\n                                testLog(\"cards\", \"createGameState: '\" + ch.name + \"' stats MUTATED (should not persist)\", \"fail\");\r\n                            }\r\n                            // Validate derived values\r\n                            let playerEnd = gs.player.character.stats?.END || 12;\r\n                            let expectedAp = Math.max(2, Math.floor(playerEnd / 5) + 1);\r\n                            if (gs.player.ap === expectedAp) {\r\n                                testLog(\"cards\", \"AP derived correctly: END=\" + playerEnd + \" -> AP=\" + gs.player.ap, \"pass\");\r\n                            } else {\r\n                                testLog(\"cards\", \"AP mismatch: END=\" + playerEnd + \" -> expected AP=\" + expectedAp + \" got \" + gs.player.ap, \"fail\");\r\n                            }\r\n                            // Validate hand dealt (5 base + 1 Attack card added by design = 6)\r\n                            if (gs.player.hand.length >= 5 && gs.player.hand.length <= 7) {\r\n                                let hasAttack = gs.player.hand.some(function(c) { return c.name === \"Attack\" || c.type === \"attack\"; });\r\n                                testLog(\"cards\", \"Initial hand: \" + gs.player.hand.length + \" cards\" + (hasAttack ? \" (includes Attack)\" : \"\"), \"pass\");\r\n                            } else {\r\n                                testLog(\"cards\", \"Initial hand unexpected size: \" + gs.player.hand.length + \" (expected 5-7)\", \"fail\");\r\n                            }\r\n                        } else {\r\n                            testLog(\"cards\", \"createGameState returned null for '\" + ch.name + \"'\", \"fail\");\r\n                        }\r\n                    } else {\r\n                        testLog(\"cards\", \"createGameState not available (module not yet extracted)\", \"warn\");\r\n                    }\r\n                }\r\n            }\r\n\r\n            //  Integration: applyParsedEffects \r\n            testLog(\"cards\", \"Testing applyParsedEffects integration...\");\r\n            let testOwner = { hp: 20, maxHp: 25, energy: 10, maxEnergy: 15, morale: 15, maxMorale: 20, hand: [], drawPile: [{ name: \"TestCard\" }], discardPile: [], statusEffects: [] };\r\n            let testTarget = { hp: 20, maxHp: 20, statusEffects: [] };\r\n\r\n            // Test damage\r\n            let dmgParsed = engine.parseEffect(\"Deal 8 damage\");\r\n            engine.applyParsedEffects(dmgParsed, testOwner, testTarget, \"TestSpell\");\r\n            testLog(\"cards\", \"applyParsedEffects(Deal 8): target HP 20->\" + testTarget.hp, testTarget.hp === 12 ? \"pass\" : \"fail\");\r\n\r\n            // Test heal\r\n            testOwner.hp = 15;\r\n            let healParsed = engine.parseEffect(\"Restore 7 HP\");\r\n            engine.applyParsedEffects(healParsed, testOwner, testTarget, \"HealSpell\");\r\n            testLog(\"cards\", \"applyParsedEffects(Restore 7 HP): owner HP 15->\" + testOwner.hp, testOwner.hp === 22 ? \"pass\" : \"fail\");\r\n\r\n            // Test heal capped at max\r\n            testOwner.hp = 24;\r\n            engine.applyParsedEffects(engine.parseEffect(\"Heal 10\"), testOwner, testTarget, \"BigHeal\");\r\n            testLog(\"cards\", \"applyParsedEffects(Heal 10): capped at maxHp \" + testOwner.maxHp + \" -> \" + testOwner.hp, testOwner.hp === 25 ? \"pass\" : \"fail\");\r\n\r\n            // Test drain (damage + self-heal)\r\n            testOwner.hp = 15;\r\n            testTarget.hp = 20;\r\n            engine.applyParsedEffects(engine.parseEffect(\"Drain 6\"), testOwner, testTarget, \"DrainSpell\");\r\n            testLog(\"cards\", \"applyParsedEffects(Drain 6): target HP \" + testTarget.hp + \", owner HP \" + testOwner.hp,\r\n                testTarget.hp === 14 && testOwner.hp === 21 ? \"pass\" : \"fail\");\r\n\r\n            // Test energy/morale restore\r\n            testOwner.energy = 5;\r\n            testOwner.morale = 10;\r\n            engine.applyParsedEffects(engine.parseEffect(\"Restore 4 Energy\"), testOwner, testTarget, \"E\");\r\n            engine.applyParsedEffects(engine.parseEffect(\"Restore 3 Morale\"), testOwner, testTarget, \"M\");\r\n            testLog(\"cards\", \"Energy 5->\" + testOwner.energy + \", Morale 10->\" + testOwner.morale,\r\n                testOwner.energy === 9 && testOwner.morale === 13 ? \"pass\" : \"fail\");\r\n\r\n            // Test draw cards\r\n            testOwner.hand = [];\r\n            testOwner.drawPile = [{ name: \"A\" }, { name: \"B\" }, { name: \"C\" }];\r\n            engine.applyParsedEffects(engine.parseEffect(\"Draw 2 cards\"), testOwner, testTarget, \"DrawSpell\");\r\n            testLog(\"cards\", \"applyParsedEffects(Draw 2): hand=\" + testOwner.hand.length + \" drawPile=\" + testOwner.drawPile.length,\r\n                testOwner.hand.length === 2 && testOwner.drawPile.length === 1 ? \"pass\" : \"fail\");\r\n\r\n            // Test status effect application\r\n            testTarget.statusEffects = [];\r\n            engine.applyParsedEffects(engine.parseEffect(\"Stun target\"), testOwner, testTarget, \"StunCard\");\r\n            let hasStun = testTarget.statusEffects.some(function(e) { return e.id === \"stunned\"; });\r\n            testLog(\"cards\", \"applyParsedEffects(Stun): target has stunned=\" + hasStun, hasStun ? \"pass\" : \"fail\");\r\n\r\n            testOwner.statusEffects = [];\r\n            engine.applyParsedEffects(engine.parseEffect(\"Shield self\"), testOwner, testTarget, \"ShieldCard\");\r\n            let hasShield = testOwner.statusEffects.some(function(e) { return e.id === \"shielded\"; });\r\n            testLog(\"cards\", \"applyParsedEffects(Shield): owner has shielded=\" + hasShield, hasShield ? \"pass\" : \"fail\");\r\n\r\n            // Test cure removes negatives\r\n            testOwner.statusEffects = [];\r\n            engine.applyStatusEffect(testOwner, \"poisoned\", \"test\");\r\n            engine.applyStatusEffect(testOwner, \"burning\", \"test\");\r\n            engine.applyStatusEffect(testOwner, \"shielded\", \"test\");  // positive -- should NOT be removed\r\n            let beforeCure = testOwner.statusEffects.length;\r\n            engine.applyParsedEffects(engine.parseEffect(\"Cleanse all\"), testOwner, testTarget, \"CureSpell\");\r\n            let afterCure = testOwner.statusEffects.length;\r\n            let keptShield = testOwner.statusEffects.some(function(e) { return e.id === \"shielded\"; });\r\n            testLog(\"cards\", \"Cure: \" + beforeCure + \" effects -> \" + afterCure + \" (shield kept=\" + keptShield + \")\",\r\n                afterCure === 1 && keptShield ? \"pass\" : \"fail\");\r\n\r\n            // Test combo effect\r\n            testTarget.hp = 20;\r\n            testTarget.statusEffects = [];\r\n            engine.applyParsedEffects(engine.parseEffect(\"Deal 10 and poison target\"), testOwner, testTarget, \"Combo\");\r\n            let comboOk = testTarget.hp === 10 && testTarget.statusEffects.some(function(e) { return e.id === \"poisoned\"; });\r\n            testLog(\"cards\", \"Combo(Deal 10 + poison): HP=\" + testTarget.hp + \" poisoned=\" + comboOk, comboOk ? \"pass\" : \"fail\");\r\n\r\n            //  Integration: status effect lifecycle \r\n            testLog(\"cards\", \"Testing status effect lifecycle...\");\r\n            let lifecycleActor = { hp: 20, maxHp: 20, statusEffects: [] };\r\n            engine.applyStatusEffect(lifecycleActor, \"poisoned\", \"TestPoison\");\r\n            if (lifecycleActor.statusEffects.length === 1 && lifecycleActor.statusEffects[0].turnsRemaining === 3) {\r\n                testLog(\"cards\", \"Poisoned applied: duration=3\", \"pass\");\r\n            } else {\r\n                testLog(\"cards\", \"Poisoned not applied correctly\", \"fail\");\r\n            }\r\n            // Re-apply should refresh duration, not stack\r\n            lifecycleActor.statusEffects[0].turnsRemaining = 1;\r\n            engine.applyStatusEffect(lifecycleActor, \"poisoned\", \"RefreshPoison\");\r\n            if (lifecycleActor.statusEffects.length === 1 && lifecycleActor.statusEffects[0].turnsRemaining === 3) {\r\n                testLog(\"cards\", \"Re-apply refreshes duration (1->3), no stack\", \"pass\");\r\n            } else {\r\n                testLog(\"cards\", \"Re-apply stacking/duration wrong: count=\" + lifecycleActor.statusEffects.length, \"fail\");\r\n            }\r\n            // Remove\r\n            engine.removeStatusEffect(lifecycleActor, \"poisoned\");\r\n            testLog(\"cards\", \"removeStatusEffect: \" + lifecycleActor.statusEffects.length + \" remaining\",\r\n                lifecycleActor.statusEffects.length === 0 ? \"pass\" : \"fail\");\r\n\r\n            // Status modifier calculation\r\n            let modActor = { statusEffects: [] };\r\n            engine.applyStatusEffect(modActor, \"enraged\", \"test\");\r\n            engine.applyStatusEffect(modActor, \"shielded\", \"test\");\r\n            let mods = engine.getStatusModifiers(modActor);\r\n            testLog(\"cards\", \"StatusMods(enraged+shielded): atk=\" + mods.atk + \" def=\" + mods.def,\r\n                mods.atk === 3 && mods.def === 1 ? \"pass\" : \"fail\");  // enraged +3 ATK -2 DEF, shielded +3 DEF = net +1 DEF\r\n        }\r\n\r\n        //  Extended Save/Load Tests \r\n        if (cats.includes(\"storage\")) {\r\n            testState.currentTest = \"Storage: save/load field completeness\";\r\n            testLog(\"storage\", \"Testing save/load field preservation...\");\r\n            {\r\n                let deck = resolvedDeck;\r\n                let saveDeckName = resolvedDeckName || \"test\";\r\n                if (deck && gameState.createGameState) {\r\n                    let gs = gameState.createGameState(deck);\r\n                    if (gs) {\r\n                        // Set up recognizable state\r\n                        gs.round = 7;\r\n                        gs.player.hp = 13;\r\n                        gs.player.energy = 4;\r\n                        gs.player.morale = 11;\r\n                        gs.opponent.hp = 8;\r\n                        let origHandLen = gs.player.hand.length;\r\n                        let origRound = gs.round;\r\n                        let origOppHp = gs.opponent.hp;\r\n                        let origPhase = gs.phase;\r\n\r\n                        let saved = await storage.gameStorage.save(saveDeckName + \"__test\", gs);\r\n                        if (saved) {\r\n                            let loaded = await storage.gameStorage.load(saveDeckName + \"__test\");\r\n                            if (loaded?.gameState) {\r\n                                let ls = loaded.gameState;\r\n                                let checks = [\r\n                                    [\"round\", ls.round === origRound],\r\n                                    [\"phase\", ls.phase === origPhase],\r\n                                    [\"player.hp\", ls.player?.hp === 13],\r\n                                    [\"player.energy\", ls.player?.energy === 4],\r\n                                    [\"player.morale\", ls.player?.morale === 11],\r\n                                    [\"player.hand.length\", ls.player?.hand?.length === origHandLen],\r\n                                    [\"opponent.hp\", ls.opponent?.hp === origOppHp],\r\n                                    [\"player.ap\", ls.player?.ap === gs.player.ap],\r\n                                    [\"player.drawPile\", Array.isArray(ls.player?.drawPile)],\r\n                                    [\"player.discardPile\", Array.isArray(ls.player?.discardPile)],\r\n                                    [\"player.statusEffects\", Array.isArray(ls.player?.statusEffects)]\r\n                                ];\r\n                                let allOk = true;\r\n                                for (let pair of checks) {\r\n                                    let field = pair[0];\r\n                                    let ok = pair[1];\r\n                                    if (!ok) { testLog(\"storage\", \"Save/load field LOST: \" + field, \"fail\"); allOk = false; }\r\n                                }\r\n                                if (allOk) testLog(\"storage\", \"Save/load: all \" + checks.length + \" fields preserved\", \"pass\");\r\n                            } else {\r\n                                testLog(\"storage\", \"Save/load: loaded.gameState is null\", \"fail\");\r\n                            }\r\n                            await storage.gameStorage.deleteAll(saveDeckName + \"__test\");\r\n                        } else {\r\n                            testLog(\"storage\", \"Save/load: save returned null\", \"fail\");\r\n                        }\r\n                    }\r\n                } else if (!gameState.createGameState) {\r\n                    testLog(\"storage\", \"createGameState not available (module not yet extracted)\", \"warn\");\r\n                }\r\n            }\r\n        }\r\n\r\n        //  LLM Tests \r\n        if (cats.includes(\"llm\")) {\r\n            testState.currentTest = \"LLM: connectivity and chat\";\r\n            testLog(\"llm\", \"Testing LLM connectivity...\");\r\n\r\n            try {\r\n                let checkLlmConnectivity = ai.checkLlmConnectivity || gameState.checkLlmConnectivity;\r\n                let llmStatus = ai.llmStatus || gameState.state.llmStatus || { checked: false, available: false };\r\n                let CardGameLLM = ai.CardGameLLM;\r\n                let CardGameNarrator = ai.CardGameNarrator;\r\n\r\n                if (checkLlmConnectivity) {\r\n                    await checkLlmConnectivity();\r\n                    llmStatus = ai.llmStatus || gameState.state.llmStatus || llmStatus;\r\n                    testLog(\"llm\", \"LLM status: available=\" + llmStatus.available + \", checked=\" + llmStatus.checked, llmStatus.available ? \"pass\" : \"warn\");\r\n\r\n                    if (llmStatus.available) {\r\n                        testLog(\"llm\", \"LLM endpoint reachable\", \"pass\");\r\n\r\n                        // Test CardGameLLM base class\r\n                        testLog(\"llm\", \"CardGameLLM.findChatDir()...\");\r\n                        try {\r\n                            let chatDir = await CardGameLLM.findChatDir();\r\n                            testLog(\"llm\", \"Chat directory: \" + (chatDir ? chatDir.path || chatDir.name : \"not found\"), chatDir ? \"pass\" : \"warn\");\r\n                        } catch (e) {\r\n                            testLog(\"llm\", \"findChatDir error: \" + e.message, \"warn\");\r\n                        }\r\n\r\n                        // Actual LLM chat test\r\n                        testState.currentTest = \"LLM: actual chat test\";\r\n                        testLog(\"llm\", \"Initializing test LLM instance...\");\r\n                        try {\r\n                            let testLlm = new CardGameLLM();\r\n                            let initOk = await testLlm.initializeLLM(\r\n                                \"CardGame Test Chat\",\r\n                                \"CardGame Test Prompt\",\r\n                                \"You are a helpful test assistant for a card game. Respond briefly.\",\r\n                                0.3\r\n                            );\r\n                            testLog(\"llm\", \"LLM init: \" + (initOk ? \"success\" : \"failed -- \" + (testLlm.lastError || \"unknown\")), initOk ? \"pass\" : \"warn\");\r\n\r\n                            if (initOk) {\r\n                                // Send a simple test prompt\r\n                                testLog(\"llm\", \"Sending test prompt to LLM...\");\r\n                                let response = await testLlm.chat(\"Say exactly: TEST_OK\");\r\n                                let content = CardGameLLM.extractContent(response);\r\n                                testLog(\"llm\", \"LLM raw response: \" + JSON.stringify(response)?.substring(0, 200), \"info\");\r\n                                testLog(\"llm\", \"LLM extracted content: \" + (content || \"(empty)\").substring(0, 150), content ? \"pass\" : \"fail\");\r\n\r\n                                // Test narrator initialization\r\n                                testState.currentTest = \"LLM: narrator test\";\r\n                                testLog(\"llm\", \"Testing CardGameNarrator...\");\r\n                                let testNarrator = new CardGameNarrator();\r\n                                let themeId = resolvedDeck?.themeId || (themes.activeTheme ? themes.activeTheme()?.themeId : null) || \"high-fantasy\";\r\n                                let narratorOk = await testNarrator.initialize(\"arena-announcer\", themeId);\r\n                                testLog(\"llm\", \"Narrator init (\" + themeId + \"): \" + (narratorOk ? \"success\" : \"failed -- \" + (testNarrator.lastError || \"unknown\")), narratorOk ? \"pass\" : \"warn\");\r\n\r\n                                if (narratorOk) {\r\n                                    // Test game_start narration\r\n                                    testLog(\"llm\", \"Requesting game_start narration...\");\r\n                                    let narration = await testNarrator.narrate(\"game_start\", {\r\n                                        playerName: \"Test Hero\",\r\n                                        opponentName: \"Test Villain\"\r\n                                    });\r\n                                    testLog(\"llm\", \"Narration text: \" + (narration?.text || \"(empty)\").substring(0, 200), narration?.text ? \"pass\" : \"fail\");\r\n                                    if (narration?.imagePrompt) {\r\n                                        testLog(\"llm\", \"Narration IMAGE prompt: \" + narration.imagePrompt.substring(0, 150), \"info\");\r\n                                    }\r\n\r\n                                    // Test resolution narration\r\n                                    testLog(\"llm\", \"Requesting resolution narration...\");\r\n                                    let resNarration = await testNarrator.narrate(\"resolution\", {\r\n                                        playerStack: \"Fireball (magic, Deal 15 fire damage)\",\r\n                                        playerRoll: { raw: 18, total: 25 },\r\n                                        opponentStack: \"Shield Block (defense)\",\r\n                                        opponentRoll: { raw: 8, total: 15 },\r\n                                        isPlayerAttack: true,\r\n                                        outcome: \"HIT\",\r\n                                        damage: 10\r\n                                    });\r\n                                    testLog(\"llm\", \"Resolution narration: \" + (resNarration?.text || \"(empty)\").substring(0, 200), resNarration?.text ? \"pass\" : \"warn\");\r\n                                }\r\n\r\n                                // Test JSON cleaning utility\r\n                                let jsonTestInput = \"```json\\n{\\\"name\\\": \\\"Test\\\"}\\n```\";\r\n                                let cleaned = CardGameLLM.cleanJsonResponse(jsonTestInput);\r\n                                try {\r\n                                    let parsed = JSON.parse(cleaned);\r\n                                    testLog(\"llm\", \"cleanJsonResponse: parsed OK -- \" + JSON.stringify(parsed), \"pass\");\r\n                                } catch (e) {\r\n                                    testLog(\"llm\", \"cleanJsonResponse: parse failed -- \" + cleaned, \"fail\");\r\n                                }\r\n                            }\r\n                        } catch (e) {\r\n                            testLog(\"llm\", \"LLM chat test error: \" + e.message, \"fail\");\r\n                        }\r\n                    } else {\r\n                        testLog(\"llm\", \"LLM not available -- remaining LLM tests skipped (defaults/fallbacks will be used at runtime)\", \"info\");\r\n                    }\r\n                } else {\r\n                    testLog(\"llm\", \"checkLlmConnectivity not available (module not yet extracted)\", \"warn\");\r\n                }\r\n            } catch (e) {\r\n                testLog(\"llm\", \"LLM connectivity error: \" + e.message, \"fail\");\r\n            }\r\n        }\r\n\r\n        //  Voice Tests \r\n        if (cats.includes(\"voice\")) {\r\n            testState.currentTest = \"Voice: synthesis pipeline\";\r\n            testLog(\"voice\", \"Testing voice system...\");\r\n\r\n            let CardGameVoice = ai.CardGameVoice;\r\n            if (!CardGameVoice) {\r\n                testLog(\"voice\", \"CardGameVoice not available (module not yet extracted)\", \"warn\");\r\n            } else {\r\n                let hasAudio = typeof page?.components?.audio?.createAudioSource === \"function\";\r\n                testLog(\"voice\", \"Audio infrastructure: \" + (hasAudio ? \"present\" : \"absent\"), \"info\");\r\n\r\n                // Test 1: subtitlesOnly mode (should work regardless of audio)\r\n                let testVoice1 = new CardGameVoice();\r\n                await testVoice1.initialize({ subtitlesOnly: true });\r\n                if (testVoice1.subtitlesOnly && testVoice1.enabled) {\r\n                    testLog(\"voice\", \"subtitlesOnly init: enabled=\" + testVoice1.enabled + \" subtitlesOnly=\" + testVoice1.subtitlesOnly, \"pass\");\r\n                } else {\r\n                    testLog(\"voice\", \"subtitlesOnly init: unexpected state enabled=\" + testVoice1.enabled + \" subtitlesOnly=\" + testVoice1.subtitlesOnly, \"fail\");\r\n                }\r\n\r\n                // Test 2: speak() in subtitlesOnly mode shows subtitle\r\n                let savedGs = context.gameState;\r\n                let tempGs = { narrationText: null, narrationTime: null };\r\n                if (window.CardGame.ctx) window.CardGame.ctx.gameState = tempGs;\r\n                await testVoice1.speak(\"Voice test subtitle text\");\r\n                let gs = window.CardGame.ctx?.gameState || tempGs;\r\n                if (gs.narrationText === \"Voice test subtitle text\") {\r\n                    testLog(\"voice\", \"speak() in subtitlesOnly mode -> subtitle displayed\", \"pass\");\r\n                } else {\r\n                    testLog(\"voice\", \"speak() in subtitlesOnly mode -> subtitle NOT displayed (narrationText=\" + gs.narrationText + \")\", \"fail\");\r\n                }\r\n                gs.narrationText = null;\r\n                if (window.CardGame.ctx) window.CardGame.ctx.gameState = savedGs;\r\n\r\n                // Test 3: Volume control\r\n                testVoice1.setVolume(0.5);\r\n                testLog(\"voice\", \"setVolume(0.5) -> volume=\" + testVoice1.volume, testVoice1.volume === 0.5 ? \"pass\" : \"fail\");\r\n                testVoice1.setVolume(-1);\r\n                testLog(\"voice\", \"setVolume(-1) -> clamped to \" + testVoice1.volume, testVoice1.volume === 0 ? \"pass\" : \"fail\");\r\n                testVoice1.setVolume(5);\r\n                testLog(\"voice\", \"setVolume(5) -> clamped to \" + testVoice1.volume, testVoice1.volume === 1 ? \"pass\" : \"fail\");\r\n\r\n                // Test 4: Queue and stop\r\n                testVoice1.queue = [{ text: \"a\" }, { text: \"b\" }];\r\n                testVoice1.stop();\r\n                testLog(\"voice\", \"stop() clears queue: \" + testVoice1.queue.length + \" items\", testVoice1.queue.length === 0 ? \"pass\" : \"fail\");\r\n\r\n                // Test 5: Full voice mode (if audio infrastructure available)\r\n                if (hasAudio) {\r\n                    testState.currentTest = \"Voice: audio synthesis\";\r\n                    let testVoice2 = new CardGameVoice();\r\n                    await testVoice2.initialize({ subtitlesOnly: false, volume: 0.7 });\r\n                    testLog(\"voice\", \"Full voice init: subtitlesOnly=\" + testVoice2.subtitlesOnly + \" volume=\" + testVoice2.volume, !testVoice2.subtitlesOnly ? \"pass\" : \"warn\");\r\n\r\n                    // Actually try to generate speech\r\n                    try {\r\n                        testLog(\"voice\", \"Attempting TTS: 'Testing voice synthesis'...\");\r\n                        await testVoice2.speak(\"Testing voice synthesis\");\r\n                        testLog(\"voice\", \"TTS speak() completed without error\", \"pass\");\r\n                    } catch (e) {\r\n                        testLog(\"voice\", \"TTS speak() error: \" + e.message, \"fail\");\r\n                    }\r\n                } else {\r\n                    testLog(\"voice\", \"No audio infrastructure -- full voice test skipped (subtitlesOnly fallback verified above)\", \"info\");\r\n                }\r\n            }\r\n        }\r\n\r\n        //  Game Config Toggle Tests \r\n        // Test initializeLLMComponents with both enable/disable states\r\n        if (cats.includes(\"llm\") || cats.includes(\"voice\")) {\r\n            testState.currentTest = \"Config: enable/disable states\";\r\n            testLog(\"llm\", \"Testing game config enable/disable states...\");\r\n\r\n            let initializeLLMComponents = gameState.initializeLLMComponents || ai.initializeLLMComponents;\r\n            let CardGameVoice = ai.CardGameVoice;\r\n            let llmStatus = ai.llmStatus || gameState.state.llmStatus || { checked: false, available: false };\r\n\r\n            if (resolvedDeck && initializeLLMComponents) {\r\n                // Save/restore actual game globals\r\n                let savedNarrator = gameState.state.gameNarrator || null;\r\n                let savedDirector = gameState.state.gameDirector || null;\r\n                let savedChatMgr = gameState.state.gameChatManager || null;\r\n                let savedVoice = gameState.state.gameVoice || null;\r\n                let savedAnnVoice = gameState.state.gameAnnouncerVoice || null;\r\n                let savedGs = context.gameState;\r\n\r\n                // Create a temporary game state for the tests\r\n                let testGs = gameState.createGameState ? gameState.createGameState(resolvedDeck) : null;\r\n                if (testGs) {\r\n                    if (window.CardGame.ctx) window.CardGame.ctx.gameState = testGs;\r\n\r\n                    //  Test 1: Everything DISABLED \r\n                    testLog(\"llm\", \"Config test: all disabled...\");\r\n                    let disabledDeck = JSON.parse(JSON.stringify(resolvedDeck));\r\n                    disabledDeck.gameConfig = {\r\n                        narrationEnabled: false,\r\n                        opponentVoiceEnabled: false,\r\n                        announcerEnabled: false,\r\n                        announcerVoiceEnabled: false\r\n                    };\r\n                    await initializeLLMComponents(testGs, disabledDeck);\r\n\r\n                    let gameNarrator = gameState.state.gameNarrator || null;\r\n                    let gameChatManager = gameState.state.gameChatManager || null;\r\n                    let gameVoice = gameState.state.gameVoice || null;\r\n                    let gameAnnouncerVoice = gameState.state.gameAnnouncerVoice || null;\r\n\r\n                    testLog(\"llm\", \"narration=off -> gameNarrator=\" + (gameNarrator === null ? \"null\" : \"active\"),\r\n                        gameNarrator === null ? \"pass\" : \"fail\");\r\n                    testLog(\"llm\", \"narration=off -> gameChatManager=\" + (gameChatManager === null ? \"null\" : \"active\"),\r\n                        gameChatManager === null ? \"pass\" : \"fail\");\r\n                    testLog(\"voice\", \"oppVoice=off -> subtitlesOnly=\" + gameVoice?.subtitlesOnly,\r\n                        gameVoice?.subtitlesOnly === true ? \"pass\" : \"fail\");\r\n                    testLog(\"voice\", \"announcer=off -> gameAnnouncerVoice=\" + (gameAnnouncerVoice === null ? \"null\" : \"active\"),\r\n                        gameAnnouncerVoice === null ? \"pass\" : \"fail\");\r\n\r\n                    //  Test 2: Everything ENABLED \r\n                    testLog(\"llm\", \"Config test: all enabled...\");\r\n                    let enabledDeck = JSON.parse(JSON.stringify(resolvedDeck));\r\n                    enabledDeck.gameConfig = {\r\n                        narrationEnabled: true,\r\n                        opponentVoiceEnabled: true,\r\n                        announcerEnabled: true,\r\n                        announcerVoiceEnabled: true,\r\n                        announcerProfile: \"dungeon-master\"\r\n                    };\r\n                    await initializeLLMComponents(testGs, enabledDeck);\r\n\r\n                    gameNarrator = gameState.state.gameNarrator || null;\r\n                    gameChatManager = gameState.state.gameChatManager || null;\r\n                    gameVoice = gameState.state.gameVoice || null;\r\n                    gameAnnouncerVoice = gameState.state.gameAnnouncerVoice || null;\r\n\r\n                    if (llmStatus.available) {\r\n                        testLog(\"llm\", \"narration=on -> gameNarrator=\" + (gameNarrator ? \"active (\" + (gameNarrator.profile || \"?\") + \")\" : \"null (LLM init may have failed)\"),\r\n                            gameNarrator ? \"pass\" : \"warn\");\r\n                        testLog(\"llm\", \"narration=on -> gameChatManager=\" + (gameChatManager ? \"active\" : \"null (LLM init may have failed)\"),\r\n                            gameChatManager ? \"pass\" : \"warn\");\r\n                        testLog(\"llm\", \"announcer profile: \" + (gameNarrator?.profile || \"not set\"),\r\n                            gameNarrator?.profile === \"dungeon-master\" ? \"pass\" : \"warn\");\r\n                    } else {\r\n                        testLog(\"llm\", \"LLM unavailable -- narrator/chat would use fallbacks at runtime\", \"info\");\r\n                    }\r\n                    testLog(\"voice\", \"oppVoice=on -> subtitlesOnly=\" + gameVoice?.subtitlesOnly,\r\n                        gameVoice?.subtitlesOnly === false ? \"pass\" : \"warn\");\r\n                    testLog(\"voice\", \"announcer voice=on -> gameAnnouncerVoice=\" + (gameAnnouncerVoice ? \"active\" : \"null\"),\r\n                        gameAnnouncerVoice ? \"pass\" : \"warn\");\r\n                    if (gameAnnouncerVoice) {\r\n                        testLog(\"voice\", \"announcer voice subtitlesOnly=\" + gameAnnouncerVoice.subtitlesOnly,\r\n                            gameAnnouncerVoice.subtitlesOnly === false ? \"pass\" : \"fail\");\r\n                    }\r\n\r\n                    //  Test 3: Mixed -- announcer on but voice off \r\n                    testLog(\"llm\", \"Config test: announcer on, voice off...\");\r\n                    let mixedDeck = JSON.parse(JSON.stringify(resolvedDeck));\r\n                    mixedDeck.gameConfig = {\r\n                        narrationEnabled: true,\r\n                        opponentVoiceEnabled: false,\r\n                        announcerEnabled: true,\r\n                        announcerVoiceEnabled: false,\r\n                        announcerProfile: \"war-correspondent\"\r\n                    };\r\n                    await initializeLLMComponents(testGs, mixedDeck);\r\n\r\n                    gameVoice = gameState.state.gameVoice || null;\r\n                    gameAnnouncerVoice = gameState.state.gameAnnouncerVoice || null;\r\n                    gameNarrator = gameState.state.gameNarrator || null;\r\n\r\n                    testLog(\"voice\", \"oppVoice=off, annVoice=off -> opp subtitlesOnly=\" + gameVoice?.subtitlesOnly,\r\n                        gameVoice?.subtitlesOnly === true ? \"pass\" : \"fail\");\r\n                    testLog(\"voice\", \"annVoice=off -> gameAnnouncerVoice=\" + (gameAnnouncerVoice === null ? \"null\" : \"active\"),\r\n                        gameAnnouncerVoice === null ? \"pass\" : \"fail\");\r\n                    if (llmStatus.available && gameNarrator) {\r\n                        testLog(\"llm\", \"announcer profile: \" + (gameNarrator.profile || \"not set\"),\r\n                            gameNarrator.profile === \"war-correspondent\" ? \"pass\" : \"warn\");\r\n                    }\r\n\r\n                    //  Test 4: Deck's actual saved config \r\n                    let deckGc = resolvedDeck.gameConfig;\r\n                    if (deckGc && Object.keys(deckGc).length > 0) {\r\n                        testLog(\"llm\", \"Config test: deck's saved config...\");\r\n                        testLog(\"llm\", \"Deck gameConfig: \" + JSON.stringify(deckGc), \"info\");\r\n                        await initializeLLMComponents(testGs, resolvedDeck);\r\n\r\n                        gameNarrator = gameState.state.gameNarrator || null;\r\n                        gameChatManager = gameState.state.gameChatManager || null;\r\n                        gameVoice = gameState.state.gameVoice || null;\r\n                        gameAnnouncerVoice = gameState.state.gameAnnouncerVoice || null;\r\n\r\n                        testLog(\"llm\", \"Deck config -> narrator=\" + (gameNarrator ? \"active\" : \"null\")\r\n                            + \" chatMgr=\" + (gameChatManager ? \"active\" : \"null\")\r\n                            + \" oppVoice=\" + (gameVoice?.subtitlesOnly ? \"subtitles\" : \"TTS\")\r\n                            + \" annVoice=\" + (gameAnnouncerVoice ? \"TTS\" : \"off\"), \"info\");\r\n                    } else {\r\n                        testLog(\"llm\", \"No saved gameConfig on deck -- defaults will be used\", \"info\");\r\n                    }\r\n\r\n                    if (window.CardGame.ctx) window.CardGame.ctx.gameState = savedGs;\r\n                } else {\r\n                    testLog(\"llm\", \"Could not create game state for config tests\", \"warn\");\r\n                }\r\n\r\n                // Restore globals\r\n                gameState.state.gameNarrator = savedNarrator;\r\n                gameState.state.gameDirector = savedDirector;\r\n                gameState.state.gameChatManager = savedChatMgr;\r\n                gameState.state.gameVoice = savedVoice;\r\n                gameState.state.gameAnnouncerVoice = savedAnnVoice;\r\n            } else if (!initializeLLMComponents) {\r\n                testLog(\"llm\", \"initializeLLMComponents not available (module not yet extracted)\", \"warn\");\r\n            } else {\r\n                testLog(\"llm\", \"No deck available for config toggle tests\", \"warn\");\r\n            }\r\n        }\r\n\r\n        //  Playthrough Tests \r\n        if (cats.includes(\"playthrough\")) {\r\n            testState.currentTest = \"Playthrough: automated game\";\r\n            testLog(\"playthrough\", \"Running automated playthrough...\");\r\n\r\n            if (!resolvedDeck) {\r\n                testLog(\"playthrough\", \"No deck available for playthrough\", \"warn\");\r\n            } else if (!gameState.createGameState) {\r\n                testLog(\"playthrough\", \"createGameState not available (module not yet extracted)\", \"warn\");\r\n            } else {\r\n                let deckName = resolvedDeckName;\r\n                let deck = resolvedDeck;\r\n                {\r\n                    testLog(\"playthrough\", \"Using deck: \" + (deck.deckName || deckName) + \" (\" + (deck.cards || []).length + \" cards)\", \"pass\");\r\n\r\n                    // Create game state\r\n                    let gs = gameState.createGameState(deck);\r\n                    if (!gs) {\r\n                        testLog(\"playthrough\", \"createGameState failed (no characters?)\", \"fail\");\r\n                    } else {\r\n                        testLog(\"playthrough\", \"Game created: \" + gs.player.character.name + \" vs \" + gs.opponent.character.name, \"pass\");\r\n                        testLog(\"playthrough\", \"Player: HP=\" + gs.player.hp + \" AP=\" + gs.player.ap + \" Hand=\" + gs.player.hand.length, \"info\");\r\n                        testLog(\"playthrough\", \"Opponent: HP=\" + gs.opponent.hp + \" AP=\" + gs.opponent.ap + \" Hand=\" + gs.opponent.hand.length, \"info\");\r\n\r\n                        // Simulate rounds\r\n                        let maxRounds = 5;\r\n                        for (let r = 0; r < maxRounds; r++) {\r\n                            // Initiative\r\n                            let pRoll = engine.rollD20() + (gs.player.character.stats?.AGI || 10);\r\n                            let oRoll = engine.rollD20() + (gs.opponent.character.stats?.AGI || 10);\r\n                            let initWinner = pRoll >= oRoll ? \"player\" : \"opponent\";\r\n                            testLog(\"playthrough\", \"Round \" + (r + 1) + \" initiative: \" + initWinner + \" (P:\" + pRoll + \" vs O:\" + oRoll + \")\", \"info\");\r\n\r\n                            // Simulate combat\r\n                            let pAtk = engine.rollD20() + (gs.player.character.stats?.STR || 10) + engine.getActorATK(gs.player);\r\n                            let oDef = engine.rollD20() + (gs.opponent.character.stats?.END || 10) + engine.getActorDEF(gs.opponent);\r\n                            if (pAtk > oDef) {\r\n                                let dmg = Math.max(1, Math.floor((pAtk - oDef) / 3));\r\n                                gs.opponent.hp -= dmg;\r\n                                testLog(\"playthrough\", \"Player attacks: \" + pAtk + \" vs \" + oDef + \" -> \" + dmg + \" damage (opp HP: \" + gs.opponent.hp + \")\", \"info\");\r\n                            } else {\r\n                                testLog(\"playthrough\", \"Player attacks: \" + pAtk + \" vs \" + oDef + \" -> miss\", \"info\");\r\n                            }\r\n\r\n                            let oAtk = engine.rollD20() + (gs.opponent.character.stats?.STR || 10) + engine.getActorATK(gs.opponent);\r\n                            let pDef = engine.rollD20() + (gs.player.character.stats?.END || 10) + engine.getActorDEF(gs.player);\r\n                            if (oAtk > pDef) {\r\n                                let dmg = Math.max(1, Math.floor((oAtk - pDef) / 3));\r\n                                gs.player.hp -= dmg;\r\n                                testLog(\"playthrough\", \"Opponent attacks: \" + oAtk + \" vs \" + pDef + \" -> \" + dmg + \" damage (player HP: \" + gs.player.hp + \")\", \"info\");\r\n                            } else {\r\n                                testLog(\"playthrough\", \"Opponent attacks: \" + oAtk + \" vs \" + pDef + \" -> miss\", \"info\");\r\n                            }\r\n\r\n                            // Check game over\r\n                            if (gs.player.hp <= 0) { testLog(\"playthrough\", \"Player defeated at round \" + (r + 1), \"info\"); break; }\r\n                            if (gs.opponent.hp <= 0) { testLog(\"playthrough\", \"Opponent defeated at round \" + (r + 1), \"info\"); break; }\r\n                        }\r\n\r\n                        let winner = gs.player.hp <= 0 ? \"opponent\" : gs.opponent.hp <= 0 ? \"player\" : \"draw\";\r\n                        testLog(\"playthrough\", \"Result: \" + winner + \" (P:\" + gs.player.hp + \" O:\" + gs.opponent.hp + \")\", winner !== \"draw\" ? \"pass\" : \"info\");\r\n\r\n                        // Test save/load cycle (basic -- comprehensive test in storage category)\r\n                        let saved = await storage.gameStorage.save(deckName + \"__pt\", gs);\r\n                        if (saved) {\r\n                            let loadedSave = await storage.gameStorage.load(deckName + \"__pt\");\r\n                            let roundtrip = loadedSave?.gameState?.player?.hp === gs.player.hp\r\n                                && loadedSave?.gameState?.round === gs.round\r\n                                && loadedSave?.gameState?.opponent?.hp === gs.opponent.hp;\r\n                            testLog(\"playthrough\", \"Save/load roundtrip (hp+round+opp): \" + (roundtrip ? \"ok\" : \"mismatch\"), roundtrip ? \"pass\" : \"fail\");\r\n                            await storage.gameStorage.deleteAll(deckName + \"__pt\");\r\n                        } else {\r\n                            testLog(\"playthrough\", \"Game state save failed\", \"fail\");\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        testState.currentTest = null;\r\n        testState.running = false;\r\n        testState.completed = true;\r\n        testLog(\"\", \"=== Test suite complete: \" + testState.results.pass + \" pass, \" + testState.results.fail + \" fail, \" + testState.results.warn + \" warn ===\", testState.results.fail > 0 ? \"fail\" : \"pass\");\r\n        m.redraw();\r\n    }\r\n\r\n    //  Test Mode UI Component \r\n    function TestModeUI() {\r\n        return {\r\n            view: function() {\r\n                let statusColors = { info: \"#777\", pass: \"#2E7D32\", fail: \"#C62828\", warn: \"#E65100\" };\r\n                let statusIcons = { info: \"info\", pass: \"check_circle\", fail: \"error\", warn: \"warning\" };\r\n                let context = ctx();\r\n\r\n                return m(\"div\", { class: \"cg2-test-mode\" }, [\r\n                    m(\"div\", { class: \"cg2-toolbar\" }, [\r\n                        m(\"button\", { class: \"cg2-btn\", onclick: function() {\r\n                            if (testDeck && context.viewingDeck) {\r\n                                if (window.CardGame.ctx) window.CardGame.ctx.screen = \"deckView\";\r\n                            } else {\r\n                                if (window.CardGame.ctx) window.CardGame.ctx.screen = \"deckList\";\r\n                            }\r\n                            m.redraw();\r\n                        } }, \"\\u2190 Back\"),\r\n                        m(\"span\", { style: { fontWeight: 700, fontSize: \"16px\", marginLeft: \"8px\" } }, \"Test Mode\"),\r\n                        testDeckName ? m(\"span\", { class: \"cg2-deck-theme-badge\", style: { marginLeft: \"8px\" } }, testDeckName) : null,\r\n                        !testState.running ? m(\"button\", {\r\n                            class: \"cg2-btn cg2-btn-primary\", style: { marginLeft: \"auto\" },\r\n                            onclick: function() { runTestSuite(); }\r\n                        }, [m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"3px\" } }, \"play_arrow\"), \"Run All Tests\"]) : null,\r\n                        testState.running ? m(\"span\", { style: { marginLeft: \"auto\", color: \"#B8860B\", fontWeight: 600, fontSize: \"13px\" } }, [\r\n                            m(\"span\", { class: \"material-symbols-outlined cg2-spin\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"4px\" } }, \"sync\"),\r\n                            testState.currentTest || \"Running...\"\r\n                        ]) : null\r\n                    ]),\r\n\r\n                    // Category toggles\r\n                    m(\"div\", { class: \"cg2-test-categories\" },\r\n                        Object.entries(TEST_CATEGORIES).map(function(pair) {\r\n                            let key = pair[0];\r\n                            let cat = pair[1];\r\n                            let active = testState.selectedCategories.includes(key);\r\n                            return m(\"label\", { class: \"cg2-test-cat\" + (active ? \" active\" : \"\"), onclick: function() {\r\n                                if (active) testState.selectedCategories = testState.selectedCategories.filter(function(c) { return c !== key; });\r\n                                else testState.selectedCategories.push(key);\r\n                                m.redraw();\r\n                            } }, [\r\n                                m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\" } }, cat.icon),\r\n                                \" \" + cat.label\r\n                            ]);\r\n                        })\r\n                    ),\r\n\r\n                    // Results summary\r\n                    testState.completed ? m(\"div\", { class: \"cg2-test-summary\" }, [\r\n                        m(\"span\", { class: \"cg2-test-result-pass\" }, testState.results.pass + \" pass\"),\r\n                        m(\"span\", { class: \"cg2-test-result-fail\" }, testState.results.fail + \" fail\"),\r\n                        m(\"span\", { class: \"cg2-test-result-warn\" }, testState.results.warn + \" warn\")\r\n                    ]) : null,\r\n\r\n                    // Debug console log\r\n                    m(\"div\", { class: \"cg2-test-console\" }, (function() {\r\n                        let items = [];\r\n                        let lastCat = null;\r\n                        for (let entry of testState.logs) {\r\n                            // Add section header when category changes\r\n                            if (entry.category && entry.category !== lastCat) {\r\n                                let catLabel = TEST_CATEGORIES[entry.category]?.label || entry.category;\r\n                                items.push(m(\"div\", { class: \"cg2-test-section-header\" }, catLabel));\r\n                                lastCat = entry.category;\r\n                            }\r\n                            items.push(m(\"div\", { class: \"cg2-test-log-entry\", \"data-status\": entry.status }, [\r\n                                m(\"span\", { class: \"cg2-test-log-time\" }, entry.time),\r\n                                entry.category ? m(\"span\", { class: \"cg2-test-log-cat\", \"data-cat\": entry.category }, entry.category) : null,\r\n                                m(\"span\", {\r\n                                    class: \"material-symbols-outlined\",\r\n                                    style: { fontSize: \"13px\", color: statusColors[entry.status] || \"#666\", verticalAlign: \"middle\", marginRight: \"4px\" }\r\n                                }, statusIcons[entry.status] || \"info\"),\r\n                                m(\"span\", { style: { color: statusColors[entry.status] || \"#333\" } }, entry.message)\r\n                            ]));\r\n                        }\r\n                        if (testState.logs.length === 0) {\r\n                            items.push(m(\"div\", { class: \"cg2-test-empty\" }, testDeck\r\n                                ? \"Click 'Run All Tests' to test deck: \" + (testDeckName || \"selected\")\r\n                                : \"Select a deck first, or click 'Run All Tests' for generic tests.\"));\r\n                        }\r\n                        return items;\r\n                    })())\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n    //  Expose on CardGame.TestMode namespace \r\n    Object.assign(window.CardGame.TestMode, {\r\n        TEST_CATEGORIES: TEST_CATEGORIES,\r\n        testState: testState,\r\n        getTestDeck: function() { return testDeck; },\r\n        getTestDeckName: function() { return testDeckName; },\r\n        setTestDeck: setTestDeck,\r\n        clearTestDeck: clearTestDeck,\r\n        runTestSuite: runTestSuite,\r\n        TestModeUI: TestModeUI\r\n    });\r\n\r\n    console.log(\"[CardGame] test/testMode loaded\");\r\n}());\r\n\n\n;/* === client/view/cardGame/CardGameApp.js === */\n// CardGameApp.js  Main orchestrator for Card Game v2\r\n// Assembles modules, manages shared state, routes screens\r\n(function() {\r\n    \"use strict\";\r\n\r\n    const NS = window.CardGame = window.CardGame || {};\r\n\r\n    //  Shared Application Context \r\n    // All modules access shared state through NS.ctx\r\n    let ctx = NS.ctx = {\r\n        // Screen routing\r\n        screen: \"deckList\",    // \"deckList\" | \"builder\" | \"deckView\" | \"game\" | \"test\" | \"themeEditor\"\r\n        builderStep: 1,        // 1=theme, 2=character, 3=review/build\r\n        fullMode: false,\r\n\r\n        // Deck state\r\n        viewingDeck: null,\r\n        savedDecks: [],\r\n        decksLoading: false,\r\n\r\n        // Builder state\r\n        availableCharacters: [],\r\n        charsLoading: false,\r\n        selectedChars: [],\r\n        builtDeck: null,\r\n        buildingDeck: false,\r\n        deckNameInput: \"\",\r\n\r\n        // Game state\r\n        gameState: null,\r\n        gameCharSelection: null,\r\n        activeCampaign: null,\r\n\r\n        // Theme state\r\n        activeTheme: null,\r\n        themeLoading: false,\r\n\r\n        // Test state\r\n        testDeck: null,\r\n        testDeckName: null\r\n    };\r\n\r\n    //  State Proxies \r\n    // Wire ctx properties to module state so UI components can read/write\r\n    // ctx.* and values are stored/retrieved from the correct module.\r\n    function proxyState(target, moduleFn, props) {\r\n        let defs = {};\r\n        for (let p of props) {\r\n            defs[p] = {\r\n                get() { let s = moduleFn(); return s ? s[p] : undefined; },\r\n                set(v) { let s = moduleFn(); if (s) s[p] = v; },\r\n                enumerable: true,\r\n                configurable: true\r\n            };\r\n        }\r\n        Object.defineProperties(target, defs);\r\n    }\r\n\r\n    // ArtPipeline state  ctx\r\n    proxyState(ctx, function() { return NS.ArtPipeline ? NS.ArtPipeline.state : null; }, [\r\n        \"artQueue\", \"artProcessing\", \"artCompleted\", \"artTotal\", \"artPaused\", \"artDir\",\r\n        \"backgroundImageId\", \"backgroundThumbUrl\", \"backgroundPrompt\", \"backgroundGenerating\",\r\n        \"tabletopImageId\", \"tabletopThumbUrl\", \"tabletopGenerating\",\r\n        \"cardFrontImageUrl\", \"cardBackImageUrl\", \"cardFrontGenerating\", \"cardBackGenerating\",\r\n        \"sequenceCardId\", \"sequenceProgress\",\r\n        \"sdOverrides\", \"sdConfigExpanded\", \"sdConfigTab\", \"gameConfigExpanded\",\r\n        \"voiceProfiles\", \"voiceProfilesLoaded\",\r\n        \"flippedCards\", \"sdOverrideInsts\", \"sdOverrideViews\"\r\n    ]);\r\n\r\n    // Themes state  ctx\r\n    proxyState(ctx, function() { return NS.Themes ? NS.Themes.state : null; }, [\r\n        \"applyingOutfits\"\r\n    ]);\r\n\r\n    // Initialize theme from constants\r\n    if (NS.Constants && NS.Constants.DEFAULT_THEME) {\r\n        ctx.activeTheme = NS.Constants.DEFAULT_THEME;\r\n    }\r\n\r\n    //  Helper: Toggle Full Mode \r\n    function toggleFullMode() {\r\n        ctx.fullMode = !ctx.fullMode;\r\n        m.redraw();\r\n    }\r\n\r\n    //  Deck Operations (delegate to deckList module) \r\n    function viewDeck(storageName) {\r\n        if (NS.UI && NS.UI.viewDeck) return NS.UI.viewDeck(storageName);\r\n    }\r\n    function playDeck(storageName) {\r\n        if (NS.UI && NS.UI.playDeck) return NS.UI.playDeck(storageName);\r\n    }\r\n    function resumeGame(storageName) {\r\n        if (NS.UI && NS.UI.resumeGame) return NS.UI.resumeGame(storageName);\r\n    }\r\n\r\n    //  Load Saved Decks (delegates to deckList module) \r\n    function loadSavedDecks() {\r\n        if (NS.UI && NS.UI.loadSavedDecks) {\r\n            return NS.UI.loadSavedDecks();\r\n        }\r\n    }\r\n\r\n    //  Theme List Loading \r\n    async function loadThemeList() {\r\n        if (NS.Themes && NS.Themes.loadThemeList) {\r\n            await NS.Themes.loadThemeList();\r\n        }\r\n    }\r\n\r\n    //  Expose context functions \r\n    ctx.viewDeck = viewDeck;\r\n    ctx.playDeck = playDeck;\r\n    ctx.resumeGame = resumeGame;\r\n    ctx.loadSavedDecks = loadSavedDecks;\r\n    ctx.loadThemeList = loadThemeList;\r\n    ctx.toggleFullMode = toggleFullMode;\r\n\r\n    //  Main Mithril Component \r\n    let cardGame = {\r\n        oninit() {\r\n            // Load theme on first mount\r\n            if (!ctx.themeLoading && NS.Themes) {\r\n                ctx.themeLoading = true;\r\n                NS.Themes.loadThemeConfig(\"high-fantasy\").then(theme => {\r\n                    if (theme) ctx.activeTheme = theme;\r\n                });\r\n            }\r\n            loadSavedDecks();\r\n        },\r\n        view() {\r\n            if (!page.authenticated()) return m(\"\");\r\n\r\n            let isGameScreen = ctx.screen === \"game\";\r\n            let DeckList = NS.UI.DeckList;\r\n            let BuilderThemeStep = NS.UI.BuilderThemeStep;\r\n            let BuilderCharacterStep = NS.UI.BuilderCharacterStep;\r\n            let BuilderReviewStep = NS.UI.BuilderReviewStep;\r\n            let DeckView = NS.UI.DeckView;\r\n            let GameView = NS.UI.GameView;\r\n            let TestModeUI = NS.TestMode ? NS.TestMode.TestModeUI : null;\r\n            let ThemeEditorUI = NS.Themes ? NS.Themes.ThemeEditorUI : null;\r\n\r\n            return m(\"div\", { class: \"content-outer\" }, [\r\n                ctx.fullMode ? \"\" : m(page.components.navigation),\r\n                m(\"div\", { class: \"content-main\" }, [\r\n                    m(\"div\", { class: \"cg2-container\" + (isGameScreen ? \" cg2-game-mode\" : \"\") }, [\r\n                        // Header (hidden in game mode)\r\n                        !isGameScreen ? m(\"div\", { class: \"cg2-toolbar\" }, [\r\n                            page.iconButton(\"button mr-4\", ctx.fullMode ? \"close_fullscreen\" : \"open_in_new\", \"\", toggleFullMode),\r\n                            m(\"span\", { style: { fontWeight: 700, fontSize: \"16px\", marginRight: \"16px\" } }, \"Card Game\"),\r\n                            ctx.screen === \"deckList\" ? [\r\n                                m(\"button\", { class: \"cg2-btn cg2-btn-sm\", onclick() { loadThemeList(); ctx.screen = \"themeEditor\"; m.redraw(); } }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"2px\" } }, \"palette\"),\r\n                                    \" Themes\"\r\n                                ]),\r\n                                m(\"button\", { class: \"cg2-btn cg2-btn-sm\", style: { marginLeft: \"4px\" }, onclick() { ctx.screen = \"test\"; m.redraw(); } }, [\r\n                                    m(\"span\", { class: \"material-symbols-outlined\", style: { fontSize: \"14px\", verticalAlign: \"middle\", marginRight: \"2px\" } }, \"science\"),\r\n                                    \" Test\"\r\n                                ])\r\n                            ] : null,\r\n                            m(\"span\", { style: { marginLeft: \"auto\", fontSize: \"11px\", color: \"#999\" } },\r\n                                \"Theme: \" + (ctx.activeTheme ? ctx.activeTheme.name : \"Loading...\"))\r\n                        ]) : null,\r\n\r\n                        // Screen router\r\n                        ctx.screen === \"deckList\" && DeckList ? m(DeckList) : null,\r\n                        ctx.screen === \"builder\" ? [\r\n                            m(\"div\", { class: \"cg2-toolbar\" }, [\r\n                                [1, 2, 3].map(s =>\r\n                                    m(\"span\", {\r\n                                        style: {\r\n                                            padding: \"3px 10px\", borderRadius: \"12px\", fontSize: \"12px\", cursor: \"pointer\",\r\n                                            background: ctx.builderStep === s ? \"#B8860B\" : \"transparent\",\r\n                                            color: ctx.builderStep === s ? \"#fff\" : \"#888\",\r\n                                            fontWeight: ctx.builderStep === s ? \"700\" : \"400\"\r\n                                        },\r\n                                        onclick: () => { if (s < ctx.builderStep) { ctx.builderStep = s; m.redraw(); } }\r\n                                    }, s + \". \" + [\"Theme\", \"Character\", \"Review\"][s - 1])\r\n                                )\r\n                            ]),\r\n                            ctx.builderStep === 1 && BuilderThemeStep ? m(BuilderThemeStep) : null,\r\n                            ctx.builderStep === 2 && BuilderCharacterStep ? m(BuilderCharacterStep) : null,\r\n                            ctx.builderStep === 3 && BuilderReviewStep ? m(BuilderReviewStep) : null\r\n                        ] : null,\r\n                        ctx.screen === \"deckView\" && DeckView ? m(DeckView) : null,\r\n                        ctx.screen === \"game\" && GameView ? m(GameView) : null,\r\n                        ctx.screen === \"test\" && TestModeUI ? m(TestModeUI) : null,\r\n                        ctx.screen === \"themeEditor\" && ThemeEditorUI ? m(ThemeEditorUI) : null\r\n                    ])\r\n                ]),\r\n                page.components.dialog.loadDialog(),\r\n                page.loadToast()\r\n            ]);\r\n        }\r\n    };\r\n\r\n    //  Register View \r\n    page.views.cardGameV2 = cardGame;\r\n\r\n    //  Public API Export \r\n    // Backward compatibility: expose key functions/objects via page.cardGameV2\r\n    page.cardGameV2 = {\r\n        // Constants\r\n        get CARD_TYPES() { return NS.Constants ? NS.Constants.CARD_TYPES : {}; },\r\n        get GAME_PHASES() { return NS.Constants ? NS.Constants.GAME_PHASES : {}; },\r\n        get COMBAT_OUTCOMES() { return NS.Constants ? NS.Constants.COMBAT_OUTCOMES : {}; },\r\n        get STATUS_EFFECTS() { return NS.Constants ? NS.Constants.STATUS_EFFECTS : {}; },\r\n        get SKILL_ACTION_KEYWORDS() { return NS.Constants ? NS.Constants.SKILL_ACTION_KEYWORDS : {}; },\r\n\r\n        // Rendering\r\n        get CardFace() { return NS.Rendering ? NS.Rendering.CardFace : null; },\r\n        get CardBack() { return NS.Rendering ? NS.Rendering.CardBack : null; },\r\n        get NeedBar() { return NS.Rendering ? NS.Rendering.NeedBar : null; },\r\n        get StatBlock() { return NS.Rendering ? NS.Rendering.StatBlock : null; },\r\n\r\n        // Storage\r\n        get deckStorage() { return NS.Storage ? NS.Storage.deckStorage : null; },\r\n        get gameStorage() { return NS.Storage ? NS.Storage.gameStorage : null; },\r\n        get campaignStorage() { return NS.Storage ? NS.Storage.campaignStorage : null; },\r\n        get themeStorage() { return NS.Storage ? NS.Storage.themeStorage : null; },\r\n\r\n        // Theme\r\n        loadThemeConfig: function(id) { return NS.Themes ? NS.Themes.loadThemeConfig(id) : Promise.resolve(null); },\r\n        activeTheme: function() { return ctx.activeTheme; },\r\n\r\n        // Characters\r\n        get assembleStarterDeck() { return NS.Characters ? NS.Characters.assembleStarterDeck : null; },\r\n        get mapStats() { return NS.Characters ? NS.Characters.mapStats : null; },\r\n        get getPortraitUrl() { return NS.Characters ? NS.Characters.getPortraitUrl : null; },\r\n\r\n        // Art Pipeline\r\n        get queueDeckArt() { return NS.ArtPipeline ? NS.ArtPipeline.queueDeckArt : null; },\r\n        get generateCardArt() { return NS.ArtPipeline ? NS.ArtPipeline.generateCardArt : null; },\r\n        get buildCardPrompt() { return NS.ArtPipeline ? NS.ArtPipeline.buildCardPrompt : null; },\r\n        artQueue: function() { return NS.ArtPipeline ? NS.ArtPipeline.artQueue : []; },\r\n\r\n        // Game Engine\r\n        get createGameState() { return NS.GameState ? NS.GameState.createGameState : null; },\r\n        gameState: function() { return ctx.gameState; },\r\n        get rollD20() { return NS.Engine ? NS.Engine.Combat.rollD20 : null; },\r\n        get rollInitiative() { return NS.Engine ? NS.Engine.Combat.rollInitiative : null; },\r\n        get advancePhase() { return NS.GameState ? NS.GameState.state.advancePhase : null; },\r\n        get placeCard() { return NS.GameState ? NS.GameState.state.placeCard : null; },\r\n        get advanceResolution() { return NS.Engine ? NS.Engine.Actions.advanceResolution : null; },\r\n\r\n        // Combat\r\n        get rollAttack() { return NS.Engine ? NS.Engine.Combat.rollAttack : null; },\r\n        get rollDefense() { return NS.Engine ? NS.Engine.Combat.rollDefense : null; },\r\n        get getCombatOutcome() { return NS.Engine ? NS.Engine.Combat.getCombatOutcome : null; },\r\n        get calculateDamage() { return NS.Engine ? NS.Engine.Combat.calculateDamage : null; },\r\n        get applyDamage() { return NS.Engine ? NS.Engine.Combat.applyDamage : null; },\r\n        get resolveCombat() { return NS.Engine ? NS.Engine.Combat.resolveCombat : null; },\r\n        get checkGameOver() { return NS.GameState ? NS.GameState.state.checkGameOver : null; },\r\n        currentCombatResult: function() { return NS.GameState ? NS.GameState.state.currentCombatResult : null; },\r\n\r\n        // Effects\r\n        get parseEffect() { return NS.Engine ? NS.Engine.Effects.parseEffect : null; },\r\n        get applyParsedEffects() { return NS.Engine ? NS.Engine.Effects.applyParsedEffects : null; },\r\n        get isEffectParseable() { return NS.Engine ? NS.Engine.Effects.isEffectParseable : null; },\r\n\r\n        // Test\r\n        get TEST_CARDS() { return NS.TestMode ? NS.TestMode.TEST_CARDS : []; },\r\n        testState: function() { return NS.TestMode ? NS.TestMode.testState : null; },\r\n        get runTestSuite() { return NS.TestMode ? NS.TestMode.runTestSuite : null; }\r\n    };\r\n\r\n    console.log(\"[CardGame v2] CardGameApp orchestrator loaded\");\r\n\r\n}());\r\n\n\n;/* === client/view/cardGame/index.js === */\n/**\r\n * CardGame Module - Entry point and public API\r\n * Modular card game with phases, combat, AI director, and deck building\r\n *\r\n * Script Loading Order (dependency order):\r\n *   1. constants/gameConstants.js\r\n *   2. state/storage.js\r\n *   3. rendering/cardComponents.js\r\n *   4. rendering/cardFace.js\r\n *   5. rendering/overlays.js\r\n *   6. services/characters.js\r\n *   7. services/themes.js\r\n *   8. services/artPipeline.js\r\n *   9. engine/effects.js\r\n *  10. engine/combat.js\r\n *  11. engine/encounters.js\r\n *  12. engine/actions.js\r\n *  13. state/gameState.js\r\n *  14. ai/llmBase.js\r\n *  15. ai/director.js\r\n *  16. ai/narrator.js\r\n *  17. ai/chatManager.js\r\n *  18. ai/voice.js\r\n *  19. ui/deckList.js\r\n *  20. ui/builder.js\r\n *  21. ui/deckView.js\r\n *  22. ui/phaseUI.js\r\n *  23. ui/threatUI.js\r\n *  24. ui/chatUI.js\r\n *  25. ui/gameOverUI.js\r\n *  26. ui/gameView.js\r\n *  27. test/testMode.js\r\n *  28. CardGameApp.js\r\n *  29. index.js (this file)\r\n */\r\n(function() {\r\n\r\n    // Ensure CardGame namespace exists\r\n    window.CardGame = window.CardGame || {};\r\n\r\n    /**\r\n     * Get the script paths for loading the CardGame module\r\n     * @param {string} basePath - Base path to cardGame directory\r\n     * @returns {Array<string>} Ordered script paths in dependency order\r\n     */\r\n    CardGame.getScriptPaths = function(basePath) {\r\n        const base = basePath || 'client/view/cardGame';\r\n        return [\r\n            `${base}/constants/gameConstants.js`,\r\n            `${base}/state/storage.js`,\r\n            `${base}/rendering/cardComponents.js`,\r\n            `${base}/rendering/cardFace.js`,\r\n            `${base}/rendering/overlays.js`,\r\n            `${base}/services/characters.js`,\r\n            `${base}/services/themes.js`,\r\n            `${base}/services/artPipeline.js`,\r\n            `${base}/engine/effects.js`,\r\n            `${base}/engine/combat.js`,\r\n            `${base}/engine/encounters.js`,\r\n            `${base}/engine/actions.js`,\r\n            `${base}/state/gameState.js`,\r\n            `${base}/ai/llmBase.js`,\r\n            `${base}/ai/director.js`,\r\n            `${base}/ai/narrator.js`,\r\n            `${base}/ai/chatManager.js`,\r\n            `${base}/ai/voice.js`,\r\n            `${base}/ui/deckList.js`,\r\n            `${base}/ui/builder.js`,\r\n            `${base}/ui/deckView.js`,\r\n            `${base}/ui/phaseUI.js`,\r\n            `${base}/ui/threatUI.js`,\r\n            `${base}/ui/chatUI.js`,\r\n            `${base}/ui/gameOverUI.js`,\r\n            `${base}/ui/gameView.js`,\r\n            `${base}/test/testMode.js`,\r\n            `${base}/CardGameApp.js`,\r\n            `${base}/index.js`\r\n        ];\r\n    };\r\n\r\n    // Module info\r\n    CardGame.VERSION = '2.0';\r\n    CardGame.MODULE_NAME = 'cardGame';\r\n\r\n    console.log('CardGame module loaded (v' + CardGame.VERSION + ')');\r\n\r\n}());\r\n\n\n;/* === client/components/advGrid.js === */\n(function(){\r\n    const advgrid = {};\r\n    let icon = \"videogame_asset\";\r\n    let label = \"Adventure Grid\";\r\n    let status = \"\";\r\n    let infoLabel = \"Info\";\r\n    let infoStatus = \"\";\r\n    let builderMode = false;\r\n    let modeClear = false;\r\n    let modeRoom = false;\r\n    let modeCorridor = false;\r\n    let changed = false;\r\n    let modeSpawn = 0;\r\n\r\n    let groups;\r\n\r\n    let communityData = {\r\n        communityName: 'AdvGrid - LC',\r\n        projectName: 'AdvGrid - P1',\r\n\r\n        countryData: [\"IR\"],\r\n        locationSize: 3,\r\n        locationSeed: 250,\r\n        epochs: 25,\r\n        lifecycle: null,\r\n        project: null\r\n    };\r\n\r\n    let data;\r\n\r\n    function newGameData(){\r\n        let dat = {\r\n            info: {},\r\n            gridWidth: 30,\r\n            gridHeight: 30,\r\n            cubeWidth: 20,\r\n            cubeHeight: 20,\r\n            /// gridWidth, cubeWidth (note: No space after comma!)\r\n            /// this is hard coded to be picked up by the processor\r\n            gridColCls: \"grid-cols-[repeat(30,20px)]\",\r\n            grid: [],\r\n            level: 1,\r\n            score: 0,\r\n            initialLocation: 'A New World',// - ' + (new Date().getTime()),\r\n            initialEvent: 'A New Start',// - ' + (new Date().getTime()),\r\n            event: null,\r\n            location: null,\r\n            player: null,\r\n            cellLocations:null,\r\n            mapgen : {\r\n                maxRooms: 5,\r\n                minRoomSize: 5,\r\n                maxRoomSize: 15\r\n            }\r\n        };\r\n        //dat.gridColCls = \"grid-cols-[repeat(\" + dat.gridWidth + \",\" + dat.cubeWidth + \"px)]\";\r\n        return dat;\r\n    }\r\n\r\n    function updateChanged(){\r\n        changed = true;\r\n    }\r\n    function toggleBuilder(){\r\n        builderMode = !builderMode;\r\n    }\r\n    function toggleModeClear(){\r\n        modeClear = !modeClear;\r\n        modeRoom = false;\r\n        modeCorridor = false;\r\n        modeSpawn = 0;\r\n    }\r\n\r\n    function toggleModeRoom(){\r\n        modeClear = false;\r\n        modeRoom = !modeRoom;\r\n        modeCorridor = false;\r\n        modeSpawn = 0;\r\n    }\r\n\r\n    function toggleModeCorridor(){\r\n        modeClear = false;\r\n        modeRoom = false;\r\n        modeSpawn = 0;\r\n        modeCorridor = !modeCorridor;\r\n    }\r\n\r\n    function toggleSpawn(i){\r\n        \r\n        if(modeSpawn == i) modeSpawn = 0;\r\n        else modeSpawn = i;\r\n        modeClear = false;\r\n        modeRoom = false;\r\n        modeCorridor = false;\r\n    }\r\n\r\n\r\n    function buildCell(x, y){\r\n        let g = data.grid;\r\n        if(g[x] && g[x][y]){\r\n            let cell = g[x][y];\r\n            let type = cell.type;\r\n            if(modeClear) type = 0;\r\n            else if(modeRoom) type = 1;\r\n            else if(modeCorridor) type = 2;\r\n            else if(modeSpawn == 1) type = 3;\r\n            else if (modeSpawn == -1) type = 4;\r\n            else if (modeSpawn == 2) type = 5;\r\n            else if (modeSpawn == 3) type = 6;\r\n            cell.type = type;\r\n            updateChanged();\r\n        }\r\n        else{\r\n            console.warn(\"No cell at \" + x + \", \" + y);\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    /// TODO:   Location needs Long/Lat values\r\n    ///         Resource needs more variant type support\r\n    ///         Expose API to generate a single fake person or fake event\r\n\r\n    /// Build a region based on the grid dimensions\r\n    ///\r\n    function constructRegion(name){\r\n\r\n    }\r\n\r\n    async function getGroups(){\r\n        let aP = [];\r\n//        if(!data) return Promise.resolve();\r\n        groups = {};\r\n        aP.push(page.findObject(\"GROUP\", \"DATA\", am6community.getPathForType(\"location\")).then((g)=>{ groups.location = g;}));\r\n        aP.push(page.findObject(\"GROUP\", \"DATA\", am6community.getPathForType(\"event\")).then((g)=>{ groups.event = g;}));\r\n        aP.push(page.findObject(\"GROUP\", \"DATA\", am6community.getPathForType(\"trait\")).then((g)=>{ groups.trait = g;}));\r\n        aP.push(page.findObject(\"GROUP\", \"DATA\", am6community.getPathForType(\"data\")).then((g)=>{ groups.data = g;}));\r\n        aP.push(page.findObject(\"GROUP\", \"DATA\", am6community.getPathForType(\"person\")).then((g)=>{ groups.person = g;}));\r\n        aP.push(page.findObject(\"GROUP\", \"DATA\", am6community.getPathForType(\"tag\")).then((g)=>{ groups.tag = g;}));\r\n        return Promise.all(aP);\r\n    }\r\n   \r\n\r\n    function generateMap(){\r\n        generateRooms();\r\n    }\r\n    function placeRoom(w, h){\r\n        let g = data.grid;\r\n        let pos = findSpaceLocation(w, h);\r\n         if(pos){\r\n\r\n            console.log(\"Place room at \" + pos.left + \", \" + pos.top);\r\n            for(let i = pos.left; i < pos.left + w; i++){\r\n                for(let b = pos.top; b < pos.top + h; b++){\r\n                    g[i][b].type = 1;\r\n                }\r\n            }\r\n        }\r\n        else{\r\n            console.warn(\"Failed to place room: \" + pos);\r\n        }\r\n\r\n    }\r\n    function randomVal(min, max){\r\n        return Math.floor( (Math.random() * (max - min)) + min)\r\n    }\r\n\r\n    function findSpaceLocation(w, h){\r\n        let g = data.grid;\r\n        let pos;\r\n        let iters = 0;\r\n        let maxiters = 100;\r\n        while(!pos){\r\n            iters++;\r\n            if(iters > maxiters){\r\n                console.log(\"Exceeded location attempts\");\r\n                break;\r\n            }\r\n            let t = randomVal(0, data.gridHeight);\r\n            let l = randomVal(0, data.gridWidth);\r\n            //console.log(\"Test: \" + t + \", \" + l);\r\n            /// Keep placement 1+ inside the margins to allow for any other border\r\n            if(l == 0) l = 1;\r\n            if(t == 0) t = 1;\r\n            if(l + w >= data.gridWidth) l = data.gridWidth - w - 2;\r\n            if(t + h >= data.gridHeight) t = data.gridHeight - h - 2;\r\n            let collision = false;\r\n            for(let x = l - 1; x < l + w + 1; x++){\r\n                for(let y = t - 1; y < t + h + 1; y++){\r\n                    //console.log(\"Scan: \" + x + \", \" + y);\r\n                    if(!g[x] || !g[x][y]){\r\n                        console.error(\"Cell error at \" + x + \", \" + y);\r\n                        collision = true;\r\n                        break;\r\n                    }\r\n                    let cell = g[x][y];\r\n                    if(cell.type){\r\n                        collision = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if(collision) break;\r\n            }\r\n            if(!collision){\r\n                pos = {left: l, top: t};\r\n                break;\r\n            }\r\n            else{\r\n                console.warn(\"Collision detected\");\r\n            }\r\n        }\r\n        return pos;\r\n    }\r\n\r\n    function generateRooms(){\r\n        let mg = data.mapgen;\r\n        let placedRooms = 0;\r\n        for(let i = 0; i < mg.maxRooms; i++){\r\n            let rw = randomVal(mg.minRoomSize, mg.maxRoomSize);\r\n            let rh = randomVal(mg.minRoomSize, mg.maxRoomSize);\r\n            placeRoom(rw, rh);\r\n        }\r\n    }\r\n\r\n    function newMapCell(x, y){\r\n        return {\r\n            dropped: 0,\r\n            active: false,\r\n            occupied: false,\r\n            color: \"white\",\r\n            x: x,\r\n            y: y,\r\n            type: 0\r\n        };\r\n    }\r\n\r\n    function statusCallback(s){\r\n        status = \" - \" + s;\r\n        m.redraw();\r\n    }\r\n    async function initLocation(){\r\n        if(!data) return false;\r\n        let outB = false;\r\n        let l = await page.openObjectByName('LOCATION', groups.location.objectId, data.initialLocation);\r\n        if(!l){\r\n            status = \" - Create a location\";\r\n            builderMode = true;\r\n            console.log(status);\r\n            m.redraw();\r\n        }\r\n        else{\r\n            data.location = l;\r\n            let cl = await page.listObjectsInParent('LOCATION', l.objectId, 0, l.childLocations.length);\r\n            data.childLocations = cl;\r\n            restoreMap();\r\n            outB = await initEvent();\r\n        }\r\n        return outB;\r\n    }\r\n    function restoreMap(){\r\n        if(!data || !data.childLocations) return;\r\n        data.childLocations.forEach((l)=>{\r\n            let y = l.longitude;\r\n            let x = l.latitude;\r\n\r\n            if(typeof x == 'number' || typeof y == 'number'){\r\n                let cell = data.grid[x][y];\r\n                let ct = 0;\r\n                if(l.attributes) ct = AM6Client.getAttributeValue(l, \"cellType\");\r\n                let cellType = 0;\r\n                if(ct) cellType = parseInt(ct);\r\n                cell.type = cellType;\r\n                cell.location = l;\r\n            }\r\n        });\r\n        m.redraw();\r\n    }\r\n    async function configureEvent(){\r\n        if(!data.event || !communityData.project){\r\n            console.log(\"No event or data project defined\");\r\n            return;\r\n        }\r\n        let outB = false;\r\n        if(!data.event.location){\r\n//            console.log(\"Obtain inception event ...\");\r\n            let pev = await page.findObject('GROUP', 'DATA', communityData.project.groupPath + \"/Events\");\r\n            console.log(\"Configuring event location ...\");\r\n            let pevC = await page.countObjects('EVENT', pev.objectId);\r\n            let lastE = await page.listObjects('EVENT', pev.objectId, pevC - 1, 1);\r\n            console.log(pev.objectId + \" / \" + pevC + \" / \" + lastE.length);\r\n            let randE = randomVal(1, pevC - 2);\r\n            let oE;\r\n            (await page.listObjects('EVENT', pev.objectId, randE, 3)).forEach((e)=>{\r\n                if(!oE && e.name.match(/epoch/gi)){\r\n                    oE = e;\r\n                }\r\n            });\r\n            if(oE){\r\n                let loc = await page.openObject('LOCATION', oE.location.objectId);\r\n                let cloc = loc.childLocations[randomVal(0,loc.childLocations.length)];\r\n                if(cloc){\r\n                    let clocd = await page.openObject('LOCATION', cloc.objectId);\r\n                    data.event.location = clocd;\r\n                    /// Push the start date to the last event\r\n                    ///\r\n                    data.event.startDate = lastE[0].startDate;\r\n                    data.event.endDate = lastE[0].endDate;\r\n                    console.log(\"Update event\");\r\n                    console.log(data.event);\r\n                    await page.updateObject(data.event);\r\n                    console.log(\"Post update\");\r\n                    console.log(data.event);\r\n                    outB = true;\r\n                    console.log(\"Enjoy \" + AM6Client.getAttributeValue(clocd, \"name\",clocd.name));\r\n                }\r\n                else{\r\n                    console.warn(\"No child!\");\r\n                }\r\n            }\r\n            else{\r\n                console.error(\"No epoch found!\");\r\n            }\r\n            //console.log(aE);\r\n\r\n        }\r\n        else{\r\n            if(!data.event.location.attributesPopulated) data.event.location = await page.openObject('LOCATION', data.event.location.objectId);\r\n            console.log(\"Working with \" + AM6Client.getAttributeValue(data.event.location, \"name\",data.event.location.name));\r\n            outB = true;\r\n        }\r\n        return outB;\r\n    }\r\n    async function initEvent(){\r\n        if(!data || !groups || !groups.event) return false;\r\n        let outB = false;\r\n        let e = await page.openObjectByName('EVENT', groups.event.objectId, data.initialEvent);\r\n        if(!e){\r\n            console.log(\"Create initial event\");\r\n            let initLoc = getCell(-1, -1, 5);\r\n            if(initLoc && initLoc.location){\r\n                console.log(\"Continue ...\");\r\n                let initEvt = am6model.newPrimitive(\"event\", true, am6community.getPathForType(\"event\"));\r\n                initEvt.name = data.initialEvent;\r\n                //initEvt.location = initLoc.location;\r\n                initEvt.eventType = 'INCEPT';\r\n                let b = await page.updateObject(initEvt);\r\n                if(b){\r\n                    console.log(\"Configure event ... \" + groups.event.objectId + \" / \" + data.initialEvent);\r\n                    let e2 = await page.openObjectByName('EVENT', groups.event.objectId, data.initialEvent);\r\n                    if(!e2.startDate) console.warn(\"Error retrieving event start date\");\r\n                    data.event = e2;\r\n                    outB = await configureEvent();\r\n                }\r\n                else{\r\n                    console.error(\"Failed to update event\");\r\n                    return false;\r\n                }\r\n\r\n            }\r\n            else{\r\n                console.error(\"Spawn location not found\");\r\n                return false;\r\n            }\r\n        }\r\n        else{\r\n            console.log(\"Load event ... \" + groups.event.objectId + \" / \" + data.initialEvent);\r\n            data.event = e;\r\n            outB = await configureEvent();\r\n        }\r\n        return true;\r\n\r\n    }\r\n    async function randomPerson(count){\r\n        let pev = await page.findObject('GROUP', 'DATA', communityData.project.groupPath + \"/Persons\");\r\n        let pevC = await page.countObjects('PERSON', pev.objectId);\r\n        let pR = randomVal(1, pevC - count);\r\n        let aR = await page.listObjects('PERSON', pev.objectId, pR, count);\r\n        return aR;\r\n    }\r\n\r\n    async function randomPersons(count){\r\n        let aP = [];\r\n        for(let i = 0; i < count; i++){\r\n            let per = await randomPerson(1);\r\n            aP.push(per[0]);\r\n        }\r\n        return aP;\r\n    }\r\n\r\n    async function newPlayerPerson(){\r\n        let pers = await randomPerson(1);\r\n        let per = pers[0];\r\n        //data.event.actors = [per];\r\n        return per;\r\n    }\r\n    async function initPopulation(){\r\n        //let bc = 0;\r\n        if(!data || !data.event) return;\r\n        if(!data.event.actors.length){\r\n            let per = await newPlayerPerson();\r\n            data.info.per = per;\r\n            data.info.pers = await randomPersons(10);\r\n            solicitInfo(\"Setup\");\r\n            //console.log(\"Selecting player: \" + per.name);\r\n            //bc++;\r\n        }\r\n        else{\r\n            //infoStatus = \" - \" + data.event.actors[0].name;\r\n            data.player = await page.openObjectByName('PERSON', groups.person.objectId, data.event.actors[0].name);\r\n            if(!data.player){\r\n                console.log(\"Cloning base person\");\r\n                let clone = await page.openObject('PERSON', data.event.actors[0].objectId);\r\n                delete clone.id;\r\n                delete clone.objectId;\r\n                delete clone.contactInformation;\r\n                clone.groupPath = am6community.getPathForType(\"person\");\r\n                await page.updateObject(clone);\r\n                data.player = await page.openObjectByName('PERSON', groups.person.objectId, data.event.actors[0].name);\r\n            }\r\n            console.log(\"Working with player: \");\r\n            console.log(data.player);\r\n            solicitInfo(\"Setup2\");\r\n        }\r\n    }\r\n\r\n    function chooseInfo(o){\r\n        if(!data) return;\r\n        data.info.selected = o;\r\n    }\r\n    async function confirmInfo(){\r\n        if(!data || !data.info.selected) return;\r\n        if(data.info.step == \"setup\"){\r\n            data.event.actors = [data.info.selected];\r\n            await page.updateObject(data.event);\r\n            //solicitInfo(\"Setup2\");\r\n            await initPopulation();\r\n        }\r\n    }\r\n    async function refreshInfo(){\r\n        if(!data) return;\r\n        if(data.info.step == 'setup'){\r\n            console.log(\"Refresh pop\");\r\n            await initPopulation();\r\n        }\r\n        else{\r\n            console.log(\"Unknown step: \" + data.info.step);\r\n        }\r\n\r\n    }\r\n\r\n    function solicitInfo(x){\r\n        if(!data) return;\r\n        data.info.step = x.toLowerCase();\r\n        infoStatus = \" - \" + x;\r\n        m.redraw();\r\n    }\r\n\r\n    async function init(){\r\n    \r\n        //generateMap();\r\n        console.log(\"Create empty grid\");\r\n        createNewGrid();\r\n        if(!groups){\r\n            await getGroups();\r\n            if(data){\r\n                let p = await am6community.getCreateConfiguredCommunityProject(communityData.communityName, communityData.projectName, communityData.countryData, communityData.locationSize, communityData.locationSeed, communityData.epochs, statusCallback);\r\n                communityData.project = p;\r\n                await initLocation();\r\n                console.log(\"Init pop\");\r\n                await initPopulation();\r\n            }\r\n        }\r\n    }\r\n\r\n    function getCell(x, y, type){\r\n        if(!data || !data.grid) return;\r\n        let outCell;\r\n        for(let i = 0; i < data.gridWidth; i++){\r\n            if(typeof x == 'number' && x >= 0 && x != i) continue; \r\n            for(let b = 0; b < data.gridHeight; b++){\r\n                let cell = data.grid[i][b];\r\n                if(typeof y == 'number' && y >= 0 && y != b) continue;\r\n                if(typeof type == 'number' && cell.type == type){\r\n                    outCell = cell;\r\n                }\r\n            }\r\n            if(outCell) break;\r\n        }\r\n        return outCell;\r\n    }\r\n\r\n    function createNewGrid(){\r\n        console.log(\"Initialize grid\");\r\n\r\n        data = newGameData();\r\n\r\n        let dgrid = data.grid;\r\n\r\n        for(let i = 0; i < data.gridWidth; i++){\r\n            if(!dgrid[i]) dgrid[i] = [];\r\n            for(let b = 0; b < data.gridHeight; b++){\r\n                dgrid[i][b] = newMapCell(i, b);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    function refreshGrid(){\r\n        if(!data) return m(\"div\",\"[ ... ]\");\r\n        let gridView = [];\r\n        let dgrid = data.grid;\r\n        let w = data.cubeWidth;\r\n        let h = data.cubeHeight;\r\n\r\n        let gridStyle = \"width: \" + (data.gridWidth * w) + \"px;\";\r\n\r\n        let colorPrep = [\r\n            \"bg-blue-500\",\r\n            \"bg-red-500\",\r\n            \"bg-green-500\",\r\n            \"bg-brown-500\",\r\n            \"bg-gray-500\",\r\n            \"bg-orange-500\",\r\n            \"bg-yellow-500\",\r\n            \"bg-purple-500\",\r\n            \"bg-teal-500\",\r\n            \"bg-white\",\r\n            \"bg-black\",\r\n            \"border-white\",\r\n            \"border-black\"\r\n        ];\r\n\r\n        let defCubeColor = \"white\";\r\n\r\n        let cubeTrans = \"transition-all duration-300\";\r\n        let cubeClsC = cubeTrans;\r\n        let cubeStyleS = \"width:\" + w + \"px;\"\r\n        + \"height: \" + h + \"px;\";\r\n\r\n        for(let b = 0; b < data.gridHeight; b++){\r\n            for(let i = 0; i < data.gridWidth; i++){\r\n                let cell = dgrid[i][b];\r\n                let cellTypeColor = defCubeColor;\r\n                if(cell.type > 0) cellTypeColor = getCellTypeStyle(cell.type);\r\n                /*\r\n                if(cell.type == 1) cellTypeColor = \"black\";\r\n                else if (cell.type == 2) cellTypeColor = \"orange\";\r\n                */\r\n                let cubeCls = cubeClsC + \" \" + cubeStyle(cell.active, cell.active ? cell.color : cellTypeColor);\r\n                let handler;\r\n                if(builderMode){\r\n                    handler = function(){\r\n                        buildCell(i, b);\r\n                    };\r\n                }\r\n                let n = m(\"div\", {class: cubeCls, style: cubeStyleS, onclick: handler});\r\n                gridView.push(n);\r\n            }\r\n        }\r\n        // console.log(gridStyle);\r\n        return [m(\"div\", {class: \"game-grid-auto \" + data.gridColCls, style: gridStyle}, gridView)];\r\n    }\r\n    let cellColorMap = [\r\n        \"white\",\r\n        \"black\",\r\n        \"gray\",\r\n        \"teal\",\r\n        \"red\",\r\n        \"green\",\r\n        \"purple\"\r\n    ];\r\n\r\n    function getCellTypeStyle(i){\r\n        return cellColorMap[i] || \"yellow\";\r\n    }\r\n    function cubeStyle(b, g){\r\n        let color = g + ((g.match(/^(white|black)$/) ? \"\" : \"-500\")); \r\n        return (b ? \"border border-gray-900 shadow-lg\" : \"border border-\" + color) \r\n        + \" bg-\" + color\r\n    ;\r\n    }\r\n\r\n    let oneYearMs = 31536000000;\r\n    function getAge(per){\r\n        if(!data) return 0;\r\n        let d1 = per.birthDate;\r\n        let d2 = data.event.endDate;\r\n        let ms = d2.getTime() - d1.getTime();\r\n        /// Because the randomly chosen event may be before the randomly chosen person was born, then the age may be negative\r\n        /// Just take the absolute value here\r\n        return Math.abs(Math.round(ms / oneYearMs));\r\n    }\r\n\r\n    function modelInfo(){\r\n        if(!data) return \"\";\r\n        let ino = data.info;\r\n\r\n        if(ino.step === 'setup'){\r\n            let aR = [];\r\n            if(ino.per){\r\n                aR.push(m(\"li\",m(\"div\", {onclick: function(){ chooseInfo(ino.per);}, class: 'result-item' + (ino.selected && ino.selected.objectId == ino.per.objectId ? \" result-item-active\" : \"\")},  ino.per.name + \" (\" + ino.per.gender + \") (\" + getAge(ino.per) + \" years) (\" + AM6Client.getAttributeValue(ino.per, \"alignment\") + \") (\" + AM6Client.getAttributeValue(ino.per, \"trade\") + \")\")));\r\n            }\r\n            if(ino.pers) ino.pers.forEach((p)=>{\r\n                aR.push(m(\"li\",m(\"div\", {onclick: function(){ chooseInfo(p);}, class: 'result-item'  + (ino.selected && ino.selected.objectId == p.objectId ? \" result-item-active\" : \"\")}, p.name + \" (\" + p.gender + \")\" + (AM6Client.getAttributeValue(p, \"deceased\") === 'true' ? \" (dead)\" : \"\") + \" (\" + getAge(p) + \" years) (\" + AM6Client.getAttributeValue(p, \"alignment\") + \") (\" + AM6Client.getAttributeValue(p, \"trade\") + \")\")));\r\n            });\r\n            return m(\"ul\", {\"class\" : \"list-results-overflow\"}, aR);\r\n        }\r\n        return \"\";\r\n    }\r\n    function modelGame(){\r\n        return refreshGrid();\r\n    }\r\n\r\n    function getScoreCard(){\r\n        return m(\"div\",{class: \"result-nav-outer\"},[\r\n            m(\"div\",{class: \"result-nav-inner\"},[\r\n                //page.iconButton(\"button mr-4\", \"start\", \"\", start),\r\n                page.iconButton(\"button mr-4\", \"refresh\", \"\", refreshInfo),\r\n                //m(\"div\",{class: \"count-label mr-4\"},\"Level \" + (data ? data.level : 1)),\r\n                //m(\"div\",{class: \"count-label mr-4\"},\"Score \" + (data ? data.score : 0)),\r\n                page.iconButton(\"button\", \"check\", \"\", confirmInfo)\r\n            ])\r\n        ]);\r\n    }\r\n\r\n\r\n    function modelPanel(){\r\n        return [m(\"div\",{class: \"results-overflow grid grid-cols-2 gap-4\"},\r\n                    m(\"div\",{class: \"panel-card\"},\r\n                        m(\"p\", {\"class\" : \"card-title\"}, [\r\n                            m(\"span\", {class : \"material-icons material-icons-cm mr-2\"}, icon),\r\n                            label + status\r\n                        ]),\r\n                        m(\"div\", {\"class\": \"card-contents\"}, modelGame())\r\n                    ),\r\n                    m(\"div\",{class: \"panel-card\"},\r\n                    m(\"p\", {\"class\" : \"card-title\"}, [\r\n                        m(\"span\", {class : \"material-icons material-icons-cm mr-2\"}, icon),\r\n                        infoLabel + infoStatus\r\n                    ]),\r\n                    m(\"div\", {\"class\": \"card-contents\"}, modelInfo())\r\n                )\r\n\r\n            ),\r\n            m(\"div\",{class: \"result-nav-outer\"},[\r\n                m(\"div\",{class: \"result-nav-inner\"},[\r\n                    m(\"div\",{class: \"result-nav tab-container\"},[\r\n                        page.iconButton(\"button\", \"west\", \"\", moveWest),\r\n                        page.iconButton(\"button\", \"north\", \"\", moveNorth),\r\n                        page.iconButton(\"button\", \"south\", \"\", moveSouth),\r\n                        page.iconButton(\"button\", \"east\", \"\", moveEast),\r\n                        page.iconButton(\"button\", \"hourglass_empty\", \"\", wait)\r\n                    ])\r\n                ])\r\n            ]),\r\n        ];\r\n    }\r\n    function wait(){\r\n\r\n    }\r\n    function moveEast(){\r\n\r\n    }\r\n    function moveWest(){\r\n\r\n    }\r\n    function moveNorth(){\r\n\r\n    }\r\n    function moveSouth(){\r\n\r\n    }\r\n\r\n    function start(){\r\n\r\n    }\r\n    function stop(){\r\n\r\n    }\r\n\r\n    function endGame(){\r\n        let udef;\r\n        groups = udef;\r\n        data = udef;\r\n    }\r\n\r\n    function keyControl(e){\r\n\r\n    }\r\n\r\n    function shuffle(){\r\n        createNewGrid();\r\n        generateMap();\r\n        //m.redraw();\r\n    }\r\n\r\n    async function saveGame(){\r\n        console.log(\"Save!\");\r\n        if(builderMode){\r\n            return saveGrid();\r\n        }\r\n        else{\r\n            console.warn(\"Implement save...\");\r\n        }\r\n    }\r\n    async function saveGrid(){\r\n        let l1 = data.location;\r\n        let name = document.querySelector(\"[rid=gridName]\").value;\r\n        if(name){\r\n            if(!l1 || l1.name !== name) l1 = am6model.newPrimitive(\"location\", true, am6community.getBasePath(\"location\"));\r\n            l1.name = name;\r\n\r\n            console.log(\"Attempt to update\");\r\n            let b = await page.updateObject(l1);\r\n            console.log(\"Attempt to retrieve\");\r\n            let l2 = await page.openObjectByName(\"LOCATION\", groups.location.objectId, name);\r\n            if(l2){\r\n                /// Build up the grid and do a bulk load:\r\n\r\n                let aLocs = [];\r\n                for(let y = 0; y < data.gridHeight; y++){\r\n                    for(let i = 0; i < data.gridWidth; i++){\r\n                        let cell = data.grid[i][y];\r\n                        let l3 = cell.location || am6model.newPrimitive(\"location\", true, am6community.getBasePath(\"location\"));\r\n                        l3.name = \"Cell x\" + i + \" y\" + y;\r\n                        if(cell.location && (l3.longitude != y || l3.latitude != i)){\r\n                            console.warn(\"Cell miss-match: \" + l3.latitude + \" == \" + i + \" / \" + l3.longitude + \" == \" + y);\r\n                        }\r\n                        l3.longitude = y;\r\n                        l3.latitude = i;\r\n                        l3.attributes = [AM6Client.newAttribute(\"cellType\", cell.type)];\r\n                        l3.geographyType = \"ENVIRONMENTAL\";\r\n                        l3.parentId = l2.id;\r\n                        aLocs.push(l3);\r\n                    }\r\n                }\r\n                console.log(\"Attempting to bulk update \" + aLocs.length + \" items\");\r\n                AM6Client.updateBulk(\"LOCATION\", aLocs, function(s, v){\r\n                    if(v && typeof v.json != \"undefined\") v = v.json;\r\n                    /// Clear the context object properly load the children\r\n                    ///\r\n                    page.clearContextObject(l2.objectId);\r\n                    window.dbgEntity = aLocs;\r\n                    console.log(\"Done: \" + v);\r\n                    changed = false;\r\n                    initLocation();\r\n                    //m.redraw();\r\n                });\r\n\r\n            }\r\n            else{\r\n                console.error(\"Failed to retrieve \" + name);\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    function getCommands(){\r\n        if(!am6community.getCommunityMode){\r\n            return [\r\n                page.iconButton(\"button\", \"group\", \"\", function(){ page.components.breadCrumb.toggleCommunity(); })\r\n            ];\r\n        }\r\n        let bldCommands = [\r\n            page.iconButton(\"button\" + (builderMode ? \" active\" : \"\"), (builderMode ? \"draw\" : \"edit_off\"), \"\", function(){ toggleBuilder(); }),\r\n        ];\r\n        if(builderMode) bldCommands = bldCommands.concat([\r\n            page.iconButton(\"button\",\"shuffle\", \"\", function(){ shuffle(); }),\r\n            page.iconButton(\"button\" + (modeClear ? \" active\" : \"\"),\"backspace\", \"\", function(){ toggleModeClear(); }),\r\n            page.iconButton(\"button\" + (modeRoom ? \" active\" : \"\"),\"meeting_room\", \"\", function(){ toggleModeRoom(); }),\r\n            page.iconButton(\"button\" + (modeCorridor ? \" active\" : \"\"),\"edit_road\", \"\", function(){ toggleModeCorridor(); }),\r\n            page.iconButton(\"button\" + (modeSpawn == 1 ? \" active\" : \"\"),\"thumb_up_off_alt\", \"\", function(){ toggleSpawn(1); }),\r\n            page.iconButton(\"button\" + (modeSpawn == -1 ? \" active\" : \"\"),\"thumb_down_off_alt\", \"\", function(){ toggleSpawn(-1); }),\r\n            page.iconButton(\"button\" + (modeSpawn == 2 ? \" active\" : \"\"), \"my_location\", \"\", function(){ toggleSpawn(2); }),\r\n            page.iconButton(\"button\" + (modeSpawn == 3 ? \" active\" : \"\"), \"place\", \"\", function(){ toggleSpawn(3); })\r\n\r\n        ]);\r\n        bldCommands.push(m(\"input\", {type: \"text\", class : \"ml-4 text-field\", rid : 'gridName', value: (data ? data.initialLocation : \"\")}));\r\n        return bldCommands;\r\n    }\r\n\r\n    advgrid.component = {\r\n        data : function(){ return data },\r\n        isChanged : function(){ return changed; },\r\n        saveGame : saveGame,\r\n        commands : getCommands,\r\n        keyHandler : keyControl,\r\n        scoreCard : getScoreCard,\r\n\r\n        oninit : function(x){\r\n            init();\r\n        },\r\n        oncreate : function (x) {\r\n\r\n        },\r\n        onremove : function(x){\r\n            endGame();\r\n        },\r\n\r\n        view: function () {\r\n            return modelPanel();\r\n         }\r\n    };\r\n\r\n    page.components.advgrid = advgrid.component;\r\n}());\r\n\n\n;/* === client/components/tetris.js === */\n/// Demo game component - based on a 20+ year old 5K JavaScript submission I made\r\n///\r\n(function(){\r\n    const tetris = {};\r\n    let icon = \"videogame_asset\";\r\n    let label = \"Tetris\";\r\n    let preview = true;\r\n\r\n    function newGameData(){\r\n        let dat = {\r\n            cube_width:25,\r\n            cube_height:25,\r\n            grid_width:10,\r\n            grid_height:20,\r\n            grid:[],\r\n            cubes:[],\r\n            cube_types:[\r\n                /* square */\r\n                \"10112021101120211011202110112021\",\r\n                /* line */\r\n                \"20212223011121312021222301112131\",\r\n        \r\n                /* right_elbow */\r\n                \"10201112011121221011120200011121\",\r\n                /* left_elbow */\r\n                \"10202122112130312021223211122131\",\r\n                /* intersect */\r\n                \"11202131312021221121223111202122\",\r\n                /* right_twist */\r\n                \"10200111101121221020011110112122\",\r\n                /* left_twist */\r\n                \"00101121100111020010112110011102\"\r\n            ],\r\n            cube_colors:[\"red\",\"green\",\"blue\"],\r\n            next_cube_color:\"blue\",\r\n        \r\n            /* piece matrix size */\r\n            piece_width:4,\r\n            piece_height:4,\r\n        \r\n            /* default starting position */\r\n            piece_left:4,\r\n            piece_top:0,\r\n        \r\n            /* flag whether an active game piece is in play */\r\n            piece_is_active:0,\r\n            current_clock_value: 1000,\r\n            next_level_requirement:10,\r\n            next_level:0,\r\n            lines:0,\r\n            point_modifier:1,\r\n            init_game:0,\r\n            level:1,\r\n            score: 0,\r\n            levels:[1000,900,800,700,600,500,400,300,200,100,50,10,1]\r\n        };\r\n\r\n        /* mark the top-most piece */\r\n        dat.mark_top = dat.grid_height;\r\n\r\n        return dat;\r\n    }\r\n\r\n    let data;\r\n    \r\n    function init(){\r\n    \r\n        console.log(\"Initialize grid\");\r\n\r\n        data = newGameData();\r\n\r\n        data.cube_types.forEach((c, i)=>{\r\n            let n = [];\r\n            for(let b = 0; b < data.piece_width; b++){\r\n                n[b] = [];\r\n                for(let k = 0; k < data.piece_height; k++){\r\n                    n[b][k] = [];\r\n                    /// rotation\r\n                    for(let j = 0; j < 4; j++){\r\n                        n[b][k][j] = 0;\r\n                    }\r\n                }\r\n            }\r\n\r\n            let mesh = c;\r\n            let r = -1;\r\n            for(let k = 0; k < mesh.length; k += 2){\r\n                if(k % 8 == 0) r++;\r\n                let j = mesh.substring(k, k + 2).split(\"\");\r\n                n[j[0]][j[1]][r] = 1;\r\n            }\r\n            \r\n            data.cubes[i] = n;\r\n\r\n        });\r\n\r\n        data.next_cube_index = parseInt(Math.random() * data.cube_types.length);\r\n        data.next_cube_color = data.cube_colors[parseInt(Math.random() * data.cube_colors.length)];\r\n    }\r\n\r\n    function refreshGrid(){\r\n        if(!data) return m(\"div\",\"init ...\");\r\n        let gridView = [];\r\n        let dgrid = data.grid;\r\n        let w = data.cube_width;\r\n        let h = data.cube_height;\r\n\r\n        let gridStyle = \"width: \" + (data.grid_width * w) + \"px\";\r\n        let previewStyle = \"width: \" + (data.piece_width * w) + \"px\";\r\n\r\n        let colorPrep = [\r\n            \"bg-blue-500\",\r\n            \"bg-red-500\",\r\n            \"bg-green-500\",\r\n        ];\r\n\r\n        let defCubeColor = \"white\";\r\n\r\n        let cubeTrans = \"rounded-sm transition-all duration-300\"\r\n        let cubeClsC = cubeTrans;\r\n        let cubeStyleS = \"width:\" + w + \"px;\"\r\n        + \"height: \" + h + \"px;\";\r\n\r\n        for(let b = 0; b < data.grid_height; b++){\r\n            for(let i = 0; i < data.grid_width; i++){\r\n                if(!dgrid[i]) dgrid[i] = [];\r\n                if(!dgrid[i][b]) dgrid[i][b] = {dropped: 0};\r\n                let cubeCls = cubeClsC + \" \" + cubeStyle(dgrid[i][b].active, dgrid[i][b].active ? dgrid[i][b].color : defCubeColor);\r\n                let n = m(\"div\", {class: cubeCls, style: cubeStyleS});\r\n                gridView.push(n);\r\n            }\r\n        }\r\n        let prev = \"\";\r\n        if(preview){\r\n            let prevGrid = [];\r\n            let prevColor = data.next_cube_color;\r\n            for(let b = 0; b < data.piece_height; b++){\r\n                for(let i = 0; i < data.piece_width; i++){\r\n                    let p = data.cubes[data.next_cube_index][i][b][0];\r\n                    let cubeCls = cubeClsC + \" \" + cubeStyle((p ? true : false), (p ? prevColor : defCubeColor));\r\n                    let n = m(\"div\", {class: cubeCls, style: cubeStyleS});\r\n                    prevGrid.push(n);\r\n                }\r\n            }\r\n            prev = m(\"div\", {class: \"game-grid-preview-44\", style: previewStyle}, prevGrid);\r\n        }\r\n        return [m(\"div\", {class: \"game-grid-1020\", style: gridStyle}, gridView), prev];\r\n    }\r\n    \r\n    function cubeStyle(b, g){\r\n        return (b ? \"border border-gray-900 shadow-lg\" : \"border border-white\") \r\n        + \" bg-\" + g + (g.match(/^(white|black)$/) ? \"\" : \"-500\")\r\n    ;\r\n    }\r\n\r\n    function evaluateGrid(){\r\n        var s = arguments[0], h = 0,  p;\r\n        data.piece_on_left_edge = 0;\r\n        data.piece_on_right_edge = 0;\r\n        for(let a = data.current_piece_left; a < (data.current_piece_left + data.piece_width); a++){\r\n            if(typeof data.grid[a] == 'object'){\r\n                for(let b = data.current_piece_top; b < (data.current_piece_top + data.piece_height); b++){\r\n                    if(typeof data.grid[a][b] == 'object'){\r\n                        let dg = data.grid[a][b];\r\n                        p = data.cubes[data.active_cube_index][a - data.current_piece_left][b - data.current_piece_top][data.piece_rotation];\r\n                        if(p){\r\n                            if(dg.dropped)\r\n                                h=1;\r\n                            \r\n                            if(!a)\r\n                                data.piece_on_left_edge=1;\r\n                            \r\n                            if(b == (data.grid_height - 1))\r\n                                data.piece_is_dropped = 1;\r\n                            \r\n                            if(a == (data.grid_width-1))\r\n                                data.piece_on_right_edge=1;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else{\r\n                let c1 = 0;\r\n                if(data.current_piece_left < 0){\r\n                    c1 = Math.abs(data.current_piece_left) - 1;\r\n                }\r\n                else {\r\n                    c1= Math.abs(data.current_piece_left - data.grid_width);\r\n                }\r\n                for(let b = 0; b < data.piece_height; b++){\r\n                    if(data.cubes[data.active_cube_index][c1][b][data.piece_rotation]){\r\n                        h = 1;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if(!h){\r\n            for(let a = (data.current_piece_left - 1); a < (data.current_piece_left + data.piece_width + 1); a++){\r\n                if(typeof data.grid[a] == 'object'){\r\n                    for(let b = (data.current_piece_top - 1); b < (data.current_piece_top + data.piece_height + 1); b++){\r\n                        if(typeof data.grid[a][b] =='object'){\r\n                            let dg = data.grid[a][b];\r\n                            p = 0;\r\n                            if(typeof data.cubes[data.active_cube_index][a - data.current_piece_left] == 'object'){\r\n                                if(typeof data.cubes[data.active_cube_index][a - data.current_piece_left][b - data.current_piece_top] == 'object'){\r\n                                    p = data.cubes[data.active_cube_index][a - data.current_piece_left][b - data.current_piece_top][data.piece_rotation];\r\n                                }\r\n                            }\r\n                            if(p){\r\n                                dg.color = data.active_cube_color;\r\n                                dg.active = true;\r\n                            }\r\n                            else{\r\n                                if(!dg.dropped){\r\n                                    dg.active = false;\r\n                                    dg.color = \"white\";\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        let r = 0;\r\n        if(h){\r\n            if(s == 1)\r\n                data.current_piece_top--;\r\n            \r\n            if(s == 3)\r\n                data.current_piece_left--;\r\n            \r\n            if(s == 2)\r\n                data.current_piece_left++;\r\n            \r\n            r = 1;\r\n        }\r\n    \r\n        /* Prevent further left moves. */\r\n        if(s == 2 && data.piece_on_left_edge)\r\n            r = 1;\r\n        \r\n        /* Prevent further down moves. */\r\n        if(s == 1 && data.piece_is_dropped)\r\n            r = 1;\r\n        \r\n        /* Prevent further right moves; */\r\n        if(s == 3 && data.piece_on_right_edge)\r\n            r = 1;\r\n        \r\n        /* Return false if there were no hits, return true if there were hits. */\r\n        return r;\r\n    }\r\n\r\n    function addPiece(){\r\n        if(!data.init_game)\r\n            data.init_game = 1;\r\n        \r\n        clock();\r\n        \r\n        data.piece_rotation = 0;\r\n        data.active_cube_index = data.next_cube_index;\r\n        data.next_cube_index = parseInt(Math.random() * data.cube_types.length);\r\n        data.active_cube_color = data.next_cube_color;\r\n        while( data.next_cube_color == data.active_cube_color && data.cube_colors.length > 1)\r\n            data.next_cube_color = data.cube_colors[parseInt(Math.random() * data.cube_colors.length)];\r\n        \r\n        data.piece_is_active = 1;\r\n        data.piece_on_left_edge = 0;\r\n        data.piece_on_right_edge = 0;\r\n        data.piece_is_dropped = 0;\t\r\n        data.current_piece_top = data.piece_top;\r\n        data.current_piece_left = data.piece_left;\r\n    \r\n        if(evaluateGrid()){\r\n            alert(\"game over\");\r\n            endGame();\r\n        }\r\n        else{\r\n            console.log(\"Redraw for add\");\r\n            m.redraw();\r\n            clock(1);\r\n        }\r\n    \r\n    }\r\n\r\n    function endGame(){\r\n        clock();\r\n        clearAllNodes();\r\n    }\r\n    \r\n    function clock(z){\r\n        if(z)\r\n            data.timer = setInterval(down, data.current_clock_value);\r\n        else\r\n            if(typeof data.timer == 'number')\r\n                clearInterval(data.timer);\r\n    }\r\n    \r\n    function checkClearLine(){\r\n        var a=[],b,c=0,d,i,e,s;\r\n    \r\n        let lineCount = 0;\r\n\r\n        for(b=data.mark_top-data.piece_height;b<data.grid_height;b++){\r\n            if(b>-1){\r\n                d=1;\r\n                for(i=0;i<data.grid_width;i++){\r\n                    e=data.grid[i][b];\r\n                    if(!e.dropped)\r\n                        d=0;\r\n                    \r\n                }\r\n                if(d){\r\n                    c=1;\r\n                    clock();\r\n                    a[a.length]=b;\r\n                }\r\n            }\r\n            else\r\n                b=-1;\r\n        }\r\n\r\n        if(c){\r\n            for(i=0;i<a.length;i++){\r\n                for(b=0;b<data.grid_width;b++){\r\n                    e = data.grid[b][a[i]];\r\n                    e.dropped = 0;\r\n                    e.color = \"white\";\r\n                    e.active = false;\r\n                }\r\n        \r\n                if(data.mark_top<data.grid_height)\r\n                    data.mark_top++;\r\n        \r\n                e = a[i]-1;\r\n                if(e>0){\r\n                    for(b=e;b>-1;b--){\r\n                        for(d=0;d<data.grid_width;d++){\r\n                            c = data.grid[d][b];\r\n                            if(c.dropped && b<data.grid_height){\r\n                            \r\n                                c.dropped = 0;\r\n                                c.active = false;\r\n                                s = c.color;\r\n                                c.color = \"white\";\r\n                                c = data.grid[d][b+1];\r\n                                c.dropped = 1;\r\n                                c.active = true;\r\n                                c.color = s;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                lineCount++;\r\n                //data.lines++;\r\n                data.next_level++;\r\n                if(a.length > 3)\r\n                    data.point_modifier += .5;\r\n        \r\n            }\r\n        \r\n        \r\n            if(data.next_level >= data.next_level_requirement){\r\n                data.next_level=0;\r\n                if(data.level<data.levels.length-1) data.level++;\r\n        \r\n                data.current_clock_value = data.levels[data.level];\r\n\r\n                clock();\r\n                clock(1);\r\n        \r\n            }\r\n        }\r\n        if(lineCount > 0){\r\n            data.lines += lineCount;\r\n            data.score += parseInt(data.point_modifier * lineCount);\r\n            console.log(data.point_modifier + \" / \" + lineCount);\r\n        }\r\n    }\r\n    \r\n    function tryStart(){\r\n        if(!data.piece_is_active)\r\n            addPiece();\r\n        \r\n    }\r\n    \r\n    function rotatePiece(i){\r\n        /* Checking the drop status is redundant since the piece vectors should be flagged in the grid. */\r\n        if(!data.piece_is_dropped && data.piece_is_active){\r\n            var o = data.piece_rotation;\r\n            data.piece_rotation += i;\r\n            if(data.piece_rotation > 3)\r\n                data.piece_rotation = 0;\r\n            \r\n            if(data.piece_rotation < 0)\r\n                data.piece_rotation= 3;\r\n            \r\n            if(evaluateGrid())\r\n                data.piece_rotation = o;\r\n            \r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    function down(){\r\n        var a,b,c,p;\r\n        if(!data.piece_is_dropped && data.piece_is_active){\r\n            data.current_piece_top++;\r\n            if(evaluateGrid(1)){\r\n                data.piece_is_active = 0;\r\n                for(a = data.current_piece_left; a < data.current_piece_left + data.piece_width; a++)\r\n                    if(typeof data.grid[a]== 'object')\r\n                        for(b = data.current_piece_top; b < data.current_piece_top + data.piece_height;b++)\r\n                            if(typeof data.grid[a][b]=='object'){\r\n                                c=data.grid[a][b];\r\n                                p=data.cubes[data.active_cube_index][a - data.current_piece_left][b - data.current_piece_top][data.piece_rotation];\r\n                                if(p && !c.dropped){\r\n                                    c.dropped=1;\r\n                                    if(b < data.mark_top)\r\n                                        data.mark_top = b;\r\n                                    \r\n                                }\r\n                            }\r\n\r\n                checkClearLine();\r\n                clock();\r\n                setTimeout(addPiece,1000);\r\n            }\r\n            else if(arguments[0] == 1){\r\n                data.point_modifier += 0.5;\r\n                setTimeout(function(){ down(1);}, 1);\r\n            }\r\n            else{\r\n                data.point_modifier += 0.1;\r\n            }\r\n            m.redraw();\r\n        }\r\n        else{\r\n            console.log(\"piece dropped or isn't active\");\r\n        }\r\n        \r\n    }\r\n    function move(z){\r\n        var p= ( z > 0 ? 'piece_on_right_edge' : 'piece_on_left_edge');\r\n        if(!data[p] && data.piece_is_active){\r\n            data.current_piece_left+=z;\r\n            if(!evaluateGrid( ( z > 0 ? 3 : 2) )){\r\n                data[p] = 0;\r\n            }\r\n            m.redraw();\r\n            \r\n        }\r\n    }\r\n\r\n    function clearAllNodes(){\r\n        var c,a,b;\r\n    \r\n        data.level=1;\r\n        data.score = 0;\r\n        data.init_game=0;\r\n        data.piece_is_active=0;\r\n        data.lines=0;\r\n        data.current_clock_value = 1000;\r\n    \r\n        clock();\r\n        \r\n        for(a = 0;a < data.grid_width; a++)\r\n            for(b = 0; b < data.grid_height; b++){\r\n                c = data.grid[a][b];\r\n                c.dropped = 0;\r\n                c.active = false;\r\n            }\r\n    }\r\n    \r\n\r\n    function keyControl(e){\r\n    \r\n        var i = e.keyCode;\r\n        /* Move a piece left */\r\n        if(i==37 || i==52 || i==100)\r\n            move(-1);\r\n    \r\n        /* Move a piece right */\r\n        if(i==39 || i==54 || i==102)\r\n            move(1);\r\n    \r\n        /* Drop a piece */\r\n        if(i == 38) down(1);\r\n        if(i==40 || i==50 || i==98)\r\n            down();\r\n\r\n        /* Rotate left */\r\n        if(i==44 || i==55 || i==188 || i==101)\r\n            rotatePiece(-1);\r\n    \r\n        /* Rotate right */\r\n        if(i==46 || i==57 || i==190)\r\n            rotatePiece(1);\r\n    \r\n        /* Reset */\r\n        if(i==82 || i==114)\r\n            clearAllNodes();\r\n    \r\n        /* Start */\r\n        if(i==83 || i==115)\r\n            tryStart();\r\n    \r\n    }\r\n\r\n    function moveLeft(){\r\n        move(-1);\r\n    }\r\n    function moveRight(){\r\n        move(1);\r\n    }\r\n\r\n    function rotateLeft(){\r\n        rotatePiece(-1);\r\n    }\r\n    function rotateRight(){\r\n        rotatePiece(1);\r\n    }\r\n    function drop(){\r\n        down();\r\n    }\r\n    function start(){\r\n        tryStart();\r\n    }\r\n    function stop(){\r\n        endGame();\r\n    }\r\n    function modelPanel(){\r\n        return [m(\"div\",{class: \"results-overflow\"},\r\n                    m(\"div\",{class: \"panel-card\"},\r\n                        m(\"p\", {\"class\" : \"card-title\"}, [\r\n                            m(\"span\", {class : \"material-icons material-icons-cm mr-2\"}, icon),\r\n                            label\r\n                        ]),\r\n                        m(\"div\", {\"class\": \"card-contents\"}, modelGame())\r\n                    )\r\n            ),\r\n            m(\"div\",{class: \"result-nav-outer\"},[\r\n                m(\"div\",{class: \"result-nav-inner\"},[\r\n                    m(\"div\",{class: \"result-nav tab-container\"},[\r\n                        page.iconButton(\"button\", \"undo\", \"\", rotateLeft),\r\n                        page.iconButton(\"button\", \"west\", \"\", moveLeft),\r\n                        page.iconButton(\"button\", \"south\", \"\", drop),\r\n                        page.iconButton(\"button\", \"east\", \"\", moveRight),\r\n                        page.iconButton(\"button\", \"redo\", \"\", rotateRight)\r\n                    ])\r\n                ])\r\n            ]),\r\n        ];\r\n    }\r\n\r\n    function modelGame(){\r\n        return refreshGrid();\r\n    }\r\n\r\n    function getScoreCard(){\r\n        return m(\"div\",{class: \"result-nav-outer\"},[\r\n            m(\"div\",{class: \"result-nav-inner\"},[\r\n                page.iconButton(\"button mr-4\", \"start\", \"\", start),\r\n                m(\"div\",{class: \"count-label mr-4\"},\"Level \" + (data ? data.level : 1)),\r\n                m(\"div\",{class: \"count-label mr-4\"},\"Score \" + (data ? data.score : 0)),\r\n                page.iconButton(\"button\", \"stop\", \"\", stop)\r\n            ])\r\n        ]);\r\n    }\r\n\r\n    tetris.component = {\r\n        keyHandler : keyControl,\r\n        scoreCard : getScoreCard,\r\n\r\n        oninit : function(x){\r\n            init();\r\n        },\r\n        oncreate : function (x) {\r\n\r\n        },\r\n        onremove : function(x){\r\n            endGame();\r\n        },\r\n\r\n        view: function () {\r\n            return modelPanel();\r\n         }\r\n    };\r\n\r\n    page.components.tetris = tetris.component;\r\n}());\r\n\n\n;/* === client/components/wordGame.js === */\n// Main Game Component\r\n\r\n// Word Game\r\n(function () {\r\n    let entity = {};\r\n    let fullMode = false;\r\n    let gridPath = \"/Olio/Universes/My Grid Universe/Worlds/My Grid World\";\r\n\r\n    // Array of common \"glue\" words for poetry.\r\n    const commonWords = [\r\n        'a', 'an', 'the', 'this', 'that', 'these', 'those', 'my', 'your', 'its', 'our', 'their', 'some', 'any', 'every', 'each', 'no',\r\n        'of', 'in', 'on', 'for', 'to', 'from', 'with', 'by', 'at', 'as', 'like', 'into', 'unto', 'over', 'under', 'above', 'below', 'beneath', 'beside', 'between', 'beyond', 'through', 'against', 'without', 'within', 'before', 'after', 'since', 'until',\r\n        'I', 'me', 'you', 'he', 'him', 'she', 'her', 'it', 'we', 'us', 'they', 'them', 'who', 'what', 'where', 'when', 'why', 'how',\r\n        'and', 'but', 'or', 'nor', 'so', 'yet', 'for', 'if', 'then', 'than', 'while', 'because', 'though',\r\n        'is', 'am', 'are', 'was', 'were', 'be', 'being', 'been', 'has', 'have', 'had', 'do', 'does', 'did', 'will', 'would', 'shall', 'should', 'can', 'could', 'may', 'might', 'must'\r\n    ];\r\n\r\n    // Function to shuffle and pick a new set of common words.\r\n    function randomizeCommonWords() {\r\n        const shuffled = commonWords.sort(() => 0.5 - Math.random());\r\n        data.activeCommonWords = shuffled.slice(0, 10); // Pick 10 random words\r\n    }\r\n\r\n    // --- UTILITY FUNCTIONS ---\r\n\r\n    function getWordColorClass(word) {\r\n        if (!word) return '';\r\n        let classes = '';\r\n\r\n        if (word.isLocked) {\r\n            classes += word.owner === 1 ? 'shadow-[0_0_8px_#60a5fa] ' : 'shadow-[0_0_8px_#4ade80] ';\r\n        }\r\n\r\n        if (word.isCustom) return classes + 'bg-gray-200 text-gray-800';\r\n\r\n        if (word.isCommon) {\r\n            if (word.player === 1) return classes + 'bg-blue-200 text-blue-800';\r\n            if (word.player === 2) return classes + 'bg-green-200 text-green-800';\r\n            return classes + 'bg-white text-black border border-gray-400';\r\n        }\r\n\r\n        switch (word.type) {\r\n            case 'n': return classes + 'bg-red-200 text-red-800';         // Noun\r\n            case 'v': return classes + 'bg-yellow-200 text-yellow-800';  // Verb\r\n            case 's': return classes + 'bg-purple-200 text-purple-800';    // Adjective\r\n            case 'a': return classes + 'bg-purple-200 text-purple-800';    // Adjective (alternate code)\r\n            case 'r': return classes + 'bg-indigo-200 text-indigo-800';   // Adverb\r\n            default:\r\n                if (word.player === 1) return classes + 'bg-blue-200 text-blue-800';\r\n                if (word.player === 2) return classes + 'bg-green-200 text-green-800';\r\n                return classes + 'bg-gray-300 text-gray-900';\r\n        }\r\n    }\r\n\r\n    function calculateTurnScore() {\r\n        if (data.timeLeft > 24) return 5;\r\n        if (data.timeLeft > 18) return 4;\r\n        if (data.timeLeft > 12) return 3;\r\n        if (data.timeLeft > 6) return 2;\r\n        return 1;\r\n    }\r\n\r\n\r\n    // --- GAME LOGIC AND STATE MANAGEMENT ---\r\n\r\n    function getInitialData() {\r\n        return {\r\n             endGameInfo: null,\r\n            isProcessingEndOfRound: false,\r\n            isGameStarted: false,\r\n            turn: 1, // 1 or 2\r\n            turnPoints: 5,\r\n            currentRound: 1,\r\n            actionsThisRound: 0,\r\n            commonWordUsedThisTurn: false,\r\n            timerId: null,\r\n            timeLeft: 30,\r\n            isPaused: false,\r\n            player1: {\r\n                name: \"Player 1\",\r\n                score: 0,\r\n                customWord: '',\r\n                customWordTimeout: null,\r\n            },\r\n            player2: {\r\n                name: \"Player 2\",\r\n                score: 0,\r\n                customWord: '',\r\n                customWordTimeout: null,\r\n                autopilot: false,\r\n            },\r\n            board: Array(8).fill(null).map(() => Array(10).fill(null)),\r\n            activeCommonWords: [],\r\n            left: [],\r\n            right: [],\r\n            foundCombinations: []\r\n        };\r\n    }\r\n\r\n    let data = getInitialData();\r\n    let coherenceScoreThreshold = 0.6;\r\n    let analyzing = false;\r\n    async function analyzeAndLockPhrases() {\r\n        if (analyzing) return;\r\n        scanForCombinations();\r\n        const phrasesToAnalyze = data.foundCombinations\r\n            .filter(combo => !combo.isLocked)\r\n            .map(combo => combo.phrase);\r\n\r\n        if (phrasesToAnalyze.length === 0) return;\r\n        analyzing = true;\r\n        try {\r\n            let resp = await m.request({\r\n                method: 'POST',\r\n                url: g_application_path + '/rest/word/analyze',\r\n                withCredentials: true,\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: { phrases: phrasesToAnalyze }\r\n            });\r\n\r\n            if (resp && resp.scores) {\r\n                resp.scores.forEach(scoredPhrase => {\r\n                    if (scoredPhrase.score >= coherenceScoreThreshold) {\r\n                        const comboToLock = data.foundCombinations.find(c => c.phrase === scoredPhrase.phrase);\r\n                        if (comboToLock) {\r\n                            // Determine ownership\r\n                            const p1Words = comboToLock.words.filter(w => w.player === 1).length;\r\n                            const p2Words = comboToLock.words.filter(w => w.player === 2).length;\r\n                            const owner = p1Words > p2Words ? 1 : (p2Words > p1Words ? 2 : data.turn);\r\n\r\n                            // Mark words on board as locked\r\n                            const phraseId = Date.now() + Math.random();\r\n                            comboToLock.words.forEach(wordInfo => {\r\n                                const boardWord = data.board[wordInfo.row][wordInfo.col];\r\n                                if (boardWord && boardWord.name === wordInfo.word) {\r\n                                    boardWord.isLocked = true;\r\n                                    boardWord.phraseId = phraseId;\r\n                                    boardWord.owner = owner;\r\n                                }\r\n                            });\r\n                            page.toast(\"success\", `Phrase \"${scoredPhrase.phrase}\" locked by Player ${owner}!`);\r\n                        }\r\n                    }\r\n                    else {\r\n                        console.log(`Phrase \"${scoredPhrase.phrase}\" not coherent enough to lock (score: ${scoredPhrase.score}).`);\r\n                    }\r\n                    analyzing = false;\r\n                });\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Error analyzing phrases:\", e);\r\n            page.toast(\"error\", \"Could not analyze phrases.\");\r\n            analyzing = false;\r\n        }\r\n    }\r\n\r\n\r\n    function scanForCombinations() {\r\n        const combinations = [];\r\n        data.board.forEach((row, rIdx) => {\r\n            let currentCombination = [];\r\n            row.forEach((cell, cIdx) => {\r\n                if (cell) {\r\n                    currentCombination.push({\r\n                        word: cell.name,\r\n                        player: cell.player,\r\n                        row: rIdx,\r\n                        col: cIdx,\r\n                        isLocked: !!cell.isLocked // Pass lock status\r\n                    });\r\n                } else {\r\n                    if (currentCombination.length >= 2) {\r\n                        combinations.push({\r\n                            phrase: currentCombination.map(c => c.word).join(' '),\r\n                            row: rIdx,\r\n                            words: currentCombination,\r\n                            isLocked: currentCombination.every(c => c.isLocked)\r\n                        });\r\n                    }\r\n                    currentCombination = [];\r\n                }\r\n            });\r\n            if (currentCombination.length >= 2) {\r\n                combinations.push({\r\n                    phrase: currentCombination.map(c => c.word).join(' '),\r\n                    row: rIdx,\r\n                    words: currentCombination,\r\n                    isLocked: currentCombination.every(c => c.isLocked)\r\n                });\r\n            }\r\n        });\r\n        data.foundCombinations = combinations;\r\n    }\r\n\r\nasync function handleEndOfRound() {\r\n        // --- STEP 1: Set processing state to show the overlay ---\r\n        data.isProcessingEndOfRound = true;\r\n        page.toast(\"info\", `Round ${data.currentRound} has ended! Calculating scores...`);\r\n        clearInterval(data.timerId);\r\n        data.isPaused = true;\r\n        m.redraw();\r\n\r\n        scanForCombinations();\r\n        const combinationsThisRound = [...data.foundCombinations];\r\n        \r\n        // Award initial points for all formed phrases\r\n        combinationsThisRound.forEach(combo => {\r\n            const p1Words = combo.words.filter(w => w.player === 1).length;\r\n            const p2Words = combo.words.filter(w => w.player === 2).length;\r\n            let owner = p1Words > p2Words ? 1 : (p2Words > p1Words ? 2 : 0);\r\n\r\n            if (owner !== 0) {\r\n                combo.owner = owner;\r\n                if (owner === 1) data.player1.score += 5; else data.player2.score += 5;\r\n                page.toast(\"success\", `Player ${owner} gets 5 points for forming \"${combo.phrase}\"`);\r\n            }\r\n        });\r\n\r\n        // --- STEP 2: Process all phrases serially using a for...of loop ---\r\n        const survivingPhrases = [];\r\n        const combosToEvaluate = combinationsThisRound.filter(c => c.owner);\r\n\r\n        // This for...of loop will pause and wait for each chat call\r\n        for (const combo of combosToEvaluate) {\r\n            try {\r\n                const response = await am7chat.chat(gameChat, combo.phrase);\r\n                const lastMessage = response?.messages?.[response.messages.length - 1]?.content;\r\n                \r\n                if (lastMessage && lastMessage.toLowerCase().trim() !== 'incoherent') {\r\n                    // Phrase is coherent, award bonus and mark for survival\r\n                    page.toast(\"success\", `Phrase \"${combo.phrase}\" is coherent! Player ${combo.owner} gets 10 bonus points!`);\r\n                    if (combo.owner === 1) data.player1.score += 10; else data.player2.score += 10;\r\n                    survivingPhrases.push(combo);\r\n                } else {\r\n                    // Phrase is incoherent\r\n                    page.toast(\"info\", `Phrase \"${combo.phrase}\" was incoherent and is removed.`);\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Error evaluating phrase:\", combo.phrase, e);\r\n                page.toast(\"error\", `Could not evaluate phrase: \"${combo.phrase}\"`);\r\n            }\r\n        }\r\n        \r\n        // --- STEP 3: Rebuild the board ---\r\n        const newBoard = Array(8).fill(null).map(() => Array(10).fill(null));\r\n        let nextAvailableRow = 0;\r\n        if( survivingPhrases.length === 0) {\r\n            page.toast(\"info\", \"No coherent phrases survived this round. Going to next round.\");\r\n        }\r\n        survivingPhrases.forEach(combo => {\r\n            if (nextAvailableRow < data.board.length) {\r\n                combo.words.forEach(wordInfo => {\r\n                    const originalWord = data.board[wordInfo.row][wordInfo.col];\r\n                    if (originalWord) newBoard[nextAvailableRow][wordInfo.col] = originalWord;\r\n                });\r\n                nextAvailableRow++;\r\n            }\r\n        });\r\n        data.board = newBoard;\r\n\r\n        // --- STEP 4: CHECK FOR END GAME CONDITION ---\r\n        // Condition: The number of surviving phrases equals the total number of rows.\r\n        if (survivingPhrases.length > 0 && survivingPhrases.length >= data.board.length) {\r\n            const finalPhraseStrings = survivingPhrases.map(p => p.phrase);\r\n            triggerEndGame(finalPhraseStrings); // Trigger the end game routine\r\n            return; // Stop the normal round progression\r\n        }\r\n\r\n        // --- STEP 5: Reset for the next round (if not game over) ---\r\n        data.currentRound++;\r\n        data.actionsThisRound = 0;\r\n        data.isPaused = false;\r\n        data.isProcessingEndOfRound = false; // Hide the overlay\r\n        page.toast(\"success\", `Starting Round ${data.currentRound}!`);\r\n        \r\n        switchTurn();\r\n        m.redraw();\r\n    }\r\n\r\n     async function triggerEndGame(finalPhrases) {\r\n        page.toast(\"success\", \"Game Over! All rows are coherent phrases!\");\r\n        \r\n        // 1. Determine the winner\r\n        let winner = \"It's a tie!\";\r\n        if (data.player1.score > data.player2.score) winner = \"Player 1 Wins!\";\r\n        if (data.player2.score > data.player1.score) winner = \"Player 2 Wins!\";\r\n\r\n        // 2. Stub out the final LLM call (as requested)\r\n        const finalPrompt = `Create a poem and brief analysis from the following coherent phrases:\\n\\n${finalPhrases.join(\"\\n\")}.`;\r\n        let finalMessage = \"### Final Summary\\n\\nThe AI summary could not be generated at this time.\";\r\n        try {\r\n            const response = await am7chat.chat(endGameChat, finalPrompt);\r\n            const content = response?.messages?.[response.messages.length - 1]?.content;\r\n            if (content) finalMessage = content;\r\n        } catch (e) {\r\n            console.error(\"Failed to get final game summary:\", e);\r\n        }\r\n\r\n        // 3. Set the state to show the popup\r\n        data.endGameInfo = {\r\n            winner: winner,\r\n            finalMessage: finalMessage\r\n        };\r\n        data.isProcessingEndOfRound = false; // Turn off the \"calculating\" screen\r\n        m.redraw();\r\n    }\r\n\r\n    //let chatName = \"WordBattle.chat\";\r\n    let chatName = \"A1 Mini\";\r\n    async function prepareChatConfig() {\r\n        return am7chat.makeChat(chatName, \"herm-local\", \"http://localhost:11434\", \"ollama\");\r\n    }\r\n\r\n    let endPromptName = \"WordBattleEndRound.prompt\";\r\n    async function prepareEndPrompt() {\r\n\r\n        return am7chat.makePrompt(endPromptName, [\r\n            \"You are the controller for a word battle game. You receive phrases you have identified as coherent.\",\r\n            \"Your job is to format these phrases into a poem.  You are allowed to make changes to each phrase by changing word order, tense, count, or adding pronoun, preposition, or conjunction.\",\r\n            \"The resulting poem may use any or no rhyme and meter.\",\r\n            \"Following the poem, you will include an analysis of the poem. For the analysis, you will adopt the persona of a very pompous literary critic who extolls the brilliance, profoundness, and genius of the poem while downplaying any negative qualities.\",\r\n            \"USE *markdown* TO FORMAT YOUR RESPONSE.\"\r\n        ]);\r\n    }\r\n\r\n\r\n    let promptName = \"WordBattlePhraseCoherence.prompt\";\r\n    async function preparePrompt() {\r\n\r\n        return am7chat.makePrompt(promptName, [\r\n            \"You are the controller for a word battle game. Random words will be assembled into phrases. Possible coherent phrases will be sent to you to be evaluated.\",\r\n            \"Your job is to evaluate these phrases and respond in one of three ways:\",\r\n            \"1. If the phrase is incoherent, respond with 'incoherent'.\",\r\n            \"2. If the phrase is coherent as-is, respond with the phrase itself.\",\r\n            \"3. If the phrase can be improved by changing word order, tense, count, etc, or by adding a pronoun, preposition, or conjunction, then respond with the improved phrase.\",\r\n            \"Example: 'Holbein fatally choke vicariously' -> 'Holbein fatally choked vicariously'\",\r\n            \"Example: 'aphyllous blood count' -> 'incoherent'\",\r\n            \"Example: 'blessed whistle' -> 'blessed whistle'\",\r\n            \"Example: 'like blessed whistle knock' -> 'knocked like a blessed whistle'\"\r\n        ]);\r\n    }\r\n\r\n    let chatRequestName = \"WordBattle Chat\";\r\n    let endChatRequestName = \"WordBattle End Chat\";\r\n\r\n    let endPromptCfg = null;\r\n    let promptCfg = null;\r\n    let chatCfg = null;\r\n    let gameChat = null;\r\n    let endGameChat = null;\r\n    async function startGame() {\r\n        promptCfg = await preparePrompt();\r\n        if (!promptCfg) {\r\n            page.toast(\"Error\", \"Could not start game without prompt config\");\r\n            return;\r\n        }\r\n        endPromptCfg = await prepareEndPrompt();\r\n        if (!promptCfg) {\r\n            page.toast(\"Error\", \"Could not start game without end prompt config\");\r\n            return;\r\n        }\r\n\r\n        chatCfg = await prepareChatConfig();\r\n        if (!chatCfg) {\r\n            page.toast(\"Error\", \"Could not start game without chat config\");\r\n            return;\r\n        }\r\n        gameChat = await am7chat.getChatRequest(chatRequestName, chatCfg, promptCfg);\r\n        if (!gameChat) {\r\n            page.toast(\"Error\", \"Could not start game without chat request\");\r\n            return;\r\n        }\r\n\r\n        endGameChat = await am7chat.getChatRequest(endChatRequestName, chatCfg, endPromptCfg);\r\n        if (!endGameChat) {\r\n            page.toast(\"Error\", \"Could not start game without end chat request\");\r\n            return;\r\n        }\r\n\r\n\r\n        await prepareWords();\r\n        data.isGameStarted = true;\r\n\r\n        startTimer();\r\n    }\r\n\r\n    function resetGame() {\r\n        clearInterval(data.timerId);\r\n        page.toast(\"info\", \"Game has been reset.\");\r\n        data = getInitialData();\r\n        setup();\r\n    }\r\n\r\n    function togglePause() {\r\n        if (!data.isGameStarted) return;\r\n        data.isPaused = !data.isPaused;\r\n        page.toast(\"info\", `Timer ${data.isPaused ? 'paused' : 'resumed'}.`);\r\n        m.redraw();\r\n    }\r\n\r\n    function exportBoardState() {\r\n        scanForCombinations(); // Ensure combinations are up-to-date\r\n        const exportedData = {\r\n            gameState: {\r\n                currentRound: data.currentRound,\r\n                actionsRemainingInRound: 20 - data.actionsThisRound,\r\n                scores: {\r\n                    player1: data.player1.score,\r\n                    player2: data.player2.score,\r\n                },\r\n            },\r\n            playerHands: {\r\n                player1: data.left.map(w => ({ name: w.name, type: w.type || (w.isCustom ? 'custom' : 'unknown') })),\r\n                player2: data.right.map(w => ({ name: w.name, type: w.type || (w.isCustom ? 'custom' : 'unknown') })),\r\n            },\r\n            board: [],\r\n            wordCombinations: data.foundCombinations\r\n        };\r\n\r\n        data.board.forEach((row, rIdx) => {\r\n            row.forEach((cell, cIdx) => {\r\n                if (cell) {\r\n                    exportedData.board.push({\r\n                        row: rIdx,\r\n                        col: cIdx,\r\n                        word: cell.name,\r\n                        type: cell.type || (cell.isCommon ? 'common' : 'custom'),\r\n                        player: cell.player,\r\n                        isLocked: !!cell.isLocked,\r\n                        owner: cell.owner || null\r\n                    });\r\n                }\r\n            });\r\n        });\r\n\r\n        const jsonString = JSON.stringify(exportedData, null, 2);\r\n        //console.log(\"Exported Board State:\", jsonString);\r\n        console.log(exportedData);\r\n\r\n        try {\r\n            const textArea = document.createElement(\"textarea\");\r\n            textArea.value = jsonString;\r\n            textArea.style.position = \"fixed\";\r\n            textArea.style.left = \"-9999px\";\r\n            document.body.appendChild(textArea);\r\n            textArea.focus();\r\n            textArea.select();\r\n            document.execCommand('copy');\r\n            document.body.removeChild(textArea);\r\n            page.toast(\"success\", \"Board state copied to clipboard!\");\r\n        } catch (err) {\r\n            page.toast(\"error\", \"Could not copy. See browser console for data.\");\r\n            console.error(\"Clipboard write failed:\", err);\r\n        }\r\n    }\r\n\r\n\r\n    function startTimer() {\r\n        clearInterval(data.timerId);\r\n        data.timeLeft = 30;\r\n        data.timerId = setInterval(() => {\r\n            if (data.isPaused) return;\r\n\r\n            data.timeLeft--;\r\n            if (data.timeLeft <= 0) {\r\n                page.toast(\"info\", `Player ${data.turn} ran out of time!`);\r\n                if (data.turn === 1) data.player1.score--;\r\n                else data.player2.score--;\r\n                switchTurn();\r\n            }\r\n            m.redraw();\r\n        }, 1000);\r\n    }\r\n\r\n    function switchTurn() {\r\n        data.turn = data.turn === 1 ? 2 : 1;\r\n        data.turnPoints = 5;\r\n        data.commonWordUsedThisTurn = false;\r\n        startTimer();\r\n\r\n        if (data.turn === 2 && data.player2.autopilot) {\r\n            setTimeout(runAutopilot, 1500);\r\n        }\r\n    }\r\n\r\n    function spendTurnPoints(points) {\r\n        data.turnPoints -= points;\r\n        if (data.turnPoints <= 0) {\r\n            data.actionsThisRound++;\r\n            if (data.actionsThisRound >= 20) {\r\n                // Trigger the new end-of-round logic\r\n                handleEndOfRound(); \r\n            } else {\r\n                // Continue to the next turn normally\r\n                setTimeout(switchTurn, 200);\r\n            }\r\n        }\r\n    }\r\n\r\n    function handleRefreshWords(playerNum) {\r\n        let player = playerNum === 1 ? data.player1 : data.player2;\r\n        let words = playerNum === 1 ? data.left : data.right;\r\n\r\n        if (words.length > 5) player.score--;\r\n        if (words.length >= 6) player.score -= 5;\r\n        page.toast(\"info\", `Player ${playerNum} refreshed their word list.`);\r\n        prepareWords(playerNum);\r\n    }\r\n\r\n    function handleCustomWord(playerNum, value) {\r\n        let player = playerNum === 1 ? data.player1 : data.player2;\r\n        player.customWord = value;\r\n\r\n        clearTimeout(player.customWordTimeout);\r\n        player.customWordTimeout = setTimeout(() => {\r\n            addCustomWord(playerNum);\r\n        }, 5000);\r\n    }\r\n\r\n    function addCustomWord(playerNum) {\r\n        let player = playerNum === 1 ? data.player1 : data.player2;\r\n        const wordName = player.customWord.trim();\r\n        if (wordName) {\r\n            const isDuplicate = data.left.some(w => w.name.toLowerCase() === wordName.toLowerCase()) ||\r\n                data.right.some(w => w.name.toLowerCase() === wordName.toLowerCase());\r\n\r\n            if (isDuplicate) {\r\n                page.toast(\"error\", \"Cannot add a duplicate word.\");\r\n                player.customWord = '';\r\n                return;\r\n            }\r\n\r\n            const newWord = { name: wordName, isCustom: true, definition: \"A custom word.\" };\r\n            if (playerNum === 1) data.left.unshift(newWord);\r\n            else data.right.unshift(newWord);\r\n            page.toast(\"info\", `Player ${playerNum} added the custom word '${wordName}'.`);\r\n            player.customWord = '';\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    function runAutopilot() {\r\n        if (data.turn !== 2 || !data.player2.autopilot) return;\r\n\r\n        const choice = Math.random();\r\n\r\n        let emptyCells = [];\r\n        data.board.forEach((row, rIdx) => row.forEach((cell, cIdx) => { if (!cell) emptyCells.push({ r: rIdx, c: cIdx }); }));\r\n\r\n        if (choice < 0.7 && data.right.length > 0 && emptyCells.length > 0) {\r\n            const wordToPlace = data.right[Math.floor(Math.random() * data.right.length)];\r\n            const wordIndex = data.right.indexOf(wordToPlace);\r\n            const targetCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];\r\n\r\n            const wordWithPlayer = { ...wordToPlace, player: 2 };\r\n            data.board[targetCell.r][targetCell.c] = wordWithPlayer;\r\n            data.right.splice(wordIndex, 1);\r\n\r\n            const points = calculateTurnScore();\r\n            data.player2.score += points;\r\n            page.toast(\"info\", `Autopilot placed '${wordWithPlayer.name}' for ${points} points.`);\r\n            analyzeAndLockPhrases();\r\n            spendTurnPoints(5);\r\n            if (data.right.length < 5) prepareWords(2, true);\r\n        }\r\n        else if (choice < 0.9 && !data.commonWordUsedThisTurn && emptyCells.length > 0) {\r\n            const wordToPlace = data.activeCommonWords[Math.floor(Math.random() * data.activeCommonWords.length)];\r\n            const targetCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];\r\n\r\n            const wordWithPlayer = { name: wordToPlace, isCommon: true, player: 2 };\r\n            data.board[targetCell.r][targetCell.c] = wordWithPlayer;\r\n            data.commonWordUsedThisTurn = true;\r\n            page.toast(\"info\", `Autopilot placed common word '${wordWithPlayer.name}'.`);\r\n            analyzeAndLockPhrases();\r\n            setTimeout(switchTurn, 200);\r\n        }\r\n        else {\r\n            page.toast(\"info\", \"Autopilot passed its turn.\");\r\n            switchTurn();\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    async function shiftWords(direction) {\r\n        // Unlock all words before shifting\r\n        data.board.forEach(row => row.forEach(cell => {\r\n            if (cell) {\r\n                cell.isLocked = false;\r\n                cell.phraseId = null;\r\n                cell.owner = null;\r\n            }\r\n        }));\r\n\r\n        const rows = data.board.length;\r\n        const cols = data.board[0].length;\r\n        const newBoard = Array(rows).fill(null).map(() => Array(cols).fill(null));\r\n\r\n        // **BUG FIX START**: Capture coordinates when gathering words.\r\n        const allWords = [];\r\n        data.board.forEach((row, rIdx) => row.forEach((cell, cIdx) => {\r\n            if (cell) allWords.push({ ...cell, row: rIdx, col: cIdx });\r\n        }));\r\n        // **BUG FIX END**\r\n\r\n        if (direction === 'up') {\r\n            for (let c = 0; c < cols; c++) {\r\n                const colWords = allWords.filter(w => w.col === c).sort((a, b) => a.row - b.row);\r\n                colWords.forEach((word, r) => newBoard[r][c] = word);\r\n            }\r\n        } else if (direction === 'down') {\r\n            for (let c = 0; c < cols; c++) {\r\n                const colWords = allWords.filter(w => w.col === c).sort((a, b) => b.row - a.row);\r\n                colWords.forEach((word, i) => newBoard[rows - 1 - i][c] = word);\r\n            }\r\n        } else if (direction === 'left') {\r\n            for (let r = 0; r < rows; r++) {\r\n                const rowWords = allWords.filter(w => w.row === r).sort((a, b) => a.col - b.col);\r\n                rowWords.forEach((word, c) => newBoard[r][c] = word);\r\n            }\r\n        } else if (direction === 'right') {\r\n            for (let r = 0; r < rows; r++) {\r\n                const rowWords = allWords.filter(w => w.row === r).sort((a, b) => b.col - a.col);\r\n                rowWords.forEach((word, i) => newBoard[r][cols - 1 - i] = word);\r\n            }\r\n        }\r\n\r\n        data.board = newBoard;\r\n        page.toast(\"info\", `Player ${data.turn} shifted the board ${direction}.`);\r\n        await analyzeAndLockPhrases();\r\n        spendTurnPoints(5);\r\n        m.redraw();\r\n    }\r\n\r\n\r\n    // --- DRAG AND DROP HANDLERS ---\r\n\r\n    function findEmptyAdjacent(row, col) {\r\n        const directions = [[0, 1], [0, -1], [1, 0], [-1, 0], [1, 1], [1, -1], [-1, 1], [-1, -1]];\r\n        for (const [dr, dc] of directions) {\r\n            const newRow = row + dr, newCol = col + dc;\r\n            if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 10 && !data.board[newRow][newCol]) {\r\n                return { r: newRow, c: newCol };\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    function handleGridDragStart(e, word, rowIndex, colIndex) {\r\n        e.stopPropagation();\r\n        e.dataTransfer.effectAllowed = 'move'; // Firefox compatibility\r\n        const payload = { word: word, source: 'board', rowIndex: rowIndex, colIndex: colIndex };\r\n        e.dataTransfer.setData(\"text/plain\", JSON.stringify(payload));\r\n    }\r\n\r\n    function handleDrop(e, targetRowIndex, targetColIndex) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const payload = JSON.parse(e.dataTransfer.getData(\"text/plain\"));\r\n\r\n        const targetCell = data.board[targetRowIndex][targetColIndex];\r\n        const emptySpot = findEmptyAdjacent(targetRowIndex, targetColIndex);\r\n\r\n        if (targetCell && targetCell.isLocked && emptySpot) {\r\n            page.toast(\"error\", \"Cannot bump a locked phrase.\");\r\n            return;\r\n        }\r\n\r\n        if (payload.source === 'common' && data.commonWordUsedThisTurn) return;\r\n        if ((payload.source === 'left' && data.turn !== 1) || (payload.source === 'right' && data.turn !== 2)) return;\r\n        if (payload.source === 'board' && payload.word.player !== data.turn) return;\r\n\r\n        const wordWithPlayer = { ...payload.word, player: data.turn };\r\n\r\n        if (targetCell) {\r\n            const bumpedWord = targetCell;\r\n            if (emptySpot) {\r\n                data.board[emptySpot.r][emptySpot.c] = bumpedWord;\r\n                page.toast(\"info\", `Player ${bumpedWord.player}'s word '${bumpedWord.name}' was bumped.`);\r\n            } else { // Destruction logic\r\n                if (bumpedWord.isLocked) {\r\n                    data.board.forEach(row => row.forEach(cell => {\r\n                        if (cell && cell.phraseId === bumpedWord.phraseId) {\r\n                            cell.isLocked = false;\r\n                            cell.phraseId = null;\r\n                            cell.owner = null;\r\n                        }\r\n                    }));\r\n                    page.toast(\"info\", `A locked phrase owned by Player ${bumpedWord.owner} was broken!`);\r\n                }\r\n                if (!bumpedWord.isCommon && !bumpedWord.isCustom) {\r\n                    if (bumpedWord.player === 1) data.player1.score -= 5;\r\n                    else data.player2.score -= 5;\r\n                    page.toast(\"info\", `Player ${bumpedWord.player}'s word '${bumpedWord.name}' was destroyed! (-5 points)`);\r\n                } else {\r\n                    page.toast(\"info\", `Player ${bumpedWord.player}'s word '${bumpedWord.name}' was destroyed!`);\r\n                }\r\n            }\r\n        }\r\n\r\n        data.board[targetRowIndex][targetColIndex] = wordWithPlayer;\r\n\r\n        if (payload.source !== 'board') page.toast(\"info\", `Player ${data.turn} placed the word '${wordWithPlayer.name}'.`);\r\n\r\n        if (payload.source === 'left') {\r\n            data.left.splice(payload.index, 1);\r\n            if (data.left.length < 5) prepareWords(1, true);\r\n        } else if (payload.source === 'right') {\r\n            data.right.splice(payload.index, 1);\r\n            if (data.right.length < 5) prepareWords(2, true);\r\n        } else if (payload.source === 'board') {\r\n            data.board[payload.rowIndex][payload.colIndex] = null;\r\n        } else if (payload.source === 'common') {\r\n            data.commonWordUsedThisTurn = true;\r\n        }\r\n\r\n        if (payload.source !== 'common' && payload.source !== 'board') {\r\n            const points = calculateTurnScore();\r\n            if (data.turn === 1) data.player1.score += points;\r\n            else data.player2.score += points;\r\n            page.toast(\"success\", `Player ${data.turn} scored ${points} points!`);\r\n            spendTurnPoints(5);\r\n        }\r\n\r\n        analyzeAndLockPhrases();\r\n        randomizeCommonWords();\r\n        m.redraw();\r\n    }\r\n\r\n    function handleTrashDrop(e) {\r\n        e.preventDefault();\r\n        const payload = JSON.parse(e.dataTransfer.getData(\"text/plain\"));\r\n\r\n        if (payload.source === 'board' && payload.word.player === data.turn) {\r\n            const wordToTrash = payload.word;\r\n            if (wordToTrash.isLocked) {\r\n                // If a locked word is trashed, unlock the entire phrase\r\n                data.board.forEach(row => row.forEach(cell => {\r\n                    if (cell && cell.phraseId === wordToTrash.phraseId) {\r\n                        cell.isLocked = false;\r\n                        cell.phraseId = null;\r\n                        cell.owner = null;\r\n                    }\r\n                }));\r\n                page.toast(\"info\", \"A locked phrase was broken!\");\r\n            }\r\n\r\n            if (!wordToTrash.isCommon && !wordToTrash.isCustom) {\r\n                if (data.turn === 1) data.player1.score -= 5;\r\n                else data.player2.score -= 5;\r\n            }\r\n            page.toast(\"info\", `Player ${data.turn} trashed the word '${wordToTrash.name}'.`);\r\n            data.board[payload.rowIndex][payload.colIndex] = null;\r\n            analyzeAndLockPhrases();\r\n            spendTurnPoints(5);\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n\r\n    // --- VIEW COMPONENTS ---\r\n\r\n    function modelPanel() {\r\n        if (!data.isGameStarted) {\r\n            return m(\"div\", { class: \"flex-grow flex items-center justify-center bg-gray-100 dark:bg-black\" }, [\r\n                m(\"div\", { class: \"text-center\" }, [\r\n                    m(\"h1\", { class: \"text-4xl font-bold mb-4 dark:text-white\" }, \"Word Battle\"),\r\n                    m(\"button\", { class: \"menu-button text-2xl p-4\", onclick: startGame }, \"Start Game\")\r\n                ])\r\n            ]);\r\n        }\r\n\r\n        return m(\"div\", { class: \"relative flex-grow overflow-hidden flex bg-white border border-gray-200 dark:bg-black dark:border-gray-700 dark:text-gray-200\" }, [\r\n            data.isProcessingEndOfRound ? m(\"div\", { class: \"absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50\" }, [\r\n                m(\"div\", { class: \"text-white text-2xl font-bold animate-pulse\" }, \"Calculating End of Round Scores...\")\r\n            ]) : null,\r\n            data.endGameInfo ? m(\"div\", { class: \"absolute inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4\" },\r\n                m(\"div\", { class: \"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-2xl w-full text-center\" }, [\r\n                    m(\"h1\", { class: \"text-4xl font-bold text-blue-500 mb-2\" }, \"Game Over!\"),\r\n                    m(\"h2\", { class: \"text-3xl font-semibold mb-4 dark:text-white\" }, data.endGameInfo.winner),\r\n                    m(\"div\", { class: \"prose dark:prose-invert text-left p-4 my-4 border rounded-md max-h-60 overflow-y-auto\" },\r\n                        // This will render the markdown from the AI\r\n                        m.trust(marked.parse(data.endGameInfo.finalMessage))\r\n                    ),\r\n                    m(\"button\", { \r\n                        class: \"menu-button text-xl p-3 mt-4\", \r\n                        onclick: resetGame \r\n                    }, \"Play Again\")\r\n                ])\r\n            ) : null,\r\n            m(\"div\", { class: \"flex flex-col w-full overflow-hidden p-0\" }, [\r\n                m(\"div\", { class: \"flex-1 overflow-hidden\" }, [\r\n                    m(\"div\", { class: \"max-h-full h-full flex\" }, [\r\n                        // Player 1 Panel\r\n                        m(\"div\", { class: `flex flex-col w-1/4 p-4 overflow-y-auto mx-auto ${data.turn === 1 ? 'bg-blue-100 dark:bg-blue-900' : ''}` }, [\r\n                            m(\"div\", { class: \"flex justify-between items-center\" }, [\r\n                                m(\"h3\", { class: \"text-lg font-bold\" }, \"Player 1\"),\r\n                                m(\"div\", { class: \"font-bold text-xl p-2 bg-gray-200 dark:bg-gray-700 rounded\" }, data.player1.score)\r\n                            ]),\r\n                            m(\"input\", {\r\n                                class: \"w-full p-1 my-2 border rounded\",\r\n                                placeholder: \"Add custom word...\",\r\n                                value: data.player1.customWord,\r\n                                oninput: (e) => handleCustomWord(1, e.target.value),\r\n                                onblur: () => addCustomWord(1),\r\n                                disabled: data.turn !== 1\r\n                            }),\r\n                            m(\"button\", { class: \"menu-button\", onclick: () => handleRefreshWords(1), disabled: data.turn !== 1 }, [m(\"span\", { class: \"material-symbols-outlined material-icons-24\" }, \"refresh\"), \"Refresh Words\"]),\r\n                            leftWords()\r\n                        ]),\r\n\r\n                        // Center Game Board Panel\r\n                        m(\"div\", { class: \"flex flex-col w-3/5 p-2 overflow-auto mx-auto\" }, [\r\n                            m(\"h2\", { class: \"text-center text-2xl font-bold\" }, \"Word Battle\"),\r\n                            m(\"div\", { class: \"text-center font-semibold text-lg\" }, `Round: ${data.currentRound} | Actions Left: ${20 - data.actionsThisRound}`),\r\n                            m(\"div\", { class: \"text-center font-semibold text-lg\" }, `Turn: Player ${data.turn} | Time: ${data.timeLeft}s | Turn Actions: ${data.turnPoints}`),\r\n                            m(\"div\", { class: \"menu-buttons-spaced my-2 justify-center\" },\r\n                                data.activeCommonWords.map(word =>\r\n                                    m(\"button\", {\r\n                                        draggable: !data.commonWordUsedThisTurn,\r\n                                        class: `menu-button ${getWordColorClass({ isCommon: true })} ${data.commonWordUsedThisTurn ? 'opacity-50 cursor-not-allowed' : ''}`,\r\n                                        ondragstart: (e) => {\r\n                                            if (data.commonWordUsedThisTurn) {\r\n                                                e.preventDefault();\r\n                                                return;\r\n                                            }\r\n                                            e.dataTransfer.effectAllowed = 'move'; // Firefox compatibility\r\n                                            const payload = { word: { name: word, isCommon: true }, source: 'common' };\r\n                                            e.dataTransfer.setData(\"text/plain\", JSON.stringify(payload));\r\n                                        }\r\n                                    }, word)\r\n                                )\r\n                            ),\r\n                            m(\"table\", { class: \"w-full border-collapse mt-2 table-fixed\" }, [\r\n                                m(\"tbody\",\r\n                                    data.board.map((row, rowIndex) =>\r\n                                        m(\"tr\", { key: rowIndex },\r\n                                            row.map((slot, colIndex) =>\r\n                                                m(\"td\", {\r\n                                                    class: \"border border-gray-500 h-12 p-1\",\r\n                                                    ondragover: (e) => e.preventDefault(),\r\n                                                    ondrop: (e) => handleDrop(e, rowIndex, colIndex)\r\n                                                },\r\n                                                    slot ? m(\"div\", {\r\n                                                        class: `p-1 rounded text-center text-sm cursor-move ${getWordColorClass(slot)}`,\r\n                                                        draggable: slot.player === data.turn && !slot.isLocked,\r\n                                                        title: slot.definition,\r\n                                                        ondragstart: (e) => handleGridDragStart(e, slot, rowIndex, colIndex)\r\n                                                    }, slot.name)\r\n                                                        : m(\"div\", { class: \"w-full h-full\" })\r\n                                                )\r\n                                            )\r\n                                        )\r\n                                    )\r\n                                )\r\n                            ]),\r\n                            m(\"div\", { class: \"flex justify-center items-center mt-2\" }, [\r\n                                m(\"button\", { class: \"menu-button\", onclick: resetGame }, m(\"span\", { class: \"material-symbols-outlined\" }, \"restart_alt\")),\r\n                                m(\"button\", { class: \"menu-button\", onclick: togglePause }, m(\"span\", { class: \"material-symbols-outlined\" }, data.isPaused ? \"play_arrow\" : \"pause\")),\r\n                                m(\"button\", { class: \"menu-button\", onclick: exportBoardState }, m(\"span\", { class: \"material-symbols-outlined\" }, \"download\")),\r\n                                m(\"button\", { class: \"menu-button\", onclick: () => shiftWords('up'), disabled: data.turnPoints < 5 }, m(\"span\", { class: \"material-symbols-outlined\" }, \"arrow_upward\")),\r\n                                m(\"button\", { class: \"menu-button\", onclick: () => shiftWords('down'), disabled: data.turnPoints < 5 }, m(\"span\", { class: \"material-symbols-outlined\" }, \"arrow_downward\")),\r\n                                m(\"button\", { class: \"menu-button\", onclick: () => shiftWords('left'), disabled: data.turnPoints < 5 }, m(\"span\", { class: \"material-symbols-outlined\" }, \"arrow_back\")),\r\n                                m(\"button\", { class: \"menu-button\", onclick: () => shiftWords('right'), disabled: data.turnPoints < 5 }, m(\"span\", { class: \"material-symbols-outlined\" }, \"arrow_forward\")),\r\n                                m(\"button\", { class: \"menu-button\", onclick: () => { page.toast(\"info\", `Player ${data.turn} passed their turn.`); switchTurn(); } }, \"Pass\"),\r\n                                m(\"button\", {\r\n                                    class: \"flyout-button text-center ml-2\",\r\n                                    ondragover: (e) => e.preventDefault(),\r\n                                    ondrop: handleTrashDrop\r\n                                }, [m(\"span\", { class: \"material-symbols-outlined material-icons-24\" }, \"delete\"), \"Trash\"])\r\n                            ])\r\n                        ]),\r\n\r\n                        // Player 2 Panel\r\n                        m(\"div\", { class: `flex flex-col w-1/4 p-4 overflow-y-auto mx-auto ${data.turn === 2 ? 'bg-green-100 dark:bg-green-900' : ''}` }, [\r\n                            m(\"div\", { class: \"flex justify-between items-center\" }, [\r\n                                m(\"h3\", { class: \"text-lg font-bold\" }, \"Player 2\"),\r\n                                m(\"div\", { class: \"font-bold text-xl p-2 bg-gray-200 dark:bg-gray-700 rounded\" }, data.player2.score)\r\n                            ]),\r\n                            m(\"input\", {\r\n                                class: \"w-full p-1 my-2 border rounded\",\r\n                                placeholder: \"Add custom word...\",\r\n                                value: data.player2.customWord,\r\n                                oninput: (e) => handleCustomWord(2, e.target.value),\r\n                                onblur: () => addCustomWord(2),\r\n                                disabled: data.turn !== 2\r\n                            }),\r\n                            m(\"button\", { class: \"menu-button\", onclick: () => handleRefreshWords(2), disabled: data.turn !== 2 }, [m(\"span\", { class: \"material-symbols-outlined material-icons-24\" }, \"refresh\"), \"Refresh Words\"]),\r\n                            m(\"label\", { class: \"flex items-center my-2\" }, [\r\n                                m(\"input\", {\r\n                                    type: \"checkbox\",\r\n                                    checked: data.player2.autopilot,\r\n                                    onchange: (e) => { data.player2.autopilot = e.target.checked; if (data.turn === 2 && data.player2.autopilot) runAutopilot(); }\r\n                                }),\r\n                                m(\"span\", { class: \"ml-2\" }, \"Autopilot\")\r\n                            ]),\r\n                            rightWords()\r\n                        ])\r\n                    ])\r\n                ])\r\n            ])\r\n        ]);\r\n    }\r\n\r\n    function leftWords() {\r\n        return data.left.map((word, index) => m(\"button\", {\r\n            draggable: data.turn === 1,\r\n            class: `flyout-button ${getWordColorClass(word)}`,\r\n            title: word.definition,\r\n            ondragstart: (e) => {\r\n                e.dataTransfer.effectAllowed = 'move'; // Firefox compatibility\r\n                const payload = { word: word, source: 'left', index: index };\r\n                e.dataTransfer.setData(\"text/plain\", JSON.stringify(payload));\r\n            }\r\n        }, word.name));\r\n    }\r\n\r\n    function rightWords() {\r\n        return data.right.map((word, index) => m(\"button\", {\r\n            draggable: data.turn === 2,\r\n            class: `flyout-button ${getWordColorClass(word)}`,\r\n            title: word.definition,\r\n            ondragstart: (e) => {\r\n                e.dataTransfer.effectAllowed = 'move'; // Firefox compatibility\r\n                const payload = { word: word, source: 'right', index: index };\r\n                e.dataTransfer.setData(\"text/plain\", JSON.stringify(payload));\r\n            }\r\n        }, word.name));\r\n    }\r\n\r\n    // --- DATA FETCHING AND SETUP ---\r\n\r\n    async function prepareWords(playerNum = null, isAutoRefresh = false) {\r\n        console.log(\"Preparing words by type...\");\r\n        let grp = await page.findObject(\"auth.group\", \"data\", \"/Library/Dictionary\");\r\n\r\n        let wordTargetCount = 8;\r\n        let wordCount = wordTargetCount;\r\n        if (playerNum) {\r\n            const currentWords = playerNum === 1 ? data.left : data.right;\r\n            wordCount = Math.max(0, wordTargetCount - currentWords.length);\r\n        }\r\n        if (wordCount <= 0 && isAutoRefresh) return;\r\n        if (wordCount <= 0 && !isAutoRefresh) wordCount = wordTargetCount;\r\n\r\n        const wordsPerType = Math.ceil(wordCount / 4);\r\n        const wordTypes = { 'v': 'verbs', 'n': 'nouns', 's': 'adjectives', 'r': 'adverbs' };\r\n        let wordDict = { nouns: [], verbs: [], adjectives: [], adverbs: [] };\r\n\r\n        for (const typeCode in wordTypes) {\r\n            let q = am7client.newQuery(\"data.wordNet\");\r\n            q.field(\"groupId\", grp.id);\r\n            q.field(\"type\", typeCode);\r\n            q.cache(false);\r\n            q.range(0, 30); // Fetch a larger pool to pick from\r\n            q.entity.request = [\"name\", \"groupId\", \"organizationId\", \"type\", \"definition\"];\r\n            q.entity.sortField = \"random()\";\r\n            let l = await page.search(q);\r\n            if (l && l.results) {\r\n                wordDict[wordTypes[typeCode]] = l.results;\r\n            }\r\n        }\r\n\r\n        const allExistingNames = new Set([...data.left.map(w => w.name.toLowerCase()), ...data.right.map(w => w.name.toLowerCase())]);\r\n\r\n        function getNewPlayerWords() {\r\n            let newWords = [];\r\n            for (const typeName in wordDict) {\r\n                const availableWords = wordDict[typeName].filter(w => !allExistingNames.has(w.name.toLowerCase()));\r\n                const picked = availableWords.slice(0, wordsPerType);\r\n                newWords.push(...picked);\r\n                picked.forEach(w => allExistingNames.add(w.name.toLowerCase()));\r\n            }\r\n            return newWords.sort(() => 0.5 - Math.random());\r\n        }\r\n\r\n        const assignWords = (playerList) => {\r\n            const newWords = getNewPlayerWords();\r\n            if (isAutoRefresh || playerNum) {\r\n                return playerList.concat(newWords);\r\n            } else {\r\n                return newWords;\r\n            }\r\n        };\r\n\r\n        if (playerNum === 1) {\r\n            data.left = assignWords(data.left);\r\n        } else if (playerNum === 2) {\r\n            data.right = assignWords(data.right);\r\n        } else {\r\n            data.left = assignWords([]);\r\n            data.right = assignWords([]);\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    function setup() {\r\n        console.log(\"Setup\");\r\n        randomizeCommonWords();\r\n        // Words will be prepared when the game is started\r\n    }\r\n\r\n    async function testEndGame() {\r\n        console.log(\"--- Running testEndGame ---\");\r\n\r\n        // 1. Set up initial game state for the test\r\n        data.player1.score = 100;\r\n        data.player2.score = 50;\r\n\r\n        // 2. Set up local dependencies required by triggerEndGame\r\n        endPromptCfg = await prepareEndPrompt();\r\n        chatCfg = await prepareChatConfig();\r\n        endGameChat = await am7chat.getChatRequest(endChatRequestName, chatCfg, endPromptCfg);\r\n\r\n        // 3. Invoke triggerEndGame with an array of 5 phrases\r\n        const testPhrases = [\"the quick brown fox\", \"jumps over the lazy dog\", \"a stitch in time\", \"saves nine\", \"an apple a day\"];\r\n        await triggerEndGame(testPhrases);\r\n\r\n        console.log(\"--- testEndGame Finished ---\");\r\n        console.log(\"Final data.endGameInfo:\", data.endGameInfo);\r\n    }\r\n\r\n    let wordGame = {\r\n        scoreCard: () => \"\",\r\n        oninit: function () {\r\n            setup();\r\n        },\r\n        onremove: function () {\r\n            if (data) {\r\n                data.isPaused = true;\r\n            }\r\n            if(gameChat){\r\n                am7chat.deleteChat(gameChat, true);\r\n            }\r\n            if(endGameChat){\r\n                am7chat.deleteChat(endGameChat, true);\r\n            }\r\n            clearInterval(data.timerId); // Cleanup timer on component removal\r\n        },\r\n        view: function () {\r\n            return modelPanel();\r\n        },\r\n        testEndGame: testEndGame // Exposing the test function\r\n    };\r\n    page.components.wordGame = wordGame;\r\n}());\r\n\n\n;/* === client/components/breadcrumb.js === */\n(function () {\r\n    \r\n    let crumbButtons;\r\n    let showBreadcrumb = false;\r\n\r\n    function modelBreadCrumb() {\r\n        let oL = document.querySelector(\"#listBreadcrumb\");\r\n        let sPath = page.user.homeDirectory.path;\r\n        let model = page.context();\r\n\r\n        let objectId = m.route.param(\"objectId\");\r\n\r\n        let modType;\r\n        let type = m.route.param(\"type\") || \"data.data\";\r\n        if (type) {\r\n            modType = am7model.getModel(type);\r\n            type = modType.type || type;\r\n        }\r\n\r\n        let objType = type;\r\n        if (m.route.get().match(/\\/(list|new)\\//gi)) {\r\n            objType = \"auth.group\";\r\n        }\r\n\r\n        if (modType && am7model.isGroup(modType) && objectId != null && objectId != \"null\" && objectId != undefined && objectId != \"undefined\") {\r\n            let typeUdef = typeof model.contextObjects[objectId] == \"undefined\";\r\n            if (typeUdef || model.contextObjects[objectId] == null) {\r\n                model.contextObjects[objectId] = null;\r\n                am7client.get(objType, objectId, function (v) {\r\n                    if(v && v != null){\r\n                        model.contextObjects[objectId] = v;\r\n                        m.redraw();\r\n                    }\r\n                    else{\r\n                        console.error(\"Failed to retrieve group\", objType, objectId);\r\n                    }\r\n                });\r\n            }\r\n            else if (!typeUdef && model.contextObjects[objectId] != null) {\r\n                sPath = model.contextObjects[objectId][(objType.match(/^auth\\.group/gi) ? \"path\" : \"groupPath\")];\r\n            }\r\n        }\r\n\r\n        let crumbs = [];\r\n        crumbButtons = [];\r\n        if (!sPath || !sPath.length) {\r\n            console.warn(\"Unexpected path: \" + sPath);\r\n            return crumbs;\r\n        }\r\n        let aSp = sPath.split(\"/\").slice(1);\r\n        let bBack = [];\r\n\r\n\r\n        aSp.forEach((p) => {\r\n            bBack.push(\"/\" + p);\r\n\r\n            let bJoi = bBack.join(\"\");\r\n            let id = bJoi.replace(/\\//g, \"zZz\").replace(/\\s/g, \"yYy\");\r\n            let bid = id + \"Button\";\r\n            let handler;\r\n            let menuCls = \"context-menu-container-slim\";\r\n            let btnCls = \"multi-button\";\r\n            let disabled = false;\r\n            if ((bJoi.match(/^\\/home$/gi) || bJoi.match(/^\\/$/)) && !page.context().roles.admin) {\r\n                menuCls += \" context-menu-container-disabled\";\r\n                btnCls = \"multi-button-disabled\";\r\n                disabled = true;\r\n            }\r\n            else {\r\n                handler = function () { page.navigateToPath(type, modType, bJoi).then((id) => { page.listByType(type, id); }); }\r\n            }\r\n\r\n\r\n            if (!disabled) crumbButtons.push({ id: id, bid: bid, path: bJoi, items: [] });\r\n            crumbs.push(m(\"li\", \"/\"));\r\n            crumbs.push(m(\"li\", [\r\n                m(\"div\", { class: menuCls }, [\r\n                    m(\"button\" + (disabled ? \"[disabled = 'true']\" : \"\"), { onclick: handler, class: \"rounded-l \" + btnCls }, p),\r\n                    (!disabled ? m(\"button\", { id: bid, class: \"rounded-r \" + btnCls }, m(\"span\", { class: \"material-symbols-outlined material-icons-cm\" }, \"expand_more\")) : \"\"),\r\n                    (!disabled ? m(\"div\", { id: id, class: \"transition transition-0 context-menu-48\" }, [\r\n                        page.navigable.contextMenuButton(id, \"Loading\", \"folder_off\"),\r\n                    ]) : \"\")\r\n                ])\r\n\r\n            ]));\r\n\r\n        });\r\n        return crumbs;\r\n    }\r\n\r\n\r\n\r\n    function buildBreadCrumb() {\r\n        if(!showBreadcrumb) return \"\";\r\n        let type = m.route.param(\"type\") || \"data.data\";\r\n        let modType = am7model.getModel(type);\r\n\r\n        return m(\"nav\", { class: \"breadcrumb-bar\" }, [\r\n            m(\"div\", { class: \"breadcrumb-container\" }, [\r\n                m(\"nav\", { class: \"breadcrumb\" }, [\r\n                    m(\"ol\", { id: \"listBreadcrumb\", class: \"breadcrumb-list\" }, [\r\n                        m(\"li\", m(\"span\", { class: \"material-symbols-outlined material-icons-24\" }, modType.icon)),\r\n                        modelBreadCrumb()\r\n                    ])\r\n                ])\r\n            ])\r\n        ]);\r\n\r\n    }\r\n\r\n    function contextMenuItemHandler(query, object) {\r\n        let aP = query.items.filter((i) => {\r\n            if (object.path == i.path) return true;\r\n        });\r\n\r\n        let type = 'data';\r\n        let modType = am7view.typeByPath(object.name) || \"data.data\";\r\n        if (modType) type = modType;\r\n        if (aP.length) {\r\n            page.listByType(type, aP[0].objectId);\r\n        }\r\n    }\r\n\r\n    function configureContextMenus() {\r\n        if(!showBreadcrumb){\r\n            return;\r\n        }\r\n\r\n        crumbButtons.forEach((v) => {\r\n            page.navigable.addContextMenu(\"#\" + v.id, \"#\" + v.bid, {\r\n                menu: v.id,\r\n                action: \"list\",\r\n                type: \"auth.group\",\r\n                subType: \"data\",\r\n                objectId: 0,\r\n                path: v.path,\r\n                handler: contextMenuItemHandler,\r\n                icon: \"folder\"\r\n            });\r\n        });\r\n    }\r\n    function cleanupContextMenus() {\r\n        if(crumbButtons){\r\n            crumbButtons.forEach((v) => page.navigable.removeContextMenu(\"#\" + v.id));\r\n        }\r\n    }\r\n    function setupDisplayState() {\r\n        configureContextMenus();\r\n    }\r\n    let breadCrumb = {\r\n        toggleBreadcrumb: function(){\r\n            showBreadcrumb = !showBreadcrumb;\r\n            m.redraw();\r\n        },\r\n        oninit: function (x) {\r\n\r\n        },\r\n        onupdate: function () {\r\n            cleanupContextMenus();\r\n            setupDisplayState();\r\n        },\r\n        oncreate: function (x) {\r\n            setupDisplayState();\r\n\r\n        },\r\n        onremove: function (x) {\r\n            cleanupContextMenus();\r\n        },\r\n\r\n        view: function () {\r\n            return m(\"div\", { avoid: \"1\", class: \"\" },\r\n                buildBreadCrumb()\r\n            );\r\n        }\r\n    };\r\n\r\n    page.components.breadCrumb = breadCrumb;\r\n}());\r\n\n\n;/* === client/components/asideMenu.js === */\n(function () {\r\n    const asideMenu = {};\r\n    let vnode;\r\n    let app;\r\n\r\n    function button(sLabel, sIco, icoId, cls, fHandler, fHold) {\r\n        let fWrapper = function (e) {\r\n            if (!fHold) page.navigable.drawer();\r\n            if (fHandler) fHandler(e);\r\n        };\r\n        let btnCls = \"flyout-button\";\r\n        if (cls) {\r\n            btnCls += \" \" + cls;\r\n        }\r\n        return m(\"button\", { onclick: fWrapper, class: btnCls }, (sIco ? m(\"span\", { id: icoId, class: \"mr-2 material-symbols-outlined\" }, sIco) : \"\"), (sLabel || \"\"));\r\n    }\r\n\r\n    function clicky() {\r\n        console.log(\"Clicky!\");\r\n    }\r\n    function expandCategory(key) {\r\n        expanded = key;\r\n    }\r\n    let expanded;\r\n    function getCategories() {\r\n        let cats = [];\r\n        let model = am7model;\r\n        model.categories.forEach(cat => {\r\n            let k = cat.name;\r\n            if (!expanded) {\r\n                expanded = k;\r\n            }\r\n            cats.push(button(cat.label, cat.icon, undefined, undefined, function (e) { expandCategory(k); }, true));\r\n            if (expanded == k) {\r\n                let order = cat.order;\r\n                if (!order) {\r\n                    order = [];\r\n                    Object.keys(model.types).forEach((l) => { if (types[l].category == key) order.push(key); });\r\n                }\r\n                order.forEach((l) => {\r\n                    let item = am7model.getModel(l);\r\n                    if (cat.prototype && cat.prototype[l]) item = cat.prototype[l];\r\n                    if (item == null) console.error(\"Null item for \" + l);\r\n                    else {\r\n                        cats.push(button(item.label || l, item.icon, undefined, \"ml-4\", function (e) { page.components.panel.clickPanelItem(item, l); }));\r\n                    }\r\n\r\n                });\r\n            }\r\n            /// add in sub cat buttons\r\n        });\r\n        return cats;\r\n    }\r\n\r\n    asideMenu.component = {\r\n        oninit: function (x) {\r\n\r\n        },\r\n        oncreate: function (x) {\r\n            //app = page.space(entityName, x, {});\r\n        },\r\n        onremove: function (x) {\r\n            if (app) app.destroy();\r\n        },\r\n\r\n        view: function () {\r\n            vnode = m(\"aside\", {\r\n                class: \"transition transition-0\"\r\n            }, [\r\n                m(\"span\", { class: \"flyout-banner\" }, [\r\n                    m(\"img\", { src: \"/media/logo_128.png\", class: \"object-scale-down h-24 w-24\" })\r\n                ]),\r\n                m(\"div\", {class: \"flyout-body\"}, [\r\n                    button(\"Home\", \"home\"),\r\n                    //getCategories(),\r\n                ]),\r\n                m(\"div\", { class: \"flyout-gutter\" }, [\r\n                    button(\"Dark Mode\", \"dark_mode\", null, undefined, async function(){ let de = document.documentElement; let cls = de.className; if(cls != \"dark\") de.className = \"dark\"; else de.className = \"light\";}),\r\n                    button(\"Breadcrumb Bar\", \"footprint\", null, undefined, async function(){ page.components.breadCrumb.toggleBreadcrumb();}),\r\n                    button(\"Mood Ring\", \"mood\", null, (page.components.moodRing && page.components.moodRing.enabled() ? \"active\" : \"\"), async function(){ if(page.components.moodRing) await page.components.moodRing.toggle(); m.redraw(); }, true),\r\n                    button(\"Clear Cache\", \"cached\", null, undefined, async function(){ await am7client.clearCache();}),\r\n                    button(\"Cleanup\", \"cached\", null, undefined, async function(){ await page.cleanup();})\r\n                ])\r\n            ]);\r\n            return vnode;\r\n        }\r\n    };\r\n\r\n    page.components.asideMenu = asideMenu.component;\r\n}());\r\n\n\n;/* === client/components/topMenu.js === */\n\r\n(function () {\r\n    const topMenu = {};\r\n    let vnode;\r\n    let app;\r\n    let profileDimensions = \"48x48\";\r\n    let dnd = page.components.dnd;\r\n    let showFavButton = true;\r\n    let trayExpanded = false;\r\n    let shutOnEmpty = true;\r\n\r\n    function button(sLabel, sIco, sCls, fHandler, sAltIco) {\r\n        let props = {};\r\n        if (typeof fHandler == \"function\") {\r\n            props = { onclick: fHandler };\r\n        }\r\n        else if (typeof fHandler == \"object\") {\r\n            props = fHandler;\r\n        }\r\n        props.class = \"menu-button\" + (sCls ? \" \" + sCls : \"\");\r\n        return m(\"button\", props, (sIco ? m(\"span\", { class: (sLabel ? \"mr-2 \" : \"\") + \"material-symbols-outlined\" + (sAltIco ? \" \" + sAltIco : \"\") }, sIco) : \"\"), (sLabel || \"\"));\r\n    }\r\n    function profileContextButton() {\r\n        let xProf = am7client.getAttributeValue(page.user, \"v1-profile-path\", 0);\r\n        let img;\r\n        if (xProf) img = m(\"img\", { class: \"h-8 w-8 rounded-full\", src: g_application_path + \"/thumbnail/\" + xProf + \"/\" + profileDimensions });\r\n        else img = m(\"span\", { class: \"material-symbols-outlined\" }, \"account_circle\");\r\n        return m(\"button\", { id: \"profileContextMenuButton\", class: \"context-menu-button px-2 py-1 space-x-4\" }, [img]);\r\n\r\n    }\r\n\r\n    let activeShuffle;\r\n    let favGroup;\r\n    function doPickShuffle(object, filter) {\r\n\r\n        let bBlend = object[am7model.jsonModelKey].match(/^(auth\\.group|auth\\.role|data\\.tag|olio\\.event)$/gi);\r\n        if (!filter || (filter && bBlend) || !activeShuffle) {\r\n            activeShuffle = object;\r\n        }\r\n    }\r\n\r\n    async function loadFavGroup() {\r\n        if (favGroup) return favGroup;\r\n        let grp = await page.favorites();\r\n        favGroup = grp;\r\n        if (!activeShuffle) {\r\n            activeShuffle = grp;\r\n            dnd.workingSet.push(grp);\r\n        }\r\n        //m.redraw();\r\n    }\r\n    function shuffleTray() {\r\n\r\n        let buttons = dnd.workingSet.map((o) => {\r\n            if (activeShuffle && activeShuffle.objectId == o.objectId) {\r\n                let modType = am7model.getModel(o[am7model.jsonModelKey]);\r\n                let icon = \"device_unknown\";\r\n                if (modType.icon) {\r\n                    icon = modType.icon;\r\n                }\r\n                return button(o.name, icon, \"truncate\");\r\n            }\r\n            return \"\";\r\n        });\r\n        let workingBtns = [];\r\n        let bid = \"shuffleButton\";\r\n        let mid = bid + \"-menu\";\r\n        let blendable = false;\r\n        let blendy = false;\r\n        let blendCls = \"\";\r\n        dnd.workingSet.forEach((o) => {\r\n            if ((activeShuffle && activeShuffle.objectId == o.objectId) || o[am7model.jsonModelKey].match(/^(auth\\.group|auth\\.role|data\\.tag|olio\\.event)$/gi)) {\r\n                blendable = true;\r\n            }\r\n            else {\r\n                blendy = true;\r\n            }\r\n            let modType = am7model.getModel(o[am7model.jsonModelKey]);\r\n            let icon = \"device_unknown\";\r\n            if (modType.icon) {\r\n                icon = modType.icon;\r\n            }\r\n            workingBtns.push(page.navigable.contextMenuButton(mid, o.name, icon, function () { doPickShuffle(o); }));\r\n        });\r\n        if (blendable && blendy) {\r\n            blendCls = \"material-symbols-outlined-orange active-orange\";\r\n            if (dnd.workingSet.length > 2) blendCls += \" filled\";\r\n        }\r\n\r\n        let favButton = \"\";\r\n        let blendButton = \"\";\r\n        let backButton = \"\";\r\n        let expanded = (trayExpanded || dnd.workingSet.length > 0);\r\n        if (expanded) {\r\n            if (showFavButton) {\r\n                favButton = button(0, \"favorite\", \"\", async function () {\r\n                    await loadFavGroup();\r\n                    if (dnd.workingSet.filter(f => f.objectId == favGroup.objectId).length == 0) {\r\n                        dnd.workingSet.push(favGroup);\r\n                    }\r\n                    activeShuffle = favGroup;\r\n                    m.redraw();\r\n                });\r\n            }\r\n            backButton = button(0, \"backspace\", \"\", function () {\r\n                dnd.workingSet.length = 0;\r\n                activeShuffle = undefined;\r\n                if (shutOnEmpty) expanded = false;\r\n            });\r\n        }\r\n\r\n        blendButton = button(0, \"blender\", \"\", async function () {\r\n            if (dnd.workingSet.length == 0) {\r\n                trayExpanded = !trayExpanded;\r\n            }\r\n            else {\r\n                await dnd.doBlend((activeShuffle ? activeShuffle.objectId : undefined));\r\n                m.redraw();\r\n            }\r\n        }, blendCls);\r\n\r\n\r\n        buttons.push(favButton, backButton, blendButton);\r\n\r\n        let menuCls = \"menu\";\r\n        let trayCls = \"place-content-end menu-buttons ml-4\";\r\n        if (expanded) {\r\n            trayCls += \" w-96 bg-orange-100 border rounded-lg border-orange-600\";\r\n        }\r\n        else {\r\n            menuCls = \"hidden\";\r\n        }\r\n\r\n        let tray = m(\"div[draggable]\", {\r\n            class: trayCls,\r\n            ondragover: function (e) {\r\n                e.preventDefault();\r\n            },\r\n            ondrop: function (e) {\r\n                //activeShuffle = dnd.dragTarget;\r\n                doPickShuffle(dnd.dragTarget, true);\r\n                dnd.doDrop(e, \"set\");\r\n            }\r\n        }, [\r\n            buttons,\r\n            button(0, \"menu\", menuCls, { id: bid }),\r\n            m(\"div\", { class: \"context-menu-container\" }, [\r\n                m(\"div\", { class: \"transition transition-0 context-menu-96\", id: mid }, [\r\n                    workingBtns\r\n                ])\r\n            ])\r\n        ]);\r\n        page.navigable.pendContextMenu(\"#\" + mid, \"#\" + bid, null, \"context-menu-96\");\r\n        return tray;\r\n    }\r\n   \r\n\r\n    topMenu.component = {\r\n        menuButton: button,\r\n        activeShuffle: function(o){\r\n            activeShuffle = o;\r\n        },\r\n        oninit: function (x) {\r\n            page.navigable.setupPendingContextMenus();\r\n        },\r\n        oncreate: function (x) {\r\n            page.navigable.addContextMenu(\"#profileContextMenu\", \"#profileContextMenuButton\");\r\n        },\r\n        onupdate: function () {\r\n            page.navigable.setupPendingContextMenus();\r\n        },\r\n        onremove: function (x) {\r\n            if (app) app.destroy();\r\n        },\r\n\r\n        view: function (x) {\r\n            let lastNot;\r\n            let not = page.context().notifications;\r\n            let notiActive = (not && not.length && not[not.length - 1].newMessageCount > 0);\r\n            let mr = m.route.get();\r\n            vnode = m(\"div\", {\r\n                class: \"menu-bar\"\r\n            }, [\r\n                m(\"div\", { class: \"menu-bar-flex\" }, [\r\n                    m(\"div\", { class: \"flex-center\" }, [\r\n                        m(\"div\", { class: \"flex-shrink-0\" }, [\r\n                            m(\"img\", { class: \"h-8\", src: \"/media/logo_128_alt.png\" })\r\n                        ]),\r\n                        m(\"div\", { class: \"menu-buttons-spaced\" }, [\r\n                            button(null, \"dashboard\", (mr.match(/^\\/main/gi) ? \"active\" : \"\"), page.home),\r\n                            button(0, \"explore\", (mr.match(/^\\/nav/gi) ? \"active\" : \"\"), page.nav),\r\n                            button(0, \"chat\", (mr.match(/^\\/chat/gi) ? \"active\" : \"\"), page.chat),\r\n                            button(0, \"notifications\", (notiActive ? \"active-red\" : (mr.match(/^\\/list\\/message/gi) ? \"active\" : \"\")), page.messages)\r\n                        ])\r\n                    ]),\r\n                    (x.attrs.customTray ? x.attrs.customTray() : \"\"),\r\n                    shuffleTray(),\r\n                    m(\"div\", { class: \"flex-center2\" }, [\r\n                        m(page.components.games.component),\r\n                        m(page.components.emoji.component),\r\n                        (page.components.moodRing.enabled() ? m(page.components.moodRing.component) : \"\"),\r\n                        m(\"div\", { class: \"context-menu-container\" }, [\r\n                            profileContextButton(),\r\n                            m(\"div\", { id: \"profileContextMenu\", class: \"transition transition-0 context-menu-48\" }, [\r\n                                page.navigable.contextMenuButton(\".context-menu-48\", \"Your Profile\", \"account_circle\", page.profile),\r\n                                page.navigable.contextMenuButton(\".context-menu-48\", \"Your Settings\", \"settings\"),\r\n                                page.navigable.contextMenuButton(\".context-menu-48\", \"Sign Out\", \"lock\", page.logout)\r\n                            ])\r\n                        ])\r\n                    ])\r\n                ])\r\n            ]);\r\n            return vnode;\r\n        }\r\n    };\r\n\r\n\r\n    page.components.topMenu = topMenu.component;\r\n}());\r\n\n\n;/* === client/components/panel.js === */\n(function () {\r\n    const panel = {};\r\n\r\n    function modelPanel() {\r\n        let panels = [];\r\n        am7model.categories.forEach((cat) => {\r\n            let k = cat.name;\r\n            panels.push(\r\n                m(\"div\", { class: \"panel-card\" },\r\n                    m(\"p\", { \"class\": \"card-title\" }, [\r\n                        (cat.icon ? m(\"span\", { class: \"material-symbols-outlined material-icons-cm mr-2\" }, cat.icon) : \"\"),\r\n                        (cat.label || k)\r\n                    ]),\r\n                    m(\"div\", { \"class\": \"card-contents\" }, modelPanelContents(k))\r\n                )\r\n            );\r\n        });\r\n\r\n        return panels;\r\n\r\n    }\r\n\r\n    async function clickPanelItem(item, type) {\r\n        let path = am7view.pathForType(type);\r\n        if (item.prototype) {\r\n            type = item.type;\r\n            path = page.user.homeDirectory.path + \"/\" + item.group;\r\n        }\r\n        let base = item;\r\n        let baseType = type;\r\n        if (item.limit && item.limit.length) {\r\n            baseType = item.limit[0];\r\n            base = am7model.getModel(baseType);\r\n        }\r\n        let listPathBase = \"/list/\" + baseType;\r\n        if (am7model.isGroup(base) || base == 'auth.group') {\r\n            /// find the requested path, and make it if it doesn't exist\r\n            ///\r\n            am7client.make(\"auth.group\", \"data\", path, function (v) {\r\n                if (v != null) {\r\n                    m.route.set(listPathBase + \"/\" + v.objectId);\r\n                }\r\n                else console.error(\"Error: Unable to load path \" + path);\r\n            });\r\n        }\r\n        else if (am7model.inherits(base, \"common.parent\") && type.match(/^(auth\\.role|auth\\.permission)$/gi)) {\r\n            am7client.user(type, \"user\", function (v) {\r\n                uwm.getDefaultParentForType(type, v).then((parObj) => {\r\n                    if (parObj != null) {\r\n                        m.route.set(listPathBase + \"/\" + parObj.objectId);\r\n                    }\r\n                    else console.error(\"Handle parent: \" + listPathBase);\r\n                });\r\n            });\r\n        }\r\n        else if (type.match(/^message$/)) {\r\n            let dir = await page.makePath(\"auth.group\", \"data\", \"~/.messages\");\r\n            if (dir != null) {\r\n                m.route.set(listPathBase + \"/\" + dir.objectId);\r\n            }\r\n            else {\r\n                console.error(\"Failed to find .messages\");\r\n            }\r\n        }\r\n        else {\r\n            console.warn(\"Handle non-group/non-parent or type \" + type + \" / \" + listPathBase, base);\r\n            m.route.set(listPathBase);\r\n        }\r\n    }\r\n    function getProtoCat(cat, name) {\r\n        if (cat && cat.prototypes) {\r\n            let ap = cat.prototypes.filter(c => c.name == name);\r\n            if (ap.length) return ap[0];\r\n        }\r\n    }\r\n    function modelPanelContents(key) {\r\n        let cat = am7model.categories.find(o => o.name == key);\r\n        if (!cat) {\r\n            console.error(\"Failed to find: \" + key);\r\n            return;\r\n        }\r\n        let order = cat.order;\r\n        if (!order) {\r\n            order = [];\r\n            am7models.models.forEach((m) => {\r\n                if (m.categories && m.categories.includes(key)) {\r\n                    order.push(m.name);\r\n                }\r\n            });\r\n        }\r\n        let items = [];\r\n\r\n        order.forEach((l) => {\r\n            let item = getProtoCat(cat, l) || am7model.getModel(l);\r\n            if (item == null) {\r\n                // console.error(\"Null item for \" + l);\r\n            }\r\n            else {\r\n                items.push(\r\n                    m(\"div\", { class: \"card-item\" },\r\n                        m(\"button\", { onclick: function () { clickPanelItem(item, l); } }, [\r\n                            (item.icon ? m(\"span\", { class: \"material-symbols-outlined material-icons-cm mr-2\" }, item.icon) : \"\"),\r\n                            (item.label || l)\r\n                        ])\r\n                    )\r\n                );\r\n            }\r\n\r\n        });\r\n        return items;\r\n    }\r\n    panel.component = {\r\n        clickPanelItem,\r\n        oninit: function (x) {\r\n\r\n        },\r\n        oncreate: function (x) {\r\n\r\n        },\r\n        onremove: function (x) {\r\n\r\n        },\r\n\r\n        view: function () {\r\n            return m(\"div\", {\r\n                class: \"panel-container\"\r\n            },\r\n                m(\"div\", { class: \"panel-grid\" },\r\n                    modelPanel()\r\n                )\r\n            );\r\n        }\r\n    };\r\n\r\n    page.components.panel = panel.component;\r\n}());\r\n\n\n;/* === client/components/objectViewDef.js === */\n(function() {\r\n    /// Object View Model Definitions\r\n    /// These define the structure for different object view types\r\n\r\n    am7model.models.push({\r\n        name: \"view.objectDisplay\",\r\n        icon: \"visibility\",\r\n        label: \"Object Display\",\r\n        fields: [\r\n            {\r\n                name: \"objectId\",\r\n                type: \"string\",\r\n                label: \"Object ID\"\r\n            },\r\n            {\r\n                name: \"active\",\r\n                type: \"boolean\",\r\n                label: \"Active\",\r\n                default: false\r\n            },\r\n            {\r\n                name: \"maxMode\",\r\n                type: \"boolean\",\r\n                label: \"Maximize\",\r\n                default: false\r\n            },\r\n            {\r\n                name: \"viewType\",\r\n                type: \"string\",\r\n                label: \"View Type\",\r\n                virtual: true,\r\n                ephemeral: true\r\n            }\r\n        ]\r\n    });\r\n\r\n    /// Form definitions for object viewers\r\n    /// Note: These forms include a dummy 'field' property to bypass model field lookup\r\n    /// when used in the legacy view/object.js dialog rendering system\r\n    am7model.forms.portraitView = {\r\n        label: \"Portrait Viewer\",\r\n        icon: \"account_circle\",\r\n        viewType: \"portrait\",\r\n        fields: {\r\n            objectId: {\r\n                layout: \"full\",\r\n                format: \"portrait\",\r\n                field: {name: \"objectId\", type: \"string\"}\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.forms.imageView = {\r\n        label: \"Image Viewer\",\r\n        icon: \"image\",\r\n        viewType: \"image\",\r\n        fields: {\r\n            objectId: {\r\n                layout: \"full\",\r\n                format: \"image\",\r\n                field: {name: \"objectId\", type: \"string\"}\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.forms.videoView = {\r\n        label: \"Video Viewer\",\r\n        icon: \"videocam\",\r\n        viewType: \"video\",\r\n        fields: {\r\n            objectId: {\r\n                layout: \"full\",\r\n                format: \"video\",\r\n                field: {name: \"objectId\", type: \"string\"}\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.forms.audioView = {\r\n        label: \"Audio Player\",\r\n        icon: \"audiotrack\",\r\n        viewType: \"audio\",\r\n        fields: {\r\n            objectId: {\r\n                layout: \"full\",\r\n                format: \"audio\",\r\n                field: {name: \"objectId\", type: \"string\"}\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.forms.textView = {\r\n        label: \"Text Viewer\",\r\n        icon: \"article\",\r\n        viewType: \"text\",\r\n        fields: {\r\n            objectId: {\r\n                layout: \"full\",\r\n                format: \"text\",\r\n                field: {name: \"objectId\", type: \"string\"}\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.forms.pdfView = {\r\n        label: \"PDF Viewer\",\r\n        icon: \"picture_as_pdf\",\r\n        viewType: \"pdf\",\r\n        fields: {\r\n            objectId: {\r\n                layout: \"full\",\r\n                format: \"pdf\",\r\n                field: {name: \"objectId\", type: \"string\"}\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.forms.noteView = {\r\n        label: \"Note Viewer\",\r\n        icon: \"note\",\r\n        viewType: \"note\",\r\n        fields: {\r\n            text: {\r\n                layout: \"full\",\r\n                format: \"markdown\",\r\n                field: {name: \"text\", type: \"string\"}\r\n            }\r\n        }\r\n    };\r\n\r\n    am7model.forms.messageView = {\r\n        label: \"Message Viewer\",\r\n        icon: \"message\",\r\n        viewType: \"message\",\r\n        fields: {\r\n            data: {\r\n                layout: \"full\",\r\n                format: \"messageContent\",\r\n                field: {name: \"data\", type: \"string\"}\r\n            }\r\n        }\r\n    };\r\n\r\n}());\r\n\n\n;/* === client/components/objectViewRenderers.js === */\n(function() {\r\n    /// Custom field renderers for object views\r\n    /// These extend am7view to handle special formats\r\n\r\n    /// Portrait format renderer (for profile.portrait)\r\n    function renderPortraitField(inst, fieldName, attrs) {\r\n        let object = inst.entity;\r\n        // Get maxMode and active from attrs if available, otherwise from inst.api\r\n        let maxMode = (attrs && attrs.maxMode !== undefined) ? attrs.maxMode : (inst.api.maxMode ? inst.api.maxMode() : false);\r\n        let active = (attrs && attrs.active !== undefined) ? attrs.active : (inst.api.active ? inst.api.active() : true);\r\n\r\n        if (!active) return m(\"span\", \"\");\r\n\r\n        // Check for portrait\r\n        if (!object.profile || !object.profile.portrait || !object.profile.portrait.contentType) {\r\n            return m(\"span\", \"No portrait available\");\r\n        }\r\n\r\n        let pp = object.profile.portrait;\r\n        let path = g_application_path + \"/media/\" +\r\n                   am7client.dotPath(am7client.currentOrganization) +\r\n                   \"/data.data\" + pp.groupPath + \"/\" + pp.name;\r\n        let imgClass = \"carousel-item-img\" + (maxMode ? \" carousel-item-img-max\" : \"\");\r\n\r\n        return m(\"img\", {\r\n            class: imgClass,\r\n            src: path,\r\n            alt: object.name || \"Portrait\"\r\n        });\r\n    }\r\n\r\n    /// Image format renderer\r\n    function renderImageField(inst, fieldName, attrs) {\r\n        let object = inst.entity;\r\n        // Get maxMode and active from attrs if available, otherwise from inst.api\r\n        let maxMode = (attrs && attrs.maxMode !== undefined) ? attrs.maxMode : (inst.api.maxMode ? inst.api.maxMode() : false);\r\n        let active = (attrs && attrs.active !== undefined) ? attrs.active : (inst.api.active ? inst.api.active() : true);\r\n\r\n        if (!active) return m(\"span\", \"\");\r\n\r\n        let path = buildMediaPath(object);\r\n        let imgClass = \"carousel-item-img\" + (maxMode ? \" carousel-item-img-max\" : \"\");\r\n\r\n        return m(\"img\", {\r\n            class: imgClass,\r\n            src: path,\r\n            alt: object.name || \"Image\"\r\n        });\r\n    }\r\n\r\n    /// Video format renderer\r\n    function renderVideoField(inst, fieldName, attrs) {\r\n        let object = inst.entity;\r\n        // Get maxMode and active from attrs if available, otherwise from inst.api\r\n        let maxMode = (attrs && attrs.maxMode !== undefined) ? attrs.maxMode : (inst.api.maxMode ? inst.api.maxMode() : false);\r\n        let active = (attrs && attrs.active !== undefined) ? attrs.active : (inst.api.active ? inst.api.active() : true);\r\n\r\n        if (!active) return m(\"span\", \"\");\r\n\r\n        let path = buildMediaPath(object);\r\n        let mt = object.contentType;\r\n        let vidClass = \"carousel-item-img\" + (maxMode ? \" carousel-item-img-max\" : \"\");\r\n\r\n        return m(\"video\", {\r\n            class: vidClass,\r\n            preload: \"auto\",\r\n            controls: \"controls\",\r\n            autoplay: \"autoplay\"\r\n        }, [\r\n            m(\"source\", { src: path, type: mt })\r\n        ]);\r\n    }\r\n\r\n    /// Audio format renderer\r\n    function renderAudioField(inst, fieldName, attrs) {\r\n        let object = inst.entity;\r\n        // Get maxMode and active from attrs if available, otherwise from inst.api\r\n        let maxMode = (attrs && attrs.maxMode !== undefined) ? attrs.maxMode : (inst.api.maxMode ? inst.api.maxMode() : false);\r\n        let active = (attrs && attrs.active !== undefined) ? attrs.active : (inst.api.active ? inst.api.active() : true);\r\n\r\n        if (!active) return m(\"span\", \"\");\r\n\r\n        let path = buildMediaPath(object);\r\n        let mt = object.contentType;\r\n\r\n        if (mt.match(/mpeg3$/)) mt = \"audio/mpeg\";\r\n\r\n        let audClass = \"carousel-item-img\" + (maxMode ? \" carousel-item-img-max\" : \"\");\r\n\r\n        return m(\"audio\", {\r\n            class: audClass,\r\n            preload: \"auto\",\r\n            controls: \"controls\",\r\n            autoplay: \"autoplay\"\r\n        }, [\r\n            m(\"source\", { src: path, type: mt })\r\n        ]);\r\n    }\r\n\r\n    /// Text content renderer\r\n    function renderTextField(inst, fieldName, attrs) {\r\n        let object = inst.entity;\r\n        let active = (attrs && attrs.active !== undefined) ? attrs.active : (inst.api.active ? inst.api.active() : true);\r\n\r\n        if (!active) return m(\"span\", \"\");\r\n\r\n        let ctx = page.context();\r\n        let objectId = object.objectId;\r\n\r\n        // Clear invalid cache\r\n        if (ctx.contextObjects[objectId] && ctx.contextObjects[objectId].detailsOnly) {\r\n            console.warn(\"Data is cached as detailsOnly. This shouldn't have happened.\");\r\n            delete ctx.contextObjects[objectId];\r\n        }\r\n\r\n        // Load full object if needed\r\n        if (!ctx.contextObjects[objectId]) {\r\n            let model = inst.model.name;\r\n            let q = am7view.viewQuery(am7model.newInstance(model));\r\n            q.field(\"objectId\", objectId);\r\n\r\n            page.search(q).then(qr => {\r\n                ctx.contextObjects[objectId] = (qr && qr.results.length ? qr.results[0] : null);\r\n                ctx.tags[objectId] = [];\r\n                m.redraw();\r\n            });\r\n\r\n            return m(\"div\", { class: \"carousel-article-outer\" },\r\n                m(\"div\", { class: \"carousel-article carousel-article-margin\" },\r\n                    \"Loading...\"\r\n                )\r\n            );\r\n        }\r\n\r\n        // Render loaded content\r\n        let dat = ctx.contextObjects[objectId];\r\n        let cnt = bbConverter.mInto(Base64.decode(dat.dataBytesStore));\r\n\r\n        return m(\"div\", { class: \"carousel-article-outer\" },\r\n            m(\"div\", { class: \"carousel-article carousel-article-margin\" }, cnt)\r\n        );\r\n    }\r\n\r\n    /// PDF viewer renderer\r\n    function renderPDFField(inst, fieldName, attrs) {\r\n        let object = inst.entity;\r\n        let active = (attrs && attrs.active !== undefined) ? attrs.active : (inst.api.active ? inst.api.active() : true);\r\n\r\n        if (!active) return m(\"span\", \"\");\r\n\r\n        let ctx = page.context();\r\n        let objectId = object.objectId;\r\n\r\n        // Clear invalid cache\r\n        if (ctx.contextObjects[objectId] && ctx.contextObjects[objectId].detailsOnly) {\r\n            console.warn(\"Data is cached as detailsOnly. This shouldn't have happened.\");\r\n            delete ctx.contextObjects[objectId];\r\n        }\r\n\r\n        // Load full object if needed\r\n        if (!ctx.contextObjects[objectId]) {\r\n            let model = inst.model.name;\r\n            let q = am7view.viewQuery(am7model.newInstance(model));\r\n            q.field(\"objectId\", objectId);\r\n\r\n            page.search(q).then(qr => {\r\n                ctx.contextObjects[objectId] = (qr && qr.results.length ? qr.results[0] : null);\r\n                ctx.tags[objectId] = [];\r\n\r\n                if (ctx.contextObjects[objectId]) {\r\n                    page.components.pdf.viewer(am7model.prepareInstance(ctx.contextObjects[objectId]));\r\n                }\r\n                m.redraw();\r\n            });\r\n\r\n            return m(\"div\", { class: \"carousel-article-outer\" },\r\n                m(\"div\", { class: \"carousel-article carousel-article-margin\" },\r\n                    \"Loading PDF...\"\r\n                )\r\n            );\r\n        }\r\n\r\n        // Render PDF viewer\r\n        let cnt = \"\";\r\n        if (page.components.pdf.viewer(objectId)) {\r\n            cnt = page.components.pdf.viewer(objectId).container();\r\n        } else {\r\n            cnt = m(\"div\", \"No PDF Viewer ...\");\r\n        }\r\n\r\n        return m(\"div\", { class: \"carousel-article-outer\" },\r\n            m(\"div\", { class: \"carousel-article carousel-article-margin\" }, cnt)\r\n        );\r\n    }\r\n\r\n    /// Markdown/Note renderer\r\n    function renderMarkdownField(inst, fieldName, attrs) {\r\n        let value = inst.api[fieldName]();\r\n\r\n        return m(\"div\", { class: \"carousel-article-outer\" },\r\n            m(\"div\", { class: \"carousel-article carousel-article-margin\" },\r\n                value\r\n            )\r\n        );\r\n    }\r\n\r\n    /// Message content renderer\r\n    function renderMessageContentField(inst, fieldName, attrs) {\r\n        let object = inst.entity;\r\n        let active = (attrs && attrs.active !== undefined) ? attrs.active : (inst.api.active ? inst.api.active() : true);\r\n\r\n        if (!active) return m(\"span\", \"\");\r\n\r\n        // Auto-acknowledge message on view\r\n        if (object.spoolStatus === 'SPOOLED' || object.spoolStatus === 'TRANSMITTED') {\r\n            object.spoolStatus = \"ACKNOWLEGED_RECEIPT\";\r\n            page.patchObject(object);\r\n        }\r\n\r\n        let content = Base64.decode(object.data || \"\");\r\n\r\n        return m(\"div\", { class: \"carousel-article-outer\" },\r\n            m(\"div\", { class: \"carousel-article carousel-article-margin\" }, [\r\n                m(\"div\", content)\r\n            ])\r\n        );\r\n    }\r\n\r\n    /// Helper to build media path\r\n    function buildMediaPath(object) {\r\n        return g_application_path + \"/media/\" +\r\n               am7client.dotPath(am7client.currentOrganization) +\r\n               \"/data.data\" + object.groupPath + \"/\" + object.name;\r\n    }\r\n\r\n    /// Register custom format renderers with am7view\r\n    /// These can be used by setting format: \"image\", format: \"video\", etc. in form definitions\r\n\r\n    if (!am7view.customRenderers) {\r\n        am7view.customRenderers = {};\r\n    }\r\n\r\n    am7view.customRenderers.portrait = renderPortraitField;\r\n    am7view.customRenderers.image = renderImageField;\r\n    am7view.customRenderers.video = renderVideoField;\r\n    am7view.customRenderers.audio = renderAudioField;\r\n    am7view.customRenderers.text = renderTextField;\r\n    am7view.customRenderers.pdf = renderPDFField;\r\n    am7view.customRenderers.markdown = renderMarkdownField;\r\n    am7view.customRenderers.messageContent = renderMessageContentField;\r\n\r\n    /// Export for external use\r\n    window.objectViewRenderers = {\r\n        portrait: renderPortraitField,\r\n        image: renderImageField,\r\n        video: renderVideoField,\r\n        audio: renderAudioField,\r\n        text: renderTextField,\r\n        pdf: renderPDFField,\r\n        markdown: renderMarkdownField,\r\n        messageContent: renderMessageContentField,\r\n        buildMediaPath: buildMediaPath\r\n    };\r\n\r\n}());\r\n\n\n;/* === client/components/object_v2.js === */\n(function () {\r\n    let object = {};\r\n\r\n    /// ========================================\r\n    /// INNER VIEW - Uses am7view pattern\r\n    /// ========================================\r\n\r\n    function renderInnerObjectView(attrs) {\r\n        let obj = attrs.object;\r\n        let model = attrs[am7model.jsonModelKey] || obj[am7model.jsonModelKey] || attrs.model;\r\n\r\n        if (!obj || !model) {\r\n            console.warn(\"Invalid object\", obj);\r\n            return \"\";\r\n        }\r\n\r\n        // Ensure attrs has the model in the correct format for am7view\r\n        let attrsWithModel = Object.assign({}, attrs);\r\n        attrsWithModel[am7model.jsonModelKey] = model;\r\n\r\n        // Prepare view instance using am7view\r\n        let inst = am7view.prepareObjectView(obj, attrsWithModel);\r\n\r\n        if (!inst) {\r\n            return m(\"div\", \"Unable to render object: \" + (obj.name || obj.objectId));\r\n        }\r\n\r\n        // Get carousel classes\r\n        let cls = 'carousel-item';\r\n        if (attrs.active) cls += ' carousel-item-abs';\r\n        cls += ' carousel-item-' + (attrs.active ? '100' : '0');\r\n\r\n        // Render using the custom renderer\r\n        let format = inst.entity.viewType;\r\n        let renderer = am7view.customRenderers[format];\r\n\r\n        if (!renderer) {\r\n            return m(\"div\", { class: cls },\r\n                m(\"div\", \"No renderer available for: \" + format)\r\n            );\r\n        }\r\n\r\n        // Pass attrs to renderer so it can access dynamic values like maxMode\r\n        let content = renderer(inst, \"objectId\", attrs);\r\n\r\n        return m(\"div\", { class: cls }, content);\r\n    }\r\n\r\n    /// ========================================\r\n    /// OUTER VIEW - Carousel controls\r\n    /// ========================================\r\n\r\n    function renderObjectView(attrs) {\r\n        return m(\"div\", { class: \"content-outer\" }, [\r\n            (fullMode ? \"\" : m(page.components.navigation)),\r\n            m(\"div\", { class: \"content-main\" }, [\r\n                m(\"div\", { class: \"carousel\" }, [\r\n                    m(\"div\", { class: \"carousel-inner\" }, [\r\n                        renderInnerObjectView(attrs),\r\n                        renderCarouselControls()\r\n                    ])\r\n                ])\r\n            ])\r\n        ]);\r\n    }\r\n\r\n    /// Render carousel control buttons\r\n    function renderCarouselControls() {\r\n        return [\r\n            m(\"span\", {\r\n                onclick: toggleCarouselFull,\r\n                class: \"carousel-full\"\r\n            }, [\r\n                m(\"span\", { class: \"material-icons\" },\r\n                    (fullMode ? \"close_fullscreen\" : \"open_in_new\"))\r\n            ]),\r\n            m(\"span\", {\r\n                onclick: toggleCarouselMax,\r\n                class: \"carousel-max\"\r\n            }, [\r\n                m(\"span\", { class: \"material-icons\" },\r\n                    (maxMode ? \"photo_size_select_small\" : \"aspect_ratio\"))\r\n            ]),\r\n            m(\"span\", {\r\n                onclick: toggleInfo,\r\n                class: \"carousel-info\"\r\n            }, [\r\n                m(\"span\", {\r\n                    class: \"material-icons\" + (info ? \"\" : \"-outlined\")\r\n                }, (info ? \"info\" : \"info\"))\r\n            ]),\r\n            m(\"span\", {\r\n                onclick: function () {\r\n                    editItem(pr[pages.currentItem]);\r\n                },\r\n                class: \"carousel-edit\"\r\n            }, [\r\n                m(\"span\", { class: \"material-icons\" }, \"edit\")\r\n            ]),\r\n            m(\"span\", {\r\n                onclick: toggleCarousel,\r\n                class: \"carousel-exit\"\r\n            }, [\r\n                m(\"span\", { class: \"material-icons\" }, \"close\")\r\n            ])\r\n        ];\r\n    }\r\n\r\n    /// ========================================\r\n    /// COMPONENT DEFINITION\r\n    /// ========================================\r\n\r\n    object.component = {\r\n        oncreate: function (vnode) {\r\n            // Initialization if needed\r\n        },\r\n        view: function (vnode) {\r\n            if (vnode.attrs.inner) {\r\n                return renderInnerObjectView(vnode.attrs);\r\n            } else {\r\n                return renderObjectView(vnode.attrs);\r\n            }\r\n        }\r\n    };\r\n\r\n    page.components.object = object.component;\r\n\r\n}());\r\n\n\n;/* === client/components/form.js === */\n(function () {\r\n    /* WARNING: This is not yet fully ported over from the previous version*/\r\n    let form = {};\r\n    let entity = {};\r\n    let entityName = \"sig\";\r\n    let changed = false;\r\n    let app;\r\n    let view;\r\n\r\n    function updateChange(evt) {\r\n        changed = true;\r\n    }\r\n\r\n    function renderFormView(attrs) {\r\n        return m(\"div\", { class: \"content-outer\" }, [(fullMode ? \"\" : m(page.components.navigation)),\r\n        m(\"div\", { class: \"content-main\" }, [\r\n            m(\"div\", { class: \"carousel\" }, [\r\n                m(\"div\", { class: \"carousel-inner\" }, [\r\n                    renderInnerFormView(attrs),\r\n                    m(\"span\", { onclick: toggleCarouselFull, class: \"carousel-full\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, (fullMode ? \"close_fullscreen\" : \"open_in_new\"))]),\r\n                    m(\"span\", { onclick: toggleCarouselMax, class: \"carousel-max\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, (maxMode ? \"photo_size_select_small\" : \"aspect_ratio\"))]),\r\n                    m(\"span\", { onclick: toggleInfo, class: \"carousel-info\" }, [m(\"span\", { class: \"material-symbols\" + (info ? \"\" : \"-outlined\") }, (info ? \"info\" : \"info\"))]),\r\n                    m(\"span\", { onclick: function () { editItem(pr[pages.currentItem]); }, class: \"carousel-edit\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, \"edit\")]),\r\n                    m(\"span\", { onclick: toggleCarousel, class: \"carousel-exit\" }, [m(\"span\", { class: \"material-symbols-outlined\" }, \"close\")])\r\n                ])\r\n            ])\r\n        ])\r\n        ]);\r\n    }\r\n    function renderInnerFormView(attrs) {\r\n\r\n        let cls = 'carousel-item';\r\n        let object = attrs.object;\r\n        let active = attrs.active;\r\n\r\n        let ctx = page.context();\r\n\r\n        if (active) cls += ' carousel-item-abs';\r\n        let maxMode = attrs.maxMode;\r\n        if (!object || !object[am7model.jsonModelKey]) {\r\n            console.warn(\"Invalid object\");\r\n            return \"\";\r\n        }\r\n\r\n        let type = am7model.getModel(object[am7model.jsonModelKey]);\r\n        let objView = \"\";\r\n\r\n        if (ctx.contextObjects[object.objectId] && !ctx.contextObjects[object.objectId].populated) {\r\n            logger.warn(\"Form is cached unpopulated.  This shouldn't have happened.\");\r\n            delete ctx.contextObjects[object.objectId];\r\n        }\r\n        if (!ctx.contextObjects[object.objectId]) {\r\n            return [];\r\n        }\r\n        else {\r\n            let objDat = ctx.contextObjects[object.objectId];\r\n            objView = m(\"div\", { class: \"carousel-article-outer\" }, m(\"div\", { class: \"carousel-article carousel-article-margin\" }, [\r\n                active ? renderForm(objDat) : \"\"\r\n            ]));\r\n        }\r\n\r\n        let useCls = cls + \" carousel-item-\" + (active ? \"100\" : \"0\");\r\n        return m(\"div\", { class: useCls }, objView);\r\n    }\r\n\r\n    function getRowCount(object) {\r\n        return (object.elements.length && object.elements[0].elementValues.length ? getMaxElementValue(object, object.elements[0].elementValues) : 1);\r\n    }\r\n    function addFormRow(object) {\r\n        let row = entity.rowCount;\r\n        object.elements.forEach((e, i) => {\r\n            let val = new org.cote.objects.formElementValueType();\r\n            val.formId = object.id;\r\n            val.textValue = \"\";\r\n            e.elementValues.push(val);\r\n            setEntityBinding(object, e, row, i);\r\n        });\r\n        console.log(\"Add row \" + entity.rowCount);\r\n        entity.rowCount++;\r\n    }\r\n\r\n    function removeFormRow(object, index) {\r\n        form = page.form(app);\r\n        object.elements.forEach((e, i) => {\r\n            let name = \"fe-\" + e.elementName + \"-\" + index;\r\n            delete entity[name];\r\n            form.removeElement(form.getElementByName(name));\r\n        });\r\n    }\r\n\r\n    let patterns = [];\r\n    function getPatternType(rule) {\r\n        var s = \"\";\r\n        switch (rule.validationType) {\r\n            case \"BOOLEAN\":\r\n                s = \"bool\";\r\n                break;\r\n            case \"REPLACEMENT\":\r\n                s = \"replace\";\r\n                break;\r\n            case \"NONE\":\r\n                s = \"none\";\r\n                break;\r\n        }\r\n        return s;\r\n    }\r\n\r\n    let invalid = [];\r\n    function validateForm(object) {\r\n\r\n        invalid = [];\r\n        var oF = getAppForm();\r\n        let formVal = Hemi.data.form.service.validateForm(oF.i, 0);\r\n\r\n        let row = 0;\r\n        if (!formVal) {\r\n            object.template.elements.forEach((e) => {\r\n                let name = \"fe-\" + e.elementName + \"-\" + row;\r\n                let el = document.querySelector(\"[name=\" + name + \"]\");\r\n                let pid = el.getAttribute(\"pattern-id\");\r\n                if (pid) {\r\n                    let vres = Hemi.data.validator.service.validateField(el, pid);\r\n                    if (!vres) {\r\n                        invalid.push({ name, label: e.name, pattern: pid });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        return !invalid.length;\r\n    }\r\n\r\n    function getAppForm() {\r\n        return Hemi.data.form.service.getFormByName(app.getTemplateSpace().space_id);\r\n    }\r\n    function isSupportedBinaryType(type) {\r\n        var out_bool = false;\r\n        switch (type) {\r\n            case \"resource\":\r\n            case \"schedule\":\r\n            case \"estimate\":\r\n            case \"time\":\r\n            case \"note\":\r\n            case \"data\":\r\n            case \"form\":\r\n            case \"task\":\r\n            case \"tickt\":\r\n            case \"model\":\r\n            case \"artifact\":\r\n            case \"stage\":\r\n            case \"case\":\r\n            case \"work\":\r\n            case \"goal\":\r\n            case \"budget\":\r\n            case \"cost\":\r\n                out_bool = true;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        return out_bool;\r\n    }\r\n    let entityMap = [];\r\n    async function saveForm(object) {\r\n        let xtr = entity;\r\n        window.dbgEntityMap = entityMap;\r\n        window.dbgObject = object;\r\n        window.dbgEntity = entity;\r\n        if (!validateForm(object)) {\r\n            m.redraw();\r\n            return;\r\n        }\r\n        let row = 0;\r\n        for (let ri = 0; ri < entity.rowCount; ri++) {\r\n            let testEl = object.elements[0];\r\n            if (!testEl) {\r\n                console.warn(\"No element exists\");\r\n                continue;\r\n            }\r\n            let testName = \"fe-\" + testEl.elementName + \"-\" + ri;\r\n            if (typeof entity[testName] === \"undefined\") {\r\n                console.log(\"Skip\", testName, entity[testName]);\r\n                continue;\r\n            }\r\n            else {\r\n                console.log(\"Continue at \" + ri, testName, entity[testName]);\r\n            }\r\n            object.elements.forEach((e, i) => {\r\n                if (row == 0) e.elementValues = [];\r\n                let ename = \"fe-\" + e.elementName + \"-\" + ri;\r\n\r\n                let val = new org.cote.objects.formElementValueType();\r\n                val.name = ename;\r\n                val.isBinary = isSupportedBinaryType(e.elementType);\r\n\r\n\r\n                if (entityMap[e.elementName]) {\r\n                    if (val.isBinary) val.binaryId = parseInt(entityMap[ename]);\r\n                    else val.textValue = entityMap[ename];\r\n                }\r\n                else {\r\n                    val.textValue = entity[ename];\r\n                }\r\n                console.log(\"Assign value: \" + ename + \" == \" + val.textValue + \" at row \" + row, val);\r\n                e.elementValues[row] = val;\r\n            });\r\n            row++;\r\n        }\r\n\r\n        let updated = await page.patchObject(object);\r\n        am7client.clearCache(\"FORM\", true);\r\n        if (object.objectId) {\r\n            page.clearContextObject(object.objectId);\r\n        }\r\n        if (updated) {\r\n            console.log(\"Saved the form\");\r\n            changed = false;\r\n            if (view && view.closeView) {\r\n                view.closeView();\r\n            }\r\n            else {\r\n                console.log(\"Note: There is a caching issue with the form refreshing after an update where the values aren't correctly populated\");\r\n                m.redraw();\r\n            }\r\n        }\r\n        else {\r\n            console.log(\"Error updating form\");\r\n        }\r\n    }\r\n\r\n    function modelRule(rule) {\r\n        return new Promise((res, rej) => {\r\n            if (!rule) rej(\"Invalid rule\");\r\n            let rid = rule.urn;\r\n            if (Hemi.data.validator.service.getPattern(rid)) {\r\n                res();\r\n            }\r\n            (rule.populated ? Promise.resolve(rule) : new Promise((res2, rej2) => {\r\n                am7client.get(\"VALIDATIONRULE\", rule.objectId, function (v) {\r\n                    res2(v);\r\n                });\r\n            })).then((rule2) => {\r\n                var oDV = Hemi.data.validator.definitions.service;\r\n                var aInc;\r\n                let aP = [];\r\n                rule.rules.forEach((r) => {\r\n                    if (!aInc) aInc = [];\r\n                    let oP = (r.populated ? Promise.resolve(r) : new Promise((res3, rej3) => {\r\n                        am7client.get(\"VALIDATIONRULE\", r.objectId, function (s2, v2) {\r\n                            if (v2 && v2.json) v2 = v2.json;\r\n                            res3(v2);\r\n                        });\r\n                    }));\r\n                    aP.push(oP);\r\n                    oP.then((crule) => {\r\n                        aInc.push(crule.urn);\r\n                        aP.push(modelRule(crule));\r\n                    });\r\n                });\r\n                patterns.push(rid);\r\n                oDV.addNewPattern(\r\n                    rid,\r\n                    getPatternType(rule),\r\n                    (rule.validationType == \"BOOLEAN\" ? (rule.comparison ? \"true\" : \"false\") : 0),\r\n                    rule.expression,\r\n                    (rule.validationType == \"REPLACEMENT\" ? rule.replacementValue : 0),\r\n                    rule.allowNull, rule.errorMessage, aInc\r\n                );\r\n                Promise.all(aP).then(() => {\r\n                    res();\r\n                });\r\n            });\r\n        });\r\n    }\r\n    function modelElement(object, element, row) {\r\n        let el = [];\r\n        row = row || 0;\r\n        let name = \"fe-\" + element.elementName + \"-\" + row;\r\n        let component = \"\";\r\n        let type;\r\n        let patternId;\r\n        if (element.validationRule) {\r\n            modelRule(element.validationRule);\r\n            patternId = element.validationRule.urn;\r\n        }\r\n\r\n        let fHandler = function (e) {\r\n            updateChange(e);\r\n        };\r\n\r\n        let err = invalid.filter((i) => i.name === name);\r\n        let errCls = \"\";\r\n        if (err.length) {\r\n            errCls = \" field-error\";\r\n        }\r\n        let cls = \"text-field-full\" + errCls;\r\n        switch (element.elementType) {\r\n            case \"SELECT\":\r\n            case \"MULTIPLE_SELECT\":\r\n                cls = \"select-field-full\" + errCls;\r\n                el.push(m(\"select\", { onchange: fHandler, class: cls, name: name }, element.elementValues.map((v) => {\r\n                    return m(\"option\", { value: v.textValue }, v.name);\r\n                })));\r\n\r\n                break;\r\n            case \"BOOLEAN\":\r\n                cls = \"check-field\" + errCls;\r\n                el.push(m(\"input\", { onchange: updateChange, name: name, type: \"checkbox\", class: cls, \"pattern-id\": patternId }));\r\n                break;\r\n            case \"DATE\":\r\n                component = \"calendar\";\r\n                type = \"datetime-local\";\r\n            case \"STRING\":\r\n                if (!type) type = \"text\";\r\n                el.push(m(\"input\", { onchange: updateChange, name, type: type, component, class: cls, \"pattern-id\": patternId }));\r\n                break;\r\n            default:\r\n                console.warn(\"Unhandled: \" + element.elementType);\r\n                break;\r\n        }\r\n        return el;\r\n    }\r\n    function modelElementContainer(object, element, layout) {\r\n        let className = \"field-grid-item-\" + (layout || \"full\")\r\n        let labelClass = \"field-label\";\r\n        if (object.template.isGrid) {\r\n            console.warn(\"Not applicable to a grid layout\");\r\n            return \"\";\r\n        }\r\n        else {\r\n            return m(\"div\", { class: className }, [\r\n                m(\"label\", { class: labelClass, for: element.elementName }, element.elementLabel || element.name),\r\n                modelElement(object, element)\r\n            ]);\r\n        }\r\n    }\r\n    function renderForm(object) {\r\n        let formView = [];\r\n        let els = (object.isTemplate ? object : object.template).elements;\r\n        let grid = (object.isTemplate ? object : object.template).isGrid;\r\n        let altCls = '';\r\n        if (changed) altCls = ' warn';\r\n        formView.push(m(\"h3\", object.name));\r\n        formView.push(m(\"div\", { class: \"result-nav-outer\" }, [\r\n            m(\"div\", { class: \"result-nav-inner\" }, [\r\n                m(\"div\", { class: \"result-nav tab-container\" }, [\r\n                    page.iconButton(\"button\" + altCls, \"save\", \"\", function () { saveForm(object); }),\r\n                    (grid ? page.iconButton(\"button\", \"add\", \"\", function () { addFormRow(object); }) : \"\"),\r\n                ])\r\n            ])\r\n        ]));\r\n        if (object.isTemplate) {\r\n            formView.push(m(\"h2\", \"Form Template View Not Currently Supported\"));\r\n        }\r\n        else if (object.template.isGrid) {\r\n            let rowE = [];\r\n            let rows = getRowCount(object);\r\n            let skipDel = false;\r\n            if (entity && entity.rowCount) {\r\n                rows = entity.rowCount;\r\n                skipDel = true;\r\n            }\r\n            for (let i = 0; i < rows; i++) {\r\n\r\n                let skipRow = false;\r\n                let cells = els.map((e, i2) => {\r\n                    let cell;\r\n                    if (skipRow || (skipDel && typeof entity[\"fe-\" + e.elementName + \"-\" + i] === \"undefined\")) {\r\n                        cell = \"\";\r\n                        skipRow = true;\r\n                    }\r\n                    else {\r\n                        cell = modelElement(object, e, i);\r\n                    }\r\n                    return m(\"td\", cell);\r\n                });\r\n                cells.push(m(\"td\", (skipRow ? \"\" : page.iconButton(\"button ml-4\", \"delete_outline\", \"\", function () { removeFormRow(object, i) }))));\r\n                rowE.push(\r\n                    m(\"tr\", cells)\r\n                );\r\n            }\r\n            formView.push(m(\"table\", { class: \"table-field\" }, [\r\n                m(\"tr\", els.map((a) => {\r\n                    return m(\"th\", a.elementLabel)\r\n                }), m(\"th\", \"\")),\r\n                rowE\r\n            ]));\r\n        }\r\n        else {\r\n            els.forEach((e, i) => {\r\n                formView.push(modelElementContainer(object, e, \"two-thirds\"));\r\n            });\r\n        }\r\n        return formView;\r\n    }\r\n    function init(vnode) {\r\n        let attrs = vnode.attrs;\r\n        let object = attrs.object;\r\n        let active = attrs.active;\r\n        let ctx = page.context();\r\n        if (!ctx.contextObjects[object.objectId]) {\r\n            page.openObject(object[am7model.jsonModelKey], object.objectId).then((a) => {\r\n                m.redraw();\r\n            });\r\n        }\r\n        else {\r\n            setApp(vnode, ctx.contextObjects[object.objectId]);\r\n        }\r\n    }\r\n    function setApp(vnode, object) {\r\n        if (vnode.dom) {\r\n            if (!app) {\r\n                entity = { uid: Hemi.guid() };\r\n                setEntity(object);\r\n                window.dbgApp = app;\r\n                window.dbgEntity = entity;\r\n                window.dbgObject = object;\r\n            }\r\n            else {\r\n                let rows = vnode.dom.querySelectorAll(\"tr\");\r\n                let bind = false;\r\n                rows.forEach((row) => {\r\n                    if (row.firstChild && row.firstChild.getAttribute(\"hemi-id\") == null) {\r\n                        bind = true;\r\n                        page.extendSpace(app, row);\r\n                    }\r\n                });\r\n                /// Due to how space parsing works, there is a promise buried inside that doesn't lead to an arbitrary notification for the app component to pick up when binding to dynamically added inputs\r\n                /// Therefore, wait a moment and then bind\r\n                if (bind) {\r\n                    setTimeout(function () {\r\n                        page.bindEntity(app, entity);\r\n                    }, 1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    function getMaxElementValue(form, vals) {\r\n        return Math.max(vals.length - getDefaultOffset(form, vals), 1);\r\n    }\r\n    function getDefaultOffset(form, vals) {\r\n        let i = 0, v = 0;\r\n        for (; i < vals.length; i++) {\r\n            if (vals[i].formId != form.id) v++;\r\n        }\r\n        return v;\r\n    }\r\n    function setEntityBinding(object, element, row, index) {\r\n        let ename = \"fe-\" + element.elementName + \"-\" + row;\r\n        let e2 = Object.assign({}, object.elements[index]);\r\n\r\n        /// Filter off the defaults\r\n        let ev = (e2 ? e2.elementValues : []).filter((e3) => {\r\n            return e3.formId == object.id;\r\n        });\r\n        let evv = ev.length > row ? ev[row] : undefined;\r\n        switch (element.elementType) {\r\n            case \"BOOLEAN\":\r\n                entity[ename] = evv ? evv.textValue === \"true\" : false;\r\n                break;\r\n            case \"DATE\":\r\n                entity[ename] = evv && evv.textValue && evv.textValue.length > 0 ? new Date(evv.textValue) : new Date();\r\n                break;\r\n\r\n            default:\r\n                entity[ename] = evv ? evv.textValue : \"\";\r\n        }\r\n    }\r\n\r\n    function setEntity(object) {\r\n        if (!object) {\r\n            console.error(\"Form is null\");\r\n            return;\r\n        }\r\n        else if (object.isTemplate) {\r\n            console.log(\"Skip template\");\r\n            return;\r\n        }\r\n        else if (object.template == null) {\r\n            console.error(\"Form template is null\");\r\n            return;\r\n        }\r\n        let rows = getRowCount(object);\r\n        entity.rowCount = rows;\r\n        for (let i = 0; i < rows; i++) {\r\n            object.template.elements.forEach((e, i2) => {\r\n                setEntityBinding(object, e, i, i2);\r\n            });\r\n        }\r\n    }\r\n\r\n    form.component = {\r\n        oncreate: function (vnode) {\r\n            init(vnode);\r\n            if (vnode.attrs && vnode.attrs.view) view = vnode.attrs.view;\r\n        },\r\n        onupdate: function (vnode) {\r\n            init(vnode);\r\n        },\r\n        onremove: function (vnode) {\r\n            if (app) app.destroy();\r\n            app = undefined;\r\n        },\r\n        view: function (vnode) {\r\n            if (vnode.attrs.inner) return renderInnerFormView(vnode.attrs);\r\n            else return renderFormView(vnode.attrs);\r\n        }\r\n    };\r\n\r\n    page.components.form = form.component;\r\n\r\n}());\r\n\n\n;/* === client/components/navigation.js === */\n(function () {\r\n    const navigation = {};\r\n\r\n    function navigable() {\r\n        let nav = {\r\n            drawerOpen: false,\r\n            contextMenus: [],\r\n            pendingMenus: [],\r\n            cleanupMenus: [],\r\n            init: function () {\r\n                document.addEventListener(\"keydown\", e => {\r\n                    if (e.keyCode == 27) {\r\n                        page.components.dialog.endDialog();\r\n                        this.drawer(1);\r\n                        this.menu(null, true);\r\n                    }\r\n                });\r\n\r\n            },\r\n            addDrawerClickEvent: function (eventPath) {\r\n                document.querySelector(eventPath).onclick = function () {\r\n                    nav.drawer();\r\n                };\r\n            },\r\n            removeContextMenu: function (menuPath) {\r\n                let len = this.contextMenus.length;\r\n                this.contextMenus = this.contextMenus.filter(function (o) { return o.menuPath != menuPath; });\r\n            },\r\n            contextMenuButton: function (sMenuId, sLabel, sIco, fHandler) {\r\n                let id = sMenuId;\r\n                if (!sMenuId.match(/^\\./)) id = \"#\" + sMenuId;\r\n                return m(\"button\", {\r\n                    class: \"context-menu-item\", onclick:\r\n                        function () {\r\n\r\n                            page.navigable.menu(id);\r\n                            if (fHandler) fHandler();\r\n                        }\r\n                }, [(sLabel || \"\"), (sIco ? m(\"span\", { class: \"material-symbols-outlined material-symbols-outlined-cm ml-2\" }, sIco) : \"\")]);\r\n            },\r\n            cleanupContextMenus: function () {\r\n                navg.cleanupMenus.forEach((m) => {\r\n                    navg.removeContextMenu(m);\r\n                });\r\n                navg.cleanupMenus = [];\r\n            },\r\n            setupPendingContextMenus: function () {\r\n                navg.pendingMenus.forEach((o) => {\r\n                    navg.addContextMenu(o.menu, o.button, o.query, o.class);\r\n                    navg.cleanupMenus.push(o.menu);\r\n                });\r\n                navg.pendingMenus = [];\r\n            },\r\n            pendContextMenu: function (menuPath, buttonPath, vQuery, altClass) {\r\n                navg.pendingMenus.push({ menu: menuPath, button: buttonPath, class: altClass, query: vQuery });\r\n            },\r\n            addContextMenu: function (menuPath, buttonPath, vQuery, sAltCls) {\r\n                let oE = document.querySelector(buttonPath);\r\n                if (oE == null) {\r\n                    console.warn(buttonPath + \" does not exist\");\r\n                    return;\r\n                }\r\n                let ctx = {\r\n                    menuOpen: false,\r\n                    buttonPath: buttonPath,\r\n                    menuPath: menuPath,\r\n                    class: sAltCls,\r\n                    query: vQuery\r\n                };\r\n                this.contextMenus.push(ctx);\r\n\r\n                oE.onclick = function () {\r\n                    (!vQuery ? Promise.resolve() : nav.populateContextMenu(vQuery)).then(() => {\r\n                        nav.menu(menuPath);\r\n                    });\r\n                };\r\n            },\r\n            menu: function (path, bF, bN) {\r\n                this.contextMenus.forEach((m) => {\r\n                    m.menuOpen = (\r\n                        (!path || m.menuPath === path)\r\n                        && !bF && !m.menuOpen) || false;\r\n                });\r\n                if (!bN) this.flash();\r\n            },\r\n            drawer: function (bF) {\r\n                this.drawerOpen = (!bF && !this.drawerOpen) || false;\r\n                if (this.drawerOpen) this.menu(0, true);\r\n                this.flash();\r\n            },\r\n            glass: function () {\r\n                let cls = \"screen-glass screen-glass-slide screen-glass-open\";\r\n                document.querySelector(\"div.screen-glass\").className = cls;\r\n            },\r\n            flash: function () {\r\n                let cls = \"screen-glass screen-glass-slide screen-glass-\" + (this.drawerOpen ? 'open' : 'close');\r\n                document.querySelector(\"div.screen-glass\").className = cls;\r\n                document.querySelector(\"aside.transition\").className = \"transition transition-\" + (this.drawerOpen ? 'full' : '0');\r\n                this.contextMenus.forEach((m) => {\r\n                    let cls = m.class || \"context-menu-48\";\r\n                    let mnu = document.querySelector(m.menuPath);\r\n                    if (mnu == null) {\r\n                        console.debug(\"Null menu for path: \" + m.menuPath);\r\n                    }\r\n                    else mnu.className = cls + \" transition transition-\" + (m.menuOpen ? 'full' : '0');\r\n                });\r\n            },\r\n            populateContextMenu: function (vQuery) {\r\n\r\n                /// There isn't an attribute to control visibility (vs. read permission), and the long-standing default has been to preface groups to be hidden with a period\r\n                ///\r\n                let ignoreList = /^\\./;\r\n\r\n                return (vQuery.loaded ? Promise.resolve() : new Promise((res, rej) => {\r\n                    vQuery.loaded = true;\r\n                    (vQuery.objectId ? Promise.resolve(vQuery.objectId) : new Promise((res2, rej2) => {\r\n                        am7client.find(vQuery.type, vQuery.subType, vQuery.path, function (v) {\r\n                            if (!v) {\r\n                                vQuery.denied = true;\r\n                                res2();\r\n                            }\r\n                            else res2(v.objectId);\r\n                        })\r\n                    }))\r\n                        .then((gid) => {\r\n                            vQuery.objectId = gid;\r\n                            if (vQuery.items) res();\r\n                            else {\r\n                                am7client.list(vQuery.type, gid, null, 0, 0, function (r) {\r\n                                    let oMenu = document.querySelector(\"#\" + vQuery.menu);\r\n                                    oMenu.innerHTML = \"\";\r\n                                    vQuery.items = r;\r\n                                    r.forEach((g) => {\r\n                                        if (!g.name.match(ignoreList)) {\r\n                                            let btn = document.createElement(\"button\");\r\n                                            btn.setAttribute(\"class\", \"context-menu-item\");\r\n                                            btn.appendChild(document.createTextNode(g.name));\r\n                                            if (vQuery.icon) {\r\n                                                let ico = document.createElement(\"span\");\r\n                                                ico.setAttribute(\"class\", \"material-symbols-outlined material-icons-cm ml-2\");\r\n                                                ico.appendChild(document.createTextNode(vQuery.icon));\r\n                                                btn.appendChild(ico);\r\n                                            }\r\n                                            oMenu.appendChild(btn);\r\n                                            btn.onclick = function () {\r\n                                                nav.menu(\"#\" + vQuery.menu);\r\n                                                if (vQuery.handler) vQuery.handler(vQuery, g);\r\n                                            };\r\n                                        }\r\n                                    });\r\n                                    res();\r\n                                });\r\n                            }\r\n                        });\r\n                }));\r\n            }\r\n        };\r\n\r\n        nav.init();\r\n\r\n        return nav;\r\n    }\r\n\r\n\r\n    function asideToggle() {\r\n        return m(\"div\", { class: \"menuToggle\" }, [m(\"button\", { class: \"mr-2\" }, m(\"span\", { class: \"material-symbols-outlined material-icons-48\" }, \"menu\"))]);\r\n    }\r\n    function asideGlass() {\r\n        return m(\"div\", { class: \"screen-glass screen-glass-slide screen-glass-close\" }, [m(\"div\", { class: \"screen-glass-gray\" })]);\r\n    }\r\n    let navg;\r\n\r\n    navigation.view = {\r\n        onupdate: function (x) {\r\n\r\n        },\r\n        oninit: function (x) {\r\n            if (!page.authenticated()) return;\r\n        },\r\n        oncreate: function (x) {\r\n            if (!page.authenticated()) return;\r\n            navg.addDrawerClickEvent(\"div.screen-glass-slide\");\r\n            navg.addDrawerClickEvent(\"div.menuToggle button\");\r\n        },\r\n        onremove: function (x) {\r\n\r\n        },\r\n\r\n        view: function (vnode) {\r\n            if (!page.authenticated()) return;\r\n            let crumb = \"\";\r\n            if (!vnode.attrs.hideBreadcrumb) {\r\n                crumb = m(page.components.breadCrumb);\r\n            }\r\n            return [\r\n                m(\"nav\", { class: \"pageNav\" }, [\r\n                    asideToggle(),\r\n                    m(page.components.topMenu, { customTray: vnode.attrs.customTray }),\r\n                    asideGlass(),\r\n                    , m(page.components.asideMenu)\r\n                ]),\r\n                crumb\r\n            ];\r\n\r\n\r\n        }\r\n    };\r\n    navg = navigable();\r\n    page.navigable = navg;\r\n    page.components.navigation = navigation.view;\r\n}());\r\n\n\n;/* === client/components/pagination.js === */\n(function () {\r\n\r\n  function newPaginationControl() {\r\n    let requesting = false;\r\n    let embeddedMode = false;\r\n\r\n    let entity = {\r\n      listFilter: \"\",\r\n      sort: \"name\",\r\n      order: \"ascending\"\r\n    };\r\n\r\n    function newPagination(containerType) {\r\n      return {\r\n        navigateByParent: false,\r\n        listSystem: false,\r\n        startRecord: 0,\r\n        recordCount: 10,\r\n        displayCount: 0,\r\n        totalCount: 0,\r\n        counted: false,\r\n        currentPage: -1,\r\n        currentItem: 0,\r\n        pageCount: 0,\r\n        pageResults: [],\r\n        pageState: {},\r\n        resultType: null,\r\n        filter: null,\r\n        containerType: (containerType || \"auth.group\"),\r\n        containerSubType: null,\r\n        containerId: null,\r\n        container: null,\r\n        sort: entity.sort,\r\n        order: entity.order,\r\n        id: page.uid()\r\n      };\r\n    }\r\n    let pages = newPagination();\r\n\r\n    async function getSearchQuery() {\r\n\r\n      let q = am7client.newQuery(pages.resultType);\r\n      q.entity.request = getRequestFields(pages.resultType);\r\n      if(pages.filter != null){\r\n        let qf = q.field(\"name\", pages.filter);\r\n        qf.comparator = \"like\";\r\n      }\r\n\r\n      if(!am7model.hasField(pages.resultType, \"name\") && entity.sort == \"name\"){\r\n        entity.sort = \"id\";\r\n        pages.sort = \"id\";\r\n      }\r\n\r\n      q.range(pages.startRecord, pages.recordCount);\r\n      q.sort(pages.sort);\r\n      q.order(pages.order);\r\n      q.field(\"organizationId\", page.user.organizationId);\r\n\r\n      if(am7model.hasField(pages.resultType, \"tags\")){ \r\n        q.entity.request.push(\"tags\");\r\n      }\r\n\r\n      if(!pages.containerId){\r\n        am7client.search(q, handleList);\r\n      }\r\n      else{\r\n        let gq = am7view.viewQuery(am7model.newInstance(pages.containerType));\r\n        gq.field(\"objectId\", pages.containerId  );\r\n        let g = await page.search(gq);\r\n        let id = 0;\r\n        if(g && g.results){\r\n          id = g.results[0].id;\r\n        }\r\n        /// auth.group is a special case where it is a parent/child hierarchy, so the parentId is used\r\n        /// some models like data.note can be hierarchical by group and parent\r\n        if(pages.resultType){\r\n          if(am7model.isGroup(pages.resultType) && am7model.hasField(pages.resultType, \"groupId\")){\r\n            q.field(\"groupId\", id);\r\n          }\r\n          else if(am7model.isParent(pages.resultType)){\r\n            q.field(\"parentId\", id);\r\n          }\r\n        }\r\n      }\r\n\r\n      return q;\r\n    }\r\n\r\n    function handleCount(v) {\r\n      pages.pageResults = [];\r\n      pages.counted = true;\r\n      pages.totalCount = v || 0;\r\n\r\n      requesting = false;\r\n      m.redraw();\r\n    }\r\n    function handleList(v) {\r\n      if(v && v[am7model.jsonModelKey] == \"io.queryResult\"){\r\n        v = v.results;\r\n      }\r\n      pages.pageResults[pages.currentPage] = v;\r\n      am7model.updateListModel(v);\r\n      requesting = false;\r\n      m.redraw();\r\n    }\r\n\r\n    function listRouter(url, iPage) {\r\n      if (embeddedMode) {\r\n        updatePage(iPage);\r\n      }\r\n      else {\r\n        m.route.set(url);\r\n      }\r\n    }\r\n    function navNext(bRedrawOnly) {\r\n      if (pages.currentPage < pages.pageCount) {\r\n        if (bRedrawOnly || embeddedMode) {\r\n          updatePage(pages.currentPage + 1);\r\n        }\r\n        else listRouter(getPageUrl(pages.currentPage + 1), pages.currentPage + 1);\r\n      }\r\n    }\r\n    function navPrev(bRedrawOnly) {\r\n      if (pages.currentPage > 1) {\r\n        if (bRedrawOnly || embeddedMode) {\r\n          updatePage(pages.currentPage - 1);\r\n        }\r\n        else listRouter(getPageUrl(pages.currentPage - 1), pages.currentPage - 1);\r\n      }\r\n    }\r\n\r\n    function updatePage(iPage) {\r\n      if (requesting) return;\r\n      if (iPage <= 0 || iPage > pages.pageCount) {\r\n        // console.debug(\"Invalid page: \" + iPage + \" / \" + pages.pageCount);\r\n        return;\r\n      }\r\n\r\n      pages.currentPage = iPage;\r\n      pages.startRecord = (iPage - 1) * pages.recordCount;\r\n      pages.currentItem = -1;\r\n      if (pages.pageResults[iPage]) {\r\n        m.redraw();\r\n      }\r\n\r\n      else {\r\n        /// filter is used for count and list through the search API, which allows for scoping to the current group and recurse through child group structures\r\n        ///\r\n        requesting = true;\r\n\r\n        if (pages.containerSubType != null && pages.containerSubType.match(/^(user|account|person|bucket)$/gi)) {\r\n          am7client.members(pages.containerType, pages.containerId, pages.resultType, pages.startRecord, pages.recordCount, function (v) {\r\n            handleList(v);\r\n          });\r\n        }\r\n        else if (pages.listSystem && pages.resultType.match(/^(policy\\.policy|auth\\.role|auth\\.permission)$/gi)) {\r\n          let ttype =  pages.resultType.substring(pages.resultType.lastIndexOf(\".\") + 1,  pages.resultType.length);\r\n\r\n          let uType = ttype.substring(0, 1).toUpperCase() + ttype.slice(1);\r\n          let fType = uType + \"s\";\r\n          if (uType.match(/y$/)) fType = uType.slice(0, uType.length - 1) + \"ies\";\r\n          let v;\r\n          if((v = page.application[\"system\" + fType])){\r\n            let i = parseInt(pages.startRecord);\r\n            let c = parseInt(pages.recordCount);\r\n            let modList = v.slice(i, i + c);\r\n            handleList(modList);\r\n          }\r\n\r\n        }\r\n        else if (pages.resultType.match(/^request$/)) {\r\n          console.warn(\"REFACTOR LIST REQUESTS\");\r\n          // am7client.listRequests(\"USER\", page.user.objectId, pages.startRecord, pages.recordCount, handleList);\r\n        }\r\n        else {\r\n          getSearchQuery().then((q) => {\r\n            am7client.search(q, handleList);\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    function getRequestFields(type) {\r\n      let flds = am7model.queryFields(type);\r\n      window.am7decorator.map().forEach(m => {\r\n        if(!m.match(/^_/) && !flds.includes(m) && am7model.hasField(type, m)){\r\n          flds.push(m);\r\n        }\r\n      });\r\n      return flds;\r\n\r\n    }\r\n\r\n    function stopPaginating() {\r\n      pagination.paginating = false;\r\n      pages = newPagination();\r\n    }\r\n\r\n    function updateList(type, containerId, navigateByParent, filter, startRecord, recordCount, bSystem) {\r\n      if (requesting) return;\r\n      pagination.paginating = true;\r\n\r\n      entity.listFilter = filter || \"\";\r\n      let sortChange = (entity.sort != pages.sort || entity.order != pages.order);\r\n\r\n      if (\r\n        sortChange\r\n        ||\r\n        ((pages.filter == null && entity.listFilter.length) || (pages.filter != null && pages.filter != entity.listFilter))\r\n        ||\r\n        (pages.containerId != null && pages.containerId != containerId)\r\n        ||\r\n        (!isNaN(recordCount) && recordCount > 0 && pages.recordCount != recordCount)\r\n      ) {\r\n        /// TODO: Need to clean all of this up - the pagination state object needs a better relationship with the entity containing the filter and any search/query configuration\r\n        /// A lot of this is due to the original API being driven by listing by type and membership, and it's morphed into the query/search format which is more flexible (albeit still somewhat limited by type)\r\n        ///\r\n        let sort = pages.sort;\r\n        let order = pages.order;\r\n        pages = newPagination();\r\n        entity.sort = sort;\r\n        entity.order = order;\r\n        pages.sort = sort;\r\n        pages.order = order;\r\n        pages.recordCount = (!isNaN(recordCount) && recordCount > 0 ? recordCount : pages.recordCount);\r\n        pages.filter = (entity.listFilter.length ? entity.listFilter : null);\r\n\r\n      }\r\n      pages.navigateByParent = navigateByParent;\r\n      pages.listSystem = bSystem;\r\n      if (type.match(/^(system\\.user|auth\\.permission|auth\\.role|auth\\.request|auth\\.control)$/gi) || navigateByParent) pages.containerType = type;\r\n      pages.resultType = type;\r\n      pages.containerId = containerId;\r\n\r\n      /// Need to get the container to understand the subType, such as GROUP/DATA vs GROUP/BUCKET\r\n      if (containerId && pages.container == null) {\r\n        requesting = true;\r\n        page.openObject(pages.containerType, pages.containerId).then(v => {\r\n          pages.container = v;\r\n          requesting = false;\r\n          if (v != null) {\r\n            // console.log(\"Redraw to load container object\");\r\n            pages.container = v;\r\n            if (pages.containerType.match(/^auth\\.group$/gi)) {\r\n              pages.containerSubType = pages.container.type;\r\n            }\r\n            m.redraw();\r\n          }\r\n          else {\r\n            console.error(\"Error loading container: \" + pages.containerType + \" / \" + pages.containerId);\r\n          }\r\n        });\r\n      }\r\n      else if (!pages.counted) {\r\n        requesting = true;\r\n        if (pages.containerSubType != null && pages.containerSubType.match(/^(system\\.user|identity\\.account|identity\\.person|bucket)$/gi)) {\r\n          am7client.countMembers(pages.containerType, pages.containerId, type, handleCount);\r\n        }\r\n        else if (bSystem && type.match(/^(policy\\.policy|auth\\.role|auth\\.permission)$/gi)) {\r\n          let ttype = type.substring(type.lastIndexOf(\".\") + 1, type.length);\r\n          let uType = ttype.substring(0, 1).toUpperCase() + ttype.slice(1);\r\n          let fType = uType + \"s\";\r\n          if (uType.match(/y$/)) fType = uType.slice(0, uType.length - 1) + \"ies\";\r\n          if(page.application[\"system\" + fType]){\r\n            handleCount(page.application[\"system\" + fType].length);\r\n          }\r\n        }\r\n        else if (type.match(/^request$/gi)) {\r\n          console.warn(\"REFACTOR COUNT REQUESTS\");\r\n          /*\r\n          am7client.countRequests(\"USER\", page.user.objectId, function (v) {\r\n            handleCount(v);\r\n          });\r\n          */\r\n        }\r\n        else {\r\n\r\n          //let req = getSearchQuery();\r\n          //am7client.searchCount(req, handleCount);\r\n          /// Set record count to 0 because searchCount operates differently than the regular count, counting authorized identifiers outside of a view versus counting rows\r\n          ///\r\n          getSearchQuery().then((req) => {\r\n            req.recordCount = 0;\r\n            page.count(req).then((v) => {\r\n              handleCount(v);\r\n            });\r\n          });\r\n\r\n        }\r\n\r\n      }\r\n      else {\r\n        if (pages.totalCount > 0) pages.pageCount = Math.ceil(pages.totalCount / pages.recordCount);\r\n        if (isNaN(startRecord)) startRecord = 0;\r\n        if (isNaN(recordCount)) recordCount = pages.recordCount;\r\n        pages.startRecord = startRecord;\r\n        pages.recordCount = recordCount;\r\n\r\n        let usePage = 0;\r\n        if (recordCount > 0) {\r\n          usePage = 1;\r\n          if (startRecord > 1) usePage = Math.ceil(startRecord / pages.recordCount) + 1;\r\n          if (usePage != pages.currentPage) {\r\n            updatePage(usePage);\r\n          }\r\n        }\r\n\r\n      }\r\n    }\r\n    function doFilter(sFilt, bRedrawOnly) {\r\n      let url = page.getRawUrl() + \"?startRecord=0\";\r\n      pages = newPagination();\r\n      entity.listFilter = sFilt || \"\";\r\n      console.log(\"Filter: \", entity);\r\n      if (entity.listFilter != null && entity.listFilter.length) {\r\n        url += \"&filter=\" + encodeURI(entity.listFilter);\r\n        pages.filter = entity.listFilter;\r\n      }\r\n      if(bRedrawOnly){\r\n        m.redraw();\r\n      }\r\n      else{\r\n        listRouter(url);\r\n      }\r\n    }\r\n\r\n    function getPageUrl(iPage, iCount) {\r\n      if (isNaN(iPage)) iPage = pages.currentPage;\r\n      if (isNaN(iCount)) iCount = pages.recordCount;\r\n      let url = page.getRawUrl();\r\n      let filter = \"\";\r\n      if (pages.filter != null) filter = \"&filter=\" + encodeURI(pages.filter);\r\n      url += \"?startRecord=\" + ((iPage - 1) * iCount) + filter + \"&recordCount=\" + iCount;\r\n      let stem = page.uriStem();\r\n\r\n      return url + (stem.length ? \"&\" + stem : \"\");\r\n    }\r\n    function paginationControlBar() {\r\n      return m(\"div\", { class: \"result-nav-outer\" }, [\r\n        m(\"div\", { class: \"result-nav-inner\" }, [\r\n          m(\"div\", { class: \"count-label\" }, \"Showing \" + pages.currentPage + \" of \" + pages.pageCount + \" (\" + pages.totalCount + \")\"),\r\n          m(\"nav\", { class: \"result-nav\" }, [\r\n            pageButtons()\r\n          ])\r\n        ])\r\n      ]);\r\n    }\r\n    function pageButtons(bRedrawOnly) {\r\n\r\n      let pageButtons = [];\r\n\r\n      pageButtons.push(paginationButton(\"previous button\", \"keyboard_double_arrow_left\", \"\", function () { listRouter(getPageUrl(1), 1); }));\r\n      pageButtons.push(paginationButton(\"button\", \"chevron_left\", \"\", function () { navPrev(); }));\r\n\r\n      let bMore = (pages.pageCount > 7)\r\n      let left = pages.currentPage - 3;\r\n\r\n      if (left < 1) left = 1;\r\n\r\n      let right = pages.currentPage + 3;\r\n      if (right < 7) right = 7;\r\n      right = Math.min(pages.pageCount, right);\r\n\r\n      if (pages.currentPage > 3 && (right - left) < 7) {\r\n        left = Math.max(right - 6, 1);\r\n      }\r\n      let maxI = Math.max(right, 7);\r\n      for (let i = left; i <= maxI; i++) {\r\n        let style = \"page\";\r\n        let fHandler;\r\n        if (i > pages.pageCount) {\r\n          pageButtons.push(paginationButton(\"page\", null, \"\"));\r\n          continue;\r\n        }\r\n        if (pages.currentPage == i) style = \"page-current\";\r\n        else fHandler = function () {\r\n          listRouter(getPageUrl(i), i);\r\n        };\r\n        pageButtons.push(paginationButton(style, null, i, fHandler));\r\n\r\n      };\r\n      pageButtons.push(paginationButton(\"button\", \"chevron_right\", \"\", function () { navNext(); }));\r\n      pageButtons.push(paginationButton(\"next button\", \"keyboard_double_arrow_right\", \"\", function () { listRouter(getPageUrl(pages.pageCount), pages.pageCount); }));\r\n      return pageButtons;\r\n    }\r\n\r\n    function getPageState(o) {\r\n      if (!pages.pageState[o.objectId]) {\r\n        pages.pageState[o.objectId] = { checked: false };\r\n      }\r\n      return pages.pageState[o.objectId];\r\n    }\r\n\r\n    function paginationButton(sClass, sIco, sLabel, fHandler) {\r\n      return page.iconButton(sClass, sIco, sLabel, fHandler);\r\n    }\r\n\r\n    let pagination = {\r\n      requesting: requesting,\r\n      entity: entity,\r\n      paginating: false,\r\n      new: function () {\r\n        requesting = false;\r\n        pages = newPagination();\r\n        return pages;\r\n      },\r\n      pages: function () { return pages; },\r\n      pageBarView: paginationControlBar,\r\n      update: updateList,\r\n      searchQuery: getSearchQuery,\r\n      handleCount: handleCount,\r\n      handleList: handleList,\r\n      next: navNext,\r\n      prev: navPrev,\r\n      filter: doFilter,\r\n      //changePage: updatePage,\r\n      url: getPageUrl,\r\n      pageButtons: pageButtons,\r\n      state: getPageState,\r\n      button: paginationButton,\r\n      stop: stopPaginating,\r\n      setEmbeddedMode: function(bEmbed) { embeddedMode = bEmbed; }\r\n\r\n    };\r\n    return pagination;\r\n  }\r\n  page.pagination = newPaginationControl;\r\n}())\n\n;/* === client/components/designer.js === */\n(function () {\r\n    const designer = {};\r\n    let designStyle = 'edit';\r\n    let designHtml = \"\";\r\n    let caller;\r\n    let init = false;\r\n    let toggled = false;\r\n    let pickData = false;\r\n    let pickDataObject = null;\r\n    let codeMirror;\r\n\r\n    function handlePickData(dat) {\r\n        if (dat && dat.length) {\r\n            pickDataObject = dat[0];\r\n            pickData = true;\r\n        }\r\n        caller.endPicker();\r\n    }\r\n\r\n    function insertObjectAtCaret(obj) {\r\n        let frame = document.querySelector(\"[rid=designFrame]\");\r\n        let doc = (frame.contentWindow || frame.contentDocument);\r\n        doc.document.body.focus();\r\n\r\n        var oA = doc.document.createElement(\"a\");\r\n\r\n\r\n        let oI;\r\n        var sOrg = am7client.dotPath(am7client.currentOrganization);\r\n        var sThumbUrl = g_application_path + \"/thumbnail/\" + sOrg + \"/data.data\" + obj.groupPath + \"/\" + obj.name + \"/250x250\";\r\n        var sUrl = g_application_path + \"/media/\" + sOrg + \"/data.data\" + obj.groupPath + \"/\" + obj.name;\r\n        var sIco = 0;\r\n        if (!obj.contentType.match(/^image/)) {\r\n            oI = doc.document.createElement(\"span\");\r\n            oI.setAttribute(\"class\", \"material-symbols-outlined material-icons-48\");\r\n            oI.appendChild(document.createTextNode(\"widgets\"));\r\n        }\r\n        else {\r\n            oI = doc.document.createElement(\"img\");\r\n            oI.setAttribute(\"src\", sThumbUrl);\r\n            oI.setAttribute(\"title\", obj.name);\r\n        }\r\n        oA.appendChild(oI);\r\n        oA.setAttribute(\"href\", sUrl);\r\n        oA.setAttribute(\"target\", \"blank\");\r\n        oA.setAttribute(\"title\", obj.name);\r\n        insertNodeAtCaret(oA);\r\n    }\r\n    function insertNodeAtCaret(oNode) {\r\n        var sel, range;\r\n        let frame = document.querySelector(\"[rid=designFrame]\");\r\n        let doc = (frame.contentWindow || frame.contentDocument);\r\n        if (doc.getSelection) {\r\n            sel = doc.getSelection();\r\n            if (sel.getRangeAt && sel.rangeCount) {\r\n                range = sel.getRangeAt(0);\r\n                range.deleteContents();\r\n                range.insertNode(oNode);\r\n            }\r\n        }\r\n    }\r\n\r\n    function pickImage() {\r\n        if (pickData) {\r\n            pickData = false;\r\n            insertObjectAtCaret(pickDataObject);\r\n            pickDataObject = null;\r\n        }\r\n        else caller.preparePicker(caller.getInstance(), 'data.data', handlePickData, \"~/Gallery\");\r\n    }\r\n  \r\n    function defAct(e, action) {\r\n        //console.log(\"Default action: \" + e.srcElement);\r\n        let frame = document.querySelector(\"[rid=designFrame]\");\r\n        let doc = (frame.contentWindow || frame.contentDocument);\r\n        let opt;\r\n        doc.document.body.focus();\r\n        switch (action) {\r\n            case \"Indent\":\r\n            case \"Outdent\":\r\n            case \"InsertHorizontalRule\":\r\n            case \"InsertOrderedList\":\r\n            case \"InsertUnorderedList\":\r\n            case \"JustifyLeft\":\r\n            case \"JustifyCenter\":\r\n            case \"JustifyRight\":\r\n            case \"Underline\":\r\n            case 'Bold':\r\n            case 'Italic':\r\n                console.log(\"Command: '\" + action + \"'\");\r\n                doc.document.execCommand(action, false, opt);\r\n                break;\r\n            default:\r\n                console.log(\"Don't know what to do\");\r\n                break;\r\n        }\r\n        doc.focus();\r\n    }\r\n\r\n    function transitionHandler() {\r\n        init = false;\r\n        let entity = caller.getEntity();\r\n        if (!entity || entity[am7model.jsonModelKey] != 'data.data') {\r\n            console.log(\"Ignoring non data or invalid entity\");\r\n            return;\r\n        }\r\n        let source;\r\n        if (designStyle == 'code') {\r\n            source = codeMirror.getValue();\r\n        }\r\n        else {\r\n            source = refreshDesignSources();\r\n        }\r\n\r\n        caller.getInstance().api.dataBytesStore(source);\r\n        if (caller.getInstance().api.compressionType) {\r\n            caller.getInstance().api.compressionType(\"none\");\r\n        }\r\n        designHtml = \"\";\r\n\r\n    }\r\n    function alignSource() {\r\n        toggled = false;\r\n        if (!init) {\r\n            setupDesigner();\r\n        }\r\n        else {\r\n            switch (designStyle) {\r\n                case 'source':\r\n                    let txt = document.querySelector(\"[rid=designText]\");\r\n                    if (txt) {\r\n                        txt.value = designHtml;\r\n                    }\r\n                    break;\r\n                case 'edit':\r\n                case 'preview':\r\n                    let frame = document.querySelector(\"[rid=designFrame]\");\r\n                    if (frame) {\r\n                        let content = designDocumentHeader + bbConverter.import(designHtml) + designDocumentFooter;\r\n                        writeFrame(frame, content);\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    function toggleStyle(sStyle) {\r\n        designHtml = refreshDesignSources();\r\n        designStyle = sStyle;\r\n        toggled = true;\r\n        m.redraw();\r\n    }\r\n\r\n    let formatOptions = ['BLOCK', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'BlockQuote', 'P'];\r\n    let fontOptions = ['FONT', 'Arial', 'Times', 'Verdana', 'Courier'];\r\n    let fontSizeOptions = ['SIZE', 'Size 1', 'Size 2', 'Size 3', 'Size 4', 'Size 5', 'Size 6', 'Size 7'];\r\n    let fontColorOptions = ['COLOR', 'Black', 'Grey', 'White', 'Yellow', 'Green', 'Blue', 'Violet'];\r\n    let fillColorOptions = ['FILL', 'Black', 'Grey', 'White', 'Yellow', 'Green', 'Blue', 'Violet'];\r\n\r\n    let designDocumentHeader = `<html lang=\"en\">\r\n        <head>\r\n            <meta charset=\"utf-8\">\r\n            <title>forms</title>\r\n            <link rel=\"icon\" href=\"/media/logo_48.png\" />  \r\n            <link href = \"/dist/basiTail.css\" rel = \"stylesheet\" />\r\n            <link href=\"/node_modules/material-icons/iconfont/material-icons.css\" rel=\"stylesheet\" />\r\n            <link rel=\"stylesheet\" href=\"/styles/pageStyle.css\" />\r\n        </head>\r\n        <body class = 'carousel-article'>\r\n    `;\r\n    let designDocumentDefContent = `<h1>Title</h1>\r\n    <h2>Sub Title</h2>\r\n    <div>[ body ]</div>\r\n    `;\r\n\r\n    let designDocumentFooter = `</body></html>`;\r\n\r\n    function setupDesigner() {\r\n        if (init) return;\r\n        let entity = caller.getEntity();\r\n        if (!entity) {\r\n            return;\r\n        }\r\n        if (!entity[am7model.jsonModelKey] || entity[am7model.jsonModelKey] != 'data.data') {\r\n            console.warn(\"Unexpected model: \" + entity[am7model.jsonModelKey]);\r\n            return;\r\n        }\r\n        if (designStyle != 'edit' && designStyle != 'code') {\r\n            console.warn(\"Setup should only be invoked for edit or code mode\");\r\n            return;\r\n        }\r\n\r\n        let bytes = caller.getInstance().api.dataBytesStore();\r\n        if (designStyle == 'code') {\r\n            let tarea = document.querySelector(\"[rid=designText]\");\r\n            if (!tarea) {\r\n                return;\r\n            }\r\n            tarea.value = bytes;\r\n            let cfg = {\r\n                lineNumbers: true,\r\n                mode: \"javascript\",\r\n                indentUnit: 4,\r\n                extraKeys: {\r\n                    Tab: function (cm) {\r\n                        cm.replaceSelection(\"    \", \"end\");\r\n                    }\r\n                },\r\n                autoFocus: false,\r\n                gutters: [\"CodeMirror-lint-markers\"],\r\n                lint: {\r\n                    globals: [\"m\"],\r\n                    onUpdateLinting: function (annotations) {\r\n                        m.redraw();\r\n                    }\r\n                }\r\n            };\r\n            codeMirror = CodeMirror.fromTextArea(tarea, cfg);\r\n            codeMirror.setSize(\"100%\", \"100%\");\r\n            window.dbgCode = codeMirror;\r\n        }\r\n        else {\r\n            let frame = document.querySelector(\"[rid=designFrame]\");\r\n            if (!frame) {\r\n                return;\r\n            }\r\n            if (bytes.length) {\r\n                console.log(\"Write byte store\");\r\n                writeFrame(frame, designDocumentHeader + bbConverter.import(bytes) + designDocumentFooter);\r\n            }\r\n            else {\r\n                writeFrame(frame, designDocumentHeader + designDocumentDefContent + designDocumentFooter);\r\n            }\r\n        }\r\n        init = true;\r\n    }\r\n\r\n    function writeFrame(frame, content) {\r\n\r\n        //console.log(\"Write: \" + content);\r\n        let docType = '<!doctype html>';\r\n        let doc = (frame.contentWindow || frame.contentDocument);\r\n        try {\r\n            if (!doc || !doc.document) {\r\n                console.error(\"WriteContent: Unable to find document; \" + this.writeFrame.caller);\r\n                return;\r\n            }\r\n            var d = doc.document;\r\n            d.open();\r\n            d.write(docType + content);\r\n            d.close();\r\n            enableDesigner(d);\r\n        }\r\n        catch (e) {\r\n            console.error(\"Unexpected UI Error: \" + (e.message ? e.message : e.description));\r\n        }\r\n    }\r\n    function enableDesigner(doc) {\r\n        try {\r\n            if (doc) {\r\n                doc.designMode = (designStyle == 'edit' ? \"on\" : \"off\");\r\n                console.log(\"Design mode: \" + doc.designMode);\r\n                doc.documentElement.focus();\r\n            }\r\n            else {\r\n                console.error(\"Could not find designer document to enabled\");\r\n            }\r\n        }\r\n        catch (e) {\r\n            console.error(\"Error enabling designer: \" + (e.message ? e.message : e.description));\r\n        }\r\n    }\r\n\r\n    function refreshDesignSources() {\r\n        let sSource;\r\n        switch (designStyle) {\r\n            case 'edit':\r\n                let frame = document.querySelector(\"[rid=designFrame]\");\r\n                if (frame) {\r\n                    var doc = (frame.contentWindow || frame.contentDocument);\r\n                    if (!doc || !doc.document) return null;\r\n                    sSource = bbConverter.convertNodes(doc.document.body.childNodes);\r\n                }\r\n                break;\r\n            case 'source':\r\n                let txt = document.querySelector(\"[rid=designText]\");\r\n                if (txt) sSource = txt.value;\r\n                break;\r\n        }\r\n        if (!sSource) sSource = designHtml;\r\n        else designHtml = sSource;\r\n        return sSource;\r\n    }\r\n\r\n    function getDesignField() {\r\n        let field = \"\";\r\n        let cls = 'full-block' + (page.components.picker.inPickMode() ? \" hidden\" : \"\");\r\n        switch (designStyle) {\r\n            case 'edit':\r\n            case 'preview':\r\n                /// src : '/blank.html'\r\n                field = m(\"iframe\", { src: 'about:blank', rid: 'designFrame', class: cls });\r\n                break;\r\n            case 'code':\r\n            case 'source':\r\n                field = m(\"textarea\", { rid: 'designText', class: cls });\r\n                break;\r\n        }\r\n        return field;\r\n    }\r\n\r\n    function getDesigner(attrs) {\r\n        if (attrs && attrs.entity) {\r\n            let mt = attrs.entity.contentType;\r\n            if (mt) {\r\n                if (mt.match(/^text\\//)) {\r\n                    if (designStyle == 'code') designStyle = 'edit';\r\n                    return getRichTextDesigner();\r\n                }\r\n                if (mt.match(/(css|javascript)$/)) {\r\n                    designStyle = 'code';\r\n                    return getCodeDesigner();\r\n                }\r\n            }\r\n        }\r\n        return \"\";\r\n    }\r\n    function getCodeDesigner() {\r\n        return [\r\n            m(\"div\", { class: \"results-overflow\" }, getDesignField())\r\n        ];\r\n    }\r\n    function getRichTextDesigner() {\r\n        return [\r\n            m(\"div\", { class: \"result-nav-outer\" + (page.components.picker.inPickMode() ? \" hidden\" : \"\") }, [\r\n                m(\"div\", { class: \"result-nav-inner\" }, [\r\n                    m(\"div\", { class: \"result-nav\" }, [\r\n                        page.iconButton(\"button\" + (designStyle == 'source' ? ' active' : ''), \"code\", \"\", function () { toggleStyle('source'); }),\r\n                        page.iconButton(\"button\" + (designStyle == 'edit' ? ' active' : ''), \"design_services\", \"\", function () { toggleStyle('edit'); }),\r\n                        page.iconButton(\"button\" + (designStyle == 'preview' ? ' active' : ''), \"preview\", \"\", function () { toggleStyle('preview'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_italic\", \"\", function (e) { defAct(e, 'Italic'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_bold\", \"\", function (e) { defAct(e, 'Bold'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_underlined\", \"\", function (e) { defAct(e, 'Underline'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_align_left\", \"\", function (e) { defAct(e, 'JustifyLeft'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_align_center\", \"\", function (e) { defAct(e, 'JustifyCenter'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_align_justify\", \"\", function (e) { defAct(e, 'JustifyFull'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_align_right\", \"\", function (e) { defAct(e, 'JustifyRight'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_list_bulleted\", \"\", function (e) { defAct(e, 'InsertOrderedList'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_list_numbered\", \"\", function (e) { defAct(e, 'InsertUnorderedList'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_indent_increase\", \"\", function (e) { defAct(e, 'Indent'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"format_indent_decrease\", \"\", function (e) { defAct(e, 'Outdent'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"horizontal_rule\", \"\", function (e) { defAct(e, 'InsertHorizontalRule'); }),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : (pickData ? ' focus' : '')), (pickData ? \"content_paste_go\" : \"image\"), \"\", pickImage),\r\n                        page.iconButton(\"button\" + (designStyle != 'edit' ? ' inactive' : ''), \"link\", \"\", defAct)\r\n                    ]),\r\n                    (designStyle != 'edit' ? '' : m(\"div\", { class: \"result-nav\" }, [\r\n                        m(\"select\", { class: \"nav-select reactive-arrow\" }, formatOptions.map((o) => m(\"option\", o))),\r\n                        m(\"select\", { class: \"nav-select reactive-arrow\" }, fontOptions.map((o) => m(\"option\", o))),\r\n                        m(\"select\", { class: \"nav-select reactive-arrow\" }, fontSizeOptions.map((o) => m(\"option\", o))),\r\n                        m(\"select\", { class: \"nav-select reactive-arrow\" }, fontColorOptions.map((o) => m(\"option\", o))),\r\n                        m(\"select\", { class: \"nav-select reactive-arrow\" }, fillColorOptions.map((o) => m(\"option\", o)))\r\n                    ]))\r\n                ])\r\n            ]),\r\n            m(\"div\", { class: \"results-overflow\" }, getDesignField())\r\n        ];\r\n    }\r\n\r\n    designer.component = {\r\n\r\n        oninit: function (x) {\r\n            if (x.attrs.caller) {\r\n                caller = x.attrs.caller;\r\n                caller.transitionHandler = transitionHandler;\r\n            }\r\n        },\r\n        oncreate: function (x) {\r\n            alignSource();\r\n        },\r\n        onupdate: function (x) {\r\n            if (!init) setupDesigner();\r\n            else if (toggled) alignSource();\r\n        },\r\n        onremove: function (x) {\r\n            init = false;\r\n            caller = null;\r\n            toggled = false;\r\n            pickData = false;\r\n            pickDataObject = null;\r\n        },\r\n\r\n        view: function (v) {\r\n            return (v.attrs.visible ? getDesigner(v.attrs) : \"\");\r\n        }\r\n    };\r\n\r\n    page.components.designer = designer.component;\r\n}());\r\n\n\n;/* === client/components/tree.js === */\n(function () {\r\n\r\n    function newTreeComponent() {\r\n\r\n        let treeMatrix = {};\r\n        let autoExpand = false;\r\n        let selectedNode;\r\n        let origin;\r\n        let originRole;\r\n        let originPermission;\r\n        let list;\r\n        let pendingRefresh = false;\r\n        let dnd;\r\n        let olioMode = true;\r\n        let checkOlio = false;\r\n        let olio;\r\n\r\n        function inlineType(type, fConfirm, fCancel) {\r\n            treeMatrix[selectedNode].expanded = true;\r\n            let entity = am7model.newPrimitive(type);\r\n            if (type == \"auth.group\") {\r\n                entity.path = treeMatrix[selectedNode].path;\r\n            }\r\n            if (type == \"auth.role\" || type == \"auth.permission\") {\r\n                entity.path = treeMatrix[selectedNode].path + \"/\" + treeMatrix[selectedNode].name;\r\n            }\r\n\r\n            let dlg = {\r\n                label: \"New \" + type,\r\n                entityType: type,\r\n                size: 50,\r\n                data: { entity },\r\n                confirm: async function (data) {\r\n                    if (fConfirm) await fConfirm(data);\r\n                    page.components.dialog.endDialog();\r\n                },\r\n                cancel: async function (data) {\r\n                    if (fCancel) await fCancel(data);\r\n                    page.components.dialog.endDialog();\r\n                }\r\n            };\r\n            page.components.dialog.setDialog(dlg);\r\n        }\r\n        async function inlineAdd(data) {\r\n            let mtx = treeMatrix[selectedNode];\r\n            let newGrp = data.entity;\r\n            if (mtx.type == \"auth.group\") {\r\n                newGrp.type = data.entity.type;\r\n            }\r\n\r\n            if (mtx.type == \"auth.role\" || mtx.type == \"auth.permission\" || mtx.type == \"auth.group\") {\r\n                newGrp.path = treeMatrix[selectedNode].path + \"/\" + treeMatrix[selectedNode].name;\r\n            }\r\n\r\n            if (mtx.type.match(/^(auth\\.role|auth\\.permission)$/)) {\r\n                newGrp.type = data.entity.type;\r\n            }\r\n            newGrp.parentId = mtx.nodeId;\r\n            newGrp.name = data.entity.name;\r\n            await page.createObject(newGrp);\r\n            resetNode(selectedNode);\r\n            am7client.clearCache(newGrp[am7model.jsonModelKey], true);\r\n            m.redraw();\r\n        }\r\n\r\n        function addNew() {\r\n            let mtx = treeMatrix[selectedNode];\r\n            inlineType(mtx.listChildType, inlineAdd, async function (data) {\r\n                //inlineType(mtx.type.toLowerCase(), inlineAdd, async function(data){\r\n                console.log(\"Cancel\");\r\n            });\r\n        }\r\n\r\n        function scrollToLast(){\r\n            let sel = document.getElementById(\"selectedNode\");\r\n            if(sel != null){\r\n              //sel.scrollIntoView();\r\n            }\r\n  \r\n          }\r\n\r\n        function deleteNode() {\r\n            if (!selectedNode || selectedNode == origin.objectId) return;\r\n            let node = treeMatrix[selectedNode];\r\n            let pid;\r\n            Object.keys(treeMatrix).forEach((t) => {\r\n                let tmx = treeMatrix[t];\r\n                if (!pid && t != selectedNode && tmx.nodeId == node.parentId) {\r\n                    pid = tmx.id;\r\n                }\r\n            });\r\n            console.log(\"PID\", pid);\r\n            page.components.dialog.confirm(\"Delete \" + node.type + \" \" + node.name + \"?\", async function () {\r\n                await page.deleteObject(node.type, node.id);\r\n                am7client.clearCache(node.type, true);\r\n                delete treeMatrix[selectedNode];\r\n                if (pid) {\r\n                    selectedNode = pid;\r\n                    resetNode(pid);\r\n                    am7client.clearCache(\"auth.group\", true);\r\n                    m.redraw();\r\n                }\r\n            });\r\n        }\r\n        function refreshTree() {\r\n            Object.keys(treeMatrix).forEach((i) => {\r\n                resetNode(i, true);\r\n            });\r\n            am7client.clearCache(\"auth.group\", true);\r\n            m.redraw();\r\n        }\r\n        function getTreeView() {\r\n            let tree = [];\r\n\r\n            let buttons = [];\r\n            buttons.push(page.iconButton(\"button\", \"add\", \"\", addNew));\r\n            buttons.push(page.iconButton(\"button\", \"refresh\", \"\", refreshTree));\r\n            buttons.push(page.iconButton(\"button\" + (selectedNode && selectedNode != origin.objectId ? \"\" : \" inactive\"), \"delete_outline\", \"\", deleteNode));\r\n            let buttonBar = m(\"div\", { class: \"result-nav-outer\" }, [\r\n                m(\"div\", { class: \"result-nav-inner\" }, [\r\n                    m(\"div\", { class: \"result-nav tab-container\" },\r\n                        buttons\r\n                    ),\r\n                    m(\"nav\", { class: \"result-nav\" }, [\r\n                        //page.pagination().pageButtons()\r\n                    ])\r\n                ])\r\n            ]);\r\n\r\n            if (origin) {\r\n                if (!selectedNode) selectedNode = origin.objectId;\r\n                tree.push(getTreeViewNode(origin));\r\n                if (olioMode) {\r\n                    if (!olio && !checkOlio) {\r\n                        checkOlio = true;\r\n                        page.findObject(\"auth.group\", \"DATA\", \"/Olio/Universes\").then((g) => {\r\n                            if (!g) {\r\n                                return;\r\n                            }\r\n                            let q = am7view.viewQuery(am7model.newInstance(\"auth.group\"));\r\n                            q.field(\"objectId\", g.objectId);\r\n                            page.search(q).then((g2) => {\r\n\r\n                                if (g2 && g2.results) {\r\n                                    olio = g2.results[0];\r\n                                    m.redraw();\r\n                                }\r\n                            })\r\n                        });\r\n                    }\r\n                    else if (olio) {\r\n                        tree.push(getTreeViewNode(olio));\r\n                    }\r\n                }\r\n                else {\r\n                    console.log(\"Not olio mode\");\r\n                }\r\n            }\r\n\r\n            return m(\"div\", { class: \"list-results-container\" }, [\r\n                m(\"div\", { class: \"list-results\" }, [\r\n                    buttonBar,\r\n                    m(\"div\", { class: \"results-overflow\" }, tree)\r\n                ])\r\n            ]);\r\n        }\r\n\r\n        function getMatrix(node) {\r\n            let bGroup = (node[am7model.jsonModelKey] === \"auth.group\");\r\n            let nodeName = node.name;\r\n            if (!treeMatrix[node.objectId]) {\r\n                let fList = \"list\";\r\n                let fListType = \"data.data\";\r\n                let ico = \"folder\";\r\n                let builtIn = false;\r\n\r\n                /// Auto-Type, Lock from dragging out\r\n                let pathType;\r\n                if (bGroup) {\r\n                    if (node.type && node.type.match(/^(account|person)$/gi)) {\r\n                        /// fListType = node.type;\r\n                        fListType = \"identity.\" + node.type;\r\n                        let modType = am7model.getModel(fListType.toLowerCase());\r\n                        ico = modType.icon;\r\n                    }\r\n                    else if (node.type && node.type.match(/^(bucket)$/gi)) {\r\n                        ico = \"collections_bookmark\";\r\n                        if (node.name.match(/^favorite/i)) {\r\n                            ico = \"favorite\";\r\n                        }\r\n                    }\r\n                    else {\r\n                        let path = node.path;\r\n                        let idx = node.path.indexOf(origin.path);\r\n                        if (idx == 0) {\r\n                            path = path.slice(idx + origin.path.length + 1);\r\n                        }\r\n\r\n                        // console.log(path, am7view.typeByPath(path));\r\n                        let pathType;\r\n                        if (path.indexOf(\"/\") > -1) {\r\n                            let np = node.path;\r\n                            np = np.replace(/\\/Gallery$/, \"/Gallery\");\r\n                            pathType = am7view.typeByPath(np) || \"data.data\";\r\n                        }\r\n                        else{\r\n                            pathType = am7view.typeByPath(path) || \"data.data\";\r\n                        }\r\n                        if (pathType) {\r\n                            fListType = pathType;\r\n                            let modType = am7model.getModel(pathType);\r\n                            if (modType) {\r\n                                if (modType.icon) {\r\n                                    ico = modType.icon;\r\n                                }\r\n                                if (modType.limit && modType.limit.length) {\r\n                                    fListType = modType.limit[0];\r\n                                }\r\n                                else if (modType.type) {\r\n                                    fListType = modType.type;\r\n                                }\r\n                            }\r\n                            //builtIn = true;\r\n                        }\r\n                        else\r\n                        if (node.path == page.user.homeDirectory.path) {\r\n                            ico = \"gite\";\r\n                        }\r\n                        \r\n                    }\r\n                }\r\n                else if (node[am7model.jsonModelKey].match(/^(auth\\.role|auth\\.permission)$/gi)) {\r\n                    let modType = am7model.getModel(node[am7model.jsonModelKey].toLowerCase());\r\n                    if (modType && modType.icon) {\r\n                        ico = modType.icon;\r\n                    }\r\n                    fListType = node[am7model.jsonModelKey];\r\n                    //fList = \"listInParent\";\r\n                    fList = \"list\";\r\n                    if (node.objectId == originPermission.objectId || node.objectId == originRole.objectId) {\r\n                        nodeName = (node[am7model.jsonModelKey] == \"auth.role\" ? \"Roles\" : \"Permissions\");\r\n                        builtIn = true;\r\n                    }\r\n\r\n                }\r\n                treeMatrix[node.objectId] = {\r\n                    id: node.objectId,\r\n                    name: nodeName,\r\n                    type: node[am7model.jsonModelKey],\r\n                    objectType: node.type,\r\n                    path: node.path,\r\n                    groupId: node.groupId,\r\n                    parentId: node.parentId,\r\n                    expanded: false,\r\n                    origin: (node.objectId === origin.objectId),\r\n                    baseIco: ico,\r\n                    builtIn,\r\n                    ico,\r\n                    listEntityType: fListType,\r\n                    listChildType: node[am7model.jsonModelKey],\r\n                    flist: fList,\r\n                    nodeId: node.id\r\n                };\r\n            }\r\n\r\n            let mtx = treeMatrix[node.objectId];\r\n\r\n            if (bGroup && !mtx.origin) {\r\n                mtx.ico = (mtx.expanded && mtx.children && mtx.children.length ? \"folder_open\" : mtx.baseIco);\r\n            }\r\n\r\n            return mtx;\r\n        }\r\n\r\n        function expandNode(node) {\r\n            let mtx = treeMatrix[node.objectId];\r\n            mtx.expanded = !mtx.expanded;\r\n            m.redraw();\r\n        }\r\n        function selectNode(node) {\r\n            if (autoExpand) {\r\n                expandNode(node);\r\n            }\r\n            selectedNode = node.objectId;\r\n            if (list) {\r\n                list.pagination().new();\r\n            }\r\n            m.route.set(\"/nav\");\r\n        }\r\n\r\n        function getNestedTreeView(node) {\r\n            return m(\"div\", { class: \"hier-item-nest\" }, getTreeViewNode(node));\r\n        }\r\n\r\n        function getTreeViewNode(node) {\r\n\r\n            if (!node) return \"\";\r\n\r\n            /// Depending on how it's queried, the model property will be pruned from complex objects since the schema definition includes the model type, so that the same\r\n            /// The downside is, if looking at a child node without the parent model reference, you don't know what the child type is supposed to be\r\n            ///\r\n            if (!node[am7model.jsonModelKey]) {\r\n                //console.warn(\"push model to group: \" + node.name);\r\n                node[am7model.jsonModelKey] = 'auth.group';\r\n            }\r\n            if (!node[am7model.jsonModelKey].match(/^(auth\\.role|auth\\.permission|auth\\.group)$/gi)) {\r\n                console.warn(\"Only roles, groups, and permissions are supported for hierarchical navigation\");\r\n                return \"\";\r\n            }\r\n            let bExpand = false;\r\n            let mtx = getMatrix(node);\r\n            if (mtx.origin || mtx.expanded) bExpand = true;\r\n\r\n            let label = mtx.name;\r\n            let nest = [];\r\n            if (bExpand) {\r\n                if (!mtx.children) {\r\n                    if (!pendingRefresh) {\r\n                        pendingRefresh = true;\r\n                        // console.log(mtx.flist, mtx.listChildType, mtx.id, mtx);\r\n                        am7client[mtx.flist](mtx.listChildType, mtx.id, null, 0, 1000, function (v) {\r\n                            if(!v || v == null){\r\n                                pendingRefresh = false;\r\n                                m.redraw();\r\n                                return;\r\n                            }\r\n                            am7model.updateListModel(v);\r\n                            mtx.children = v.filter((o) => { return !o.name.match(/^\\./); });\r\n                            if (node.objectId == origin.objectId) {\r\n                                page.parentType(\"auth.role\").then((rb) => {\r\n                                    page.parentType(\"auth.permission\").then((pb) => {\r\n                                        mtx.children.push(rb);\r\n                                        mtx.children.push(pb);\r\n                                        originRole = rb;\r\n                                        originPermission = pb;\r\n\r\n                                        mtx.children = mtx.children.sort(function (aa, bb) {\r\n                                            let n1 = aa.name;\r\n                                            if (aa.objectId == rb.objectId) n1 = \"Roles\";\r\n                                            else if (aa.objectId == pb.objectId) n1 = \"Permissions\";\r\n                                            let n2 = bb.name;\r\n                                            if (bb.objectId == rb.objectId) n2 = \"Roles\";\r\n                                            else if (bb.objectId == pb.objectId) n2 = \"Permissions\";\r\n                                            return (\r\n                                                n1 < n2\r\n                                                    ? -1\r\n                                                    : 1\r\n                                            );\r\n                                        });\r\n                                        pendingRefresh = false;\r\n                                        m.redraw();\r\n                                    });\r\n                                });\r\n                            }\r\n                            else {\r\n                                pendingRefresh = false;\r\n                                m.redraw();\r\n                            }\r\n\r\n\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    mtx.children.forEach((c) => {\r\n                        nest.push(getNestedTreeView(c));\r\n                    });\r\n                }\r\n            }\r\n            let altCls = \"\";\r\n            let altActive = \"\";\r\n            if ((node.objectType && node.objectType.match(/^(bucket|account|person)$/gi)) || (originPermission && node.objectId == originPermission.objectId) || (originRole && node.objectId == originRole.objectId)) {\r\n                altCls = \" material-symbols-outlined-orange\";\r\n                altActive = \"-orange\";\r\n\r\n            }\r\n            let icoCls = \"flare hier-item-element material-icons-24 material-symbols-outlined\" + altCls;\r\n            let selId;\r\n            if (node.objectId == selectedNode) {\r\n                icoCls += \" filled active\" + altActive;\r\n                selId = \"selectedNode\";\r\n            }\r\n\r\n            let fHandler = function () {\r\n                selectNode(node);\r\n            }\r\n            let attr = \"\";\r\n            if (!mtx.builtIn) {\r\n                attr = \"[draggable]\";\r\n            }\r\n            let itemProps = {\r\n                class: \"hier-item\",\r\n                ondblclick: function () { expandNode(node); },\r\n                onclick: fHandler,\r\n\r\n            };\r\n\r\n            let dcls = dnd.doDragDecorate(node);\r\n            if (dcls) itemProps.class += \" \" + dcls;\r\n\r\n            itemProps.ondragover = function (e) { dnd.doDragOver(e, node); };\r\n            itemProps.ondragend = function (e) { dnd.doDragEnd(e, node); };\r\n            itemProps.ondragstart = function (e) { dnd.doDragStart(e, node); };\r\n            itemProps.ondrop = function (e) { dnd.doDrop(e, node); };\r\n\r\n            return m(\"div\", { id: selId, class: \"hier-item-container\" }, [\r\n                m(\"div\" + attr, itemProps, [\r\n                    m(\"span\", { class: icoCls }, mtx.ico),\r\n                    m(\"span\", { class: \"hier-item-element\" }, label)\r\n                ]),\r\n                nest\r\n            ])\r\n        }\r\n\r\n        function resetNode(objectId, skipList) {\r\n            if (treeMatrix[objectId]) {\r\n                let mtx = treeMatrix[objectId];\r\n                delete mtx.children;\r\n                /*\r\n                if(mtx.parentId){\r\n                    let pid;\r\n                    Object.keys(treeMatrix).forEach((t)=>{\r\n                        if(!pid && t.objectId != objectId && t.nodeId == mtx.parentId){\r\n                            pid = t.id;\r\n                        }\r\n                    });\r\n                    if(pid) resetNode(pid, skipList);\r\n                }\r\n                */\r\n                if (!skipList) list.pagination().new();\r\n            }\r\n        }\r\n\r\n        let tree = {\r\n            resetNode,\r\n            selectedNode: function () {\r\n                if (!selectedNode) return;\r\n                return treeMatrix[selectedNode];\r\n            },\r\n            oninit: function (vnode) {\r\n                dnd = page.components.dnd;\r\n                list = vnode.attrs.list;\r\n                origin = vnode.attrs.origin || page.user.homeDirectory;\r\n            },\r\n            oncreate: function (x) {\r\n\r\n            },\r\n            onremove: function (x) {\r\n\r\n            },\r\n            onupdate: function(x){\r\n                scrollToLast();\r\n            },\r\n\r\n            view: function () {\r\n                return getTreeView()\r\n            }\r\n        };\r\n        return tree;\r\n    }\r\n    page.components.tree = newTreeComponent;\r\n}());\r\n\n\n;/* === client/components/picker.js === */\n(function () {\r\n\r\n    let pickerMode = {\r\n        enabled: false,\r\n        containerId: undefined,\r\n        pickPath: undefined\r\n    };\r\n    let childPickerMode;\r\n    let requesting = false;\r\n\r\n    function fieldPicker(inst, field, useName, altEntity, altPath, pickerHandler){\r\n        let entity = inst?.entity;\r\n        let useEntity = altEntity || entity;\r\n        if(!useEntity || !field.pickerProperty){\r\n            console.log(\"Invalid entity or field property\",useEntity,field);\r\n            return;\r\n        }\r\n        let mat;\r\n        let type = (entity[am7model.jsonModelKey] ? entity[am7model.jsonModelKey] : undefined);\r\n        let setType = false;\r\n        /// Special handling for embedding pickers in disconnected tables\r\n        ///\r\n        if(\r\n            field.pickerProperty.foreign\r\n            &&\r\n            useName\r\n            &&\r\n            (mat = useName.match(/(\\-\\d+)$/)) != null\r\n            &&\r\n            field.pickerType\r\n            &&\r\n            field.pickerType.match(/^\\./)\r\n        ){\r\n            console.log(field.pickerType.slice(1) + mat[1]);\r\n            let el = document.querySelector(\"[name='\" + field.pickerType.slice(1) + mat[1] + \"']\");\r\n            type = el.value.toLowerCase();\r\n            setType = true;\r\n        }\r\n        else{\r\n            if(field.pickerType && field.pickerType !== 'self') type = field.pickerType;\r\n            if(type.match(/^\\./)){\r\n                type = useEntity[type.slice(1)].toLowerCase();\r\n            }\r\n        }\r\n        if(!type.match(/^unknown$/gi)){\r\n            preparePicker(inst, type, function(data){\r\n                if(data && data.length){\r\n                    if(useEntity == inst.entity){\r\n                        \r\n                        if(field.pickerProperty.selected === '{object}'){\r\n                            // inst.api[field.pickerProperty.entity](data[0]);\r\n\r\n                            if(field.pickerProperty.entity.match(/\\./)){\r\n                                let pv = field.pickerProperty.entity.split(\".\");\r\n                                if(pinst[pv[0]]){\r\n                                    inst[pv[0]].api(data[0]);\r\n                                    pinst[pv[0]].api[pv[1]](data[0]);\r\n                                }\r\n                                else{\r\n                                    console.warn(\"didn't find \" + pv[0]);\r\n                                }\r\n                                //inst.dapi(field.pickerProperty.entity, data[0]);\r\n                                \r\n                            }\r\n                            else{\r\n                                console.log(\"Update pick\");\r\n                                inst.api[field.pickerProperty.entity](data[0]);\r\n                            }\r\n                        }\r\n                        else{\r\n                            console.log(\"Update\", field.pickerProperty.entity);\r\n                            //inst.api[field.pickerProperty.entity](data[0][field.pickerProperty.selected]);\r\n                            inst.api[field.pickerProperty.entity](data[0][field.pickerProperty.selected]);\r\n                        }\r\n                        cancelPicker(true);\r\n                        if(setType){\r\n                            inst.api[field.pickerType.slice(1)](type);\r\n                        }\r\n\r\n                    }\r\n                    else{\r\n                        if(field.pickerProperty.selected === '{object}') useEntity[field.pickerProperty.entity] = data[0];\r\n                        else useEntity[field.pickerProperty.entity] = data[0][field.pickerProperty.selected];\r\n                        cancelPicker(true);\r\n                        if(setType){\r\n                            useEntity[field.pickerType.slice(1)] = type;\r\n                        }\r\n                    }\r\n\r\n                    updateChange();\r\n                    if(pickerHandler){\r\n                        pickerHandler(objectPage, inst, field, useName, data[0]);\r\n                    }\r\n                    /// Clear the server cache because the parent may have a cached copy of the child\r\n                    ///\r\n                    if(!useEntity[am7model.jsonModelKey] || useEntity[am7model.jsonModelKey].match(/message/i)) m.redraw();\r\n                    else{\r\n                        am7client.clearCache(useEntity[am7model.jsonModelKey], false, function(){\r\n                            m.redraw();\r\n                        });\r\n                    }\r\n                }\r\n            }, altPath || field.pickerProperty.path);\r\n        }\r\n    }\r\n\r\n    function preparePicker(inst, type, handler, altPath){\r\n        requesting = true;\r\n        return new Promise((res, rej)=>{\r\n\r\n            let model = am7model.getModel(type);\r\n            if(!model){\r\n                console.error(\"Invalid model for '\" + type + \"'\");\r\n                rej();\r\n            }\r\n            // pickerMode.tabIndex = tabIndex;\r\n            pickerMode.type = type;\r\n            pickerMode.handler = handler;\r\n            if(am7model.isGroup(model) || am7model.isParent(model)) pickerMode.pickPath = altPath || am7view.path(type);\r\n            if(am7model.isGroup(model)){\r\n                console.warn(\"PICK PATH\", pickerMode.pickPath);\r\n                am7client.make(\"auth.group\",\"data\", pickerMode.pickPath, function(v){\r\n                    pickerMode.containerId = v.objectId;\r\n                    requesting = false;\r\n                    enablePicker();\r\n                    res();\r\n                });\r\n            }\r\n            else if(type.match(/^(auth\\.role|auth\\.permission)$/)){\r\n                am7client.user(type, \"user\", function(v){\r\n                    uwm.getDefaultParentForType(type, v).then((parObj) =>{\r\n                        pickerMode.containerId = parObj.objectId;\r\n                        requesting = false;\r\n                        enablePicker();\r\n                        res();\r\n                    });\r\n                });\r\n\r\n            }\r\n            else if(type.match(/^user$/)){\r\n                enablePicker();\r\n                res();\r\n            }\r\n            else{\r\n                console.warn(\"Handle pick \" + type);\r\n            }\r\n        });\r\n    }\r\n    function enablePicker(bNoRefresh, objectPage, caller){\r\n        pickerMode.enabled = true;\r\n        if(caller){\r\n            childPickerMode = objectPage;\r\n        }\r\n        if(!bNoRefresh){\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    function cancelPicker(bNoRefresh){\r\n        if(childPickerMode){\r\n            childPickerMode.cancelPicker(bNoRefresh);\r\n            childPickerMode = undefined;\r\n        }\r\n        pickerMode.enabled = false;\r\n        if(!bNoRefresh){\r\n            m.redraw();\r\n        }\r\n    }\r\n\r\n    const picker = {\r\n        cancelPicker,\r\n        enablePicker,\r\n        validateFormat: function(inst, field, format, useName){\r\n            if(format === \"picker\" && field.pickerProperty && field.pickerProperty.requiredAttributes){\r\n                let req = field.pickerProperty;\r\n                if(!am7view.showField(inst, req, useName)){\r\n                    format = \"text\";\r\n                }\r\n            }\r\n            return format;\r\n        },\r\n        inPickMode : function(){\r\n            return (pickerMode.enabled || childPickerMode);\r\n        },\r\n        fieldPicker\r\n\r\n    };\r\n  \r\n\r\n    page.components.picker = picker;\r\n}());\r\n\n\n;/* === client/components/formFieldRenderers.js === */\n(function() {\r\n    /// Form Field Renderers for Object Edit Views\r\n    /// These handle input fields in the object editor (view/object.js)\r\n    ///\r\n    /// Each renderer receives a context object with:\r\n    ///   - inst: the prepared instance with API methods\r\n    ///   - entity: the current entity being edited\r\n    ///   - field: the model field definition\r\n    ///   - fieldView: the form field configuration\r\n    ///   - name: the field name\r\n    ///   - useName: the actual input name (may differ for arrays)\r\n    ///   - defVal: the default/current value\r\n    ///   - fieldClass: CSS classes to apply\r\n    ///   - disabled: whether the field is disabled\r\n    ///   - fHandler: the change handler function\r\n    ///   - show: whether the field should be visible\r\n\r\n    let renderers = {};\r\n    let audioRecord = false;\r\n\r\n    /// ========================================\r\n    /// SIMPLE RENDERERS - No dependencies\r\n    /// ========================================\r\n\r\n    /// Blank placeholder field\r\n    renderers.blank = function(ctx) {\r\n        return [m(\"span\", {class: \"blank\"})];\r\n    };\r\n\r\n    /// Read-only print display\r\n    renderers.print = function(ctx) {\r\n        let val = ctx.defVal;\r\n        if (!val && ctx.entity) val = ctx.entity[ctx.useName];\r\n        return [m(\"span\", {class: ctx.fieldClass + \" inline-block text-field-full text-content\"}, val)];\r\n    };\r\n\r\n    /// Read-only print with alert styling\r\n    renderers[\"print-alert\"] = function(ctx) {\r\n        let val = ctx.defVal;\r\n        if (!val && ctx.entity) val = ctx.entity[ctx.useName];\r\n        return [m(\"span\", {class: \"text-content-alert\"}, val)];\r\n    };\r\n\r\n    /// Checkbox field\r\n    renderers.checkbox = function(ctx) {\r\n        let inputAttrs = {\r\n            type: \"checkbox\",\r\n            class: ctx.fieldClass + \" check-field\",\r\n            name: ctx.useName,\r\n            checked: ctx.defVal,\r\n            oninput: ctx.fHandler\r\n        };\r\n        if (ctx.disabled) {\r\n            inputAttrs.disabled = true;\r\n        }\r\n        return [m(\"input\", inputAttrs)];\r\n    };\r\n\r\n    /// Color picker field\r\n    renderers.color = function(ctx) {\r\n        let inputAttrs = {\r\n            type: \"color\",\r\n            class: ctx.fieldClass + \" color-field\",\r\n            name: ctx.useName,\r\n            value: ctx.defVal,\r\n            oninput: ctx.fHandler\r\n        };\r\n        if (ctx.disabled) {\r\n            inputAttrs.disabled = true;\r\n        }\r\n        return [m(\"input\", inputAttrs)];\r\n    };\r\n\r\n    /// ========================================\r\n    /// SELECT AND DROPDOWN RENDERERS\r\n    /// ========================================\r\n\r\n    /// Select dropdown field\r\n    /// Uses am7view.defaultValuesForField to get enum/list values\r\n    renderers.select = function(ctx) {\r\n        let vals = am7view.defaultValuesForField(ctx.field);\r\n        let selectAttrs = {\r\n            class: ctx.fieldClass + \" select-field-full\",\r\n            name: ctx.useName,\r\n            oninput: ctx.fHandler\r\n        };\r\n\r\n        let options = vals.map(function(v) {\r\n            let vs = String(v);\r\n            let selected = ctx.defVal != null && String(ctx.defVal).toLowerCase() === vs.toLowerCase();\r\n            let optAttrs = {value: vs.toLowerCase()};\r\n            if (selected) optAttrs.selected = \"true\";\r\n            return m(\"option\", optAttrs, v);\r\n        });\r\n\r\n        return [m(\"select\", selectAttrs, options)];\r\n    };\r\n\r\n    /// ========================================\r\n    /// RANGE SLIDER RENDERER\r\n    /// ========================================\r\n\r\n    /// Range slider field with min/max display\r\n    renderers.range = function(ctx) {\r\n        let min = 0;\r\n        let max = 100;\r\n\r\n        if (typeof ctx.field.minValue == \"number\" && typeof ctx.field.maxValue == \"number\") {\r\n            if (ctx.field.type == \"double\" && ctx.field.maxValue >= 1) {\r\n                max = ctx.field.maxValue * 100;\r\n                if (min != 0) {\r\n                    min = ctx.field.minValue * 100;\r\n                }\r\n            } else {\r\n                min = ctx.field.minValue;\r\n                max = ctx.field.maxValue;\r\n            }\r\n        }\r\n\r\n        let inputAttrs = {\r\n            type: \"range\",\r\n            class: ctx.fieldClass + \" range-field-full\",\r\n            name: ctx.useName,\r\n            value: ctx.defVal,\r\n            min: min,\r\n            max: max,\r\n            oninput: ctx.fHandler\r\n        };\r\n        if (ctx.disabled) {\r\n            inputAttrs.disabled = true;\r\n        }\r\n\r\n        return [m(\"div\", {class: \"relative mb-5\"}, [\r\n            m(\"label\", {class: \"sr-only\"}, \"Range\"),\r\n            m(\"input\", inputAttrs),\r\n            m(\"span\", {class: \"text-sm text-gray-500 absolute start-0 -bottom-6\"}, min),\r\n            m(\"span\", {class: \"text-sm text-gray-500 absolute start-1/2 -translate-x-1/2 -bottom-6\"}, ctx.defVal),\r\n            m(\"span\", {class: \"text-sm text-gray-500 absolute end-0 -bottom-6\"}, max)\r\n        ])];\r\n    };\r\n\r\n    /// ========================================\r\n    /// PROGRESS BAR RENDERER\r\n    /// ========================================\r\n\r\n    /// Progress bar field\r\n    renderers.progress = function(ctx) {\r\n        let progressAttrs = {\r\n            class: ctx.fieldClass + \" progress-field-full\",\r\n            name: ctx.useName,\r\n            value: ctx.defVal,\r\n            max: ctx.field.maxValue || 100,\r\n            min: ctx.field.minValue || 0\r\n        };\r\n        if (ctx.disabled) {\r\n            progressAttrs.disabled = true;\r\n        }\r\n        return [m(\"progress\", progressAttrs)];\r\n    };\r\n\r\n    /// ========================================\r\n    /// BUTTON RENDERER\r\n    /// ========================================\r\n\r\n    /// Button field with optional icon\r\n    renderers.button = function(ctx) {\r\n        let buttonHandler = function() {\r\n            if (ctx.field.command) {\r\n                ctx.field.command(ctx.objectPage, ctx.inst, ctx.name);\r\n            }\r\n        };\r\n\r\n        let buttonContent = [];\r\n        if (ctx.fieldView.icon) {\r\n            buttonContent.push(m(\"span\", {class: \"material-symbols-outlined material-icons-24\"}, ctx.fieldView.icon));\r\n        }\r\n        if (ctx.field.label) {\r\n            buttonContent.push(ctx.field.label);\r\n        }\r\n\r\n        let buttonAttrs = {\r\n            class: ctx.fieldClass + \" button-field-full\",\r\n            onclick: buttonHandler\r\n        };\r\n        if (ctx.disabled) {\r\n            buttonAttrs.disabled = true;\r\n        }\r\n\r\n        return [m(\"button\", buttonAttrs, buttonContent)];\r\n    };\r\n\r\n    /// ========================================\r\n    /// TEXT INPUT RENDERERS\r\n    /// ========================================\r\n\r\n    /// Helper to create audio recording button for text fields\r\n    function createAudioRecordButton(ctx) {\r\n        if (typeof page === \"undefined\" || !page.components || !page.components.audio) {\r\n            return \"\";\r\n        }\r\n        return page.components.audio.recordField(function(text) {\r\n            if (text !== null) {\r\n                ctx.inst.api[ctx.name](text);\r\n            } else {\r\n                return ctx.inst.api[ctx.name]() || \"\";\r\n            }\r\n        });\r\n    }\r\n\r\n    /// Helper to apply drag-and-drop props to a field\r\n    function applyDragAndDrop(ctx, props) {\r\n        if (ctx.entity && !ctx.entity.objectId && ctx.fieldView.dragAndDrop) {\r\n            props.class += \" border-dotted\";\r\n            if (typeof page !== \"undefined\" && page.components && page.components.dnd) {\r\n                let dnd = page.components.dnd.dropProps(ctx.inst);\r\n                Object.assign(props, dnd);\r\n            }\r\n            props.placeholder = \"{ Type Text or Drop File Here }\";\r\n        }\r\n        return props;\r\n    }\r\n\r\n    /// Text input field with audio recording support\r\n    renderers.text = function(ctx) {\r\n        let inputAttrs = {\r\n            type: \"text\",\r\n            class: ctx.fieldClass + \" text-field-full pr-8\",\r\n            name: ctx.useName,\r\n            value: ctx.defVal,\r\n            oninput: ctx.fHandler\r\n        };\r\n        if (ctx.disabled) {\r\n            inputAttrs.disabled = true;\r\n        }\r\n\r\n        inputAttrs = applyDragAndDrop(ctx, inputAttrs);\r\n\r\n        return [m(\"div\", {class: \"relative w-full\"},\r\n            m(\"input\", inputAttrs),\r\n            (audioRecord ? m(\"div\", {class: \"absolute inset-y-0 right-0 flex items-center\"},\r\n                createAudioRecordButton(ctx)\r\n            ) : \"\")\r\n        )];\r\n    };\r\n\r\n    /// Datetime-local field (shares most logic with text)\r\n    renderers[\"datetime-local\"] = function(ctx) {\r\n        let inputAttrs = {\r\n            type: \"datetime-local\",\r\n            class: ctx.fieldClass + \" text-field-full pr-8\",\r\n            name: ctx.useName,\r\n            value: ctx.defVal,\r\n            oninput: ctx.fHandler\r\n        };\r\n        if (ctx.disabled) {\r\n            inputAttrs.disabled = true;\r\n        }\r\n\r\n        return [m(\"div\", {class: \"relative w-full\"},\r\n            m(\"input\", inputAttrs),\r\n            (audioRecord ? m(\"div\", {class: \"absolute inset-y-0 right-0 flex items-center\"},\r\n                createAudioRecordButton(ctx)\r\n            ) : \"\")\r\n        )];\r\n    };\r\n\r\n    /// Textarea field with audio recording support\r\n    renderers.textarea = function(ctx) {\r\n        let textareaAttrs = {\r\n            class: ctx.fieldClass + \" textarea-field-full w-full pr-8\",\r\n            name: ctx.useName,\r\n            onchange: ctx.fHandler\r\n        };\r\n\r\n        textareaAttrs = applyDragAndDrop(ctx, textareaAttrs);\r\n\r\n        return [m(\"div\", {class: \"relative w-full\"},\r\n            m(\"textarea\", textareaAttrs, ctx.defVal),\r\n            (audioRecord ? m(\"div\", {class: \"absolute top-2 right-0 flex items-start\"},\r\n                createAudioRecordButton(ctx)\r\n            ) : \"\")\r\n        )];\r\n    };\r\n\r\n    /// Textlist is an alias for textarea\r\n    renderers.textlist = renderers.textarea;\r\n\r\n    /// ========================================\r\n    /// MEDIA RENDERERS (image, audio, pdf)\r\n    /// ========================================\r\n\r\n    /// Helper to build media path\r\n    function buildMediaPath(entity) {\r\n        return g_application_path + \"/media/\" +\r\n               am7client.dotPath(am7client.currentOrganization) +\r\n               \"/data.data\" + entity.groupPath + \"/\" + entity.name;\r\n    }\r\n\r\n    /// Helper to build thumbnail path\r\n    function buildThumbnailPath(entity, size) {\r\n        size = size || \"96x96\";\r\n        return g_application_path + \"/thumbnail/\" +\r\n               am7client.dotPath(am7client.currentOrganization) +\r\n               \"/data.data\" + entity.groupPath + \"/\" + entity.name + \"/\" + size;\r\n    }\r\n\r\n    /// Image field renderer\r\n    /// Handles multiple entity types: imageView, data.data, profile portraits\r\n    renderers.image = function(ctx) {\r\n        let useEntity = ctx.useEntity || ctx.entity;\r\n        let fieldClass = ctx.fieldClass + \" image-field\";\r\n        let dataUrl;\r\n        let clickHandler;\r\n\r\n        if (!useEntity) {\r\n            return [m(\"span\", \"No image data\")];\r\n        }\r\n\r\n        let modelKey = useEntity[am7model.jsonModelKey];\r\n\r\n        /// imageView type - show thumbnail\r\n        if (modelKey && modelKey.match(/^imageView$/gi)) {\r\n            let ui = useEntity.image;\r\n            if (ui) {\r\n                fieldClass = \"carousel-item-img\";\r\n                dataUrl = buildThumbnailPath(ui, \"512x512\");\r\n            }\r\n        }\r\n        /// data.data type - show base64 or stream\r\n        else if (modelKey && modelKey.match(/^data\\.data$/gi)) {\r\n            if (useEntity.stream) {\r\n                if (ctx.streamSeg) {\r\n                    dataUrl = \"data:\" + useEntity.contentType + \";base64,\" + ctx.streamSeg.stream;\r\n                } else if (ctx.loadStream) {\r\n                    /// Caller must provide loadStream callback to fetch stream data\r\n                    ctx.loadStream(useEntity.stream);\r\n                    return [m(\"span\", \"Loading...\")];\r\n                }\r\n            } else {\r\n                dataUrl = \"data:\" + useEntity.contentType + \";base64,\" + useEntity.dataBytesStore;\r\n            }\r\n        }\r\n        /// Profile portrait\r\n        else if (useEntity.profile && useEntity.profile.portrait && useEntity.profile.portrait.contentType) {\r\n            let pp = useEntity.profile.portrait;\r\n            let charInst = ctx.inst;\r\n            clickHandler = function() {\r\n                if (typeof page !== \"undefined\") {\r\n                    // Open gallery with character instance to allow profile selection\r\n                    page.imageGallery([], charInst);\r\n                }\r\n            };\r\n            dataUrl = buildThumbnailPath(pp, \"96x96\");\r\n        }\r\n        /// Direct portrait\r\n        else if (useEntity.portrait && useEntity.portrait.contentType) {\r\n            let pp = useEntity.portrait;\r\n            clickHandler = function() {\r\n                if (typeof page !== \"undefined\") page.imageView(pp);\r\n            };\r\n            dataUrl = buildThumbnailPath(pp, \"96x96\");\r\n        }\r\n\r\n        if (!dataUrl) {\r\n            return [m(\"span\", \"No image source\")];\r\n        }\r\n\r\n        return [m(\"img\", {\r\n            class: fieldClass,\r\n            name: ctx.useName,\r\n            onclick: clickHandler,\r\n            src: dataUrl\r\n        })];\r\n    };\r\n\r\n    /// Gallery field renderer for multiple images with navigation\r\n    renderers.gallery = function(ctx) {\r\n        let useEntity = ctx.useEntity || ctx.entity;\r\n        let fieldClass = ctx.fieldClass + \" gallery-field\";\r\n\r\n        // Images can come from ctx.defVal (field value), useEntity.gallery, useEntity.images, or ctx.entity directly\r\n        let images = ctx.defVal;\r\n        if(!images || !images.length) {\r\n            images = useEntity && (useEntity.gallery || useEntity.images);\r\n        }\r\n        if(!images || !images.length) {\r\n            images = ctx.entity && (ctx.entity.gallery || ctx.entity.images);\r\n        }\r\n        if (!images || !images.length) {\r\n            return [m(\"span\", \"No images\")];\r\n        }\r\n\r\n        // Get character instance if available (for set-as-profile)\r\n        let charInst = useEntity && useEntity.characterInstance;\r\n\r\n        // Store currentIndex on the entity for state persistence\r\n        if(useEntity && typeof useEntity.currentIndex === 'undefined'){\r\n            useEntity.currentIndex = 0;\r\n        }\r\n        let currentIndex = useEntity ? (useEntity.currentIndex || 0) : 0;\r\n\r\n        // Social sharing tags list\r\n        let sharingTags = (typeof window !== \"undefined\" && window.am7sharingTags)\r\n            ? window.am7sharingTags.tags\r\n            : [\"inappropriate\", \"intimate\", \"sexy\", \"private\", \"casual\", \"public\", \"professional\"];\r\n\r\n        function navigate(delta) {\r\n            if(useEntity){\r\n                useEntity.currentIndex = (currentIndex + delta + images.length) % images.length;\r\n            }\r\n            m.redraw();\r\n        }\r\n\r\n        async function deleteImage() {\r\n            if(typeof page === \"undefined\") return;\r\n            let img = images[currentIndex];\r\n            if(!img || !img.objectId) return;\r\n\r\n            if(!confirm(\"Delete this image?\")) return;\r\n\r\n            await page.deleteObject(\"data.data\", img.objectId);\r\n            images.splice(currentIndex, 1);\r\n            if(currentIndex >= images.length && images.length > 0){\r\n                if(useEntity){\r\n                    useEntity.currentIndex = images.length - 1;\r\n                }\r\n                currentIndex = images.length - 1;\r\n            }\r\n            page.toast(\"success\", \"Image deleted\");\r\n            m.redraw();\r\n        }\r\n\r\n        async function setAsProfile() {\r\n            if(typeof page === \"undefined\" || !charInst) return;\r\n            let img = images[currentIndex];\r\n            if(!img || !img.id) return;\r\n\r\n            // Update the character's profile portrait\r\n            charInst.entity.profile.portrait = img;\r\n            let od = {id: charInst.entity.profile.id, portrait: {id: img.id}};\r\n            od[am7model.jsonModelKey] = \"identity.profile\";\r\n            await page.patchObject(od);\r\n\r\n            page.toast(\"success\", \"Profile image updated\");\r\n            m.redraw();\r\n        }\r\n\r\n        async function toggleTag(tagName) {\r\n            if(typeof page === \"undefined\" || typeof window === \"undefined\" || !window.am7sharingTags) return;\r\n            let img = images[currentIndex];\r\n            if(!img || !img.objectId) return;\r\n\r\n            // Check if tag is currently applied\r\n            let imgTags = img.tags || [];\r\n            let hasTag = imgTags.some(t => t.name === tagName);\r\n\r\n            // Toggle the tag\r\n            let success = await window.am7sharingTags.toggle(img, tagName, !hasTag);\r\n            if(success){\r\n                // Update local tags array\r\n                if(hasTag){\r\n                    img.tags = imgTags.filter(t => t.name !== tagName);\r\n                } else {\r\n                    let tag = await window.am7sharingTags.getOrCreate(tagName, \"data.data\");\r\n                    if(tag){\r\n                        if(!img.tags) img.tags = [];\r\n                        img.tags.push(tag);\r\n                    }\r\n                }\r\n                m.redraw();\r\n            }\r\n        }\r\n\r\n        async function applyImageTags() {\r\n            if(typeof page === \"undefined\") return;\r\n            let img = images[currentIndex];\r\n            if(!img || !img.objectId) return;\r\n\r\n            page.toast(\"info\", \"Applying image tags...\");\r\n            try {\r\n                let tags = await page.applyImageTags(img.objectId);\r\n                if(tags && Array.isArray(tags) && tags.length){\r\n                    page.toast(\"success\", \"Applied \" + tags.length + \" tags\");\r\n                }\r\n                else if(tags){\r\n                    page.toast(\"success\", \"Tags applied\");\r\n                }\r\n                else {\r\n                    page.toast(\"warn\", \"No tags were applied\");\r\n                }\r\n            }\r\n            catch(e){\r\n                console.error(e);\r\n                page.toast(\"error\", \"Failed to apply tags\");\r\n            }\r\n        }\r\n\r\n        function openImageInNewTab() {\r\n            let img = images[currentIndex];\r\n            if(!img || !img.objectId) return;\r\n            let uri = \"#/view/data.data/\" + img.objectId;\r\n            window.open(uri, \"_blank\");\r\n        }\r\n\r\n        let currentImage = images[currentIndex];\r\n        let dataUrl = buildThumbnailPath(currentImage, \"512x512\");\r\n\r\n        // Get current image's tags (filter to only sharing tags)\r\n        let currentTags = (currentImage.tags || [])\r\n            .filter(t => sharingTags.includes(t.name))\r\n            .map(t => t.name);\r\n\r\n        // Build navigation buttons\r\n        let navButtons = [\r\n            page.iconButton(\"button\", \"arrow_back\", \"\", function() { navigate(-1); }, images.length <= 1),\r\n            m(\"span\", { class: \"button\" }, (currentIndex + 1) + \" / \" + images.length),\r\n            page.iconButton(\"button mr-4\", \"arrow_forward\", \"\", function() { navigate(1); }, images.length <= 1),\r\n            page.iconButton(\"button\", \"delete\", \"\", deleteImage),\r\n            page.iconButton(\"button\", \"sell\", \"\", applyImageTags),\r\n            page.iconButton(\"button\", \"open_in_new\", \"\", openImageInNewTab)\r\n        ];\r\n\r\n        // Only show set-as-profile button if we have a character instance\r\n        if(charInst){\r\n            navButtons.push(page.iconButton(\"button\", \"account_circle\", \"\", setAsProfile));\r\n        }\r\n\r\n        // Build sharing tags vertical list\r\n        let tagsList = sharingTags.map(function(tagName){\r\n            let isActive = currentTags.includes(tagName);\r\n            return m(\"button\", {\r\n                class: \"gallery-tag-btn\" + (isActive ? \" active\" : \"\"),\r\n                onclick: function(){ toggleTag(tagName); }\r\n            }, tagName);\r\n        });\r\n\r\n        return [\r\n            m(\"div\", { class: \"gallery-container gallery-with-tags\" }, [\r\n                m(\"div\", { class: \"result-nav-outer\" }, [\r\n                    m(\"div\", { class: \"result-nav-inner\" }, [\r\n                        m(\"div\", { class: \"result-nav tab-container\" }, navButtons)\r\n                    ])\r\n                ]),\r\n                m(\"div\", { class: \"gallery-content\" }, [\r\n                    m(\"img\", {\r\n                        class: \"carousel-item-img\",\r\n                        src: dataUrl,\r\n                        onclick: function() {\r\n                            if (typeof page !== \"undefined\") page.imageView(currentImage);\r\n                        }\r\n                    }),\r\n                    m(\"div\", { class: \"gallery-tags-panel\" }, tagsList)\r\n                ])\r\n            ])\r\n        ];\r\n    };\r\n\r\n    /// Audio player field renderer\r\n    renderers.audio = function(ctx) {\r\n        let val = ctx.defVal;\r\n        if (!val || typeof val !== 'object') {\r\n            return [m(\"span\", \"No audio data\")];\r\n        }\r\n\r\n        let apath = g_application_path + \"/media/\" +\r\n                    am7client.dotPath(am7client.currentOrganization) +\r\n                    \"/data.data\" + val.groupPath + \"/\" + val.name;\r\n        let amt = val.contentType;\r\n        if (amt.match(/mpeg3$/)) amt = \"audio/mpeg\";\r\n\r\n        return [m(\"audio\", {\r\n            class: \"\",\r\n            id: ctx.useName,\r\n            preload: \"auto\",\r\n            controls: \"controls\",\r\n            autoplay: \"autoplay\"\r\n        }, m(\"source\", {src: apath, type: amt}))];\r\n    };\r\n\r\n    /// PDF viewer field renderer\r\n    renderers.pdf = function(ctx) {\r\n        if (ctx.pdfViewer) {\r\n            return [ctx.pdfViewer.container()];\r\n        }\r\n        return [m(\"span\", \"Missing PDF viewer\")];\r\n    };\r\n\r\n    /// ========================================\r\n    /// OBJECT-LINK RENDERER\r\n    /// ========================================\r\n\r\n    /// Object link field - shows link to REST endpoint and JSON viewer\r\n    renderers[\"object-link\"] = function(ctx) {\r\n        let useEntity = ctx.useEntity || ctx.entity;\r\n        let uri = \"about:blank\";\r\n        let label = \"\";\r\n\r\n        if (useEntity && useEntity.objectId) {\r\n            let modelKey = useEntity[am7model.jsonModelKey];\r\n            if (modelKey && modelKey.match(/^data\\.data$/gi)) {\r\n                uri = g_application_path + \"/media/\" +\r\n                      am7client.dotPath(am7client.currentOrganization) + \"/\" +\r\n                      modelKey + useEntity.groupPath + \"/\" + useEntity.name;\r\n            } else {\r\n                uri = g_application_path + \"/rest/model/\" + modelKey + \"/\" + useEntity.objectId;\r\n            }\r\n            label = useEntity.name;\r\n        }\r\n\r\n        let printHandler = function() {\r\n            if (ctx.printJSONToWindow) {\r\n                ctx.printJSONToWindow();\r\n            }\r\n        };\r\n\r\n        return [\r\n            m(\"a\", {target: \"new\", href: uri, class: \"text-blue-600\"}, [\r\n                m(\"span\", {class: \"material-icons-outlined mr-2\"}, \"link\"),\r\n                label\r\n            ]),\r\n            m(\"span\", {onclick: printHandler, class: \"cursor-pointer material-symbols-outlined ml-2\"}, \"file_json\")\r\n        ];\r\n    };\r\n\r\n    /// ========================================\r\n    /// PICKER RENDERER\r\n    /// ========================================\r\n\r\n    /// Picker field - text input with context menu for object selection\r\n    /// Context must provide:\r\n    ///   - doFieldPicker(field, useName, useEntity): function to open picker\r\n    ///   - doFieldOpen(field): function to navigate to selected object\r\n    ///   - doFieldClear(field): function to clear selection\r\n    ///   - updateChange(evt, field): function to handle manual changes\r\n    renderers.picker = function(ctx) {\r\n        let useEntity = ctx.useEntity || ctx.entity;\r\n        let field = ctx.field;\r\n        let fieldClass = ctx.fieldClass + \" text-field-full\";\r\n        let defVal = ctx.defVal;\r\n        let fHandler = ctx.fHandler;\r\n\r\n        /// Check if this should be a picker or just text input\r\n        let valPick = false;\r\n        if (typeof page !== \"undefined\" && page.components && page.components.picker) {\r\n            valPick = (page.components.picker.validateFormat(ctx.inst, field, \"picker\", ctx.useName) === \"picker\");\r\n        }\r\n\r\n        /// Resolve picker value to display name\r\n        if (valPick && useEntity && field.pickerProperty) {\r\n            let findVal = useEntity[field.pickerProperty.entity];\r\n            let pageCtx = (typeof page !== \"undefined\") ? page.context() : null;\r\n\r\n            if (findVal) {\r\n                if (typeof findVal === 'object') {\r\n                    defVal = findVal.name;\r\n                } else if (pageCtx && !pageCtx.contextObjects[findVal]) {\r\n                    /// Need to load the referenced object\r\n                    let type = field.pickerType;\r\n                    if (!type || type === 'self') type = useEntity[am7model.jsonModelKey];\r\n                    if (type.match(/^\\./)) {\r\n                        type = useEntity[field.pickerType.slice(1)];\r\n                    }\r\n                    if (typeof page !== \"undefined\") {\r\n                        page.openObject(type, findVal).then(function() {\r\n                            m.redraw();\r\n                        });\r\n                    }\r\n                } else if (pageCtx) {\r\n                    defVal = pageCtx.contextObjects[findVal].name;\r\n                }\r\n            }\r\n        } else if (useEntity && field.pickerProperty) {\r\n            defVal = useEntity[field.pickerProperty.entity];\r\n        }\r\n\r\n        let pickerName = ctx.useName + '-picker';\r\n        let mid = pickerName + \"-menu\";\r\n\r\n        if (valPick) {\r\n            fieldClass += \" menu-icon\";\r\n        } else {\r\n            /// Not a picker, just handle as text with change tracking\r\n            fHandler = function(e) {\r\n                if (ctx.updateChange) {\r\n                    ctx.updateChange(e, field);\r\n                }\r\n            };\r\n        }\r\n\r\n        let view = [];\r\n\r\n        /// Input field\r\n        let inputAttrs = {\r\n            type: \"text\",\r\n            class: fieldClass,\r\n            name: ctx.useName,\r\n            id: pickerName,\r\n            value: defVal,\r\n            autocomplete: \"off\",\r\n            avoid: 1,\r\n            onchange: fHandler\r\n        };\r\n        if (ctx.disabled) {\r\n            inputAttrs.disabled = true;\r\n        }\r\n        view.push(m(\"input\", inputAttrs));\r\n\r\n        /// Context menu for picker mode\r\n        if (valPick && typeof page !== \"undefined\" && page.navigable) {\r\n            view.push(\r\n                m(\"div\", {class: \"context-menu-container\"}, [\r\n                    m(\"div\", {class: \"transition transition-0 context-menu\", id: mid}, [\r\n                        page.navigable.contextMenuButton(pickerName, \"Find\", \"search\", function() {\r\n                            if (ctx.doFieldPicker) ctx.doFieldPicker(field, ctx.useName, useEntity);\r\n                        }),\r\n                        page.navigable.contextMenuButton(pickerName, \"View\", \"file_open\", function() {\r\n                            if (ctx.doFieldOpen) ctx.doFieldOpen(field);\r\n                        }),\r\n                        page.navigable.contextMenuButton(pickerName, \"Clear\", \"backspace\", function() {\r\n                            if (ctx.doFieldClear) ctx.doFieldClear(field);\r\n                        }),\r\n                        page.navigable.contextMenuButton(pickerName, \"Cancel\", \"cancel\")\r\n                    ])\r\n                ])\r\n            );\r\n\r\n            /// Register context menu (this needs to be done after render)\r\n            page.navigable.pendContextMenu(\"#\" + mid, \"#\" + pickerName, null, \"context-menu-96\");\r\n        }\r\n\r\n        return view;\r\n    };\r\n\r\n    /// ========================================\r\n    /// TABLE RENDERER\r\n    /// ========================================\r\n\r\n    /// Table field renderer - displays array data in a table format\r\n    /// This is a complex renderer that requires significant context:\r\n    ///   - valuesState: object tracking row selection/edit state\r\n    ///   - foreignData: object for storing foreign relationship data\r\n    ///   - getFormCommandView: function to render table commands\r\n    ///   - modelField: function to render individual fields (for edit mode)\r\n    ///\r\n    /// Due to the complexity and tight coupling with object page state,\r\n    /// this renderer delegates to the provided callback functions\r\n    renderers.table = function(ctx) {\r\n        /// Delegate to the table renderer function if provided\r\n        if (ctx.getValuesForTableField) {\r\n            return ctx.getValuesForTableField(\r\n                ctx.useName,\r\n                ctx.fieldView,\r\n                ctx.field,\r\n                ctx.fieldClass + \" table-field\",\r\n                !ctx.show\r\n            );\r\n        }\r\n\r\n        /// Fallback: simple table rendering without edit support\r\n        let field = ctx.field;\r\n        let entity = ctx.entity;\r\n        let fieldView = ctx.fieldView;\r\n\r\n        if (!entity || !field.baseModel || !fieldView.form) {\r\n            return [m(\"span\", \"Invalid table configuration\")];\r\n        }\r\n\r\n        let tableType = field.baseModel;\r\n        if (tableType === \"$self\") {\r\n            tableType = entity[am7model.jsonModelKey];\r\n        }\r\n\r\n        let tableForm = fieldView.form;\r\n        let rows = [];\r\n\r\n        /// Build header row\r\n        let headers = Object.keys(tableForm.fields).map(function(k) {\r\n            let tableFieldView = tableForm.fields[k];\r\n            let tableField = am7model.getModelField(tableType, k);\r\n            return m(\"th\", tableFieldView?.label || tableField?.label || k);\r\n        });\r\n        rows.push(m(\"tr\", headers));\r\n\r\n        /// Get values\r\n        let vals;\r\n        if (ctx.inst && ctx.inst.api[ctx.name]) {\r\n            vals = ctx.inst.api[ctx.name]();\r\n        } else if (entity[ctx.name]) {\r\n            vals = entity[ctx.name];\r\n        }\r\n\r\n        /// Build data rows\r\n        if (vals && Array.isArray(vals)) {\r\n            vals.forEach(function(v, i) {\r\n                let cells = Object.keys(tableForm.fields).map(function(k) {\r\n                    let val = v[k];\r\n                    if (val === undefined || val === null) val = \"\";\r\n                    return m(\"td\", \"\" + val);\r\n                });\r\n                rows.push(m(\"tr\", {class: \"row-field\"}, cells));\r\n            });\r\n        }\r\n\r\n        return [m(\"table\", {class: ctx.fieldClass + \" table-field\"}, rows)];\r\n    };\r\n\r\n    /// ========================================\r\n    /// FORM RENDERER (nested form)\r\n    /// ========================================\r\n\r\n    /// Form field renderer - delegates to a callback for nested form rendering\r\n    /// Context must provide:\r\n    ///   - getValuesForFormField: function to render nested form content\r\n    renderers.form = function(ctx) {\r\n        if (ctx.getValuesForFormField) {\r\n            return ctx.getValuesForFormField(\r\n                ctx.useName,\r\n                ctx.fieldView,\r\n                ctx.field,\r\n                \"table-field\",\r\n                !ctx.show\r\n            );\r\n        }\r\n\r\n        /// Fallback\r\n        return [m(\"span\", \"Nested form rendering requires getValuesForFormField callback\")];\r\n    };\r\n\r\n    /// ========================================\r\n    /// REGISTRY AND EXPORT\r\n    /// ========================================\r\n\r\n    /// Check if a renderer exists for a format\r\n    function hasRenderer(format) {\r\n        return renderers.hasOwnProperty(format);\r\n    }\r\n\r\n    /// Get a renderer by format name\r\n    function getRenderer(format) {\r\n        return renderers[format];\r\n    }\r\n\r\n    /// Render a field using the appropriate renderer\r\n    function render(format, ctx) {\r\n        if (!hasRenderer(format)) {\r\n            console.warn(\"No form field renderer for format: \" + format);\r\n            return null;\r\n        }\r\n        return renderers[format](ctx);\r\n    }\r\n\r\n    /// Register a new renderer\r\n    function register(format, fn) {\r\n        renderers[format] = fn;\r\n    }\r\n\r\n    /// Export\r\n    let formFieldRenderers = {\r\n        render: render,\r\n        has: hasRenderer,\r\n        get: getRenderer,\r\n        register: register\r\n    };\r\n\r\n    /// Register with page.components\r\n    if (typeof page !== \"undefined\" && page.components) {\r\n        page.components.formFieldRenderers = formFieldRenderers;\r\n    }\r\n\r\n}());\r\n\n\n;/* === client/components/membership.js === */\n(function() {\r\n    /// Membership Component\r\n    /// Handles object relationships: members, entities, children, and participations\r\n    ///\r\n    /// This component provides functions for managing object memberships that can be\r\n    /// used by objectPage or other components. Each function receives a context object\r\n    /// with the necessary state and callbacks.\r\n\r\n    /// ========================================\r\n    /// MEMBER OPERATIONS\r\n    /// Uses am7client.member() for membership relationships\r\n    /// ========================================\r\n\r\n    /// Pick members from picker and add them to the entity\r\n    /// ctx: { entity, field, foreignData, cancelPicker, updateChange, fieldName }\r\n    function pickMember(ctx, members) {\r\n        let aP = [];\r\n        let entity = ctx.entity;\r\n        let field = ctx.field;\r\n        let fieldName = ctx.fieldName || field.name;\r\n\r\n        console.log(\"pickMember\", fieldName, field, members);\r\n\r\n        if (am7model.hasIdentity(entity)) {\r\n            members.forEach(function(t) {\r\n                aP.push(new Promise(function(res, rej) {\r\n                    /// Differentiate which is the container\r\n                    /// For tags, the tag participates in the entity, not vice versa\r\n                    let e2 = entity;\r\n                    let a2 = t;\r\n                    if (\"data.tag\" === field.baseModel) {\r\n                        e2 = t;\r\n                        a2 = entity;\r\n                    }\r\n\r\n                    /// For tags and virtual fields, don't pass field name\r\n                    let fn = (field.baseModel !== \"data.tag\" && !field.virtual) ? field.name : null;\r\n                    console.log(\"member call:\", e2[am7model.jsonModelKey], e2.objectId, fn, a2[am7model.jsonModelKey], a2.objectId, true);\r\n                    am7client.member(\r\n                        e2[am7model.jsonModelKey], e2.objectId,\r\n                        fn,\r\n                        a2[am7model.jsonModelKey], a2.objectId,\r\n                        true,\r\n                        function(v) {\r\n                            console.log(\"Member result: \" + v);\r\n                            res(v);\r\n                        }\r\n                    );\r\n                }));\r\n            });\r\n        } else {\r\n            console.warn(\"Entity has no identity, cannot add member\");\r\n        }\r\n\r\n        if (!aP.length) {\r\n            console.warn(\"Nothing picked!\");\r\n        }\r\n\r\n        return Promise.all(aP).then(function() {\r\n            /// Clear foreign data for the field to force refresh\r\n            if (ctx.foreignData && fieldName) {\r\n                delete ctx.foreignData[fieldName];\r\n            }\r\n            if (ctx.cancelPicker) ctx.cancelPicker();\r\n        });\r\n    }\r\n\r\n    /// Add member via picker\r\n    /// ctx: { entity, inst, field, preparePicker }\r\n    /// Returns Promise\r\n    function addMember(ctx, name, tableType, tableForm, props) {\r\n        let type = tableType;\r\n        let field = ctx.field;\r\n\r\n        console.log(\"addMember\", name, tableType, props);\r\n\r\n        if (type === \"$flex\") {\r\n            if (field.foreignType && ctx.inst) {\r\n                type = ctx.inst.api[field.foreignType]();\r\n            } else {\r\n                console.warn(\"Cannot reference a flex field without a foreign type\");\r\n                return Promise.resolve(null);\r\n            }\r\n        }\r\n\r\n        if (props.typeAttribute && ctx.entity) {\r\n            type = am7view.typeToModel(ctx.entity[props.typeAttribute]);\r\n        }\r\n\r\n        if (props.picker && ctx.preparePicker) {\r\n            /// Add fieldName to context for pickMember to use\r\n            let pickCtx = Object.assign({}, ctx, { fieldName: name });\r\n            return ctx.preparePicker(type, function(members) {\r\n                pickMember(pickCtx, members);\r\n            });\r\n        }\r\n\r\n        return Promise.resolve(null);\r\n    }\r\n\r\n    /// Delete selected members\r\n    /// ctx: { entity, field, valuesState, foreignData }\r\n    function deleteMember(ctx, name, field, tableType, tableForm) {\r\n        let aP = [];\r\n        let entity = ctx.entity;\r\n        let valuesState = ctx.valuesState || {};\r\n        let foreignData = ctx.foreignData || {};\r\n\r\n        console.log(\"deleteMember\", name, field, valuesState);\r\n\r\n        Object.keys(valuesState).forEach(function(k) {\r\n            let state = valuesState[k];\r\n            if (state.selected) {\r\n                console.log(\"Processing selected state:\", k, state);\r\n                if (foreignData[state.attribute]) {\r\n                    let obj = foreignData[state.attribute][state.index];\r\n                    console.log(\"Delete from foreignData:\", obj);\r\n                    /// For virtual/ephemeral fields, don't pass field name to member()\r\n                    let fn = (field.virtual || field.ephemeral) ? null : name;\r\n                    console.log(\"Delete member call (foreignData):\", entity[am7model.jsonModelKey], entity.objectId, fn, obj[am7model.jsonModelKey], obj.objectId, false);\r\n                    aP.push(new Promise(function(res, rej) {\r\n                        am7client.member(\r\n                            entity[am7model.jsonModelKey], entity.objectId,\r\n                            fn,\r\n                            obj[am7model.jsonModelKey], obj.objectId,\r\n                            false,\r\n                            function(v) {\r\n                                console.log(\"Deleted member result:\", v);\r\n                                if (entity[name]) {\r\n                                    entity[name] = entity[name].filter(function(m) {\r\n                                        return m.objectId !== obj.objectId;\r\n                                    });\r\n                                }\r\n                                res(v);\r\n                            }\r\n                        );\r\n                    }));\r\n                } else {\r\n                    let vProp = (field.parentProperty ? entity[field.parentProperty] : entity);\r\n                    let per = vProp[name][state.index];\r\n                    console.log(\"Delete from vProp:\", per);\r\n\r\n                    if (am7model.hasIdentity(entity)) {\r\n                        /// For tags and virtual fields, don't pass field name\r\n                        let fn = (field.baseModel !== \"data.tag\" && !field.virtual) ? field.name : null;\r\n                        let obj = entity;\r\n                        let act = per;\r\n                        /// For tags, reverse the relationship\r\n                        if (per[am7model.jsonModelKey] === \"data.tag\") {\r\n                            obj = per;\r\n                            act = entity;\r\n                        }\r\n                        console.log(\"Delete member call:\", obj[am7model.jsonModelKey], obj.objectId, fn, act[am7model.jsonModelKey], act.objectId, false);\r\n                        aP.push(am7client.member(\r\n                            obj[am7model.jsonModelKey], obj.objectId,\r\n                            fn,\r\n                            act[am7model.jsonModelKey], act.objectId,\r\n                            false\r\n                        ));\r\n                    }\r\n                    vProp[name] = vProp[name].filter(function(o) {\r\n                        return o.objectId !== per.objectId;\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        if (!aP.length) {\r\n            console.warn(\"No members selected for deletion\");\r\n        }\r\n\r\n        return Promise.all(aP).then(function() {\r\n            if (ctx.foreignData) delete ctx.foreignData[name];\r\n            m.redraw();\r\n        });\r\n    }\r\n\r\n    /// Get members of an object (object is the container)\r\n    /// ctx: { entity }\r\n    function objectMembers(ctx, name, field) {\r\n        return new Promise(function(res, rej) {\r\n            let entity = ctx.entity;\r\n            let ftype = field ? (field.typeAttribute || field.foreignType) : null;\r\n\r\n            if (!entity || !entity.objectId || !field || !ftype) {\r\n                res([]);\r\n                return;\r\n            }\r\n\r\n            let type = am7view.typeToModel(entity[ftype]);\r\n            am7client.members(\r\n                entity[am7model.jsonModelKey], entity.objectId,\r\n                type, 0, 100,\r\n                function(v) {\r\n                    am7model.updateListModel(v);\r\n                    res(v);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    /// Get participations where object is a participant\r\n    /// ctx: { entity }\r\n    function memberObjects(ctx, name, field) {\r\n        return new Promise(function(res, rej) {\r\n            let entity = ctx.entity;\r\n\r\n            if (!entity || !entity.objectId) {\r\n                res([]);\r\n                return;\r\n            }\r\n            if (!field || !field.participantType) {\r\n                res([]);\r\n                return;\r\n            }\r\n\r\n            let ftype = field.factoryType;\r\n            let paftype = field.participationFactoryType;\r\n            if (!ftype) ftype = paftype;\r\n            let pftype = field.participantFactoryType;\r\n            let ptype = field.participantType;\r\n\r\n            /// Resolve dynamic type references\r\n            if (paftype && paftype.match(/^\\./)) paftype = entity[paftype.slice(1)];\r\n            if (ftype && ftype.match(/^\\./)) ftype = entity[ftype.slice(1)];\r\n            if (pftype && pftype.match(/^\\./)) pftype = entity[pftype.slice(1)];\r\n            if (ptype && ptype.match(/^\\./)) ptype = entity[ptype.slice(1)];\r\n\r\n            let search = new org.cote.objects.participationSearchRequest();\r\n            search.startRecord = 0;\r\n            search.recordCount = 100;\r\n            search.participantList = [entity.objectId];\r\n            search.participantFactoryType = pftype;\r\n            search.participationFactoryType = paftype;\r\n            search.participantType = ptype;\r\n\r\n            am7client.listParticipations(ftype, search, function(v) {\r\n                am7model.updateListModel(v);\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n\r\n    /// ========================================\r\n    /// ENTITY OPERATIONS\r\n    /// Direct entity list manipulation with optional member() calls\r\n    /// ========================================\r\n\r\n    /// Pick entities and add them to a field\r\n    /// ctx: { entity, field, caller, objectPage, inst, parentProperty, cancelPicker }\r\n    function pickEntity(ctx, name, data) {\r\n        let entity = ctx.entity;\r\n        let field = ctx.field;\r\n        let vProp = (field.parentProperty ? entity[field.parentProperty] : entity);\r\n\r\n        if (!vProp[name] && field.type === \"list\") {\r\n            vProp[name] = [];\r\n        }\r\n        vProp[name] = page.removeDuplicates(vProp[name].concat(data), \"objectId\");\r\n\r\n        if (ctx.caller) {\r\n            ctx.caller.callback('update', ctx.objectPage, ctx.inst, name, ctx.parentProperty);\r\n        } else {\r\n            /// For existing entities, add memberships immediately\r\n            if (am7model.hasIdentity(entity)) {\r\n                let aP = [];\r\n                data.forEach(function(v) {\r\n                    aP.push(am7client.member(\r\n                        entity[am7model.jsonModelKey], entity.objectId,\r\n                        name,\r\n                        v[am7model.jsonModelKey], v.objectId,\r\n                        true\r\n                    ));\r\n                });\r\n                Promise.all(aP);\r\n            }\r\n        }\r\n\r\n        if (ctx.cancelPicker) ctx.cancelPicker();\r\n    }\r\n\r\n    /// Add entity via picker\r\n    /// ctx: { preparePicker, field }\r\n    function addEntity(ctx, name, tableType, tableForm, props) {\r\n        if (props.picker && ctx.preparePicker) {\r\n            return ctx.preparePicker(tableType, function(data) {\r\n                pickEntity(ctx, name, data);\r\n            });\r\n        }\r\n        return Promise.resolve(null);\r\n    }\r\n\r\n    /// Open selected entity in a new view\r\n    /// ctx: { entity, field, valuesState, foreignData }\r\n    function openEntity(ctx, name, field, tableType, tableForm, props) {\r\n        let ent;\r\n        let valuesState = ctx.valuesState || {};\r\n        let foreignData = ctx.foreignData || {};\r\n        let entity = ctx.entity;\r\n\r\n        Object.keys(valuesState).forEach(function(k) {\r\n            let state = valuesState[k];\r\n            let vProp;\r\n            if (field.foreign && foreignData[name]) {\r\n                vProp = foreignData;\r\n            } else {\r\n                vProp = (field.parentProperty ? entity[field.parentProperty] : entity);\r\n            }\r\n\r\n            if (!ent && state.selected && vProp[name]) {\r\n                ent = vProp[name][state.index];\r\n            }\r\n        });\r\n\r\n        if (ent) {\r\n            let uri = \"/view/\" + ent[am7model.jsonModelKey] + \"/\" + ent.objectId;\r\n            m.route.set(uri, {key: ent.objectId});\r\n        } else {\r\n            console.log(\"Didn't find entity to open\");\r\n        }\r\n    }\r\n\r\n    /// Delete selected entities\r\n    /// ctx: { entity, field, valuesState, updateChange }\r\n    function deleteEntity(ctx, name, field, tableType, tableForm, props) {\r\n        let aP = [];\r\n        let entity = ctx.entity;\r\n        let valuesState = ctx.valuesState || {};\r\n\r\n        Object.keys(valuesState).forEach(function(k) {\r\n            let state = valuesState[k];\r\n            let vProp = (field.parentProperty ? entity[field.parentProperty] : entity);\r\n\r\n            if (state.selected && vProp[name]) {\r\n                let per = vProp[name][state.index];\r\n\r\n                if (am7model.hasIdentity(entity)) {\r\n                    aP.push(am7client.member(\r\n                        entity[am7model.jsonModelKey], entity.objectId,\r\n                        name,\r\n                        per[am7model.jsonModelKey], per.objectId,\r\n                        false\r\n                    ));\r\n                } else {\r\n                    console.warn(\"Cannot delete entity without identity: \" + entity[am7model.jsonModelKey]);\r\n                }\r\n                vProp[name] = vProp[name].filter(function(o) {\r\n                    return o.objectId !== per.objectId;\r\n                });\r\n            }\r\n        });\r\n\r\n        return Promise.all(aP).then(function() {\r\n            if (ctx.updateChange) ctx.updateChange();\r\n            m.redraw();\r\n        });\r\n    }\r\n\r\n    /// ========================================\r\n    /// CHILD/PARENT OPERATIONS\r\n    /// Uses parentId for hierarchical relationships\r\n    /// ========================================\r\n\r\n    /// Reparent children to a new parent\r\n    function reparent(parent, children) {\r\n        let aP = [];\r\n        children.forEach(function(c) {\r\n            aP.push(new Promise(function(res, rej) {\r\n                if (c[am7model.jsonModelKey].match(/^auth\\.group$/gi) && !parent) {\r\n                    rej(\"Unable to reparent a group to nothing\");\r\n                } else {\r\n                    c.parentId = parent ? parent.id : 0;\r\n                    am7client.patch(c[am7model.jsonModelKey], c, function(v) {\r\n                        if (v) res();\r\n                        else rej();\r\n                    });\r\n                }\r\n            }));\r\n        });\r\n        return Promise.all(aP);\r\n    }\r\n\r\n    /// Pick children and add them to parent\r\n    /// ctx: { entity, field, cancelPicker }\r\n    function pickChild(ctx, name, data) {\r\n        let entity = ctx.entity;\r\n        let field = ctx.field;\r\n\r\n        reparent(entity, data).then(function() {\r\n            let vProp = (field.parentProperty ? entity[field.parentProperty] : entity);\r\n            vProp[name] = page.removeDuplicates(vProp[name].concat(data), \"objectId\");\r\n\r\n            if (ctx.cancelPicker) ctx.cancelPicker(true);\r\n\r\n            /// Don't update because the new lineage is already persisted\r\n            am7client.clearCache(entity[am7model.jsonModelKey], false, function(s, v) {\r\n                m.redraw();\r\n            });\r\n        });\r\n    }\r\n\r\n    /// Add child via picker\r\n    /// ctx: { preparePicker, field }\r\n    function addChild(ctx, name, tableType, tableForm, props) {\r\n        if (props.picker && ctx.preparePicker) {\r\n            return ctx.preparePicker(tableType, function(data) {\r\n                pickChild(ctx, name, data);\r\n            });\r\n        }\r\n        return Promise.resolve(null);\r\n    }\r\n\r\n    /// Delete selected children (removes parent relationship)\r\n    /// ctx: { entity, field, valuesState }\r\n    function deleteChild(ctx, name, field, tableType, tableForm, props) {\r\n        let entity = ctx.entity;\r\n        let valuesState = ctx.valuesState || {};\r\n        let aC = [];\r\n\r\n        Object.keys(valuesState).forEach(function(k) {\r\n            let state = valuesState[k];\r\n            let vProp = (field.parentProperty ? entity[field.parentProperty] : entity);\r\n\r\n            if (state.selected && vProp[name]) {\r\n                let obj = vProp[name][state.index];\r\n                aC.push(obj);\r\n                /// Update UI immediately\r\n                vProp[name] = vProp[name].filter(function(o) {\r\n                    return o.objectId !== obj.objectId;\r\n                });\r\n            }\r\n        });\r\n\r\n        return reparent(null, aC).then(function() {\r\n            am7client.clearCache(entity[am7model.jsonModelKey], false, function(s, v) {\r\n                m.redraw();\r\n            });\r\n        });\r\n    }\r\n\r\n    /// ========================================\r\n    /// SPECIAL OPERATIONS\r\n    /// ========================================\r\n\r\n    /// Get controls for an object\r\n    /// ctx: { entity }\r\n    function objectControls(ctx, name, field) {\r\n        return new Promise(function(res, rej) {\r\n            let entity = ctx.entity;\r\n            if (!entity || !entity.objectId) {\r\n                res([]);\r\n                return;\r\n            }\r\n            page.controls(entity[am7model.jsonModelKey], entity.objectId).then(function(v) {\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n\r\n    /// Get requests for an object (incomplete implementation)\r\n    /// ctx: { entity }\r\n    function objectRequests(ctx, name, field) {\r\n        return new Promise(function(res, rej) {\r\n            let entity = ctx.entity;\r\n            if (!entity || !entity.objectId) {\r\n                res([]);\r\n                return;\r\n            }\r\n            page.requests(entity[am7model.jsonModelKey], entity.objectId).then(function(v) {\r\n                res(v);\r\n            });\r\n        });\r\n    }\r\n\r\n    /// ========================================\r\n    /// EXPORT\r\n    /// ========================================\r\n\r\n    let membership = {\r\n        /// Member operations\r\n        pickMember: pickMember,\r\n        addMember: addMember,\r\n        deleteMember: deleteMember,\r\n        objectMembers: objectMembers,\r\n        memberObjects: memberObjects,\r\n\r\n        /// Entity operations\r\n        pickEntity: pickEntity,\r\n        addEntity: addEntity,\r\n        openEntity: openEntity,\r\n        deleteEntity: deleteEntity,\r\n\r\n        /// Child/Parent operations\r\n        reparent: reparent,\r\n        pickChild: pickChild,\r\n        addChild: addChild,\r\n        deleteChild: deleteChild,\r\n\r\n        /// Special operations\r\n        objectControls: objectControls,\r\n        objectRequests: objectRequests\r\n    };\r\n\r\n    /// Register with page.components\r\n    if (typeof page !== \"undefined\" && page.components) {\r\n        page.components.membership = membership;\r\n    }\r\n\r\n}());\r\n\n\n;/* === client/components/tableEntry.js === */\n(function() {\r\n    /// Table Entry Management Component\r\n    /// Handles table row editing, adding, and removing entries\r\n    ///\r\n    /// This component provides functions for managing table entries that can be\r\n    /// used by objectPage or other components. Each function receives a context object\r\n    /// with the necessary state and callbacks.\r\n\r\n    /// ========================================\r\n    /// ENTRY STATE MANAGEMENT\r\n    /// ========================================\r\n\r\n    /// Edit selected entries (switch to edit mode)\r\n    /// ctx: { valuesState }\r\n    function editEntry(ctx) {\r\n        let valuesState = ctx.valuesState || {};\r\n\r\n        Object.keys(valuesState).forEach(function(k) {\r\n            let state = valuesState[k];\r\n            if (state.selected) {\r\n                state.mode = 'edit';\r\n            }\r\n        });\r\n        m.redraw();\r\n    }\r\n\r\n    /// Cancel entry editing (reset state)\r\n    /// ctx: { resetValuesState }\r\n    function cancelEntry(ctx, name) {\r\n        if (ctx.resetValuesState) {\r\n            ctx.resetValuesState();\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    /// ========================================\r\n    /// ENTRY CRUD OPERATIONS\r\n    /// ========================================\r\n\r\n    /// Delete selected entries\r\n    /// ctx: { entity, valuesState, inst }\r\n    function deleteEntry(ctx, name) {\r\n        let aP = [];\r\n        let entity = ctx.entity;\r\n        let valuesState = ctx.valuesState || {};\r\n        let inst = ctx.inst;\r\n        let model = page.context();\r\n\r\n        Object.keys(valuesState).forEach(function(k) {\r\n            let state = valuesState[k];\r\n            if (state.selected) {\r\n                /// Handle specific entry types\r\n                if (name === 'episodes' || name === 'messages' || name === 'attributes' || name === 'elementValues') {\r\n                    /// Need to confirm the attribute type, this assumes it's an array\r\n                    let ov = entity[state.attribute][state.index];\r\n                    entity[state.attribute] = entity[state.attribute].filter(function(a, i) {\r\n                        return i !== state.index;\r\n                    });\r\n                    delete valuesState[k];\r\n                    if (ov && am7model.hasIdentity(ov)) {\r\n                        aP.push(page.deleteObject(ov[am7model.jsonModelKey], ov.objectId));\r\n                    } else if (inst) {\r\n                        inst.change(name);\r\n                    }\r\n                }\r\n                else if (name === 'controls') {\r\n                    if (model.controls && model.controls[entity.objectId]) {\r\n                        let ctl = model.controls[entity.objectId][state.index];\r\n                        delete model.controls[entity.objectId][state.index];\r\n                        if (ctl && ctl.objectId) {\r\n                            aP.push(new Promise(function(res, rej) {\r\n                                am7client.delete(\"CONTROL\", ctl.objectId, function(s, v) {\r\n                                    res();\r\n                                });\r\n                            }));\r\n                        }\r\n                        console.log(\"DELETE\", ctl);\r\n                    }\r\n                }\r\n                else {\r\n                    console.log(\"Handle delete \" + name, state);\r\n                }\r\n            }\r\n        });\r\n\r\n        return Promise.all(aP).then(function() {\r\n            m.redraw();\r\n        });\r\n    }\r\n\r\n    /// Create a new entry in a list field\r\n    /// ctx: { entity, valuesState, inst }\r\n    function newEntry(ctx, name) {\r\n        let entity = ctx.entity;\r\n        let valuesState = ctx.valuesState || {};\r\n        let inst = ctx.inst;\r\n\r\n        if (!entity || !entity[am7model.jsonModelKey]) {\r\n            console.error(\"Entity not available\");\r\n            return;\r\n        }\r\n\r\n        let mf = am7model.getModelField(entity[am7model.jsonModelKey], name);\r\n        if (!mf) {\r\n            console.error(\"Object does not define '\" + name + \"'\");\r\n            return;\r\n        }\r\n\r\n        if (mf.type === 'list' && mf.baseModel) {\r\n            if (!entity[name]) entity[name] = [];\r\n            if (inst && !inst.changes.includes(name)) inst.changes.push(name);\r\n\r\n            let ne;\r\n            if (name === 'attributes') {\r\n                ne = am7client.newAttribute(\"\", \"\");\r\n            } else {\r\n                ne = am7model.newPrimitive(mf.baseModel);\r\n            }\r\n\r\n            entity[name].push(ne);\r\n            let idx = entity[name].length - 1;\r\n            valuesState[name + \"-\" + idx] = {\r\n                attribute: name,\r\n                index: idx,\r\n                selected: true,\r\n                mode: 'edit'\r\n            };\r\n            m.redraw();\r\n        } else {\r\n            console.error(\"Unhandled new entry type: \" + mf.type);\r\n        }\r\n    }\r\n\r\n    /// Check/save entry changes\r\n    /// ctx: { entity, valuesState, inst, foreignData }\r\n    function checkEntry(ctx, name, field, tableType, tableForm, props) {\r\n        let entity = ctx.entity;\r\n        let valuesState = ctx.valuesState || {};\r\n        let foreignData = ctx.foreignData || {};\r\n        let inst = ctx.inst;\r\n\r\n        if (!entity || !entity[am7model.jsonModelKey]) {\r\n            console.error(\"Entity not available\");\r\n            return Promise.resolve();\r\n        }\r\n\r\n        let formName = tableType.substring(tableType.lastIndexOf(\".\") + 1);\r\n        let fieldView = am7model.forms[formName];\r\n        let parentField = am7model.getModelField(entity[am7model.jsonModelKey], name);\r\n        let aP = [];\r\n\r\n        Object.keys(valuesState).forEach(function(k) {\r\n            let state = valuesState[k];\r\n            if (state.mode === 'edit') {\r\n                let idx = state.index;\r\n                let entry;\r\n                if (field.foreign) {\r\n                    entry = foreignData[state.fieldName || name][idx];\r\n                } else {\r\n                    entry = entity[state.fieldName || name][idx];\r\n                }\r\n\r\n                let einst = am7model.prepareInstance(entry, tableForm);\r\n\r\n                Object.keys(tableForm.fields).forEach(function(fk) {\r\n                    let tableField = am7model.getModelField(tableType, fk);\r\n                    let e = document.querySelector(\"[name='\" + fk + \"-\" + idx + \"']\");\r\n\r\n                    if (!e) {\r\n                        console.warn(\"Element not found for field: \" + fk + \"-\" + idx);\r\n                        return;\r\n                    }\r\n\r\n                    if (tableField.virtual) {\r\n                        console.log(\"Skipping virtual field\");\r\n                    } else {\r\n                        let useType = tableField.type;\r\n\r\n                        if (useType === 'flex') {\r\n                            if (entry.valueType) {\r\n                                useType = entry.valueType.toLowerCase();\r\n                            }\r\n                        }\r\n\r\n                        switch (useType) {\r\n                            case 'boolean':\r\n                                entry[fk] = (e.value.match(/^true$/gi) != null);\r\n                                break;\r\n                            case 'int':\r\n                                entry[fk] = parseInt(e.value);\r\n                                break;\r\n                            case 'double':\r\n                            case 'long':\r\n                                entry[fk] = parseFloat(e.value);\r\n                                break;\r\n                            case 'enum':\r\n                            case 'string':\r\n                                entry[fk] = e.value;\r\n                                break;\r\n                            case 'list':\r\n                            case 'array':\r\n                                einst.api[fk](e.value);\r\n                                break;\r\n                            default:\r\n                                console.warn(\"Unhandled entry type: \" + useType);\r\n                                break;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if ((parentField?.foreign || parentField?.referenced) && !fieldView?.standardUpdate && am7model.hasIdentity(entity)) {\r\n                    console.log(\"Patching object: \" + name, entry);\r\n                    if (entry.objectId) {\r\n                        aP.push(am7client.patch(entry));\r\n                    } else {\r\n                        entry[am7model.jsonModelKey] = tableType;\r\n                        if (am7model.inherits(tableType, \"common.reference\")) {\r\n                            entry.referenceId = entity.id;\r\n                            entry.referenceModel = entity[am7model.jsonModelKey];\r\n                        }\r\n                        aP.push(am7client.create(tableType, entry));\r\n                    }\r\n                }\r\n                else if ((!parentField?.foreign && !parentField?.referenced) || fieldView?.standardUpdate) {\r\n                    if (inst) inst.change(name);\r\n                }\r\n                else {\r\n                    console.warn(\"Foreign data, not updating: \" + name, entry);\r\n                }\r\n            }\r\n        });\r\n\r\n        return Promise.all(aP).then(function(aB) {\r\n            if (!aB || !aB.filter(function(b) { return !b; }).length) {\r\n                if (ctx.resetValuesState) {\r\n                    ctx.resetValuesState();\r\n                }\r\n                m.redraw();\r\n            } else {\r\n                console.warn(\"Error updating record: \" + aB);\r\n            }\r\n        });\r\n    }\r\n\r\n    /// ========================================\r\n    /// EXPORT\r\n    /// ========================================\r\n\r\n    let tableEntry = {\r\n        editEntry: editEntry,\r\n        deleteEntry: deleteEntry,\r\n        newEntry: newEntry,\r\n        checkEntry: checkEntry,\r\n        cancelEntry: cancelEntry\r\n    };\r\n\r\n    /// Register with page.components\r\n    if (typeof page !== \"undefined\" && page.components) {\r\n        page.components.tableEntry = tableEntry;\r\n    }\r\n\r\n}());\r\n\n\n;/* === client/components/emoji.js === */\n(function () {\r\n\r\n    let emojiLoadReq;\r\n    let emojiDict;\r\n    let emojiReq;\r\n    let emojiDesc;\r\n\r\n    let emojiCat;\r\n    let emojiSubCat;\r\n    let emojiResults = [];\r\n\r\n    function searchEmojis(e) {\r\n        let search = e.target.value.trim().toLowerCase();\r\n        emojiCat = undefined;\r\n        if(search.length == 0){\r\n            emojiResults = [];\r\n            m.redraw();\r\n            return;\r\n        }\r\n        findEmojis(search).then((results) => {\r\n            emojiResults = results.map((o) => {\r\n                return emojiMenuButton(o);\r\n            });\r\n            if (emojiResults.length == 0) {\r\n                emojiResults = [m(\"div\", { class: \"context-menu-item\" }, \"No emojis found\")];\r\n            }\r\n            m.redraw();\r\n        });\r\n    }\r\n\r\n    function emojiMenuButton(o){\r\n        return m(\"button\", {\r\n            class: \"context-menu-item text-left\",\r\n            onclick: function () {\r\n                page.navigable.menu(\"#emojiContextMenu\");\r\n                navigator.clipboard.writeText(o.emoji);\r\n                page.toast(\"info\", o.emoji + \" copied to clipboard\", 2000);\r\n            }\r\n        }, [\r\n            m(\"span\", { class: \"emoji\" }, o.emoji),\r\n            m(\"span\", { class: \"ml-2\" }, o.name)\r\n        ]);\r\n    }\r\n\r\n    function emojiCategories(){\r\n        let ret = [];\r\n        if(!emojiLoadReq && !emojiDict){\r\n            emojiLoadReq = true;\r\n            loadEmojiDict().then(() => {\r\n                m.redraw();\r\n            });\r\n            return ret;\r\n        };\r\n        if(emojiCat){\r\n            ret.push(m(\"button\", {class: \"context-menu-item text-left\", onclick: function () { emojiCat = undefined; emojiSubCat = undefined; m.redraw(); }}, [\r\n                m(\"span\", { class: \"ml-2\" }, emojiCat)\r\n            ]));\r\n            if(emojiSubCat){\r\n                ret.push(m(\"button\", {class: \"context-menu-item text-left\", onclick: function () { emojiSubCat = undefined; m.redraw(); }}, [\r\n                    m(\"span\", { class: \"ml-2\" }, emojiSubCat)\r\n                ]));\r\n            }\r\n        }\r\n        \r\n        if(emojiDict){\r\n            let ejs = (emojiCat ? emojiDict[emojiCat] : emojiDict);\r\n            if(emojiSubCat){\r\n                ejs = ejs[emojiSubCat];\r\n            }\r\n            for(let e in ejs){\r\n                let itm = e;\r\n                if(emojiSubCat){\r\n                    ret.push(emojiMenuButton(ejs[e]));\r\n                }\r\n                else{\r\n\r\n                    ret.push(m(\"button\", {\r\n                        class: \"context-menu-item text-left\",\r\n                        onclick: function () {\r\n                            //page.navigable.menu(\".context-menu-48\");\r\n                            if(emojiCat){\r\n                                emojiSubCat = e;\r\n                            }\r\n                            else{\r\n                                emojiCat = e;\r\n                                emojiSubCat = undefined;\r\n                            }\r\n                            \r\n                            m.redraw();\r\n                        }\r\n                    }, [\r\n                        m(\"span\", { class: \"ml-2\" }, e)\r\n                    ]));\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    function emojiContextButton() {\r\n        let ico = m(\"span\", { class: \"material-symbols-outlined\" }, \"add_reaction\");\r\n        return m(\"button\", { id: \"emojiContextMenuButton\", class: \"context-menu-button\" }, [ico]);\r\n    }\r\n    \r\n\r\n\r\n    function renderEmojiButton() {\r\n        return m(\"div\", { class: \"context-menu-container\" }, [\r\n            emojiContextButton(),\r\n            m(\"div\", { id: \"emojiContextMenu\", class: \"transition transition-0 context-menu-48\" }, [\r\n                m(\"input\", {type: \"text\", class: \"ml-0 mr-0 context-menu-input text-field\", placeholder: \"Search emojis\", oninput: searchEmojis}),\r\n                (emojiResults && emojiResults.length > 0 ? emojiResults : emojiCategories())\r\n            ])\r\n        ])\r\n    }\r\n\r\n    function markdownEmojis(text) {\r\n      if(!emojiDict){\r\n        loadEmojiDict().then(() => {\r\n            m.redraw();\r\n        });\r\n        return text;\r\n      }\r\n\r\n      let ea = Array.from(new Set(extractEmojis(text)));\r\n      for(let i = 0; i < ea.length; i++){\r\n        let desc = findEmojiDesc(ea[i]);\r\n        let txt = desc?.alt || desc?.description;\r\n        if(!txt) txt = findEmojiName(ea[i]);\r\n\r\n        let lbl = \"[\" + ea[i] + \"](## \\\"\" + txt + \"\\\")\"; \r\n        text = text.replaceAll(ea[i], lbl);\r\n      }\r\n      return text;\r\n    }\r\n\r\n    async function loadEmojiDict(){\r\n        if(!emojiDict){\r\n            if(!emojiReq){\r\n                emojiReq = true;\r\n                let edd = await m.request({ method: 'GET', url: \"/common/emojiDesc.json\", withCredentials: true });\r\n                if(edd && edd.length > 0){\r\n                    emojiDesc = edd;\r\n                }\r\n                let ed = await m.request({ method: 'GET', url: \"/common/emojis.categories.json\", withCredentials: true });\r\n                if(ed && ed.emojis){\r\n                    emojiDict = ed.emojis;\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n    }\r\n    function findEmojiDesc(emoji) {\r\n        let desc;\r\n        if(emojiDesc){\r\n            let ad = emojiDesc.filter(e => e.emoji === emoji);\r\n            if(ad && ad.length > 0){\r\n                desc = ad[0];\r\n            };\r\n        }\r\n        return desc;\r\n    }\r\n\r\n    function findEmojiName(targetEmoji) {\r\n        for (const categoryName in emojiDict) {\r\n            const subCategories = emojiDict[categoryName];\r\n            for (const subCategoryName in subCategories) {\r\n                const emojiList = subCategories[subCategoryName];\r\n                const foundEmoji = emojiList.find(emoji => emoji.emoji === targetEmoji.trim());\r\n                if (foundEmoji) {\r\n                    return foundEmoji.name;\r\n                }\r\n            }\r\n        }\r\n        return;\r\n    }\r\n\r\n    async function findEmojis(targetEmoji) {\r\n        await loadEmojiDict();\r\n        let be = extractEmojis(targetEmoji).length > 0;\r\n        let rea = !be ? \"emoji\" : \"name\";\r\n        let ar = [];\r\n        let et = targetEmoji.trim();\r\n        for (const categoryName in emojiDict) {\r\n            const subCategories = emojiDict[categoryName];\r\n            for (const subCategoryName in subCategories) {\r\n                const emojiList = subCategories[subCategoryName];\r\n                const foundEmoji = emojiList.find(emoji => (be && emoji.emoji === et) || (!be && emoji.name.toLowerCase().indexOf(et.toLowerCase()) > -1));\r\n                if (foundEmoji) {\r\n                    //return foundEmoji[rea];\r\n                    ar.push({\r\n                        name: foundEmoji.name,\r\n                        emoji: foundEmoji.emoji,\r\n                        category: categoryName,\r\n                        subCategory: subCategoryName\r\n                    });\r\n                }\r\n            }\r\n        }\r\n          \r\n        return ar;\r\n    }\r\n\r\n    function extractEmojis(text) {\r\n        if (!text || typeof text !== 'string') {\r\n            return [];\r\n        }\r\n        const emojiRegex = /\\p{Emoji_Presentation}|\\p{Extended_Pictographic}/gu;\r\n        const matches = text.match(emojiRegex);\r\n        return matches || [];\r\n    }\r\n\r\n    async function exportEmojis(delim) {\r\n        await loadEmojiDict();\r\n        // Define the header row for the TSV file\r\n        const headers = [\r\n            'Category',\r\n            'Subcategory',\r\n            'Emoji',\r\n            'Name',\r\n            'Keywords',\r\n            'Unicode'\r\n        ];\r\n        let tsvContent = headers.join(delim) + '\\n';\r\n\r\n        // Iterate over each category in the JSON data\r\n        for(let category in emojiDict){\r\n            //const categoryName = category.name || 'N/A';\r\n            for(let subCategory in emojiDict[category]){\r\n            // Iterate over each emoji within the category\r\n                let ems = emojiDict[category][subCategory];\r\n\r\n                if (Array.isArray(ems)) {\r\n                    ems.forEach(emoji => {\r\n                        const emojiChar = emoji.emoji || '';\r\n                        const name = emoji.name || 'N/A';\r\n                        // Join keywords with a comma, or provide 'N/A' if none exist\r\n                        const keywords = Array.isArray(emoji.keywords) ? emoji.keywords.join(', ') : 'N/A';\r\n                        const unicode = emoji.unicode || 'N/A';\r\n\r\n                        // Create a row array and join with tabs\r\n                        const row = [\r\n                            category,\r\n                            subCategory,\r\n                            emojiChar,\r\n                            name,\r\n                            keywords,\r\n                            unicode\r\n                        ];\r\n                        tsvContent += row.join('\\t') + '\\n';\r\n                    });\r\n                }\r\n            }\r\n        };\r\n\r\n        return tsvContent;\r\n    }\r\n\r\n    let emoji = {\r\n        menuButton: renderEmojiButton,\r\n        markdownEmojis,\r\n        findEmojis,\r\n        findEmojiDesc,\r\n        emojis: () => emojiDict,\r\n        emojisDesc: () => emojiDesc,\r\n        loadEmojiDict,\r\n        exportEmojis,\r\n        component: {\r\n            \r\n            oncreate: function (x) {\r\n                page.navigable.addContextMenu(\"#emojiContextMenu\", \"#emojiContextMenuButton\");\r\n            },\r\n            oninit: function(){\r\n                page.navigable.setupPendingContextMenus();\r\n            },\r\n            onupdate: function(){\r\n                page.navigable.setupPendingContextMenus();\r\n            },\r\n            view: function (x) {\r\n                return renderEmojiButton();\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n    page.components.emoji = emoji;\r\n\r\n}());\r\n\n\n;/* === client/components/games.js === */\n(function () {\r\n\r\n    function gameContextButton() {\r\n        let ico = m(\"span\", { class: \"material-symbols-outlined\" }, \"sports_esports\");\r\n        return m(\"button\", { id: \"gameContextMenuButton\", class: \"context-menu-button\" }, [ico]);\r\n    }\r\n\r\n    function gameMenuButton(label, icon, route) {\r\n        return m(\"button\", {\r\n            class: \"context-menu-item text-left\",\r\n            onclick: function () {\r\n                page.navigable.menu(\"#gameContextMenu\");\r\n                m.route.set(route);\r\n            }\r\n        }, [\r\n            m(\"span\", { class: \"material-symbols-outlined mr-2\" }, icon),\r\n            m(\"span\", label)\r\n        ]);\r\n    }\r\n\r\n    function renderGameButton() {\r\n        return m(\"div\", { class: \"context-menu-container\" }, [\r\n            gameContextButton(),\r\n            m(\"div\", { id: \"gameContextMenu\", class: \"transition transition-0 context-menu-48\" }, [\r\n                gameMenuButton(\"Card Game\", \"playing_cards\", \"/cardGame-v2\"),\r\n                gameMenuButton(\"Word Game\", \"match_word\", \"/game/wordGame\"),\r\n                gameMenuButton(\"Tetris\", \"grid_on\", \"/game/tetris\"),\r\n                gameMenuButton(\"Magic 8\", \"counter_8\", \"/magic8\")\r\n            ])\r\n        ]);\r\n    }\r\n\r\n    let games = {\r\n        menuButton: renderGameButton,\r\n        component: {\r\n            oncreate: function (x) {\r\n                page.navigable.addContextMenu(\"#gameContextMenu\", \"#gameContextMenuButton\");\r\n            },\r\n            oninit: function () {\r\n                page.navigable.setupPendingContextMenus();\r\n            },\r\n            onupdate: function () {\r\n                page.navigable.setupPendingContextMenus();\r\n            },\r\n            view: function (x) {\r\n                return renderGameButton();\r\n            }\r\n        }\r\n    };\r\n\r\n    page.components.games = games;\r\n\r\n}());\r\n\n\n;/* === client/components/audio.js === */\n(function () {\r\n    let audioMap = {};\r\n    let audioSource = {};\r\n    let visualizers = {};\r\n    let recorder;\r\n    let upNext = [];\r\n\r\n    function newMagic8() {\r\n        return {\r\n            id: page.uid(),\r\n            audioMotionTop: undefined,\r\n            audioMotionBottom: undefined,\r\n            audio1: undefined,\r\n            audio1Content: undefined,\r\n            audio2: undefined,\r\n            audio2Content: undefined,\r\n            lastAudio: 0,\r\n            configuring: false,\r\n            lastContent: undefined // Track content changes\r\n        };\r\n    }\r\n\r\n    let magic8 = newMagic8();\r\n\r\n    function clearMagic8(audioMagic8) {\r\n\r\n        let preserveContent = magic8.lastContent;\r\n        upNext = [];\r\n\r\n        if (magic8.audio1) {\r\n            stopAudioSources(magic8.audio1);\r\n        }\r\n        if (magic8.audio2) {\r\n            stopAudioSources(magic8.audio2);\r\n        }\r\n\r\n        if (!audioMagic8) {\r\n            clearAudioSource();\r\n        }\r\n\r\n        if (magic8.audioMotionTop) {\r\n            magic8.audioMotionTop.stop();\r\n            magic8.audioMotionTop.destroy();\r\n        }\r\n        if (magic8.audioMotionBottom) {\r\n            magic8.audioMotionBottom.stop();\r\n            magic8.audioMotionBottom.destroy();\r\n        }\r\n\r\n        let canvasTop = document.getElementById(\"waveform-top\");\r\n        let canvasBottom = document.getElementById(\"waveform-bottom\");\r\n        if (canvasTop) canvasTop.innerHTML = \"\";\r\n        if (canvasBottom) canvasBottom.innerHTML = \"\";\r\n\r\n        if (magic8.audio1 && magic8.audio1.name) {\r\n            delete audioSource[magic8.audio1.name];\r\n        }\r\n        if (magic8.audio2 && magic8.audio2.name) {\r\n            delete audioSource[magic8.audio2.name];\r\n        }\r\n\r\n        magic8 = newMagic8();\r\n\r\n        if (audioMagic8) {\r\n            magic8.lastContent = preserveContent;\r\n        }\r\n    }\r\n\r\n    function configureMagic8(inst, chatCfg, audioMagic8, prune) {\r\n        if (!audioMagic8) {\r\n            return;\r\n        }\r\n\r\n        if (magic8.configuring) {\r\n            // console.warn(\"Magic8 is already configuring, skipping...\");\r\n            return;\r\n        }\r\n\r\n        let aMsg = chatCfg?.history?.messages;\r\n        if (!aMsg || !aMsg.length) {\r\n            return;\r\n        }\r\n\r\n        let messagesToProcess = aMsg.slice(-2);\r\n        let currentContent = messagesToProcess.map(m => m?.content || \"\").join(\"|\");\r\n\r\n        // If already configured with the same content AND visualizers exist, don't reconfigure\r\n        if (magic8.lastContent === currentContent && magic8.audioMotionTop && magic8.audioMotionBottom) {\r\n            /// console.log(\"Magic8 already configured with same content, skipping...\");\r\n            return;\r\n        }\r\n\r\n        // Check if canvases exist before proceeding\r\n        let canvasTop = document.getElementById(\"waveform-top\");\r\n        let canvasBottom = document.getElementById(\"waveform-bottom\");\r\n        if (!canvasTop || !canvasBottom) {\r\n            return;\r\n        }\r\n\r\n        let contentChanged = magic8.lastContent !== currentContent;\r\n\r\n        // Only clear and reconfigure if content has actually changed\r\n        if (contentChanged) {\r\n            //console.log(\"Magic8 content changed, reconfiguring...\");\r\n            clearMagic8(false);\r\n            magic8.lastContent = currentContent;\r\n        } else if (!magic8.audioMotionTop || !magic8.audioMotionBottom) {\r\n            // Only reconfigure visualizers if they don't exist but content is the same\r\n            //console.log(\"Magic8 visualizers missing, recreating...\");\r\n        } else {\r\n            // Everything is already configured properly\r\n            return;\r\n        }\r\n\r\n        magic8.configuring = true;\r\n        let aP = [];\r\n\r\n        // Get profile IDs\r\n        let sysProfileId = chatCfg?.system?.profile?.objectId;\r\n        let usrProfileId = chatCfg?.user?.profile?.objectId;\r\n        if (!sysProfileId || !usrProfileId) {\r\n            console.warn(\"No system or user profile for chat\");\r\n            magic8.configuring = false;\r\n            return;\r\n        }\r\n\r\n        // Only create new audio sources if content changed or they don't exist\r\n        if (contentChanged || !magic8.audio1 || !magic8.audio2) {\r\n            messagesToProcess.forEach((m, i) => {\r\n                if (!m) return;\r\n                // console.log(\"Processing Magic8 message:\", i, m.role, m.content?.substring(0, 30) + \"...\");\r\n                let actualIndex = aMsg.length - 1 + i;\r\n                let name = inst.api.objectId() + \" - \" + actualIndex;\r\n                let profId = (m.role == \"assistant\") ? sysProfileId : usrProfileId;\r\n\r\n                let cnt = prune ? prune(m.content) : m.content;\r\n                if (cnt.length) {\r\n                    aP.push(createAudioSource(name, profId, cnt).then((aud) => {\r\n                        if (!aud) return;\r\n\r\n                        aud.name = name; // Store name for cleanup\r\n\r\n                        if (m.role == \"assistant\") {\r\n                            console.log(\"Configure Magic8 audio 1 (assistant)\");\r\n                            magic8.audio1 = aud;\r\n                            magic8.audio1Content = cnt;\r\n                            magic8.lastAudio = 1;\r\n                        } else {\r\n                            console.log(\"Configure Magic8 audio 2 (user)\");\r\n                            magic8.audio2 = aud;\r\n                            magic8.audio2Content = cnt;\r\n                            magic8.lastAudio = 2;\r\n                        }\r\n                    }).catch(err => {\r\n                        console.error(\"Error creating audio source for Magic8:\", err);\r\n                    }));\r\n                }\r\n            });\r\n        }\r\n\r\n        Promise.all(aP).then(() => {\r\n            // Ensure we still have valid canvases after async operations\r\n            canvasTop = document.getElementById(\"waveform-top\");\r\n            canvasBottom = document.getElementById(\"waveform-bottom\");\r\n            if (!canvasTop || !canvasBottom) {\r\n                magic8.configuring = false;\r\n                return;\r\n            }\r\n\r\n            // Only create new visualizers if they don't exist\r\n            if (!magic8.audioMotionTop || !magic8.audioMotionBottom) {\r\n                let props = {\r\n                    overlay: true,\r\n                    bgAlpha: 0,\r\n                    gradient: 'prism',\r\n                    showBgColor: true,\r\n                    showSource: false,\r\n                    showScaleY: false,\r\n                    showScaleX: false\r\n                };\r\n\r\n                let props1 = Object.assign({ height: canvasTop.offsetHeight, source: magic8.audio1?.source }, props);\r\n                let props2 = Object.assign({ height: canvasBottom.offsetHeight, source: magic8.audio2?.source }, props);\r\n\r\n                magic8.audioMotionTop = new AudioMotionAnalyzer(canvasTop, props1);\r\n                magic8.audioMotionBottom = new AudioMotionAnalyzer(canvasBottom, props2);\r\n\r\n                // Set up click handlers\r\n                canvasTop.onclick = function (e) {\r\n                    togglePlayMagic8(magic8.audio1, magic8.audio2);\r\n                };\r\n                canvasBottom.onclick = function (e) {\r\n                    togglePlayMagic8(magic8.audio2, magic8.audio1);\r\n                };\r\n            }\r\n\r\n            // Clear any existing upNext queue to prevent old audio from auto-starting\r\n            upNext = [];\r\n\r\n            // Auto-start the most recent audio when content changes\r\n            if (contentChanged && magic8.lastAudio && magic8[\"audio\" + magic8.lastAudio]) {\r\n                let currentAudio = magic8[\"audio\" + magic8.lastAudio];\r\n                // console.log(\"Starting Magic8 audio after content change:\", magic8.lastAudio);\r\n                setTimeout(() => {\r\n                    togglePlayAudioSource(currentAudio, true);\r\n                }, 100);\r\n            }\r\n\r\n            magic8.configuring = false;\r\n            // console.log(\"Magic8 configuration complete\");\r\n        }).catch(err => {\r\n            console.error(\"Error configuring Magic8:\", err);\r\n            magic8.configuring = false;\r\n        });\r\n    }\r\n    let bgAudio = false;\r\n    let bgAnim = false;\r\n    let bgImg = true;\r\n    let images = [];\r\n    /// At the moment, this is just a group id \r\n    let imgBase = [132,1546,1545,1547]; \r\n    // let imgBase = [3261];\r\n    let imgUrl;\r\n    const imgCfg = {\r\n        isA_onTop: false,\r\n        isTransitioning: false,\r\n        imageA_src: undefined,\r\n        imageB_src: undefined\r\n    };\r\n\r\n    // The onload handler that triggers the visual transition\r\n    const imageTransition = () => {\r\n        // Prevent re-triggering during a transition\r\n        if (imgCfg.isTransitioning) return;\r\n        imgCfg.isTransitioning = true;\r\n        setTimeout(() => {\r\n            if (imgCfg.isA_onTop) {\r\n                imgCfg.imageA_src = images[Math.floor(Math.random() * images.length)];\r\n            }\r\n            else {\r\n                imgCfg.imageB_src = images[Math.floor(Math.random() * images.length)];\r\n            }\r\n            imgCfg.isA_onTop = !imgCfg.isA_onTop;\r\n            imgCfg.isTransitioning = false;\r\n            m.redraw();\r\n        }, 3000);\r\n    };\r\n\r\n    function getMagic8View(chatCfg, profile) {\r\n\r\n        // Get profile image URLs if available\r\n        let sysUrl, usrUrl;\r\n        if (profile) {\r\n            if (chatCfg.system?.profile?.portrait) {\r\n                let pp = chatCfg.system.profile.portrait;\r\n                sysUrl = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + pp.groupPath + \"/\" + pp.name + \"/256x256\";\r\n            }\r\n            if (chatCfg.user?.profile?.portrait) {\r\n                let pp = chatCfg.user.profile.portrait;\r\n                usrUrl = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + pp.groupPath + \"/\" + pp.name + \"/256x256\";\r\n            }\r\n        }\r\n\r\n        let gimg = \"\";\r\n        if (bgImg && !profile && imgBase.length && images.length == 0) {\r\n            // console.log(\"Loading magic8 images from base\", imgBase);\r\n            let q = am7client.newQuery(\"data.data\");\r\n            //q.field(\"groupId\", imgBase);\r\n            let qg = q.field(null, null);\r\n            qg.comparator = \"group_or\";\r\n            qg.fields = imgBase.map((a) => {\r\n                return {\r\n                    name: \"groupId\",\r\n                    comparator: \"equals\",\r\n                    value: a\r\n                }\r\n            });\r\n            q.range(0, 0);\r\n            imgBase = [];\r\n            page.search(q).then((res) => {\r\n\r\n                if (res && res.results) {\r\n                    images = res.results.map((r) => {\r\n                        return g_application_path + \"/media/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + r.groupPath + \"/\" + r.name;\r\n                    });\r\n                    imgCfg.imageA_src = images[Math.floor(Math.random() * images.length)];\r\n                    imgCfg.imageB_src = images[Math.floor(Math.random() * images.length)];\r\n\r\n                    m.redraw();\r\n                }\r\n            });\r\n        }\r\n        if (bgImg && images.length > 0) {\r\n            const imageClasses = 'absolute top-0 left-0 w-full h-full rounded-full object-cover transition-all ease-in-out duration-300';\r\n\r\n            gimg = m(\"div\", { class: 'relative w-full h-full' }, [\r\n                // Image A\r\n                m(\"img\", {\r\n                    key: 'A',\r\n                    objectFit: \"contain\",\r\n                    objectPosition: \"center\",\r\n                    src: imgCfg.imageA_src,\r\n                    class: `${imageClasses} ${imgCfg.isA_onTop && imgCfg.isTransitioning ? 'opacity-0 blur-md' : 'opacity-50 dark:opacity-50 blur-0'}`,\r\n                    onload: !imgCfg.isA_onTop ? imageTransition : null,\r\n                    onerror: ()=> {page.toast(\"error\", \"Failed to load image: \" + imgCfg.imageA_src); imageTransition();}\r\n                }),\r\n                // Image B\r\n                m(\"img\", {\r\n                    key: 'B',\r\n                    objectFit: \"contain\",\r\n                    objectPosition: \"center\",\r\n                    src: imgCfg.imageB_src,\r\n                    class: `${imageClasses} ${!imgCfg.isA_onTop && imgCfg.isTransitioning ? 'opacity-0 blur-md' : 'opacity-50 dark:opacity-50 blur-0'}`,\r\n                    onload: imgCfg.isA_onTop ? imageTransition : null,\r\n                    onerror: ()=> {page.toast(\"error\", \"Failed to load image: \" + imgCfg.imageB_src); imageTransition();}\r\n                })\r\n            ]);\r\n\r\n        }\r\n\r\n        // bg-gradient-to-br from-slate-100 via-slate-200 to-slate-300 shadow-[inset_0_10px_20px_rgba(255,255,255,0.1),inset_0_-10px_20px_rgba(0,0,0,0.2)]\r\n        return m(\"div\", {\r\n            key: \"magic8-container\", // Use a stable key instead of magic8.id\r\n            class: `\r\n      relative aspect-square w-[90vw] max-w-[800px] max-h-[800px] mx-auto\r\n      rounded-full overflow-hidden\r\n      \r\n      ring-2 ring-white/20\r\n    `\r\n        }, [\r\n            !sysUrl && !usrUrl && gimg,\r\n            // System (assistant) profile image - upper hemisphere\r\n            sysUrl && m(\"div\", {\r\n                class: `\r\n        absolute top-0 left-0 w-full h-1/2 z-0\r\n        pointer-events-none\r\n        opacity-60 blur-sm\r\n        bg-cover\r\n      `,\r\n                style: {\r\n                    backgroundImage: `url('${sysUrl}')`,\r\n                    backgroundPosition: \"top center\"\r\n                }\r\n            }),\r\n\r\n            // User profile image - lower hemisphere\r\n            usrUrl && m(\"div\", {\r\n                class: `\r\n        absolute bottom-0 left-0 w-full h-1/2 z-0\r\n        pointer-events-none\r\n        opacity-60 blur-sm\r\n        bg-cover\r\n      `,\r\n                style: {\r\n                    backgroundImage: `url('${usrUrl}')`,\r\n                    backgroundPosition: \"top center\"\r\n                }\r\n            }),\r\n\r\n            // Top waveform canvas\r\n            m(\"div\", {\r\n                id: \"waveform-top\",\r\n                class: `\r\n        absolute top-0 left-0 w-full h-1/2 z-10\r\n      `\r\n            }),\r\n\r\n            // Bottom waveform canvas (inverted)\r\n            m(\"div\", {\r\n                id: \"waveform-bottom\",\r\n                class: `\r\n        absolute bottom-0 left-0 w-full h-1/2 z-10\r\n        transform scale-y-[-1]\r\n      `\r\n            }),\r\n            /// bg-[radial-gradient(circle_at_50%_50%,rgba(255,255,255,0.15)_0%,transparent_70%)]\r\n            // ...rest of your overlays and effects...\r\n            m(\"div\", {\r\n                class: `\r\n        absolute inset-0 rounded-full pointer-events-none\r\n        \r\n      `\r\n            }),\r\n            // bg-[radial-gradient(circle_at_30%_30%,rgba(255,255,255,0.3)_0%,transparent_40%)]\r\n            m(\"div\", {\r\n                class: `\r\n        absolute top-0 left-0 w-full h-full pointer-events-none rounded-full\r\n        \r\n        mix-blend-screen\r\n      `\r\n            }),\r\n            // bg-gradient-to-t from-black/20 to-transparent\r\n            m(\"div\", {\r\n                class: `\r\n        absolute bottom-0 left-0 w-full h-1/2\r\n        \r\n        pointer-events-none\r\n      `\r\n            }),\r\n            bgAnim && m(\"canvas\", {\r\n                id: \"spiral-overlay\",\r\n                class: `\r\n                    absolute z-20 pointer-events-none\r\n                    opacity-20 w-full h-full top-0 left-0\r\n                `,\r\n                oncreate: ({ dom }) => {\r\n                    drawSpiral(dom);\r\n                    //drawMandala(dom);\r\n                }\r\n            })\r\n        ]);\r\n    }\r\n\r\n    function drawMandala(canvas) {\r\n        const ctx = canvas.getContext(\"2d\");\r\n        const width = canvas.width = canvas.offsetWidth;\r\n        const height = canvas.height = canvas.offsetHeight;\r\n        const centerX = width / 2;\r\n        const centerY = height / 2;\r\n\r\n        let frame = 0;\r\n\r\n        function animate() {\r\n            ctx.clearRect(0, 0, width, height);\r\n            ctx.save();\r\n\r\n            const pulse = 1 + 0.08 * Math.sin(frame * 0.02); // gentle scale\r\n            const rotation = frame * 0.002;\r\n            const hue = (frame * 0.6) % 360;\r\n            const petals = 12;\r\n            const layers = 4;\r\n\r\n            ctx.translate(centerX, centerY);\r\n            ctx.scale(pulse, pulse);\r\n            ctx.rotate(rotation);\r\n\r\n            for (let layer = 0; layer < layers; layer++) {\r\n                const radius = 60 + layer * 30;\r\n                const petalLength = 30 + layer * 10;\r\n                const petalWidth = 12;\r\n\r\n                for (let i = 0; i < petals; i++) {\r\n                    const angle = (i * 2 * Math.PI) / petals;\r\n\r\n                    const x = radius * Math.cos(angle);\r\n                    const y = radius * Math.sin(angle);\r\n\r\n                    ctx.save();\r\n                    ctx.translate(x, y);\r\n                    ctx.rotate(angle + rotation);\r\n\r\n                    ctx.beginPath();\r\n                    ctx.ellipse(0, 0, petalWidth, petalLength, 0, 0, 2 * Math.PI);\r\n                    ctx.strokeStyle = `hsl(${(hue + i * 30) % 360}, 100%, 75%)`;\r\n                    ctx.shadowColor = ctx.strokeStyle;\r\n                    ctx.shadowBlur = 8;\r\n                    ctx.lineWidth = 2;\r\n                    ctx.stroke();\r\n\r\n                    ctx.restore();\r\n                }\r\n            }\r\n\r\n            ctx.restore();\r\n            frame++;\r\n            requestAnimationFrame(animate);\r\n        }\r\n\r\n        animate();\r\n    }\r\n\r\n    function drawSpiral(canvas) {\r\n        const ctx = canvas.getContext(\"2d\");\r\n        const width = canvas.width = canvas.offsetWidth;\r\n        const height = canvas.height = canvas.offsetHeight;\r\n        const centerX = width / 2;\r\n        const centerY = height / 2;\r\n\r\n        let frame = 0;\r\n        let spiralSpeed = 0.01;\r\n        let pulseSpeed = 0.005;\r\n        let hue = 0;\r\n\r\n        function animate() {\r\n            ctx.clearRect(0, 0, width, height);\r\n\r\n            const pulse = 1 + 0.1 * Math.sin(frame * pulseSpeed); // gentle scale\r\n\r\n            // Color cycling: hue shift over time\r\n            hue = (frame * 0.5) % 360;\r\n            const strokeColor = `hsl(${hue}, 100%, 80%)`;\r\n\r\n            ctx.beginPath();\r\n            ctx.strokeStyle = strokeColor;\r\n            ctx.shadowColor = strokeColor;\r\n            ctx.shadowBlur = 10;\r\n            ctx.lineWidth = 2;\r\n\r\n            let angle = 0;\r\n            let radius = 0;\r\n            ctx.moveTo(centerX, centerY);\r\n\r\n            for (let i = 0; i < 2000; i++) {\r\n                radius = i * 0.1 * pulse;\r\n                angle += 0.02;\r\n                const x = centerX + radius * Math.cos(angle + frame * spiralSpeed);\r\n                const y = centerY + radius * Math.sin(angle + frame * spiralSpeed);\r\n                ctx.lineTo(x, y);\r\n            }\r\n\r\n            ctx.stroke();\r\n            frame++;\r\n            requestAnimationFrame(animate);\r\n        }\r\n\r\n        animate();\r\n    }\r\n\r\n    function newRecorder() {\r\n        return {\r\n            uid: page.uid\r\n        }\r\n    }\r\n\r\n    function togglePlayAudio(id) {\r\n        let aud = document.getElementById(id);\r\n        if (!aud) return;\r\n        aud.paused ? aud.play() : aud.pause();\r\n    }\r\n\r\n    function isStreamSilent() {\r\n        if (!recorder || !recorder.analyzer) {\r\n            console.warn(\"Analyzer not available\", recorder?.analyzer);\r\n            return;\r\n        }\r\n        let threshold = 3;\r\n        let bufferLength = recorder.analyzer.fftSize;\r\n        let dataArray = new Uint8Array(bufferLength);\r\n\r\n        // Get the current waveform data\r\n        recorder.analyzer.getByteTimeDomainData(dataArray);\r\n\r\n        // Find the maximum amplitude in the buffer\r\n        let maxAmplitude = 0;\r\n        for (let i = 0; i < bufferLength; i++) {\r\n            // The values are 0-255, with 128 being the center (silence)\r\n            let amplitude = Math.abs(dataArray[i] - 128);\r\n            if (amplitude > maxAmplitude) {\r\n                maxAmplitude = amplitude;\r\n            }\r\n        }\r\n        console.log(maxAmplitude + \" < \" + threshold);\r\n        return maxAmplitude <= threshold;\r\n    }\r\n\r\n    /// currently only setup for live streaming to extract text, not to actually record the audio\r\n    ///\r\n    function recordWithVisualizer(stream, handler, saveHandler, options = {}) {\r\n        if (recorder) {\r\n            return recorder.view;\r\n        }\r\n\r\n        // Default options\r\n        let config = {\r\n            maxSilenceSeconds: options.maxSilenceSeconds || null, // null = no auto-stop\r\n            silenceThreshold: options.silenceThreshold || 3,\r\n            chunkInterval: options.chunkInterval || 2000,\r\n            autoRestart: options.autoRestart !== false, // default true\r\n            maxSilenceBeforeRestart: options.maxSilenceBeforeRestart || 5\r\n        };\r\n\r\n        recorder = newRecorder();\r\n\r\n        recorder.view = m(\"div\", {\r\n            id: \"recorder-visualizer\",\r\n            class: \"w-[80%]\",\r\n            oncreate: function (vnode) {\r\n                // Check if a visualizer is already running\r\n                if (visualizers.recorder) {\r\n                    try {\r\n                        visualizers.recorder.destroy();\r\n                    } catch (e) {\r\n                        console.warn(\"Error destroying existing visualizer:\", e);\r\n                    }\r\n                    delete visualizers.recorder;\r\n                }\r\n\r\n                navigator.mediaDevices.getUserMedia({\r\n                    audio: {\r\n                        echoCancellation: true,\r\n                        noiseSuppression: true,\r\n                        autoGainControl: true\r\n                    }\r\n                })\r\n                    .then(mediaStream => {\r\n                        let audioCtx = new (window.AudioContext || window.webkitAudioContext)();\r\n                        let analyzer = audioCtx.createAnalyser();\r\n                        analyzer.fftSize = 2048;\r\n                        analyzer.smoothingTimeConstant = 0.8;\r\n\r\n                        recorder.analyzer = analyzer;\r\n                        recorder.context = audioCtx;\r\n                        recorder.stream = mediaStream;\r\n\r\n                        let source = audioCtx.createMediaStreamSource(mediaStream);\r\n                        source.connect(analyzer);\r\n\r\n                        let props = {\r\n                            source: analyzer,\r\n                            height: 40,\r\n                            overlay: true,\r\n                            bgAlpha: 0,\r\n                            gradient: 'prism',\r\n                            showBgColor: true,\r\n                            showSource: false,\r\n                            showScaleY: false,\r\n                            showScaleX: false,\r\n                            volume: 0\r\n                        };\r\n\r\n                        try {\r\n                            recorder.motionAnalyzer = new AudioMotionAnalyzer(vnode.dom, props);\r\n                            recorder.motionAnalyzer.volume = 0;\r\n                            visualizers.recorder = recorder.motionAnalyzer;\r\n                        } catch (e) {\r\n                            console.error(\"Error creating AudioMotionAnalyzer:\", e);\r\n                            vnode.dom.textContent = \"Error: Could not create audio visualizer.\";\r\n                            return;\r\n                        }\r\n\r\n                        let chunks = [];\r\n                        let mediaRecorder;\r\n\r\n                        try {\r\n                            mediaRecorder = new MediaRecorder(mediaStream, {\r\n                                mimeType: 'audio/webm;codecs=opus'\r\n                            });\r\n                        } catch (e) {\r\n                            try {\r\n                                mediaRecorder = new MediaRecorder(mediaStream);\r\n                            } catch (e2) {\r\n                                console.error(\"MediaRecorder not supported:\", e2);\r\n                                vnode.dom.textContent = \"Error: Recording not supported in this browser.\";\r\n                                return;\r\n                            }\r\n                        }\r\n\r\n                        recorder.recorder = mediaRecorder;\r\n\r\n                        let silenceCount = 0;\r\n                        let totalSilenceTime = 0;\r\n                        let silenceStartTime = null;\r\n                        let isCurrentlySilent = false;\r\n\r\n                        function ab_b64(buf) {\r\n                            return btoa(buf.reduce(\r\n                                function (data, val) {\r\n                                    return data + String.fromCharCode(val);\r\n                                },\r\n                                \"\"\r\n                            ));\r\n                        }\r\n\r\n                        async function getAudioBase64(blob) {\r\n                            try {\r\n                                let buff = await blob.arrayBuffer();\r\n                                return ab_b64(new Uint8Array(buff));\r\n                            } catch (e) {\r\n                                console.error(\"Error converting audio to base64:\", e);\r\n                                return null;\r\n                            }\r\n                        }\r\n\r\n                        async function sendChunk(chunk, close = false) {\r\n                            try {\r\n                                window.dbgBlob = chunk;\r\n                                // console.log(\"Sending chunk...\", chunk.size, \"bytes\");\r\n                                let b64 = await getAudioBase64(chunk);\r\n\r\n                                if (b64 && page.wss) {\r\n                                    await page.wss.send(\"audio\", b64, undefined, undefined);\r\n                                }\r\n\r\n                                if (close) {\r\n                                    page.audioStream = undefined;\r\n                                }\r\n                            } catch (e) {\r\n                                console.error(\"Error sending audio chunk:\", e);\r\n                            }\r\n                        }\r\n\r\n                        function checkSilence() {\r\n                            let isSilent = isStreamSilent();\r\n                            let currentTime = Date.now();\r\n\r\n                            if (isSilent && !isCurrentlySilent) {\r\n                                // Just became silent\r\n                                isCurrentlySilent = true;\r\n                                silenceStartTime = currentTime;\r\n                            } else if (!isSilent && isCurrentlySilent) {\r\n                                // Just stopped being silent\r\n                                if (silenceStartTime) {\r\n                                    let silenceDuration = (currentTime - silenceStartTime) / 1000;\r\n                                    totalSilenceTime += silenceDuration;\r\n                                }\r\n                                isCurrentlySilent = false;\r\n                                silenceStartTime = null;\r\n                                silenceCount = 0; // Reset restart counter on speech\r\n                            }\r\n\r\n                            return isSilent;\r\n                        }\r\n\r\n                        mediaRecorder.ondataavailable = event => {\r\n                            try {\r\n                                if (event.data && event.data.size > 0) {\r\n                                    let isSilent = checkSilence();\r\n\r\n                                    if (!isSilent) {\r\n                                        chunks.push(event.data);\r\n                                        if (mediaStream && !mediaStream.getTracks().some(t => !t.enabled)) {\r\n                                            sendChunk(event.data);\r\n                                        }\r\n                                    } else {\r\n                                        silenceCount++;\r\n\r\n                                        // Check for auto-restart based on silence chunks\r\n                                        if (config.autoRestart && silenceCount >= config.maxSilenceBeforeRestart) {\r\n                                            console.log(\"Restarting recorder due to prolonged silence...\");\r\n                                            silenceCount = 0;\r\n\r\n                                            try {\r\n                                                mediaRecorder.stop();\r\n                                                setTimeout(() => {\r\n                                                    if (recorder && recorder.recorder && recorder.recorder.state === 'inactive') {\r\n                                                        mediaRecorder.start(config.chunkInterval);\r\n                                                    }\r\n                                                }, 100);\r\n                                            } catch (e) {\r\n                                                console.error(\"Error restarting recorder:\", e);\r\n                                            }\r\n                                        }\r\n\r\n                                        // Check for auto-stop based on total silence time\r\n                                        if (config.maxSilenceSeconds) {\r\n                                            let currentSilenceTime = isCurrentlySilent && silenceStartTime ?\r\n                                                (Date.now() - silenceStartTime) / 1000 : 0;\r\n                                            let totalCurrentSilence = totalSilenceTime + currentSilenceTime;\r\n\r\n                                            if (totalCurrentSilence >= config.maxSilenceSeconds) {\r\n                                                console.log(`Auto-stopping recording after ${totalCurrentSilence}s of silence`);\r\n                                                toggleRecord(); // Stop recording\r\n                                                return;\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                } else {\r\n                                    console.warn(\"No audio data in chunk\");\r\n                                }\r\n                            } catch (e) {\r\n                                console.error(\"Error processing audio data:\", e);\r\n                            }\r\n                        };\r\n\r\n                        mediaRecorder.onstop = () => {\r\n                            try {\r\n                                console.log(\"MediaRecorder stopped, processing\", chunks.length, \"chunks\");\r\n\r\n                                if (chunks.length === 0) {\r\n                                    console.warn(\"No audio chunks to process\");\r\n                                    return;\r\n                                }\r\n\r\n                                let audioBlob = new Blob(chunks, {\r\n                                    type: mediaRecorder.mimeType || 'audio/webm'\r\n                                });\r\n\r\n                                console.log(\"Created audio blob:\", audioBlob.size, \"bytes\");\r\n\r\n                                // Send final chunk if not streaming\r\n                                if (!mediaStream || mediaStream.getTracks().some(t => !t.enabled)) {\r\n                                    sendChunk(audioBlob, true);\r\n                                }\r\n\r\n                                // Save if handler provided\r\n                                if (saveHandler) {\r\n                                    getAudioBase64(audioBlob).then((b64) => {\r\n                                        if (b64) {\r\n                                            saveHandler(mediaRecorder.mimeType || \"audio/webm\", b64);\r\n                                        }\r\n                                    }).catch(e => {\r\n                                        console.error(\"Error saving audio:\", e);\r\n                                    });\r\n                                }\r\n\r\n                                chunks = []; // Clear chunks\r\n                            } catch (e) {\r\n                                console.error(\"Error in onstop handler:\", e);\r\n                            }\r\n                        };\r\n\r\n                        mediaRecorder.onerror = (event) => {\r\n                            console.error(\"MediaRecorder error:\", event.error);\r\n                            page.toast(\"error\", \"Recording error: \" + (event.error?.message || \"Unknown error\"));\r\n                        };\r\n\r\n                        // Initialize audio stream handler\r\n                        if (handler) {\r\n                            page.audioStream = newAudioStream(handler);\r\n                        }\r\n\r\n                        // Start recording\r\n                        try {\r\n                            mediaRecorder.start(config.chunkInterval);\r\n                            console.log(\"Recording started with config:\", config);\r\n                        } catch (e) {\r\n                            console.error(\"Error starting recorder:\", e);\r\n                            vnode.dom.textContent = \"Error: Could not start recording.\";\r\n                        }\r\n\r\n                    }).catch(err => {\r\n                        console.error('Error accessing microphone:', err);\r\n                        let errorMsg = \"Error: Could not access microphone.\";\r\n\r\n                        if (err.name === 'NotAllowedError') {\r\n                            errorMsg = \"Error: Microphone access denied. Please allow microphone access and try again.\";\r\n                        } else if (err.name === 'NotFoundError') {\r\n                            errorMsg = \"Error: No microphone found. Please check your audio devices.\";\r\n                        } else if (err.name === 'NotReadableError') {\r\n                            errorMsg = \"Error: Microphone is being used by another application.\";\r\n                        }\r\n\r\n                        vnode.dom.textContent = errorMsg;\r\n                        page.toast(\"error\", errorMsg);\r\n                    });\r\n            },\r\n\r\n            onremove: function () {\r\n                stopRecording();\r\n            }\r\n        });\r\n\r\n        return recorder?.view || \"\";\r\n    }\r\n\r\n    function newAudioStream(h) {\r\n        return {\r\n            onaudioupdate: (v) => {\r\n\r\n            },\r\n            onaudiosttupdate: (m) => {\r\n                if (h) {\r\n                    h(m);\r\n                }\r\n            },\r\n            onaudiouerror: (v) => {\r\n\r\n            }\r\n        };\r\n    }\r\n\r\n    function stopRecording() {\r\n        if (recorder) {\r\n            if (recorder.recorder) {\r\n                recorder.recorder.stop();\r\n            }\r\n            if (recorder.stream) {\r\n                recorder.stream.getTracks().forEach(track => track.stop());\r\n            }\r\n            if (recorder.motionAnalyzer) {\r\n                recorder.motionAnalyzer.destroy();\r\n            }\r\n            recorder = undefined;\r\n        }\r\n    }\r\n\r\n    function extractText(dataB64) {\r\n        window.dbgBase64 = dataB64;\r\n        let vprops = { \"audio_sample\": dataB64, \"uid\": page.uid() };\r\n        m.request({ method: 'POST', url: g_application_path + \"/rest/voice/stt\", withCredentials: true, body: vprops }).then((d) => {\r\n            console.log(\"Received\", d);\r\n        }).catch((x) => {\r\n            page.toast(\"error\", \"Failed to extract text from audio - is the audio service running?\");\r\n        });\r\n\r\n    }\r\n\r\n    function clearAudioSource() {\r\n        // console.error(\"Clear audio sources\");\r\n        for (let id in audioSource) {\r\n            let aud = audioSource[id];\r\n            if (aud && aud.started && aud.context.state != \"closed\") {\r\n                // aud.source.stop();\r\n                aud.context.close();\r\n            }\r\n        }\r\n        audioSource = {};\r\n        audioMap = {};\r\n\r\n    }\r\n    function unconfigureAudio(enabled) {\r\n        if (enabled) return;\r\n        //clearMagic8(true);\r\n        // console.info(\"Unconfiguring audio visualizers\");\r\n\r\n        upNext = [];\r\n        clearAudioSource();\r\n        for (let id in visualizers) {\r\n\r\n            if (visualizers[id]) {\r\n                if (!visualizers[id].pending && !visualizers[id].lateLoad) {\r\n                    visualizers[id].stop();\r\n                    visualizers[id].destroy();\r\n                }\r\n                delete visualizers[id];\r\n            }\r\n        }\r\n    }\r\n\r\n    function configureVisualizer(aud, autoPlay) {\r\n        let props = {\r\n            height: 60,\r\n            overlay: true,\r\n            bgAlpha: 0,\r\n            showBgColor: true,\r\n            showSource: false,\r\n            gradient: \"prism\",\r\n            showScaleY: false,\r\n            showScaleX: false\r\n        };\r\n\r\n        if (visualizers[aud.id] && !visualizers[aud.id].lateLoad) {\r\n            /// console.warn(\"Audio visualizer already configured for\", aud.id);\r\n            return;\r\n        }\r\n\r\n        visualizers[aud.id] = { pending: true };\r\n\r\n        let oM = getAudioMapForContainer(aud.id);\r\n        if (!oM) {\r\n            console.warn(\"Failed to find map for \" + aud.id);\r\n            console.warn(audioMap);\r\n            return;\r\n        }\r\n        console.info(\"Configuring audio visualizer for\", aud.id, oM.name);\r\n        //let cont = aud.parentNode;\r\n\r\n        createAudioSource(oM.name, oM.profileId, oM.content).then((o) => {\r\n            if (!o) {\r\n                console.warn(\"Failed to retrieve audio source\", oM.name);\r\n                console.warn(audioMap);\r\n                console.warn(audioSource);\r\n                return;\r\n            }\r\n            let props1 = Object.assign({ source: o.source, onclick: function () { togglePlayAudioSource(o); } }, props);\r\n            let audioMotion = new AudioMotionAnalyzer(aud, props1);\r\n            visualizers[aud.id] = audioMotion;\r\n            if (autoPlay || oM.autoPlay) {\r\n                if (getRunningAudioSources().length > 0) {\r\n                    upNext.push(o);\r\n                }\r\n                else {\r\n                    togglePlayAudioSource(o);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    function configureAudio(enabled) {\r\n        if (!enabled) {\r\n            // unconfigureAudio();\r\n            return;\r\n        }\r\n        //let aa = document.querySelectorAll(\"audio\");\r\n        let aa = document.querySelectorAll(\"div[id*='chatAudioContainer-']\");\r\n\r\n        for (let i = 0; i < aa.length; i++) {\r\n            let aud = aa[i];\r\n            if (visualizers[aud.id]) continue;\r\n            if (i < (aa.length - 2)) {\r\n                visualizers[aud.id] = { lateLoad: true };\r\n            }\r\n            else {\r\n                configureVisualizer(aud);\r\n            }\r\n        }\r\n    }\r\n\r\n    function getAudioMapForContainer(containerId) {\r\n        let aM = Object.values(audioMap).filter(k => k.containerId == containerId);\r\n        if (!aM.length) {\r\n            return;\r\n        }\r\n        return aM[0];\r\n    }\r\n\r\n    function getRunningAudioSources() {\r\n        return Object.values(audioSource).filter(aud => aud.started && aud.context.state == \"running\");\r\n    }\r\n\r\n    function stopAudioSources(aud) {\r\n        let running = getRunningAudioSources();\r\n\r\n        running.forEach(r => {\r\n            console.log(\"Stopping other audio sources\", r.id, aud?.id, (r.id != aud?.id), r);\r\n            if (!aud || r.id != aud.id) {\r\n                togglePlayAudioSource(r, false, true);\r\n            }\r\n        });\r\n    }\r\n\r\n\r\n    function togglePlayMagic8(aud, aud2) {\r\n        // console.log(\"Toggle play Magic8\", aud, aud2);\r\n        togglePlayAudioSource(aud, true);\r\n    }\r\n\r\n    function togglePlayAudioSource(aud, autoStop, noStart) {\r\n        if (autoStop) {\r\n            upNext = [];\r\n        }\r\n        if (typeof aud == \"string\") {\r\n            if (visualizers[aud] && visualizers[aud].lateLoad) {\r\n                console.log(\"Late configure visualizer\", aud);\r\n                stopAudioSources();\r\n                configureVisualizer(document.querySelectorAll(\"div[id*='\" + aud + \"']\")[0], true);\r\n                return;\r\n            }\r\n\r\n            let am = getAudioMapForContainer(aud);\r\n            if (am && audioSource[am.name]) {\r\n                aud = audioSource[am.name];\r\n            }\r\n\r\n        }\r\n        if (!aud) {\r\n            console.warn(\"Invalid audio reference\");\r\n            return;\r\n        }\r\n\r\n        if (autoStop) {\r\n            stopAudioSources(aud);\r\n        }\r\n        if(noStart){\r\n            return;\r\n        }\r\n        // console.warn(\"Starting audio source\", aud);\r\n        if (!aud.started) {\r\n            if(aud.context){\r\n                if (aud.context.state === \"suspended\") {\r\n                    aud.context.resume().then(() => {\r\n                        try { aud.source.start(0); } catch { }\r\n                        aud.started = true;\r\n                    });\r\n                } else if (aud.context.state === \"running\") {\r\n                    aud.source.start(0);\r\n                    aud.started = true;\r\n                } else {\r\n                    console.warn(\"Handle state \" + aud.context.state, audio.context);\r\n                }\r\n            }\r\n            else{\r\n                console.warn(\"Audio context not available\");\r\n            }\r\n\r\n            // Re-create the source node for every playback to avoid DOMException\r\n            aud.source = aud.context.createBufferSource();\r\n            aud.source.buffer = aud.buffer;\r\n            aud.source.connect(aud.context.destination);\r\n            aud.source.start(0);\r\n            aud.started = true;\r\n\r\n        } else if (aud.context.state == \"suspended\") {\r\n            console.log(\"Resume\");\r\n            aud.context.resume();\r\n        } else if (aud.context.state != \"closed\") {\r\n            console.log(\"Suspend\");\r\n            aud.context.suspend();\r\n        } else {\r\n            console.error(\"Handle state \" + aud.context.state);\r\n        }\r\n\r\n        aud.source.onended = function () {\r\n            aud.started = false;\r\n            if (upNext.length > 0) {\r\n                togglePlayAudioSource(upNext.shift());\r\n            }\r\n        };\r\n    }\r\n\r\n    function createAudioVisualizer(name, idx, profileId, autoPlay, content) {\r\n        let contId = \"chatAudioContainer-\" + (idx);\r\n        let aud = m(\"div\", { class: \"audio-container block w-full\", id: \"chatAudioContainer-\" + (idx), onclick: function () { togglePlayAudioSource(contId, true); } }, \"\");\r\n        if (!audioMap[name]) {\r\n            audioMap[name] = { id: page.uid(), index: idx, name, profileId, content, autoPlay, containerId: contId, pending: false };\r\n        }\r\n\r\n        return aud;\r\n    }\r\n\r\n    function base64ToArrayBuffer(base64) {\r\n        let cleanedBase64 = base64.replace(/^data:audio\\/\\w+;base64,/, '');\r\n\r\n        let binaryString = atob(cleanedBase64);\r\n        let len = binaryString.length;\r\n        let bytes = new Uint8Array(len);\r\n\r\n        for (let i = 0; i < len; i++) {\r\n            bytes[i] = binaryString.charCodeAt(i);\r\n        }\r\n\r\n        return bytes.buffer;\r\n    }\r\n\r\n    async function createAudioSource(name, profileId, content) {\r\n        if (content) {\r\n            /// Strip emojis out - https://stackoverflow.com/questions/10992921/how-to-remove-emoji-code-using-javascript\r\n            content = content.replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|[\\u2011-\\u26FF]|\\uD83E[\\uDD10-\\uDDFF])/g, \"\");\r\n            /// Escape quotes\r\n            content = content.replace(/[\"\\*]+/g, \"\");\r\n        }\r\n        let tmpAud;\r\n        if (!content || content.length == 0) {\r\n            console.warn(\"No content provided for audio source creation\");\r\n            return;\r\n        }\r\n        if (!audioMap[name]) {\r\n            tmpAud = audioMap[name] = { name, profileId, content, pending: false };\r\n        }\r\n        if (!audioMap[name].data && !audioMap[name].pending) {\r\n            audioMap[name].pending = true;\r\n            let vprops = { \"text\": content, \"speed\": 1.2, voiceProfileId: profileId };\r\n            if (!vprops.voiceProfileId) {\r\n                vprops.engine = \"piper\";\r\n                vprops.speaker = \"en_GB-alba-medium\";\r\n            }\r\n            console.log(\"Synthesize '\" + name + \"'\");\r\n            let d;\r\n            try {\r\n                d = await m.request({ method: 'POST', url: g_application_path + \"/rest/voice/\" + name, withCredentials: true, body: vprops });\r\n            }\r\n            catch (e) {\r\n                console.error(\"Error synthesizing audio:\", e);\r\n                console.error(vprops);\r\n            }\r\n            if (!audioMap[name]) {\r\n                console.error(\"Ruh-Roh, Raggy\");\r\n                audioMap[name] = tmpAud;\r\n            }\r\n            if (d) {\r\n                audioMap[name].data = d;\r\n                audioMap[name].pending = false;\r\n            }\r\n            else {\r\n                page.toast(\"error\", \"Failed to synthesize audio - is the audio service running?\");\r\n                audioMap[name].error = true;\r\n                audioMap[name].pending = false;\r\n            };\r\n        }\r\n\r\n        if (audioMap[name] && audioMap[name].data && !audioMap[name].error && !audioMap[name].pending) {\r\n\r\n            let o = audioMap[name].data;\r\n            if (!audioSource[name]) {\r\n                let audioContext = new AudioContext();\r\n                let audioBuffer = await audioContext.decodeAudioData(base64ToArrayBuffer(o.dataBytesStore));\r\n                let sourceNode = audioContext.createBufferSource();\r\n                sourceNode.buffer = audioBuffer;\r\n                audioSource[name] = {\r\n                    id: page.uid(),\r\n                    context: audioContext,\r\n                    buffer: audioBuffer,\r\n                    started: false,\r\n                    source: sourceNode\r\n                }\r\n            }\r\n        }\r\n        return audioSource[name];\r\n    }\r\n\r\n    let recording = false;\r\n\r\n    function toggleRecord() {\r\n        recording = !recording;\r\n    }\r\n\r\n    function recordButton() {\r\n        return m(\"button\", { class: \"button\", onclick: toggleRecord }, m(\"span\", { class: \"material-symbols-outlined material-icons-24\" }, \"adaptive_audio_mic\" + (recording ? \"\" : \"_off\")));\r\n    }\r\n\r\n    function recordField(ctl) {\r\n        if (!recognition) {\r\n            // Find the correct SpeechRecognition object for the browser\r\n            let SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\r\n\r\n            // Check if the browser supports the API\r\n            if (SpeechRecognition) {\r\n                recognition = new SpeechRecognition();\r\n\r\n                // --- Configuration ---\r\n                recognition.continuous = true; // Keep listening even after a pause\r\n                recognition.lang = 'en-US';    // Set the language\r\n                recognition.interimResults = true; // Get results as they are being spoken\r\n            } else {\r\n                // If not supported, check for specific browsers and show a message.\r\n                const ua = navigator.userAgent.toLowerCase();\r\n                if (ua.includes(\"firefox\")) {\r\n                    page.toast(\"info\", \"To enable speech-to-text, go to about:config and set media.webspeech.recognition.enable to true.\", 10000);\r\n                } else if (navigator.brave) {\r\n                     page.toast(\"info\", \"To enable speech-to-text in Brave, go to brave://settings/shields and set 'Fingerprinting blocking' to 'Standard' or 'Allow all'.\", 10000);\r\n                }\r\n\r\n                // If not supported, return an empty element so nothing is rendered.\r\n                return m.fragment(\"\");\r\n            }\r\n        }\r\n\r\n        // The rest of the function remains the same as it was correctly implemented in the previous step.\r\n\r\n        let currentHandler;\r\n        let finalTranscript = '';\r\n\r\n        return m('button.button', {\r\n            class: (recording ? 'active animate-pulse' : '') + \" p-1\",\r\n            onclick: function (e) {\r\n                if (recording) {\r\n                    recognition.stop();\r\n                    return;\r\n                }\r\n\r\n                let baseText = ctl(null);\r\n                if(baseText && baseText.length > 0) baseText += \" \";\r\n\r\n                recording = true;\r\n                finalTranscript = '';\r\n\r\n                recognition.onresult = (event) => {\r\n                    let interimTranscript = '';\r\n                    for (let i = event.resultIndex; i < event.results.length; ++i) {\r\n                        const transcript = event.results[i][0].transcript;\r\n                        if (event.results[i].isFinal) {\r\n                            finalTranscript += transcript.trim() + ' ';\r\n                            baseText += transcript.trim() + ' ';\r\n                        } else {\r\n                            interimTranscript += transcript;\r\n                        }\r\n                    }\r\n                    ctl(baseText + interimTranscript);\r\n                    m.redraw();\r\n                };\r\n\r\n                recognition.onend = () => {\r\n                    recording = false;\r\n                    m.redraw();\r\n                };\r\n                recognition.start();\r\n            },\r\n        }, m('span.material-symbols-outlined.material-icons-20', recording ? 'mic' : 'mic_off'));\r\n    }\r\n\r\n    let recognition;\r\n\r\n\r\n    \r\n    let toneCtx;\r\n    let leftOsc, rightOsc;\r\n    let leftGain, rightGain;\r\n    let masterGain;\r\n    let merger;\r\n    let baseFreq = 440;\r\n    let minBeat = 4;\r\n    let maxBeat = 6;\r\n    let sweepDurationMin = 10;\r\n    let sweepInterval;\r\n\r\n    function startBinauralSweep() {\r\n        if(!bgAudio){\r\n            return;\r\n        }\r\n        toneCtx = new (window.AudioContext || window.webkitAudioContext)();\r\n\r\n        // Oscillators\r\n        leftOsc = toneCtx.createOscillator();\r\n        rightOsc = toneCtx.createOscillator();\r\n\r\n        // Gains\r\n        leftGain = toneCtx.createGain();\r\n        rightGain = toneCtx.createGain();\r\n        masterGain = toneCtx.createGain();\r\n\r\n        let dcBlocker = toneCtx.createBiquadFilter();\r\n        dcBlocker.type = \"highpass\";\r\n        dcBlocker.frequency.value = 20; // 20 Hz blocks DC\r\n\r\n\r\n        // Set master gain to 0 before connecting\r\n        masterGain.gain.setValueAtTime(0, toneCtx.currentTime);\r\n\r\n        // Merger to route left/right to stereo\r\n        merger = toneCtx.createChannelMerger(2);\r\n\r\n        // Connect chains\r\n        leftOsc.connect(leftGain).connect(merger, 0, 0); // Left channel\r\n        rightOsc.connect(rightGain).connect(merger, 0, 1); // Right channel\r\n\r\n        // Connect merger to master gain\r\n        merger.connect(masterGain);\r\n\r\n        // Connect master gain to DC blocker\r\n        masterGain.connect(dcBlocker);\r\n\r\n        // Connect DC blocker to destination\r\n        dcBlocker.connect(toneCtx.destination);\r\n\r\n        // Set frequencies\r\n        leftOsc.frequency.setValueAtTime(baseFreq, toneCtx.currentTime);\r\n        rightOsc.frequency.setValueAtTime(baseFreq + maxBeat, toneCtx.currentTime);\r\n\r\n        // Start oscillators\r\n        leftOsc.start();\r\n        rightOsc.start();\r\n\r\n        // Now ramp gain up smoothly AFTER oscillators are started, with a slight delay\r\n        const rampTime = 0.5; // seconds\r\n        const targetVolume = 0.35;\r\n        const delay = 0.05; // 50ms delay\r\n\r\n        const startTime = toneCtx.currentTime + delay;\r\n        masterGain.gain.cancelScheduledValues(toneCtx.currentTime);\r\n        masterGain.gain.setValueAtTime(0, toneCtx.currentTime);\r\n        masterGain.gain.linearRampToValueAtTime(targetVolume, startTime + rampTime);\r\n\r\n        // Start the frequency sweep\r\n        scheduleSweep();\r\n        sweepInterval = setInterval(scheduleSweep, sweepDurationMin * 60 * 1000);\r\n    }\r\n\r\n    function stopBinauralSweep() {\r\n        if(!bgAudio){\r\n            return;\r\n        }\r\n\r\n        if (sweepInterval) clearInterval(sweepInterval);\r\n\r\n        if (masterGain && toneCtx) {\r\n            const now = toneCtx.currentTime;\r\n            masterGain.gain.cancelScheduledValues(now);\r\n            masterGain.gain.setValueAtTime(masterGain.gain.value, now);\r\n            masterGain.gain.linearRampToValueAtTime(0, now + 0.3); // ramp down over 0.3s\r\n\r\n            setTimeout(() => {\r\n                if (leftOsc) {\r\n                    try { leftOsc.stop(); } catch { }\r\n                    leftOsc.disconnect();\r\n                }\r\n                if (rightOsc) {\r\n                    try { rightOsc.stop(); } catch { }\r\n                    rightOsc.disconnect();\r\n                }\r\n                if (masterGain) masterGain.disconnect();\r\n                if (toneCtx) toneCtx.close();\r\n\r\n                leftOsc = rightOsc = leftGain = rightGain = masterGain = merger = toneCtx = null;\r\n            }, 320); // Wait for ramp down before stopping/disconnecting\r\n        } else {\r\n            // fallback: just stop everything\r\n            if (leftOsc) { try { leftOsc.stop(); } catch { } leftOsc.disconnect(); }\r\n            if (rightOsc) { try { rightOsc.stop(); } catch { } rightOsc.disconnect(); }\r\n            if (masterGain) masterGain.disconnect();\r\n            if (toneCtx) toneCtx.close();\r\n\r\n            leftOsc = rightOsc = leftGain = rightGain = masterGain = merger = toneCtx = null;\r\n        }\r\n    }\r\n\r\n    function scheduleSweep() {\r\n        const now = toneCtx.currentTime;\r\n        const halfCycle = (sweepDurationMin * 60) / 2;\r\n\r\n        rightOsc.frequency.cancelScheduledValues(now);\r\n        rightOsc.frequency.setValueAtTime(baseFreq + maxBeat, now);\r\n        rightOsc.frequency.linearRampToValueAtTime(baseFreq + minBeat, now + halfCycle);\r\n        rightOsc.frequency.linearRampToValueAtTime(baseFreq + maxBeat, now + 2 * halfCycle);\r\n    }\r\n    \r\n    /*\r\n    let toneCtx;\r\n    let leftOsc, rightOsc;\r\n    let leftGain, rightGain;\r\n    let merger;\r\n\r\n    function startBinauralSweep(baseFreq = 440, beatFreq = 4) {\r\n\r\n      toneCtx = new (window.AudioContext || window.webkitAudioContext)();\r\n\r\n      // Create two oscillators\r\n      leftOsc = toneCtx.createOscillator();\r\n      rightOsc = toneCtx.createOscillator();\r\n\r\n      // Left: base frequency, Right: base + beat frequency\r\n      leftOsc.frequency.value = baseFreq;\r\n      rightOsc.frequency.value = baseFreq + beatFreq;\r\n\r\n      // Create stereo panning\r\n      leftGain = toneCtx.createGain();\r\n      leftGain.gain.value = 0.2;\r\n      rightGain = toneCtx.createGain();\r\n    rightGain.gain.value = 0.2;\r\n      // Pan hard left/right\r\n      const splitter = toneCtx.createChannelSplitter(2);\r\n      const merger = toneCtx.createChannelMerger(2);\r\n\r\n      leftOsc.connect(leftGain);\r\n      rightOsc.connect(rightGain);\r\n\r\n      leftGain.connect(merger, 0, 0);  // left to left channel\r\n      rightGain.connect(merger, 0, 1); // right to right channel\r\n\r\n      merger.connect(toneCtx.destination);\r\n\r\n      // Start oscillators\r\n      leftOsc.start();\r\n      rightOsc.start();\r\n    }\r\n\r\n    function stopBinauralSweep() {\r\n        return;\r\n      if (leftOsc) leftOsc.stop();\r\n      if (rightOsc) rightOsc.stop();\r\n      if (toneCtx) toneCtx.close();\r\n    }\r\n    */\r\n    /// Registry for new audio source controllers (from audioComponents.js)\r\n    let audioSourceControllers = {};\r\n\r\n    function registerAudioSource(id, controller) {\r\n        audioSourceControllers[id] = controller;\r\n    }\r\n\r\n    function unregisterAudioSource(id) {\r\n        delete audioSourceControllers[id];\r\n    }\r\n\r\n    function stopAllAudioSourceControllers(except) {\r\n        Object.values(audioSourceControllers).forEach(controller => {\r\n            if (controller !== except && controller.isPlaying && controller.isPlaying()) {\r\n                controller.stop();\r\n            }\r\n        });\r\n    }\r\n\r\n    let audio = {\r\n        configureAudio,\r\n        unconfigureAudio,\r\n        togglePlayAudio,\r\n        createAudioVisualizer,\r\n        createAudioSource,\r\n        clearAudioSource: clearAudioSource,\r\n        hasAudioMap: (name) => audioMap[name] ? true : false,\r\n        recordButton,\r\n        recordField,\r\n        recordWithVisualizer,\r\n        extractText,\r\n        recording: () => recording,\r\n        configureMagic8,\r\n        getMagic8View,\r\n        clearMagic8,\r\n        startBinauralSweep,\r\n        stopBinauralSweep,\r\n        stopAudioSources,\r\n        // New audio component integration\r\n        registerAudioSource,\r\n        unregisterAudioSource,\r\n        stopAllAudioSourceControllers,\r\n        component: {\r\n\r\n            oncreate: function (x) {\r\n\r\n            },\r\n            oninit: function () {\r\n\r\n            },\r\n            onupdate: function () {\r\n\r\n            },\r\n            view: function (x) {\r\n                return renderRecordButton();\r\n            }\r\n\r\n        }\r\n    };\r\n\r\n    page.components.audio = audio;\r\n\r\n}());\r\n\n\n;/* === client/components/audioComponents.js === */\n(function () {\r\n    /**\r\n     * Simple hash function for generating stable identifiers from content\r\n     */\r\n    function simpleHash(str) {\r\n        let hash = 0;\r\n        if (!str || str.length === 0) return hash.toString(36);\r\n        for (let i = 0; i < str.length; i++) {\r\n            let char = str.charCodeAt(i);\r\n            hash = ((hash << 5) - hash) + char;\r\n            hash = hash & hash; // Convert to 32bit integer\r\n        }\r\n        return Math.abs(hash).toString(36);\r\n    }\r\n\r\n    /**\r\n     * AudioSource Component - Manages audio playback with Web Audio API\r\n     *\r\n     * Features:\r\n     * - Handles audio synthesis and buffering\r\n     * - Manages playback state (play/pause/stop)\r\n     * - Recreates buffer source nodes for replay (since they're one-shot)\r\n     * - Provides analyzer node for visualization\r\n     * - Auto-stops other audio sources when playing (optional)\r\n     */\r\n\r\n    function createAudioSource(attrs) {\r\n        let state = {\r\n            id: attrs.id || page.uid(),\r\n            name: attrs.name,\r\n            profileId: attrs.profileId,\r\n            content: attrs.content,\r\n            context: null,\r\n            buffer: null,\r\n            sourceNode: null,\r\n            analyzerNode: null,\r\n            isPlaying: false,\r\n            isLoading: false,\r\n            error: null,\r\n            onPlayStateChange: attrs.onPlayStateChange || (() => {}),\r\n            autoStopOthers: attrs.autoStopOthers !== false\r\n        };\r\n\r\n        async function synthesizeAudio() {\r\n            if (!state.content || state.content.length === 0) {\r\n                state.error = \"No content provided\";\r\n                return false;\r\n            }\r\n\r\n            state.isLoading = true;\r\n            state.error = null;\r\n            m.redraw();\r\n\r\n            try {\r\n                //console.log(\"Synthesizing audio for:\", state.name);\r\n\r\n                // Clean content (remove emojis, quotes, etc.)\r\n                let cleanContent = state.content\r\n                    .replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|[\\u2011-\\u26FF]|\\uD83E[\\uDD10-\\uDDFF])/g, \"\")\r\n                    .replace(/[\"\\*]+/g, \"\");\r\n\r\n                // Prepare voice synthesis request\r\n                let vprops = {\r\n                    text: cleanContent,\r\n                    speed: 1.2,\r\n                    voiceProfileId: state.profileId\r\n                };\r\n\r\n                if (!vprops.voiceProfileId) {\r\n                    vprops.engine = \"piper\";\r\n                    vprops.speaker = \"en_GB-alba-medium\";\r\n                }\r\n\r\n                //console.log(\"Requesting synthesis with props:\", vprops);\r\n\r\n                // Request audio synthesis\r\n                let response = await m.request({\r\n                    method: 'POST',\r\n                    url: g_application_path + \"/rest/voice/\" + state.name,\r\n                    withCredentials: true,\r\n                    body: vprops\r\n                });\r\n\r\n                //console.log(\"Synthesis response received for:\", state.name);\r\n\r\n                // Create audio context and decode\r\n                state.context = new AudioContext();\r\n                state.analyzerNode = state.context.createAnalyser();\r\n                state.analyzerNode.fftSize = 2048;\r\n                state.analyzerNode.smoothingTimeConstant = 0.8;\r\n\r\n                // Decode audio data\r\n                let arrayBuffer = base64ToArrayBuffer(response.dataBytesStore);\r\n                state.buffer = await state.context.decodeAudioData(arrayBuffer);\r\n\r\n                //console.log(\"Audio decoded successfully for:\", state.name);\r\n\r\n                state.isLoading = false;\r\n                m.redraw();\r\n                return true;\r\n\r\n            } catch (err) {\r\n                console.error(\"Error synthesizing audio for\", state.name, \":\", err);\r\n                state.error = err.message || \"Failed to synthesize audio\";\r\n                state.isLoading = false;\r\n                m.redraw();\r\n                return false;\r\n            }\r\n        }\r\n\r\n        function base64ToArrayBuffer(base64) {\r\n            let cleanedBase64 = base64.replace(/^data:audio\\/\\w+;base64,/, '');\r\n            let binaryString = atob(cleanedBase64);\r\n            let len = binaryString.length;\r\n            let bytes = new Uint8Array(len);\r\n            for (let i = 0; i < len; i++) {\r\n                bytes[i] = binaryString.charCodeAt(i);\r\n            }\r\n            return bytes.buffer;\r\n        }\r\n\r\n        function createSourceNode() {\r\n            if (!state.context || !state.buffer) {\r\n                console.warn(\"Cannot create source node: context or buffer missing\");\r\n                return null;\r\n            }\r\n\r\n            // Create new buffer source (required for replay)\r\n            let source = state.context.createBufferSource();\r\n            source.buffer = state.buffer;\r\n\r\n            // Connect: source -> analyzer -> destination\r\n            source.connect(state.analyzerNode);\r\n            state.analyzerNode.connect(state.context.destination);\r\n\r\n            // Handle playback end\r\n            source.onended = () => {\r\n                state.isPlaying = false;\r\n                state.sourceNode = null;\r\n                state.onPlayStateChange(false);\r\n                m.redraw();\r\n            };\r\n\r\n            return source;\r\n        }\r\n\r\n        async function play() {\r\n            // Auto-stop other audio sources (both old and new systems)\r\n            if (state.autoStopOthers) {\r\n                if (page.components.audio) {\r\n                    // Stop old system audio sources\r\n                    page.components.audio.stopAudioSources();\r\n                    // Stop new system audio source controllers\r\n                    page.components.audio.stopAllAudioSourceControllers(api);\r\n                }\r\n            }\r\n\r\n            // Load audio if not already loaded\r\n            if (!state.buffer && !state.isLoading) {\r\n                let success = await synthesizeAudio();\r\n                if (!success) {\r\n                    console.error(\"Failed to synthesize audio for:\", state.name);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Wait for loading to complete\r\n            if (state.isLoading) {\r\n                console.warn(\"Audio is still loading:\", state.name);\r\n                return;\r\n            }\r\n\r\n            // If already playing, don't start again\r\n            if (state.isPlaying) {\r\n                console.warn(\"Audio is already playing:\", state.name);\r\n                return;\r\n            }\r\n\r\n            // Ensure we have a context\r\n            if (!state.context) {\r\n                console.error(\"No audio context available\");\r\n                return;\r\n            }\r\n\r\n            // Resume context if suspended\r\n            if (state.context.state === \"suspended\") {\r\n                await state.context.resume();\r\n            }\r\n\r\n            // Always create a new source node (Web Audio API requirement)\r\n            state.sourceNode = createSourceNode();\r\n            if (!state.sourceNode) {\r\n                console.error(\"Failed to create source node\");\r\n                return;\r\n            }\r\n\r\n            // Start playback\r\n            try {\r\n                state.sourceNode.start(0);\r\n                state.isPlaying = true;\r\n                state.onPlayStateChange(true);\r\n                m.redraw();\r\n            } catch (err) {\r\n                console.error(\"Error starting audio:\", err, state.name);\r\n                state.isPlaying = false;\r\n                state.sourceNode = null;\r\n            }\r\n        }\r\n\r\n        function pause() {\r\n            if (state.context && state.context.state === \"running\") {\r\n                state.context.suspend();\r\n                state.isPlaying = false;\r\n                state.onPlayStateChange(false);\r\n                m.redraw();\r\n            }\r\n        }\r\n\r\n        function resume() {\r\n            if (state.context && state.context.state === \"suspended\") {\r\n                state.context.resume();\r\n                state.isPlaying = true;\r\n                state.onPlayStateChange(true);\r\n                m.redraw();\r\n            }\r\n        }\r\n\r\n        function stop() {\r\n            if (state.sourceNode) {\r\n                try {\r\n                    state.sourceNode.stop();\r\n                } catch (e) {\r\n                    // May already be stopped\r\n                }\r\n                state.sourceNode = null;\r\n            }\r\n            if (state.context && state.context.state !== \"closed\") {\r\n                state.context.suspend();\r\n            }\r\n            state.isPlaying = false;\r\n            state.onPlayStateChange(false);\r\n            m.redraw();\r\n        }\r\n\r\n        function togglePlayPause() {\r\n            // console.log(\"togglePlayPause called on audio source:\", state.name, \"isPlaying:\", state.isPlaying);\r\n            if (state.isPlaying) {\r\n                pause();\r\n            } else if (state.context && state.context.state === \"suspended\" && state.sourceNode) {\r\n                resume();\r\n            } else {\r\n                play();\r\n            }\r\n        }\r\n\r\n        function destroy() {\r\n            stop();\r\n            if (state.context && state.context.state !== \"closed\") {\r\n                state.context.close();\r\n            }\r\n            // Unregister from audio system\r\n            if (page.components.audio && page.components.audio.unregisterAudioSource) {\r\n                page.components.audio.unregisterAudioSource(state.id);\r\n            }\r\n            state.context = null;\r\n            state.buffer = null;\r\n            state.sourceNode = null;\r\n            state.analyzerNode = null;\r\n        }\r\n\r\n        let api = {\r\n            state,\r\n            play,\r\n            pause,\r\n            resume,\r\n            stop,\r\n            togglePlayPause,\r\n            destroy,\r\n            getAnalyzerNode: () => state.analyzerNode,\r\n            getContext: () => state.context,\r\n            isPlaying: () => state.isPlaying,\r\n            isLoading: () => state.isLoading,\r\n            hasError: () => state.error !== null\r\n        };\r\n\r\n        // Register with audio system\r\n        if (page.components.audio && page.components.audio.registerAudioSource) {\r\n            page.components.audio.registerAudioSource(state.id, api);\r\n            // console.log(\"Registered audio source:\", state.id, \"name:\", state.name);\r\n        }\r\n\r\n        return api;\r\n    }\r\n\r\n\r\n    /**\r\n     * AudioVisualizer Component - Mithril component for audio visualization\r\n     *\r\n     * Features:\r\n     * - Uses AudioMotionAnalyzer for visualization\r\n     * - Click to play/pause\r\n     * - Configurable appearance\r\n     * - Auto-cleanup on remove\r\n     */\r\n\r\n    function AudioVisualizer() {\r\n        function tryCreateVisualizer(vnode, attrs) {\r\n            if (vnode.state.visualizer) return; // Already created\r\n\r\n            // Use the current audioSource from attrs\r\n            let currentAudioSource = attrs.audioSource || vnode.state.audioSourceController;\r\n            if (!currentAudioSource) {\r\n                return;\r\n            }\r\n\r\n            let analyzerNode = currentAudioSource.getAnalyzerNode();\r\n            if (!analyzerNode) {\r\n                // Analyzer not ready yet, will retry\r\n                return;\r\n            }\r\n\r\n            // Use calculated height from DOM or provided height\r\n            let height = vnode.state.calculatedHeight || attrs.height || 60;\r\n\r\n            // Default visualizer properties\r\n            let props = {\r\n                source: analyzerNode,\r\n                height: height,\r\n                overlay: true,\r\n                bgAlpha: attrs.bgAlpha !== undefined ? attrs.bgAlpha : 0,\r\n                gradient: attrs.gradient || 'prism',\r\n                showBgColor: attrs.showBgColor !== undefined ? attrs.showBgColor : true,\r\n                showSource: false,\r\n                showScaleY: false,\r\n                showScaleX: false,\r\n                ...(attrs.visualizerProps || {})\r\n            };\r\n\r\n            try {\r\n                vnode.state.visualizer = new AudioMotionAnalyzer(vnode.dom, props);\r\n                //console.log(\"AudioMotionAnalyzer created successfully for audio source:\", currentAudioSource.state.name, \"height:\", height);\r\n\r\n                // Clear the check interval once created\r\n                if (vnode.state.checkInterval) {\r\n                    clearInterval(vnode.state.checkInterval);\r\n                    vnode.state.checkInterval = null;\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Error creating AudioMotionAnalyzer:\", err);\r\n            }\r\n        }\r\n\r\n        return {\r\n            oncreate: function(vnode) {\r\n                let attrs = vnode.attrs;\r\n\r\n                // Store state on vnode.state to prevent sharing between component instances\r\n                vnode.state.visualizer = null;\r\n                vnode.state.checkInterval = null;\r\n                vnode.state.audioSourceController = attrs.audioSource;\r\n\r\n                if (!vnode.state.audioSourceController) {\r\n                    console.warn(\"AudioVisualizer: No audio source provided\");\r\n                    return;\r\n                }\r\n\r\n                // Calculate actual height from DOM element if not specified\r\n                let actualHeight = attrs.height;\r\n                if (!actualHeight && vnode.dom) {\r\n                    actualHeight = vnode.dom.clientHeight;\r\n                }\r\n\r\n                // Store calculated height for visualizer creation\r\n                vnode.state.calculatedHeight = actualHeight || 60;\r\n\r\n                // Try to create visualizer immediately\r\n                tryCreateVisualizer(vnode, attrs);\r\n\r\n                // If not ready, check periodically until analyzer is available\r\n                if (!vnode.state.visualizer) {\r\n                    vnode.state.checkInterval = setInterval(() => {\r\n                        tryCreateVisualizer(vnode, attrs);\r\n                    }, 100);\r\n                }\r\n            },\r\n\r\n            onremove: function(vnode) {\r\n                // Clear check interval if still running\r\n                if (vnode.state.checkInterval) {\r\n                    clearInterval(vnode.state.checkInterval);\r\n                    vnode.state.checkInterval = null;\r\n                }\r\n\r\n                // Destroy visualizer if created\r\n                if (vnode.state.visualizer) {\r\n                    try {\r\n                        vnode.state.visualizer.stop();\r\n                        vnode.state.visualizer.destroy();\r\n                    } catch (err) {\r\n                        console.warn(\"Error destroying visualizer:\", err);\r\n                    }\r\n                    vnode.state.visualizer = null;\r\n                }\r\n            },\r\n\r\n            view: function(vnode) {\r\n                let attrs = vnode.attrs;\r\n                let cssClass = \"audio-visualizer \" + (attrs.class || \"\");\r\n\r\n                return m(\"div\", {\r\n                    class: cssClass,\r\n                    style: attrs.style || \"\",\r\n                    onclick: (e) => {\r\n                        e.stopPropagation();\r\n                        // Always use the current audioSource from attrs, not the cached one\r\n                        let currentAudioSource = attrs.audioSource;\r\n                        if (currentAudioSource) {\r\n                            //console.log(\"AudioVisualizer clicked, audio source ID:\", currentAudioSource.state.id, \"name:\", currentAudioSource.state.name);\r\n                            //console.log(\"About to call togglePlayPause on:\", currentAudioSource.state.name);\r\n                            currentAudioSource.togglePlayPause();\r\n                        } else {\r\n                            console.warn(\"AudioVisualizer clicked but no audio source available\");\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        };\r\n    }\r\n\r\n\r\n    /**\r\n     * SimpleAudioPlayer Component - Complete audio player with visualizer\r\n     *\r\n     * Combines AudioSource controller and AudioVisualizer component\r\n     * for easy integration with play/pause/delete controls\r\n     */\r\n\r\n    function SimpleAudioPlayer() {\r\n        return {\r\n            oninit: function(vnode) {\r\n                let attrs = vnode.attrs;\r\n\r\n                // console.log(\"SimpleAudioPlayer oninit - ID:\", attrs.id, \"Name:\", attrs.name, \"Key:\", attrs.key);\r\n\r\n                // Store state on vnode.state to prevent sharing between component instances\r\n                vnode.state.visualizer = null;\r\n                vnode.state.checkInterval = null;\r\n                vnode.state.autoPlayInitiated = false;\r\n\r\n                // Create audio source controller and store on vnode.state\r\n                vnode.state.audioSource = createAudioSource({\r\n                    id: attrs.id,\r\n                    name: attrs.name,\r\n                    profileId: attrs.profileId,\r\n                    content: attrs.content,\r\n                    autoStopOthers: attrs.autoStopOthers,\r\n                    onPlayStateChange: (isPlaying) => {\r\n                        if (attrs.onPlayStateChange) {\r\n                            attrs.onPlayStateChange(isPlaying);\r\n                        }\r\n                        m.redraw();\r\n                    }\r\n                });\r\n\r\n                // console.log(\"SimpleAudioPlayer created audio source:\", vnode.state.audioSource.state.name);\r\n            },\r\n\r\n            oncreate: function(vnode) {\r\n                let attrs = vnode.attrs;\r\n                // console.log(\"SimpleAudioPlayer oncreate - ID:\", attrs.id, \"Looking for element:\", attrs.id + \"-viz\");\r\n\r\n                // Auto-load audio (synthesize without playing) if requested\r\n                if ((attrs.autoLoad || attrs.autoPlay) && !vnode.state.audioSource.state.buffer && !vnode.state.audioSource.state.isLoading) {\r\n                    // console.log(\"Auto-loading audio for:\", vnode.state.audioSource.state.name);\r\n                    // Trigger synthesis by calling the internal synthesizeAudio\r\n                    // We need to access the internal state, so let's just trigger a play and immediately pause\r\n                    setTimeout(async () => {\r\n                        if (vnode.state.audioSource && !vnode.state.audioSource.state.buffer) {\r\n                            // Manually call synthesize\r\n                            let state = vnode.state.audioSource.state;\r\n                            if (!state.content || state.content.length === 0) {\r\n                                return;\r\n                            }\r\n\r\n                            state.isLoading = true;\r\n                            state.error = null;\r\n                            m.redraw();\r\n\r\n                            try {\r\n                                // console.log(\"Synthesizing audio for:\", state.name);\r\n                                let cleanContent = state.content\r\n                                    .replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|[\\u2011-\\u26FF]|\\uD83E[\\uDD10-\\uDDFF])/g, \"\")\r\n                                    .replace(/[\"\\*]+/g, \"\");\r\n\r\n                                let vprops = {\r\n                                    text: cleanContent,\r\n                                    speed: 1.2,\r\n                                    voiceProfileId: state.profileId\r\n                                };\r\n\r\n                                if (!vprops.voiceProfileId) {\r\n                                    vprops.engine = \"piper\";\r\n                                    vprops.speaker = \"en_GB-alba-medium\";\r\n                                }\r\n\r\n                                let response = await m.request({\r\n                                    method: 'POST',\r\n                                    url: g_application_path + \"/rest/voice/\" + state.name,\r\n                                    withCredentials: true,\r\n                                    body: vprops\r\n                                });\r\n\r\n                                state.context = new AudioContext();\r\n                                state.analyzerNode = state.context.createAnalyser();\r\n                                state.analyzerNode.fftSize = 2048;\r\n                                state.analyzerNode.smoothingTimeConstant = 0.8;\r\n\r\n                                let arrayBuffer = base64ToArrayBuffer(response.dataBytesStore);\r\n                                state.buffer = await state.context.decodeAudioData(arrayBuffer);\r\n\r\n                                //console.log(\"Audio decoded successfully for:\", state.name);\r\n                                state.isLoading = false;\r\n                                m.redraw();\r\n                            } catch (err) {\r\n                                console.error(\"Error synthesizing audio for\", state.name, \":\", err);\r\n                                state.error = err.message || \"Failed to synthesize audio\";\r\n                                state.isLoading = false;\r\n                                m.redraw();\r\n                            }\r\n                        }\r\n                    }, 50);\r\n                }\r\n\r\n                // Auto-play if requested (only once on first oncreate)\r\n                if (attrs.autoPlay && !vnode.state.autoPlayInitiated) {\r\n                    vnode.state.autoPlayInitiated = true;\r\n                    //console.log(\"Initiating auto-play for:\", vnode.state.audioSource.state.name);\r\n                    setTimeout(() => {\r\n                        if (vnode.state.audioSource) {\r\n                            vnode.state.audioSource.play();\r\n                        }\r\n                    }, attrs.autoPlayDelay || 100);\r\n                }\r\n\r\n                function base64ToArrayBuffer(base64) {\r\n                    let cleanedBase64 = base64.replace(/^data:audio\\/\\w+;base64,/, '');\r\n                    let binaryString = atob(cleanedBase64);\r\n                    let len = binaryString.length;\r\n                    let bytes = new Uint8Array(len);\r\n                    for (let i = 0; i < len; i++) {\r\n                        bytes[i] = binaryString.charCodeAt(i);\r\n                    }\r\n                    return bytes.buffer;\r\n                }\r\n\r\n                // Create visualizer for this specific audio source\r\n                let tryCreateVisualizer = () => {\r\n                    if (vnode.state.visualizer) {\r\n                        //console.log(\"Visualizer already exists for:\", vnode.state.audioSource.state.name);\r\n                        return;\r\n                    }\r\n\r\n                    let analyzerNode = vnode.state.audioSource.getAnalyzerNode();\r\n                    if (!analyzerNode) {\r\n                        //console.log(\"No analyzer node yet for:\", vnode.state.audioSource.state.name);\r\n                        return; // Not ready yet\r\n                    }\r\n\r\n                    let vizElement = document.getElementById(attrs.id + \"-viz\");\r\n                    if (!vizElement) {\r\n                        //console.warn(\"No viz element found for ID:\", attrs.id + \"-viz\");\r\n                        return;\r\n                    }\r\n\r\n                    //console.log(\"Creating AudioMotionAnalyzer for:\", vnode.state.audioSource.state.name, \"on element:\", attrs.id + \"-viz\");\r\n\r\n                    let props = {\r\n                        source: analyzerNode,\r\n                        height: attrs.height || 60,\r\n                        overlay: true,\r\n                        bgAlpha: attrs.bgAlpha !== undefined ? attrs.bgAlpha : 0,\r\n                        gradient: attrs.gradient || 'prism',\r\n                        showBgColor: attrs.showBgColor !== undefined ? attrs.showBgColor : true,\r\n                        showSource: false,\r\n                        showScaleY: false,\r\n                        showScaleX: false,\r\n                        ...(attrs.visualizerProps || {})\r\n                    };\r\n\r\n                    try {\r\n                        vnode.state.visualizer = new AudioMotionAnalyzer(vizElement, props);\r\n                        // console.log(\"AudioMotionAnalyzer successfully created for:\", vnode.state.audioSource.state.name, \"Element ID:\", attrs.id + \"-viz\");\r\n\r\n                        if (vnode.state.checkInterval) {\r\n                            clearInterval(vnode.state.checkInterval);\r\n                            vnode.state.checkInterval = null;\r\n                        }\r\n                    } catch (err) {\r\n                        console.error(\"Error creating AudioMotionAnalyzer:\", err);\r\n                    }\r\n                };\r\n\r\n                // Try immediately\r\n                tryCreateVisualizer();\r\n\r\n                // If not ready, check periodically\r\n                if (!vnode.state.visualizer) {\r\n                    vnode.state.checkInterval = setInterval(tryCreateVisualizer, 100);\r\n                }\r\n            },\r\n\r\n            onremove: function(vnode) {\r\n                // Clean up interval if still running\r\n                if (vnode.state.checkInterval) {\r\n                    clearInterval(vnode.state.checkInterval);\r\n                    vnode.state.checkInterval = null;\r\n                }\r\n\r\n                // Clean up visualizer\r\n                if (vnode.state.visualizer) {\r\n                    try {\r\n                        vnode.state.visualizer.destroy();\r\n                    } catch (e) {\r\n                        console.error(\"Error destroying visualizer:\", e);\r\n                    }\r\n                    vnode.state.visualizer = null;\r\n                }\r\n\r\n                // Clean up audio source\r\n                if (vnode.state.audioSource) {\r\n                    vnode.state.audioSource.destroy();\r\n                    vnode.state.audioSource = null;\r\n                }\r\n            },\r\n\r\n            view: function(vnode) {\r\n                let attrs = vnode.attrs;\r\n                let audioSource = vnode.state.audioSource;\r\n\r\n                if (!audioSource) {\r\n                    return m(\"div\", { class: \"audio-player-error min-h-[60px] flex items-center justify-center\" },\r\n                        \"Audio player not initialized\"\r\n                    );\r\n                }\r\n\r\n                if (audioSource.hasError()) {\r\n                    return m(\"div\", {\r\n                        class: \"audio-player-error min-h-[60px] flex items-center justify-center gap-2 text-red-500\"\r\n                    }, [\r\n                        m(\"span\", { class: \"material-icons text-sm\" }, \"error\"),\r\n                        m(\"span\", { class: \"text-xs\" }, \"Failed to load audio\")\r\n                    ]);\r\n                }\r\n\r\n                if (audioSource.isLoading()) {\r\n                    return m(\"div\", {\r\n                        class: \"audio-player-loading min-h-[60px] flex items-center justify-center gap-2\"\r\n                    }, [\r\n                        m(\"span\", { class: \"material-icons text-sm animate-spin\" }, \"refresh\"),\r\n                        m(\"span\", { class: \"text-xs\" }, \"Loading...\")\r\n                    ]);\r\n                }\r\n\r\n                let isPlaying = audioSource.isPlaying();\r\n\r\n                return m(\"div\", {\r\n                    class: (attrs.visualizerClass || \"\") + \" audio-player-container relative block rounded-lg overflow-hidden\",\r\n                    style: `height: ${attrs.height || 60}px; min-width: 80%;`,\r\n                    key: attrs.id + \"-container\"\r\n                }, [\r\n                    // Visualizer div - AudioMotionAnalyzer will be created directly on this element\r\n                    m(\"div\", {\r\n                        key: attrs.id + \"-viz\",\r\n                        id: attrs.id + \"-viz\",\r\n                        class: \"w-full h-full block cursor-pointer\",\r\n                        style: attrs.visualizerStyle || \"\",\r\n                        onclick: (e) => {\r\n                            e.stopPropagation();\r\n                            console.log(\"Visualizer div clicked - Element ID:\", attrs.id + \"-viz\");\r\n                            if (vnode.state.audioSource) {\r\n                                console.log(\"  Audio source name:\", vnode.state.audioSource.state.name);\r\n                                console.log(\"  Audio source ID:\", vnode.state.audioSource.state.id);\r\n                                console.log(\"  Has visualizer:\", !!vnode.state.visualizer);\r\n                                vnode.state.audioSource.togglePlayPause();\r\n                            } else {\r\n                                console.error(\"  No audio source in vnode.state!\");\r\n                            }\r\n                        }\r\n                    }),\r\n\r\n                    // Small controls overlay in bottom-right corner\r\n                    m(\"div\", {\r\n                        key: attrs.id + \"-controls\",\r\n                        class: \"absolute bottom-2 right-2 flex items-center gap-2 z-10\"\r\n                    }, [\r\n                        // Play/Pause indicator (small icon, semi-transparent)\r\n                        m(\"div\", {\r\n                            class: \"p-1 rounded-full bg-black/30 dark:bg-white/30\",\r\n                            title: isPlaying ? \"Playing\" : \"Paused\"\r\n                        }, m(\"span\", { class: \"material-icons text-base text-white\" }, isPlaying ? \"volume_up\" : \"volume_off\")),\r\n\r\n                        // Delete button (if onDelete provided)\r\n                        attrs.onDelete && m(\"button\", {\r\n                            class: \"audio-control-btn p-1 rounded-full bg-red-500/70 hover:bg-red-600 transition-colors\",\r\n                            onclick: (e) => {\r\n                                e.stopPropagation();\r\n                                if (audioSource) {\r\n                                    audioSource.stop();\r\n                                }\r\n                                attrs.onDelete();\r\n                            },\r\n                            title: \"Delete audio\"\r\n                        }, m(\"span\", { class: \"material-icons text-base text-white\" }, \"close\"))\r\n                    ])\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n\r\n    /**\r\n     * Magic8Ball Component - Dual audio visualizer in a circular design\r\n     *\r\n     * Shows two audio sources (typically assistant and user) in a split-circle\r\n     * visualization with profile images as background\r\n     */\r\n\r\n    function Magic8Ball() {\r\n        let audioSource1 = null;  // Top/Assistant\r\n        let audioSource2 = null;  // Bottom/User\r\n        let lastContentHash = null;\r\n        let backgroundImages = [];\r\n        let imageBaseGroupsLoaded = false;\r\n        let hasAutoPlayedForHash = {};  // Track which content hashes have auto-played\r\n\r\n        function getContentHash(messages) {\r\n            if (!messages || !messages.length) return null;\r\n            let lastTwo = messages.slice(-2);\r\n            return lastTwo.map(m => m?.content || \"\").join(\"|\");\r\n        }\r\n\r\n        // Create or get existing audio source for a message\r\n        function getOrCreateAudioSource(name, profId, content, role) {\r\n            // Check if we already have this audio source\r\n            let existingSource = (role === \"assistant\") ? audioSource1 : audioSource2;\r\n            if (existingSource && existingSource.state.name === name) {\r\n                console.log(\"Reusing existing audio source:\", name);\r\n                return existingSource;\r\n            }\r\n\r\n            // Destroy old source for this role if it exists with different name\r\n            if (existingSource) {\r\n                console.log(\"Destroying old audio source for role:\", role, \"old name:\", existingSource.state.name);\r\n                existingSource.destroy();\r\n            }\r\n\r\n            console.log(\"Creating new audio source:\", name);\r\n            return createAudioSource({\r\n                id: name,\r\n                name: name,\r\n                profileId: profId,\r\n                content: content,\r\n                autoStopOthers: true,\r\n                onPlayStateChange: () => {\r\n                    if (window.m && window.m.redraw) {\r\n                        window.m.redraw();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        function setupAudioSources(vnode, shouldAutoPlay) {\r\n            let attrs = vnode.attrs;\r\n            let messages = attrs.messages || [];\r\n\r\n            if (!messages.length) {\r\n                return;\r\n            }\r\n\r\n            // Process last 2 messages (or just 1 if that's all we have)\r\n            let messagesToProcess = messages.slice(-2);\r\n            let sysProfileId = attrs.systemProfileId;\r\n            let usrProfileId = attrs.userProfileId;\r\n            let prune = attrs.pruneContent || ((c) => c);\r\n\r\n            // Create audio source controllers (reuse if same name)\r\n            messagesToProcess.forEach((msg) => {\r\n                if (!msg) return;\r\n\r\n                let content = prune(msg.content);\r\n                if (!content || content.length === 0) return;\r\n\r\n                let contentHash = simpleHash(content);\r\n                let name = attrs.instanceId + \"-\" + msg.role + \"-\" + contentHash;\r\n                let profId = (msg.role === \"assistant\") ? sysProfileId : usrProfileId;\r\n\r\n                let audioSource = getOrCreateAudioSource(name, profId, content, msg.role);\r\n\r\n                if (msg.role === \"assistant\") {\r\n                    audioSource1 = audioSource;\r\n                } else {\r\n                    audioSource2 = audioSource;\r\n                }\r\n            });\r\n\r\n            // Auto-play the most recent message only if:\r\n            // 1. shouldAutoPlay is true (first view or content changed)\r\n            // 2. We haven't already auto-played for this content hash\r\n            let currentHash = getContentHash(messages);\r\n            if (shouldAutoPlay && !hasAutoPlayedForHash[currentHash]) {\r\n                hasAutoPlayedForHash[currentHash] = true;\r\n                // console.log(\"Auto-playing for content hash:\", currentHash);\r\n\r\n                setTimeout(() => {\r\n                    if (messagesToProcess.length > 0) {\r\n                        let lastMsg = messagesToProcess[messagesToProcess.length - 1];\r\n                        if (lastMsg.role === \"assistant\" && audioSource1) {\r\n                            audioSource1.play();\r\n                        } else if (lastMsg.role === \"user\" && audioSource2) {\r\n                            audioSource2.play();\r\n                        }\r\n                    }\r\n                }, 100);\r\n            }\r\n        }\r\n\r\n        return {\r\n            oninit: function(vnode) {\r\n                // Initialize state on vnode.state\r\n                vnode.state.bgImageIndex = 0;\r\n                vnode.state.bgAnimationInterval = null;\r\n                vnode.state.imageA_src = null;\r\n                vnode.state.imageB_src = null;\r\n                vnode.state.isA_onTop = false;\r\n                vnode.state.isTransitioning = false;\r\n                vnode.state.initialized = false;\r\n            },\r\n\r\n            oncreate: function(vnode) {\r\n                let attrs = vnode.attrs;\r\n                let messages = attrs.messages || [];\r\n                let contentHash = getContentHash(messages);\r\n\r\n                if (!messages.length) {\r\n                    return;\r\n                }\r\n\r\n                lastContentHash = contentHash;\r\n                vnode.state.initialized = true;\r\n\r\n                // Load background images from group IDs if not in profile mode\r\n                let useProfile = attrs.useProfile !== false;\r\n                let sysUrl = attrs.systemProfileImageUrl;\r\n                let usrUrl = attrs.userProfileImageUrl;\r\n\r\n                if (!useProfile && !sysUrl && !usrUrl && attrs.imageBaseGroups && attrs.imageBaseGroups.length > 0 && !imageBaseGroupsLoaded) {\r\n                    imageBaseGroupsLoaded = true;\r\n                    console.log(\"Loading Magic8Ball background images from groups:\", attrs.imageBaseGroups);\r\n\r\n                    let q = am7client.newQuery(\"data.data\");\r\n                    let qg = q.field(null, null);\r\n                    qg.comparator = \"group_or\";\r\n                    qg.fields = attrs.imageBaseGroups.map((groupId) => {\r\n                        return {\r\n                            name: \"groupId\",\r\n                            comparator: \"equals\",\r\n                            value: groupId\r\n                        };\r\n                    });\r\n                    q.range(0, 0);\r\n\r\n                    page.search(q).then((res) => {\r\n                        if (res && res.results) {\r\n                            backgroundImages = res.results.map((r) => {\r\n                                return g_application_path + \"/media/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + r.groupPath + \"/\" + r.name;\r\n                            });\r\n\r\n                            console.log(\"Loaded\", backgroundImages.length, \"background images for Magic8Ball\");\r\n\r\n                            if (backgroundImages.length > 0) {\r\n                                vnode.state.imageA_src = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];\r\n                                vnode.state.imageB_src = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];\r\n                                m.redraw();\r\n                            }\r\n                        }\r\n                    }).catch((err) => {\r\n                        console.error(\"Error loading Magic8Ball background images:\", err);\r\n                    });\r\n                }\r\n\r\n                // Setup audio sources and auto-play (first time = true)\r\n                setupAudioSources(vnode, true);\r\n            },\r\n\r\n            onupdate: function(vnode) {\r\n                let attrs = vnode.attrs;\r\n                let messages = attrs.messages || [];\r\n                let contentHash = getContentHash(messages);\r\n\r\n                // Only process if content has actually changed\r\n                if (contentHash !== lastContentHash) {\r\n                    console.log(\"Magic8Ball content changed from\", lastContentHash, \"to\", contentHash);\r\n                    lastContentHash = contentHash;\r\n\r\n                    // Setup audio sources and auto-play (content changed = true)\r\n                    setupAudioSources(vnode, true);\r\n                }\r\n                // If content is the same, don't do anything - don't recreate or auto-play\r\n            },\r\n\r\n            onremove: function() {\r\n                // Clean up audio sources\r\n                if (audioSource1) {\r\n                    audioSource1.destroy();\r\n                    audioSource1 = null;\r\n                }\r\n                if (audioSource2) {\r\n                    audioSource2.destroy();\r\n                    audioSource2 = null;\r\n                }\r\n            },\r\n\r\n            view: function(vnode) {\r\n                let attrs = vnode.attrs;\r\n                let sysUrl = attrs.systemProfileImageUrl;\r\n                let usrUrl = attrs.userProfileImageUrl;\r\n\r\n                console.log(\"Magic8Ball view - sysUrl:\", sysUrl, \"usrUrl:\", usrUrl, \"bgImages:\", backgroundImages.length);\r\n\r\n                // Image transition handler (called on image load)\r\n                let imageTransition = () => {\r\n                    if (vnode.state.isTransitioning || backgroundImages.length === 0) return;\r\n                    vnode.state.isTransitioning = true;\r\n\r\n                    setTimeout(() => {\r\n                        if (vnode.state.isA_onTop) {\r\n                            vnode.state.imageA_src = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];\r\n                        } else {\r\n                            vnode.state.imageB_src = backgroundImages[Math.floor(Math.random() * backgroundImages.length)];\r\n                        }\r\n                        vnode.state.isA_onTop = !vnode.state.isA_onTop;\r\n                        vnode.state.isTransitioning = false;\r\n                        m.redraw();\r\n                    }, 3000);\r\n                };\r\n\r\n                let imageClasses = 'absolute top-0 left-0 w-full h-full rounded-full object-cover transition-all ease-in-out duration-300';\r\n\r\n                return m(\"div\", {\r\n                    key: \"magic8-container\",\r\n                    class: `\r\n                        relative aspect-square w-[90vw] max-w-[800px] max-h-[800px] mx-auto\r\n                        rounded-full overflow-hidden\r\n                        ring-2 ring-white/20\r\n                    `\r\n                }, [\r\n                    // Background images with crossfade if no profile images\r\n                    !sysUrl && !usrUrl && backgroundImages.length > 0 && m(\"div\", {\r\n                        class: \"absolute top-0 left-0 w-full h-full rounded-full overflow-hidden\",\r\n                        style: \"z-index: 0;\"\r\n                    }, [\r\n                        // Image A\r\n                        vnode.state.imageA_src && m(\"img\", {\r\n                            key: \"bg-A\",\r\n                            src: vnode.state.imageA_src,\r\n                            class: `${imageClasses} ${vnode.state.isA_onTop && vnode.state.isTransitioning ? 'opacity-0 blur-md' : 'opacity-50 blur-0'}`,\r\n                            loading: \"eager\",\r\n                            onload: !vnode.state.isA_onTop ? imageTransition : null,\r\n                            onerror: () => {\r\n                                console.error(\"Failed to load image:\", vnode.state.imageA_src);\r\n                                imageTransition();\r\n                            }\r\n                        }),\r\n                        // Image B\r\n                        vnode.state.imageB_src && m(\"img\", {\r\n                            key: \"bg-B\",\r\n                            src: vnode.state.imageB_src,\r\n                            class: `${imageClasses} ${!vnode.state.isA_onTop && vnode.state.isTransitioning ? 'opacity-0 blur-md' : 'opacity-50 blur-0'}`,\r\n                            loading: \"eager\",\r\n                            onload: vnode.state.isA_onTop ? imageTransition : null,\r\n                            onerror: () => {\r\n                                console.error(\"Failed to load image:\", vnode.state.imageB_src);\r\n                                imageTransition();\r\n                            }\r\n                        })\r\n                    ]),\r\n\r\n                    // System (assistant) profile image - upper hemisphere\r\n                    sysUrl && m(\"img\", {\r\n                        class: `\r\n                            absolute top-0 left-0 w-full h-1/2 z-0\r\n                            pointer-events-none opacity-60 blur-sm object-cover\r\n                        `,\r\n                        src: sysUrl,\r\n                        loading: \"eager\",\r\n                        style: \"object-position: top center;\"\r\n                    }),\r\n\r\n                    // User profile image - lower hemisphere\r\n                    usrUrl && m(\"img\", {\r\n                        class: `\r\n                            absolute bottom-0 left-0 w-full h-1/2 z-0\r\n                            pointer-events-none opacity-60 blur-sm object-cover\r\n                        `,\r\n                        src: usrUrl,\r\n                        loading: \"eager\",\r\n                        style: \"object-position: top center;\"\r\n                    }),\r\n\r\n                    // Top visualizer (assistant)\r\n                    audioSource1 && m(AudioVisualizer, {\r\n                        audioSource: audioSource1,\r\n                        class: \"absolute top-0 left-0 w-full h-1/2 z-10\",\r\n                        visualizerProps: {\r\n                            overlay: true,\r\n                            bgAlpha: 0,\r\n                            gradient: 'prism',\r\n                            showBgColor: true,\r\n                            showSource: false,\r\n                            showScaleY: false,\r\n                            showScaleX: false\r\n                        }\r\n                    }),\r\n\r\n                    // Bottom visualizer (user, inverted)\r\n                    audioSource2 && m(AudioVisualizer, {\r\n                        audioSource: audioSource2,\r\n                        class: \"absolute bottom-0 left-0 w-full h-1/2 z-10 transform scale-y-[-1]\",\r\n                        visualizerProps: {\r\n                            overlay: true,\r\n                            bgAlpha: 0,\r\n                            gradient: 'prism',\r\n                            showBgColor: true,\r\n                            showSource: false,\r\n                            showScaleY: false,\r\n                            showScaleX: false\r\n                        }\r\n                    }),\r\n\r\n                    // Overlay effects\r\n                    m(\"div\", {\r\n                        class: \"absolute inset-0 rounded-full pointer-events-none\"\r\n                    })\r\n                ]);\r\n            }\r\n        };\r\n    }\r\n\r\n\r\n    // Export to page.components\r\n    if (!page.components.audioComponents) {\r\n        page.components.audioComponents = {};\r\n    }\r\n\r\n    page.components.audioComponents = {\r\n        createAudioSource,\r\n        AudioVisualizer,\r\n        SimpleAudioPlayer,\r\n        Magic8Ball,\r\n        simpleHash\r\n    };\r\n\r\n}());\r\n\n\n;/* === client/components/camera.js === */\n(function () {\r\n    let isCapturing =  false;\r\n    let isInitialized = false;\r\n    let videoEl = null;\r\n    let deviceInit = false;\r\n    let videoDevices = [];\r\n    let selectedDeviceId = null;\r\n    let API_ENDPOINT = g_application_path + '/rest/face/analyze';\r\n    let CAPTURE_INTERVAL_SECONDS = 5;\r\n    let captureIntervalId = 0;\r\n    am7model.models.push(\r\n    {\r\n        name: \"cameraOptions\", icon: \"camera\", fields: [\r\n            {\r\n                name: \"device\",\r\n                label: \"Device\",\r\n                type: 'list',\r\n                limit: []\r\n            }\r\n        ]\r\n    });\r\n\r\n    am7model.forms.cameraOptions = {\r\n        label: \"Camera Options\",\r\n        fields: {\r\n            device: {\r\n                layout: 'full'\r\n            }\r\n        }\r\n    };\r\n\r\n    function videoElement(){\r\n        return document.querySelector('#facecam');\r\n    }\r\n\r\n     async function initializeAndFindDevices(fCaptureHandler) {\r\n        if(deviceInit){\r\n            return;\r\n        }\r\n        deviceInit = true;\r\n        let stream;\r\n\r\n        try {\r\n            stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n        } catch (err) {\r\n            console.error(\"Initial permission error:\", err);\r\n            return;\r\n        }\r\n\r\n        stream.getTracks().forEach(track => track.stop());\r\n\r\n        try {\r\n            const devices = await navigator.mediaDevices.enumerateDevices();\r\n            videoDevices = devices.filter(device => device.kind === 'videoinput');\r\n            \r\n            if (videoDevices.length > 0) {\r\n                selectedDeviceId = videoDevices[0].deviceId;\r\n                isInitialized = true;\r\n                am7model.getModelField(\"cameraOptions\", \"device\").limit = videoDevices.map(device => (device.label));\r\n                if(videoDevices.length > 1){\r\n                    console.log(\"Multiple cameras found, prompting user to select.\");\r\n                    pickCamera(fCaptureHandler);\r\n                }\r\n                else{\r\n                    console.log(\"Single camera found, starting capture.\");\r\n                    startCapture(fCaptureHandler);\r\n                }\r\n            } else {\r\n                page.toast(\"warn\", \"No webcams found.\");\r\n            }\r\n        } catch (err) {\r\n            page.toast(\"error\", \"Error finding devices.\");\r\n            console.error(\"Device enumeration error:\", err);\r\n        }\r\n\r\n    }\r\n\r\n    function pickCamera(fCaptureHandler){\r\n        let entity = am7model.newPrimitive(\"cameraOptions\");\r\n        let inst = am7model.prepareInstance(entity, am7model.forms.cameraOptions);\r\n        let cfg = {\r\n            label: \"Camera Options\",\r\n            entityType: \"cameraOptions\",\r\n            size: 50,\r\n            data: {entity, inst},\r\n            confirm: async function (data) {\r\n                let selectedLabel = data.entity.device;\r\n                console.log(\"Camera selected:\", selectedLabel);\r\n                if (!selectedLabel || typeof selectedLabel !== 'string') {\r\n                    page.toast(\"error\", \"Please select a camera device.\");\r\n                    page.components.dialog.endDialog();\r\n                    return;\r\n                }\r\n                let device = videoDevices.find(d => d.label.toLowerCase() === selectedLabel.toLowerCase());\r\n                if(device){\r\n                    selectedDeviceId = device.deviceId;\r\n                    startCapture(fCaptureHandler);\r\n                }\r\n                else{\r\n                    page.toast(\"error\", \"Selected camera not found: \" + selectedLabel);\r\n                }\r\n                page.components.dialog.endDialog();\r\n            },\r\n            cancel: async function (data) {\r\n                page.components.dialog.endDialog();\r\n            }\r\n        };\r\n        page.components.dialog.setDialog(cfg);\r\n    }\r\n\r\n    async function startCapture(fCaptureHandler) {\r\n        console.log(\"Starting capture with selected camera.\");\r\n        if (!selectedDeviceId) {\r\n            page.toast(\"warn\", \"Please select a camera first.\");\r\n            return;\r\n        }\r\n        if(isCapturing) {\r\n            page.toast(\"warn\", \"Capture is already in progress.\");\r\n            return;\r\n        }\r\n\r\n        isCapturing = true;\r\n        let videoEl = videoElement();\r\n        if(!videoEl){\r\n            page.toast(\"error\", \"Video element not found.\");\r\n            return;\r\n        }\r\n        if (videoEl.srcObject) {\r\n            videoEl.srcObject.getTracks().forEach(track => track.stop());\r\n        }\r\n\r\n        const constraints = { video: { deviceId: { exact: selectedDeviceId } } };\r\n                \r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n            videoEl.srcObject = stream;\r\n            videoEl.onplaying = () => {\r\n                captureIntervalId = setInterval(\r\n                    () => captureAndSend(fCaptureHandler), \r\n                    CAPTURE_INTERVAL_SECONDS * 1000\r\n                );\r\n            };\r\n        } catch (err) {\r\n            isCapturing = false;\r\n            console.error(\"getUserMedia error:\", err);\r\n            page.toast(\"error\", \"getUserMedia error:\", err);\r\n        }\r\n    }\r\n    let capturing = false;\r\n    async function captureAndSend(fCaptureHandler) {\r\n        let videoEl = videoElement();\r\n        if (!videoEl || videoEl.paused || videoEl.ended) {\r\n            return;\r\n        }\r\n        if(capturing){\r\n            return;\r\n        }\r\n        capturing = true;\r\n\r\n        try {\r\n            if (!videoEl.videoWidth || !videoEl.videoHeight) {\r\n                return;\r\n            }\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = videoEl.videoWidth;\r\n            canvas.height = videoEl.videoHeight;\r\n            const context = canvas.getContext('2d');\r\n            context.drawImage(videoEl, 0, 0, canvas.width, canvas.height);\r\n\r\n            const imageData = canvas.toDataURL('image/jpeg', 0.9);\r\n\r\n            let resp = await m.request({\r\n                method: 'POST',\r\n                url: API_ENDPOINT,\r\n                withCredentials: true,\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: { image_data: imageData }\r\n            });\r\n            if(fCaptureHandler && typeof fCaptureHandler === 'function') {\r\n                fCaptureHandler(resp);\r\n            }\r\n        } catch(err) {\r\n            console.warn(\"Face analysis request failed:\", err?.message || err);\r\n        } finally {\r\n            capturing = false;\r\n        }\r\n    }\r\n    let camera = {\r\n        devices: ()=> videoDevices,\r\n        deviceId: ()=> selectedDeviceId,\r\n        setCaptureInterval: function(seconds) {\r\n            if (seconds > 0) CAPTURE_INTERVAL_SECONDS = seconds;\r\n        },\r\n        startCapture,\r\n        stopCapture: function(){\r\n            if (captureIntervalId) {\r\n                clearInterval(captureIntervalId);\r\n                captureIntervalId = 0;\r\n            }\r\n            let videoEl = videoElement();\r\n            if (videoEl && videoEl.srcObject) {\r\n                videoEl.srcObject.getTracks().forEach(track => track.stop());\r\n            }\r\n            isCapturing = false;\r\n            capturing = false;\r\n        },\r\n        videoView: ()=>  m('video#facecam', { autoplay: true, muted: true, playsinline: true, class: \"absolute top-0 left-0 opacity-0\", style: \"width: 1px; height: 1px;\" }),\r\n        cameraListView: () => m('select', {class: \"select-field-full\", onchange: e => { selectedDeviceId = e.target.value; }, disabled: isCapturing, value: selectedDeviceId},\r\n            videoDevices.map(device => \r\n                m('option', { value: device.deviceId }, device.label || `Camera (${device.deviceId.slice(0, 8)})`)\r\n            )\r\n        ),\r\n        cameraPickButton: () => m('button', {onclick: startCapture, disabled: isCapturing},'Start'),\r\n        initializeAndFindDevices,\r\n        captureFrame: function() {\r\n            let videoEl = videoElement();\r\n            if (!videoEl || videoEl.paused || videoEl.ended) return null;\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = videoEl.videoWidth;\r\n            canvas.height = videoEl.videoHeight;\r\n            const context = canvas.getContext('2d');\r\n            context.drawImage(videoEl, 0, 0, canvas.width, canvas.height);\r\n            return canvas.toDataURL('image/jpeg', 0.9);\r\n        },\r\n    };\r\n\r\n    page.components.camera = camera;\r\n\r\n}());\r\n\n\n;/* === client/view/main.js === */\n(function(){\r\n    const mainPage = {};\r\n    let vnode;\r\n    let nodeMain;\r\n\r\n    mainPage.view = {\r\n        oninit : function(x){\r\n\r\n        },\r\n        oncreate : function (x) {\r\n            nodeMain = document.querySelector(\"div.content-main\");\r\n        },\r\n        onremove : function(x){\r\n            //if(app) app.destroy();\r\n        },\r\n\r\n        view: function () {\r\n            //console.log(\"Render main\");\r\n            vnode = [m(\"div\",{class : \"content-outer\"},[\r\n                m(page.components.navigation),\r\n                m(\"div\",{class : \"content-main\"},[\r\n                    page.contentRouter()\r\n                ])\r\n            ]), page.components.dialog.loadDialog(), page.loadToast()];\r\n            return vnode;\r\n        }\r\n    };\r\n\r\n    page.views.main = mainPage.view;\r\n}());\r\n\n\n;/* === client/view/sig.js === */\n(function(){\r\n    const signInPage = {};\r\n    let vnode;\r\n\r\n    am7model.models.push({\r\n        name: \"login\",\r\n        icon: \"login\",\r\n        label: \"Login\",\r\n        fields: [\r\n            {name: \"organization\", default: \"/Public\", type: \"string\"},\r\n            {name: \"userName\", type: \"string\", \"rules\": [\"$notEmpty\"]},\r\n            {name: \"password\", type: \"string\", \"rules\": [\"$notEmpty\"]},\r\n            {name: \"specifyOrganizationPath\", type: \"string\"}\r\n        ]\r\n    });\r\n\r\n    /// Option chain: ?.\r\n    /// Null coalesce: ?? (eg: let x = null ?? prop)\r\n    /// Promise.allSettled\r\n\r\n    am7model.forms.login = {\r\n        label : \"Login\",\r\n        commands : {\r\n            login : {\r\n                label : 'Login',\r\n                icon : 'login',\r\n                action : 'login'\r\n            }\r\n        },\r\n        fields: {\r\n            organization: {\r\n                layout: \"full\",\r\n                format: \"list\",\r\n                values : [\"/Public\", \"/Development\", \"/System\"]\r\n            },\r\n            userName: {\r\n                layout: \"full\",\r\n                label: \"Name\"\r\n            },\r\n            password: {\r\n                layout: \"full\",\r\n                label: \"Password\",\r\n                type: \"password\"\r\n            }\r\n        }\r\n    };\r\n \r\n    let inst = am7model.newInstance(\"login\", am7model.forms.login);\r\n    window.dbgInst = inst;\r\n    inst.action(\"login\", doLogin);\r\n\r\n    function doLogin(){\r\n        if(!inst.validate()){\r\n            page.toast(\"warn\", \"Please fill in all fields\");\r\n            return;\r\n        }\r\n        uwm.login(inst.api.organization(), inst.api.userName(), inst.api.password(), 0, function(s){\r\n            if(s == null){\r\n                page.toast(\"error\", \"Login was unsuccessful\");\r\n            }\r\n            else{\r\n                page.toast(\"info\", \"Logged in as \" + s.name);\r\n                page.router.refresh();\r\n            }\r\n            \r\n        });\r\n        inst.api.password(\"\");\r\n    }\r\n    \r\n    let organizations = [\"Specify ...\",\"/Public\",\"/Development\",\"/System\"];\r\n\r\n    function toggleSpecify(){\r\n        let oSel = document.querySelector(\"#selOrganizationList\");\r\n        let i = oSel.selectedIndex;\r\n        if(i == -1){\r\n            i = 1;\r\n        }\r\n        document.querySelector(\"#specifyOrganizationPath\").style.display = ((i == 0) ? \"block\" : \"none\");\r\n    }\r\n\r\n    function orgFieldDesigner(i, e, v){\r\n        return m(\"div\",[\r\n            m(\"label\",{\r\n            class : \"block\",\r\n            for : \"organization\"\r\n            },[\r\n            \"Organization\"\r\n            ]),\r\n            organizationField()\r\n        ]);\r\n    }\r\n\r\n    function organizationField(){\r\n        return [\r\n            m(\"select\", {id: \"selOrganizationList\", onchange: inst.handleChange(\"organization\", toggleSpecify), class: \"w-full page-select reactive-arrow\"},\r\n                organizations.map((o, i)=>m(\"option\",{value:o,selected:(o==inst.api.organization())}, o)),\r\n            ),\r\n            m(\"input\",{\r\n                class : \"hidden text-field-full\",\r\n                type : \"text\",\r\n                id : \"specifyOrganizationPath\",\r\n                onchange: inst.handleChange(\"organization\"),\r\n                placeholder : \"/Custom\"\r\n            }) \r\n        ];\r\n    }\r\n\r\n    inst.designer(\"organization\", orgFieldDesigner);\r\n    inst.viewProperties(\"password\", { onkeydown : function(e){ if (e.which == 13) doLogin(); }});\r\n    inst.viewProperties(\"userName\", { autocapitalize  : \"off\" });\r\n\r\n \r\n    \r\n    signInPage.view = {\r\n        oninit : function(x){\r\n\r\n        },\r\n        oncreate : function (x) {\r\n            //document.querySelector(\"#selOrganizationList\").selectedIndex = 1;\r\n           /// toggleSpecify();\r\n            // app = page.space(entityName, x, entity);\r\n\r\n        },\r\n        onremove : function(x){\r\n\r\n        },\r\n\r\n        view: function () {\r\n            vnode = m(\"div\",{\r\n                class : \"screen-center-gray\"\r\n            },[\r\n                m(\"div\",{\r\n                    class : \"box-shadow-white\"\r\n                },[\r\n                    am7view.form(inst), page.loadToast()\r\n                ])\r\n                \r\n            ]);\r\n\r\n            return vnode;\r\n        }\r\n    };\r\n\r\n    page.views.sig = signInPage.view;\r\n}());\r\n\n\n;/* === client/view/saur.js === */\n(function(){\r\n    const authenticatedPage = {};\r\n    let vnode;\r\n    let entityName = \"sig\";\r\n    let app;\r\n    let entity = {\r\n\r\n    };\r\n    authenticatedPage.view = {\r\n        oninit : function(x){\r\n            // console.log(x);\r\n        },\r\n        oncreate : function (x) {\r\n            app = page.space(entityName, x, entity);\r\n        },\r\n        onremove : function(x){\r\n            if(app) app.destroy();\r\n        },\r\n\r\n        view: function () {\r\n            vnode = m(\"div\",{\r\n                class : \"screen-center-gray\"\r\n                , \"avoid\" : 1\r\n            },[\r\n  \r\n            ]);\r\n            return vnode;\r\n        }\r\n    };\r\n\r\n    page.views.saur = authenticatedPage.view;\r\n}());\r\n\n\n;/* === client/view/list.js === */\n(function () {\r\n\r\n  function newListControl() {\r\n\r\n    const listPage = {};\r\n    let app;\r\n    let wentBack = false;\r\n    let carousel = false;\r\n    let gridMode = 0;\r\n    let fullMode = false;\r\n    let maxMode = false;\r\n    let info = true;\r\n    let listType;\r\n    let baseListType;\r\n    let listContainerId;\r\n    let navContainerId = null;\r\n    let navFilter = null;\r\n    let pickerMode = false;\r\n    let embeddedMode = false;\r\n    let embeddedController;\r\n    let pickerHandler;\r\n    let pickerCancel;\r\n    let containerMode = false;\r\n    let defaultRecordCount = 10;\r\n    let defaultIconRecordCount = 40;\r\n    let modType;\r\n    let infiniteScroll = false;\r\n    let showFooter = false;\r\n    let showIconFooter = false;\r\n    let navigateByParent = false;\r\n    let systemList = false;\r\n    let pagination = page.pagination();\r\n\r\n    let dnd;\r\n    let taggingInProgress = false;\r\n\r\n    function textField(sClass, id, plc, fKeyHandler) {\r\n      return m(\"input\", { placeholder: plc, onkeydown: fKeyHandler, id: id, type: \"text\", class: sClass });\r\n    }\r\n\r\n    function addNew() {\r\n      let pg = pagination.pages();\r\n      if (embeddedMode && embeddedController && embeddedController.addNew) {\r\n        console.info(\"Embedded add\");\r\n        embeddedController.addNew(pg.resultType, pg.containerId);\r\n      }\r\n      else {\r\n        let path = \"/\" + (m.route.get().match(/plist/) ? \"pnew\" : \"new\") + \"/\" + pg.resultType + \"/\" + pg.containerId;\r\n        console.info(\"Path\", path);\r\n        /// Note: Adding a key because cycling through the same view with different objects needs a full DOM rebuild to correctly disconnect the sync code\r\n        ///\r\n        m.route.set(path, { key: Date.now() });\r\n      }\r\n    }\r\n\r\n    function getSelected() {\r\n      let pages = pagination.pages();\r\n      return pages.pageResults[pages.currentPage].filter((v) => { return (pages.pageState[v.objectId] && pages.pageState[v.objectId].checked); })\r\n    }\r\n\r\n    function getSelectedIndices() {\r\n      let pages = pagination.pages();\r\n      let aRes = pages.pageResults[pages.currentPage];\r\n      let aSel = [];\r\n      Object.keys(pages.pageState).forEach((k) => {\r\n        if (pages.pageState[k].checked) {\r\n          let idx = aRes.findIndex((v) => v.objectId === k);\r\n          if (idx > -1) aSel.push(idx);\r\n        }\r\n      });\r\n      return aSel;\r\n    }\r\n\r\n    function getType(o) {\r\n      return (o[am7model.jsonModelKey] ? o[am7model.jsonModelKey] : listType);\r\n    }\r\n\r\n    function editItem(o) {\r\n      if (!o || o == null) {\r\n        console.error(\"Invalid object\");\r\n        return;\r\n      }\r\n      if (embeddedMode && embeddedController && embeddedController.addNew) {\r\n        embeddedController.editItem(o);\r\n      }\r\n      else {\r\n        m.route.set(\"/view/\" + getType(o) + \"/\" + o.objectId);\r\n      }\r\n    }\r\n\r\n    function editSelected() {\r\n      let idx = getSelectedIndices();\r\n      if (idx.length) {\r\n        let pages = pagination.pages();\r\n        editItem(pages.pageResults[pages.currentPage][idx[0]]);\r\n      }\r\n    }\r\n    async function deleteSelected() {\r\n      let contType = pagination.pages().containerType;\r\n      let subType = pagination.pages().containerSubType;\r\n      let bBucket = (subType && subType.match(/^(bucket|account|person)$/gi));\r\n      let label = (bBucket ? \"Remove\" : \"Delete\");\r\n      page.components.dialog.confirm(label + \" selected objects?\", async function () {\r\n        let idx = getSelectedIndices();\r\n        if (idx.length) {\r\n          let pages = pagination.pages();\r\n          let aP = [];\r\n          for (let i = 0; i < idx.length; i++) {\r\n            let obj = pages.pageResults[pages.currentPage][idx[i]];\r\n\r\n            if (bBucket) {\r\n              aP.push(page.member(contType, listContainerId, getType(obj), obj.objectId, false).then((r) => { if(r) page.toast(\"success\", \"Removed member\"); else page.toast(\"error\", \"Failed to remove member\"); }));\r\n            }\r\n            else {\r\n              aP.push(page.deleteObject(getType(obj), obj.objectId).then((r) => { if(r) page.toast(\"success\", \"Deleted object\"); else page.toast(\"error\", \"Failed to delete object\"); }));\r\n            }\r\n          }\r\n          await Promise.all(aP);\r\n          pagination.new();\r\n          m.redraw();\r\n        }\r\n      });\r\n\r\n    }\r\n\r\n    async function applyTagsToList() {\r\n      if (taggingInProgress) {\r\n        return;\r\n      }\r\n\r\n      let pages = pagination.pages();\r\n      if (!pages.containerId || !pages.container) {\r\n        page.toast(\"error\", \"No container selected\");\r\n        return;\r\n      }\r\n\r\n      let groupId = pages.container.id;\r\n      if (!groupId) {\r\n        page.toast(\"error\", \"Container does not have a valid group ID\");\r\n        return;\r\n      }\r\n\r\n      let q = am7client.newQuery(\"data.data\");\r\n      q.field(\"groupId\", groupId);\r\n      q.entity.request = [\"id\", \"objectId\", \"name\", \"contentType\"];\r\n      q.range(0, 500);\r\n\r\n      page.toast(\"info\", \"Searching for images...\");\r\n      let qr = await page.search(q);\r\n\r\n      if (!qr || !qr.results || !qr.results.length) {\r\n        page.toast(\"warn\", \"No data found in this group\");\r\n        return;\r\n      }\r\n\r\n      let images = qr.results.filter(r => r.contentType && r.contentType.match(/^image\\//i));\r\n      if (!images.length) {\r\n        page.toast(\"warn\", \"No images found in this group\");\r\n        return;\r\n      }\r\n\r\n      taggingInProgress = true;\r\n      m.redraw();\r\n\r\n      page.components.dialog.batchProgress(\"Tag Images\", images, async function(img){\r\n        let tags = await page.applyImageTags(img.objectId);\r\n        return tags;\r\n      }, function(state){\r\n        taggingInProgress = false;\r\n        m.redraw();\r\n      });\r\n    }\r\n\r\n    function closeSelected() {\r\n      carousel = false;\r\n      pagination.pages().currentItem = undefined;\r\n      //pagination.new();\r\n      m.redraw();\r\n    }\r\n\r\n    function openSelected() {\r\n\r\n      /// open first selected\r\n      page.components.pdf.clear();\r\n      let idx = getSelectedIndices();\r\n      if (idx.length) {\r\n        carousel = true;\r\n        pagination.pages().currentItem = idx[0];\r\n        m.redraw();\r\n      }\r\n\r\n      /// Opens to multiple windows\r\n      /// pagination.routeToResult();\r\n    }\r\n    function navigateUp() {\r\n      let pages = pagination.pages();\r\n      if (pages.container) {\r\n        let type = listType;\r\n        if (type) {\r\n          type = modType.type || type;\r\n        }\r\n        let path;\r\n        if (type === 'auth.group') {\r\n          path = pages.container.path.substring(0, pages.container.path.lastIndexOf(\"/\"));\r\n          page.navigateToPath(type, modType, path).then((id) => {\r\n            if (embeddedMode || pickerMode) {\r\n              navContainerId = id;\r\n              m.redraw();\r\n            }\r\n            else {\r\n              page.listByType((containerMode ? baseListType : type), id);\r\n            }\r\n          });\r\n        }\r\n        else if (am7model.isParent(modType) && navigateByParent) {\r\n          let objectId = m.route.param(\"objectId\");\r\n          let q = am7view.viewQuery(am7model.newInstance(useType));\r\n          q.field(\"objectId\", objectId);\r\n\r\n          am7client.search(q, function (qr) {\r\n            let v;\r\n            if (qr && qr.results.length) v = qr[0];\r\n            //am7client.get(type, objectId, function(v){\r\n            if (v != null) {\r\n              /// this shouldn't be hit\r\n              /// am7model.inherits(modType, \"data.directory\")\r\n              if (v.parentId == 0 && am7model.isGroup(modType)) {\r\n                console.warn(\"Navigate up from zero parent shouldn't be hit unless at the top - resetting out of parent mode\");\r\n                page.navigateToPath(type, modType, v.groupPath).then((id) => {\r\n                  page.listByType((containerMode ? baseListType : type), id, false);\r\n                });\r\n                //navigateByParent = false;\r\n                //page.listByType((containerMode ? baseListType : type), v.objectId, false);\r\n              }\r\n              else {\r\n                am7client.get(type, v.parentId, function (v2) {\r\n                  if (v2 != null) {\r\n                    page.listByType((containerMode ? baseListType : type), v2.objectId, true);\r\n                  }\r\n                });\r\n              }\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          console.error(\"Handle \" + type);\r\n        }\r\n      }\r\n    }\r\n\r\n    async function navigateToPathId(grp) {\r\n      let ltype = baseListType;\r\n\r\n      if (embeddedMode || pickerMode) {\r\n        let byParent = (am7model.isParent(modType) && type !== 'auth.group');\r\n        navContainerId = grp.objectId;\r\n        if (byParent) navigateByParent = true;\r\n        pagination.new();\r\n        m.redraw();\r\n      }\r\n      else {\r\n        m.route.set(\"/list/\" + (containerMode ? baseListType : ltype) + \"/\" + grp.objectId, { key: Date.now() });\r\n      }\r\n    }\r\n\r\n    async function openSystemLibrary() {\r\n      let grp = await page.systemLibrary(baseListType);\r\n      navigateToPathId(grp);\r\n    }\r\n\r\n    async function openOlio(){\r\n      let og = await page.findObject(\"auth.group\", \"DATA\", \"/Olio/Universes\");\r\n      navigateToPathId(og);\r\n    }\r\n\r\n    async function openFavorites() {\r\n      let fav = await page.favorites();\r\n      navigateToPathId(fav);\r\n    }\r\n\r\n    async function openPath(path) {\r\n      let grp = await page.findObject(\"auth.group\", \"DATA\", path);\r\n      if(!grp){\r\n        page.toast(\"error\", \"Path not found: \" + path);\r\n        return;\r\n      }\r\n      navigateToPathId(grp);\r\n    }\r\n\r\n\r\n    function navigateDown(sel) {\r\n      let idx = getSelectedIndices();\r\n      let type = listType;\r\n      if (type) {\r\n        type = modType.type || type;\r\n      }\r\n      let byParent = (am7model.isParent(modType) && type !== 'auth.group');\r\n      if (sel && !sel[am7model.jsonModelKey]) sel = null;\r\n      if (sel || idx.length) {\r\n        let pages = pagination.pages();\r\n        let obj = sel || pages.pageResults[pages.currentPage][idx[0]];\r\n        // containerMode || \r\n        if (embeddedMode || pickerMode) {\r\n          //console.log(\"Nav down: \" + obj.objectId);\r\n          navContainerId = obj.objectId;\r\n          if (byParent) navigateByParent = true;\r\n          //pagination.new();\r\n          m.redraw();\r\n        }\r\n        else {\r\n          let ltype = obj[am7model.jsonModelKey] || baseListType;\r\n          m.route.set(\"/\" + (byParent ? 'p' : '') + \"list/\" + (containerMode ? baseListType : ltype) + \"/\" + obj.objectId, { key: Date.now() });\r\n        }\r\n      }\r\n    }\r\n\r\n    function listSystemType() {\r\n      systemList = !systemList;\r\n      pagination.new();\r\n      m.redraw();\r\n    }\r\n\r\n    function openItem(o) {\r\n      let pages = pagination.pages();\r\n      let aRes = pages.pageResults[pages.currentPage];\r\n      let idx = aRes.findIndex((v) => v.objectId === o.objectId);\r\n      if (idx > -1) {\r\n        carousel = true;\r\n        pages.currentItem = idx;\r\n        m.redraw();\r\n      }\r\n      //openSelected();\r\n\r\n      /// Opens to a window\r\n      /// pagination.routeToResult(o);\r\n    }\r\n\r\n    function selectResult(o) {\r\n      let state = pagination.state(o);\r\n      state.checked = !state.checked;\r\n      m.redraw();\r\n    }\r\n\r\n    function toggleInfo() {\r\n      info = !info;\r\n      m.redraw();\r\n    }\r\n\r\n    function toggleContainer() {\r\n      containerMode = !containerMode;\r\n      pagination.new();\r\n      m.redraw();\r\n    }\r\n    function toggleGrid(bOff) {\r\n      if (typeof bOff == 'boolean' && !bOff) gridMode = 0;\r\n      else gridMode++;\r\n      if (gridMode > 2) gridMode = 0;\r\n      let rc = defaultRecordCount;\r\n      if (gridMode == 1) rc = defaultIconRecordCount;\r\n      let pages = pagination.pages();\r\n      if (embeddedMode || pickerMode) {\r\n        // Reset pagination and start fresh with new record count\r\n        pagination.new();\r\n        pagination.update(listType, listContainerId, navigateByParent, navFilter, 0, rc, systemList);\r\n        m.redraw();\r\n      }\r\n      else {\r\n        m.route.set(pagination.url(1, rc), { key: Date.now() });\r\n      }\r\n    }\r\n\r\n    function toggleCarousel() {\r\n      carousel = !carousel;\r\n      m.redraw();\r\n    }\r\n\r\n    function toggleCarouselFull(bForce) {\r\n      if (typeof bForce == \"boolean\") {\r\n        fullMode = bForce;\r\n      }\r\n      else {\r\n        fullMode = !fullMode;\r\n        if (embeddedController) {\r\n          embeddedController.toggleFullMode();\r\n        }\r\n        else {\r\n          m.redraw();\r\n        }\r\n      }\r\n    }\r\n\r\n    function toggleCarouselMax() {\r\n      maxMode = !maxMode;\r\n      m.redraw();\r\n    }\r\n\r\n    function displayGrid() {\r\n      return am7decorator.gridListView(getListController());\r\n    }\r\n\r\n    function getListController(){\r\n      return {\r\n        containerMode,\r\n        listPage,\r\n        showIconFooter,\r\n        embeddedMode,\r\n        pickerMode,\r\n        results: getCurrentResults,\r\n        gridMode,\r\n        info,\r\n        pagination,\r\n        fullMode,\r\n        maxMode,\r\n        listType,\r\n        edit: editItem,\r\n        move: moveCarousel,\r\n        moveTo: moveCarouselTo,\r\n        select: selectResult,\r\n        open: openItem,\r\n        down: navigateDown,\r\n        onscroll: checkScrollPagination,\r\n        toggleCarousel,\r\n        toggleCarouselFull,\r\n        toggleCarouselMax,\r\n        toggleInfo\r\n      };\r\n    }\r\n \r\n    function displayList() {\r\n      let results = [];\r\n      let rset;\r\n      let pages = pagination.pages();\r\n      page.checkFavorites();\r\n\r\n      if (pages.pageResults[pages.currentPage]) {\r\n        if (infiniteScroll) {\r\n          rset = [].concat.apply([], pagination.pages().pageResults.slice(1, pages.currentPage + 1));\r\n        }\r\n        else rset = pages.pageResults[pages.currentPage];\r\n      }\r\n\r\n      //lreturn am7decorator.polarListView(getListController(), rset);\r\n      return am7decorator.tabularView(getListController(), rset);\r\n    }\r\n\r\n    function checkScrollPagination() {\r\n      if (!infiniteScroll) return;\r\n      let pages = pagination.pages();\r\n\r\n      let list = document.querySelector('[rid=resultList]');\r\n      let limit = (list.clientHeight + list.scrollTop) > (list.scrollHeight - 10);\r\n      if (pages.currentPage != pages.pageCount && limit) {\r\n        // console.log(\"peak ahead\");\r\n        list.removeEventListener('scroll', checkScrollPagination);\r\n        pagination.next();\r\n      }\r\n    }\r\n\r\n    function getOptionButton(type){\r\n      let optButton;\r\n      let selected = (getSelectedIndices().length > 0);\r\n      if (containerMode || type === 'auth.group' || am7model.isParent(modType)) {\r\n        let disableUp = (type !== 'auth.group' && am7model.isParent(modType) && !navigateByParent)\r\n        optButton = [pagination.button(\"button\" + (disableUp ? \" inactive\" : \"\"), \"north_west\", \"\", navigateUp), pagination.button(\"button\" + (!selected ? \" inactive\" : \"\"), \"south_east\", \"\", navigateDown)]\r\n      }\r\n      else if (!pickerMode) {\r\n        optButton = pagination.button(\"button\" + (carousel ? \" active\" : \"\"), \"view_carousel\", \"\", toggleCarousel);\r\n      }\r\n      return optButton;\r\n    }\r\n\r\n    function getAdminButtons(type){\r\n      let rs = page.context().roles;\r\n      let buttons = [];\r\n      let cnt = pagination.pages().container;\r\n      let favSel = \"\";\r\n      if (type.match(/^policy\\.policy/) || rs.accountAdmin || (rs.roleReader && type.match(/^auth\\.role$/gi)) || (rs.permissionReader && type.match(/^auth\\.permission$/gi))) {\r\n        buttons.push(pagination.button(\"button mr-4\" + (systemList ? \" active\" : \"\"), \"admin_panel_settings\", \"\", listSystemType));\r\n      }\r\n      else if (am7model.system.library[type]) {\r\n        if (cnt && cnt.path.match(/^\\/Library/gi)) favSel = \" bg-orange-200 active\";\r\n        buttons.push(pagination.button(\"button mr-4\" + (systemList ? \" active\" + favSel : \"\"), \"admin_panel_settings\", \"\", openSystemLibrary));\r\n      }\r\n      return buttons;\r\n    }\r\n\r\n    function getPickerButton(){\r\n      let buttons = [];\r\n      if (pickerMode) {\r\n        buttons.push(pagination.button(\"button\", \"check\", \"\", function () { pickerHandler(getSelected()); }));\r\n        if (pickerCancel) {\r\n          buttons.push(pagination.button(\"button\", \"close\", \"\", function () { pickerCancel(); }));\r\n        }\r\n      }\r\n      return buttons;\r\n    }\r\n\r\n    function getActionButtons(type){\r\n      let buttons = [];\r\n      if (!pickerMode && !containerMode) {\r\n        let selected = (getSelectedIndices().length > 0);\r\n        buttons.push(pagination.button(\"button mr-4\", (fullMode ? \"close_fullscreen\" : \"open_in_new\"), \"\", toggleCarouselFull));\r\n        if (!modType.systemNew) buttons.push(pagination.button(\"button\", \"add\", \"\", addNew));\r\n        if(type && type == \"olio.charPerson\"){\r\n          buttons.push(pagination.button(\"button\", \"steppers\", \"\", am7model.forms.commands.characterWizard));\r\n        }\r\n        buttons.push(pagination.button(\"button\" + (!selected ? \" inactive\" : \"\"), \"file_open\", \"\", openSelected));\r\n        buttons.push(pagination.button(\"button\" + (!selected ? \" inactive\" : \"\"), \"edit\", \"\", editSelected));\r\n        let bBucket = (pagination.pages().containerSubType && pagination.pages().containerSubType.match(/^(bucket|account|person)$/gi));\r\n        buttons.push(pagination.button(\"button\" + (!selected ? \" inactive\" : \"\"), (bBucket ? \"playlist_remove\" : \"delete\"), \"\", deleteSelected));\r\n        if(type && type == \"data.data\"){\r\n          buttons.push(pagination.button(\"button\" + (taggingInProgress ? \" active\" : \"\"), \"sell\", \"\", applyTagsToList));\r\n        }\r\n        if(type && (type == \"data.tag\" || type == \"auth.role\" || type == \"auth.group\")){\r\n          buttons.push(pagination.button(\"button\", \"cloud\", \"\", openCloud));\r\n        }\r\n      }\r\n\r\n      return buttons;\r\n    }\r\n\r\n    function openCloud(){\r\n      let pages = pagination.pages();\r\n      let containerId = (pages.container ? pages.container.id : 0);\r\n      page.components.dialog.memberCloud(baseListType, containerId);\r\n    }\r\n\r\n    function getPageToggleButtons(type){\r\n      let buttons = [];\r\n      buttons.push(pagination.button(\"button\" + (gridMode > 0 ? \" active\" : \"\"), (gridMode <= 1 ? \"apps\" : \"grid_view\"), \"\", toggleGrid));\r\n      if (!embeddedMode && (!containerMode || !type.match(/^auth\\.group$/gi)) && modType.group) buttons.push(pagination.button(\"button\" + (navigateByParent ? \" inactive\" : (containerMode ? \" active\" : \"\")), 'group_work', \"\", toggleContainer));\r\n      buttons.push( pagination.button(\"button\" + (info ? \" active\" : \"\"), \"info\", \"\", toggleInfo));\r\n      return buttons;\r\n    }\r\n\r\n    function getGroupSearchButtons(){\r\n      let buttons = [];\r\n      if (am7model.isGroup(modType)) {\r\n        let plc = \"\";\r\n        let cnt = pagination.pages().container;\r\n        if(cnt && cnt.path) plc = cnt.path;\r\n        buttons.push(textField(\"text-field\", \"listFilter\", plc, function (e) { if (e.which == 13) doFilter(); },));\r\n        buttons.push(pagination.button(\"button\", \"search\", null, doFilter));\r\n      }\r\n      return buttons;\r\n    }\r\n\r\n    function getOlioButtons(){\r\n      let buttons = [];\r\n      let oliSel = \"\";\r\n      let cnt = pagination.pages().container;\r\n      if (cnt && cnt.path.match(/^\\/olio/gi)) oliSel = \" bg-orange-200 active\";\r\n      buttons.push(pagination.button(\"button\" + oliSel, \"globe\", \"\", openOlio));\r\n      return buttons;\r\n    }\r\n\r\n    function getFavoriteButtons(){\r\n      let buttons = [];\r\n      let cnt = pagination.pages().container;\r\n      let favSel = \"\";\r\n      if (cnt && cnt.name.match(/favorites/gi)) favSel = \" bg-orange-200 active\";\r\n      buttons.push(pagination.button(\"button\" + favSel, \"favorite\", \"\", openFavorites));\r\n      return buttons;\r\n    }\r\n\r\n    function getActionButtonBar(type){\r\n      let buttons = [];\r\n      buttons.push(getPickerButton());\r\n      buttons.push(getAdminButtons(type));\r\n      buttons.push(getActionButtons(type));\r\n      buttons.push(getOlioButtons());\r\n      buttons.push(getFavoriteButtons());\r\n      buttons.push(getOptionButton(type));\r\n      buttons.push(getPageToggleButtons(type));\r\n      buttons.push(getGroupSearchButtons());\r\n      return buttons;\r\n    }\r\n\r\n    function getListViewInner(type) {\r\n\r\n      let buttons = getActionButtonBar(type);\r\n\r\n      let fdoh = function (e) {\r\n        e.preventDefault();\r\n      };\r\n      let fdrh = dnd.doDrop;\r\n\r\n      return m(\"div\", { ondragover: fdoh, ondrop: fdrh, class: \"list-results-container\" }, [\r\n        m(\"div\", { class: \"list-results\" }, [\r\n          m(\"div\", { class: \"result-nav-outer\" }, [\r\n            m(\"div\", { class: \"result-nav-inner\" }, [\r\n              m(\"div\", { class: \"result-nav tab-container\" },\r\n                buttons\r\n              ),\r\n              m(\"nav\", { class: \"result-nav\" }, [\r\n                pagination.pageButtons()\r\n              ])\r\n            ])\r\n          ]),\r\n          (gridMode > 0 ? displayGrid() : displayList()),\r\n          (showFooter ? pagination.pageBarView() : \"\")\r\n        ])\r\n      ]);\r\n    }\r\n\r\n    function doFilter() {\r\n      navFilter = document.querySelector(\"[id=listFilter]\").value;\r\n      if (!navFilter.length) navFilter = null;\r\n\r\n      else if(navFilter.indexOf(\"..\") > -1 || navFilter.indexOf(\"~\") > -1 || navFilter.indexOf(\"/\") > -1){\r\n        let npath = page.normalizePath(navFilter, pagination.pages().container);\r\n        if(npath){\r\n          openPath(npath);\r\n        }\r\n        return;\r\n      }\r\n\r\n      let red = (embeddedMode || pickerMode);\r\n      pagination.filter(navFilter, red);\r\n    }\r\n\r\n    function getListView() {\r\n      let type = m.route.param(\"type\");\r\n      return m(\"div\", { class: \"content-outer\" }, [\r\n        (fullMode ? \"\" : m(page.components.navigation)),\r\n        m(\"div\", { class: \"content-main\" }, [\r\n          getListViewInner(type)\r\n        ])\r\n      ]);\r\n    }\r\n\r\n   \r\n\r\n    function moveCarouselTo(i) {\r\n      let pages = pagination.pages();\r\n      wentBack = false;\r\n      pages.currentItem = i;\r\n      m.redraw();\r\n    }\r\n\r\n    function moveCarousel(i) {\r\n      let pages = pagination.pages();\r\n      let pr = pages.pageResults[pages.currentPage];\r\n      page.components.pdf.clear();\r\n      wentBack = false;\r\n\r\n      let idx = pages.currentItem + i;\r\n      if (pr && idx >= pr.length) {\r\n        if (pages.currentPage < pages.pageCount) pagination.next(embeddedMode || pickerMode);\r\n      }\r\n      else if (idx < 0) {\r\n        if (pages.currentPage > 1) {\r\n          wentBack = true;\r\n          pagination.prev(embeddedMode || pickerMode);\r\n        }\r\n      }\r\n      else {\r\n        pages.currentItem = idx;\r\n        m.redraw();\r\n      }\r\n    }\r\n\r\n\r\n\r\n    function getCurrentResults(){\r\n      let pages = pagination.pages();\r\n      let pr = pages.pageResults[pages.currentPage];\r\n      if (pr) {\r\n        if (wentBack) {\r\n          pages.currentItem = pr.length - 1;\r\n        }\r\n        if (pages.currentItem < 0 && pr.length) pages.currentItem = 0;\r\n      }\r\n      return pr;\r\n    }\r\n\r\n\r\n\r\n    function navListKey(e) {\r\n      wentBack = false;\r\n      //if(carousel || gridMode){\r\n      switch (e.keyCode) {\r\n        /// <\r\n        case 37:\r\n          //if((gridMode && !carousel) || e.shiftKey){\r\n          if (!carousel || e.shiftKey) {\r\n            wentBack = true;\r\n            pagination.prev(embeddedMode || pickerMode);\r\n          }\r\n          else moveCarousel(-1);\r\n          break;\r\n        /// >\r\n        case 39:\r\n          //if((gridMode && !carousel) || e.shiftKey)\r\n          if (!carousel || e.shiftKey) {\r\n            pagination.next(embeddedMode || pickerMode);\r\n          }\r\n          else moveCarousel(1);\r\n          break;\r\n        /// ESC\r\n        case 27:\r\n          if (carousel) toggleCarousel();\r\n          else if (gridMode > 0) toggleGrid(false);\r\n          else if (fullMode) toggleCarouselFull();\r\n          break;\r\n      }\r\n\r\n      // }\r\n    }\r\n\r\n    function initParams(vnode) {\r\n      ;\r\n      listType = vnode.attrs.type || m.route.param(\"type\") || \"data\";\r\n\r\n      modType = am7model.getModel(listType);\r\n      if (!modType) {\r\n        console.error(\"Missing modType for type \" + listType);\r\n      }\r\n      else {\r\n        navigateByParent = vnode.attrs.navigateByParent || (m.route.get().match(/^\\/plist/) != null);\r\n        if (navigateByParent && !am7model.isParent(modType)) {\r\n          console.warn(\"Type is not clustered by parent\");\r\n          navigateByParent = false;\r\n        }\r\n      }\r\n      baseListType = listType;\r\n      if (modType.group && containerMode && !listType.match(/^auth\\.group$/gi)) listType = 'auth.group';\r\n      listContainerId = navContainerId || vnode.attrs.objectId || m.route.param(\"objectId\");\r\n      if (!embeddedMode && !pickerMode) navContainerId = null;\r\n    }\r\n\r\n    function update(vnode) {\r\n      initParams(vnode);\r\n      let listFilter = navFilter || vnode.attrs.filter || m.route.param(\"filter\");\r\n      if (listFilter) listFilter = decodeURI(listFilter);\r\n\r\n      let pages = pagination.pages();\r\n      // In embedded/picker mode, skip update if pagination has results to avoid resetting state\r\n      if ((embeddedMode || pickerMode) && pages.counted && pages.currentPage > 0) {\r\n        return;\r\n      }\r\n      let currentDefaultRecordCount = (gridMode == 1) ? defaultIconRecordCount : defaultRecordCount;\r\n      let startRecord = vnode.attrs.startRecord || m.route.param(\"startRecord\");\r\n      let recordCount = vnode.attrs.recordCount || m.route.param(\"recordCount\") || currentDefaultRecordCount;\r\n      pagination.update(listType, listContainerId, navigateByParent, listFilter, startRecord, recordCount, systemList);\r\n\r\n      if(carousel){\r\n        let pr = getCurrentResults();\r\n        let cient = pr ? pr[pagination.pages().currentItem] : undefined;\r\n        if(cient && page.context().contextObjects[cient.objectId]){\r\n          if(page.components.pdf.viewer(cient.objectId)){\r\n            page.components.pdf.viewers[cient.objectId].init(1.0);\r\n          }\r\n        }\r\n      }\r\n     }\r\n\r\n    listPage.closeView = function () {\r\n      closeSelected();\r\n    };\r\n\r\n    listPage.pagination = function () {\r\n      return pagination;\r\n    };\r\n\r\n    listPage.view = {\r\n      oninit: function (x) {\r\n        dnd = page.components.dnd;\r\n        initParams(x);\r\n        document.documentElement.addEventListener(\"keydown\", navListKey);\r\n      },\r\n      oncreate: function (x) {\r\n        fullMode = x.attrs.fullMode || fullMode;\r\n        pickerMode = x.attrs.pickerMode;\r\n        embeddedMode = x.attrs.embeddedMode;\r\n        embeddedController = x.attrs.embeddedController;\r\n        pickerHandler = x.attrs.pickerHandler;\r\n        pickerCancel = x.attrs.pickerCancel;\r\n        pagination.setEmbeddedMode(embeddedMode || pickerMode);\r\n        update(x);\r\n      },\r\n      onupdate: function (x) {\r\n        update(x);\r\n      },\r\n      onremove: function (x) {\r\n        page.components.pdf.clear();\r\n        navFilter = null;\r\n        document.documentElement.removeEventListener(\"keydown\", navListKey);\r\n        pagination.stop();\r\n        if (app) app.destroy();\r\n      },\r\n\r\n      view: function (vnode) {\r\n        let v;\r\n        if (vnode.attrs.pickerMode || (!carousel && vnode.attrs.embeddedMode)) v = getListViewInner(vnode.attrs.type);\r\n        else if (carousel) {\r\n          if (vnode.attrs.embeddedMode) v = am7decorator.carouselItem(getListController());\r\n          else v = v = am7decorator.carouselView(getListController());\r\n        }\r\n        else v = getListView();\r\n        if (vnode.attrs.pickerMode || vnode.attrs.embeddedMode) return v;\r\n        return [v, page.components.dialog.loadDialog(), page.loadToast()];\r\n      }\r\n    };\r\n    window.dbgList = listPage;\r\n    return listPage;\r\n  }\r\n\r\n  page.views.list = newListControl;\r\n}());\r\n\n\n;/* === client/view/object.js === */\n(function(){\r\n    function newObjectPage(){\r\n        let objectPage = {};\r\n        let entity;\r\n        let inst;\r\n        let pinst = {};\r\n        let oinst = {};\r\n        let app;\r\n        let tabIndex = 0;\r\n        let pickerMode = {};\r\n        let childPickerMode;\r\n        let fullMode = false;\r\n        let designMode = false;\r\n        let caller;\r\n        let callerIndex;\r\n        let callerActive;\r\n\r\n        let pendingResponse;\r\n        let valuesState = {};\r\n        let foreignData = {};\r\n        let definition;\r\n        let listView = page.views.list().view;\r\n\r\n        let embeddedMode = false;\r\n        let embeddedController;\r\n        let showFooter = false;\r\n\r\n        let objectType;\r\n        let objectId;\r\n        \r\n        let objectNew;\r\n        let parentNew;\r\n        let streamSeg;\r\n        let pdfViewer;\r\n        let parentProperty;\r\n\r\n        objectPage.pinst = function(){\r\n            return pinst;\r\n        };\r\n        objectPage.oinst = function(){\r\n            return oinst;\r\n        };\r\n\r\n        function toggleFullMode(){\r\n            fullMode = !fullMode;\r\n            if(embeddedController){\r\n                embeddedController.toggleFullMode();\r\n            }\r\n            else{\r\n                m.redraw();\r\n            }\r\n        }\r\n\r\n        function printJSONToWindow(){\r\n            let s = JSON.stringify(inst.entity, null, 2);\r\n            let bu = page.blobUrl(\"data:text/json;base64,\" + Base64.encode(s));\r\n            let w = window.open(bu, inst.entity.name);\r\n        }\r\n\r\n        async function toggleDesignMode(){\r\n            if(!designMode){\r\n                /// Refresh the entity byte array when temporarily shifting views in the event it changed\r\n                /// Note: this is necessary because the field is not directly associated to the view, and isn't picked up by synchronizing the component.\r\n                let mt = document.querySelector(\"[name='contentType']\").value;\r\n                let txtEl = document.querySelector(\"[name='dataBytesStore-mt']\");\r\n                if(mt.match(/javascript/gi) && txtEl && txtEl.value === \"\"){\r\n                    let v = await m.request({method: \"GET\", responseType: \"text\", withCredentials: true, url: g_application_path + \"/rest/script/template\"});\r\n                    console.log(g_application_path + \"/rest/script/template\", v);\r\n                    if(v && v != null){\r\n                        txtEl.value = v;\r\n                        toggleDesignMode();\r\n                        return;\r\n                    }\r\n                    \r\n                }\r\n                if(txtEl){\r\n                    inst.api.dataBytesStore(txtEl.value);\r\n                    if(inst.api.compressionType){\r\n                        inst.api.compressionType(\"none\");\r\n                    }\r\n                }\r\n            }\r\n            else if(designMode && objectPage.transitionHandler){\r\n                objectPage.transitionHandler(objectPage, entity);\r\n            }\r\n            designMode = !designMode;\r\n            m.redraw();\r\n        }\r\n\r\n        function doUpdate(){\r\n            if(!entity){\r\n                console.error(\"No entity defined\");\r\n                return;\r\n            }\r\n            if(!entity[am7model.jsonModelKey] || entity[am7model.jsonModelKey] === 'UNKNOWN'){\r\n                console.error(\"Unknown entity type\");\r\n                return;\r\n            }\r\n            let syncText = true;\r\n            /// If clicking 'update' while in design mode, transfer the rich edit buffer back to the entity\r\n            ///\r\n            if(designMode && objectPage.transitionHandler){\r\n                console.log(\"Consume design buffer\");\r\n                objectPage.transitionHandler(objectPage, entity);\r\n                syncText = false;\r\n                designMode = false;\r\n            }\r\n\r\n            /// Synchronize the form with the entity\r\n            /// \r\n            if(entity[am7model.jsonModelKey].match(/^data\\.data$/i)){\r\n                if(am7view.isBinary(entity)){\r\n                    console.log(\"Don't update binary content via form.\");\r\n                    inst.api.dataBytesStore(\"\");\r\n                    inst.unchange(\"dataBytesStore\")\r\n                }\r\n                else if(syncText){\r\n                    if(!inst.changes.includes(\"dataBytesStore\")) inst.changes.push(\"dataBytesStore\");\r\n                    let txtEl = document.querySelector(\"[name='dataBytesStore-mt']\");\r\n                    if(txtEl){\r\n                        inst.api.dataBytesStore(txtEl.value);\r\n                        if(inst.api.compressionType){\r\n                            inst.api.compressionType(\"none\");\r\n                        }\r\n                    }\r\n                    else{\r\n                        console.warn(\"Did not locate textarea\"); \r\n                    }\r\n                }\r\n            }\r\n            else if(entity[am7model.jsonModelKey].match(/^message$/i)){\r\n                let txtEl = document.querySelector(\"[name='data-mt']\");\r\n                if(!inst.changes.includes(\"data\")) inst.changes.push(\"data\");\r\n                if(txtEl) entity.data = Base64.encode(txtEl.value);\r\n                else{\r\n                    console.warn(\"Did not locate textarea\"); \r\n                }\r\n            }\r\n            let bpatch = am7model.hasIdentity(entity);\r\n\r\n            if(!inst.validate(true)){\r\n                page.toast(\"warn\", \"Please fill in all fields\");\r\n                return;\r\n            }\r\n\r\n            /// check for updates via nested object references\r\n            /// Eg: Object.childObject.property\r\n            let aP = [];\r\n            Object.keys(pinst).forEach(k => {\r\n                if(!inst.field(k).foreign){\r\n                    console.log(\"Field not foreign: \" + k);\r\n                    inst.change(k);\r\n                }\r\n                else{\r\n                    let e = pinst[k];\r\n                    let upatch = e.hasIdentity();\r\n                    let puint = (upatch ? e.patch() : e.entity);\r\n                    /// Make sure to create the object, even if it has no changes\r\n                    /// OR - if nothing has changed, it needs to be stripped off the entity, pinst, and oinst \r\n                    \r\n                    if(puint && bpatch && (!upatch || e.changes.length)){\r\n    \r\n                        aP.push(am7client[upatch ? \"patch\" : \"create\"](e.entity[am7model.jsonModelKey], puint, function(v){\r\n                            e.resetChanges();\r\n                            if(!upatch){\r\n                                for(let i in v){\r\n                                    e.entity[i] = v[i];\r\n                                }\r\n                                /// For create operations, substitute the whole object for the minimal id reference received in the response\r\n\r\n                                inst.api[k](v);\r\n                            }\r\n                            else{\r\n                                inst.unchange(k);\r\n                            }\r\n                        }));\r\n                    }\r\n                }\r\n            });\r\n            if(aP.length){\r\n                Promise.all(aP).then(() => {\r\n                    console.log(\"Continue with base update\");\r\n                    doUpdate();\r\n                });\r\n                return;\r\n            }\r\n\r\n            if(!inst.changes.length){\r\n                page.toast(\"warn\", \"No changes were detected, so nothing was updated\");\r\n                return;\r\n            }\r\n            \r\n            let uint = (bpatch ? inst.patch() : entity);\r\n            if(!uint){\r\n                page.toast(\"warn\", \"No patch fields were identified, so nothing was updated\");\r\n                console.warn(\"Nothing to update\");\r\n                return;\r\n            }\r\n\r\n            am7client[bpatch ? \"patch\" : \"create\"](entity[am7model.jsonModelKey], uint, function(v){\r\n                if(v != null){\r\n                    page.toast(\"success\", \"Saved!\");\r\n                    let bNew = objectNew || parentNew;\r\n                    inst.resetChanges();\r\n                    if(entity[am7model.jsonModelKey].match(/message/i)){\r\n                        history.back();\r\n                    }\r\n                    else{\r\n                        am7client.clearCache(entity[am7model.jsonModelKey], false, function(){\r\n                            if(!bpatch){\r\n                                entity = v;\r\n                            }\r\n                            page.clearContextObject(entity.objectId);\r\n                            objectNew = false;\r\n                            parentNew = false;\r\n                            if(embeddedMode && embeddedController){\r\n                                embeddedController.editItem(entity);\r\n                            }\r\n                            else if(bNew){\r\n                                let uri = \"/view/\" + entity[am7model.jsonModelKey] + \"/\" + entity.objectId;\r\n                                m.route.set(uri, {key: entity.objectId});\r\n                            }\r\n                            else{\r\n                                m.redraw();\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                else{\r\n                    page.toast(\"error\", \"An error occurred while trying to update the object\");\r\n                    console.error(v);\r\n                }\r\n            });\r\n        }\r\n        function cancelPicker(bNoRefresh){\r\n            if(childPickerMode){\r\n                childPickerMode.cancelPicker(bNoRefresh);\r\n                childPickerMode = undefined;\r\n            }\r\n            pickerMode.enabled = false;\r\n            if(!bNoRefresh){\r\n                m.redraw();\r\n            }\r\n        }\r\n        function enablePicker(bNoRefresh){\r\n            pickerMode.enabled = true;\r\n            if(caller){\r\n                caller.setChildPickerMode(objectPage);\r\n            }\r\n            if(!bNoRefresh){\r\n                m.redraw();\r\n            }\r\n        }\r\n\r\n        function doCancel(){\r\n            if(pickerMode.enabled || childPickerMode){\r\n                cancelPicker();\r\n            }\r\n            else if(embeddedMode && embeddedController){\r\n                embeddedController.cancelView();\r\n            }\r\n            else{\r\n                history.back();\r\n                m.redraw();\r\n            }\r\n        }\r\n        \r\n        async function chatInto(){\r\n            page.components.dialog.chatInto(inst.entity);\r\n        }\r\n\r\n        async function applyTags(){\r\n            if(!entity || !entity.objectId) return;\r\n            if(!entity.contentType || !entity.contentType.match(/^image\\//gi)){\r\n                page.toast(\"warn\", \"Tag application is only available for images\");\r\n                return;\r\n            }\r\n            page.toast(\"info\", \"Applying image tags...\");\r\n            try {\r\n                let tags = await page.applyImageTags(entity.objectId);\r\n                console.log(\"applyImageTags result:\", tags);\r\n                if(tags && Array.isArray(tags) && tags.length){\r\n                    page.toast(\"success\", \"Applied \" + tags.length + \" tags\");\r\n                }\r\n                else if(tags){\r\n                    page.toast(\"success\", \"Tags applied\");\r\n                }\r\n                else {\r\n                    page.toast(\"warn\", \"No tags were applied\");\r\n                }\r\n            }\r\n            catch(e){\r\n                console.error(e);\r\n                page.toast(\"error\", \"Failed to apply tags\");\r\n            }\r\n        }\r\n        \r\n        async function doCopy(){\r\n            if(!entity || !entity.objectId) return;\r\n            if(am7model.hasField(entity[am7model.jsonModelKey], \"name\")){\r\n                entity.name += \" Copy\";\r\n            }\r\n            entity.objectId = undefined;\r\n            entity.id = undefined;\r\n            entity.urn = undefined;\r\n            delete entity.vaultId;\r\n            delete entity.vaulted;\r\n            delete entity.keyId;\r\n            resetEntity(entity);\r\n            m.redraw();\r\n        }\r\n        async function doDelete(){\r\n            if(!entity || !entity.objectId) return;\r\n            let type = entity[am7model.jsonModelKey];\r\n            let path = entity.groupPath;\r\n            page.components.dialog.confirm(\"Delete this object?\", async function(){\r\n                await page.deleteObject(entity[am7model.jsonModelKey], entity.objectId);\r\n                history.back();\r\n            });\r\n        }\r\n        function buttonTab(active, label, fHandler){\r\n            let icoName = (active ? \"tab\" : \"tab_unselected\");\r\n            let cls = \"button-tab\" + (active ? \" button-tab-active\" : \"\");\r\n            return m(\"button\", {class : cls, onclick : fHandler}, m(\"span\",{class : \"material-icons-outlined mr-2\"}, icoName), label);\r\n        }\r\n        function switchTab(i){\r\n            tabIndex = i;\r\n            cancelPicker();\r\n        }\r\n\r\n        function getFormatForContentType(format){\r\n            if(!entity || !entity.contentType){\r\n                return \"textarea\";\r\n            }\r\n\r\n            let mt = entity.contentType;\r\n            if(!am7view.isBinary(entity, mt)) format = 'textarea';\r\n            else if(mt.match(/^image/)) format = 'image';\r\n            else if(mt.match(/pdf$/)) format = 'pdf';\r\n            else{\r\n                console.warn(\"Unhandled contentType: \" + mt);\r\n            }\r\n\r\n            return format;\r\n        }\r\n\r\n\r\n        async function postRender(){\r\n            if(!entity){\r\n                return;\r\n            }\r\n            if(pdfViewer){\r\n                pdfViewer.init(0.5);\r\n            }\r\n\r\n        }\r\n\r\n\r\n        function getFormCommands(name, form, field, bSel, bEdit, bAdjust){\r\n            if(!form.commands) return [];\r\n            let iter = 0;\r\n            return Object.keys(form.commands).map((k)=>{\r\n                let cmd = form.commands[k];\r\n                let active = false;\r\n                /// check for a condition to restrict activation\r\n                if(cmd.requiredAttribute && !cmd.condition){\r\n                    if(entity && entity[cmd.requiredAttribute]){\r\n                        active = true;\r\n                    }\r\n                }\r\n                else if(!cmd.condition || (bSel && cmd.condition.includes(\"select\")) || (bEdit && cmd.condition.includes(\"edit\"))) active = true;\r\n\r\n                let icon = cmd.icon;\r\n                let func = cmd.function;\r\n                if(cmd.altCondition && bEdit && cmd.altCondition.includes(\"edit\")){\r\n                    func = cmd.altFunction;\r\n                    icon = cmd.altIcon;\r\n                }\r\n                iter++;\r\n                let cls = \"button\" + (active ? \"\" : \" inactive\") + (bAdjust && iter == 1 ? \" ml-4\" : \"\");\r\n                return page.iconButton(cls, icon, \"\", function(){\r\n                    objectPage[func](name, field, (field ? field.baseModel : name), form, cmd.properties);\r\n                });\r\n            })\r\n        }\r\n        function getFormCommandView(name, form, field, bSel, bEdit){\r\n            if(!form.commands) return [];\r\n            return [m(\"div\",{class: \"result-nav-outer\"},[\r\n                m(\"div\",{class: \"result-nav-inner\"},[   \r\n                    m(\"div\",{class: \"result-nav\"},\r\n                        getFormCommands(name, form, field, bSel, bEdit)\r\n                    )\r\n                ])\r\n        ])];\r\n        }\r\n\r\n        function getValuesForFormField(name, fieldView, field, fieldClass, hidden){\r\n            let cmds = [];\r\n            let rows = [];\r\n            /// Get the field for the viewModel off the itemType of the supplied field\r\n            if(!entity) return rows;\r\n\r\n            if(!field.function){\r\n                console.error(\"Expected the field for \" + name + \" to specify a function\");\r\n                return rows;\r\n            }\r\n\r\n            return objectPage[field.function](name, fieldView, field, fieldClass, hidden);\r\n        }\r\n\r\n        function getValuesForTableField(name, fieldView, field, fieldClass, hidden){\r\n            let cmds = [];\r\n            let rows = [];\r\n            /// Get the field for the viewModel off the itemType of the supplied field\r\n            if(!entity) return rows;\r\n            if(!field.baseModel){\r\n                console.error(\"Expected the itemType to include field definitions for formatting the table\");\r\n                return rows;\r\n            }\r\n            if(!fieldView.form){\r\n                console.error(\"Expected the field view for \" + name + \" to specify an additional form\");\r\n                console.log(fieldView);\r\n                return rows;\r\n            }\r\n            let tableType = field.baseModel;\r\n            if(tableType == \"$self\"){\r\n                tableType = entity[am7model.jsonModelKey];\r\n            }\r\n            let tableForm = fieldView.form;\r\n            let bEdit = false;\r\n            let bSel = false;\r\n            if(field.foreign){\r\n                if(!foreignData[name]){\r\n                    if(field.function){\r\n                        objectPage[field.function](name, field).then((data) => {\r\n                            foreignData[name] = data;\r\n                            m.redraw();\r\n                        });\r\n                        return rows;\r\n                    }\r\n                }\r\n            }\r\n\r\n            Object.keys(valuesState).forEach((k)=>{\r\n                let state = valuesState[k];\r\n                if(state.attribute === name){\r\n                    if(state.mode === 'edit') bEdit = true;\r\n                    if(state.selected) bSel = true;\r\n                }\r\n            });\r\n            if(!hidden && tableForm.commands){\r\n                cmds = getFormCommandView(name, tableForm, field, bSel, bEdit);\r\n            }\r\n\r\n            let rowModel = [];\r\n            Object.keys(tableForm.fields).forEach((k)=>{\r\n                let tableField = am7model.getModelField(tableType, k, am7view.typeToModel(entity[field.foreignType]));\r\n                let tableFieldView = tableForm.fields[k];\r\n                rowModel.push({name: k, fieldView : tableFieldView, field : tableField});\r\n            });\r\n            \r\n            if(!hidden){\r\n                rows.push(m(\"tr\",rowModel.map((r)=>{\r\n                    if(!r.field){\r\n                        r.field = am7model.getModelField(tableType, r.name);\r\n                    }\r\n                    return m(\"th\", r.fieldView?.label || r.field?.label);\r\n                })));\r\n            }\r\n\r\n            if(entity){\r\n                \r\n                let vals;\r\n                if(inst.api[name]) vals = inst.api[name]();\r\n                else if(field.foreign) vals = foreignData[name];\r\n                else if(field.parentProperty){\r\n                    if(entity[field.parentProperty]){\r\n                        vals = entity[field.parentProperty][name];\r\n                    }\r\n                }\r\n                else vals = entity[name];\r\n                if(vals && field.type.match(/^(array|list)$/)){\r\n                    vals.forEach((v, i) => {\r\n                        if(!valuesState[name + \"-\" + i]){\r\n                            valuesState[name + \"-\" + i] = {attribute: name, foreign: field.foreign, index : i, selected: false, mode: 'view'};\r\n                        }\r\n                        let state = valuesState[name + \"-\" + i];\r\n                        let rowClass = \"\";\r\n                        if(state.selected) rowClass = \"row-field-active\";\r\n                        let selectHandler;\r\n                        if(state.mode === 'view'){\r\n                            rowClass += \" row-field\";\r\n                            selectHandler = function(){\r\n                                valuesState[name + \"-\" + i].selected = !valuesState[name + \"-\" + i].selected;\r\n                                m.redraw();\r\n                            }\r\n                        }\r\n                        let cv;\r\n                        if(v && v[am7model.jsonModelKey]){\r\n                            cv = am7model.prepareInstance(v, fieldView?.form);\r\n                        }\r\n\r\n\r\n                        rows.push(m(\"tr\", {class: rowClass, onclick : selectHandler},\r\n                            rowModel.map((rm)=>{\r\n                                if(state.mode == 'edit'){\r\n                                    return m(\"td\", modelField(rm.name, rm.fieldView, rm.field, rm.name + \"-\" + i, (cv ? cv.api[rm.name]() : v[rm.name]), true, v, fieldView?.form));\r\n                                }\r\n                                else{\r\n                                    let val;\r\n\r\n                                    if(rm?.field?.pickerProperty){\r\n                                        let findVal = v[rm.field.pickerProperty.entity];\r\n                                        let ctx = page.context();\r\n                    \r\n                                        if(findVal){\r\n                                            if(typeof findVal === 'object'){\r\n                                                val = findVal.name;\r\n                                            }\r\n                                            else if(!ctx.contextObjects[findVal]){\r\n                                                let type = rm.field.pickerType;\r\n                                                if(!type || type === 'self') type = v[am7model.jsonModelKey];\r\n                                                else type = type;\r\n                                                if(type.match(/^\\./)){\r\n                                                    type = v[rm.field.pickerType.slice(1)];\r\n                                                }\r\n                                                page.openObject(type, findVal).then((a)=>{\r\n                                                    m.redraw();\r\n                                                });\r\n                                            }\r\n                                            else {\r\n                                                val = ctx.contextObjects[findVal].name;\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                    else{\r\n                                        val = (cv ? cv.api[rm.name]() : v[rm.name]);\r\n                                    }\r\n                                    return m(\"td\", \"\" + val);\r\n                                }\r\n                            })\r\n                        ))\r\n                    })\r\n                }\r\n                else{\r\n                    // console.log(\"What to do: \" + name + \" / \" + field.type + \" / \" + vals);\r\n                }\r\n            }\r\n\r\n            return [cmds, m(\"table\",{class: fieldClass}, rows)];\r\n        }\r\n\r\n        let spans = [\"row-span-1\",\"row-span-2\", \"row-span-3\", \"row-span-4\", \"row-span-5\"];\r\n        let spans2 = [\"row-span-auto\",\"row-span-full\"];\r\n\r\n        function modelFieldContainer(name, fieldView, field){\r\n            let className = \"field-grid-item-full\";\r\n            if(fieldView.layout == \"half\") className = \"field-grid-item-half\";\r\n            else if(fieldView.layout == \"fifth\") className = \"field-grid-item-fifth\";\r\n            else if(fieldView.layout == \"two-thirds\") className = \"field-grid-item-two-thirds\";\r\n            else if(fieldView.layout == \"third\") className = \"field-grid-item-third\";\r\n            else if(fieldView.layout == \"one\") className = \"field-grid-item-one\";\r\n            if(fieldView.rows) className += \" \" + spans[fieldView.rows-1];\r\n            let labelClass = \"field-label\";\r\n            let show = am7view.showField(inst, fieldView);\r\n            \r\n            if(!show){\r\n                labelClass += \" text-gray-300\"\r\n            }\r\n            let lbl = (fieldView.label || field.label || field.name);\r\n            return m(\"div\",{class: className},[\r\n                m(\"label\",{class : labelClass, for: name}, lbl), //  || name\r\n                modelField(name, fieldView, field)\r\n            ]);\r\n\r\n        }\r\n\r\n        function getObjectProperty(name, field){\r\n            let val;\r\n            if(!entity || entity === null) return val;\r\n\r\n            if(field.baseModel && field.typeAttribute){\r\n                let vVal = entity[field.typeAttribute]\r\n                if(!vVal){\r\n                    console.log(\"Entity doesn't define \" + field.typeAttribute);\r\n                    return val;\r\n                }\r\n                if(field.property){\r\n                    let vProp = vVal[field.property];\r\n                    if(!vProp){\r\n                        console.warn(field.typeAttribute + \" doesn't define \" + field.property);\r\n                        return val;\r\n                    }\r\n                    val = vProp;\r\n                }\r\n            }\r\n\r\n            return val;\r\n        }\r\n\r\n        function updateChange(evt, field){\r\n            if(entity && field && field.pickerProperty && field.pickerProperty.entity){\r\n                entity[field.pickerProperty.entity] = (evt.srcElement || evt.target).value;\r\n            }\r\n        }\r\n\r\n\r\n\r\n        function modelField(name, fieldView, field, altName, altVal, noChange, altEntity, altForm){\r\n\r\n            let useEntity = altEntity || entity;\r\n            let format = (fieldView?.form?.format || fieldView.format || field.format || am7view.getFormatForType(field.type));\r\n            let useName = altName || name;\r\n            let view = [];\r\n            let disabled = false;\r\n            let fieldClass = \"\";\r\n            if(inst.validationErrors[name]){\r\n                fieldClass += \"field-error\";\r\n            }\r\n            else if(field.readOnly || fieldView.readOnly){\r\n                disabled = true;\r\n                fieldClass += \"field-disabled\";\r\n            }\r\n            else if(field.required){\r\n                fieldClass += \"field-required\";\r\n            }\r\n\r\n            if(field.foreign && field.type.match(/^(model|list)$/) && fieldView.autocreate && (!entity[name] || !entity[name].length)){\r\n                let aom = getPrimitive(field.baseModel);\r\n                let aname = \"Auto \" + field.baseModel + \" \" + page.luid();\r\n                if(am7model.hasField(field.baseModel, \"name\")){\r\n                    aom.name = aname;\r\n                }\r\n                if(field.type == 'model'){\r\n                    entity[field.name] = aom;\r\n                }\r\n                else if(field.type == 'list'){\r\n                    entity[field.name] = [aom];\r\n                }\r\n            }\r\n\r\n            let defVal = (inst && !altEntity && inst.api[name] ? inst.api[name]() : undefined);\r\n            if(field.function && objectPage[field.function] && !field.foreign){\r\n                if(field.promise){\r\n                    defVal = foreignData[name];\r\n                    if(!defVal){\r\n\r\n                        objectPage[field.function](name, field).then((v) => {\r\n                            foreignData[name] = v;\r\n                            inst.api[name](v);\r\n                            m.redraw();\r\n                        });\r\n                    }\r\n                }\r\n                else{\r\n                    defVal = objectPage[field.function](name, field);\r\n                }\r\n            }\r\n            else if(altVal){\r\n\r\n                defVal = altVal;\r\n            }\r\n\r\n            let fHandler;\r\n            if(!noChange && !disabled && !field.command){\r\n                fHandler = inst.handleChange(name, updateChange)\r\n            }\r\n\r\n            if(format === 'contentType'){\r\n                useName = name + \"-mt\";\r\n                format = getFormatForContentType(format);\r\n            }\r\n\r\n            if(field.property && !defVal){\r\n                defVal = getObjectProperty(name, field);\r\n            }\r\n\r\n            let show = am7view.showField(inst, fieldView);\r\n            let annot = \"\";\r\n            if(inst.validationErrors[name]){\r\n                annot = am7view.errorLabel(inst.validationErrors[name]);\r\n            }\r\n            if(!show) fieldClass += \" hidden\";\r\n\r\n            /// Build context for field renderers\r\n            let rendererCtx = {\r\n                inst: inst,\r\n                entity: entity,\r\n                useEntity: useEntity,\r\n                field: field,\r\n                fieldView: fieldView,\r\n                name: name,\r\n                useName: useName,\r\n                defVal: defVal,\r\n                fieldClass: fieldClass,\r\n                disabled: disabled,\r\n                fHandler: fHandler,\r\n                show: show,\r\n                objectPage: objectPage,\r\n                /// Callbacks for complex renderers\r\n                updateChange: updateChange,\r\n                doFieldPicker: doFieldPicker,\r\n                doFieldOpen: doFieldOpen,\r\n                doFieldClear: doFieldClear,\r\n                printJSONToWindow: printJSONToWindow,\r\n                getValuesForTableField: getValuesForTableField,\r\n                getValuesForFormField: getValuesForFormField,\r\n                /// Special state for certain renderers\r\n                pdfViewer: pdfViewer,\r\n                streamSeg: streamSeg,\r\n                loadStream: function(streamId) {\r\n                    page.stream(streamId).then((o) => {\r\n                        streamSeg = o;\r\n                        m.redraw();\r\n                    });\r\n                }\r\n            };\r\n\r\n            /// Try to use the new formFieldRenderers component\r\n            if(page.components.formFieldRenderers && page.components.formFieldRenderers.has(format)){\r\n                let rendered = page.components.formFieldRenderers.render(format, rendererCtx);\r\n                if(rendered){\r\n                    view.push(...rendered);\r\n                    view.push(annot);\r\n                    return view;\r\n                }\r\n            }\r\n\r\n            /// Fallback to original switch for any unhandled formats\r\n            switch(format){\r\n                default:\r\n                    console.error(\"Handle: \" + format);\r\n                    break;\r\n            }\r\n            view.push(annot);\r\n            return view;\r\n        }\r\n        async function doFieldOpen(field){\r\n            if(!entity || !field.pickerProperty) return;\r\n            let id;\r\n            let type = (entity[am7model.jsonModelKey] ? entity[am7model.jsonModelKey] : undefined);\r\n            let prop = field.pickerProperty.entity;\r\n            if(field.pickerType && !field.pickerType.match(/^self$/)) type = field.pickerType;\r\n            if(type.match(/^\\./)){\r\n                type = entity[type.slice(1)];\r\n            }\r\n            if(field.pickerProperty.selected === '{object}') id = entity[prop].objectId;\r\n            else id = entity[prop];\r\n            if(id && type){\r\n                if(typeof id == \"number\" || id.match(/^am:/)){\r\n                    let obj2 = await page.openObject(type, id);\r\n                    if(obj2 != null){\r\n                        id = obj2.objectId;\r\n                    }\r\n                }\r\n                let uri = \"/view/\" + type + \"/\" + id;\r\n                m.route.set(uri, {key: id});            \r\n            }\r\n            else{\r\n                console.warn(\"Missing id or type: \" + id + \", \" + type);\r\n            }\r\n        }\r\n\r\n        function doFieldClear(field){\r\n            if(!entity || !field.pickerProperty) return;\r\n            let prop = field.pickerProperty.entity;\r\n            if(field.pickerProperty.selected === '{object}' || typeof entity[prop] == \"string\") inst.api[prop](null);\r\n            else if(typeof entity[prop] == \"number\") inst.api[prop](0);\r\n            updateChange();\r\n\r\n            /// Clear the server cache because the parent may have a cached copy of the child\r\n            ///\r\n            if(prop === 'parentId'){\r\n                am7client.clearCache(entity[am7model.jsonModelKey], false, function(){});\r\n            }\r\n        }\r\n        function doFieldPicker(field, useName, altEntity, altPath, pickerHandler){\r\n            let useEntity = altEntity || entity;\r\n            if(!useEntity || !field.pickerProperty){\r\n                console.log(\"Invalid entity or field property\",useEntity,field);\r\n                return;\r\n            }\r\n            let mat;\r\n            let type = (entity[am7model.jsonModelKey] ? entity[am7model.jsonModelKey] : undefined);\r\n            let setType = false;\r\n            /// Special handling for embedding pickers in disconnected tables\r\n            ///\r\n            if(\r\n                field.pickerProperty.foreign\r\n                &&\r\n                useName\r\n                &&\r\n                (mat = useName.match(/(\\-\\d+)$/)) != null\r\n                &&\r\n                field.pickerType\r\n                &&\r\n                field.pickerType.match(/^\\./)\r\n            ){\r\n                // console.log(field.pickerType.slice(1) + mat[1]);\r\n                let el = document.querySelector(\"[name='\" + field.pickerType.slice(1) + mat[1] + \"']\");\r\n                type = el.value.toLowerCase();\r\n                setType = true;\r\n            }\r\n            else{\r\n                if(field.pickerType && field.pickerType !== 'self') type = field.pickerType;\r\n                if(type.match(/^\\./)){\r\n                    type = useEntity[type.slice(1)].toLowerCase();\r\n                }\r\n            }\r\n            if(!type.match(/^unknown$/gi)){\r\n                preparePicker(type, function(data){\r\n                    if(data && data.length){\r\n                        if(useEntity == inst.entity){\r\n                            \r\n                            if(field.pickerProperty.selected === '{object}'){\r\n                                if(field.pickerProperty.entity.match(/\\./)){\r\n                                    let pv = field.pickerProperty.entity.split(\".\");\r\n                                    if(pinst[pv[0]]){\r\n                                        inst[pv[0]].api(data[0]);\r\n                                        pinst[pv[0]].api[pv[1]](data[0]);\r\n                                    }\r\n                                    else{\r\n                                        console.warn(\"didn't find \" + pv[0]);\r\n                                    }\r\n                                }\r\n                                else{\r\n                                    inst.api[field.pickerProperty.entity](data[0]);\r\n                                }\r\n                            }\r\n                            else{\r\n                                console.log(\"Update\", field.pickerProperty.entity);\r\n                                inst.api[field.pickerProperty.entity](data[0][field.pickerProperty.selected]);\r\n                            }\r\n                            cancelPicker(true);\r\n                            if(setType){\r\n                                inst.api[field.pickerType.slice(1)](type);\r\n                            }\r\n\r\n                        }\r\n                        else{\r\n                            if(field.pickerProperty.selected === '{object}') useEntity[field.pickerProperty.entity] = data[0];\r\n                            else useEntity[field.pickerProperty.entity] = data[0][field.pickerProperty.selected];\r\n                            cancelPicker(true);\r\n                            if(setType){\r\n                                useEntity[field.pickerType.slice(1)] = type;\r\n                            }\r\n                        }\r\n                        updateChange();\r\n                        inst.action(useName);\r\n                        if(pickerHandler){\r\n                            pickerHandler(objectPage, inst, field, useName, data[0]);\r\n                        }\r\n                        /// Clear the server cache because the parent may have a cached copy of the child\r\n                        ///\r\n                        if(!useEntity[am7model.jsonModelKey] || useEntity[am7model.jsonModelKey].match(/message/i)) m.redraw();\r\n                        else{\r\n                            am7client.clearCache(useEntity[am7model.jsonModelKey], false, function(){\r\n                                m.redraw();\r\n                            });\r\n                        }\r\n                    }\r\n                }, altPath || field.pickerProperty.path);\r\n            }\r\n        }\r\n        function modelForm(active, type, form){\r\n            \r\n            if(pickerMode.enabled && active){\r\n                /// force the current form to inactive to make way for the list\r\n                active = false;\r\n            }\r\n            \r\n            if(form.model){\r\n                if(!inst){\r\n                    return \"\";\r\n                }\r\n                if(!form.property){\r\n                    console.warn(\"A property is required\");\r\n                    return m(\"div\", \"Property name required for form\");\r\n                }\r\n                let minst;\r\n                \r\n                if(!pinst[form.property]){\r\n\r\n                    let mf = am7model.getModelField(type, form.property);\r\n                    if(!mf || !mf.baseModel){\r\n                        console.warn(\"Property does not exist or does not define a baseModel\");\r\n                        return m(\"div\", \"Incorrect property cited for a model form\");\r\n                    }\r\n                    let mo = inst.api[form.property]();\r\n                    let oid;\r\n                    let cinst;\r\n                    if(mo){\r\n                        oid = mo.objectId;\r\n                    }\r\n                    else{\r\n                        mo = getPrimitive(mf.baseModel);\r\n                        inst.api[form.property](mo);\r\n                        /// force the model def because certain settings will result in an empty object\r\n                        mo[am7model.jsonModelKey] = mf.baseModel;\r\n\r\n                    }\r\n                    minst = am7model.prepareInstance(mo);\r\n                    pinst[form.property] = minst;\r\n                    oinst[form.property] = page.views.object();\r\n                }\r\n                else{\r\n                    minst = pinst[form.property];\r\n                }\r\n                let ooinst = oinst[form.property];\r\n                let props = {\r\n                    freeForm: true,\r\n                    freeFormEntity: minst.entity,\r\n                    freeFormType: minst.model.name,\r\n                    parentProperty: form.property,\r\n                    objectId: minst.entity.objectId,\r\n                    callerIndex: tabIndex,\r\n                    caller: objectPage,\r\n                    callerActive: active\r\n                  };\r\n                return m(ooinst.view, props);\r\n            }\r\n            \r\n\r\n\r\n            let outF = [];\r\n            Object.keys(form.fields).forEach((e)=>{\r\n                let field = form.fields[e].field || am7model.getModelField(type, e);\r\n                if(!field){\r\n                    console.warn(\"Failed to find field \" + e + \" for \" + type);\r\n                    console.warn(form);\r\n                }\r\n                else{\r\n                    outF.push(modelFieldContainer(e, form.fields[e], field));\r\n                }\r\n            });\r\n            return m(\"div\", {class: \"field-grid-6\" + (!active ? \" hidden\" : \"\")}, outF);\r\n\r\n        }\r\n        function modelPicker(active){\r\n            let pickList = \"\";\r\n            if(pickerMode.enabled && active){\r\n                pickList = m(listView, {\r\n                    type: pickerMode.type,\r\n                    objectId: pickerMode.containerId,\r\n                    startRecord: 0,\r\n                    recordCount: 0,\r\n                    pickerMode: true,\r\n                    pickerHandler : pickerMode.handler,\r\n                    pickerCancel : cancelPicker\r\n                });\r\n            }\r\n            return pickList;\r\n        }\r\n        function getForm(){\r\n            let type = objectType;\r\n            let form = inst.form;\r\n            if(!form){\r\n                console.error(\"Invalid form for \" + type);\r\n                return;\r\n            }\r\n            /// Need to keep pick list separate from the form for style reasons\r\n            ///\r\n            let forms = [];\r\n            let pickList;\r\n\r\n            let cactive = (callerIndex == undefined || callerActive);\r\n\r\n            let active = (tabIndex == 0) && cactive;\r\n\r\n            let mForm = modelForm(active, type, form);\r\n            if(active) pickList = modelPicker(active);\r\n            forms.push(mForm);\r\n            (form.forms || []).forEach((f, i)=>{\r\n                active = (tabIndex == (i + 1)) && cactive;\r\n                let cForm = am7model.forms[f];\r\n                if(!cForm){\r\n                    console.warn(\"Failed to find form \" + f);\r\n                }\r\n                else{\r\n                    mForm = modelForm(active, type, cForm);\r\n                    if(active) pickList = modelPicker(active);\r\n                    forms.push(mForm);\r\n                }\r\n            });\r\n            return [m(\"div\",{class: \"results-overflow\" + (pickerMode.enabled || designMode ? \" hidden\" : \"\") + (caller ? \" p-0 m-0\": \"\")}, forms), pickList];\r\n        }\r\n\r\n        function getFormTabs(){\r\n            if(!entity) return \"\";\r\n            let type = objectType;\r\n            let modType = inst.model;\r\n            if(!inst){\r\n                return \"\";\r\n            }\r\n            let form = inst.form;\r\n            if(!form){\r\n                console.warn(\"Invalid form for \" + type);\r\n                return;\r\n            }\r\n\r\n            let tabs = [];\r\n            let active = (tabIndex == 0);\r\n            tabs.push(buttonTab(active, form.label || type, function(){ switchTab(0);}));\r\n            form.forms.forEach((f, i)=>{\r\n                active = (tabIndex == (i+1));\r\n                let cForm = am7model.forms[f];\r\n                if(!cForm){\r\n                    console.warn(\"Failed to find form to construct tab \" + f);\r\n                }\r\n                else{\r\n                    let show = am7view.showField(inst, cForm);\r\n                    if(show) tabs.push(buttonTab(active, cForm.label || f, function(){ switchTab(i + 1);}));\r\n                }\r\n            });\r\n            return tabs;\r\n        }\r\n\r\n        function getFooter(){\r\n            let footer = \"\";\r\n            if(showFooter){\r\n                footer = m(\"div\",{class: \"result-nav-outer\"},[\r\n                m(\"div\",{class: \"result-nav-inner\"},[\r\n                    m(\"div\",{class: \"count-label\"},\"...\"),\r\n                        m(\"nav\",{class: \"result-nav\"},[\r\n                        \"Bottom\"\r\n                        ])\r\n                    ])\r\n                ]);\r\n            }\r\n            return footer;\r\n        }\r\n\r\n        function getObjectViewInner(){\r\n\r\n            let bNew = objectNew || parentNew;\r\n            let designable = (entity && entity.contentType && entity.contentType.match(/(^text\\/(css|plain)$|\\/x-javascript$)/gi)) ? true : false;\r\n\r\n            let altCls = '';\r\n            if(inst.changes.length){\r\n                altCls = ' warn';\r\n            }\r\n\r\n            let type = objectType;\r\n            let form = am7model.forms[type.substring(type.lastIndexOf(\".\") + 1)];\r\n            if(!form){\r\n                console.warn(\"Invalid form for \" + type);\r\n                return \"\";\r\n            }\r\n\r\n            let footer = getFooter();\r\n            return m(\"div\",{class : \"list-results-container\"},[\r\n                m(\"div\",{class : \"list-results\"},[\r\n                m(\"div\",{class: \"result-nav-outer\"},[\r\n                    m(\"div\",{class: \"result-nav-inner\"},[\r\n                        m(\"div\",{class: \"result-nav tab-container\"},[\r\n                            page.iconButton(\"button mr-4\", (fullMode ? \"close_fullscreen\" : \"open_in_new\"), \"\", toggleFullMode),\r\n                            page.iconButton(\"button\" + altCls,\"save\", \"\", doUpdate),\r\n                            (designable ? page.iconButton(\"button\" + (designMode ? \" active\" : \"\"),\"design_services\", \"\", toggleDesignMode) : \"\"),\r\n                            page.iconButton(\"button\",\"cancel\", \"\", doCancel),\r\n                            (bNew ? \"\" : page.iconButton(\"button\",\"content_copy\", \"\", doCopy)),\r\n                            (bNew ? \"\" : page.iconButton(\"button\",\"query_stats\", \"\", chatInto)),\r\n                            (bNew || type !== \"olio.charPerson\" ? \"\" : page.iconButton(\"button\",\"photo_library\", \"\", function(){ page.imageGallery([], inst); })),\r\n                            (bNew || type !== \"data.data\" ? \"\" : page.iconButton(\"button\",\"sell\", \"\", applyTags)),\r\n                            (bNew ? \"\" : page.iconButton(\"button\",\"delete_outline\", \"\", doDelete)),\r\n                            getFormCommands(type, form, null, false, false, true)\r\n                        ]),\r\n                        m(\"div\",{class: (designMode ? \" hidden\" : \"result-nav tab-container\")},\r\n                            getFormTabs()\r\n                        )\r\n                    ])\r\n                ]),\r\n                getForm(),\r\n                (designable ? m(page.components.designer, {entity:entity, visible: designMode, caller: objectPage}) : \"\"),\r\n                footer\r\n            ])\r\n        ]);\r\n        }\r\n        function getObjectView(){\r\n\r\n            return m(\"div\",{class : \"content-outer\"},[\r\n                (!entity || fullMode ? \"\" : m(page.components.navigation)),\r\n                m(\"div\",{class : \"content-main\"},[\r\n                    getObjectViewInner()\r\n            ])\r\n            ]);\r\n            \r\n        }\r\n        function getPrimitive(type){\r\n\r\n            let model = page.context();\r\n            let bNew = objectNew;//m.route.get().match(/^\\/new/gi);\r\n            let modType = am7model.getModel(type);\r\n            let primitive = am7model.newPrimitive(type);\r\n            let cobj;\r\n\r\n            if(bNew && (cobj = model.contextObjects[objectId])){\r\n                if(am7model.isGroup(modType)){\r\n                    \r\n                    if(type === 'auth.group'){\r\n                        primitive.parentId = cobj.id;\r\n                    }\r\n                    else{\r\n                        primitive.groupPath = cobj.path;\r\n                        primitive.groupId = cobj.id;\r\n                    }\r\n                    /// Note: org path is ignored on create, instead using the authenticated principle's organization, so this is only set for display purposes\r\n                    if(page.authenticated()) primitive.organizationPath = cobj.organizationPath;\r\n                }\r\n                else if(am7model.isParent(modType) && type.match(/^(auth\\.role|auth\\.permission)$/gi)){\r\n                    primitive.parentId = cobj.id;\r\n                    primitive.path = cobj.path;\r\n                }\r\n                else{\r\n                    console.warn(\"Handle not a group for \" + type);\r\n                }\r\n            }\r\n            if(model.pendingEntity){\r\n                Object.keys(model.pendingEntity).forEach((i) => {\r\n                    if(!i.match(/^(parentId|parentPath|groupPath)$/)){\r\n                        primitive[i] = model.pendingEntity[i];\r\n                    }\r\n                });\r\n                model.pendingEntity = undefined;\r\n            }\r\n\r\n            return primitive;\r\n        }\r\n\r\n        function setEntity(vnode){\r\n            let type = objectType;\r\n            valuesState = {};\r\n            foreignData = {};\r\n            pickerMode = {};\r\n            entity = null;\r\n            tabIndex = 0;\r\n\r\n            let model = page.context();\r\n            let bNew = objectNew;\r\n            let bPNew = parentNew;\r\n            let modType = am7model.getModel(type);\r\n            if(vnode && vnode.attrs.freeForm){\r\n                entity = vnode.attrs.freeFormEntity || {schema: objectType};\r\n                if(entity[am7model.jsonModelKey] && am7model.hasIdentity(entity)){\r\n                    let q = am7view.viewQuery(am7model.newInstance(type));\r\n                    /// Force query to include objectId - it's possible it wasn't requested for an embedded form, and doesn't belong in a common query suggestion\r\n                    /// This is because the membership operations depend on the objectId vs. the id or urn.\r\n                    ///\r\n                    if(am7model.hasField(type, \"objectId\") && !q.entity.request.filter(r => r == \"objectId\").length){\r\n                        q.entity.request.push(\"objectId\");\r\n                    }\r\n\r\n                    if(entity.id){\r\n                        q.field(\"id\", entity.id);    \r\n                    }\r\n                    else if(entity.objectId){\r\n                        q.field(\"objectId\", entity.objectId);\r\n                    }\r\n                    am7client.search(q, function(qr){\r\n                        if(qr && qr.count){\r\n                            let v = qr.results[0];\r\n                            entity = v;\r\n                            setApp(vnode);\r\n                        }\r\n                        else{\r\n                            console.warn(\"Failed to search for \" + q.key());\r\n                        }\r\n                    });\r\n                }\r\n                else{\r\n                    setApp(vnode);\r\n                }\r\n\r\n            }\r\n            else if(objectId){\r\n                if(!model.contextObjects[objectId]){\r\n                    let useType = type;\r\n                    if(bNew && am7model.isGroup(modType)) useType = 'auth.group';\r\n                    let q = am7view.viewQuery(am7model.newInstance(useType));\r\n                    q.field(\"objectId\", objectId);\r\n                    am7client.search(q, function(qr){\r\n                        if(qr && qr.count){\r\n                            let v = qr.results[0];\r\n                            model.contextObjects[objectId] = v;\r\n                            resetEntity((bPNew || bNew ? getPrimitive(type) : v));\r\n                            if(bPNew && am7model.isParent(modType)) entity.parentId = model.contextObjects[objectId].id;\r\n                            setApp(vnode);\r\n                        }\r\n                        else{\r\n                            console.warn(\"Failed to search for \" + q.key());\r\n                        }\r\n                    });\r\n                }\r\n                else{\r\n                    entity = ((bPNew || bNew) ? getPrimitive(type) : model.contextObjects[objectId]);\r\n                    if(bPNew && am7model.isParent(modType)) entity.parentId = model.contextObjects[objectId].id;\r\n                    setApp(vnode);\r\n                }\r\n            }\r\n            else{\r\n                console.warn(\"Should only hit this for non group / parent objects!!!\");\r\n                entity = getPrimitive(type);\r\n                setApp(vnode);\r\n            }\r\n        }\r\n        function resetEntity(e){\r\n            if(e && e[am7model.jsonModelKey]){\r\n                entity = e;\r\n            }\r\n            pinst = {};\r\n            oinst = {};\r\n            setInst();\r\n        }\r\n\r\n        function setInst(vnode){\r\n            inst = undefined;\r\n            pdfViewer = undefined;\r\n            if(entity){\r\n                if(vnode?.attrs?.freeFormInstance){\r\n                    inst = vnode?.attrs?.freeFormInstance;\r\n                }\r\n                else{\r\n                    let fname = entity[am7model.jsonModelKey].substring(entity[am7model.jsonModelKey].lastIndexOf(\".\") + 1);\r\n                    inst = am7model.prepareInstance(entity, am7model.forms[fname]);\r\n                }\r\n                \r\n                let mt = inst?.entity?.contentType;\r\n                if(mt && mt.match(/pdf$/i)){\r\n                    pdfViewer = page.components.pdf.viewer(inst);\r\n                }\r\n\r\n                inst.observe(objectPage);\r\n            }\r\n\r\n        }\r\n\r\n        \r\n\r\n        function setApp(vnode){\r\n            let ldraw = !inst;\r\n            if(entity[am7model.jsonModelKey]){\r\n                setInst(vnode);\r\n                if(!caller){\r\n                    window.dbgObj = objectPage;\r\n                    window.dbgInst = inst;\r\n                    window.dbgPinst = pinst;\r\n                }\r\n            }\r\n            if(caller){\r\n                caller.callback('set', objectPage, inst, undefined, parentProperty);\r\n            }\r\n            else{\r\n                postRender();\r\n                m.redraw();\r\n            }\r\n        }\r\n\r\n        function preparePicker(type, handler, altPath){\r\n\r\n            return new Promise((res, rej)=>{\r\n\r\n                let model = am7model.getModel(type);\r\n                if(!model){\r\n                    console.error(\"Invalid model for '\" + type + \"'\");\r\n                    rej();\r\n                }\r\n                pickerMode.tabIndex = tabIndex;\r\n                pickerMode.type = type;\r\n                pickerMode.handler = handler;\r\n                if(am7model.isGroup(model) || am7model.isParent(model)) pickerMode.pickPath = altPath || am7view.path(type);\r\n                if(am7model.isGroup(model)){\r\n                    am7client.make(\"auth.group\",\"data\", pickerMode.pickPath, function(v){\r\n                        pickerMode.containerId = v.objectId;\r\n\r\n                        enablePicker();\r\n                        res();\r\n                    });\r\n                }\r\n                else if(type.match(/^(auth\\.role|auth\\.permission)$/)){\r\n                    am7client.user(type, \"user\", function(v){\r\n                        uwm.getDefaultParentForType(type, v).then((parObj) =>{\r\n                            pickerMode.containerId = parObj.objectId;\r\n\r\n                            enablePicker();\r\n                            res();\r\n                        });\r\n                    });\r\n\r\n                }\r\n                else if(type.match(/^system\\.user$/)){\r\n                    enablePicker();\r\n                    res();\r\n                }\r\n                else{\r\n                    console.warn(\"Handle pick \" + type);\r\n                }\r\n            });\r\n        }\r\n        \r\n        objectPage.mergeEntity = function(e, s, baseModel){\r\n            let ue = s || entity;\r\n            if(!e){\r\n                return;\r\n            }\r\n            if(!e[am7model.jsonModelKey]) e[am7model.jsonModelKey] = ue[am7model.jsonModelKey] || baseModel;\r\n            if(!e[am7model.jsonModelKey]){\r\n                console.warn(\"Cannot find model\", e);\r\n                return;\r\n            }\r\n\r\n            let x = Object.assign(ue, e);\r\n            let af = am7model.getModelFields(e[am7model.jsonModelKey]);\r\n            af.forEach(f => {\r\n                if((f.type == 'list' || f.type == 'model') && f.foreign && f.baseModel){\r\n                    if(f.type == 'model' && !ue[f.name] && e[f.name]){\r\n                        ue[f.name] = getPrimitive(f.baseModel);\r\n                    }\r\n                    else if(f.type == 'list'){\r\n                        ue[f.name] = [];\r\n                        for(let c in e[f.name]){\r\n                            ue[f.name].push(getPrimitive(f.baseModel));\r\n                        }\r\n                    }\r\n                    if(e[f.name] ){\r\n                        objectPage.mergeEntity(entity[f.name], e[f.name], f.baseModel);\r\n                    }\r\n                }\r\n            });\r\n            \r\n            am7model.applyModelNames(x);\r\n            if(!s) resetEntity(x);\r\n\r\n        };\r\n        objectPage.resetEntity = resetEntity;\r\n        objectPage.getModel = function(name, fieldView, field, fieldClass){\r\n            console.log(name, fieldView, field, fieldClass);\r\n            return entity[am7model.jsonModelKey];\r\n        }\r\n        \r\n        objectPage.objectControls = function(name, field){\r\n            return page.components.membership.objectControls(getMembershipContext(field), name, field);\r\n        };\r\n\r\n        objectPage.objectRequests = function(name, field){\r\n            return page.components.membership.objectRequests(getMembershipContext(field), name, field);\r\n        };\r\n\r\n\r\n        objectPage.deleteChild = function(name, field, tableType, tableForm, props){\r\n            return page.components.membership.deleteChild(getMembershipContext(field), name, field, tableType, tableForm, props);\r\n        };\r\n\r\n        objectPage.addChild = function(name, field, tableType, tableForm, props){\r\n            return page.components.membership.addChild(getMembershipContext(field), name, tableType, tableForm, props);\r\n        };\r\n\r\n        /// Helper to build membership context\r\n        function getMembershipContext(field) {\r\n            return {\r\n                entity: entity,\r\n                inst: inst,\r\n                field: field,\r\n                valuesState: valuesState,\r\n                foreignData: foreignData,\r\n                caller: caller,\r\n                objectPage: objectPage,\r\n                parentProperty: parentProperty,\r\n                preparePicker: preparePicker,\r\n                cancelPicker: cancelPicker,\r\n                updateChange: updateChange\r\n            };\r\n        }\r\n\r\n        /// Helper to build table entry context\r\n        function getTableEntryContext() {\r\n            return {\r\n                entity: entity,\r\n                inst: inst,\r\n                valuesState: valuesState,\r\n                foreignData: foreignData,\r\n                resetValuesState: function() {\r\n                    valuesState = {};\r\n                }\r\n            };\r\n        }\r\n\r\n        objectPage.addEntity = function(name, field, tableType, tableForm, props){\r\n            return page.components.membership.addEntity(getMembershipContext(field), name, tableType, tableForm, props);\r\n        };\r\n\r\n        objectPage.openEntity = function(name, field, tableType, tableForm, props){\r\n            return page.components.membership.openEntity(getMembershipContext(field), name, field, tableType, tableForm, props);\r\n        };\r\n\r\n        objectPage.deleteEntity = function(name, field, tableType, tableForm, props){\r\n            return page.components.membership.deleteEntity(getMembershipContext(field), name, field, tableType, tableForm, props);\r\n        };\r\n\r\n        objectPage.deleteMember = function(name, field, tableType, tableForm){\r\n            return page.components.membership.deleteMember(getMembershipContext(field), name, field, tableType, tableForm);\r\n        };\r\n\r\n        objectPage.addMember = function(name, field, tableType, tableForm, props){\r\n            return page.components.membership.addMember(getMembershipContext(field), name, field.baseModel, tableForm, props);\r\n        }\r\n\r\n        objectPage.memberObjects = function(name, field){\r\n            return page.components.membership.memberObjects(getMembershipContext(field), name, field);\r\n        };\r\n\r\n        objectPage.objectMembers = function(name, field){\r\n            return page.components.membership.objectMembers(getMembershipContext(field), name, field);\r\n        };\r\n\r\n        objectPage.editEntry = function(){\r\n            return page.components.tableEntry.editEntry(getTableEntryContext());\r\n        };\r\n\r\n        objectPage.deleteEntry = function(name){\r\n            return page.components.tableEntry.deleteEntry(getTableEntryContext(), name);\r\n        };\r\n\r\n        objectPage.newEntry = function(name){\r\n            return page.components.tableEntry.newEntry(getTableEntryContext(), name);\r\n        };\r\n\r\n        objectPage.checkEntry = function(name, field, tableType, tableForm, props){\r\n            return page.components.tableEntry.checkEntry(getTableEntryContext(), name, field, tableType, tableForm, props);\r\n        };\r\n\r\n        objectPage.cancelEntry = function(name){\r\n            return page.components.tableEntry.cancelEntry(getTableEntryContext(), name);\r\n        };\r\n\r\n        objectPage.getEntity = function(){\r\n            return entity;\r\n        };\r\n        objectPage.getInstance = function(){\r\n            return inst;\r\n        };\r\n        objectPage.preparePicker = preparePicker;\r\n        objectPage.pickerMode = function(){ return pickerMode;};\r\n        objectPage.enablePicker = enablePicker;\r\n        objectPage.cancelPicker = cancelPicker;\r\n\r\n        objectPage.setChildPickerMode = function(p){\r\n            console.log(p);\r\n            childPickerMode = p;\r\n        };\r\n\r\n        objectPage.pickerEnabled = function(){\r\n            return pickerMode.enabled;\r\n        };\r\n\r\n        objectPage.endPicker = function(){\r\n            pickerMode.enabled = false;\r\n            m.redraw();\r\n        };\r\n\r\n        objectPage.clear = function(){\r\n            if(pdfViewer){\r\n                pdfViewer.clear();\r\n            }\r\n\r\n            pdfViewer = undefined;\r\n            \r\n            if(app) app.destroy();\r\n            entity = null;\r\n            inst = null;\r\n            app = null;\r\n\r\n            /// don't clear pendingEntity\r\n            /// pendingEntity = undefined;\r\n            pendingResponse = undefined;\r\n            definition = undefined;\r\n\r\n            tabIndex = 0;\r\n            pickerMode = {clear:true};\r\n            fullMode = false;\r\n            designMode = false;\r\n        };\r\n\r\n        objectPage.makeFact = async function(name, field, tableType, tableForm, props){\r\n            let path = am7view.path(\"fact\");\r\n            let group = await page.findObject(\"auth.group\", \"data\", path);\r\n            let gpath = \"/new/fact/\" + group.objectId;\r\n\r\n            if(!name.match(/^(auth\\.group|auth\\.role|auth\\.permission|identity\\.person|identity\\.account|system\\.user|data\\.data|policy\\.function|policy\\.operation)$/gi)){\r\n                console.error(\"Unsupported fact import type \" + (entity ? entity.urn : \"null\"));\r\n                return;\r\n            }\r\n            let fact = am7model.newPrimitive(\"fact\");\r\n            fact.factType = \"FACTORY\";\r\n            fact.sourceType = \"unknown\";\r\n            if(name.match(/^role$/gi)){\r\n                fact.factType = \"role\";\r\n                fact.sourceType = entity.type;\r\n            }\r\n            else if(name.match(/^permission$/gi)){\r\n                fact.factType = \"static\";\r\n                fact.sourceType = entity.type;\r\n            }\r\n            else if(name.match(/^auth\\.group$/gi)){\r\n                fact.factType = \"permission\";\r\n                fact.sourceType = entity.type;\r\n            }\r\n            fact.sourceUrn = entity.urn;\r\n            fact.factoryType = entity[am7model.jsonModelKey];\r\n            fact.name = entity.name + \" Fact\";\r\n            fact.description = \"Fact representing a relative link to \" + entity.name + \" as \" + entity.urn + \" in organization \" + entity.organizationPath;\r\n\r\n            /// Note: Adding a key because cycling through the same view with different objects needs a full DOM rebuild to correctly disconnect the sync code\r\n            ///\r\n            page.context().pendingEntity = fact;\r\n            console.log(\"Pend Out\", fact);\r\n            m.route.set(gpath, {key: Date.now()});\r\n        };\r\n\r\n        objectPage.reimage = async function(name, field, tableType, tableForm, props){\r\n            if(inst && page.components.dialog.reimage){\r\n                page.components.dialog.reimage(entity, inst);\r\n            }\r\n        };\r\n\r\n        objectPage.reimageApparel = async function(name, field, tableType, tableForm, props){\r\n            if(inst && page.components.dialog.reimageApparel){\r\n                page.components.dialog.reimageApparel(entity, inst);\r\n            }\r\n        };\r\n\r\n        objectPage.showOutfitBuilder = async function(name, field, tableType, tableForm, props){\r\n            if(inst && page.components.dialog.showOutfitBuilder){\r\n                page.components.dialog.showOutfitBuilder(entity, inst);\r\n            }\r\n        };\r\n\r\n        objectPage.startGameWithCharacter = async function(name, field, tableType, tableForm, props){\r\n            if(inst && page.components.dialog.startGameWithCharacter){\r\n                page.components.dialog.startGameWithCharacter(entity, inst);\r\n            }\r\n        };\r\n\r\n        objectPage.adoptCharacter = async function(name, field, tableType, tableForm, props){\r\n            if(inst && page.components.dialog.adoptCharacter){\r\n                page.components.dialog.adoptCharacter(entity, inst);\r\n            }\r\n        };\r\n\r\n        objectPage.loadApparelGallery = async function(name, field) {\r\n            console.log(\"Load gallery\");\r\n            if(entity.gallery && entity.gallery.length) return entity.gallery;\r\n            if(!entity.name) return [];\r\n            // Query images from ~/Gallery/Apparel/{apparel name} group\r\n            let groupPath = \"~/Gallery/Apparel/\" + entity.name;\r\n            let grp = await page.makePath(\"auth.group\", \"DATA\", groupPath);\r\n            if(!grp) return [];\r\n            let q = am7client.newQuery(\"data.data\");\r\n            q.field(\"groupId\", grp.id);\r\n            q.entity.request.push(\"id\", \"objectId\", \"name\", \"groupId\", \"groupPath\", \"contentType\", \"attributes\");\r\n            q.range(0, 100);\r\n            q.sort(\"createdDate\");\r\n            q.order(\"descending\");\r\n            let qr = await page.search(q);\r\n            let images = [];\r\n            console.log(qr?.results);\r\n            if(qr && qr.results) {\r\n                images = qr.results.filter(r => r.contentType && r.contentType.match(/^image\\//i));\r\n                entity.gallery = images;\r\n            }\r\n            return images;\r\n        };\r\n\r\n        objectPage.execute = function(name, field, type, form, properties){\r\n            pendingResponse = undefined;\r\n            am7client.executeScript(entity.urn, function(v){\r\n                pendingResponse = v;\r\n                m.redraw();\r\n            });\r\n        };\r\n\r\n        objectPage.evaluate = function(name, field, type, form, properties){\r\n            if(!definition){\r\n                console.error(\"Expected definition\");\r\n                return;\r\n            }\r\n            let prq = azn.createPolicyRequest(definition);\r\n            prq.facts.forEach((p, i)=>{\r\n                let e = document.querySelector(\"input[name=parameter-\" + i + \"]\");\r\n                p.factData = e.value;\r\n                p.sourceUrn = e.value;\r\n            });\r\n            console.log(prq);\r\n            am7client.evaluate(prq, function(v){\r\n                if(v === null) pendingResponse = \"Error\";\r\n                else pendingResponse = v.response;\r\n                console.log(v);\r\n                m.redraw();\r\n            });\r\n        };\r\n\r\n        objectPage.define = function(){\r\n            if(definition){\r\n                return definition.parameters.map((p, i)=>{\r\n                    return m(\"tr\", [\r\n                        m(\"td\", p.name),\r\n                        m(\"td\", p.factoryType),\r\n                        m(\"td\", m(\"input\", {name: \"parameter-\" + i, type: \"text\", class: \"text-field-full\", placeholder: \"\"}))\r\n                    ]);\r\n                });\r\n            }\r\n            else if(definition === null){\r\n                return [m(\"tr\",m(\"td\",\"Error\"))];\r\n            }\r\n            else{\r\n                am7client.define(entity.objectId, function(v){\r\n                    definition = v;\r\n                    m.redraw();\r\n                });\r\n                return [];\r\n            }\r\n        };\r\n\r\n        objectPage.objectExecute = function(name, fieldView, field, fieldClass, hidden){\r\n            let cmds = [];\r\n            let rows = [];\r\n            if(!field){\r\n                return rows;\r\n            }\r\n            let form = fieldView.form;\r\n            if(!form){\r\n                console.warn(\"Expected form\");\r\n                return rows;\r\n            }\r\n            if(fieldView.properties && fieldView.properties.prepare){\r\n                rows.push(objectPage[fieldView.properties.prepare]());\r\n            }\r\n\r\n            cmds = getFormCommandView(name, fieldView.form, field, false, false);\r\n\r\n            if(pendingResponse){\r\n                rows.push(m(\"tr\", m(\"td\", \r\n                    (typeof pendingResponse == \"object\" ? JSON.stringify(pendingResponse) : pendingResponse)\r\n                )));\r\n            }\r\n            return [cmds, m(\"table\",{class: fieldClass}, rows)];\r\n        };\r\n        objectPage.tabIndex = function(){\r\n            return tabIndex;\r\n        };\r\n        objectPage.caller = function(){\r\n            return caller;\r\n        };\r\n        objectPage.report = function(stype, obj, cinst){\r\n            if(caller){\r\n                caller.callback(stype, obj, cinst, undefined, parentProperty);\r\n            }\r\n        };\r\n\r\n        objectPage.callback = function(stype, obj, cinst, cname, pname){\r\n            if(pname && !inst.changes.includes(pname)){\r\n                inst.changes.push(pname);\r\n            }\r\n            if(stype == 'set'){\r\n                if(cinst){\r\n                    pinst[pname] = cinst;\r\n                }\r\n            }\r\n            else if(stype == 'update'){\r\n                /// If the child object doesn't have an identity, and the current object doesn't have an identity, then let the initial create handle it\r\n\r\n                if(!am7model.hasIdentity(cinst.entity)){\r\n                    if(am7model.hasIdentity(inst.entity)){\r\n                        /// create cinst\r\n                        /// check for reference\r\n\r\n                    }\r\n                    else{\r\n                        /// nothing to do, let it be picked up by default nested create\r\n                        ///\r\n                        console.log(\"Handle with entity create \" + pname);\r\n                    }\r\n                }\r\n                else{\r\n                    /// Handled as patch operation in doUpdate\r\n                    let uname = cname || pname;\r\n                    let fld = am7model.getModelField(cinst.entity[am7model.jsonModelKey], uname);\r\n                    if(fld && fld.type == \"list\" && fld.foreign && fld.baseType == \"model\"){\r\n                        console.log(\"Patch member\", obj);\r\n                        let members = cinst.api[uname]();\r\n                        let aP = [];\r\n                        members.forEach((t)=>{\r\n                            aP.push(new Promise((res, rej)=>{\r\n                                console.log(uname);\r\n                                console.log(cinst.entity[am7model.jsonModelKey], inst.api[pname]().objectId, t[am7model.jsonModelKey], t.objectId);\r\n                                am7client.member(cinst.entity[am7model.jsonModelKey], inst.api[pname]().objectId, uname, t[am7model.jsonModelKey], t.objectId, true, function(v){\r\n                                    res(v);\r\n                                })\r\n                            }));\r\n                        });\r\n                        Promise.all(aP).then(()=>{\r\n                            m.redraw();\r\n                        });\r\n                    }\r\n                    else{\r\n                        /// Nothing to do - parent was updated\r\n                    }\r\n                }\r\n                \r\n            }\r\n        };\r\n        objectPage.picker = doFieldPicker;\r\n        objectPage.view = {\r\n            debug: function(){\r\n                return foreignData;\r\n            },\r\n            oninit : function(x){\r\n                fullMode = x.attrs.fullMode || fullMode;\r\n                embeddedMode = x.attrs.embeddedMode;\r\n                embeddedController = x.attrs.embeddedController;\r\n                objectType = x.attrs.freeFormType || x.attrs.type || m.route.param(\"type\");\r\n                objectId = x.attrs.objectId || m.route.param(\"objectId\");\r\n                objectNew = x.attrs.new || m.route.get().match(/^\\/new/gi);\r\n                parentNew = x.attrs.parentNew || m.route.get().match(/^\\/pnew/gi);\r\n                parentProperty = x.attrs.parentProperty;\r\n                caller = x.attrs.caller;\r\n                if(x.attrs.pickerCfg){\r\n                    pickerMode = x.attrs.pickerCfg;\r\n                }\r\n                setEntity(x);\r\n\r\n            },\r\n            sync: function(){\r\n                \r\n            },\r\n            oncreate : function (x) {\r\n                page.navigable.setupPendingContextMenus();\r\n            },\r\n            onupdate : function(x){\r\n                page.navigable.setupPendingContextMenus();\r\n                postRender();\r\n            },\r\n            onunload : function(x){\r\n\r\n            },\r\n            onremove : function(x){\r\n                objectPage.clear();\r\n                page.navigable.cleanupContextMenus();\r\n            },\r\n\r\n            view: function (vnode) {\r\n                callerIndex = vnode.attrs.callerIndex;\r\n                callerActive = vnode.attrs.callerActive;\r\n\r\n                if(!page.authenticated() || !inst) return m(\"\");\r\n                if(vnode.attrs.freeForm){\r\n                    return getForm();\r\n                }                    \r\n                else if(embeddedMode) return [getObjectViewInner(), page.components.dialog.loadDialog(), page.loadToast()];\r\n                else return [getObjectView(), page.components.dialog.loadDialog(), page.loadToast()];\r\n            }\r\n        };\r\n        return objectPage;\r\n    }\r\n    page.views.object = newObjectPage;\r\n}());\r\n\n\n;/* === client/view/navigator.js === */\n(function(){\r\n\r\n    function newNavigatorControl(){\r\n  \r\n        const navigator = {};\r\n        let fullMode = false;\r\n        let showFooter = false;\r\n        let pagination = page.pagination();\r\n        let listView;\r\n        let treeView;\r\n        let altView;\r\n\r\n        function getNavigatorTopMenuView(){\r\n          /*\r\n          return m(\"div\", {class: \"result-nav-outer\"}, [\r\n            m(\"div\", {class: \"result-nav-inner\"}, [\r\n              m(\"div\", {class: \"result-nav\"}, [\r\n                m(\"button\", {class: \"button\"}, m(\"span\", {class: \"material-icons material-icons-24\"}, \"save\"))\r\n              ]),\r\n              m(\"div\", {class: \"result-nav\"}, [\r\n                m(\"button\", {class: \"button\"}, [m(\"span\", {class: \"material-icons material-icons-24\"}, \"tab\"), \" Meta\"])\r\n              ])\r\n            ])\r\n          ])\r\n          */\r\n         return [];\r\n        }\r\n\r\n        function getSplitContainerView(){\r\n          let splitLeft = \"\";\r\n          if(!fullMode) splitLeft = getSplitLeftContainerView();\r\n          return m(\"div\", {class: \"results-fixed\", onselectstart: function(e){ e.preventDefault();}},\r\n            m(\"div\", {class: \"splitcontainer\"}, [\r\n              splitLeft,\r\n              getSplitRightContainerView()\r\n            ])\r\n          );\r\n        }\r\n\r\n        function getSplitRightContainerView(){\r\n          let cls = \"splitrightcontainer\";\r\n          if(fullMode) cls = \"splitfullcontainer\";\r\n          return m(\"div\", {class: cls}, [\r\n              getResultsView()     \r\n          ]);\r\n        }\r\n\r\n        function getSplitLeftContainerView(){\r\n          let tree = m(treeView, {\r\n            origin,\r\n            list:listView\r\n          });\r\n          return m(\"div\", {\r\n            class: \"splitleftcontainer\",\r\n            ondragover: function(e){\r\n              e.preventDefault();\r\n            }\r\n          }, [\r\n            //m(\"div\", {class: \"splitoverflow\"}, [\r\n              tree\r\n            //])\r\n          ]);\r\n        }\r\n        function getResultsView(){\r\n          let ret = \"\";\r\n          let mtx = treeView.selectedNode();\r\n          if(!mtx) return ret;\r\n          if(altView){\r\n            return m(altView.view.view, {\r\n              fullMode,\r\n              type: altView.type,\r\n              objectId: altView.containerId,\r\n              new: altView.new,\r\n              parentNew: altView.parentNew,\r\n              embeddedMode: true,\r\n              embeddedController: navigator\r\n            });\r\n  \r\n          }\r\n          // console.log(mtx);\r\n          return m(listView.view, {\r\n            fullMode,\r\n            type: mtx.listEntityType,\r\n            objectId: mtx.id,\r\n            startRecord: 0,\r\n            recordCount: 0,\r\n            embeddedMode: true,\r\n            embeddedController: navigator\r\n          });\r\n        }\r\n\r\n        function getNavigatorBottomMenuView(){\r\n          if(!showFooter) return \"\";\r\n\r\n          return m(\"div\", {class: \"result-nav-outer\"}, \r\n            m(\"div\", {class: \"result-nav-inner\"}, [\r\n              m(\"div\", {class: \"result-nav\"}, \"...\"),\r\n              m(\"div\", {class: \"result-nav\"}, \"Bottom\")\r\n            ])\r\n          );\r\n        }\r\n      \r\n        function getNavigatorView(vnode){\r\n            return m(\"div\",{class : \"content-outer\"},[\r\n              (fullMode ? \"\" : m(page.components.navigation, {hideBreadcrumb: true})),\r\n              m(\"div\",{class : \"content-main\"},\r\n                m(\"div\", {class: \"list-results-container\"},\r\n                  m(\"div\", {class: \"list-results\"}, [\r\n                    getNavigatorTopMenuView(),\r\n                    getSplitContainerView(),\r\n                    getNavigatorBottomMenuView()\r\n                  ])\r\n                )\r\n              )\r\n            ]);\r\n        }\r\n        \r\n        navigator.toggleFullMode = function(){\r\n          fullMode = !fullMode;\r\n          m.redraw();\r\n        }\r\n\r\n        navigator.cancelView = function(){\r\n          altView = undefined;\r\n          fullMode = false;\r\n          m.redraw();\r\n        };\r\n\r\n        navigator.editItem = function(object){\r\n          if(!object) return;\r\n          altView = {\r\n            fullMode,\r\n            view: page.views.object(),\r\n            type: object[am7model.jsonModelKey],\r\n            containerId: object.objectId\r\n          };\r\n          m.redraw();\r\n        };\r\n\r\n        navigator.addNew = function(type, containerId, parentNew){\r\n          altView = {\r\n            fullMode,\r\n            view: page.views.object(),\r\n            type,\r\n            containerId,\r\n            parentNew,\r\n            new: true\r\n          };\r\n          m.redraw();\r\n        };\r\n        navigator.view = {\r\n            oninit : function(vnode){\r\n                let ctx = page.user.homeDirectory;\r\n                // if(am7community.getCommunityMode()) ctx = am7community.getCommunityProjectGroup();\r\n                origin = vnode.attrs.origin || ctx;\r\n                if(!listView) listView = page.views.list();\r\n                if(!treeView) treeView = page.components.tree();\r\n                //if(!objectView) objectView = page.views.object();\r\n                //document.documentElement.addEventListener(\"keydown\", navListKey);\r\n            },\r\n            oncreate : function (x) {\r\n              // app = page.space(entityName, x, pagination.entity);\r\n            },\r\n            onupdate : function(x){\r\n\r\n            },\r\n            onremove : function(x){\r\n              // document.documentElement.removeEventListener(\"keydown\", navListKey);\r\n              page.navigable.cleanupContextMenus();\r\n              pagination.stop();\r\n              // if(app) app.destroy();\r\n            },\r\n  \r\n            view: function (vnode) {\r\n              let v = getNavigatorView(vnode);\r\n                return [v, page.components.dialog.loadDialog(), page.loadToast()];\r\n            }\r\n        };\r\n        return navigator;\r\n    }\r\n      page.views.navigator = newNavigatorControl;\r\n  }());\r\n  \n\n;/* === client/view/chat.js === */\n\r\n(function () {\r\n\r\n  am7model.forms.chatRequest = {\r\n    label: \"Chat Request\",\r\n    commands: {\r\n      cmdPeek: {\r\n        label: 'Peek',\r\n        icon: 'man',\r\n        action: 'doPeek'\r\n      }\r\n    },\r\n    fields: {\r\n      prompt: {\r\n        layout: 'full',\r\n        format: 'list'\r\n      },\r\n      chat: {\r\n        layout: 'full',\r\n        format: 'list'\r\n      },\r\n\r\n      session: {\r\n        layout: 'full'\r\n      }\r\n    }\r\n  };\r\n  /// TODO: There are two different methods for constructing the object view: 1) the newer generic am7view, and 2) the legacy though still more complex object component view\r\n  /// So some form fields are not interoperable, like 'list' for am7view must be 'select' for the object component view.\r\n  am7model.forms.newChatRequest = {\r\n    label: \"Chat Request\",\r\n    fields: {\r\n      promptConfig: {\r\n        layout: 'third',\r\n        format: 'picker',\r\n        field: {\r\n          format: 'picker',\r\n          pickerType: \"olio.llm.promptConfig\",\r\n          pickerProperty: {\r\n            selected: \"{object}\",\r\n            entity: \"promptConfig\"\r\n          },\r\n          label: \"Prompt Config\"\r\n        }\r\n      },\r\n      chatConfig: {\r\n        layout: 'third',\r\n        format: 'picker',\r\n        field: {\r\n          format: 'picker',\r\n          pickerType: \"olio.llm.chatConfig\",\r\n          pickerProperty: {\r\n            selected: \"{object}\",\r\n            entity: \"chatConfig\"\r\n          },\r\n          label: \"Chat Config\"\r\n        }\r\n      },\r\n      name: {\r\n        label: \"Chat Name\",\r\n        layout: 'third'\r\n      },\r\n      setting: {\r\n        label: \"Setting\",\r\n        layout: 'full'\r\n      }\r\n    }\r\n  };\r\n\r\n  function newChatControl() {\r\n\r\n    let inst;\r\n    const chat = {};\r\n    let fullMode = false;\r\n    let showFooter = false;\r\n    let pagination = page.pagination();\r\n    let listView;\r\n    let treeView;\r\n    let altView;\r\n    let aPCfg;\r\n    let aCCfg;\r\n    let aSess;\r\n    let audioText = \"\";\r\n    let chatCfg = newChatConfig();\r\n\r\n    let camera = false;\r\n    let audio = false;\r\n\r\n    let hideThoughts = true;\r\n    let editIndex = -1;\r\n    let editMode = false;\r\n\r\n    let profile = false;\r\n\r\n    // Image token state\r\n    let resolvingImages = {};\r\n    let showTagSelector = false;\r\n    let selectedImageTags = [];\r\n\r\n    // Patch image tokens on the server request, then reload history to stay in sync\r\n    // replacements: array of {from: unresolvedTokenStr, to: resolvedTokenStr}\r\n    async function patchChatImageToken(replacements) {\r\n        if (!inst || !replacements || !replacements.length) return;\r\n        try {\r\n            let sessionType = inst.api.sessionType();\r\n            let session = inst.api.session();\r\n            if (!sessionType || !session || !session.id) {\r\n                console.warn(\"patchChatImageToken: No session available for server patch\");\r\n                return;\r\n            }\r\n            // Load the full request from the server\r\n            let q = am7view.viewQuery(am7model.newInstance(sessionType));\r\n            q.field(\"id\", session.id);\r\n            let qr = await page.search(q);\r\n            if (qr && qr.results && qr.results.length > 0) {\r\n                let req = qr.results[0];\r\n                if (req.messages) {\r\n                    let patched = false;\r\n                    // Search server messages for unresolved tokens and replace them\r\n                    for (let i = req.messages.length - 1; i >= 0; i--) {\r\n                        let serverMsg = req.messages[i];\r\n                        if (!serverMsg.content) continue;\r\n                        for (let r of replacements) {\r\n                            if (serverMsg.content.indexOf(r.from) !== -1) {\r\n                                serverMsg.content = serverMsg.content.replace(r.from, r.to);\r\n                                patched = true;\r\n                            }\r\n                        }\r\n                    }\r\n                    if (patched) {\r\n                        await page.patchObject(req);\r\n                        // Reload history from server so local state matches\r\n                        let h = await getHistory();\r\n                        if (h) {\r\n                            chatCfg.history = h;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error(\"patchChatImageToken server error:\", e);\r\n        }\r\n    }\r\n\r\n    // Resolve all image tokens in a message (chat.js version)\r\n    async function resolveChatImages(msgIndex) {\r\n        let msgs = chatCfg.history?.messages;\r\n        if (!msgs || !msgs[msgIndex]) return;\r\n        if (!window.am7imageTokens) return;\r\n        let msg = msgs[msgIndex];\r\n        if (!msg.content) return;\r\n\r\n        let tokens = window.am7imageTokens.parse(msg.content);\r\n        if (!tokens.length) return;\r\n\r\n        let character = msg.role === \"user\" ? chatCfg.user : chatCfg.system;\r\n        if (!character) return;\r\n\r\n        let replacements = [];\r\n\r\n        for (let token of tokens) {\r\n            if (token.id && window.am7imageTokens.cache[token.id]) continue;\r\n\r\n            let resolved = await window.am7imageTokens.resolve(token, character);\r\n            if (resolved && resolved.image) {\r\n                if (!token.id) {\r\n                    let newToken = \"${image.\" + resolved.image.objectId + \".\" + token.tags.join(\",\") + \"}\";\r\n                    replacements.push({from: token.match, to: newToken});\r\n                }\r\n            }\r\n        }\r\n\r\n        if (replacements.length) {\r\n            await patchChatImageToken(replacements);\r\n        }\r\n        m.redraw();\r\n    }\r\n\r\n    // Process content string: replace image tokens with HTML for resolved images or placeholders\r\n    function processImageTokensInContent(content, msgRole, msgIndex) {\r\n        if (!content || !window.am7imageTokens) return content;\r\n        let tokens = window.am7imageTokens.parse(content);\r\n        if (!tokens.length) return content;\r\n\r\n        // Trigger resolution for unresolved/uncached tokens\r\n        if (!resolvingImages[msgIndex]) {\r\n            let needsResolution = tokens.some(t => !t.id || !window.am7imageTokens.cache[t.id]);\r\n            if (needsResolution) {\r\n                resolvingImages[msgIndex] = true;\r\n                resolveChatImages(msgIndex).then(function() {\r\n                    resolvingImages[msgIndex] = false;\r\n                });\r\n            }\r\n        }\r\n\r\n        // Replace tokens with HTML\r\n        let result = content;\r\n        for (let i = tokens.length - 1; i >= 0; i--) {\r\n            let token = tokens[i];\r\n            let html;\r\n            if (token.id && window.am7imageTokens.cache[token.id]) {\r\n                let cached = window.am7imageTokens.cache[token.id];\r\n                html = '<img src=\"' + cached.url + '\" class=\"max-w-[256px] rounded-lg my-2 cursor-pointer\" onclick=\"page.imageView(window.am7imageTokens.cache[\\'' + token.id + '\\'].image)\" />';\r\n            } else {\r\n                html = '<span class=\"inline-flex items-center gap-1 px-2 py-1 rounded bg-gray-500/30 text-xs my-1\"><span class=\"material-symbols-outlined text-xs\">photo_camera</span>' + token.tags.join(\", \") + '...</span>';\r\n            }\r\n            result = result.substring(0, token.start) + html + result.substring(token.end);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    function toggleImageTag(tag) {\r\n        let idx = selectedImageTags.indexOf(tag);\r\n        if (idx > -1) {\r\n            selectedImageTags.splice(idx, 1);\r\n        } else {\r\n            selectedImageTags.push(tag);\r\n        }\r\n    }\r\n\r\n    function insertImageToken() {\r\n        if (!selectedImageTags.length) return;\r\n        let token = \"${image.\" + selectedImageTags.join(\",\") + \"}\";\r\n        let input = document.querySelector(\"[name='chatmessage']\");\r\n        if (input) {\r\n            input.value = (input.value ? input.value + \" \" : \"\") + token;\r\n        }\r\n        selectedImageTags = [];\r\n        showTagSelector = false;\r\n    }\r\n\r\n    function doClear() {\r\n      clearEditMode();\r\n      inst = undefined;\r\n      chatCfg = newChatConfig();\r\n    }\r\n\r\n    function pickSession(obj) {\r\n      doClear();\r\n      inst = am7model.prepareInstance(obj);\r\n      window.dbgInst = inst;\r\n      doPeek();\r\n    }\r\n\r\n    async function chatInto() {\r\n      page.components.dialog.chatInto(inst.entity, inst, aCCfg)\r\n    }\r\n\r\n    async function doCancel() {\r\n      clearEditMode();\r\n      chatCfg.pending = false;\r\n      chatCfg.peek = false;\r\n      chatCfg.history = [];\r\n      if(inst && inst.api.objectId()){\r\n        let chatReq = {\r\n          schema: inst.model.name,\r\n          objectId: inst.api.objectId(),\r\n          uid: page.uid()\r\n        };\r\n\r\n        return m.request({ method: 'POST', url: g_application_path + \"/rest/chat/clear\", withCredentials: true, body: chatReq }).then((r) => {\r\n          m.redraw();\r\n        });\r\n      }\r\n    }\r\n\r\n    function newChatStream() {\r\n\r\n      let cfg = {\r\n        streamId: undefined,\r\n        request: undefined,\r\n\r\n        onchatcomplete: (id) => {\r\n          console.log(\"Chat completed: \" + id);\r\n          if (page.chatStream && !page.chatStream.streamId == id) {\r\n            console.warn(\"Mismatched stream identifiers\");\r\n          }\r\n          clearChat();\r\n          m.redraw();\r\n        },\r\n        onchaterror: (id, msg) => {\r\n          page.toast(\"error\", \"Chat error: \" + msg, 5000);\r\n          clearChat();\r\n          m.redraw();\r\n        },\r\n        onchatstart: (id, req) => {\r\n          // console.log(\"Start chat...\");\r\n          if (!chatCfg) {\r\n            console.warn(\"Invalid chat configuration\");\r\n            return;\r\n          }\r\n          if (!chatCfg.history) chatCfg.history = {};\r\n          if (!chatCfg.history.messages) chatCfg.history.messages = [];\r\n          chatCfg.history.messages.push({ role: \"assistant\", content: \"\" });\r\n        },\r\n        onchatupdate: (id, msg) => {\r\n          // console.log(\"Chat update: \" + msg);\r\n          if (!chatCfg.history.messages.length) {\r\n            console.error(\"Unexpected chat history\");\r\n            return;\r\n          }\r\n          let m1 = chatCfg.history.messages[chatCfg.history.messages.length - 1];\r\n          if (m1.role != \"assistant\") {\r\n            console.error(\"Expected assistant message to be the most recent\");\r\n            return;\r\n          }\r\n\r\n          m1.content += msg;\r\n          m.redraw();\r\n        }\r\n      }\r\n\r\n      function clearChat() {\r\n        page.chatStream = undefined;\r\n        chatCfg.streaming = false;\r\n        chatCfg.pending = false;\r\n      }\r\n\r\n      return cfg;\r\n    }\r\n\r\n    function newChainStream() {\r\n      let cfg = {\r\n        steps: [],\r\n        currentStep: 0,\r\n        totalSteps: 0,\r\n        isRunning: false,\r\n\r\n        onchainStart: (data) => {\r\n          cfg.isRunning = true;\r\n          cfg.steps = [];\r\n          cfg.currentStep = 0;\r\n          m.redraw();\r\n        },\r\n        onstepStart: (data) => {\r\n          if (data) {\r\n            cfg.currentStep = data.stepNumber || 0;\r\n            cfg.totalSteps = data.totalSteps || 0;\r\n            cfg.steps.push({\r\n              step: data.stepNumber,\r\n              type: data.stepType || \"TOOL\",\r\n              status: \"executing\",\r\n              summary: data.stepSummary || \"Executing...\"\r\n            });\r\n          }\r\n          m.redraw();\r\n        },\r\n        onstepComplete: (data) => {\r\n          if (data && cfg.steps.length > 0) {\r\n            let last = cfg.steps[cfg.steps.length - 1];\r\n            last.status = \"completed\";\r\n            last.summary = data.stepSummary || \"Completed\";\r\n            cfg.totalSteps = data.totalSteps || cfg.totalSteps;\r\n          }\r\n          m.redraw();\r\n        },\r\n        onstepError: (data) => {\r\n          if (data && cfg.steps.length > 0) {\r\n            let last = cfg.steps[cfg.steps.length - 1];\r\n            last.status = \"error\";\r\n            last.summary = data.errorMessage || \"Error\";\r\n          }\r\n          m.redraw();\r\n        },\r\n        onchainComplete: (data) => {\r\n          cfg.isRunning = false;\r\n          if (data && data.stepSummary) {\r\n            if (!chatCfg.history) chatCfg.history = {};\r\n            if (!chatCfg.history.messages) chatCfg.history.messages = [];\r\n            chatCfg.history.messages.push({ role: \"assistant\", content: data.stepSummary });\r\n          }\r\n          page.chainStream = undefined;\r\n          m.redraw();\r\n        },\r\n        onstepsInserted: (data) => {\r\n          if (data) {\r\n            cfg.totalSteps = data.totalSteps || cfg.totalSteps;\r\n          }\r\n          m.redraw();\r\n        },\r\n        onchainMaxSteps: (data) => {\r\n          cfg.isRunning = false;\r\n          page.toast(\"warn\", \"Chain reached maximum step limit\", 5000);\r\n          page.chainStream = undefined;\r\n          m.redraw();\r\n        },\r\n        onchainError: (data) => {\r\n          cfg.isRunning = false;\r\n          let msg = (typeof data === \"string\") ? data : (data?.errorMessage || \"Chain error\");\r\n          page.toast(\"error\", \"Chain error: \" + msg, 5000);\r\n          page.chainStream = undefined;\r\n          m.redraw();\r\n        }\r\n      };\r\n      return cfg;\r\n    }\r\n\r\n    function getChainProgressView() {\r\n      if (!page.chainStream || !page.chainStream.isRunning) return null;\r\n      let cs = page.chainStream;\r\n      let statusIcons = { \"completed\": \"\\u2713\", \"error\": \"\\u2717\", \"executing\": \"\\u25CB\" };\r\n      return m(\"div.chain-progress\", [\r\n        m(\"div.chain-progress-bar\", [\r\n          m(\"span\", \"Chain: Step \" + cs.currentStep + \" / \" + cs.totalSteps),\r\n          cs.isRunning ? m(\"span.chain-spinner\", \" \\u23F3\") : null\r\n        ]),\r\n        m(\"div.chain-steps\", cs.steps.map(s =>\r\n          m(\"div.chain-step.\" + s.status, [\r\n            m(\"span.chain-step-icon\", statusIcons[s.status] || \"?\"),\r\n            m(\"span.chain-step-type\", \" [\" + s.type + \"] \"),\r\n            m(\"span.chain-step-summary\", s.summary)\r\n          ])\r\n        ))\r\n      ]);\r\n    }\r\n\r\n    function doChainSend() {\r\n      let msg = document.querySelector(\"[name='chatmessage']\").value;\r\n      if (!msg || !msg.trim()) return;\r\n      pushHistory();\r\n      page.chainStream = newChainStream();\r\n      page.chainStream.isRunning = true;\r\n      let chainReq = { planQuery: msg };\r\n      page.wss.send(\"chain\", JSON.stringify(chainReq), undefined);\r\n      m.redraw();\r\n    }\r\n\r\n    function doStop() {\r\n      if (!chatCfg.streaming) {\r\n        return;\r\n      }\r\n      let chatReq = {\r\n        schema: inst.model.name,\r\n        objectId: inst.api.objectId(),\r\n        uid: page.uid(),\r\n        message: \"[stop]\"\r\n      };\r\n\r\n      page.wss.send(\"chat\", JSON.stringify(chatReq), undefined, inst.model.name);\r\n    }\r\n\r\n    function doChat() {\r\n      clearEditMode();\r\n      if (chatCfg.pending) {\r\n        console.warn(\"Chat is pending\");\r\n        return;\r\n      }\r\n      if (chatCfg.streaming) {\r\n        console.warn(\"Chat is streaming - TODO - interrupt\");\r\n        return;\r\n      }\r\n      let msg = page.components.audio.recording() ? audioText : document.querySelector(\"[name='chatmessage']\").value; ///e?.target?.value;\r\n      if (!chatCfg.peek) {\r\n        doPeek().then(() => {\r\n          doChat();\r\n        })\r\n      }\r\n      else {\r\n        pushHistory();\r\n        chatCfg.pending = true;\r\n        let data = page.components.dnd.workingSet.map(r => { return JSON.stringify({ schema: r.schema, objectId: r.objectId }); });\r\n\r\n        let chatReq = {\r\n          schema: inst.model.name,\r\n          objectId: inst.api.objectId(),\r\n          uid: page.uid(),\r\n          message: msg + (msg.length && faceProfile ? \"\\n(Metrics: \" + JSON.stringify(faceProfile) + \")\": \"\"),\r\n          data\r\n        };\r\n        try {\r\n          if (chatCfg?.chat.stream) {\r\n            page.chatStream = newChatStream();\r\n            chatCfg.streaming = true;\r\n            page.wss.send(\"chat\", JSON.stringify(chatReq), undefined, inst.model.name);\r\n          }\r\n          else {\r\n            m.request({ method: 'POST', url: g_application_path + \"/rest/chat/text\", withCredentials: true, body: chatReq }).then((r) => {\r\n              if (!chatCfg.history) chatCfg.history = {};\r\n              chatCfg.history.messages = r?.messages || [];\r\n              chatCfg.pending = false;\r\n              // Audio components will automatically update when messages change\r\n            });\r\n          }\r\n        }\r\n        catch (e) {\r\n          console.error(\"Error in chat\", e);\r\n          chatCfg.pending = false;\r\n        }\r\n      }\r\n    }\r\n\r\n    async function deleteChat(s) {\r\n      am7chat.deleteChat(s, false, async function () {\r\n        aSess = undefined;\r\n        await loadConfigList();\r\n        doClear();\r\n        m.redraw();\r\n      });\r\n    }\r\n\r\n    /// Note: Chatmessage isn't defined in its own model, and should be to avoid all the goofy checks\r\n    function pushHistory() {\r\n      let msg = page.components.audio.recording() ? audioText : document.querySelector(\"[name='chatmessage']\").value;\r\n      if (!chatCfg.history) chatCfg.history = {};\r\n      if (!chatCfg.history.messages) chatCfg.history.messages = [];\r\n      chatCfg.history.messages.push({ role: \"user\", content: msg });\r\n      if (page.components.audio.recording()) {\r\n        audioText = \"\";\r\n      }\r\n      else {\r\n        document.querySelector(\"[name='chatmessage']\").value = \"\";\r\n      }\r\n      m.redraw();\r\n    }\r\n\r\n    function getHistory() {\r\n      if (!inst) {\r\n        return;\r\n      }\r\n\r\n      let chatReq = {\r\n        schema: inst.model.name,\r\n        objectId: inst.api.objectId(),\r\n        uid: page.uid()\r\n      };\r\n      return m.request({ method: 'POST', url: g_application_path + \"/rest/chat/history\", withCredentials: true, body: chatReq });\r\n    }\r\n\r\n    function newChatConfig() {\r\n      return {\r\n        peek: false,\r\n        history: undefined,\r\n        pending: false\r\n      };\r\n    }\r\n\r\n\r\n    function doPeek() {\r\n      if (chatCfg.peek || !inst) {\r\n        return Promise.resolve();\r\n      }\r\n\r\n      let c1 = inst.api.promptConfig();\r\n      let c2 = inst.api.chatConfig();\r\n      let p;\r\n      if (c1 && c2) {\r\n        /// Looking up the prompt and chat config to get the full objects\r\n        ///\r\n        chatCfg.peek = true;\r\n        p = new Promise((res, rej) => {\r\n          m.request({ method: 'GET', url: g_application_path + \"/rest/chat/config/prompt/\" + encodeURIComponent(c1.name), withCredentials: true })\r\n            .then((c) => {\r\n              chatCfg.prompt = c;\r\n\r\n              m.request({ method: 'GET', url: g_application_path + \"/rest/chat/config/chat/\" + encodeURIComponent(c2.name), withCredentials: true }).then((c3) => {\r\n                chatCfg.chat = c3;\r\n                chatCfg.system = c3.systemCharacter;\r\n                chatCfg.user = c3.userCharacter;\r\n                getHistory().then((h) => {\r\n                  chatCfg.peek = true;\r\n                  chatCfg.history = h;\r\n                  m.redraw();\r\n                  res();\r\n                }).catch((e) => {\r\n                  console.warn(\"Error in chat history\", e);\r\n                  chatCfg.peek = false;\r\n                  rej(e);\r\n                });\r\n              }).catch((e) => {\r\n                  console.warn(\"Error in chat config\", e);\r\n                  chatCfg.peek = false;\r\n                  rej(e);\r\n                });\r\n            }).catch((e) => {\r\n              console.warn(\"Error in prompt config\", e);\r\n              chatCfg.peek = false;\r\n              rej(e);\r\n            });\r\n        });\r\n      }\r\n      else {\r\n        console.warn(\"No prompt or chat config\");\r\n        p = Promise.resolve();\r\n      }\r\n      return p;\r\n    }\r\n\r\n    function getChatTopMenuView() {\r\n\r\n      return [];\r\n    }\r\n\r\n    function getSplitContainerView() {\r\n      let splitLeft = \"\";\r\n      if (!fullMode) splitLeft = getSplitLeftContainerView();\r\n      // , onselectstart: function (e) { e.preventDefault(); }\r\n      return m(\"div\", { class: \"results-fixed\" },\r\n        m(\"div\", { class: \"splitcontainer\" }, [\r\n          splitLeft,\r\n          getSplitRightContainerView()\r\n        ])\r\n      );\r\n    }\r\n\r\n    function getSplitRightContainerView() {\r\n      let cls = \"splitrightcontainer\";\r\n      if (fullMode) cls = \"splitfullcontainer\";\r\n      return m(\"div\", { class: cls }, [\r\n        getResultsView()\r\n      ]);\r\n    }\r\n\r\n    chat.callback = function () {\r\n\r\n    };\r\n\r\n    function getSplitLeftContainerView() {\r\n      /*\r\n      inst.formField(\"prompt\").hide = sess;\r\n      inst.formField(\"chat\").hide = sess;\r\n      inst.formField(\"session\").hide = sess;\r\n      */\r\n      let vsess = aSess || [];\r\n\r\n      return m(\"div\", {\r\n        class: \"splitleftcontainer\",\r\n        ondragover: function (e) {\r\n          e.preventDefault();\r\n        }\r\n      }, [\r\n        // am7view.form(inst),\r\n        //         m(\"button\", { class: \"flyout-button\", onclick: openChatSettings }, [m(\"span\", { class: \"material-symbols-outlined material-icons-24\" }, \"add\"), \"New Chat\"]),\r\n        vsess.map((s, i) => {\r\n          let bNew = s.objectId == undefined;\r\n          let bDel = \"\";\r\n          if (bNew) {\r\n            bDel = m(\"button\", { class: \"menu-button content-end mr-2\", onclick: openChatSettings }, m(\"span\", { class: \"material-symbols-outlined material-icons-24\" }, \"add\"));\r\n            //m(\"button\", {class: \"menu-button material-symbols-outlined material-icons-24 mr-2\"},\"add\");\r\n          }\r\n          else {\r\n            bDel = m(\"button\", { class: \"menu-button content-end mr-2\", onclick: function (e) { e.preventDefault(); deleteChat(s); return false; } }, m(\"span\", { class: \"material-symbols-outlined material-icons-24\" }, \"delete_outline\"));\r\n          }\r\n          return m(\"button\", {\r\n            class: \"flyout-button\" + (inst && s.name == inst.api.name() ? \" active\" : \"\"), onclick: function () {\r\n              pickSession(s);\r\n            }\r\n          }, [bDel, s.name]);\r\n        })\r\n\r\n      ]);\r\n    }\r\n\r\n\r\n    function openChatSettings(cinst) {\r\n      page.components.dialog.chatSettings(cinst && cinst.model ? cinst : undefined, async function (e) {\r\n\r\n        //let obj = await page.createObject(e);\r\n        let chatReq = {\r\n          schema: e[am7model.jsonModelKey],\r\n          name: e.name,\r\n          objectId: e.objectId,\r\n          chatConfig: { objectId: e.chatConfig.objectId },\r\n          promptConfig: { objectId: e.promptConfig.objectId },\r\n          uid: page.uid()\r\n        };\r\n        let obj = await m.request({ method: 'POST', url: g_application_path + \"/rest/chat/new\", withCredentials: true, body: chatReq });\r\n        inst = am7model.prepareInstance(obj);\r\n        window.dbgInst = inst;\r\n        aSess = undefined;\r\n        doClear();\r\n        await am7client.clearCache();\r\n        await loadConfigList();\r\n        doPeek();\r\n      });\r\n    }\r\n\r\n    function toggleAudio() {\r\n      // Stop all currently playing audio from both old and new systems\r\n      if (page.components.audio) {\r\n        page.components.audio.stopAudioSources();\r\n        page.components.audio.stopAllAudioSourceControllers();\r\n      }\r\n\r\n      audio = !audio;\r\n      m.redraw();\r\n    }\r\n\r\n    function sendToMagic8() {\r\n      const magic8Context = {\r\n        chatConfigId: chatCfg?.chat?.objectId,\r\n        chatHistory: chatCfg?.history?.messages || [],\r\n        systemCharacter: chatCfg?.system,\r\n        userCharacter: chatCfg?.user,\r\n        instanceId: inst?.api?.objectId()\r\n      };\r\n      sessionStorage.setItem('magic8Context', JSON.stringify(magic8Context));\r\n      m.route.set('/magic8', { context: 'chat' });\r\n    }\r\n    \r\n    let faceProfile;\r\n    function handleFaceMetricCapture(imageData) {\r\n      if(imageData && imageData.results?.length){\r\n        let id = imageData.results[0];\r\n       faceProfile = {\r\n          emotion: id.dominant_emotion,\r\n          emotions: Object.fromEntries(\r\n            Object.entries(id.emotion_scores).map(([key, value]) => {let vf = value; return [key, vf.toFixed(2)];})\r\n          ),\r\n          /*\r\n          gender: id.dominant_gender,\r\n          genders: Object.fromEntries(\r\n            Object.entries(id.gender_scores).map(([key, value]) => {let vf = value; return [key, vf.toFixed(2)];})\r\n          ),\r\n          */\r\n          race: id.dominant_race\r\n          /*\r\n          races: Object.fromEntries(\r\n            Object.entries(id.race_scores).map(([key, value]) => {let vf = value; return [key, vf.toFixed(2)];})\r\n          ),\r\n          */\r\n          //age: id.age\r\n        };\r\n      }\r\n    }\r\n\r\n    function toggleProfile() {\r\n      profile = !profile;\r\n    }\r\n    function toggleCamera() {\r\n      camera = !camera;\r\n      if(camera){\r\n        if(!page.components.camera.devices().length){\r\n          page.components.camera.initializeAndFindDevices(handleFaceMetricCapture);\r\n        }\r\n        else{\r\n          page.components.camera.startCapture(handleFaceMetricCapture);\r\n        }\r\n      }\r\n      else{\r\n        page.components.camera.stopCapture();\r\n      }\r\n    }\r\n\r\n    function toggleThoughts() {\r\n      hideThoughts = !hideThoughts;\r\n    }\r\n\r\n    function clearEditMode() {\r\n      editMode = false;\r\n      editIndex = -1;\r\n    }\r\n\r\n    /// Currently only editing the last assistant message\r\n    /// The reasoning: The message history used for display is a truncated version of what's in the chat request\r\n    /// Alternately, this could be a separate API, but that seems unnecessary at the moment\r\n    async function editMessageHistory(idx, cnt) {\r\n\r\n      let q = am7view.viewQuery(am7model.newInstance(inst.api.sessionType()));\r\n      q.field(\"id\", inst.api.session().id);\r\n      let qr = await page.search(q);\r\n      if (qr && qr.results.length > 0) {\r\n        console.log(\"Patching session data\", qr.results[0].objectId);\r\n        let req = qr.results[0];\r\n\r\n        /// change the contents of the last message \r\n        req.messages[req.messages.length - 1].content = cnt;\r\n        let patch = await page.patchObject(req);\r\n        clearEditMode();\r\n        await am7client.clearCache();\r\n        await doCancel();\r\n        await doPeek();\r\n      }\r\n      else {\r\n        console.error(\"Failed to find session data to edit\", qr);\r\n      }\r\n      clearEditMode();\r\n    }\r\n    function toggleEditMode(idx) {\r\n      if (editMode) {\r\n\r\n        /// Put message back in the history\r\n        ///\r\n        editMessageHistory(idx, document.getElementById(\"editMessage\").value);\r\n      }\r\n      else {\r\n        editMode = true;\r\n        editIndex = idx;\r\n      }\r\n    }\r\n\r\n    function getResultsView() {\r\n      if (!inst) {\r\n        return \"\";\r\n      }\r\n      let c1g = \"man\";\r\n      let c1l = \"Nobody\";\r\n      let c2g = \"man\";\r\n      let c2l = \"Nobody\";\r\n      if (chatCfg.system) {\r\n        c1l = chatCfg.system.name;\r\n        if (chatCfg.system.gender == \"female\") {\r\n          c1g = \"woman\";\r\n        }\r\n      }\r\n      if (chatCfg.user) {\r\n        c2l = chatCfg.user.name;\r\n        if (chatCfg.user.gender == \"female\") {\r\n          c2g = \"woman\";\r\n        }\r\n      }\r\n\r\n      let c1i = m(\"span\", { class: \"material-icons-outlined\" }, c1g);\r\n      let c2i = m(\"span\", { class: \"material-icons-outlined\" }, c2g);\r\n      if (chatCfg.system?.profile?.portrait) {\r\n        let pp = chatCfg.system.profile.portrait;\r\n        let dataUrl = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + pp.groupPath + \"/\" + pp.name + \"/96x96\";\r\n        // h-8 w-8\r\n        c1i = m(\"img\", { onclick: function () { page.imageView(pp); }, class: \"mr-4 rounded-full\", src: dataUrl });\r\n      }\r\n\r\n      if (chatCfg.user?.profile?.portrait) {\r\n        let pp = chatCfg.user.profile.portrait;\r\n        let dataUrl = g_application_path + \"/thumbnail/\" + am7client.dotPath(am7client.currentOrganization) + \"/data.data\" + pp.groupPath + \"/\" + pp.name + \"/96x96\";\r\n        // h-8 w-8 \r\n        c2i = m(\"img\", { onclick: function () { page.imageView(pp); }, class: \"ml-4 rounded-full\", src: dataUrl });\r\n      }\r\n\r\n      let midx = -1;\r\n      let aidx = 1;\r\n      let amsg = chatCfg.history?.messages || [];\r\n      let hasAutoPlayedThisSession = false;\r\n      let msgs = amsg.map((msg) => {\r\n        midx++;\r\n        let align = \"justify-start\";\r\n        let txt = \"bg-gray-600 text-white\";\r\n        // console.log(msg);\r\n        if (msg.role == \"user\") {\r\n          align = \"justify-end\";\r\n          txt = \"dark:bg-gray-900 dark:text-white bg-gray-200 text-black\";\r\n        }\r\n        let cnt = msg.content || \"\";\r\n        let ectl = \"\";\r\n        let ecls = \"\";\r\n        let bectl = false;\r\n        let lastMsg = (midx == (chatCfg.history.messages.length - 1));\r\n        if (hideThoughts && !editMode) {\r\n          cnt = pruneOut(cnt, \"--- CITATION\", \"END CITATIONS ---\")\r\n          // cnt = pruneTag(cnt, \"citation\");\r\n        }\r\n        if (msg.role == \"assistant\") {\r\n          bectl = (editMode && editIndex == midx);\r\n\r\n          /// Only edit last message\r\n          if (midx == chatCfg.history.messages.length - 1) {\r\n            ectl = m(\"span\", { onclick: function () { toggleEditMode(midx); }, class: \"material-icons-outlined text-slate-\" + (bectl ? 200 : 700) }, \"edit\");\r\n          }\r\n          if (hideThoughts && !editMode) {\r\n            cnt = pruneToMark(cnt, \"<|reserved_special_token\");\r\n            cnt = pruneTag(cnt, \"think\");\r\n            cnt = pruneTag(cnt, \"thought\");\r\n            cnt = pruneOther(cnt);\r\n          }\r\n\r\n          if (bectl) {\r\n            ecls = \"w-full \";\r\n            cnt = m(\"textarea\", { id: \"editMessage\", class: \"text-field textarea-field-full\" }, cnt);\r\n          }\r\n\r\n        }\r\n        if (!bectl && hideThoughts) {\r\n          cnt = pruneToMark(cnt, \"(Metrics\");\r\n          cnt = pruneToMark(cnt, \"(Reminder\");\r\n          cnt = pruneToMark(cnt, \"(KeyFrame\");\r\n        }\r\n        if (!editMode && cnt.trim().length == 0) {\r\n          return \"\";\r\n        }\r\n\r\n        if (typeof cnt == \"string\") {\r\n          // Process image tokens before markdown parsing\r\n          cnt = processImageTokensInContent(cnt, msg.role, midx);\r\n          //cnt = cnt.replace(/\\r/,\"\").split(\"\\n\").map((l)=>{return m(\"p\", l)});\r\n          cnt = m.trust(marked.parse(cnt = page.components.emoji.markdownEmojis(cnt.replace(/\\r/, \"\"))));\r\n        }\r\n        let aud = \"\";\r\n\r\n        if (chatCfg.chat && audio && !chatCfg.streaming) {\r\n          let profileId;\r\n          if (msg.role == \"assistant\") {\r\n            profileId = chatCfg?.system?.profile?.objectId;\r\n          }\r\n          else {\r\n            profileId = chatCfg?.user?.profile?.objectId;\r\n          }\r\n\r\n          // Generate stable name based on chat objectId, role, and content hash\r\n          let contentForHash = pruneAll(msg.content);\r\n          let contentHash = page.components.audioComponents.simpleHash(contentForHash);\r\n          let name = inst.api.objectId() + \"-\" + msg.role + \"-\" + contentHash;\r\n\r\n          // Auto-play only the last message, and only once per session\r\n          let shouldAutoPlay = lastMsg && !hasAutoPlayedThisSession;\r\n          if (shouldAutoPlay) {\r\n            hasAutoPlayedThisSession = true;\r\n          }\r\n\r\n          // Use new SimpleAudioPlayer component with stable key based on content\r\n          aud = m(page.components.audioComponents.SimpleAudioPlayer, {\r\n            key: name, // Use stable key based on content hash (same content = same component)\r\n            id: name + \"-\" + aidx,\r\n            name: name,\r\n            profileId: profileId,\r\n            content: contentForHash,\r\n            autoLoad: true,  // Always load audio to create visualizer\r\n            autoPlay: shouldAutoPlay,\r\n            autoPlayDelay: 200,\r\n            autoStopOthers: true,\r\n            visualizerClass: \"audio-container block w-full\",\r\n            height: 60,\r\n            gradient: \"prism\",\r\n            onDelete: () => {\r\n              // Optional: Handle audio deletion if needed\r\n              console.log(\"Delete audio:\", name);\r\n            }\r\n          });\r\n\r\n          aidx++;\r\n        }\r\n        return m(\"div\", { class: \"relative receive-chat flex \" + align },\r\n          [ectl, m(\"div\", { class: ecls + \"px-5 mb-2 \" + txt + \" py-2 text-base max-w-[80%] border rounded-md font-light\" },\r\n            (audio ? aud : m(\"p\", cnt))\r\n            //,aud\r\n          )]\r\n        );\r\n      });\r\n      let flds = [m(\"div\", { class: \"flex justify-between\" }, [\r\n        m(\"div\", { class: \"flex items-center\" }, [\r\n          c1i,\r\n          m(\"span\", { class: \"text-gray-400 text-base pl-4\" }, c1l)\r\n        ]),\r\n        m(\"div\", { class: \"flex items-center\" }, [\r\n\r\n          m(\"span\", { class: \"text-gray-400 text-base pl-4\" }, c2l),\r\n          c2i\r\n        ])\r\n      ])\r\n      ];\r\n      let setting = inst.api.setting();\r\n      let setLbl = \"\";\r\n      if (setting) {\r\n        setLbl = m(\"div\", { class: \"relative receive-chat flex justify-start\"},\r\n          setLbl = m(\"div\", { class:  \"px-5 mb-2 bg-gray-200 dark:bg-gray-900 dark:text-white text-black py-2 text-base w-full border rounded-md font-light\" },\r\n             m(\"p\", \"Setting: \" + setting)\r\n\r\n          )\r\n        );\r\n      }\r\n      \r\n      let ret = [(profile ? m(\"div\", { class: \"bg-white dark:bg-black user-info-header px-5 py-3\" }, flds) : \"\"), m(\"div\", { id: \"messages\", class: \"h-full w-full overflow-y-auto\" }, [\r\n        setLbl,\r\n        msgs\r\n      ])];\r\n\r\n      return ret;\r\n    }\r\n\r\n    function pruneAll(cnt) {\r\n      cnt = pruneToMark(cnt, \"<|reserved_special_token\");\r\n      cnt = pruneTag(cnt, \"think\");\r\n      cnt = pruneTag(cnt, \"thought\");\r\n      cnt = pruneToMark(cnt, \"(Metrics\");\r\n      cnt = pruneToMark(cnt, \"(Reminder\");\r\n      cnt = pruneToMark(cnt, \"(KeyFrame\");\r\n      cnt = pruneOther(cnt);\r\n      return cnt;\r\n    }\r\n\r\n    function pruneOther(cnt) {\r\n      cnt = cnt.replace(/\\[interrupted\\]/g, \"\");\r\n      return cnt;\r\n    }\r\n\r\n    function pruneToMark(cnt, mark) {\r\n      let idx = cnt.indexOf(mark);\r\n      if (idx > -1) {\r\n        cnt = cnt.substring(0, idx);\r\n      }\r\n      return cnt;\r\n    }\r\n\r\n    function pruneOut(cnt, start, end){\r\n      let idx1 = cnt.indexOf(start);\r\n      let idx2 = cnt.indexOf(end);\r\n      if(idx1 > -1 && idx2 > -1 && idx2 > idx1){\r\n        cnt = cnt.substring(0, idx1) + cnt.substring(idx2 + end.length, cnt.length);  \r\n      }\r\n      return cnt;\r\n    }\r\n\r\n    function pruneTag(cnt, tag) {\r\n      let tdx1 = cnt.toLowerCase().indexOf(\"<\" + tag + \">\");\r\n      let maxCheck = 20;\r\n      let check = 0;\r\n      while (tdx1 > -1) {\r\n        if (check++ >= maxCheck) {\r\n          console.error(\"Break on loop!\");\r\n          break;\r\n        }\r\n\r\n        let tdx2 = cnt.toLowerCase().indexOf(\"</\" + tag + \">\");\r\n        if (tdx1 > -1 && tdx2 > -1 && tdx2 > tdx1) {\r\n          cnt = cnt.substring(0, tdx1) + cnt.substring(tdx2 + tag.length + 3, cnt.length);\r\n        }\r\n        tdx1 = cnt.toLowerCase().indexOf(\"<\" + tag + \">\");\r\n      }\r\n      return cnt;\r\n    }\r\n\r\n    function getChatBottomMenuView() {\r\n      // if(!showFooter) return \"\";\r\n\r\n      let pendBar = m(\"div\", { class: \"w-[80%] p-4 flex flex-col\" },\r\n        m(\"div\", { class: \"relative bg-gray-200 rounded\" },\r\n          m(\"div\", { class: \"absolute top-0 h-4 w-full rounded pending-blue\" })\r\n        )\r\n      );\r\n\r\n      let placeText = \"Start typing...\";\r\n      if (!inst) {\r\n        placeText = \"Select or create a chat to begin...\";\r\n      }\r\n      else if (chatCfg.pending) {\r\n        placeText = \"Waiting ...\";\r\n      }\r\n      let msgProps = { type: \"text\", name: \"chatmessage\", class: \"text-field w-[80%]\", placeholder: placeText, onkeydown: function (e) { if (e.which == 13) doChat(e); } };\r\n      let input = m(\"input[\" + (!inst || chatCfg.pending ? \"disabled='true'\" : \"\") + \"]\", msgProps);\r\n\r\n      // Tag selector row (shown when image button toggled)\r\n      let tagSelectorRow = \"\";\r\n      if (showTagSelector && window.am7imageTokens) {\r\n          tagSelectorRow = m(\"div\", { class: \"px-3 py-2 border-b border-gray-600 flex flex-wrap gap-1 items-center max-h-24 overflow-y-auto\" }, [\r\n              window.am7imageTokens.tags.map(function(tag) {\r\n                  let isSelected = selectedImageTags.indexOf(tag) > -1;\r\n                  return m(\"button\", {\r\n                      class: \"px-2 py-0.5 rounded-full text-xs \" +\r\n                          (isSelected ?\r\n                              \"bg-purple-600 text-white\" :\r\n                              \"bg-gray-600 text-gray-200 hover:bg-gray-500\"),\r\n                      onclick: function() { toggleImageTag(tag); }\r\n                  }, tag);\r\n              }),\r\n              selectedImageTags.length > 0 ?\r\n                  m(\"button\", {\r\n                      class: \"ml-2 px-3 py-0.5 rounded bg-purple-600 text-white text-xs hover:bg-purple-700\",\r\n                      onclick: function() { insertImageToken(); }\r\n                  }, \"Insert \" + selectedImageTags.join(\",\") + \" pic\") : \"\"\r\n          ]);\r\n      }\r\n\r\n      return m(\"div\", { class: \"result-nav-outer\" },\r\n        m(\"div\", { class: \"results-fixed\" }, [\r\n          tagSelectorRow,\r\n          m(\"div\", { class: \"splitcontainer\" }, [\r\n            m(\"div\", { class: \"splitleftcontainer\" },\r\n              m(\"button\", { class: \"flyout-button\", onclick: openChatSettings },\r\n                [m(\"span\", { class: \"material-symbols-outlined material-icons-24\" }, \"add\"), \"New Chat\"]\r\n              )\r\n            ),\r\n            m(\"div\", { class: \"splitrightcontainer result-nav-inner\" },\r\n\r\n              m(\"div\", { class: \"tab-container result-nav w-full\" }, [\r\n                page.iconButton(\"button\",  (fullMode ? \"close_fullscreen\" : \"open_in_new\"), \"\", toggleFullMode),\r\n                page.iconButton(\"button\",  \"cancel\", \"\", doCancel),\r\n                // (camera ? \" animate-pulse\" : \"\")\r\n                page.iconButton(\"button\",  (camera ? \"photo_camera\" : \"no_photography\"), \"\", toggleCamera),\r\n                page.iconButton(\"button\",  (showTagSelector ? \"image\" : \"add_photo_alternate\"), \"\", function() { showTagSelector = !showTagSelector; if (!showTagSelector) selectedImageTags = []; }),\r\n                page.iconButton(\"button\",  (profile ? \"account_circle\" : \"account_circle_off\"), \"\", toggleProfile),\r\n                page.iconButton(\"button\",  (audio ? \"volume_up\" : \"volume_mute\"), \"\", toggleAudio),\r\n                page.iconButton(\"button\",  \"counter_8\", \"\", sendToMagic8),\r\n                page.iconButton(\"button\",  \"query_stats\", \"\", chatInto),\r\n                page.iconButton(\"button\",  \"visibility\" + (hideThoughts ? \"\" : \"_off\"), \"\", toggleThoughts),\r\n                page.components.audio.recordButton(),\r\n                (page.components.audio.recording() ? page.components.audio.recordWithVisualizer(true, function (text) { audioText += text; console.log(text); }, function (contentType, b64) { handleAudioSave(contentType, b64); }) : (chatCfg.pending ? pendBar : input)),\r\n                page.iconButton(\"button\",  \"stop\", \"\", doStop),\r\n                page.iconButton(\"button\",  \"chat\", \"\", doChat)\r\n              ])\r\n            )\r\n          ]),\r\n        ])\r\n      );\r\n    }\r\n    \r\n    async function handleAudioSave(mimeType, base64) {\r\n      let name = inst.api.objectId() + \" - \" + (chatCfg?.history?.messages?.length || 1);\r\n      console.log(\"Save:\", name);\r\n      let cdir = await page.makePath(\"auth.group\", \"data\", \"~/Data/Recordings\");\r\n      let sinst = am7model.newInstance(\"data.data\");\r\n      sinst.api.groupPath(cdir.path);\r\n      sinst.api.organizationId(page.user.organizationId);\r\n      sinst.api.contentType(mimeType);\r\n      sinst.api.name(name);\r\n      sinst.entity.dataBytesStore = base64;\r\n    }\r\n\r\n    function navKey(e) {\r\n      switch (e.keyCode) {\r\n        /// ESC\r\n        case 27:\r\n          if (fullMode) toggleFullMode();\r\n          break;\r\n      }\r\n    }\r\n\r\n    let lastCount = -1;\r\n    function scrollToLast() {\r\n      if (!inst) {\r\n        return;\r\n      }\r\n      let oMsg = document.getElementById(\"messages\");\r\n      if (!oMsg) return;\r\n      let msgs = oMsg.querySelectorAll(\":scope > div\");\r\n      if (msgs.length > 1 && lastCount != msgs.length) {\r\n        lastCount = msgs.length;\r\n        msgs[lastCount - 1].scrollIntoView();\r\n\r\n      }\r\n\r\n    }\r\n\r\n\r\n\r\n    async function loadConfigList() {\r\n      await am7client.clearCache(undefined, true);\r\n      let dir = await page.findObject(\"auth.group\", \"DATA\", \"~/Chat\");\r\n      if (aPCfg == undefined) {\r\n        aPCfg = await am7client.list(\"olio.llm.promptConfig\", dir.objectId, null, 0, 0);\r\n        if (aPCfg && aPCfg.length && inst && inst.api.promptConfig() == null) inst.api.promptConfig(aPCfg[0]);\r\n      }\r\n      if (aCCfg == undefined) {\r\n        aCCfg = await am7client.list(\"olio.llm.chatConfig\", dir.objectId, null, 0, 0);\r\n        if (aCCfg && aCCfg.length && inst && inst.api.chatConfig() == null) inst.api.chatConfig(aCCfg[0]);\r\n\r\n      }\r\n      let dir2 = await page.findObject(\"auth.group\", \"DATA\", \"~/ChatRequests\");\r\n      if (aSess == undefined) {\r\n        aSess = await am7client.list(\"olio.llm.chatRequest\", dir2.objectId, null, 0, 0);\r\n        if (aSess && aSess.length && !inst) pickSession(aSess[0]);\r\n      }\r\n\r\n    }\r\n\r\n    function getChatView(vnode) {\r\n\r\n      if (aPCfg == undefined && aCCfg == undefined) {\r\n        loadConfigList().then(() => {\r\n          if (aCCfg.length > 0) {\r\n            doPeek();\r\n          }\r\n          m.redraw();\r\n        });\r\n      }\r\n\r\n\r\n      return m(\"div\", { class: \"content-outer\" }, [\r\n        (fullMode ? \"\" : m(page.components.navigation, { hideBreadcrumb: true })),\r\n        m(\"div\", { class: \"content-main\" },\r\n          m(\"div\", { class: \"list-results-container\" },\r\n            m(\"div\", { class: \"list-results\" }, [\r\n              (camera ? page.components.camera.videoView() : \"\"),\r\n              getChatTopMenuView(),\r\n              getSplitContainerView(),\r\n              getChatBottomMenuView()\r\n            ])\r\n          )\r\n        )\r\n      ]);\r\n    }\r\n\r\n    function toggleFullMode() {\r\n      fullMode = !fullMode;\r\n      m.redraw();\r\n    }\r\n\r\n    chat.toggleFullMode = toggleFullMode\r\n    chat.cancelView = function () {\r\n      altView = undefined;\r\n      fullMode = false;\r\n      m.redraw();\r\n    };\r\n    chat.editItem = function (object) {\r\n      if (!object) return;\r\n      console.log(\"Edit\", object);\r\n      altView = {\r\n        fullMode,\r\n        view: page.views.object(),\r\n        type: object[am7model.jsonModelKey],\r\n        containerId: object.objectId\r\n      };\r\n      m.redraw();\r\n    };\r\n    chat.addNew = function (type, containerId, parentNew) {\r\n      altView = {\r\n        fullMode,\r\n        view: page.views.object(),\r\n        type,\r\n        containerId,\r\n        parentNew,\r\n        new: true\r\n      };\r\n      m.redraw();\r\n    };\r\n\r\n    chat.view = {\r\n      oninit: function (vnode) {\r\n        let ctx = page.user.homeDirectory;\r\n        let bPopSet = false;\r\n        origin = vnode.attrs.origin || ctx;\r\n\r\n        if (window.remoteEntity) {\r\n          inst = am7model.prepareInstance(remoteEntity, am7model.forms.chatSettings);\r\n          bPopSet = true;\r\n          delete window.remoteEntity;\r\n        }\r\n\r\n        document.documentElement.addEventListener(\"keydown\", navKey);\r\n\r\n        if (bPopSet) {\r\n          openChatSettings(inst);\r\n        }\r\n\r\n\r\n      },\r\n      oncreate: function (x) {\r\n        page.navigable.setupPendingContextMenus();\r\n      },\r\n      onupdate: function (x) {\r\n        page.navigable.setupPendingContextMenus();\r\n        scrollToLast();\r\n\r\n        // Audio components (SimpleAudioPlayer and Magic8Ball) manage themselves\r\n        // No need to configure old audio system\r\n      },\r\n      onremove: function (x) {\r\n        page.navigable.cleanupContextMenus();\r\n        pagination.stop();\r\n        document.documentElement.removeEventListener(\"keydown\", navKey);\r\n\r\n        // Stop all audio sources (both old and new systems)\r\n        if (page.components.audio) {\r\n          page.components.audio.stopBinauralSweep();\r\n          page.components.audio.stopAudioSources();\r\n          page.components.audio.stopAllAudioSourceControllers();\r\n        }\r\n\r\n        page.components.camera.stopCapture();\r\n      },\r\n\r\n      view: function (vnode) {\r\n        let v = getChatView(vnode);\r\n        return [v, page.components.dialog.loadDialog(), page.loadToast()];\r\n      }\r\n    };\r\n    return chat;\r\n  }\r\n  page.views.chat = newChatControl;\r\n}());\r\n\n\n;/* === client/view/game.js === */\n(function(){\r\n    const game = {};\r\n    let fullMode = false;\r\n    let components = {};\r\n    function toggleFullMode(){\r\n        fullMode = !fullMode;\r\n        m.redraw();\r\n    }\r\n\r\n    function getGameComponent(){\r\n        let parm = m.route.param(\"name\") || \"tetris\";\r\n        if(!components[parm]){\r\n            components[parm] = page.components[parm];\r\n        }\r\n        return components[parm];\r\n    }\r\n\r\n    function keyHandler(e){\r\n        let component = getGameComponent();\r\n        if(component && component.keyHandler) return component.keyHandler(e);\r\n        return;\r\n    }\r\n\r\n    function doSave(){\r\n        let component = getGameComponent();\r\n        if(component.saveGame) component.saveGame();\r\n    }\r\n\r\n    function getGameView(){\r\n        let comp = getGameComponent();\r\n        return m(\"div\",{class : \"content-outer\"},[\r\n            (fullMode ? \"\" : m(page.components.navigation)),\r\n            m(\"div\",{class : \"content-main\"},[\r\n                m(\"div\",{class : \"list-results-container\"},[\r\n                    m(\"div\",{class : \"list-results\"},[\r\n                    m(\"div\",{class: \"result-nav-outer\"},[\r\n                        m(\"div\",{class: \"result-nav-inner\"},[\r\n                            m(\"div\",{class: \"result-nav tab-container\"},[\r\n                                page.iconButton(\"button mr-4\", (fullMode ? \"close_fullscreen\" : \"open_in_new\"), \"\", toggleFullMode),\r\n                                page.iconButton(\"button\" + (comp && comp.isChanged && comp.isChanged() ? \" warn\" : \"\"),\"save\", \"\", doSave),\r\n                                page.iconButton(\"button\",\"cancel\", \"\", function(){ history.back(); }),\r\n                                (comp && comp.commands ? comp.commands() : \"\")\r\n                            ]),\r\n                            m(\"div\",{class: \"result-nav tab-container\"},\r\n                               comp ? comp.scoreCard() : \"\"\r\n                            )\r\n                        ])\r\n                    ]),\r\n                    m(comp ? comp : \"\", {caller: game})\r\n                ])\r\n            ])\r\n        ]),\r\n         page.components.dialog.loadDialog(), page.loadToast()\r\n        ]);\r\n          \r\n    }\r\n    game.view = {\r\n        oninit : function(x){\r\n            document.addEventListener(\"keydown\", keyHandler);\r\n        },\r\n        oncreate : function (x) {\r\n          \r\n          page.navigable.setupPendingContextMenus();\r\n        },\r\n        onupdate : function(x){\r\n\r\n        },\r\n        onunload : function(x){\r\n            console.log(\"Unloading ...\");\r\n        },\r\n        onremove : function(x){\r\n            document.removeEventListener(\"keydown\", keyHandler);\r\n          page.navigable.cleanupContextMenus();\r\n        },\r\n\r\n        view: function (vnode) {\r\n            if(!page.authenticated()) return m(\"\");\r\n            return getGameView();\r\n        }\r\n    };\r\n    page.views.game = game.view;\r\n}());\r\n\n\n;/* === client/view/hyp.js === */\n(function(){\r\n    let canvas, ctx, particles;\r\n    // This will be updated by the Mithril component based on biometrics\r\n    let particleColor = { r: 150, g: 180, b: 255 }; \r\n    const PARTICLE_COUNT = 100;\r\n    let imgBase = [218, 220, 130, 172, 173]; //[282, 281, 283, 284, 265, 266, 267]; // [218, 220, 130, 172, 173];//[307]; //\r\n    let imageUrls = [];\r\n\r\n    /*\r\n        \"https://images.unsplash.com/photo-1485470733090-0aae1788d5af?q=80&w=1920&auto=format&fit=crop\", \"https://images.unsplash.com/photo-1476610182048-b716b8518a2a?q=80&w=1920&auto=format&fit=crop\", \"https://images.unsplash.com/photo-1594724889613-2895123d49f6?q=80&w=1920&auto=format&fit=crop\", \"https://images.unsplash.com/photo-1448375240586-882707db888b?q=80&w=1920&auto=format&fit=crop\", \"https://images.unsplash.com/photo-150220952416-acea59203632?q=80&w=1920&auto=format&fit=crop\", \"https://images.unsplash.com/photo-1505373333342-429910b3765e?q=80&w=1920&auto=format&fit=crop\"\r\n        ],\r\n    */\r\n    let canvasInitialized = false;\r\n    function setupCanvas() {\r\n        if(canvasInitialized) return;\r\n        canvas = document.getElementById('visual-canvas');\r\n        if (!canvas){\r\n            console.error(\"Canvas element not found.\");\r\n            return;\r\n        }\r\n        canvasInitialized = true;\r\n        ctx = canvas.getContext('2d');\r\n        canvas.width = window.innerWidth;\r\n        canvas.height = window.innerHeight;\r\n\r\n        particles = [];\r\n        for (let i = 0; i < PARTICLE_COUNT; i++) {\r\n            particles.push(createParticle());\r\n        }\r\n\r\n        animateCanvas();\r\n    }\r\n\r\n    function createParticle(p) {\r\n        return {\r\n            x: p ? p.x : Math.random() * canvas.width,\r\n            y: p ? p.y : Math.random() * canvas.height,\r\n            vx: (Math.random() - 0.5) * 0.5,\r\n            vy: (Math.random() - 0.5) * 0.5,\r\n            radius: Math.random() * 3 + 1,\r\n            alpha: Math.random() * 0.5 + 0.1\r\n        };\r\n    }\r\n\r\n    function animateCanvas() {\r\n        if (!ctx) return;\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n        particles.forEach(p => {\r\n            p.x += p.vx;\r\n            p.y += p.vy;\r\n\r\n            if (p.x < 0 || p.x > canvas.width) p.vx *= -1;\r\n            if (p.y < 0 || p.y > canvas.height) p.vy *= -1;\r\n            \r\n            p.alpha -= 0.001;\r\n            if(p.alpha <= 0){\r\n                Object.assign(p, createParticle());\r\n            }\r\n\r\n            ctx.beginPath();\r\n            ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);\r\n            // Use the dynamic particleColor\r\n            ctx.fillStyle = `rgba(${particleColor.r}, ${particleColor.g}, ${particleColor.b}, ${p.alpha})`;\r\n            ctx.fill();\r\n        });\r\n\r\n        requestAnimationFrame(animateCanvas);\r\n    }\r\n    \r\n    window.addEventListener('resize', () => {\r\n        if (canvas) {\r\n            canvas.width = window.innerWidth;\r\n            canvas.height = window.innerHeight;\r\n        }\r\n    });\r\n\r\n        //let faceProfile;\r\n    function handleFaceMetricCapture(imageData) {\r\n      if(imageData && imageData.results?.length){\r\n        let id = imageData.results[0];\r\n        HypnoApp.processBiometricData(id);\r\n        //console.log(id);\r\n        /*\r\n        faceProfile = {\r\n            emotion: id.dominant_emotion,\r\n            emotions: Object.fromEntries(\r\n                Object.entries(id.emotion_scores).map(([key, value]) => {let vf = value; return [key, vf.toFixed(2)];})\r\n            ),\r\n\r\n            gender: id.dominant_gender,\r\n            genders: Object.fromEntries(\r\n                Object.entries(id.gender_scores).map(([key, value]) => {let vf = value; return [key, vf.toFixed(2)];})\r\n            ),\r\n\r\n            race: id.dominant_race,\r\n            races: Object.fromEntries(\r\n                Object.entries(id.race_scores).map(([key, value]) => {let vf = value; return [key, vf.toFixed(2)];})\r\n            ),\r\n            age: id.age\r\n            };\r\n                console.log(id);\r\n              */\r\n      }\r\n\r\n    }\r\n\r\n    // --- Mithril.js Application ---\r\n    const HypnoApp = {\r\n        // --- State Management ---\r\n        enableAudio: false,\r\n        isStarted: false,\r\n        audioReady: false,\r\n        synth: null,\r\n        lfo: null,\r\n        distractionText: \"...\",\r\n        coreText: \"\",\r\n        imageUrl: \"\",\r\n        biometricData: null,\r\n        biometricClues: [],\r\n        theme: {\r\n            background: \"bg-gray-900\",\r\n            mainText: \"text-blue-100\",\r\n            shadow: \"rgba(180, 210, 255, 0.4)\",\r\n        },\r\n\r\n        // --- Content Arrays ---\r\n        distractions: [\r\n            \"Listen to the space between sounds...\", \"The feeling of now is the memory of later...\", \"What if right was left?\", \"Remember to forget...\", \"A thought is just a visitor...\", \"Up is down if you allow it...\", \"Focus on everything and nothing...\", \"The future was yesterday...\", \"Notice your breath without changing it...\", \"See the silence...\"\r\n        ],\r\n        coreMessages: [\"peace of mind\", \"purity of essence\", \"peace and harmony\"],\r\n        \r\n        // --- Color & Theme Mappings ---\r\n        emotionThemes: {\r\n            neutral: { background: \"bg-gray-800\", mainText: \"text-blue-200\", shadow: \"rgba(180, 210, 255, 0.4)\" },\r\n            happy:   { background: \"bg-yellow-900\", mainText: \"text-yellow-100\", shadow: \"rgba(255, 230, 150, 0.5)\" },\r\n            sad:     { background: \"bg-indigo-900\", mainText: \"text-indigo-200\", shadow: \"rgba(190, 200, 255, 0.4)\" },\r\n            angry:   { background: \"bg-red-900\", mainText: \"text-red-200\", shadow: \"rgba(255, 180, 180, 0.5)\" },\r\n            fear:    { background: \"bg-purple-900\", mainText: \"text-purple-200\", shadow: \"rgba(220, 180, 255, 0.4)\" },\r\n            surprise:{ background: \"bg-pink-900\", mainText: \"text-pink-200\", shadow: \"rgba(255, 180, 220, 0.5)\" },\r\n            disgust: { background: \"bg-green-900\", mainText: \"text-green-200\", shadow: \"rgba(180, 255, 180, 0.4)\" },\r\n        },\r\n\r\n        raceColors: {\r\n            white: [255, 220, 180],\r\n            black: [100, 75, 50],\r\n            asian: [255, 235, 160],\r\n            'East Asian': [255, 235, 160],\r\n            'Southeast Asian': [255, 235, 160],\r\n            indian: [200, 160, 120],\r\n            'middle eastern': [220, 190, 150],\r\n            'latino hispanic': [180, 130, 90]\r\n        },\r\n\r\n        genderColors: {\r\n            Man: [180, 200, 255], // A cool, light blue\r\n            Woman: [255, 200, 220] // A warm, light pink\r\n        },\r\n\r\n        // --- Biometric Processing ---\r\n        processBiometricData: function(data) {\r\n            //console.log(data);\r\n            HypnoApp.biometricData = data;\r\n            let clues = [];\r\n\r\n            // 1. Update Theme based on Emotion\r\n            const emotion = data.dominant_emotion || \"neutral\";\r\n            //console.log(data.dominant_emotion, emotion);\r\n            HypnoApp.theme = HypnoApp.emotionThemes[emotion] || HypnoApp.emotionThemes.neutral;\r\n            clues.push(`A state of ${emotion}.`);\r\n\r\n            // 2. Generate Particle Color from Race and Gender\r\n            let raceBlendedColor = null;\r\n            let raceTotalScore = 0;\r\n            for (const race in data.race_scores) {\r\n                if (data.race_scores[race] > 0 && HypnoApp.raceColors[race]) {\r\n                    raceTotalScore += data.race_scores[race];\r\n                }\r\n            }\r\n            if (raceTotalScore > 0) {\r\n                let r = 0, g = 0, b = 0;\r\n                for (const race in data.race_scores) {\r\n                        if (data.race_scores[race] > 0 && HypnoApp.raceColors[race]) {\r\n                        const weight = data.race_scores[race] / raceTotalScore;\r\n                        r += HypnoApp.raceColors[race][0] * weight;\r\n                        g += HypnoApp.raceColors[race][1] * weight;\r\n                        b += HypnoApp.raceColors[race][2] * weight;\r\n                    }\r\n                }\r\n                raceBlendedColor = { r: r, g: g, b: b };\r\n                clues.push(`A tapestry of heritage.`);\r\n            }\r\n\r\n            let genderBlendedColor = null;\r\n            let genderTotalScore = 0;\r\n            for (const gender in data.gender_scores) {\r\n                if (data.gender_scores[gender] > 0 && HypnoApp.genderColors[gender]) {\r\n                    genderTotalScore += data.gender_scores[gender];\r\n                }\r\n            }\r\n            if (genderTotalScore > 0) {\r\n                let r = 0, g = 0, b = 0;\r\n                for (const gender in data.gender_scores) {\r\n                    if (data.gender_scores[gender] > 0 && HypnoApp.genderColors[gender]) {\r\n                        const weight = data.gender_scores[gender] / genderTotalScore;\r\n                        r += HypnoApp.genderColors[gender][0] * weight;\r\n                        g += HypnoApp.genderColors[gender][1] * weight;\r\n                        b += HypnoApp.genderColors[gender][2] * weight;\r\n                    }\r\n                }\r\n                genderBlendedColor = { r: r, g: g, b: b };\r\n            }\r\n\r\n            if (raceBlendedColor && genderBlendedColor) {\r\n                // Average the two colors\r\n                particleColor = {\r\n                    r: Math.round((raceBlendedColor.r + genderBlendedColor.r) / 2),\r\n                    g: Math.round((raceBlendedColor.g + genderBlendedColor.g) / 2),\r\n                    b: Math.round((raceBlendedColor.b + genderBlendedColor.b) / 2)\r\n                };\r\n            } else if (raceBlendedColor) {\r\n                particleColor = { r: Math.round(raceBlendedColor.r), g: Math.round(raceBlendedColor.g), b: Math.round(raceBlendedColor.b) };\r\n            } else if (genderBlendedColor) {\r\n                particleColor = { r: Math.round(genderBlendedColor.r), g: Math.round(genderBlendedColor.g), b: Math.round(genderBlendedColor.b) };\r\n            }\r\n\r\n            // 3. Generate Clues for Age and Gender\r\n            if (data.age) {\r\n                clues.push(`${data.age} years of experience.`);\r\n            }\r\n            if (data.dominant_gender) {\r\n                clues.push(`An expression of ${data.dominant_gender.toLowerCase()} energy.`);\r\n            }\r\n            \r\n            HypnoApp.biometricClues = clues;\r\n            //console.log(this, HypnoApp.biometricClues);\r\n            m.redraw();\r\n        },\r\n\r\n        // --- Component Methods ---\r\n        startExperience: function() {\r\n            if(HypnoApp.isStarted){\r\n                return;\r\n            }            \r\n\r\n            HypnoApp.isStarted = true;\r\n\r\n                if(!page.components.camera.devices().length){\r\n                    page.components.camera.initializeAndFindDevices(handleFaceMetricCapture);\r\n                }\r\n                else{\r\n                    page.components.camera.startCapture(handleFaceMetricCapture);\r\n                }\r\n\r\n            if (imgBase.length && imageUrls.length == 0) {\r\n                let q = am7client.newQuery(\"data.data\");\r\n                let qg = q.field(null, null);\r\n                qg.comparator = \"group_or\";\r\n                qg.fields = imgBase.map((a) => {\r\n                    return {\r\n                        name: \"groupId\",\r\n                        comparator: \"equals\",\r\n                        value: a\r\n                    }\r\n                });\r\n                q.range(0, 0);\r\n                window.dbgQ = q;\r\n                imgBase = [];\r\n                am7client.search(q, function(res){\r\n\r\n                    if (res && res.results) {\r\n                        imageUrls = res.results.map((r) => {\r\n                            return g_application_path + \"/media/Public/data.data\" + r.groupPath + \"/\" + r.name;\r\n                        });\r\n                        console.log(imageUrls.length);\r\n                        \r\n                        HypnoApp.cycleContent();\r\n                        m.redraw();\r\n                    }\r\n                });\r\n            }\r\n\r\n            \r\n            if (HypnoApp.enableAudio && !HypnoApp.audioReady) {\r\n                Tone.start().then(() => {\r\n                    HypnoApp.synth = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.1, decay: 0.2, sustain: 0.5, release: 1 } }).toDestination();\r\n                    HypnoApp.lfo = new Tone.LFO({ frequency: \"8n\", min: 200, max: 220 }).connect(HypnoApp.synth.frequency).start();\r\n                    Tone.Transport.start();\r\n                    HypnoApp.synth.triggerAttack(210);\r\n                    HypnoApp.audioReady = true;\r\n                });\r\n            }\r\n            \r\n        },\r\n        \r\n        cycleContent: function() {\r\n            HypnoApp.distractionText = HypnoApp.distractions[Math.floor(Math.random() * HypnoApp.distractions.length)];\r\n            HypnoApp.coreText = HypnoApp.coreMessages[Math.floor(Math.random() * HypnoApp.coreMessages.length)];\r\n            HypnoApp.imageUrl = (imageUrls.length ? imageUrls[Math.floor(Math.random() * imageUrls.length)] : \"\");\r\n            m.redraw();\r\n        },\r\n\r\n        // --- Lifecycle Hooks ---\r\n        oncreate: function(vnode) {\r\n\r\n            HypnoApp.contentInterval = setInterval(() => HypnoApp.cycleContent(), 5000);\r\n            HypnoApp.cycleContent();\r\n            //console.log(\"HypnoApp created\");\r\n            // Initial biometric data processing with the provided example\r\n            const initialData = {\"age\":41,\"dominant_gender\":\"Man\",\"dominant_emotion\":\"neutral\",\"dominant_race\":\"white\",\"emotion_scores\":{\"angry\":0.18,\"disgust\":0,\"fear\":0.09,\"happy\":0,\"sad\":0.32,\"surprise\":0.01,\"neutral\":0.39},\"race_scores\":{\"asian\":1.46,\"indian\":0.09,\"black\":0.01,\"white\":87.78,\"middle eastern\":4.13,\"latino hispanic\":6.5},\"gender_scores\":{\"Woman\":0.01,\"Man\":99.98},\"face_confidence\":0.94};\r\n            HypnoApp.processBiometricData(initialData);\r\n        },\r\n        oninit: function(){\r\n\r\n        },\r\n        onupdate: function(){\r\n\r\n        },\r\n        onremove: function() {\r\n            //console.log(\"HypnoApp removed\");\r\n            page.components.camera.stopCapture();\r\n            clearInterval(HypnoApp.contentInterval);\r\n            if (HypnoApp.synth) {\r\n                HypnoApp.synth.triggerRelease();\r\n                HypnoApp.lfo.stop();\r\n                Tone.Transport.stop();\r\n            }\r\n        },\r\n\r\n        // --- View ---\r\n        view: function() {\r\n            if (!HypnoApp.isStarted) {\r\n\r\n\r\n                return [m(\".h-screen.w-screen.flex.items-center.justify-center.bg-gray-900\",\r\n                    m(\".text-center.p-8.bg-gray-800.rounded-lg.shadow-2xl\", [\r\n                        m(\"h1.text-3xl.font-bold.mb-4.text-blue-200\", \"Biometric Feedback Session\"),\r\n                        m(\"p.text-lg.mb-6.text-gray-300\", \"This experience adapts to you. Please use headphones for the best effect.\"),\r\n                        m(\"button.px-8.py-3.bg-blue-600.text-white.font-bold.rounded-full.hover:bg-blue-500.transition-colors.duration-300.shadow-lg\", { onclick: () => HypnoApp.startExperience() }, \"Begin\")\r\n                    ])\r\n                ), page.components.dialog.loadDialog()];\r\n            }\r\n            \r\n            return [m(\".relative.h-screen.w-screen.transition-colors.duration-1000\", { class: HypnoApp.theme.background }, [\r\n                m(\"img.absolute.top-0.left-0.w-full.h-full.object-cover.z-0.opacity-50.animate-[fadeIn_3s_ease-in-out]\", { src: HypnoApp.imageUrl, alt: \"Background\" }),\r\n                m(\"canvas\", {oncreate: setupCanvas, id: \"visual-canvas\", class: \"absolute top-0 left-0 z-5\"}),\r\n                m(\".absolute.top-0.left-0.z-10.h-full.w-full.p-4.bg-black.bg-opacity-40\", {  }, [\r\n                    \r\n                    // Distraction Text (Top)\r\n                    m(\"div.absolute.top-1/4.left-1/2.-translate-x-1/2.text-center\", {},\r\n                        m(\"p.text-xl.text-gray-300.opacity-75[style={text-shadow: '0 0 5px rgba(0,0,0,0.7)'}]\", {  }, HypnoApp.distractionText)\r\n                    ),\r\n\r\n                    // Core Message (Center)\r\n                    m(\"div.absolute.top-1/2.left-1/2.-translate-x-1/2.-translate-y-1/2.text-center\", { },\r\n                        m(\"h1\", {class : \"text-5xl font-bold transition-colors duration-1000 opacity-75 \" + HypnoApp.theme.mainText,\r\n                            style: { textShadow: `0 0 8px rgba(255, 255, 255, 0.3), 0 0 20px ${HypnoApp.theme.shadow}` }\r\n                            \r\n                        }, HypnoApp.coreText.toUpperCase())\r\n                    ),\r\n                    \r\n                    // Biometric Clues (Bottom)\r\n                    m(\".absolute.bottom-8.left-1/2.-translate-x-1/2.text-center.text-sm.text-gray-400.opacity-60.p-2.rounded-lg.bg-black.bg-opacity-20\",\r\n                        HypnoApp.biometricClues.map(clue => m(\"p\", {  }, clue))\r\n                    )\r\n                ])\r\n            ]), page.components.camera.videoView(), page.components.dialog.loadDialog()];\r\n        }\r\n    };\r\n\r\n    page.views.hyp = HypnoApp;\r\n}());\n\n;/* === client/view/magic8/utils/FullscreenManager.js === */\n/**\r\n * FullscreenManager - Fullscreen API wrapper for Magic8 immersive experience\r\n * Falls back to CSS-based fullscreen on iOS/browsers without Fullscreen API support\r\n */\r\nclass FullscreenManager {\r\n    constructor() {\r\n        this.isFullscreen = false;\r\n        this.element = null;\r\n        this.changeCallbacks = [];\r\n        this._usingFallback = false;\r\n\r\n        // Bind event listener\r\n        this._handleFullscreenChange = this._handleFullscreenChange.bind(this);\r\n        document.addEventListener('fullscreenchange', this._handleFullscreenChange);\r\n        document.addEventListener('webkitfullscreenchange', this._handleFullscreenChange);\r\n        document.addEventListener('mozfullscreenchange', this._handleFullscreenChange);\r\n        document.addEventListener('MSFullscreenChange', this._handleFullscreenChange);\r\n    }\r\n\r\n    /**\r\n     * Check if the native Fullscreen API is available\r\n     * @returns {boolean}\r\n     * @private\r\n     */\r\n    _hasNativeFullscreen() {\r\n        return !!(\r\n            document.documentElement.requestFullscreen ||\r\n            document.documentElement.webkitRequestFullscreen ||\r\n            document.documentElement.mozRequestFullScreen ||\r\n            document.documentElement.msRequestFullscreen\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Enter fullscreen mode for the specified element.\r\n     * Falls back to CSS-based fullscreen on iOS/unsupported browsers.\r\n     * @param {HTMLElement} element - Element to make fullscreen\r\n     * @returns {Promise<void>}\r\n     */\r\n    async enterFullscreen(element) {\r\n        if (!element) {\r\n            console.warn('FullscreenManager: No element provided');\r\n            return;\r\n        }\r\n\r\n        this.element = element;\r\n\r\n        if (this._hasNativeFullscreen()) {\r\n            try {\r\n                if (element.requestFullscreen) {\r\n                    await element.requestFullscreen();\r\n                } else if (element.webkitRequestFullscreen) {\r\n                    await element.webkitRequestFullscreen();\r\n                } else if (element.mozRequestFullScreen) {\r\n                    await element.mozRequestFullScreen();\r\n                } else if (element.msRequestFullscreen) {\r\n                    await element.msRequestFullscreen();\r\n                }\r\n                this.isFullscreen = true;\r\n                return;\r\n            } catch (err) {\r\n                console.warn('FullscreenManager: Native fullscreen failed, using fallback:', err);\r\n            }\r\n        }\r\n\r\n        // CSS-based fallback (iOS Safari, Brave on iOS, etc.)\r\n        this._enterFallbackFullscreen(element);\r\n    }\r\n\r\n    /**\r\n     * CSS-based fullscreen fallback for iOS and other unsupported browsers\r\n     * @param {HTMLElement} element\r\n     * @private\r\n     */\r\n    _enterFallbackFullscreen(element) {\r\n        this._usingFallback = true;\r\n\r\n        // Apply fullscreen-like styles\r\n        element.style.position = 'fixed';\r\n        element.style.top = '0';\r\n        element.style.left = '0';\r\n        element.style.width = '100vw';\r\n        element.style.height = '100vh';\r\n        element.style.zIndex = '99999';\r\n\r\n        // Prevent body scrolling\r\n        this._origBodyOverflow = document.body.style.overflow;\r\n        document.body.style.overflow = 'hidden';\r\n\r\n        // Scroll to minimize address bar on iOS\r\n        window.scrollTo(0, 1);\r\n\r\n        this.isFullscreen = true;\r\n        console.log('FullscreenManager: Using CSS fallback fullscreen');\r\n\r\n        // Notify callbacks\r\n        this.changeCallbacks.forEach(cb => {\r\n            try { cb(true, element); } catch (e) { /* ignore */ }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Exit fullscreen mode\r\n     * @returns {Promise<void>}\r\n     */\r\n    async exitFullscreen() {\r\n        if (this._usingFallback) {\r\n            this._exitFallbackFullscreen();\r\n            return;\r\n        }\r\n\r\n        if (!this.getIsFullscreen()) {\r\n            this.isFullscreen = false;\r\n            this.element = null;\r\n            return;\r\n        }\r\n\r\n        try {\r\n            if (document.exitFullscreen) {\r\n                await document.exitFullscreen();\r\n            } else if (document.webkitExitFullscreen) {\r\n                await document.webkitExitFullscreen();\r\n            } else if (document.mozCancelFullScreen) {\r\n                await document.mozCancelFullScreen();\r\n            } else if (document.msExitFullscreen) {\r\n                await document.msExitFullscreen();\r\n            }\r\n            this.isFullscreen = false;\r\n            this.element = null;\r\n        } catch (err) {\r\n            console.error('FullscreenManager: Error exiting fullscreen:', err);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Exit CSS-based fallback fullscreen\r\n     * @private\r\n     */\r\n    _exitFallbackFullscreen() {\r\n        if (this.element) {\r\n            this.element.style.position = '';\r\n            this.element.style.top = '';\r\n            this.element.style.left = '';\r\n            this.element.style.width = '';\r\n            this.element.style.height = '';\r\n            this.element.style.zIndex = '';\r\n        }\r\n\r\n        document.body.style.overflow = this._origBodyOverflow || '';\r\n        this._origBodyOverflow = null;\r\n\r\n        this._usingFallback = false;\r\n        this.isFullscreen = false;\r\n\r\n        // Notify callbacks\r\n        this.changeCallbacks.forEach(cb => {\r\n            try { cb(false, null); } catch (e) { /* ignore */ }\r\n        });\r\n\r\n        this.element = null;\r\n    }\r\n\r\n    /**\r\n     * Toggle fullscreen mode\r\n     * @param {HTMLElement} element - Element to toggle fullscreen (required when entering)\r\n     * @returns {Promise<void>}\r\n     */\r\n    async toggleFullscreen(element) {\r\n        if (this.isFullscreen) {\r\n            await this.exitFullscreen();\r\n        } else {\r\n            await this.enterFullscreen(element);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if currently in fullscreen mode (native or fallback)\r\n     * @returns {boolean}\r\n     */\r\n    getIsFullscreen() {\r\n        if (this._usingFallback) return true;\r\n        return !!(\r\n            document.fullscreenElement ||\r\n            document.webkitFullscreenElement ||\r\n            document.mozFullScreenElement ||\r\n            document.msFullscreenElement\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Get the current fullscreen element\r\n     * @returns {Element|null}\r\n     */\r\n    getFullscreenElement() {\r\n        return (\r\n            document.fullscreenElement ||\r\n            document.webkitFullscreenElement ||\r\n            document.mozFullScreenElement ||\r\n            document.msFullscreenElement ||\r\n            null\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Register a callback for fullscreen changes\r\n     * @param {Function} callback - Function to call on fullscreen change\r\n     */\r\n    onFullscreenChange(callback) {\r\n        if (typeof callback === 'function') {\r\n            this.changeCallbacks.push(callback);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove a fullscreen change callback\r\n     * @param {Function} callback - Callback to remove\r\n     */\r\n    offFullscreenChange(callback) {\r\n        this.changeCallbacks = this.changeCallbacks.filter(cb => cb !== callback);\r\n    }\r\n\r\n    /**\r\n     * Handle fullscreen change events\r\n     * @private\r\n     */\r\n    _handleFullscreenChange() {\r\n        this.isFullscreen = this.getIsFullscreen();\r\n        if (!this.isFullscreen) {\r\n            this.element = null;\r\n        }\r\n\r\n        // Notify all registered callbacks\r\n        this.changeCallbacks.forEach(callback => {\r\n            try {\r\n                callback(this.isFullscreen, this.getFullscreenElement());\r\n            } catch (err) {\r\n                console.error('FullscreenManager: Callback error:', err);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Check if fullscreen is supported (always true with CSS fallback)\r\n     * @returns {boolean}\r\n     */\r\n    static isSupported() {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Check if native Fullscreen API is supported (without fallback)\r\n     * @returns {boolean}\r\n     */\r\n    static isNativeSupported() {\r\n        return !!(\r\n            document.fullscreenEnabled ||\r\n            document.webkitFullscreenEnabled ||\r\n            document.mozFullScreenEnabled ||\r\n            document.msFullscreenEnabled\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Clean up event listeners and fallback state\r\n     */\r\n    dispose() {\r\n        if (this._usingFallback) {\r\n            this._exitFallbackFullscreen();\r\n        }\r\n        document.removeEventListener('fullscreenchange', this._handleFullscreenChange);\r\n        document.removeEventListener('webkitfullscreenchange', this._handleFullscreenChange);\r\n        document.removeEventListener('mozfullscreenchange', this._handleFullscreenChange);\r\n        document.removeEventListener('MSFullscreenChange', this._handleFullscreenChange);\r\n        this.changeCallbacks = [];\r\n        this.element = null;\r\n    }\r\n}\r\n\r\n// Export for module systems and attach to window for direct access\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = FullscreenManager;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.FullscreenManager = FullscreenManager;\r\n}\r\n\n\n;/* === client/view/magic8/utils/DynamicImageGallery.js === */\n/**\r\n * DynamicImageGallery - Image gallery with crossfade and generated image splicing\r\n * Manages base images from media groups and dynamically splices in AI-generated images\r\n */\r\nclass DynamicImageGallery {\r\n    constructor(config = {}) {\r\n        this.baseImages = [];\r\n        this.generatedImages = [];\r\n        this.allImages = [];\r\n        this.currentIndex = 0;\r\n        this.cycleInterval = config.cycleInterval || 5000;\r\n        this.crossfadeDuration = config.crossfadeDuration || 1000;\r\n        this.includeGenerated = config.includeGenerated !== false;\r\n        this.maxGeneratedImages = config.maxGeneratedImages || 20;\r\n        this.generatedRatio = config.generatedRatio || 0.3; // 30% generated images\r\n\r\n        this.intervalId = null;\r\n        this.timeoutId = null;\r\n        this._running = false;\r\n        this.onImageChange = null;\r\n        this.gifDurationMultiplier = config.gifDurationMultiplier || 2;\r\n        this.generatedDurationMultiplier = config.generatedDurationMultiplier || 1.5;\r\n\r\n        // Crossfade state\r\n        this.currentImageUrl = null;\r\n        this.nextImageUrl = null;\r\n        this.isTransitioning = false;\r\n    }\r\n\r\n    /**\r\n     * Load base images from media group IDs\r\n     * @param {Array<number>} groupIds - Array of group IDs to load from\r\n     * @returns {Promise<number>} Number of images loaded\r\n     */\r\n    async loadBaseImages(groupIds) {\r\n        if (!groupIds || groupIds.length === 0) {\r\n            console.warn('DynamicImageGallery: No group IDs provided');\r\n            return 0;\r\n        }\r\n\r\n        console.log('DynamicImageGallery: Loading images for group IDs:', groupIds);\r\n\r\n        try {\r\n            // Load images from each group using search (avoids loading dataBytesStore)\r\n            let allResults = [];\r\n            for (const gid of groupIds) {\r\n                try {\r\n                    console.log('DynamicImageGallery: Searching data.data in group', gid);\r\n                    // Resolve group objectId to numeric id\r\n                    let gq = am7view.viewQuery(am7model.newInstance(\"auth.group\"));\r\n                    gq.field(\"objectId\", gid);\r\n                    let gqr = await page.search(gq);\r\n                    if (!gqr?.results?.length) {\r\n                        console.warn('DynamicImageGallery: Group not found:', gid);\r\n                        continue;\r\n                    }\r\n                    const groupNumericId = gqr.results[0].id;\r\n\r\n                    // Search data.data by numeric groupId (won't load dataBytesStore)\r\n                    //let q = am7view.viewQuery(am7model.newInstance(\"data.data\"));\r\n                    let q = am7client.newQuery(\"data.data\");\r\n                    q.range(0, 0);\r\n                    q.field(\"groupId\", groupNumericId);\r\n                    let qr = await page.search(q);\r\n                    const items = qr?.results || [];\r\n                    console.log('DynamicImageGallery: Group', gid, '(id:', groupNumericId, ') returned', items.length, 'items');\r\n                    if (items.length) {\r\n                        allResults = allResults.concat(items);\r\n                    }\r\n                } catch (groupErr) {\r\n                    console.warn('DynamicImageGallery: Failed to load group', gid, ':', groupErr);\r\n                }\r\n            }\r\n\r\n            console.log('DynamicImageGallery: Total items loaded:', allResults.length);\r\n\r\n            if (allResults.length > 0) {\r\n                this.baseImages = allResults\r\n                    .filter(r => r.name && r.contentType && r.contentType.match(/^image\\//i))\r\n                    .map(r => ({\r\n                        url: `${g_application_path}/media/Public/data.data${encodeURI(r.groupPath)}/${encodeURIComponent(r.name)}`,\r\n                        objectId: r.objectId,\r\n                        type: 'base',\r\n                        name: r.name\r\n                    }));\r\n\r\n                console.log('DynamicImageGallery: Image entries after filtering:', this.baseImages.length);\r\n                if (this.baseImages.length > 0) {\r\n                    console.log('DynamicImageGallery: Sample URL:', this.baseImages[0].url);\r\n                }\r\n\r\n                this._rebuildPool();\r\n\r\n                // Set initial images\r\n                if (this.allImages.length > 0) {\r\n                    this.currentImageUrl = this.allImages[0].url;\r\n                    if (this.allImages.length > 1) {\r\n                        this.nextImageUrl = this.allImages[1].url;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return this.baseImages.length;\r\n        } catch (err) {\r\n            console.error('DynamicImageGallery: Error loading images:', err);\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add a generated image to the pool\r\n     * @param {Object} imageData - Generated image data { url, objectId }\r\n     */\r\n    spliceGeneratedImage(imageData) {\r\n        if (!imageData || !imageData.url) {\r\n            console.warn('DynamicImageGallery: Invalid image data');\r\n            return;\r\n        }\r\n\r\n        this.generatedImages.push({\r\n            url: imageData.url,\r\n            objectId: imageData.objectId,\r\n            type: 'generated',\r\n            timestamp: Date.now()\r\n        });\r\n\r\n        // Trim old generated images if over limit\r\n        if (this.generatedImages.length > this.maxGeneratedImages) {\r\n            this.generatedImages = this.generatedImages.slice(-this.maxGeneratedImages);\r\n        }\r\n\r\n        this._rebuildPool();\r\n    }\r\n\r\n    /**\r\n     * Rebuild the combined image pool with interleaved generated images\r\n     * @private\r\n     */\r\n    _rebuildPool() {\r\n        if (!this.includeGenerated || this.generatedImages.length === 0) {\r\n            this.allImages = [...this.baseImages];\r\n        } else {\r\n            // Interleave generated images with base images\r\n            this.allImages = [];\r\n            let baseIdx = 0;\r\n            let genIdx = 0;\r\n\r\n            while (baseIdx < this.baseImages.length || genIdx < this.generatedImages.length) {\r\n                // Add base images\r\n                if (baseIdx < this.baseImages.length) {\r\n                    this.allImages.push(this.baseImages[baseIdx++]);\r\n                }\r\n\r\n                // Occasionally insert generated image\r\n                if (genIdx < this.generatedImages.length && Math.random() < this.generatedRatio) {\r\n                    this.allImages.push(this.generatedImages[genIdx++]);\r\n                }\r\n            }\r\n\r\n            // Add any remaining generated images\r\n            while (genIdx < this.generatedImages.length) {\r\n                this.allImages.push(this.generatedImages[genIdx++]);\r\n            }\r\n        }\r\n\r\n        // Shuffle for variety\r\n        this._shuffle(this.allImages);\r\n    }\r\n\r\n    /**\r\n     * Fisher-Yates shuffle\r\n     * @param {Array} array - Array to shuffle in place\r\n     * @private\r\n     */\r\n    _shuffle(array) {\r\n        for (let i = array.length - 1; i > 0; i--) {\r\n            const j = Math.floor(Math.random() * (i + 1));\r\n            [array[i], array[j]] = [array[j], array[i]];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the next image in rotation\r\n     * @returns {Object|null} Next image object\r\n     */\r\n    getNext() {\r\n        if (this.allImages.length === 0) return null;\r\n\r\n        this.currentIndex = (this.currentIndex + 1) % this.allImages.length;\r\n        return this.allImages[this.currentIndex];\r\n    }\r\n\r\n    /**\r\n     * Get the current image\r\n     * @returns {Object|null} Current image object\r\n     */\r\n    getCurrent() {\r\n        return this.allImages[this.currentIndex] || null;\r\n    }\r\n\r\n    /**\r\n     * Get current image URL\r\n     * @returns {string|null}\r\n     */\r\n    getCurrentUrl() {\r\n        const current = this.getCurrent();\r\n        return current ? current.url : null;\r\n    }\r\n\r\n    /**\r\n     * Get display duration for an image based on its type\r\n     * @param {Object} image - Image object with type and name/url\r\n     * @returns {number} Duration in milliseconds\r\n     * @private\r\n     */\r\n    _getDurationForImage(image) {\r\n        if (!image) return this.cycleInterval;\r\n        const name = (image.name || image.url || '').toLowerCase();\r\n        if (name.endsWith('.gif')) {\r\n            return this.cycleInterval * this.gifDurationMultiplier;\r\n        }\r\n        if (image.type === 'generated') {\r\n            return this.cycleInterval * this.generatedDurationMultiplier;\r\n        }\r\n        return this.cycleInterval;\r\n    }\r\n\r\n    /**\r\n     * Start automatic image cycling with variable durations per image type\r\n     */\r\n    start() {\r\n        if (this._running) return;\r\n        this._running = true;\r\n        this._scheduleNext();\r\n    }\r\n\r\n    /**\r\n     * Schedule the next cycle based on current image's duration\r\n     * @private\r\n     */\r\n    _scheduleNext() {\r\n        if (this.timeoutId) return;\r\n        const current = this.getCurrent();\r\n        const duration = this._getDurationForImage(current);\r\n        this.timeoutId = setTimeout(() => {\r\n            this.timeoutId = null;\r\n            this._cycle();\r\n        }, duration);\r\n    }\r\n\r\n    /**\r\n     * Stop automatic image cycling\r\n     */\r\n    stop() {\r\n        this._running = false;\r\n        if (this.timeoutId) {\r\n            clearTimeout(this.timeoutId);\r\n            this.timeoutId = null;\r\n        }\r\n        // Legacy cleanup\r\n        if (this.intervalId) {\r\n            clearInterval(this.intervalId);\r\n            this.intervalId = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Perform image cycle with crossfade\r\n     * @private\r\n     */\r\n    _cycle() {\r\n        if (this.allImages.length === 0 || this.isTransitioning) return;\r\n\r\n        this.isTransitioning = true;\r\n        const next = this.getNext();\r\n\r\n        if (next && this.onImageChange) {\r\n            this.onImageChange(next, this.currentIndex, this.allImages.length);\r\n        }\r\n\r\n        // Reset transition flag after crossfade duration, then schedule next\r\n        setTimeout(() => {\r\n            this.isTransitioning = false;\r\n            // Continue cycling if we haven't been stopped\r\n            if (!this.timeoutId && this._isRunning()) {\r\n                this._scheduleNext();\r\n            }\r\n        }, this.crossfadeDuration);\r\n    }\r\n\r\n    /**\r\n     * Check if gallery cycling is active\r\n     * @returns {boolean}\r\n     * @private\r\n     */\r\n    _isRunning() {\r\n        return this._running === true;\r\n    }\r\n\r\n    /**\r\n     * Show a specific image immediately (bypasses cycle rotation)\r\n     * Also adds it to the generated pool if not already present.\r\n     * @param {Object} imageData - Image data { url, objectId }\r\n     */\r\n    showImmediate(imageData) {\r\n        if (!imageData || !imageData.url) return;\r\n\r\n        // Add to generated pool if not already there\r\n        const exists = this.generatedImages.some(g => g.objectId === imageData.objectId);\r\n        if (!exists) {\r\n            this.spliceGeneratedImage(imageData);\r\n        }\r\n\r\n        // Reset cycle timer so this image gets a full display period\r\n        const wasRunning = this._running;\r\n        if (wasRunning) {\r\n            this.stop();\r\n        }\r\n\r\n        // Trigger onImageChange directly to display this image now\r\n        if (this.onImageChange) {\r\n            this.onImageChange({\r\n                url: imageData.url,\r\n                objectId: imageData.objectId,\r\n                type: 'generated'\r\n            }, this.currentIndex, this.allImages.length);\r\n        }\r\n\r\n        // Restart cycling so the image stays for a full interval\r\n        if (wasRunning) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Manually trigger next image\r\n     */\r\n    next() {\r\n        this._cycle();\r\n    }\r\n\r\n    /**\r\n     * Manually trigger previous image\r\n     */\r\n    previous() {\r\n        if (this.allImages.length === 0) return;\r\n\r\n        this.currentIndex = (this.currentIndex - 1 + this.allImages.length) % this.allImages.length;\r\n        const current = this.getCurrent();\r\n\r\n        if (current && this.onImageChange) {\r\n            this.onImageChange(current, this.currentIndex, this.allImages.length);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set cycle interval\r\n     * @param {number} interval - Interval in milliseconds\r\n     */\r\n    setCycleInterval(interval) {\r\n        this.cycleInterval = interval;\r\n        if (this._running) {\r\n            this.stop();\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get statistics about the gallery\r\n     * @returns {Object}\r\n     */\r\n    getStats() {\r\n        return {\r\n            baseCount: this.baseImages.length,\r\n            generatedCount: this.generatedImages.length,\r\n            totalCount: this.allImages.length,\r\n            currentIndex: this.currentIndex,\r\n            isRunning: this._running\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Clear all generated images\r\n     */\r\n    clearGenerated() {\r\n        this.generatedImages = [];\r\n        this._rebuildPool();\r\n    }\r\n\r\n    /**\r\n     * Clean up resources\r\n     */\r\n    dispose() {\r\n        this.stop();\r\n        this.baseImages = [];\r\n        this.generatedImages = [];\r\n        this.allImages = [];\r\n        this.onImageChange = null;\r\n    }\r\n}\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = DynamicImageGallery;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.DynamicImageGallery = DynamicImageGallery;\r\n}\r\n\n\n;/* === client/view/magic8/audio/AudioEngine.js === */\n/**\r\n * AudioEngine - Unified audio context management for Magic8\r\n * Handles voice synthesis, binaural beats, isochronic tones, Q-sound panning,\r\n * and audio source management with analyser node for visualizers\r\n */\r\nclass AudioEngine {\r\n    constructor() {\r\n        this.context = null;\r\n        this.sources = new Map();\r\n        this.binauralEngine = null;\r\n        this.isochronicEngine = null;\r\n        this.masterGain = null;\r\n        this.destinationNode = null;\r\n        this.analyserNode = null;\r\n        this.isInitialized = false;\r\n        this.currentBandLabel = null;\r\n    }\r\n\r\n    /**\r\n     * Brainwave frequency band definitions\r\n     */\r\n    static BRAINWAVE_BANDS = {\r\n        delta:      { label: 'Delta (Deep Sleep)',             min: 0.5, max: 4,    mid: 2,    desc: 'Deep dreamless sleep, healing, unconscious' },\r\n        theta:      { label: 'Theta (Meditation)',             min: 4,   max: 7.5,  mid: 5.5,  desc: 'Hypnosis, deep meditation, REM, subconscious' },\r\n        alphaTheta: { label: 'Alpha-Theta Border (Hypnotic)',  min: 7,   max: 8,    mid: 7.5,  desc: 'Visualization, mind programming, conscious creation' },\r\n        alpha:      { label: 'Alpha (Relaxation)',             min: 7.5, max: 14,   mid: 10,   desc: 'Relaxation, learning, imagination, intuition' },\r\n        beta:       { label: 'Beta (Waking)',                  min: 14,  max: 40,   mid: 20,   desc: 'Alertness, logic, focus, can cause stress' },\r\n        gamma:      { label: 'Gamma (Insight)',                min: 40,  max: 100,  mid: 40,   desc: 'High-level processing, bursts of insight' }\r\n    };\r\n\r\n    /**\r\n     * Solfeggio carrier frequency definitions\r\n     */\r\n    static SOLFEGGIO_FREQS = {\r\n        174:  { label: '174 Hz \\u2014 Foundation',       desc: 'Pain relief, sense of security' },\r\n        285:  { label: '285 Hz \\u2014 Restoration',      desc: 'Healing tissue, energy field repair' },\r\n        396:  { label: '396 Hz \\u2014 Liberation',       desc: 'Releasing guilt and fear' },\r\n        417:  { label: '417 Hz \\u2014 Change',           desc: 'Facilitating change, undoing situations' },\r\n        432:  { label: '432 Hz \\u2014 Spiritual Tuning', desc: 'Natural alignment, spiritual attunement' },\r\n        528:  { label: '528 Hz \\u2014 Love',             desc: 'Transformation, love frequency, DNA repair' },\r\n        639:  { label: '639 Hz \\u2014 Connection',       desc: 'Heart opening, relationships, harmonizing' },\r\n        741:  { label: '741 Hz \\u2014 Expression',       desc: 'Self-expression, solutions, creative awakening' },\r\n        852:  { label: '852 Hz \\u2014 Intuition',        desc: 'Third eye activation, spiritual sight' },\r\n        963:  { label: '963 Hz \\u2014 Divine',           desc: 'Crown chakra, pineal gland, divine consciousness' }\r\n    };\r\n\r\n    /**\r\n     * Named frequency combination presets (solfeggio carrier + brainwave band transitions)\r\n     */\r\n    static FREQUENCY_PRESETS = {\r\n        goddessEnergy: {\r\n            label: 'Goddess Energy',\r\n            desc: 'Spiritual femininity, divine feminine through meditative states',\r\n            baseFreq: 432,\r\n            startBand: 'alpha', troughBand: 'alphaTheta', endBand: 'theta'\r\n        },\r\n        heartOpening: {\r\n            label: 'Heart Opening',\r\n            desc: 'Connection, compassion, relational harmony',\r\n            baseFreq: 639,\r\n            startBand: 'alpha', troughBand: 'theta', endBand: 'alpha'\r\n        },\r\n        loveFrequency: {\r\n            label: 'Love Frequency',\r\n            desc: 'Transformation, cellular healing, unconditional love',\r\n            baseFreq: 528,\r\n            startBand: 'alpha', troughBand: 'alphaTheta', endBand: 'alpha'\r\n        },\r\n        deepHealing: {\r\n            label: 'Deep Healing',\r\n            desc: 'Physical restoration, deep regeneration',\r\n            baseFreq: 174,\r\n            startBand: 'theta', troughBand: 'delta', endBand: 'theta'\r\n        },\r\n        lettingGo: {\r\n            label: 'Letting Go',\r\n            desc: 'Releasing guilt, fear, and emotional blockages',\r\n            baseFreq: 396,\r\n            startBand: 'alpha', troughBand: 'theta', endBand: 'alphaTheta'\r\n        },\r\n        transformation: {\r\n            label: 'Transformation',\r\n            desc: 'Facilitating change, breaking old patterns',\r\n            baseFreq: 417,\r\n            startBand: 'alpha', troughBand: 'theta', endBand: 'theta'\r\n        },\r\n        creativeFlow: {\r\n            label: 'Creative Flow',\r\n            desc: 'Self-expression, artistic solutions, inspired work',\r\n            baseFreq: 741,\r\n            startBand: 'alpha', troughBand: 'alphaTheta', endBand: 'alpha'\r\n        },\r\n        thirdEye: {\r\n            label: 'Third Eye Awakening',\r\n            desc: 'Intuition, spiritual sight, inner knowing',\r\n            baseFreq: 852,\r\n            startBand: 'alpha', troughBand: 'theta', endBand: 'alphaTheta'\r\n        },\r\n        crownConnection: {\r\n            label: 'Crown Connection',\r\n            desc: 'Divine consciousness, universal awareness',\r\n            baseFreq: 963,\r\n            startBand: 'alpha', troughBand: 'theta', endBand: 'gamma'\r\n        },\r\n        regeneration: {\r\n            label: 'Regeneration',\r\n            desc: 'Deep tissue repair, energy field restoration',\r\n            baseFreq: 285,\r\n            startBand: 'theta', troughBand: 'delta', endBand: 'theta'\r\n        },\r\n        deepHypnosis: {\r\n            label: 'Deep Hypnosis',\r\n            desc: 'Hypnotic induction, subconscious programming, visualization',\r\n            baseFreq: 432,\r\n            startBand: 'alpha', troughBand: 'alphaTheta', endBand: 'delta'\r\n        },\r\n        lucidDream: {\r\n            label: 'Lucid Dreaming',\r\n            desc: 'Conscious dream state, REM activation',\r\n            baseFreq: 528,\r\n            startBand: 'alpha', troughBand: 'theta', endBand: 'delta'\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Get or create the AudioContext (singleton pattern)\r\n     * @returns {AudioContext}\r\n     */\r\n    getContext() {\r\n        if (!this.context || this.context.state === 'closed') {\r\n            this.context = new (window.AudioContext || window.webkitAudioContext)();\r\n            this._setupMasterChain();\r\n        }\r\n        return this.context;\r\n    }\r\n\r\n    /**\r\n     * Setup the master audio chain for recording support\r\n     * @private\r\n     */\r\n    _setupMasterChain() {\r\n        if (this.masterGain) return;\r\n\r\n        this.masterGain = this.context.createGain();\r\n        this.masterGain.gain.value = 1.0;\r\n\r\n        // Create a destination for recording (MediaStreamDestination)\r\n        if (this.context.createMediaStreamDestination) {\r\n            this.destinationNode = this.context.createMediaStreamDestination();\r\n            this.masterGain.connect(this.destinationNode);\r\n        }\r\n\r\n        // Also connect to speakers\r\n        this.masterGain.connect(this.context.destination);\r\n        this.isInitialized = true;\r\n    }\r\n\r\n    /**\r\n     * Get the audio destination for recording\r\n     * @returns {MediaStreamAudioDestinationNode|null}\r\n     */\r\n    getDestination() {\r\n        if (!this.isInitialized) {\r\n            this.getContext();\r\n        }\r\n        return this.destinationNode;\r\n    }\r\n\r\n    /**\r\n     * Get or create an AnalyserNode connected to the master output.\r\n     * Used by AudioVisualizerOverlay to display frequency data.\r\n     * @returns {AnalyserNode}\r\n     */\r\n    getAnalyser() {\r\n        if (this.analyserNode) return this.analyserNode;\r\n\r\n        const ctx = this.getContext();\r\n        this.analyserNode = ctx.createAnalyser();\r\n        this.analyserNode.fftSize = 2048;\r\n        this.analyserNode.smoothingTimeConstant = 0.85;\r\n\r\n        // Insert analyser between masterGain and destinations\r\n        // Disconnect masterGain from current destinations\r\n        this.masterGain.disconnect();\r\n\r\n        // Reconnect through analyser\r\n        this.masterGain.connect(this.analyserNode);\r\n        this.analyserNode.connect(this.context.destination);\r\n        if (this.destinationNode) {\r\n            this.analyserNode.connect(this.destinationNode);\r\n        }\r\n\r\n        return this.analyserNode;\r\n    }\r\n\r\n    /**\r\n     * Resume audio context (needed after user interaction)\r\n     * @returns {Promise<void>}\r\n     */\r\n    async resume() {\r\n        const ctx = this.getContext();\r\n        if (ctx.state === 'suspended') {\r\n            await ctx.resume();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Create a hash for content caching\r\n     * @param {string} content - Content to hash\r\n     * @returns {string}\r\n     */\r\n    hashContent(content) {\r\n        let hash = 0;\r\n        for (let i = 0; i < content.length; i++) {\r\n            const char = content.charCodeAt(i);\r\n            hash = ((hash << 5) - hash) + char;\r\n            hash = hash & hash;\r\n        }\r\n        return 'audio_' + hash.toString(16);\r\n    }\r\n\r\n    /**\r\n     * Create a voice audio source from text content\r\n     * @param {string} content - Text content to synthesize\r\n     * @param {string} profileId - Voice profile ID\r\n     * @returns {Promise<Object>} Audio source object\r\n     */\r\n    async createVoiceSource(content, profileId) {\r\n        const hash = this.hashContent(content + profileId);\r\n\r\n        // Return cached source if exists\r\n        if (this.sources.has(hash)) {\r\n            return this.sources.get(hash);\r\n        }\r\n\r\n        // Clean content for synthesis\r\n        let cleanContent = content\r\n            .replace(/([\\u2700-\\u27BF]|[\\uE000-\\uF8FF]|\\uD83C[\\uDC00-\\uDFFF]|\\uD83D[\\uDC00-\\uDFFF]|[\\u2011-\\u26FF]|\\uD83E[\\uDD10-\\uDDFF])/g, \"\")\r\n            .replace(/[\"\\*]+/g, \"\");\r\n\r\n        if (!cleanContent || cleanContent.length === 0) {\r\n            console.warn('AudioEngine: No content to synthesize');\r\n            return null;\r\n        }\r\n\r\n        try {\r\n            // Build voice request\r\n            const vprops = {\r\n                text: cleanContent,\r\n                speed: 1.2\r\n            };\r\n\r\n            if (profileId) {\r\n                vprops.voiceProfileId = profileId;\r\n            } else {\r\n                vprops.engine = \"piper\";\r\n                vprops.speaker = \"en_GB-alba-medium\";\r\n            }\r\n\r\n            // Synthesize voice\r\n            const response = await m.request({\r\n                method: 'POST',\r\n                url: `${g_application_path}/rest/voice/${hash}`,\r\n                withCredentials: true,\r\n                body: vprops\r\n            });\r\n\r\n            if (!response || !response.dataBytesStore) {\r\n                throw new Error('No audio data received');\r\n            }\r\n\r\n            // Decode audio\r\n            const ctx = this.getContext();\r\n            const arrayBuffer = this._base64ToArrayBuffer(response.dataBytesStore);\r\n            const audioBuffer = await ctx.decodeAudioData(arrayBuffer);\r\n\r\n            // Create source object\r\n            const source = {\r\n                id: hash,\r\n                buffer: audioBuffer,\r\n                context: ctx,\r\n                started: false,\r\n                source: null,\r\n\r\n                play: () => this._playSource(hash),\r\n                stop: () => this._stopSource(hash),\r\n                isPlaying: () => this._isSourcePlaying(hash)\r\n            };\r\n\r\n            this.sources.set(hash, source);\r\n            return source;\r\n\r\n        } catch (err) {\r\n            console.error('AudioEngine: Error creating voice source:', err);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Play an audio source\r\n     * @param {string} hash - Source hash\r\n     * @private\r\n     */\r\n    _playSource(hash) {\r\n        const source = this.sources.get(hash);\r\n        if (!source) return;\r\n\r\n        // Stop any currently playing sources\r\n        this.stopAllSources();\r\n\r\n        const ctx = this.getContext();\r\n\r\n        // Create new buffer source node (required for each playback)\r\n        source.source = ctx.createBufferSource();\r\n        source.source.buffer = source.buffer;\r\n        source.source.connect(this.masterGain);\r\n\r\n        source.source.onended = () => {\r\n            source.started = false;\r\n        };\r\n\r\n        if (ctx.state === 'suspended') {\r\n            ctx.resume().then(() => {\r\n                source.source.start(0);\r\n                source.started = true;\r\n            });\r\n        } else {\r\n            source.source.start(0);\r\n            source.started = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Stop an audio source\r\n     * @param {string} hash - Source hash\r\n     * @private\r\n     */\r\n    _stopSource(hash) {\r\n        const source = this.sources.get(hash);\r\n        if (!source || !source.started) return;\r\n\r\n        try {\r\n            source.source.stop();\r\n        } catch (e) {\r\n            // Source may already be stopped\r\n        }\r\n        source.started = false;\r\n    }\r\n\r\n    /**\r\n     * Check if a source is playing\r\n     * @param {string} hash - Source hash\r\n     * @returns {boolean}\r\n     * @private\r\n     */\r\n    _isSourcePlaying(hash) {\r\n        const source = this.sources.get(hash);\r\n        return source ? source.started : false;\r\n    }\r\n\r\n    /**\r\n     * Stop all playing audio sources\r\n     */\r\n    stopAllSources() {\r\n        this.sources.forEach((source, hash) => {\r\n            if (source.started) {\r\n                this._stopSource(hash);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Start binaural beats with configurable sweep, fades, and Q-sound panning\r\n     * @param {Object} config - Binaural configuration\r\n     * @param {number} [config.baseFreq=440] - Base carrier frequency (Hz)\r\n     * @param {number} [config.sweepStart=8] - Beat frequency at start of sweep cycle (Hz)\r\n     * @param {number} [config.sweepTrough=2] - Beat frequency at midpoint of sweep cycle (Hz)\r\n     * @param {number} [config.sweepEnd=8] - Beat frequency at end of sweep cycle (Hz)\r\n     * @param {number} [config.sweepDurationMin=5] - Full sweep cycle duration (minutes)\r\n     * @param {number} [config.fadeInSec=2] - Fade-in duration (seconds)\r\n     * @param {number} [config.fadeOutSec=3] - Fade-out duration (seconds)\r\n     * @param {boolean} [config.panEnabled=false] - Enable Q-sound spatial panning\r\n     * @param {number} [config.panSpeed=0.1] - Pan oscillation speed (radians/sec)\r\n     * @param {number} [config.panDepth=0.8] - Pan sweep depth (-1 to 1 range)\r\n     */\r\n    startBinaural(config = {}) {\r\n        if (this.binauralEngine) {\r\n            this.stopBinaural();\r\n        }\r\n\r\n        const ctx = this.getContext();\r\n\r\n        const baseFreq = config.baseFreq || 440;\r\n        // Support new 3-point sweep or fall back to legacy minBeat/maxBeat\r\n        const sweepStart = config.sweepStart || config.maxBeat || 8;\r\n        const sweepTrough = config.sweepTrough || config.minBeat || 2;\r\n        const sweepEnd = config.sweepEnd || config.maxBeat || 8;\r\n        const sweepDurationMin = config.sweepDurationMin || 5;\r\n        const fadeInSec = config.fadeInSec || 2;\r\n        const fadeOutSec = config.fadeOutSec || 3;\r\n        const panEnabled = config.panEnabled || false;\r\n        const panSpeed = config.panSpeed || 0.1;\r\n        const panDepth = config.panDepth || 0.8;\r\n\r\n        // Create oscillators and nodes\r\n        this.binauralEngine = {\r\n            leftOsc: ctx.createOscillator(),\r\n            rightOsc: ctx.createOscillator(),\r\n            leftGain: ctx.createGain(),\r\n            rightGain: ctx.createGain(),\r\n            binauralGain: ctx.createGain(),\r\n            merger: ctx.createChannelMerger(2),\r\n            dcBlocker: ctx.createBiquadFilter(),\r\n            panner: null,\r\n            panAnimFrame: null,\r\n            baseFreq,\r\n            sweepStart,\r\n            sweepTrough,\r\n            sweepEnd,\r\n            sweepDurationMin,\r\n            fadeInSec,\r\n            fadeOutSec,\r\n            panEnabled,\r\n            panSpeed,\r\n            panDepth,\r\n            sweepInterval: null\r\n        };\r\n\r\n        const be = this.binauralEngine;\r\n\r\n        // Configure DC blocker\r\n        be.dcBlocker.type = \"highpass\";\r\n        be.dcBlocker.frequency.value = 20;\r\n\r\n        // Set initial gain to 0 for smooth ramp-up\r\n        be.binauralGain.gain.setValueAtTime(0, ctx.currentTime);\r\n\r\n        // Build audio graph\r\n        be.leftOsc.connect(be.leftGain).connect(be.merger, 0, 0);\r\n        be.rightOsc.connect(be.rightGain).connect(be.merger, 0, 1);\r\n\r\n        if (panEnabled) {\r\n            // Q-sound: insert StereoPannerNode after merger\r\n            be.panner = ctx.createStereoPanner();\r\n            be.panner.pan.value = 0;\r\n            be.merger.connect(be.panner);\r\n            be.panner.connect(be.binauralGain);\r\n        } else {\r\n            be.merger.connect(be.binauralGain);\r\n        }\r\n\r\n        be.binauralGain.connect(be.dcBlocker);\r\n        be.dcBlocker.connect(this.masterGain);\r\n\r\n        // Set initial frequencies (start of sweep)\r\n        be.leftOsc.frequency.setValueAtTime(baseFreq, ctx.currentTime);\r\n        be.rightOsc.frequency.setValueAtTime(baseFreq + sweepStart, ctx.currentTime);\r\n\r\n        // Start oscillators\r\n        be.leftOsc.start();\r\n        be.rightOsc.start();\r\n\r\n        // Smooth fade-in\r\n        const targetVolume = 0.35;\r\n        const delay = 0.05;\r\n        const startTime = ctx.currentTime + delay;\r\n\r\n        be.binauralGain.gain.cancelScheduledValues(ctx.currentTime);\r\n        be.binauralGain.gain.setValueAtTime(0, ctx.currentTime);\r\n        be.binauralGain.gain.linearRampToValueAtTime(targetVolume, startTime + fadeInSec);\r\n\r\n        // Start frequency sweep\r\n        this._scheduleBinauralSweep();\r\n        be.sweepInterval = setInterval(\r\n            () => this._scheduleBinauralSweep(),\r\n            sweepDurationMin * 60 * 1000\r\n        );\r\n\r\n        // Start Q-sound panning animation if enabled\r\n        if (panEnabled) {\r\n            this._startPanAnimation();\r\n        }\r\n\r\n        console.log('AudioEngine: Binaural started  base:', baseFreq, 'Hz, sweep:',\r\n            sweepStart, '', sweepTrough, '', sweepEnd, 'Hz, cycle:', sweepDurationMin, 'min',\r\n            panEnabled ? ', Q-sound enabled' : '');\r\n    }\r\n\r\n    /**\r\n     * Schedule binaural frequency sweep (3-point: start  trough  end)\r\n     * @private\r\n     */\r\n    _scheduleBinauralSweep() {\r\n        if (!this.binauralEngine) return;\r\n\r\n        const be = this.binauralEngine;\r\n        const ctx = this.context;\r\n        const now = ctx.currentTime;\r\n        const halfCycle = (be.sweepDurationMin * 60) / 2;\r\n\r\n        be.rightOsc.frequency.cancelScheduledValues(now);\r\n        be.rightOsc.frequency.setValueAtTime(be.baseFreq + be.sweepStart, now);\r\n        be.rightOsc.frequency.linearRampToValueAtTime(be.baseFreq + be.sweepTrough, now + halfCycle);\r\n        be.rightOsc.frequency.linearRampToValueAtTime(be.baseFreq + be.sweepEnd, now + 2 * halfCycle);\r\n    }\r\n\r\n    /**\r\n     * Animate Q-sound stereo panning using requestAnimationFrame\r\n     * Creates slow spatial movement for an immersive effect\r\n     * @private\r\n     */\r\n    _startPanAnimation() {\r\n        if (!this.binauralEngine || !this.binauralEngine.panner) return;\r\n\r\n        const be = this.binauralEngine;\r\n        const startTime = performance.now();\r\n\r\n        const animate = (now) => {\r\n            if (!this.binauralEngine || !be.panner) return;\r\n\r\n            const elapsed = (now - startTime) / 1000;\r\n            const panValue = Math.sin(elapsed * be.panSpeed) * be.panDepth;\r\n            be.panner.pan.value = Math.max(-1, Math.min(1, panValue));\r\n\r\n            be.panAnimFrame = requestAnimationFrame(animate);\r\n        };\r\n\r\n        be.panAnimFrame = requestAnimationFrame(animate);\r\n    }\r\n\r\n    /**\r\n     * Stop binaural beats with configurable fade-out\r\n     */\r\n    stopBinaural() {\r\n        if (!this.binauralEngine) return;\r\n\r\n        const be = this.binauralEngine;\r\n        const ctx = this.context;\r\n\r\n        if (be.sweepInterval) {\r\n            clearInterval(be.sweepInterval);\r\n        }\r\n\r\n        if (be.panAnimFrame) {\r\n            cancelAnimationFrame(be.panAnimFrame);\r\n        }\r\n\r\n        if (!ctx) {\r\n            // Context already closed or never created - just clean up references\r\n            try { be.leftOsc.stop(); } catch (e) {}\r\n            try { be.rightOsc.stop(); } catch (e) {}\r\n            try { be.leftOsc.disconnect(); } catch (e) {}\r\n            try { be.rightOsc.disconnect(); } catch (e) {}\r\n            try { be.binauralGain.disconnect(); } catch (e) {}\r\n            if (be.panner) try { be.panner.disconnect(); } catch (e) {}\r\n            this.binauralEngine = null;\r\n            return;\r\n        }\r\n\r\n        // Ramp down volume using configured fade-out\r\n        const fadeOutSec = be.fadeOutSec || 3;\r\n        const now = ctx.currentTime;\r\n        be.binauralGain.gain.cancelScheduledValues(now);\r\n        be.binauralGain.gain.setValueAtTime(be.binauralGain.gain.value, now);\r\n        be.binauralGain.gain.linearRampToValueAtTime(0, now + fadeOutSec);\r\n\r\n        setTimeout(() => {\r\n            try {\r\n                be.leftOsc.stop();\r\n                be.rightOsc.stop();\r\n            } catch (e) {}\r\n\r\n            try {\r\n                be.leftOsc.disconnect();\r\n                be.rightOsc.disconnect();\r\n                be.binauralGain.disconnect();\r\n                be.dcBlocker.disconnect();\r\n                if (be.panner) be.panner.disconnect();\r\n            } catch (e) {}\r\n\r\n            this.binauralEngine = null;\r\n        }, (fadeOutSec * 1000) + 50);\r\n    }\r\n\r\n    /**\r\n     * Start isochronic tones  amplitude-modulated rhythmic pulsing\r\n     * @param {Object} config - Isochronic configuration\r\n     * @param {number} [config.isochronicFreq=200] - Tone frequency (Hz)\r\n     * @param {number} [config.isochronicRate=6] - Pulse rate (Hz, e.g. 4-10)\r\n     * @param {number} [config.isochronicVolume=0.15] - Volume (0-1)\r\n     */\r\n    startIsochronic(config = {}) {\r\n        if (this.isochronicEngine) {\r\n            this.stopIsochronic();\r\n        }\r\n\r\n        const ctx = this.getContext();\r\n        const freq = config.isochronicFreq || 200;\r\n        const rate = config.isochronicRate || 6;\r\n        const volume = config.isochronicVolume || 0.15;\r\n\r\n        // Create oscillator for the tone\r\n        const osc = ctx.createOscillator();\r\n        osc.type = 'sine';\r\n        osc.frequency.value = freq;\r\n\r\n        // Create gain node for amplitude modulation (the pulsing)\r\n        const pulseGain = ctx.createGain();\r\n        pulseGain.gain.value = 0;\r\n\r\n        // Create master gain for overall volume\r\n        const isoGain = ctx.createGain();\r\n        isoGain.gain.value = volume;\r\n\r\n        // Connect: osc  pulseGain  isoGain  masterGain\r\n        osc.connect(pulseGain);\r\n        pulseGain.connect(isoGain);\r\n        isoGain.connect(this.masterGain);\r\n\r\n        osc.start();\r\n\r\n        // Schedule repeating pulse pattern\r\n        const pulseDuration = 1.0 / rate;\r\n        const onDuration = pulseDuration * 0.5;\r\n        const offDuration = pulseDuration * 0.5;\r\n        const rampTime = 0.01; // sharp on/off transitions\r\n\r\n        this.isochronicEngine = {\r\n            osc,\r\n            pulseGain,\r\n            isoGain,\r\n            rate,\r\n            interval: null\r\n        };\r\n\r\n        // Schedule pulses using a recurring function\r\n        const schedulePulses = () => {\r\n            if (!this.isochronicEngine) return;\r\n\r\n            const now = ctx.currentTime;\r\n            const scheduleAhead = 2.0; // schedule 2 seconds ahead\r\n\r\n            for (let t = 0; t < scheduleAhead; t += pulseDuration) {\r\n                const pulseStart = now + t;\r\n                // On: ramp up\r\n                pulseGain.gain.setValueAtTime(0, pulseStart);\r\n                pulseGain.gain.linearRampToValueAtTime(1, pulseStart + rampTime);\r\n                // Stay on\r\n                pulseGain.gain.setValueAtTime(1, pulseStart + onDuration - rampTime);\r\n                // Off: ramp down\r\n                pulseGain.gain.linearRampToValueAtTime(0, pulseStart + onDuration);\r\n            }\r\n        };\r\n\r\n        schedulePulses();\r\n        this.isochronicEngine.interval = setInterval(schedulePulses, 1500);\r\n\r\n        console.log('AudioEngine: Isochronic started  freq:', freq, 'Hz, rate:', rate, 'Hz, vol:', volume);\r\n    }\r\n\r\n    /**\r\n     * Stop isochronic tones\r\n     */\r\n    stopIsochronic() {\r\n        if (!this.isochronicEngine) return;\r\n\r\n        const ie = this.isochronicEngine;\r\n        if (ie.interval) {\r\n            clearInterval(ie.interval);\r\n        }\r\n\r\n        try {\r\n            ie.pulseGain.gain.cancelScheduledValues(0);\r\n            ie.isoGain.gain.value = 0;\r\n        } catch (e) {}\r\n\r\n        setTimeout(() => {\r\n            try {\r\n                ie.osc.stop();\r\n                ie.osc.disconnect();\r\n                ie.pulseGain.disconnect();\r\n                ie.isoGain.disconnect();\r\n            } catch (e) {}\r\n        }, 100);\r\n\r\n        this.isochronicEngine = null;\r\n    }\r\n\r\n    /**\r\n     * Convert base64 string to ArrayBuffer\r\n     * @param {string} base64 - Base64 encoded string\r\n     * @returns {ArrayBuffer}\r\n     * @private\r\n     */\r\n    _base64ToArrayBuffer(base64) {\r\n        const cleanedBase64 = base64.replace(/^data:audio\\/\\w+;base64,/, '');\r\n        const binaryString = atob(cleanedBase64);\r\n        const len = binaryString.length;\r\n        const bytes = new Uint8Array(len);\r\n\r\n        for (let i = 0; i < len; i++) {\r\n            bytes[i] = binaryString.charCodeAt(i);\r\n        }\r\n\r\n        return bytes.buffer;\r\n    }\r\n\r\n    /**\r\n     * Set master volume\r\n     * @param {number} volume - Volume level (0-1)\r\n     */\r\n    setVolume(volume) {\r\n        if (this.masterGain) {\r\n            this.masterGain.gain.value = Math.max(0, Math.min(1, volume));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Start binaural beats from a named preset\r\n     * @param {string} presetName - Key from FREQUENCY_PRESETS\r\n     * @param {Object} [overrides] - Optional config overrides\r\n     */\r\n    startBinauralFromPreset(presetName, overrides) {\r\n        const preset = AudioEngine.FREQUENCY_PRESETS[presetName];\r\n        if (!preset) {\r\n            console.warn('AudioEngine: Unknown preset:', presetName);\r\n            return;\r\n        }\r\n        this.startBinauralFromBands({ ...preset, ...overrides });\r\n    }\r\n\r\n    /**\r\n     * Start binaural beats using named brainwave bands\r\n     * @param {Object} config\r\n     * @param {string} config.startBand - Starting band name\r\n     * @param {string} config.troughBand - Trough band name\r\n     * @param {string} config.endBand - End band name\r\n     * @param {string} [config.secondTransition] - Optional 2nd transition band\r\n     * @param {string} [config.thirdTransition] - Optional 3rd transition band\r\n     * @param {number} [config.baseFreq=200] - Carrier frequency (Hz)\r\n     * @param {number} [config.sweepDurationMin=5] - Full sweep cycle (minutes)\r\n     * @param {number} [config.fadeInSec=2] - Fade-in duration (seconds)\r\n     * @param {number} [config.fadeOutSec=3] - Fade-out duration (seconds)\r\n     */\r\n    startBinauralFromBands(config) {\r\n        const bands = AudioEngine.BRAINWAVE_BANDS;\r\n        const start = bands[config.startBand] || bands.alpha;\r\n        const trough = bands[config.troughBand] || bands.theta;\r\n        const end = bands[config.endBand] || bands.alpha;\r\n\r\n        // Build waypoints: [start, trough, optional2, optional3, end]\r\n        const waypoints = [start.mid, trough.mid];\r\n        if (config.secondTransition && bands[config.secondTransition]) {\r\n            waypoints.push(bands[config.secondTransition].mid);\r\n        }\r\n        if (config.thirdTransition && bands[config.thirdTransition]) {\r\n            waypoints.push(bands[config.thirdTransition].mid);\r\n        }\r\n        waypoints.push(end.mid);\r\n\r\n        this.currentBandLabel = start.label;\r\n\r\n        this.startBinauralMultiPoint({\r\n            baseFreq: config.baseFreq || 200,\r\n            waypoints: waypoints,\r\n            sweepDurationMin: config.sweepDurationMin || 5,\r\n            fadeInSec: config.fadeInSec || 2,\r\n            fadeOutSec: config.fadeOutSec || 3,\r\n            panEnabled: config.panEnabled || false,\r\n            panSpeed: config.panSpeed || 0.1,\r\n            panDepth: config.panDepth || 0.8\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Start binaural beats with multi-point frequency waypoints\r\n     * Instead of the 3-point sweep, schedules N-segment linear ramps\r\n     * @param {Object} config\r\n     * @param {number} config.baseFreq - Carrier frequency\r\n     * @param {Array<number>} config.waypoints - Beat frequency waypoints (Hz)\r\n     * @param {number} [config.sweepDurationMin=5] - Full cycle duration (minutes)\r\n     * @param {number} [config.fadeInSec=2] - Fade-in (seconds)\r\n     * @param {number} [config.fadeOutSec=3] - Fade-out (seconds)\r\n     */\r\n    startBinauralMultiPoint(config) {\r\n        if (this.binauralEngine) {\r\n            this.stopBinaural();\r\n        }\r\n\r\n        const ctx = this.getContext();\r\n        const baseFreq = config.baseFreq || 200;\r\n        const waypoints = config.waypoints || [10, 5.5, 10];\r\n        const sweepDurationMin = config.sweepDurationMin || 5;\r\n        const fadeInSec = config.fadeInSec || 2;\r\n        const fadeOutSec = config.fadeOutSec || 3;\r\n        const panEnabled = config.panEnabled || false;\r\n        const panSpeed = config.panSpeed || 0.1;\r\n        const panDepth = config.panDepth || 0.8;\r\n\r\n        // Create oscillators and nodes (same infrastructure as startBinaural)\r\n        this.binauralEngine = {\r\n            leftOsc: ctx.createOscillator(),\r\n            rightOsc: ctx.createOscillator(),\r\n            leftGain: ctx.createGain(),\r\n            rightGain: ctx.createGain(),\r\n            binauralGain: ctx.createGain(),\r\n            merger: ctx.createChannelMerger(2),\r\n            dcBlocker: ctx.createBiquadFilter(),\r\n            panner: null,\r\n            panAnimFrame: null,\r\n            baseFreq,\r\n            waypoints,\r\n            sweepDurationMin,\r\n            fadeInSec,\r\n            fadeOutSec,\r\n            panEnabled,\r\n            panSpeed,\r\n            panDepth,\r\n            sweepInterval: null\r\n        };\r\n\r\n        const be = this.binauralEngine;\r\n\r\n        // Configure DC blocker\r\n        be.dcBlocker.type = \"highpass\";\r\n        be.dcBlocker.frequency.value = 20;\r\n\r\n        // Set initial gain to 0 for smooth ramp-up\r\n        be.binauralGain.gain.setValueAtTime(0, ctx.currentTime);\r\n\r\n        // Build audio graph\r\n        be.leftOsc.connect(be.leftGain).connect(be.merger, 0, 0);\r\n        be.rightOsc.connect(be.rightGain).connect(be.merger, 0, 1);\r\n\r\n        if (panEnabled) {\r\n            be.panner = ctx.createStereoPanner();\r\n            be.panner.pan.value = 0;\r\n            be.merger.connect(be.panner);\r\n            be.panner.connect(be.binauralGain);\r\n        } else {\r\n            be.merger.connect(be.binauralGain);\r\n        }\r\n\r\n        be.binauralGain.connect(be.dcBlocker);\r\n        be.dcBlocker.connect(this.masterGain);\r\n\r\n        // Set initial frequencies\r\n        be.leftOsc.frequency.setValueAtTime(baseFreq, ctx.currentTime);\r\n        be.rightOsc.frequency.setValueAtTime(baseFreq + waypoints[0], ctx.currentTime);\r\n\r\n        // Start oscillators\r\n        be.leftOsc.start();\r\n        be.rightOsc.start();\r\n\r\n        // Smooth fade-in\r\n        const targetVolume = 0.35;\r\n        const delay = 0.05;\r\n        const startTime = ctx.currentTime + delay;\r\n\r\n        be.binauralGain.gain.cancelScheduledValues(ctx.currentTime);\r\n        be.binauralGain.gain.setValueAtTime(0, ctx.currentTime);\r\n        be.binauralGain.gain.linearRampToValueAtTime(targetVolume, startTime + fadeInSec);\r\n\r\n        // Schedule multi-point sweep\r\n        this._scheduleMultiPointSweep();\r\n        be.sweepInterval = setInterval(\r\n            () => this._scheduleMultiPointSweep(),\r\n            sweepDurationMin * 60 * 1000\r\n        );\r\n\r\n        // Start Q-sound panning if enabled\r\n        if (panEnabled) {\r\n            this._startPanAnimation();\r\n        }\r\n\r\n        console.log('AudioEngine: Multi-point binaural started  base:', baseFreq,\r\n            'Hz, waypoints:', waypoints.map(w => w.toFixed(1)).join(''), 'Hz, cycle:', sweepDurationMin, 'min');\r\n    }\r\n\r\n    /**\r\n     * Schedule multi-point frequency sweep across waypoints\r\n     * Divides sweep duration equally among (waypoints.length - 1) segments\r\n     * @private\r\n     */\r\n    _scheduleMultiPointSweep() {\r\n        if (!this.binauralEngine || !this.binauralEngine.waypoints) return;\r\n\r\n        const be = this.binauralEngine;\r\n        const ctx = this.context;\r\n        const now = ctx.currentTime;\r\n        const totalDuration = be.sweepDurationMin * 60; // in seconds\r\n        const segments = be.waypoints.length - 1;\r\n        const segmentDuration = totalDuration / segments;\r\n\r\n        be.rightOsc.frequency.cancelScheduledValues(now);\r\n        be.rightOsc.frequency.setValueAtTime(be.baseFreq + be.waypoints[0], now);\r\n\r\n        for (let i = 1; i < be.waypoints.length; i++) {\r\n            const targetTime = now + (i * segmentDuration);\r\n            be.rightOsc.frequency.linearRampToValueAtTime(\r\n                be.baseFreq + be.waypoints[i],\r\n                targetTime\r\n            );\r\n        }\r\n\r\n        // Update band label for state reporting\r\n        this.currentBandLabel = this.getBandForFrequency(be.waypoints[0]);\r\n    }\r\n\r\n    /**\r\n     * Get the brainwave band name for a given beat frequency\r\n     * @param {number} hz - Beat frequency in Hz\r\n     * @returns {string} Band label (e.g., \"Alpha (Relaxation)\")\r\n     */\r\n    getBandForFrequency(hz) {\r\n        const bands = AudioEngine.BRAINWAVE_BANDS;\r\n        for (const [name, band] of Object.entries(bands)) {\r\n            if (hz >= band.min && hz <= band.max) {\r\n                return band.label;\r\n            }\r\n        }\r\n        return hz + ' Hz';\r\n    }\r\n\r\n    /**\r\n     * Clean up and dispose all resources\r\n     */\r\n    dispose() {\r\n        this.stopBinaural();\r\n        this.stopIsochronic();\r\n        this.stopAllSources();\r\n\r\n        if (this.analyserNode) {\r\n            try { this.analyserNode.disconnect(); } catch (e) {}\r\n            this.analyserNode = null;\r\n        }\r\n\r\n        if (this.masterGain) {\r\n            this.masterGain.disconnect();\r\n        }\r\n\r\n        if (this.destinationNode) {\r\n            this.destinationNode.disconnect();\r\n        }\r\n\r\n        if (this.context && this.context.state !== 'closed') {\r\n            this.context.close();\r\n        }\r\n\r\n        this.sources.clear();\r\n        this.context = null;\r\n        this.masterGain = null;\r\n        this.destinationNode = null;\r\n        this.isInitialized = false;\r\n    }\r\n}\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = AudioEngine;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.AudioEngine = AudioEngine;\r\n}\r\n\n\n;/* === client/view/magic8/audio/VoiceSequenceManager.js === */\n/**\r\n * VoiceSequenceManager - Text-to-speech sequence playback\r\n * Loads text from notes/data objects, synthesizes via AudioEngine,\r\n * plays clips sequentially with random pauses between them.\r\n */\r\nclass VoiceSequenceManager {\r\n    constructor(audioEngine) {\r\n        this.audioEngine = audioEngine;\r\n        this.sequences = [];\r\n        this.currentIndex = 0;\r\n        this.isPlaying = false;\r\n        this.isPaused = false;\r\n        this.loop = true;\r\n        this.voiceProfileId = null;\r\n\r\n        this.pauseDurationMin = 500;    // 0.5s minimum pause\r\n        this.pauseDurationMax = 10000;  // 10s maximum pause\r\n\r\n        // Map of sequence index  AudioEngine source hash\r\n        this.synthesizedHashes = new Map();\r\n        this.pauseTimeoutId = null;\r\n\r\n        // Callbacks\r\n        this.onLineChange = null;\r\n        this.onSynthesisProgress = null;\r\n        this.onComplete = null;\r\n        this.onLoad = null;\r\n    }\r\n\r\n    /**\r\n     * Load text sequences from a data.note object\r\n     * @param {string} noteObjectId - Object ID of the note\r\n     * @returns {Promise<number>} Number of lines loaded\r\n     */\r\n    async loadFromNote(noteObjectId) {\r\n        try {\r\n            let q = am7view.viewQuery(am7model.newInstance(\"data.note\"));\r\n            q.entity.request.push(\"text\");\r\n            q.field(\"objectId\", noteObjectId);\r\n            let qr = await page.search(q);\r\n            if (qr && qr.results && qr.results.length) {\r\n                am7model.updateListModel(qr.results);\r\n                let obj = qr.results[0];\r\n                const content = obj.text || '';\r\n                return this._parseContent(content);\r\n            }\r\n            return 0;\r\n        } catch (err) {\r\n            console.error('VoiceSequenceManager: Failed to load from note:', err);\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load text sequences from a data.data object\r\n     * @param {string} objectId - Object ID of the data object\r\n     * @returns {Promise<number>} Number of lines loaded\r\n     */\r\n    async loadFromDataObject(objectId) {\r\n        try {\r\n            let q = am7view.viewQuery(am7model.newInstance(\"data.data\"));\r\n            q.entity.request.push(\"dataBytesStore\");\r\n            q.entity.request.push(\"description\");\r\n            q.field(\"objectId\", objectId);\r\n            let qr = await page.search(q);\r\n            if (qr && qr.results && qr.results.length) {\r\n                am7model.updateListModel(qr.results);\r\n                let obj = qr.results[0];\r\n                let content = '';\r\n                if (obj.dataBytesStore && obj.dataBytesStore.length) {\r\n                    content = uwm.base64Decode(obj.dataBytesStore);\r\n                } else if (obj.description) {\r\n                    content = obj.description;\r\n                }\r\n                return this._parseContent(content);\r\n            }\r\n            return 0;\r\n        } catch (err) {\r\n            console.error('VoiceSequenceManager: Failed to load from data object:', err);\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load text from a raw string\r\n     * @param {string} content - Multi-line text content\r\n     * @returns {number} Number of lines loaded\r\n     */\r\n    loadFromString(content) {\r\n        return this._parseContent(content);\r\n    }\r\n\r\n    /**\r\n     * Parse content string into sequence array\r\n     * @param {string} content - Raw content\r\n     * @returns {number} Number of lines\r\n     * @private\r\n     */\r\n    _parseContent(content) {\r\n        this.sequences = content\r\n            .split(/\\r?\\n/)\r\n            .map(line => line.trim())\r\n            .filter(line => line.length > 0 && !line.startsWith('#'));\r\n\r\n        if (this.onLoad) {\r\n            this.onLoad(this.sequences.length);\r\n        }\r\n\r\n        return this.sequences.length;\r\n    }\r\n\r\n    /**\r\n     * Pre-synthesize all lines via AudioEngine\r\n     * Each line is sent to the TTS endpoint and the decoded AudioBuffer is cached.\r\n     * @param {string} voiceProfileId - Voice profile object ID\r\n     * @returns {Promise<number>} Number of successfully synthesized lines\r\n     */\r\n    async synthesizeAll(voiceProfileId) {\r\n        this.voiceProfileId = voiceProfileId;\r\n        let successCount = 0;\r\n\r\n        for (let i = 0; i < this.sequences.length; i++) {\r\n            const line = this.sequences[i];\r\n\r\n            try {\r\n                const source = await this.audioEngine.createVoiceSource(line, voiceProfileId);\r\n                if (source) {\r\n                    this.synthesizedHashes.set(i, source.id);\r\n                    successCount++;\r\n                }\r\n            } catch (err) {\r\n                console.warn('VoiceSequenceManager: Failed to synthesize line', i, ':', err);\r\n            }\r\n\r\n            if (this.onSynthesisProgress) {\r\n                this.onSynthesisProgress(i + 1, this.sequences.length);\r\n            }\r\n        }\r\n\r\n        console.log(`VoiceSequenceManager: Synthesized ${successCount}/${this.sequences.length} lines`);\r\n        return successCount;\r\n    }\r\n\r\n    /**\r\n     * Start playing voice sequences from the beginning\r\n     */\r\n    start() {\r\n        if (this.sequences.length === 0) {\r\n            console.warn('VoiceSequenceManager: No sequences loaded');\r\n            return;\r\n        }\r\n\r\n        this.isPlaying = true;\r\n        this.isPaused = false;\r\n        this.currentIndex = 0;\r\n        this._playNext();\r\n    }\r\n\r\n    /**\r\n     * Stop playback completely\r\n     */\r\n    stop() {\r\n        this.isPlaying = false;\r\n        this.isPaused = false;\r\n\r\n        if (this.pauseTimeoutId) {\r\n            clearTimeout(this.pauseTimeoutId);\r\n            this.pauseTimeoutId = null;\r\n        }\r\n\r\n        // Stop any currently playing clip\r\n        this._stopCurrentClip();\r\n    }\r\n\r\n    /**\r\n     * Pause playback (can be resumed)\r\n     */\r\n    pause() {\r\n        if (!this.isPlaying) return;\r\n        this.isPaused = true;\r\n\r\n        if (this.pauseTimeoutId) {\r\n            clearTimeout(this.pauseTimeoutId);\r\n            this.pauseTimeoutId = null;\r\n        }\r\n\r\n        this._stopCurrentClip();\r\n    }\r\n\r\n    /**\r\n     * Resume paused playback\r\n     */\r\n    resume() {\r\n        if (!this.isPlaying || !this.isPaused) return;\r\n        this.isPaused = false;\r\n        this._playNext();\r\n    }\r\n\r\n    /**\r\n     * Stop the currently playing audio clip\r\n     * @private\r\n     */\r\n    _stopCurrentClip() {\r\n        // currentIndex has already been advanced, so the playing clip is at currentIndex - 1\r\n        const playingIdx = this.currentIndex - 1;\r\n        if (playingIdx >= 0) {\r\n            const hash = this.synthesizedHashes.get(playingIdx);\r\n            if (hash) {\r\n                const source = this.audioEngine.sources.get(hash);\r\n                if (source && source.started) {\r\n                    source.stop();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Play the next line in sequence\r\n     * @private\r\n     */\r\n    _playNext() {\r\n        if (!this.isPlaying || this.isPaused) return;\r\n\r\n        // Check for end of sequence\r\n        if (this.currentIndex >= this.sequences.length) {\r\n            if (this.loop) {\r\n                this.currentIndex = 0;\r\n            } else {\r\n                this.isPlaying = false;\r\n                if (this.onComplete) {\r\n                    this.onComplete();\r\n                }\r\n                return;\r\n            }\r\n        }\r\n\r\n        const text = this.sequences[this.currentIndex];\r\n        const hash = this.synthesizedHashes.get(this.currentIndex);\r\n\r\n        // Notify listener with current line text (for overlay display)\r\n        if (this.onLineChange) {\r\n            this.onLineChange(text, this.currentIndex, this.sequences.length);\r\n        }\r\n\r\n        this.currentIndex++;\r\n\r\n        // If no synthesized audio for this line, skip to next after a pause\r\n        if (!hash) {\r\n            this._scheduleNext();\r\n            return;\r\n        }\r\n\r\n        const source = this.audioEngine.sources.get(hash);\r\n        if (!source || !source.buffer) {\r\n            this._scheduleNext();\r\n            return;\r\n        }\r\n\r\n        // Play the audio clip\r\n        source.play();\r\n\r\n        // Listen for playback completion, then schedule next with random pause\r\n        const bufferNode = source.source;\r\n        if (bufferNode) {\r\n            bufferNode.addEventListener('ended', () => {\r\n                this._scheduleNext();\r\n            }, { once: true });\r\n        } else {\r\n            // Fallback: estimate duration from buffer length\r\n            const durationMs = (source.buffer.duration || 3) * 1000;\r\n            setTimeout(() => this._scheduleNext(), durationMs);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Schedule the next clip with a random pause\r\n     * @private\r\n     */\r\n    _scheduleNext() {\r\n        if (!this.isPlaying || this.isPaused) return;\r\n\r\n        const pauseMs = this.pauseDurationMin +\r\n            Math.random() * (this.pauseDurationMax - this.pauseDurationMin);\r\n\r\n        this.pauseTimeoutId = setTimeout(() => {\r\n            this.pauseTimeoutId = null;\r\n            this._playNext();\r\n        }, pauseMs);\r\n    }\r\n\r\n    /**\r\n     * Inject a new voice line at the given position, synthesize it, and\r\n     * shift existing entries so playback picks it up naturally.\r\n     * @param {string} text - Line text to synthesize\r\n     * @param {number} atIndex - Position to insert at (typically currentIndex)\r\n     * @param {string} [voiceProfileId] - Override voice profile (defaults to stored)\r\n     * @returns {Promise<boolean>} true if successfully injected and synthesized\r\n     */\r\n    async injectLine(text, atIndex, voiceProfileId) {\r\n        if (!text || atIndex < 0) return false;\r\n        const idx = Math.min(atIndex, this.sequences.length);\r\n\r\n        // Insert text into sequences\r\n        this.sequences.splice(idx, 0, text);\r\n\r\n        // Shift synthesized hashes for all entries at or after the insertion point\r\n        const newHashes = new Map();\r\n        for (const [k, v] of this.synthesizedHashes) {\r\n            if (k >= idx) {\r\n                newHashes.set(k + 1, v);\r\n            } else {\r\n                newHashes.set(k, v);\r\n            }\r\n        }\r\n        this.synthesizedHashes = newHashes;\r\n\r\n        // If currentIndex is at or past the insertion point, bump it so\r\n        // the currently playing clip isn't disrupted\r\n        if (this.currentIndex > idx) {\r\n            this.currentIndex++;\r\n        }\r\n\r\n        // Synthesize the new line\r\n        try {\r\n            const profileId = voiceProfileId || this.voiceProfileId;\r\n            const source = await this.audioEngine.createVoiceSource(text, profileId);\r\n            if (source) {\r\n                this.synthesizedHashes.set(idx, source.id);\r\n                return true;\r\n            }\r\n        } catch (err) {\r\n            console.warn('VoiceSequenceManager: Failed to synthesize injected line:', err);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Get current progress\r\n     * @returns {Object} { current, total, percentage }\r\n     */\r\n    getProgress() {\r\n        return {\r\n            current: this.currentIndex,\r\n            total: this.sequences.length,\r\n            percentage: this.sequences.length > 0\r\n                ? Math.round((this.currentIndex / this.sequences.length) * 100)\r\n                : 0\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get all loaded sequences\r\n     * @returns {Array<string>}\r\n     */\r\n    getAll() {\r\n        return [...this.sequences];\r\n    }\r\n\r\n    /**\r\n     * Set pause duration range\r\n     * @param {number} minMs - Minimum pause in milliseconds\r\n     * @param {number} maxMs - Maximum pause in milliseconds\r\n     */\r\n    setPauseDuration(minMs, maxMs) {\r\n        this.pauseDurationMin = Math.max(100, minMs);\r\n        this.pauseDurationMax = Math.max(this.pauseDurationMin, maxMs);\r\n    }\r\n\r\n    /**\r\n     * Clean up all resources\r\n     */\r\n    dispose() {\r\n        this.stop();\r\n        this.sequences = [];\r\n        this.synthesizedHashes.clear();\r\n        this.onLineChange = null;\r\n        this.onSynthesisProgress = null;\r\n        this.onComplete = null;\r\n        this.onLoad = null;\r\n    }\r\n}\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = VoiceSequenceManager;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.VoiceSequenceManager = VoiceSequenceManager;\r\n}\r\n\n\n;/* === client/view/magic8/state/BiometricThemer.js === */\n/**\r\n * BiometricThemer - Emotion-driven theme system with smooth transitions\r\n * Converts facial analysis data into color themes for the Magic8 experience\r\n */\r\nclass BiometricThemer {\r\n    constructor() {\r\n        this.currentTheme = null;\r\n        this.targetTheme = null;\r\n        this.transitionDuration = 2000; // 2 second transitions\r\n        this.smoothingFactor = 0.05; // How fast to lerp\r\n        this.animationFrame = null;\r\n        this.onThemeChange = null;\r\n    }\r\n\r\n    /**\r\n     * Emotion to RGB color mapping\r\n     * Each emotion has background, accent, and glow colors\r\n     */\r\n    static emotionThemes = {\r\n        neutral:  { bg: [40, 45, 60],    accent: [80, 90, 120],   glow: [100, 110, 140] },\r\n        happy:    { bg: [60, 50, 20],    accent: [255, 220, 100], glow: [255, 240, 150] },\r\n        sad:      { bg: [30, 30, 70],    accent: [80, 80, 160],   glow: [100, 100, 200] },\r\n        angry:    { bg: [70, 20, 20],    accent: [200, 80, 80],   glow: [255, 100, 100] },\r\n        fear:     { bg: [50, 30, 60],    accent: [160, 80, 200],  glow: [200, 120, 255] },\r\n        surprise: { bg: [60, 40, 50],    accent: [255, 180, 200], glow: [255, 200, 220] },\r\n        disgust:  { bg: [30, 50, 30],    accent: [80, 160, 80],   glow: [100, 200, 100] }\r\n    };\r\n\r\n    /**\r\n     * Race-based skin tone colors for particle effects\r\n     */\r\n    static raceColors = {\r\n        white: [255, 220, 180],\r\n        black: [100, 75, 50],\r\n        asian: [255, 235, 160],\r\n        'East Asian': [255, 235, 160],\r\n        'Southeast Asian': [255, 235, 160],\r\n        indian: [200, 160, 120],\r\n        'middle eastern': [220, 190, 150],\r\n        'latino hispanic': [180, 130, 90]\r\n    };\r\n\r\n    /**\r\n     * Gender-based accent colors\r\n     */\r\n    static genderColors = {\r\n        Man: [180, 200, 255],\r\n        Woman: [255, 200, 220]\r\n    };\r\n\r\n    /**\r\n     * Emoji representations for emotions\r\n     */\r\n    static emotionEmojis = {\r\n        neutral: '\\u{1F610}', happy: '\\u{1F60A}', sad: '\\u{1F622}',\r\n        angry: '\\u{1F621}', fear: '\\u{1F628}', surprise: '\\u{1F632}',\r\n        disgust: '\\u{1F922}'\r\n    };\r\n\r\n    /**\r\n     * Emoji representations for gender\r\n     */\r\n    static genderEmojis = {\r\n        Man: '\\u{1F468}', Woman: '\\u{1F469}'\r\n    };\r\n\r\n    /**\r\n     * Process biometric data and update theme\r\n     * @param {Object} biometricData - Facial analysis data\r\n     */\r\n    updateFromBiometrics(biometricData) {\r\n        if (!biometricData) return;\r\n\r\n        // Get dominant emotion\r\n        const emotion = biometricData.dominant_emotion || 'neutral';\r\n        const baseTheme = BiometricThemer.emotionThemes[emotion] || BiometricThemer.emotionThemes.neutral;\r\n\r\n        let blendedTheme = { ...baseTheme };\r\n\r\n        // Blend based on emotion intensity scores if available\r\n        if (biometricData.emotion_scores) {\r\n            blendedTheme = this._blendByIntensity(biometricData.emotion_scores);\r\n        }\r\n\r\n        // Modulate based on arousal if available\r\n        if (typeof biometricData.arousal !== 'undefined') {\r\n            blendedTheme = this._modulateByArousal(blendedTheme, biometricData.arousal);\r\n        }\r\n\r\n        // Calculate particle color from race/gender\r\n        let particleColor = this._calculateParticleColor(biometricData);\r\n        blendedTheme.particle = particleColor;\r\n\r\n        // Start transitioning to new theme\r\n        this.transitionTo(blendedTheme);\r\n    }\r\n\r\n    /**\r\n     * Blend theme colors based on emotion intensity scores\r\n     * @param {Object} emotionScores - Map of emotion to score (0-1)\r\n     * @returns {Object} Blended theme\r\n     * @private\r\n     */\r\n    _blendByIntensity(emotionScores) {\r\n        let result = {\r\n            bg: [0, 0, 0],\r\n            accent: [0, 0, 0],\r\n            glow: [0, 0, 0]\r\n        };\r\n        let totalWeight = 0;\r\n\r\n        for (const [emotion, score] of Object.entries(emotionScores)) {\r\n            const theme = BiometricThemer.emotionThemes[emotion];\r\n            if (!theme) continue;\r\n\r\n            const weight = parseFloat(score) || 0;\r\n            totalWeight += weight;\r\n\r\n            ['bg', 'accent', 'glow'].forEach(key => {\r\n                result[key] = result[key].map((v, i) => v + theme[key][i] * weight);\r\n            });\r\n        }\r\n\r\n        if (totalWeight > 0) {\r\n            ['bg', 'accent', 'glow'].forEach(key => {\r\n                result[key] = result[key].map(v => Math.round(v / totalWeight));\r\n            });\r\n        } else {\r\n            // Fallback to neutral if no weights\r\n            result = { ...BiometricThemer.emotionThemes.neutral };\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Modulate theme brightness/saturation based on arousal level\r\n     * @param {Object} theme - Current theme\r\n     * @param {number} arousal - Arousal level (0-1)\r\n     * @returns {Object} Modulated theme\r\n     * @private\r\n     */\r\n    _modulateByArousal(theme, arousal) {\r\n        // Higher arousal = more vibrant colors\r\n        const intensity = 0.5 + (arousal * 0.5); // 0.5 to 1.0\r\n\r\n        return {\r\n            bg: theme.bg.map(c => Math.round(c * intensity)),\r\n            accent: theme.accent.map(c => Math.round(Math.min(255, c * (0.8 + arousal * 0.4)))),\r\n            glow: theme.glow.map(c => Math.round(Math.min(255, c * (0.8 + arousal * 0.4))))\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Calculate particle color from race and gender data\r\n     * @param {Object} data - Biometric data\r\n     * @returns {Array} RGB color array\r\n     * @private\r\n     */\r\n    _calculateParticleColor(data) {\r\n        let raceColor = null;\r\n        let genderColor = null;\r\n\r\n        // Blend race colors by score\r\n        if (data.race_scores) {\r\n            let totalScore = 0;\r\n            let r = 0, g = 0, b = 0;\r\n\r\n            for (const [race, score] of Object.entries(data.race_scores)) {\r\n                if (score > 0 && BiometricThemer.raceColors[race]) {\r\n                    totalScore += score;\r\n                    const color = BiometricThemer.raceColors[race];\r\n                    r += color[0] * score;\r\n                    g += color[1] * score;\r\n                    b += color[2] * score;\r\n                }\r\n            }\r\n\r\n            if (totalScore > 0) {\r\n                raceColor = [r / totalScore, g / totalScore, b / totalScore];\r\n            }\r\n        }\r\n\r\n        // Blend gender colors by score\r\n        if (data.gender_scores) {\r\n            let totalScore = 0;\r\n            let r = 0, g = 0, b = 0;\r\n\r\n            for (const [gender, score] of Object.entries(data.gender_scores)) {\r\n                if (score > 0 && BiometricThemer.genderColors[gender]) {\r\n                    totalScore += score;\r\n                    const color = BiometricThemer.genderColors[gender];\r\n                    r += color[0] * score;\r\n                    g += color[1] * score;\r\n                    b += color[2] * score;\r\n                }\r\n            }\r\n\r\n            if (totalScore > 0) {\r\n                genderColor = [r / totalScore, g / totalScore, b / totalScore];\r\n            }\r\n        }\r\n\r\n        // Average race and gender colors\r\n        if (raceColor && genderColor) {\r\n            return [\r\n                Math.round((raceColor[0] + genderColor[0]) / 2),\r\n                Math.round((raceColor[1] + genderColor[1]) / 2),\r\n                Math.round((raceColor[2] + genderColor[2]) / 2)\r\n            ];\r\n        } else if (raceColor) {\r\n            return raceColor.map(Math.round);\r\n        } else if (genderColor) {\r\n            return genderColor.map(Math.round);\r\n        }\r\n\r\n        // Default particle color\r\n        return [150, 180, 255];\r\n    }\r\n\r\n    /**\r\n     * Begin transitioning to a new theme\r\n     * @param {Object} targetTheme - Target theme to transition to\r\n     */\r\n    transitionTo(targetTheme) {\r\n        this.targetTheme = targetTheme;\r\n\r\n        if (!this.animationFrame) {\r\n            this._animateTransition();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Animate theme transition with smooth lerping\r\n     * @private\r\n     */\r\n    _animateTransition() {\r\n        if (!this.currentTheme) {\r\n            // First theme - apply immediately\r\n            this.currentTheme = this._deepCopy(this.targetTheme);\r\n        } else {\r\n            // Lerp toward target\r\n            ['bg', 'accent', 'glow', 'particle'].forEach(key => {\r\n                if (this.targetTheme[key] && this.currentTheme[key]) {\r\n                    this.currentTheme[key] = this.currentTheme[key].map((v, i) =>\r\n                        Math.round(v + (this.targetTheme[key][i] - v) * this.smoothingFactor)\r\n                    );\r\n                }\r\n            });\r\n        }\r\n\r\n        // Apply the current theme\r\n        this._applyTheme(this.currentTheme);\r\n\r\n        // Continue animation\r\n        this.animationFrame = requestAnimationFrame(() => this._animateTransition());\r\n    }\r\n\r\n    /**\r\n     * Apply theme to DOM and notify listeners\r\n     * @param {Object} theme - Theme to apply\r\n     * @private\r\n     */\r\n    _applyTheme(theme) {\r\n        // Update CSS custom properties\r\n        const root = document.documentElement;\r\n        root.style.setProperty('--hypno-bg', `rgb(${theme.bg.join(',')})`);\r\n        root.style.setProperty('--hypno-accent', `rgb(${theme.accent.join(',')})`);\r\n        root.style.setProperty('--hypno-glow', `rgb(${theme.glow.join(',')})`);\r\n\r\n        if (theme.particle) {\r\n            root.style.setProperty('--hypno-particle', `rgb(${theme.particle.join(',')})`);\r\n        }\r\n\r\n        // Notify callback\r\n        if (this.onThemeChange) {\r\n            this.onThemeChange(theme);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the current theme\r\n     * @returns {Object|null}\r\n     */\r\n    getCurrentTheme() {\r\n        return this.currentTheme;\r\n    }\r\n\r\n    /**\r\n     * Get CSS-ready color strings from theme\r\n     * @param {Object} theme - Theme object\r\n     * @returns {Object} CSS color strings\r\n     */\r\n    static toCSS(theme) {\r\n        if (!theme) return {};\r\n        return {\r\n            bg: `rgb(${theme.bg.join(',')})`,\r\n            accent: `rgb(${theme.accent.join(',')})`,\r\n            glow: `rgb(${theme.glow.join(',')})`,\r\n            particle: theme.particle ? `rgb(${theme.particle.join(',')})` : null\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Set the smoothing factor for transitions\r\n     * @param {number} factor - Smoothing factor (0-1, lower = smoother)\r\n     */\r\n    setSmoothingFactor(factor) {\r\n        this.smoothingFactor = Math.max(0.01, Math.min(1, factor));\r\n    }\r\n\r\n    /**\r\n     * Stop animation and clean up\r\n     */\r\n    dispose() {\r\n        if (this.animationFrame) {\r\n            cancelAnimationFrame(this.animationFrame);\r\n            this.animationFrame = null;\r\n        }\r\n        this.currentTheme = null;\r\n        this.targetTheme = null;\r\n        this.onThemeChange = null;\r\n    }\r\n\r\n    /**\r\n     * Deep copy an object\r\n     * @param {Object} obj - Object to copy\r\n     * @returns {Object}\r\n     * @private\r\n     */\r\n    _deepCopy(obj) {\r\n        return JSON.parse(JSON.stringify(obj));\r\n    }\r\n}\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = BiometricThemer;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.BiometricThemer = BiometricThemer;\r\n}\r\n\n\n;/* === client/view/magic8/video/SessionRecorder.js === */\n/**\r\n * SessionRecorder - Canvas and audio recording for Magic8 sessions\r\n * Records the visual canvas and audio streams into a video file\r\n */\r\nclass SessionRecorder {\r\n    constructor() {\r\n        this.mediaRecorder = null;\r\n        this.recordedChunks = [];\r\n        this.isRecording = false;\r\n        this.canvas = null;\r\n        this.audioDestination = null;\r\n        this.combinedStream = null;\r\n        this.startTime = null;\r\n        this.duration = 0;\r\n        this.maxDuration = 30 * 60 * 1000; // 30 minutes default max\r\n\r\n        this.onRecordingStart = null;\r\n        this.onRecordingStop = null;\r\n        this.onDataAvailable = null;\r\n        this.onError = null;\r\n    }\r\n\r\n    /**\r\n     * Start recording canvas and audio\r\n     * @param {HTMLCanvasElement} canvasElement - Canvas to capture\r\n     * @param {MediaStreamAudioDestinationNode} audioDestination - Audio destination from AudioEngine\r\n     * @param {Object} options - Recording options\r\n     * @returns {Promise<void>}\r\n     */\r\n    async startRecording(canvasElement, audioDestination = null, options = {}) {\r\n        if (this.isRecording) {\r\n            console.warn('SessionRecorder: Already recording');\r\n            return;\r\n        }\r\n\r\n        this.canvas = canvasElement;\r\n        this.audioDestination = audioDestination;\r\n        this.recordedChunks = [];\r\n        this.maxDuration = (options.maxDurationMin || 30) * 60 * 1000;\r\n\r\n        try {\r\n            // Capture canvas stream\r\n            const fps = options.fps || 30;\r\n            const canvasStream = canvasElement.captureStream(fps);\r\n\r\n            // Combine with audio if available\r\n            if (audioDestination && audioDestination.stream) {\r\n                const audioStream = audioDestination.stream;\r\n                this.combinedStream = new MediaStream([\r\n                    ...canvasStream.getVideoTracks(),\r\n                    ...audioStream.getAudioTracks()\r\n                ]);\r\n            } else {\r\n                this.combinedStream = canvasStream;\r\n            }\r\n\r\n            // Determine supported MIME type\r\n            const mimeType = this._getSupportedMimeType();\r\n\r\n            // Create MediaRecorder\r\n            const recorderOptions = {\r\n                mimeType: mimeType,\r\n                videoBitsPerSecond: options.videoBitrate || 5000000 // 5 Mbps\r\n            };\r\n\r\n            this.mediaRecorder = new MediaRecorder(this.combinedStream, recorderOptions);\r\n\r\n            // Handle data available\r\n            this.mediaRecorder.ondataavailable = (event) => {\r\n                if (event.data.size > 0) {\r\n                    this.recordedChunks.push(event.data);\r\n                    if (this.onDataAvailable) {\r\n                        this.onDataAvailable(event.data);\r\n                    }\r\n                }\r\n            };\r\n\r\n            // Handle errors\r\n            this.mediaRecorder.onerror = (event) => {\r\n                console.error('SessionRecorder: Error:', event.error);\r\n                if (this.onError) {\r\n                    this.onError(event.error);\r\n                }\r\n            };\r\n\r\n            // Start recording with 1-second chunks\r\n            this.mediaRecorder.start(1000);\r\n            this.isRecording = true;\r\n            this.startTime = Date.now();\r\n\r\n            if (this.onRecordingStart) {\r\n                this.onRecordingStart();\r\n            }\r\n\r\n            // Set up max duration timer\r\n            if (this.maxDuration > 0) {\r\n                setTimeout(() => {\r\n                    if (this.isRecording) {\r\n                        console.log('SessionRecorder: Max duration reached');\r\n                        this.stopRecording();\r\n                    }\r\n                }, this.maxDuration);\r\n            }\r\n\r\n        } catch (err) {\r\n            console.error('SessionRecorder: Failed to start recording:', err);\r\n            if (this.onError) {\r\n                this.onError(err);\r\n            }\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Stop recording and return the video blob\r\n     * @returns {Promise<Blob>} Video blob\r\n     */\r\n    stopRecording() {\r\n        return new Promise((resolve, reject) => {\r\n            if (!this.isRecording || !this.mediaRecorder) {\r\n                reject(new Error('Not recording'));\r\n                return;\r\n            }\r\n\r\n            this.mediaRecorder.onstop = () => {\r\n                this.duration = Date.now() - this.startTime;\r\n                this.isRecording = false;\r\n\r\n                const blob = new Blob(this.recordedChunks, {\r\n                    type: this.mediaRecorder.mimeType || 'video/webm'\r\n                });\r\n\r\n                if (this.onRecordingStop) {\r\n                    this.onRecordingStop(blob, this.duration);\r\n                }\r\n\r\n                // Clean up streams\r\n                this._cleanupStreams();\r\n\r\n                resolve(blob);\r\n            };\r\n\r\n            this.mediaRecorder.stop();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Save the recorded video to the server as a data.data object\r\n     * @param {Blob} blob - Video blob\r\n     * @param {string} [sessionName] - Session name for the recording filename\r\n     * @returns {Promise<Object>} Created server object\r\n     */\r\n    async saveToServer(blob, sessionName) {\r\n        try {\r\n            // Ensure ~/Magic8/Recordings directory exists\r\n            let dir = await page.findObject(\"auth.group\", \"DATA\", \"~/Magic8/Recordings\");\r\n            if (!dir || !dir.objectId) {\r\n                dir = await page.makePath(\"auth.group\", \"data\", \"~/Magic8/Recordings\");\r\n            }\r\n\r\n            // Convert blob to base64\r\n            const base64Data = await this._blobToBase64(blob);\r\n\r\n            // Build filename from session name + timestamp\r\n            const ts = new Date().toISOString().replace(/[:.]/g, '-').substring(0, 19);\r\n            const name = sessionName\r\n                ? sessionName + ' ' + ts + '.webm'\r\n                : 'session-' + ts + '.webm';\r\n\r\n            // Create data.data object\r\n            let obj = am7model.newPrimitive(\"data.data\");\r\n            obj.name = name;\r\n            obj.contentType = blob.type || 'video/webm';\r\n            obj.compressionType = 'none';\r\n            obj.groupId = dir.id;\r\n            obj.groupPath = dir.path;\r\n            obj.dataBytesStore = base64Data;\r\n\r\n            const saved = await page.createObject(obj);\r\n            console.log('SessionRecorder: Saved to server as', name);\r\n            return saved;\r\n        } catch (err) {\r\n            console.error('SessionRecorder: Failed to save to server:', err);\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Convert a Blob to a base64 string\r\n     * @param {Blob} blob\r\n     * @returns {Promise<string>}\r\n     * @private\r\n     */\r\n    _blobToBase64(blob) {\r\n        return new Promise((resolve, reject) => {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => {\r\n                // Find \";base64,\" delimiter  can't split on comma because\r\n                // MIME types like \"video/webm;codecs=vp9,opus\" contain commas\r\n                const marker = ';base64,';\r\n                const idx = reader.result.indexOf(marker);\r\n                const base64 = idx >= 0\r\n                    ? reader.result.substring(idx + marker.length)\r\n                    : reader.result;\r\n                resolve(base64);\r\n            };\r\n            reader.onerror = reject;\r\n            reader.readAsDataURL(blob);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Get supported MIME type for recording\r\n     * @returns {string}\r\n     * @private\r\n     */\r\n    _getSupportedMimeType() {\r\n        const types = [\r\n            'video/webm;codecs=vp9,opus',\r\n            'video/webm;codecs=vp9',\r\n            'video/webm;codecs=vp8,opus',\r\n            'video/webm;codecs=vp8',\r\n            'video/webm',\r\n            'video/mp4'\r\n        ];\r\n\r\n        for (const type of types) {\r\n            if (MediaRecorder.isTypeSupported(type)) {\r\n                return type;\r\n            }\r\n        }\r\n\r\n        return 'video/webm';\r\n    }\r\n\r\n    /**\r\n     * Clean up stream tracks\r\n     * @private\r\n     */\r\n    _cleanupStreams() {\r\n        if (this.combinedStream) {\r\n            this.combinedStream.getTracks().forEach(track => {\r\n                track.stop();\r\n            });\r\n            this.combinedStream = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Pause recording\r\n     */\r\n    pause() {\r\n        if (this.isRecording && this.mediaRecorder && this.mediaRecorder.state === 'recording') {\r\n            this.mediaRecorder.pause();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resume recording\r\n     */\r\n    resume() {\r\n        if (this.mediaRecorder && this.mediaRecorder.state === 'paused') {\r\n            this.mediaRecorder.resume();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get recording state\r\n     * @returns {string} 'inactive' | 'recording' | 'paused'\r\n     */\r\n    getState() {\r\n        return this.mediaRecorder ? this.mediaRecorder.state : 'inactive';\r\n    }\r\n\r\n    /**\r\n     * Get current recording duration in milliseconds\r\n     * @returns {number}\r\n     */\r\n    getCurrentDuration() {\r\n        if (!this.isRecording || !this.startTime) return 0;\r\n        return Date.now() - this.startTime;\r\n    }\r\n\r\n    /**\r\n     * Get formatted duration string (MM:SS)\r\n     * @returns {string}\r\n     */\r\n    getFormattedDuration() {\r\n        const ms = this.isRecording ? this.getCurrentDuration() : this.duration;\r\n        const seconds = Math.floor(ms / 1000);\r\n        const minutes = Math.floor(seconds / 60);\r\n        const remainingSeconds = seconds % 60;\r\n        return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;\r\n    }\r\n\r\n    /**\r\n     * Check if MediaRecorder is supported\r\n     * @returns {boolean}\r\n     */\r\n    static isSupported() {\r\n        return typeof MediaRecorder !== 'undefined' &&\r\n               typeof HTMLCanvasElement.prototype.captureStream === 'function';\r\n    }\r\n\r\n    /**\r\n     * Clean up all resources\r\n     */\r\n    dispose() {\r\n        if (this.isRecording) {\r\n            this.mediaRecorder.stop();\r\n        }\r\n        this._cleanupStreams();\r\n        this.recordedChunks = [];\r\n        this.mediaRecorder = null;\r\n        this.onRecordingStart = null;\r\n        this.onRecordingStop = null;\r\n        this.onDataAvailable = null;\r\n        this.onError = null;\r\n    }\r\n}\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = SessionRecorder;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.SessionRecorder = SessionRecorder;\r\n}\r\n\n\n;/* === client/view/magic8/text/TextSequenceManager.js === */\n/**\r\n * TextSequenceManager - Manages hypnotic text sequences loaded from notes/data objects\r\n * Cycles through text lines with configurable timing and fade effects\r\n */\r\nclass TextSequenceManager {\r\n    constructor() {\r\n        this.sequences = [];\r\n        this.currentIndex = 0;\r\n        this.isPlaying = false;\r\n        this.loop = true;\r\n        this.displayDuration = 5000; // ms per text\r\n        this.fadeDuration = 1000;    // ms for fade transition\r\n        this.timeoutId = null;\r\n        this.shuffled = false;\r\n\r\n        this.onTextChange = null;\r\n        this.onComplete = null;\r\n        this.onLoad = null;\r\n    }\r\n\r\n    /**\r\n     * Load text sequences from a data.data object\r\n     * @param {string} objectId - Object ID of the data object\r\n     * @returns {Promise<number>} Number of lines loaded\r\n     */\r\n    async loadFromDataObject(objectId) {\r\n        try {\r\n            let q = am7view.viewQuery(am7model.newInstance(\"data.data\"));\r\n            q.entity.request.push(\"dataBytesStore\");\r\n            q.entity.request.push(\"description\");\r\n            q.field(\"objectId\", objectId);\r\n            let qr = await page.search(q);\r\n            if (qr && qr.results && qr.results.length) {\r\n                am7model.updateListModel(qr.results);\r\n                let obj = qr.results[0];\r\n                let content = '';\r\n                if (obj.dataBytesStore && obj.dataBytesStore.length) {\r\n                    content = uwm.base64Decode(obj.dataBytesStore);\r\n                } else if (obj.description) {\r\n                    content = obj.description;\r\n                }\r\n                return this._parseContent(content);\r\n            }\r\n            return 0;\r\n        } catch (err) {\r\n            console.error('TextSequenceManager: Failed to load from data object:', err);\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load text sequences from a note object\r\n     * @param {string} noteObjectId - Object ID of the note\r\n     * @returns {Promise<number>} Number of lines loaded\r\n     */\r\n    async loadFromNote(noteObjectId) {\r\n        try {\r\n            let q = am7view.viewQuery(am7model.newInstance(\"data.note\"));\r\n            q.entity.request.push(\"text\");\r\n            q.field(\"objectId\", noteObjectId);\r\n            let qr = await page.search(q);\r\n            if (qr && qr.results && qr.results.length) {\r\n                am7model.updateListModel(qr.results);\r\n                let obj = qr.results[0];\r\n                const content = obj.text || '';\r\n                return this._parseContent(content);\r\n            }\r\n            return 0;\r\n        } catch (err) {\r\n            console.error('TextSequenceManager: Failed to load from note:', err);\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load text from a raw string\r\n     * @param {string} content - Multi-line text content\r\n     * @returns {number} Number of lines loaded\r\n     */\r\n    loadFromString(content) {\r\n        return this._parseContent(content);\r\n    }\r\n\r\n    /**\r\n     * Load from an array of strings\r\n     * @param {Array<string>} lines - Array of text lines\r\n     * @returns {number} Number of lines loaded\r\n     */\r\n    loadFromArray(lines) {\r\n        this.sequences = lines\r\n            .map(line => line.trim())\r\n            .filter(line => line.length > 0);\r\n\r\n        if (this.onLoad) {\r\n            this.onLoad(this.sequences.length);\r\n        }\r\n\r\n        return this.sequences.length;\r\n    }\r\n\r\n    /**\r\n     * Parse content string into sequence array\r\n     * @param {string} content - Raw content\r\n     * @returns {number} Number of lines\r\n     * @private\r\n     */\r\n    _parseContent(content) {\r\n        this.sequences = content\r\n            .split(/\\r?\\n/)\r\n            .map(line => line.trim())\r\n            .filter(line => line.length > 0 && !line.startsWith('#')); // Allow comments\r\n\r\n        if (this.onLoad) {\r\n            this.onLoad(this.sequences.length);\r\n        }\r\n\r\n        return this.sequences.length;\r\n    }\r\n\r\n    /**\r\n     * Start playing the text sequence\r\n     */\r\n    start() {\r\n        if (this.sequences.length === 0) {\r\n            console.warn('TextSequenceManager: No sequences loaded');\r\n            return;\r\n        }\r\n\r\n        this.isPlaying = true;\r\n        this.currentIndex = 0;\r\n\r\n        if (this.shuffled) {\r\n            this._shuffle();\r\n        }\r\n\r\n        this._displayNext();\r\n    }\r\n\r\n    /**\r\n     * Stop playing\r\n     */\r\n    stop() {\r\n        this.isPlaying = false;\r\n        if (this.timeoutId) {\r\n            clearTimeout(this.timeoutId);\r\n            this.timeoutId = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Pause playback\r\n     */\r\n    pause() {\r\n        if (this.timeoutId) {\r\n            clearTimeout(this.timeoutId);\r\n            this.timeoutId = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resume playback\r\n     */\r\n    resume() {\r\n        if (this.isPlaying && !this.timeoutId) {\r\n            this._displayNext();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Display the next text in sequence\r\n     * @private\r\n     */\r\n    _displayNext() {\r\n        if (!this.isPlaying) return;\r\n\r\n        if (this.currentIndex >= this.sequences.length) {\r\n            if (this.loop && this.sequences.length > 0) {\r\n                this.currentIndex = 0;\r\n                if (this.shuffled) {\r\n                    this._shuffle();\r\n                }\r\n            } else {\r\n                this.isPlaying = false;\r\n                if (this.onComplete) {\r\n                    this.onComplete();\r\n                }\r\n                return;\r\n            }\r\n        }\r\n\r\n        const text = this.sequences[this.currentIndex];\r\n\r\n        if (this.onTextChange) {\r\n            this.onTextChange(text, this.currentIndex, this.sequences.length);\r\n        }\r\n\r\n        this.currentIndex++;\r\n\r\n        this.timeoutId = setTimeout(() => this._displayNext(), this.displayDuration);\r\n    }\r\n\r\n    /**\r\n     * Skip to next text immediately\r\n     */\r\n    next() {\r\n        if (this.timeoutId) {\r\n            clearTimeout(this.timeoutId);\r\n        }\r\n        this._displayNext();\r\n    }\r\n\r\n    /**\r\n     * Go back to previous text\r\n     */\r\n    previous() {\r\n        if (this.timeoutId) {\r\n            clearTimeout(this.timeoutId);\r\n        }\r\n\r\n        this.currentIndex = Math.max(0, this.currentIndex - 2);\r\n        this._displayNext();\r\n    }\r\n\r\n    /**\r\n     * Jump to a specific index\r\n     * @param {number} index - Index to jump to\r\n     */\r\n    jumpTo(index) {\r\n        if (index >= 0 && index < this.sequences.length) {\r\n            if (this.timeoutId) {\r\n                clearTimeout(this.timeoutId);\r\n            }\r\n            this.currentIndex = index;\r\n            this._displayNext();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get current text\r\n     * @returns {string}\r\n     */\r\n    getCurrent() {\r\n        const idx = Math.max(0, this.currentIndex - 1);\r\n        return this.sequences[idx] || '';\r\n    }\r\n\r\n    /**\r\n     * Get all sequences\r\n     * @returns {Array<string>}\r\n     */\r\n    getAll() {\r\n        return [...this.sequences];\r\n    }\r\n\r\n    /**\r\n     * Get sequence count\r\n     * @returns {number}\r\n     */\r\n    getCount() {\r\n        return this.sequences.length;\r\n    }\r\n\r\n    /**\r\n     * Get current progress\r\n     * @returns {Object} { current, total, percentage }\r\n     */\r\n    getProgress() {\r\n        return {\r\n            current: this.currentIndex,\r\n            total: this.sequences.length,\r\n            percentage: this.sequences.length > 0\r\n                ? Math.round((this.currentIndex / this.sequences.length) * 100)\r\n                : 0\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Shuffle sequences\r\n     * @private\r\n     */\r\n    _shuffle() {\r\n        for (let i = this.sequences.length - 1; i > 0; i--) {\r\n            const j = Math.floor(Math.random() * (i + 1));\r\n            [this.sequences[i], this.sequences[j]] = [this.sequences[j], this.sequences[i]];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Enable/disable shuffling\r\n     * @param {boolean} enabled - Whether to shuffle\r\n     */\r\n    setShuffle(enabled) {\r\n        this.shuffled = enabled;\r\n    }\r\n\r\n    /**\r\n     * Set display duration per text\r\n     * @param {number} ms - Duration in milliseconds\r\n     */\r\n    setDisplayDuration(ms) {\r\n        this.displayDuration = Math.max(500, ms); // Minimum 500ms\r\n    }\r\n\r\n    /**\r\n     * Set fade duration\r\n     * @param {number} ms - Fade duration in milliseconds\r\n     */\r\n    setFadeDuration(ms) {\r\n        this.fadeDuration = Math.max(100, ms);\r\n    }\r\n\r\n    /**\r\n     * Set loop mode\r\n     * @param {boolean} enabled - Whether to loop\r\n     */\r\n    setLoop(enabled) {\r\n        this.loop = enabled;\r\n    }\r\n\r\n    /**\r\n     * Add a text line dynamically\r\n     * @param {string} text - Text to add\r\n     */\r\n    addText(text) {\r\n        if (text && text.trim()) {\r\n            this.sequences.push(text.trim());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Inject a text line at a specific index, shifting existing entries.\r\n     * Used by SessionDirector to interleave LLM-generated labels into the text sequence.\r\n     * @param {string} text - Text to inject\r\n     * @param {number} atIndex - Position to insert at (typically currentIndex)\r\n     * @returns {boolean} true if injected\r\n     */\r\n    injectText(text, atIndex) {\r\n        if (!text || !text.trim() || atIndex < 0) return false;\r\n        const idx = Math.min(atIndex, this.sequences.length);\r\n        this.sequences.splice(idx, 0, text.trim());\r\n        if (this.currentIndex > idx) {\r\n            this.currentIndex++;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Remove a text line by index\r\n     * @param {number} index - Index to remove\r\n     */\r\n    removeText(index) {\r\n        if (index >= 0 && index < this.sequences.length) {\r\n            this.sequences.splice(index, 1);\r\n            if (this.currentIndex > index) {\r\n                this.currentIndex--;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all sequences\r\n     */\r\n    clear() {\r\n        this.stop();\r\n        this.sequences = [];\r\n        this.currentIndex = 0;\r\n    }\r\n\r\n    /**\r\n     * Clean up resources\r\n     */\r\n    dispose() {\r\n        this.stop();\r\n        this.clear();\r\n        this.onTextChange = null;\r\n        this.onComplete = null;\r\n        this.onLoad = null;\r\n    }\r\n}\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = TextSequenceManager;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.TextSequenceManager = TextSequenceManager;\r\n}\r\n\n\n;/* === client/view/magic8/generation/ImageGenerationManager.js === */\n/**\r\n * ImageGenerationManager - Stable Diffusion img2img generation from camera captures\r\n * Captures user images and transforms them using the olio reimage API\r\n */\r\nclass ImageGenerationManager {\r\n    constructor(sdConfigObjectId = null, inlineConfig = null) {\r\n        this.sdConfigId = sdConfigObjectId;\r\n        this.inlineConfig = inlineConfig;\r\n        this.sdConfig = null;\r\n        this.pendingGenerations = [];\r\n        this.generatedImages = [];\r\n        this.maxPendingJobs = 3;\r\n        this.isProcessing = false;\r\n        this.sessionName = null;\r\n\r\n        this.onImageGenerated = null;\r\n        this.onGenerationStarted = null;\r\n        this.onGenerationFailed = null;\r\n        this.onQueueChanged = null;\r\n        this.onCaptureCreated = null;\r\n\r\n        // Cached server resources\r\n        this._captureDir = null;\r\n        this._generatedDir = null;\r\n        this._baseEntity = null;\r\n    }\r\n\r\n    /**\r\n     * Load SD configuration from server\r\n     * @returns {Promise<Object>} Configuration object\r\n     */\r\n    async loadConfig() {\r\n        // Use inline config if provided (created via SessionConfigEditor \"Create New\")\r\n        if (this.inlineConfig) {\r\n            this.sdConfig = { ...this._getDefaultConfig(), ...this.inlineConfig };\r\n            return this.sdConfig;\r\n        }\r\n\r\n        if (!this.sdConfigId) {\r\n            this.sdConfig = this._getDefaultConfig();\r\n            return this.sdConfig;\r\n        }\r\n\r\n        try {\r\n            let q = am7view.viewQuery(am7model.newInstance(\"data.data\"));\r\n            q.entity.request.push(\"dataBytesStore\");\r\n            q.field(\"objectId\", this.sdConfigId);\r\n            let qr = await page.search(q);\r\n            if (qr && qr.results && qr.results.length) {\r\n                am7model.updateListModel(qr.results);\r\n                let obj = qr.results[0];\r\n                if (obj.dataBytesStore && obj.dataBytesStore.length) {\r\n                    this.sdConfig = { ...this._getDefaultConfig(), ...JSON.parse(uwm.base64Decode(obj.dataBytesStore)) };\r\n                    return this.sdConfig;\r\n                }\r\n            }\r\n            this.sdConfig = this._getDefaultConfig();\r\n            return this.sdConfig;\r\n        } catch (err) {\r\n            console.error('ImageGenerationManager: Failed to load config:', err);\r\n            this.sdConfig = this._getDefaultConfig();\r\n            return this.sdConfig;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get default SD configuration\r\n     * @returns {Object}\r\n     * @private\r\n     */\r\n    _getDefaultConfig() {\r\n        return {\r\n            style: \"art\",\r\n            description: \"ethereal dreamlike portrait, soft lighting, mystical atmosphere\",\r\n            imageAction: \"posing in a surreal setting\",\r\n            denoisingStrength: 0.65,\r\n            steps: 30,\r\n            cfg: 7,\r\n            seed: -1,\r\n            sampler: \"dpmpp_2m\",\r\n            scheduler: \"Karras\",\r\n            width: 512,\r\n            height: 512,\r\n            captureInterval: 30000,\r\n            emotionPromptMapping: {\r\n                happy: \"joyful radiant golden light\",\r\n                sad: \"melancholic blue ethereal mist\",\r\n                angry: \"intense fiery dramatic shadows\",\r\n                fear: \"mysterious shadowy surreal\",\r\n                surprise: \"magical sparkling wonder\",\r\n                neutral: \"serene peaceful calm atmosphere\"\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Set custom configuration\r\n     * @param {Object} config - SD configuration\r\n     */\r\n    setConfig(config) {\r\n        this.sdConfig = { ...this._getDefaultConfig(), ...config };\r\n    }\r\n\r\n    /**\r\n     * Capture frame from camera and generate image\r\n     * @param {Object} cameraComponent - Camera component with captureFrame method\r\n     * @param {Object} biometricData - Current biometric data for emotion-aware prompts\r\n     * @returns {Promise<string>} Job ID\r\n     */\r\n    async captureAndGenerate(cameraComponent, biometricData = null) {\r\n        if (!this.sdConfig) {\r\n            await this.loadConfig();\r\n        }\r\n\r\n        const activeJobs = this.pendingGenerations.filter(\r\n            j => j.status === 'pending' || j.status === 'processing'\r\n        ).length;\r\n        if (activeJobs >= this.maxPendingJobs) {\r\n            console.warn('ImageGenerationManager: Max pending jobs reached (' + activeJobs + ' active)');\r\n            return null;\r\n        }\r\n\r\n        try {\r\n            // Capture current frame\r\n            let imageData;\r\n            if (typeof cameraComponent.captureFrame === 'function') {\r\n                imageData = await cameraComponent.captureFrame();\r\n            } else if (typeof cameraComponent.capture === 'function') {\r\n                imageData = await cameraComponent.capture();\r\n            } else {\r\n                throw new Error('Camera component does not have capture method');\r\n            }\r\n\r\n            // Extract base64 data\r\n            let base64Image = imageData;\r\n            if (imageData.includes(',')) {\r\n                base64Image = imageData.split(',')[1];\r\n            }\r\n\r\n            // Build description with emotion awareness\r\n            let description = this.sdConfig.description || \"\";\r\n            if (biometricData && biometricData.dominant_emotion) {\r\n                const emotionPrompt = this.sdConfig.emotionPromptMapping?.[biometricData.dominant_emotion];\r\n                if (emotionPrompt) {\r\n                    description = `${emotionPrompt}, ${description}`;\r\n                }\r\n            }\r\n\r\n            // Build generation request using real olio.sd.config field names\r\n            const genRequest = { ...this.sdConfig };\r\n            genRequest.description = description;\r\n            genRequest.init_image = base64Image;\r\n\r\n            return this.queueGeneration(genRequest);\r\n\r\n        } catch (err) {\r\n            console.error('ImageGenerationManager: Failed to capture and generate:', err);\r\n            if (this.onGenerationFailed) {\r\n                this.onGenerationFailed(null, err);\r\n            }\r\n            return null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Queue a generation request\r\n     * @param {Object} request - Generation request\r\n     * @returns {string} Job ID\r\n     */\r\n    queueGeneration(request) {\r\n        const jobId = `gen-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n        const job = {\r\n            id: jobId,\r\n            request: request,\r\n            status: 'pending',\r\n            createdAt: Date.now(),\r\n            result: null,\r\n            error: null\r\n        };\r\n\r\n        this.pendingGenerations.push(job);\r\n\r\n        if (this.onQueueChanged) {\r\n            this.onQueueChanged(this.pendingGenerations.length);\r\n        }\r\n\r\n        // Start processing if not already\r\n        this._processQueue();\r\n\r\n        return jobId;\r\n    }\r\n\r\n    /**\r\n     * Process the generation queue using olio reimage API\r\n     * Flow: save camera frame -> build SD config -> call reimage -> handle response\r\n     * @private\r\n     */\r\n    async _processQueue() {\r\n        if (this.isProcessing) return;\r\n\r\n        const pendingJob = this.pendingGenerations.find(j => j.status === 'pending');\r\n        if (!pendingJob) return;\r\n\r\n        this.isProcessing = true;\r\n        pendingJob.status = 'processing';\r\n\r\n        if (this.onGenerationStarted) {\r\n            this.onGenerationStarted(pendingJob.id);\r\n        }\r\n\r\n        try {\r\n            // Step 1: Save camera frame to ~/Magic8/Captures\r\n            const captureObj = await this._saveCameraFrame(\r\n                pendingJob.request.init_image,\r\n                pendingJob.id\r\n            );\r\n            if (!captureObj || !captureObj.objectId) {\r\n                throw new Error('Failed to save camera capture');\r\n            }\r\n            console.log('ImageGenerationManager: Camera frame saved:', captureObj.objectId);\r\n\r\n            // Step 2: Build olio.sd.config entity for the reimage API\r\n            const sdEntity = await this._buildSdConfigEntity(pendingJob.request, captureObj.objectId);\r\n\r\n            // Step 3: Call reimage endpoint (same API used by dialog.js)\r\n            const reimageUrl = `${g_application_path}/rest/olio/data.data/${captureObj.objectId}/reimage`;\r\n            console.log('ImageGenerationManager: Calling reimage for', captureObj.objectId);\r\n            let response;\r\n            try {\r\n                response = await m.request({\r\n                    method: 'POST',\r\n                    url: reimageUrl,\r\n                    withCredentials: true,\r\n                    body: sdEntity\r\n                });\r\n            } catch (reqErr) {\r\n                const detail = reqErr?.message || (reqErr != null ? JSON.stringify(reqErr) : 'server returned null/empty error');\r\n                console.warn('ImageGenerationManager: reimage response error:', reqErr);\r\n                throw new Error(`Reimage request failed (${reimageUrl}): ${detail}`);\r\n            }\r\n\r\n            if (response && response.objectId) {\r\n                // Rename to distinguish from captures\r\n                if (response.name && !response.name.startsWith('generated-')) {\r\n                    response.name = 'generated-' + Date.now() + '.' + (response.name.split('.').pop() || 'png');\r\n                }\r\n                // Move generated image to ~/Magic8/Generated\r\n                const movedImage = await this._moveToGeneratedGroup(response);\r\n                const imageUrl = `${g_application_path}/media/Public/data.data${encodeURI(movedImage.groupPath)}/${encodeURIComponent(movedImage.name)}`;\r\n\r\n                const savedImage = {\r\n                    objectId: movedImage.objectId,\r\n                    url: imageUrl,\r\n                    name: movedImage.name,\r\n                    groupPath: movedImage.groupPath\r\n                };\r\n\r\n                pendingJob.status = 'complete';\r\n                pendingJob.result = savedImage;\r\n\r\n                this.generatedImages.push({\r\n                    id: pendingJob.id,\r\n                    url: savedImage.url,\r\n                    objectId: savedImage.objectId,\r\n                    timestamp: Date.now()\r\n                });\r\n\r\n                if (this.onImageGenerated) {\r\n                    this.onImageGenerated(savedImage);\r\n                }\r\n            } else {\r\n                throw new Error('No image returned from generation');\r\n            }\r\n\r\n        } catch (err) {\r\n            console.error('ImageGenerationManager: Generation failed:', err);\r\n            pendingJob.status = 'failed';\r\n            pendingJob.error = err.message || String(err);\r\n\r\n            if (this.onGenerationFailed) {\r\n                this.onGenerationFailed(pendingJob.id, err);\r\n            }\r\n        }\r\n\r\n        // Remove completed/failed jobs older than 5 minutes\r\n        const cutoff = Date.now() - 5 * 60 * 1000;\r\n        this.pendingGenerations = this.pendingGenerations.filter(\r\n            j => j.status === 'pending' || j.status === 'processing' || j.createdAt > cutoff\r\n        );\r\n\r\n        if (this.onQueueChanged) {\r\n            this.onQueueChanged(this.pendingGenerations.length);\r\n        }\r\n\r\n        this.isProcessing = false;\r\n\r\n        // Process next job\r\n        this._processQueue();\r\n    }\r\n\r\n    /**\r\n     * Save camera frame as data.data in ~/Magic8/Captures\r\n     * @param {string} base64Image - Base64 encoded image data\r\n     * @param {string} jobId - Job ID for naming\r\n     * @returns {Promise<Object>} Saved data.data object\r\n     * @private\r\n     */\r\n    async _saveCameraFrame(base64Image, jobId) {\r\n        if (!this._captureDir) {\r\n            const capturePath = this.sessionName\r\n                ? '~/Magic8/Captures/' + this.sessionName\r\n                : '~/Magic8/Captures';\r\n            this._captureDir = await page.findObject(\"auth.group\", \"DATA\", capturePath);\r\n            if (!this._captureDir || !this._captureDir.objectId) {\r\n                this._captureDir = await page.makePath(\"auth.group\", \"data\", capturePath);\r\n            }\r\n        }\r\n\r\n        let obj = am7model.newPrimitive(\"data.data\");\r\n        obj.name = `capture-${Date.now()}.png`;\r\n        obj.contentType = 'image/png';\r\n        obj.compressionType = 'none';\r\n        obj.groupId = this._captureDir.id;\r\n        obj.groupPath = this._captureDir.path;\r\n        obj.dataBytesStore = base64Image;\r\n\r\n        const created = await page.createObject(obj);\r\n\r\n        if (created && this.onCaptureCreated) {\r\n            this.onCaptureCreated({\r\n                objectId: created.objectId,\r\n                groupPath: created.groupPath || this._captureDir.path,\r\n                name: created.name || obj.name\r\n            });\r\n        }\r\n\r\n        return created;\r\n    }\r\n\r\n    /**\r\n     * Move a generated image to ~/Magic8/Generated group\r\n     * @param {Object} imageObj - data.data object returned from reimage API\r\n     * @returns {Promise<Object>} Updated object with new groupPath\r\n     * @private\r\n     */\r\n    async _moveToGeneratedGroup(imageObj) {\r\n        if (!this._generatedDir) {\r\n            const genPath = this.sessionName\r\n                ? '~/Magic8/Generated/' + this.sessionName\r\n                : '~/Magic8/Generated';\r\n            this._generatedDir = await page.findObject(\"auth.group\", \"DATA\", genPath);\r\n            if (!this._generatedDir || !this._generatedDir.objectId) {\r\n                this._generatedDir = await page.makePath(\"auth.group\", \"data\", genPath);\r\n            }\r\n        }\r\n\r\n        // If already in the right group, skip\r\n        if (imageObj.groupId === this._generatedDir.id) {\r\n            return imageObj;\r\n        }\r\n\r\n        await page.moveObject(imageObj, this._generatedDir);\r\n        imageObj.groupId = this._generatedDir.id;\r\n        imageObj.groupPath = this._generatedDir.path;\r\n        console.log('ImageGenerationManager: Moved generated image to ~/Magic8/Generated:', imageObj.objectId);\r\n        return imageObj;\r\n    }\r\n\r\n    /**\r\n     * Build an olio.sd.config entity for the reimage API.\r\n     * Delegates to am7sd common utility for template fetching and style defaults.\r\n     * @param {Object} request - Internal generation request\r\n     * @param {string} referenceImageId - ObjectId of the saved camera frame\r\n     * @returns {Promise<Object>} SD config entity\r\n     * @private\r\n     */\r\n    async _buildSdConfigEntity(request, referenceImageId) {\r\n        let entity = await am7sd.buildEntity(request, {\r\n            skipFields: ['init_image', 'captureInterval', 'emotionPromptMapping']\r\n        });\r\n\r\n        // If a refiner model is configured, force hires mode\r\n        if (entity.refinerModel) {\r\n            entity.hires = true;\r\n        }\r\n\r\n        // Set reference image for img2img\r\n        entity.referenceImageId = referenceImageId;\r\n\r\n        return entity;\r\n    }\r\n\r\n    /**\r\n     * Get job status\r\n     * @param {string} jobId - Job ID\r\n     * @returns {Object|null} Job info\r\n     */\r\n    getJob(jobId) {\r\n        return this.pendingGenerations.find(j => j.id === jobId) || null;\r\n    }\r\n\r\n    /**\r\n     * Get all pending jobs\r\n     * @returns {Array}\r\n     */\r\n    getPendingJobs() {\r\n        return this.pendingGenerations.filter(j => j.status === 'pending' || j.status === 'processing');\r\n    }\r\n\r\n    /**\r\n     * Get all generated images\r\n     * @returns {Array}\r\n     */\r\n    getGeneratedImages() {\r\n        return [...this.generatedImages];\r\n    }\r\n\r\n    /**\r\n     * Cancel a pending job\r\n     * @param {string} jobId - Job ID\r\n     */\r\n    cancelJob(jobId) {\r\n        const job = this.pendingGenerations.find(j => j.id === jobId);\r\n        if (job && job.status === 'pending') {\r\n            job.status = 'cancelled';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear all generated images\r\n     */\r\n    clearGeneratedImages() {\r\n        this.generatedImages = [];\r\n    }\r\n\r\n    /**\r\n     * Set maximum pending jobs\r\n     * @param {number} max - Maximum number of pending jobs\r\n     */\r\n    setMaxPendingJobs(max) {\r\n        this.maxPendingJobs = Math.max(1, max);\r\n    }\r\n\r\n    /**\r\n     * Clean up resources\r\n     */\r\n    dispose() {\r\n        this.pendingGenerations = [];\r\n        this.generatedImages = [];\r\n        this.sdConfig = null;\r\n        this._captureDir = null;\r\n        this._generatedDir = null;\r\n        this._baseEntity = null;\r\n        this.onImageGenerated = null;\r\n        this.onGenerationStarted = null;\r\n        this.onGenerationFailed = null;\r\n        this.onQueueChanged = null;\r\n        this.onCaptureCreated = null;\r\n    }\r\n}\r\n\r\n// Style fallback data now in am7sd.SD_FALLBACKS (sdConfig.js common utility)\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = ImageGenerationManager;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.ImageGenerationManager = ImageGenerationManager;\r\n}\r\n\n\n;/* === client/view/magic8/ai/SessionDirector.js === */\n/**\r\n * SessionDirector - LLM-powered session orchestration\r\n * Periodically gathers session state (biometric data, labels, voice text)\r\n * and sends it to an LLM with a user-defined session command.\r\n * Receives structured JSON directives to adjust audio, visuals, labels, and image generation.\r\n * Uses the \"Open Chat\" chatConfig template from ~/Chat for LLM connection settings.\r\n */\r\n(function() {\r\n\r\n    class SessionDirector {\r\n        static PROMPT_TEMPLATE_PATH = 'media/prompts/magic8DirectorPrompt.json';\r\n        static _cachedTemplate = null;\r\n\r\n        constructor() {\r\n            // LLM infrastructure\r\n            this.chatRequest = null;\r\n            this.chatConfig = null;\r\n            this.promptConfig = null;\r\n\r\n            // Session config\r\n            this.command = '';\r\n            this.intervalMs = 60000;\r\n            this.intervalId = null;\r\n            this.isRunning = false;\r\n            this.isPaused = false;\r\n\r\n            // State provider callback - set by Magic8App\r\n            this.stateProvider = null;\r\n\r\n            // Tracking\r\n            this.lastDirective = null;\r\n            this.lastError = null;\r\n            this.callCount = 0;\r\n            this.consecutiveErrors = 0;\r\n\r\n            // Mood ring mode\r\n            this.moodRingMode = false;\r\n\r\n            // Callbacks\r\n            this.onDirective = null;\r\n            this.onError = null;\r\n            this.onStatusChange = null;\r\n            this.onTickDebug = null; // (info) => {}  fired each tick with {tickNum, stateMessage, rawContent, directive}\r\n        }\r\n\r\n        /**\r\n         * Initialize the LLM connection following the cardGame.js pattern\r\n         * @param {string} command - User's session intent/theme text\r\n         * @param {number} [intervalMs=60000] - Polling interval in ms\r\n         * @param {string} [sessionName] - Session name for unique conversation history\r\n         * @param {Object} [options] - Additional options\r\n         * @param {string} [options.imageTags] - Comma-separated tags available for image search\r\n         */\r\n        async initialize(command, intervalMs, sessionName, options) {\r\n            this.command = command || '';\r\n            this.intervalMs = intervalMs || 60000;\r\n            this.sessionName = sessionName || '';\r\n            this.imageTags = options?.imageTags || '';\r\n\r\n            try {\r\n                this._setStatus('initializing');\r\n\r\n                // 1. Find ~/Chat directory\r\n                const chatDir = await page.findObject(\"auth.group\", \"DATA\", \"~/Chat\");\r\n                if (!chatDir) {\r\n                    throw new Error(\"Chat directory ~/Chat not found\");\r\n                }\r\n\r\n                // 2. Find \"Open Chat\" config template\r\n                const chatConfigs = await am7client.list(\"olio.llm.chatConfig\", chatDir.objectId, null, 0, 0);\r\n                const templateCfg = chatConfigs.find(c => c.name === \"Open Chat\");\r\n                if (!templateCfg) {\r\n                    throw new Error(\"Chat config 'Open Chat' not found in ~/Chat\");\r\n                }\r\n\r\n                // 3. Load full template for LLM settings\r\n                const fullTemplate = await am7client.getFull(\"olio.llm.chatConfig\", templateCfg.objectId);\r\n                if (!fullTemplate) {\r\n                    throw new Error(\"Failed to load 'Open Chat' template\");\r\n                }\r\n\r\n                // 4. Create or update prompt config with current command\r\n                const systemPrompt = await this._buildSystemPrompt(command);\r\n                this.promptConfig = await this._ensurePromptConfig(chatDir, systemPrompt);\r\n                if (!this.promptConfig) {\r\n                    throw new Error(\"Failed to create prompt config\");\r\n                }\r\n\r\n                // 5. Find or create chat config cloned from template\r\n                this.chatConfig = await this._ensureChatConfig(chatDir, fullTemplate);\r\n                if (!this.chatConfig) {\r\n                    throw new Error(\"Failed to create chat config\");\r\n                }\r\n\r\n                // 6. Create chat request\r\n                const requestName = this.sessionName\r\n                    ? 'Magic8 Director - ' + this.sessionName\r\n                    : 'Magic8 Director';\r\n                this.chatRequest = await am7chat.getChatRequest(requestName, this.chatConfig, this.promptConfig);\r\n                if (!this.chatRequest) {\r\n                    throw new Error(\"Failed to create chat request\");\r\n                }\r\n\r\n                this._setStatus('ready');\r\n                console.log('SessionDirector: Initialized successfully');\r\n            } catch (err) {\r\n                this.lastError = err.message;\r\n                this._setStatus('error');\r\n                console.error('SessionDirector: Initialization failed:', err);\r\n                if (this.onError) this.onError(err);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Find or create the prompt config, updating system lines if it already exists\r\n         * @param {Object} chatDir - ~/Chat group object\r\n         * @param {Array<string>} systemPrompt - System prompt lines\r\n         * @returns {Object|null} Prompt config object\r\n         * @private\r\n         */\r\n        async _ensurePromptConfig(chatDir, systemPrompt) {\r\n            const promptName = this.sessionName\r\n                ? \"Magic8 Director - \" + this.sessionName\r\n                : \"Magic8 Director\";\r\n            let q = am7view.viewQuery(am7model.newInstance(\"olio.llm.promptConfig\"));\r\n            q.field(\"groupId\", chatDir.id);\r\n            q.field(\"name\", promptName);\r\n            q.cache(false);\r\n            let qr = await page.search(q);\r\n\r\n            if (qr && qr.results && qr.results.length > 0) {\r\n                // Prompt exists - update system lines to reflect current command\r\n                let existing = qr.results[0];\r\n                existing.system = systemPrompt;\r\n                await page.patchObject(existing);\r\n                console.log('SessionDirector: Updated prompt config system lines');\r\n                return existing;\r\n            }\r\n\r\n            // Create new prompt config\r\n            let icfg = am7model.newInstance(\"olio.llm.promptConfig\");\r\n            icfg.api.groupId(chatDir.id);\r\n            icfg.api.groupPath(chatDir.path);\r\n            icfg.api.name(promptName);\r\n            icfg.entity.system = systemPrompt;\r\n            await page.createObject(icfg.entity);\r\n\r\n            // Re-fetch to get the created object\r\n            qr = await page.search(q);\r\n            return (qr && qr.results && qr.results.length > 0) ? qr.results[0] : null;\r\n        }\r\n\r\n        /**\r\n         * Find or create a diagnostic-specific prompt config.\r\n         * Uses separate \"Magic8 Diagnostics\" name to avoid modifying live session prompt.\r\n         * @param {Object} chatDir - ~/Chat group object\r\n         * @param {Array<string>} systemPrompt - System prompt lines\r\n         * @returns {Object|null} Prompt config object\r\n         * @private\r\n         */\r\n        async _ensureDiagnosticPromptConfig(chatDir, systemPrompt) {\r\n            const promptName = \"Magic8 Diagnostics\";\r\n            let q = am7view.viewQuery(am7model.newInstance(\"olio.llm.promptConfig\"));\r\n            q.field(\"groupId\", chatDir.id);\r\n            q.field(\"name\", promptName);\r\n            q.cache(false);\r\n            let qr = await page.search(q);\r\n\r\n            if (qr && qr.results && qr.results.length > 0) {\r\n                let existing = qr.results[0];\r\n                existing.system = systemPrompt;\r\n                await page.patchObject(existing);\r\n                return existing;\r\n            }\r\n\r\n            let icfg = am7model.newInstance(\"olio.llm.promptConfig\");\r\n            icfg.api.groupId(chatDir.id);\r\n            icfg.api.groupPath(chatDir.path);\r\n            icfg.api.name(promptName);\r\n            icfg.entity.system = systemPrompt;\r\n            await page.createObject(icfg.entity);\r\n            qr = await page.search(q);\r\n            return (qr && qr.results && qr.results.length > 0) ? qr.results[0] : null;\r\n        }\r\n\r\n        /**\r\n         * Find or create chat config from template\r\n         * @param {Object} chatDir - ~/Chat group object\r\n         * @param {Object} fullTemplate - Full \"Open Chat\" template object\r\n         * @returns {Object|null} Chat config object\r\n         * @private\r\n         */\r\n        async _ensureChatConfig(chatDir, fullTemplate) {\r\n            const chatConfigName = \"Magic8 Director\";\r\n            let q = am7view.viewQuery(\"olio.llm.chatConfig\");\r\n            q.field(\"groupId\", chatDir.id);\r\n            q.field(\"name\", chatConfigName);\r\n            q.cache(false);\r\n            let qr = await page.search(q);\r\n\r\n            if (qr && qr.results && qr.results.length > 0) {\r\n                let chatCfg = qr.results[0];\r\n                // Sync LLM settings from template\r\n                if (fullTemplate && (\r\n                    chatCfg.serverUrl !== fullTemplate.serverUrl ||\r\n                    chatCfg.serviceType !== fullTemplate.serviceType ||\r\n                    chatCfg.model !== fullTemplate.model\r\n                )) {\r\n                    chatCfg.serverUrl = fullTemplate.serverUrl;\r\n                    chatCfg.serviceType = fullTemplate.serviceType;\r\n                    chatCfg.model = fullTemplate.model;\r\n                    chatCfg.apiVersion = fullTemplate.apiVersion;\r\n                    // Remove apiKey before patching - EncryptFieldProvider errors on null values\r\n                    delete chatCfg.apiKey;\r\n                    await page.patchObject(chatCfg);\r\n                    console.log('SessionDirector: Updated chat config LLM settings');\r\n                }\r\n                return chatCfg;\r\n            }\r\n\r\n            // Build new chatConfig from template\r\n            const t = fullTemplate;\r\n            const newChatCfg = {\r\n                schema: \"olio.llm.chatConfig\",\r\n                groupId: chatDir.id,\r\n                groupPath: chatDir.path,\r\n                name: chatConfigName,\r\n                model: t.model,\r\n                serverUrl: t.serverUrl,\r\n                serviceType: t.serviceType,\r\n                apiVersion: t.apiVersion,\r\n                rating: t.rating,\r\n                setting: t.setting,\r\n                assist: t.assist,\r\n                stream: t.stream,\r\n                prune: t.prune,\r\n                useNLP: t.useNLP,\r\n                messageTrim: 4,\r\n                remindEvery: t.remindEvery,\r\n                keyframeEvery: t.keyframeEvery\r\n            };\r\n            // Only include apiKey if non-null to avoid encryption provider errors\r\n            if (t.apiKey) newChatCfg.apiKey = t.apiKey;\r\n            if (t.chatOptions) {\r\n                const co = { schema: \"olio.llm.chatOptions\" };\r\n                const optKeys = [\"max_tokens\", \"min_p\", \"num_ctx\", \"num_gpu\", \"repeat_last_n\", \"repeat_penalty\", \"temperature\", \"top_k\", \"top_p\", \"typical_p\"];\r\n                for (const k of optKeys) {\r\n                    if (t.chatOptions[k] !== undefined) co[k] = t.chatOptions[k];\r\n                }\r\n                newChatCfg.chatOptions = co;\r\n            }\r\n            return await page.createObject(newChatCfg);\r\n        }\r\n\r\n        /**\r\n         * Find or create a diagnostic-specific chat config from template.\r\n         * Uses separate \"Magic8 Diagnostics\" name with higher temperature for test diversity.\r\n         * @param {Object} chatDir - ~/Chat group object\r\n         * @param {Object} fullTemplate - Full \"Open Chat\" template object\r\n         * @returns {Object|null} Chat config object\r\n         * @private\r\n         */\r\n        async _ensureDiagnosticChatConfig(chatDir, fullTemplate) {\r\n            const chatConfigName = \"Magic8 Diagnostics\";\r\n            let q = am7view.viewQuery(\"olio.llm.chatConfig\");\r\n            q.field(\"groupId\", chatDir.id);\r\n            q.field(\"name\", chatConfigName);\r\n            q.cache(false);\r\n            let qr = await page.search(q);\r\n\r\n            if (qr && qr.results && qr.results.length > 0) {\r\n                let chatCfg = qr.results[0];\r\n                // Always sync LLM connection from template\r\n                chatCfg.serverUrl = fullTemplate.serverUrl;\r\n                chatCfg.serviceType = fullTemplate.serviceType;\r\n                chatCfg.model = fullTemplate.model;\r\n                chatCfg.apiVersion = fullTemplate.apiVersion;\r\n                // Remove apiKey before patching - EncryptFieldProvider errors on null values\r\n                delete chatCfg.apiKey;\r\n                // Preserve existing chatOptions schema metadata, only update temperature\r\n                if (chatCfg.chatOptions) {\r\n                    chatCfg.chatOptions.temperature = 0.8;\r\n                } else {\r\n                    chatCfg.chatOptions = { schema: \"olio.llm.chatOptions\", temperature: 0.8 };\r\n                }\r\n                await page.patchObject(chatCfg);\r\n                return chatCfg;\r\n            }\r\n\r\n            const t = fullTemplate;\r\n            const newChatCfg = {\r\n                schema: \"olio.llm.chatConfig\",\r\n                groupId: chatDir.id,\r\n                groupPath: chatDir.path,\r\n                name: chatConfigName,\r\n                model: t.model,\r\n                serverUrl: t.serverUrl,\r\n                serviceType: t.serviceType,\r\n                apiVersion: t.apiVersion,\r\n                rating: t.rating,\r\n                setting: t.setting,\r\n                assist: t.assist,\r\n                stream: t.stream,\r\n                prune: t.prune,\r\n                useNLP: t.useNLP,\r\n                messageTrim: 4,\r\n                remindEvery: t.remindEvery,\r\n                keyframeEvery: t.keyframeEvery\r\n            };\r\n            // Only include apiKey if non-null to avoid encryption provider errors\r\n            if (t.apiKey) newChatCfg.apiKey = t.apiKey;\r\n            // Copy chatOptions from template but set higher temperature for test diversity\r\n            const co = { schema: \"olio.llm.chatOptions\" };\r\n            if (t.chatOptions) {\r\n                const optKeys = [\"max_tokens\", \"min_p\", \"num_ctx\", \"num_gpu\", \"repeat_last_n\", \"repeat_penalty\", \"temperature\", \"top_k\", \"top_p\", \"typical_p\"];\r\n                for (const k of optKeys) {\r\n                    if (t.chatOptions[k] !== undefined) co[k] = t.chatOptions[k];\r\n                }\r\n            }\r\n            co.temperature = 0.8;\r\n            newChatCfg.chatOptions = co;\r\n            return await page.createObject(newChatCfg);\r\n        }\r\n\r\n        /**\r\n         * Load the prompt template JSON from the static file.\r\n         * Caches after first successful load.\r\n         * @returns {Promise<Object|null>} Template object or null\r\n         * @private\r\n         */\r\n        async _loadPromptTemplate() {\r\n            if (SessionDirector._cachedTemplate) return SessionDirector._cachedTemplate;\r\n            try {\r\n                const resp = await m.request({\r\n                    method: 'GET',\r\n                    url: SessionDirector.PROMPT_TEMPLATE_PATH\r\n                });\r\n                if (resp && Array.isArray(resp.lines)) {\r\n                    SessionDirector._cachedTemplate = resp;\r\n                    console.log('SessionDirector: Loaded prompt template v' + (resp.version || '?'));\r\n                    return resp;\r\n                }\r\n            } catch (err) {\r\n                console.warn('SessionDirector: Failed to load prompt template, using fallback:', err.message || err);\r\n            }\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         * Replace ${token} placeholders in a string\r\n         * @param {string} str - String with ${token} placeholders\r\n         * @param {Object} tokens - Key-value map of token replacements\r\n         * @returns {string}\r\n         * @private\r\n         */\r\n        _resolveTokens(str, tokens) {\r\n            return str.replace(/\\$\\{(\\w+)\\}/g, (match, key) => {\r\n                return tokens.hasOwnProperty(key) ? tokens[key] : match;\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Build the system prompt for the director LLM.\r\n         * Loads from external JSON template if available, falls back to hardcoded.\r\n         * @param {string} command - User's session intent\r\n         * @returns {Promise<Array<string>>} System prompt lines\r\n         * @private\r\n         */\r\n        async _buildSystemPrompt(command) {\r\n            const tokens = {\r\n                command: command || '',\r\n                imageTags: ''\r\n            };\r\n\r\n            // Resolve image tags for token replacement\r\n            if (this.imageTags) {\r\n                const tags = this.imageTags.split(',').map(t => t.trim()).filter(t => t);\r\n                if (tags.length > 0) {\r\n                    tokens.imageTags = tags.join(', ');\r\n                }\r\n            }\r\n\r\n            // Try loading from external template\r\n            const template = await this._loadPromptTemplate();\r\n            if (template) {\r\n                let lines = template.lines.map(line => this._resolveTokens(line, tokens));\r\n\r\n                // Append image tags section if tags are configured\r\n                if (tokens.imageTags && Array.isArray(template.imageTagsAppendix)) {\r\n                    const tagLines = template.imageTagsAppendix.map(line => this._resolveTokens(line, tokens));\r\n                    lines = lines.concat(tagLines);\r\n                }\r\n\r\n                return lines;\r\n            }\r\n\r\n            // Fallback: hardcoded prompt (in case template file is unavailable)\r\n            console.warn('SessionDirector: Using hardcoded prompt fallback');\r\n            return this._buildSystemPromptFallback(command);\r\n        }\r\n\r\n        /**\r\n         * Hardcoded fallback system prompt (used if template JSON is unavailable)\r\n         * @param {string} command\r\n         * @returns {Array<string>}\r\n         * @private\r\n         */\r\n        _buildSystemPromptFallback(command) {\r\n            const lines = [\r\n                \"You are the Session Director for Magic8, an immersive audiovisual experience.\",\r\n                \"SESSION INTENT: \" + command,\r\n                \"You receive periodic state snapshots and must return a JSON object with directives to adjust the session.\",\r\n                \"You MUST always respond with a valid JSON object containing at least one directive field.\",\r\n                \"\",\r\n                \"Directive fields (include what you want to change):\",\r\n                \"  audio: { preset: \\\"goddessEnergy\\\"|\\\"heartOpening\\\"|\\\"loveFrequency\\\"|\\\"deepHealing\\\"|\\\"lettingGo\\\"|\\\"transformation\\\"|\\\"creativeFlow\\\"|\\\"thirdEye\\\"|\\\"crownConnection\\\"|\\\"regeneration\\\"|\\\"deepHypnosis\\\"|\\\"lucidDream\\\"\",\r\n                \"           OR band: \\\"delta\\\"|\\\"theta\\\"|\\\"alphaTheta\\\"|\\\"alpha\\\"|\\\"beta\\\"|\\\"gamma\\\" with optional troughBand, endBand, secondTransition, thirdTransition,\",\r\n                \"              baseFreq: carrier Hz (174|285|396|417|432|528|639|741|852|963),\",\r\n                \"           isochronicEnabled: true/false, isochronicBand: \\\"delta\\\"|\\\"theta\\\"|\\\"alphaTheta\\\"|\\\"alpha\\\"|\\\"beta\\\"|\\\"gamma\\\",\",\r\n                \"           volume: 0.0-1.0 }\",\r\n                \"  visuals: { effect: \\\"particles\\\" or \\\"spiral\\\" or \\\"mandala\\\" or \\\"tunnel\\\" or \\\"hypnoDisc\\\", transitionDuration: 2000 }\",\r\n                \"  labels: { add: [\\\"1-3 word phrase\\\"], remove: [\\\"exact label text\\\"] }\",\r\n                \"  generateImage: { description: \\\"scene description\\\", style: \\\"art style keyword\\\", imageAction: \\\"what the subject is doing\\\", denoisingStrength: 0.3-0.9, cfg: 3-15, tags: \\\"tag1+tag2+tag3\\\" }\",\r\n                \"  opacity: { labels: 0.15-1.0, images: 0.15-1.0, visualizer: 0.15-1.0, visuals: 0.15-1.0 }\",\r\n                \"  voiceLine: \\\"short sentence to be spoken next via text-to-speech\\\"\",\r\n                \"  suggestMood: { emotion: \\\"happy\\\"|\\\"sad\\\"|\\\"angry\\\"|\\\"fear\\\"|\\\"surprise\\\"|\\\"disgust\\\"|\\\"neutral\\\", gender: \\\"Man\\\"|\\\"Woman\\\", genderPct: 0-100 }\",\r\n                \"  progressPct: 0-100\",\r\n                \"  commentary: \\\"your reasoning (not displayed to user)\\\"\",\r\n                \"\",\r\n                \"Guidelines:\",\r\n                \"- Evolve gradually based on biometric emotion, elapsed time, and session intent\",\r\n                \"- Labels must be 1-3 words only. Keep them poetic and aligned with session intent.\",\r\n                \"- Respond with ONLY the JSON object, no markdown fences, no explanation text\"\r\n            ];\r\n\r\n            if (this.imageTags) {\r\n                const tags = this.imageTags.split(',').map(t => t.trim()).filter(t => t);\r\n                if (tags.length > 0) {\r\n                    lines.push(\"\");\r\n                    lines.push(\"Available image tags: \" + tags.join(', '));\r\n                }\r\n            }\r\n\r\n            return lines;\r\n        }\r\n\r\n        /**\r\n         * Build a trimmed system prompt for mood ring mode\r\n         * Only requests suggestMood + commentary (no labels, voice, images, audio, opacity)\r\n         * @param {string} command - Session intent\r\n         * @returns {Array<string>}\r\n         * @private\r\n         */\r\n        _buildMoodRingPrompt(command) {\r\n            return [\r\n                \"You are the Mood Ring advisor for Magic8, an immersive audiovisual experience.\",\r\n                \"SESSION INTENT: \" + command,\r\n                \"You receive periodic biometric state snapshots and must return a JSON object.\",\r\n                \"You MUST always respond with a valid JSON object.\",\r\n                \"\",\r\n                \"Directive fields:\",\r\n                \"  suggestMood: { emotion: \\\"happy\\\"|\\\"sad\\\"|\\\"angry\\\"|\\\"fear\\\"|\\\"surprise\\\"|\\\"disgust\\\"|\\\"neutral\\\", gender: \\\"Man\\\"|\\\"Woman\\\" }\",\r\n                \"  commentary: \\\"your reasoning (not displayed to user)\\\"\",\r\n                \"\",\r\n                \"Your role: observe the user's detected emotion and suggest what mood they might be feeling or transitioning toward.\",\r\n                \"Consider the session intent, elapsed time, and emotion history to provide insightful mood suggestions.\",\r\n                \"The suggested mood drives a visual mood ring color effect.\",\r\n                \"\",\r\n                \"Example: {\\\"suggestMood\\\":{\\\"emotion\\\":\\\"happy\\\",\\\"gender\\\":\\\"Woman\\\"},\\\"commentary\\\":\\\"user shows warmth\\\"}\",\r\n                \"\",\r\n                \"- Respond with ONLY the JSON object, no markdown fences, no explanation text\"\r\n            ];\r\n        }\r\n\r\n        /**\r\n         * Format state for mood ring mode  only biometric data + emotion transition + elapsed time\r\n         * @param {Object} state - Session state\r\n         * @returns {string}\r\n         * @private\r\n         */\r\n        _formatMoodRingState(state) {\r\n            const lines = ['Mood Ring State:'];\r\n\r\n            if (state.biometric) {\r\n                const b = state.biometric;\r\n                lines.push(`Biometric: emotion=${b.emotion || 'unknown'}, age=${b.age || 'unknown'}, gender=${b.gender || 'unknown'}`);\r\n            } else {\r\n                lines.push('Biometric: no face data');\r\n            }\r\n\r\n            if (state.emotionTransition) {\r\n                const t = state.emotionTransition;\r\n                lines.push(`Emotion Shift: ${t.from}  ${t.to} (${t.secsAgo}s ago)`);\r\n            }\r\n\r\n            if (state.elapsedMinutes != null) {\r\n                lines.push(`Elapsed: ${Math.round(state.elapsedMinutes)} min`);\r\n            }\r\n\r\n            return lines.join('\\n');\r\n        }\r\n\r\n        /**\r\n         * Start the director polling loop\r\n         */\r\n        start() {\r\n            if (this.isRunning) return;\r\n            if (!this.chatRequest) {\r\n                console.warn('SessionDirector: Cannot start - not initialized');\r\n                return;\r\n            }\r\n\r\n            this.isRunning = true;\r\n            this.isPaused = false;\r\n            this._setStatus('running');\r\n            console.log('SessionDirector: Started with interval', this.intervalMs, 'ms');\r\n\r\n            // Run first tick immediately\r\n            this._tick();\r\n\r\n            // Set up polling interval\r\n            this.intervalId = setInterval(() => this._tick(), this.intervalMs);\r\n        }\r\n\r\n        /**\r\n         * Stop the director\r\n         */\r\n        stop() {\r\n            this.isRunning = false;\r\n            this.isPaused = false;\r\n            if (this.intervalId) {\r\n                clearInterval(this.intervalId);\r\n                this.intervalId = null;\r\n            }\r\n            this._setStatus('stopped');\r\n            console.log('SessionDirector: Stopped');\r\n        }\r\n\r\n        /**\r\n         * Pause the director (keeps interval but skips ticks)\r\n         */\r\n        pause() {\r\n            if (!this.isRunning) return;\r\n            this.isPaused = true;\r\n            this._setStatus('paused');\r\n        }\r\n\r\n        /**\r\n         * Resume the director from pause\r\n         */\r\n        resume() {\r\n            if (!this.isRunning) return;\r\n            this.isPaused = false;\r\n            this._setStatus('running');\r\n        }\r\n\r\n        /**\r\n         * Perform one director tick - gather state, call LLM, apply directive\r\n         * @private\r\n         */\r\n        async _tick() {\r\n            if (!this.isRunning || this.isPaused) return;\r\n\r\n            try {\r\n                // Gather current session state\r\n                const state = this.stateProvider ? this.stateProvider() : {};\r\n\r\n                // Format the user message with state data\r\n                const userMessage = this._formatStateMessage(state);\r\n\r\n                const tickNum = this.callCount + 1;\r\n                console.log('SessionDirector: Tick #' + tickNum + ', sending state to LLM');\r\n\r\n                // Call the LLM - m.request can reject with null/undefined on server errors\r\n                let response;\r\n                try {\r\n                    response = await am7chat.chat(this.chatRequest, userMessage);\r\n                } catch (reqErr) {\r\n                    const detail = reqErr?.message || reqErr?.statusText || (reqErr == null ? 'server returned empty error (check LLM server connectivity)' : String(reqErr));\r\n                    throw new Error('LLM request failed: ' + detail);\r\n                }\r\n\r\n                if (!response) {\r\n                    console.warn('SessionDirector: Null response from LLM');\r\n                    return;\r\n                }\r\n\r\n                this.callCount++;\r\n                this.consecutiveErrors = 0;\r\n\r\n                // Extract assistant content from response\r\n                const content = this._extractContent(response);\r\n                if (!content) {\r\n                    console.warn('SessionDirector: Empty response from LLM');\r\n                    return;\r\n                }\r\n\r\n                console.log('SessionDirector: LLM response:', content);\r\n\r\n                // Parse the JSON directive\r\n                const directive = this._parseDirective(content);\r\n                if (directive) {\r\n                    this.lastDirective = directive;\r\n                    if (this.onDirective) {\r\n                        this.onDirective(directive);\r\n                    }\r\n                }\r\n\r\n                // Emit tick debug info\r\n                if (this.onTickDebug) {\r\n                    this.onTickDebug({\r\n                        tickNum: tickNum,\r\n                        stateMessage: userMessage,\r\n                        rawContent: content,\r\n                        directive: directive\r\n                    });\r\n                }\r\n            } catch (err) {\r\n                this.consecutiveErrors++;\r\n                this.lastError = err.message || String(err);\r\n                // Only log every error the first 3 times, then every 5th to reduce spam\r\n                if (this.consecutiveErrors <= 3 || this.consecutiveErrors % 5 === 0) {\r\n                    console.error('SessionDirector: Tick error (' + this.consecutiveErrors + ' consecutive):', err.message || err);\r\n                }\r\n                if (this.onError) this.onError(err);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Format session state into a user message for the LLM\r\n         * @param {Object} state - Current session state\r\n         * @returns {string} Formatted state message\r\n         * @private\r\n         */\r\n        _formatStateMessage(state) {\r\n            const lines = ['State Update:'];\r\n\r\n            // Biometric data\r\n            if (state.biometric) {\r\n                const b = state.biometric;\r\n                lines.push(`Biometric: emotion=${b.emotion || 'unknown'}, age=${b.age || 'unknown'}, gender=${b.gender || 'unknown'}`);\r\n            } else {\r\n                lines.push('Biometric: no face data');\r\n            }\r\n\r\n            // Emotion transition (recent change within 30s)\r\n            if (state.emotionTransition) {\r\n                const t = state.emotionTransition;\r\n                lines.push(`Emotion Shift: ${t.from}  ${t.to} (${t.secsAgo}s ago)`);\r\n            }\r\n\r\n            // Session labels\r\n            if (state.labels && state.labels.length > 0) {\r\n                lines.push('Session Labels: [' + state.labels.join(', ') + ']');\r\n            } else {\r\n                lines.push('Session Labels: none');\r\n            }\r\n\r\n            // Recent voice lines\r\n            if (state.recentVoiceLines && state.recentVoiceLines.length > 0) {\r\n                lines.push('Recent Voice: \"' + state.recentVoiceLines.join('\" | \"') + '\"');\r\n            }\r\n\r\n            // Injected voice lines (so the LLM knows what it already said)\r\n            if (state.injectedVoiceLines && state.injectedVoiceLines.length > 0) {\r\n                lines.push('Your Injected Lines: \"' + state.injectedVoiceLines.join('\" | \"') + '\"');\r\n            }\r\n\r\n            // Current text\r\n            if (state.currentText) {\r\n                lines.push('Current Text: \"' + state.currentText + '\"');\r\n            }\r\n\r\n            // Audio state  prefer band labels over raw Hz\r\n            if (state.audio) {\r\n                const a = state.audio;\r\n                if (a.bandLabel) {\r\n                    lines.push(`Current Audio: band=${a.bandLabel}, carrier=${a.baseFreq || '?'} Hz, isochronic=${a.isochronicEnabled ? 'on' : 'off'}`);\r\n                } else {\r\n                    lines.push(`Current Audio: sweep ${a.sweepStart || '?'}${a.sweepTrough || '?'}${a.sweepEnd || '?'} Hz, isochronic=${a.isochronicEnabled ? 'on' : 'off'}`);\r\n                }\r\n            }\r\n\r\n            // Visual state\r\n            if (state.visuals) {\r\n                const v = state.visuals;\r\n                lines.push(`Current Visual: ${v.mode || 'single'} mode, effects=[${(v.effects || []).join(',')}]`);\r\n            }\r\n\r\n            // SD image generation config\r\n            if (state.sdConfig) {\r\n                const sd = state.sdConfig;\r\n                lines.push(`Current SD: style=${sd.style || '?'}, denoising=${sd.denoisingStrength || '?'}, cfg=${sd.cfg || '?'}, desc=\"${(sd.description || '').substring(0, 60)}\"`);\r\n            }\r\n\r\n            // Layer opacity\r\n            if (state.layerOpacity) {\r\n                const o = state.layerOpacity;\r\n                lines.push(`Layer Opacity: labels=${o.labels}, images=${o.images}, visualizer=${o.visualizer}, visuals=${o.visuals}`);\r\n            }\r\n\r\n            // User response from interactive mode\r\n            if (state.userResponse) {\r\n                lines.push('User Response: \"' + state.userResponse + '\"');\r\n            }\r\n\r\n            // Interactive mode indicator with escalating prompts\r\n            if (state.interactiveEnabled) {\r\n                const ticks = state.ticksSinceAskUser || 0;\r\n                if (ticks >= 4) {\r\n                    lines.push('Interactive: ENABLED  You MUST include askUser in this response. Ask the user a short question about their experience. Example: {\"askUser\":{\"question\":\"How are you feeling right now?\"}}');\r\n                } else if (ticks >= 2) {\r\n                    lines.push('Interactive: ENABLED  Include an askUser directive to check in with the user. Pair it with a matching voiceLine.');\r\n                } else {\r\n                    lines.push('Interactive: ENABLED');\r\n                }\r\n            }\r\n\r\n            // Mood ring status\r\n            if (state.moodRingEnabled) {\r\n                lines.push('Mood Ring: ACTIVE  include suggestMood in your response');\r\n            }\r\n\r\n            // Elapsed time\r\n            if (state.elapsedMinutes != null) {\r\n                lines.push('Elapsed: ' + Math.round(state.elapsedMinutes) + ' min');\r\n            }\r\n\r\n            return lines.join('\\n');\r\n        }\r\n\r\n        /**\r\n         * Extract assistant content from LLM response\r\n         * @param {Object} response - Chat response object\r\n         * @returns {string|null} Content string\r\n         * @private\r\n         */\r\n        _extractContent(response) {\r\n            if (!response) return null;\r\n\r\n            // Handle different response shapes\r\n            if (typeof response === 'string') return response;\r\n\r\n            // olio.llm.chatResponse  extract last assistant message content\r\n            if (response.messages && Array.isArray(response.messages)) {\r\n                for (let i = response.messages.length - 1; i >= 0; i--) {\r\n                    if (response.messages[i].role === 'assistant' && response.messages[i].content) {\r\n                        return response.messages[i].content;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (response.message) return response.message;\r\n            if (response.content) return response.content;\r\n            if (response.choices && response.choices[0]) {\r\n                const choice = response.choices[0];\r\n                return choice.message?.content || choice.content || choice.text;\r\n            }\r\n            if (response.results && response.results.length > 0) {\r\n                return response.results[0].content || response.results[0].message;\r\n            }\r\n\r\n            return JSON.stringify(response);\r\n        }\r\n\r\n        /**\r\n         * Parse a JSON directive from LLM response content\r\n         * Handles markdown fences, extraneous text, and validation\r\n         * @param {string} content - Raw LLM response\r\n         * @returns {Object|null} Parsed directive or null\r\n         * @private\r\n         */\r\n        _parseDirective(content) {\r\n            if (!content) return null;\r\n\r\n            let jsonStr = content.trim();\r\n\r\n            // Strip markdown code fences\r\n            jsonStr = jsonStr.replace(/^```(?:json)?\\s*/i, '').replace(/\\s*```$/i, '');\r\n\r\n            // Find the first { to last } block\r\n            const firstBrace = jsonStr.indexOf('{');\r\n            if (firstBrace === -1) {\r\n                console.warn('SessionDirector: No JSON object found in response');\r\n                return null;\r\n            }\r\n\r\n            const lastBrace = jsonStr.lastIndexOf('}');\r\n            if (lastBrace !== -1 && lastBrace > firstBrace) {\r\n                jsonStr = jsonStr.substring(firstBrace, lastBrace + 1);\r\n            } else {\r\n                jsonStr = jsonStr.substring(firstBrace);\r\n            }\r\n\r\n            // Repair unbalanced braces/brackets (truncated LLM responses)\r\n            jsonStr = this._repairTruncatedJson(jsonStr);\r\n\r\n            // Try strict JSON first, then lenient JS-object parsing\r\n            let directive;\r\n            try {\r\n                directive = JSON.parse(jsonStr);\r\n            } catch (strictErr) {\r\n                // Local LLMs often return JS-like objects: unquoted keys, single-quoted strings, trailing commas\r\n                try {\r\n                    let fixed = jsonStr;\r\n\r\n                    // Step 0: Strip JS-style comments\r\n                    fixed = fixed.replace(/\\/\\/[^\\n]*/g, '');\r\n                    fixed = fixed.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\r\n\r\n                    // Step 1: Protect existing double-quoted strings from regex modification\r\n                    const preserved = [];\r\n                    fixed = fixed.replace(/\"(?:[^\"\\\\]|\\\\.)*\"/g, (match) => {\r\n                        preserved.push(match);\r\n                        return '\"__P' + (preserved.length - 1) + '__\"';\r\n                    });\r\n\r\n                    // Step 2: Quote unquoted keys (word followed by colon, after { , or [)\r\n                    fixed = fixed.replace(/([{,\\[]\\s*)([a-zA-Z_]\\w*)\\s*:/g, '$1\"$2\":');\r\n\r\n                    // Step 2.5: Quote bare identifier values (word after colon, not true/false/null)\r\n                    fixed = fixed.replace(/:\\s*([a-zA-Z_][a-zA-Z0-9_]*)\\s*([,}\\]])/g, (match, val, term) => {\r\n                        if (val === 'true' || val === 'false' || val === 'null') return match;\r\n                        return ': \"' + val + '\"' + term;\r\n                    });\r\n                    // Also handle bare identifiers inside arrays: [word, word]\r\n                    fixed = fixed.replace(/([[,]\\s*)([a-zA-Z_][a-zA-Z0-9_]*)\\s*(?=[,\\]])/g, (match, prefix, val) => {\r\n                        if (val === 'true' || val === 'false' || val === 'null') return match;\r\n                        return prefix + '\"' + val + '\"';\r\n                    });\r\n\r\n                    // Step 3: Convert single-quoted strings to double-quoted\r\n                    fixed = fixed.replace(/'([^']*?)'/g, '\"$1\"');\r\n\r\n                    // Step 4: Remove trailing commas before } or ]\r\n                    fixed = fixed.replace(/,\\s*([}\\]])/g, '$1');\r\n\r\n                    // Step 5: Remove leading commas after { or [\r\n                    fixed = fixed.replace(/([{\\[]\\s*),/g, '$1');\r\n\r\n                    // Step 6: Restore preserved double-quoted strings\r\n                    fixed = fixed.replace(/\"__P(\\d+)__\"/g, (_, i) => preserved[parseInt(i)]);\r\n\r\n                    // Step 7: Repair any remaining unbalanced braces\r\n                    fixed = this._repairTruncatedJson(fixed);\r\n\r\n                    directive = JSON.parse(fixed);\r\n                    console.log('SessionDirector: Parsed directive using lenient JS-object mode');\r\n                } catch (lenientErr) {\r\n                    console.warn('SessionDirector: Failed to parse directive (strict & lenient):', strictErr.message);\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            try {\r\n\r\n                // Validate expected fields - ignore unknown\r\n                const valid = {};\r\n\r\n                if (directive.audio && typeof directive.audio === 'object') {\r\n                    valid.audio = {};\r\n                    // Named preset\r\n                    if (typeof directive.audio.preset === 'string') valid.audio.preset = directive.audio.preset;\r\n                    // Named band with optional transitions\r\n                    const validBands = ['delta', 'theta', 'alphaTheta', 'alpha', 'beta', 'gamma'];\r\n                    if (typeof directive.audio.band === 'string' && validBands.includes(directive.audio.band)) {\r\n                        valid.audio.band = directive.audio.band;\r\n                    }\r\n                    if (typeof directive.audio.troughBand === 'string' && validBands.includes(directive.audio.troughBand)) {\r\n                        valid.audio.troughBand = directive.audio.troughBand;\r\n                    }\r\n                    if (typeof directive.audio.endBand === 'string' && validBands.includes(directive.audio.endBand)) {\r\n                        valid.audio.endBand = directive.audio.endBand;\r\n                    }\r\n                    if (typeof directive.audio.secondTransition === 'string' && validBands.includes(directive.audio.secondTransition)) {\r\n                        valid.audio.secondTransition = directive.audio.secondTransition;\r\n                    }\r\n                    if (typeof directive.audio.thirdTransition === 'string' && validBands.includes(directive.audio.thirdTransition)) {\r\n                        valid.audio.thirdTransition = directive.audio.thirdTransition;\r\n                    }\r\n                    if (typeof directive.audio.baseFreq === 'number') valid.audio.baseFreq = directive.audio.baseFreq;\r\n                    // Legacy raw Hz sweep (backwards compatible)\r\n                    if (typeof directive.audio.sweepStart === 'number') valid.audio.sweepStart = directive.audio.sweepStart;\r\n                    if (typeof directive.audio.sweepTrough === 'number') valid.audio.sweepTrough = directive.audio.sweepTrough;\r\n                    if (typeof directive.audio.sweepEnd === 'number') valid.audio.sweepEnd = directive.audio.sweepEnd;\r\n                    // Isochronic\r\n                    if (typeof directive.audio.isochronicEnabled === 'boolean') valid.audio.isochronicEnabled = directive.audio.isochronicEnabled;\r\n                    if (typeof directive.audio.isochronicRate === 'number') valid.audio.isochronicRate = directive.audio.isochronicRate;\r\n                    if (typeof directive.audio.isochronicBand === 'string' && validBands.includes(directive.audio.isochronicBand)) {\r\n                        valid.audio.isochronicBand = directive.audio.isochronicBand;\r\n                    }\r\n                    if (typeof directive.audio.volume === 'number') valid.audio.volume = directive.audio.volume;\r\n                }\r\n\r\n                if (directive.visuals && typeof directive.visuals === 'object') {\r\n                    valid.visuals = {};\r\n                    if (typeof directive.visuals.effect === 'string') valid.visuals.effect = directive.visuals.effect;\r\n                    if (typeof directive.visuals.transitionDuration === 'number') valid.visuals.transitionDuration = directive.visuals.transitionDuration;\r\n                }\r\n\r\n                if (directive.labels && typeof directive.labels === 'object') {\r\n                    valid.labels = {};\r\n                    if (Array.isArray(directive.labels.add)) {\r\n                        valid.labels.add = directive.labels.add.filter(l => typeof l === 'string');\r\n                    }\r\n                    if (Array.isArray(directive.labels.remove)) {\r\n                        valid.labels.remove = directive.labels.remove.filter(l => typeof l === 'string');\r\n                    }\r\n                }\r\n\r\n                if (directive.generateImage && typeof directive.generateImage === 'object') {\r\n                    valid.generateImage = {};\r\n                    if (typeof directive.generateImage.description === 'string') valid.generateImage.description = directive.generateImage.description;\r\n                    if (typeof directive.generateImage.style === 'string') valid.generateImage.style = directive.generateImage.style;\r\n                    if (typeof directive.generateImage.imageAction === 'string') valid.generateImage.imageAction = directive.generateImage.imageAction;\r\n                    if (typeof directive.generateImage.denoisingStrength === 'number') valid.generateImage.denoisingStrength = directive.generateImage.denoisingStrength;\r\n                    if (typeof directive.generateImage.cfg === 'number') valid.generateImage.cfg = directive.generateImage.cfg;\r\n                    // Tags as \"tag1+tag2\" string or [\"tag1\",\"tag2\"] array\r\n                    if (typeof directive.generateImage.tags === 'string') {\r\n                        valid.generateImage.tags = directive.generateImage.tags.split('+').map(t => t.trim()).filter(t => t);\r\n                    } else if (Array.isArray(directive.generateImage.tags)) {\r\n                        valid.generateImage.tags = directive.generateImage.tags.filter(t => typeof t === 'string');\r\n                    }\r\n                    // Only keep if at least one field was set\r\n                    if (Object.keys(valid.generateImage).length === 0) delete valid.generateImage;\r\n                }\r\n\r\n                if (directive.opacity && typeof directive.opacity === 'object') {\r\n                    valid.opacity = {};\r\n                    for (const layer of ['labels', 'images', 'visualizer', 'visuals']) {\r\n                        if (typeof directive.opacity[layer] === 'number') {\r\n                            valid.opacity[layer] = Math.max(0.15, Math.min(1, directive.opacity[layer]));\r\n                        }\r\n                    }\r\n                    if (Object.keys(valid.opacity).length === 0) delete valid.opacity;\r\n                }\r\n\r\n                if (typeof directive.voiceLine === 'string' && directive.voiceLine.trim().length > 0) {\r\n                    valid.voiceLine = directive.voiceLine.trim();\r\n                }\r\n\r\n                if (typeof directive.commentary === 'string') {\r\n                    valid.commentary = directive.commentary;\r\n                }\r\n\r\n                if (typeof directive.progressPct === 'number') {\r\n                    valid.progressPct = Math.max(0, Math.min(100, Math.round(directive.progressPct)));\r\n                }\r\n\r\n                // Validate suggestMood\r\n                if (directive.suggestMood && typeof directive.suggestMood === 'object') {\r\n                    const validEmotions = ['neutral', 'happy', 'sad', 'angry', 'fear', 'surprise', 'disgust'];\r\n                    const validGenders = ['Man', 'Woman'];\r\n                    valid.suggestMood = {};\r\n                    if (typeof directive.suggestMood.emotion === 'string' && validEmotions.includes(directive.suggestMood.emotion)) {\r\n                        valid.suggestMood.emotion = directive.suggestMood.emotion;\r\n                    }\r\n                    if (typeof directive.suggestMood.gender === 'string' && validGenders.includes(directive.suggestMood.gender)) {\r\n                        valid.suggestMood.gender = directive.suggestMood.gender;\r\n                    }\r\n                    if (typeof directive.suggestMood.genderPct === 'number') {\r\n                        valid.suggestMood.genderPct = Math.max(0, Math.min(100, Math.round(directive.suggestMood.genderPct)));\r\n                    }\r\n                    if (Object.keys(valid.suggestMood).length === 0) delete valid.suggestMood;\r\n                }\r\n\r\n                // Validate askUser\r\n                if (directive.askUser && typeof directive.askUser === 'object') {\r\n                    if (typeof directive.askUser.question === 'string' && directive.askUser.question.trim().length > 0) {\r\n                        valid.askUser = {\r\n                            question: directive.askUser.question.trim()\r\n                        };\r\n                    }\r\n                }\r\n\r\n                return valid;\r\n            } catch (err) {\r\n                console.warn('SessionDirector: Failed to parse JSON directive:', err.message);\r\n                return null;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Repair truncated JSON by closing unbalanced braces/brackets and\r\n         * trimming any trailing incomplete key-value pair\r\n         * @param {string} json - Potentially truncated JSON string\r\n         * @returns {string} Repaired JSON string\r\n         * @private\r\n         */\r\n        _repairTruncatedJson(json) {\r\n            // Remove trailing incomplete value (after last comma or colon outside strings)\r\n            json = json.replace(/,\\s*[a-zA-Z_\"'][^{}[\\]]*$/, '');\r\n            json = json.replace(/:\\s*$/, ': null');\r\n            // Remove naked trailing comma (truncated mid-object/array)\r\n            json = json.replace(/,\\s*$/, '');\r\n\r\n            let openBraces = 0, openBrackets = 0;\r\n            let inString = false, escape = false, stringChar = '';\r\n            for (const ch of json) {\r\n                if (escape) { escape = false; continue; }\r\n                if (ch === '\\\\') { escape = true; continue; }\r\n                if (!inString && (ch === '\"' || ch === \"'\")) { inString = true; stringChar = ch; continue; }\r\n                if (inString && ch === stringChar) { inString = false; continue; }\r\n                if (inString) continue;\r\n                if (ch === '{') openBraces++;\r\n                else if (ch === '}') openBraces--;\r\n                else if (ch === '[') openBrackets++;\r\n                else if (ch === ']') openBrackets--;\r\n            }\r\n\r\n            // Close unclosed strings (if truncated mid-string)\r\n            if (inString) json += stringChar;\r\n\r\n            if (openBrackets > 0 || openBraces > 0) {\r\n                for (let i = 0; i < openBrackets; i++) json += ']';\r\n                for (let i = 0; i < openBraces; i++) json += '}';\r\n                // Clean up trailing commas before the newly added closing braces/brackets\r\n                json = json.replace(/,\\s*([}\\]])/g, '$1');\r\n                console.log('SessionDirector: Repaired truncated JSON (added ' + openBraces + ' braces, ' + openBrackets + ' brackets)');\r\n            }\r\n\r\n            return json;\r\n        }\r\n\r\n        /**\r\n         * Verify that a directive was applied correctly by comparing against post-application state\r\n         * @param {Object} directive - The directive that was applied\r\n         * @param {Object} postState - State gathered after application\r\n         * @returns {Array<{field: string, pass: boolean, detail: string}>}\r\n         * @private\r\n         */\r\n        _verifyDirectiveApplication(directive, postState) {\r\n            const checks = [];\r\n\r\n            if (directive.audio && postState.audio) {\r\n                for (const key of ['sweepStart', 'sweepTrough', 'sweepEnd']) {\r\n                    if (directive.audio[key] != null) {\r\n                        const match = postState.audio[key] === directive.audio[key];\r\n                        checks.push({\r\n                            field: 'audio.' + key,\r\n                            pass: match,\r\n                            detail: match\r\n                                ? key + '=' + postState.audio[key]\r\n                                : 'expected ' + directive.audio[key] + ', got ' + postState.audio[key]\r\n                        });\r\n                    }\r\n                }\r\n                if (directive.audio.isochronicEnabled != null) {\r\n                    const match = postState.audio.isochronicEnabled === directive.audio.isochronicEnabled;\r\n                    checks.push({\r\n                        field: 'audio.isochronicEnabled',\r\n                        pass: match,\r\n                        detail: match\r\n                            ? 'isochronic=' + postState.audio.isochronicEnabled\r\n                            : 'expected ' + directive.audio.isochronicEnabled + ', got ' + postState.audio.isochronicEnabled\r\n                    });\r\n                }\r\n            }\r\n\r\n            if (directive.visuals?.effect && postState.visuals) {\r\n                const match = postState.visuals.effects && postState.visuals.effects.includes(directive.visuals.effect);\r\n                checks.push({\r\n                    field: 'visuals.effect',\r\n                    pass: match,\r\n                    detail: match\r\n                        ? 'effect=' + directive.visuals.effect\r\n                        : 'expected ' + directive.visuals.effect + ', got ' + JSON.stringify(postState.visuals.effects)\r\n                });\r\n            }\r\n\r\n            if (directive.labels?.add?.length > 0 && postState.labels) {\r\n                for (const label of directive.labels.add) {\r\n                    const match = postState.labels.includes(label);\r\n                    checks.push({\r\n                        field: 'labels.add',\r\n                        pass: match,\r\n                        detail: match ? '\"' + label + '\" present' : '\"' + label + '\" not found in state'\r\n                    });\r\n                }\r\n            }\r\n\r\n            if (directive.labels?.remove?.length > 0 && postState.labels) {\r\n                for (const label of directive.labels.remove) {\r\n                    const match = !postState.labels.includes(label);\r\n                    checks.push({\r\n                        field: 'labels.remove',\r\n                        pass: match,\r\n                        detail: match ? '\"' + label + '\" removed' : '\"' + label + '\" still present'\r\n                    });\r\n                }\r\n            }\r\n\r\n            return checks;\r\n        }\r\n\r\n        /**\r\n         * Run diagnostics - verify infrastructure, then multi-pass behavioral tests\r\n         * with varying biometric states to verify the LLM adapts its directives.\r\n         * Uses dedicated \"Magic8 Diagnostics\" configs to avoid modifying live session state.\r\n         * @param {string} [command] - Optional command override for testing\r\n         * @param {Function} [onDirective] - Called with each parsed directive for live application\r\n         * @param {Function} [onLog] - Called with each log entry for live display\r\n         * @returns {Promise<Array<{name: string, pass: boolean, detail: string, directive?: Object}>>}\r\n         */\r\n        async runDiagnostics(command, onDirective, onLog) {\r\n            const results = [];\r\n            const testCommand = command || this.command || 'Diagnostic test session';\r\n\r\n            const log = (name, pass, detail, directive) => {\r\n                const entry = { name, pass, detail: detail || '' };\r\n                if (directive) entry.directive = directive;\r\n                results.push(entry);\r\n                console.log(`SessionDirector [TEST] ${pass ? 'PASS' : 'FAIL'}: ${name}${detail ? ' - ' + detail : ''}`);\r\n                if (onLog) onLog(entry);\r\n            };\r\n\r\n            // === INFRASTRUCTURE TESTS ===\r\n\r\n            // Test 1: ~/Chat directory\r\n            let chatDir;\r\n            try {\r\n                chatDir = await page.findObject(\"auth.group\", \"DATA\", \"~/Chat\");\r\n                if (chatDir && chatDir.objectId) {\r\n                    log('Find ~/Chat directory', true, chatDir.objectId);\r\n                } else {\r\n                    log('Find ~/Chat directory', false, 'Not found');\r\n                    return results;\r\n                }\r\n            } catch (err) {\r\n                log('Find ~/Chat directory', false, err.message);\r\n                return results;\r\n            }\r\n\r\n            // Test 2: \"Open Chat\" template\r\n            let templateCfg, fullTemplate;\r\n            try {\r\n                const chatConfigs = await am7client.list(\"olio.llm.chatConfig\", chatDir.objectId, null, 0, 0);\r\n                templateCfg = chatConfigs.find(c => c.name === \"Open Chat\");\r\n                if (templateCfg) {\r\n                    log('Find \"Open Chat\" template', true, templateCfg.objectId);\r\n                } else {\r\n                    const names = chatConfigs.map(c => c.name).join(', ');\r\n                    log('Find \"Open Chat\" template', false, 'Available: ' + (names || 'none'));\r\n                    return results;\r\n                }\r\n            } catch (err) {\r\n                log('Find \"Open Chat\" template', false, err.message);\r\n                return results;\r\n            }\r\n\r\n            // Test 3: Load full template\r\n            try {\r\n                fullTemplate = await am7client.getFull(\"olio.llm.chatConfig\", templateCfg.objectId);\r\n                if (fullTemplate && fullTemplate.serverUrl) {\r\n                    log('Load template details', true,\r\n                        `model=${fullTemplate.model}, service=${fullTemplate.serviceType}, server=${fullTemplate.serverUrl}`);\r\n                } else {\r\n                    log('Load template details', false, 'Template loaded but missing serverUrl');\r\n                    return results;\r\n                }\r\n            } catch (err) {\r\n                log('Load template details', false, err.message);\r\n                return results;\r\n            }\r\n\r\n            // Test 4: Diagnostic prompt config (separate from live session)\r\n            let promptConfig;\r\n            try {\r\n                const systemPrompt = await this._buildSystemPrompt(testCommand);\r\n                promptConfig = await this._ensureDiagnosticPromptConfig(chatDir, systemPrompt);\r\n                if (promptConfig && promptConfig.objectId) {\r\n                    log('Diagnostic prompt config', true,\r\n                        `objectId=${promptConfig.objectId}, system lines=${promptConfig.system?.length || '?'}`);\r\n                } else {\r\n                    log('Diagnostic prompt config', false, 'Returned null');\r\n                    return results;\r\n                }\r\n            } catch (err) {\r\n                log('Diagnostic prompt config', false, err.message);\r\n                return results;\r\n            }\r\n\r\n            // Test 5: Diagnostic chat config (separate, temperature=0.8)\r\n            let chatConfig;\r\n            try {\r\n                chatConfig = await this._ensureDiagnosticChatConfig(chatDir, fullTemplate);\r\n                if (chatConfig && chatConfig.objectId) {\r\n                    const temp = chatConfig.chatOptions?.temperature;\r\n                    log('Diagnostic chat config', true,\r\n                        `objectId=${chatConfig.objectId}, model=${chatConfig.model}, temp=${temp || 'default'}`);\r\n                } else {\r\n                    log('Diagnostic chat config', false, 'Returned null');\r\n                    return results;\r\n                }\r\n            } catch (err) {\r\n                log('Diagnostic chat config', false, err.message);\r\n                return results;\r\n            }\r\n\r\n            // Test 6: Diagnostic chat request\r\n            let chatRequest;\r\n            try {\r\n                chatRequest = await am7chat.getChatRequest(\"Magic8 Diagnostics\", chatConfig, promptConfig);\r\n                if (chatRequest) {\r\n                    log('Diagnostic chat request', true,\r\n                        `objectId=${chatRequest.objectId || 'inline'}`);\r\n                } else {\r\n                    log('Diagnostic chat request', false, 'Returned null');\r\n                    return results;\r\n                }\r\n            } catch (err) {\r\n                log('Diagnostic chat request', false, err.message);\r\n                return results;\r\n            }\r\n\r\n            // === BEHAVIORAL TESTS - multiple passes with varying biometric states ===\r\n\r\n            const testScenarios = [\r\n                {\r\n                    name: 'Pass 1: Neutral baseline',\r\n                    state: {\r\n                        biometric: { emotion: 'neutral', age: 30, gender: 'unknown' },\r\n                        labels: [],\r\n                        recentVoiceLines: [],\r\n                        currentText: '',\r\n                        audio: { sweepStart: 8, sweepTrough: 2, sweepEnd: 8, isochronicEnabled: false },\r\n                        visuals: { mode: 'single', effects: ['particles'] },\r\n                        elapsedMinutes: 0\r\n                    }\r\n                },\r\n                {\r\n                    name: 'Pass 2: Happy + early session',\r\n                    state: {\r\n                        biometric: { emotion: 'happy', age: 28, gender: 'female' },\r\n                        labels: [], // will be filled from pass 1\r\n                        recentVoiceLines: ['relax and breathe deeply'],\r\n                        currentText: 'let go of tension',\r\n                        audio: { sweepStart: 8, sweepTrough: 2, sweepEnd: 8, isochronicEnabled: false },\r\n                        visuals: { mode: 'single', effects: ['particles'] },\r\n                        elapsedMinutes: 2\r\n                    }\r\n                },\r\n                {\r\n                    name: 'Pass 3: Sad + mid-session',\r\n                    state: {\r\n                        biometric: { emotion: 'sad', age: 35, gender: 'male' },\r\n                        labels: [],\r\n                        recentVoiceLines: ['feel the weight lifting', 'you are safe here'],\r\n                        currentText: 'embrace the stillness',\r\n                        audio: { sweepStart: 6, sweepTrough: 3, sweepEnd: 7, isochronicEnabled: true },\r\n                        visuals: { mode: 'single', effects: ['spiral'] },\r\n                        elapsedMinutes: 5\r\n                    }\r\n                },\r\n                {\r\n                    name: 'Pass 4: Fear + late session',\r\n                    state: {\r\n                        biometric: { emotion: 'fear', age: 42, gender: 'female' },\r\n                        labels: [],\r\n                        recentVoiceLines: ['nothing can harm you', 'breathe into the feeling'],\r\n                        currentText: 'you are protected',\r\n                        audio: { sweepStart: 4, sweepTrough: 2, sweepEnd: 5, isochronicEnabled: true },\r\n                        visuals: { mode: 'single', effects: ['mandala'] },\r\n                        elapsedMinutes: 12\r\n                    }\r\n                },\r\n                {\r\n                    name: 'Pass 5: Interactive + user response',\r\n                    state: {\r\n                        biometric: { emotion: 'happy', age: 30, gender: 'female' },\r\n                        labels: [],\r\n                        recentVoiceLines: [],\r\n                        currentText: '',\r\n                        audio: { sweepStart: 8, sweepTrough: 4, sweepEnd: 8, isochronicEnabled: false },\r\n                        visuals: { mode: 'single', effects: ['particles'] },\r\n                        interactiveEnabled: true,\r\n                        ticksSinceAskUser: 5,\r\n                        userResponse: 'I feel calm and centered',\r\n                        elapsedMinutes: 8\r\n                    }\r\n                }\r\n            ];\r\n\r\n            const directives = [];\r\n            let accumulatedLabels = [];\r\n\r\n            for (let i = 0; i < testScenarios.length; i++) {\r\n                const scenario = testScenarios[i];\r\n\r\n                // Carry forward labels from previous directives\r\n                if (i > 0) {\r\n                    scenario.state.labels = [...accumulatedLabels];\r\n                }\r\n                // Carry forward audio/visual changes from previous directives\r\n                if (i > 0 && directives[i - 1]) {\r\n                    const prev = directives[i - 1];\r\n                    if (prev.audio) {\r\n                        if (prev.audio.sweepStart != null) scenario.state.audio.sweepStart = prev.audio.sweepStart;\r\n                        if (prev.audio.sweepTrough != null) scenario.state.audio.sweepTrough = prev.audio.sweepTrough;\r\n                        if (prev.audio.sweepEnd != null) scenario.state.audio.sweepEnd = prev.audio.sweepEnd;\r\n                        if (prev.audio.isochronicEnabled != null) scenario.state.audio.isochronicEnabled = prev.audio.isochronicEnabled;\r\n                    }\r\n                    if (prev.visuals?.effect) {\r\n                        scenario.state.visuals.effects = [prev.visuals.effect];\r\n                    }\r\n                }\r\n\r\n                try {\r\n                    const msg = this._formatStateMessage(scenario.state);\r\n                    console.log('SessionDirector [TEST] Sending:', msg);\r\n                    const response = await am7chat.chat(chatRequest, msg);\r\n                    const content = this._extractContent(response);\r\n                    console.log('SessionDirector [TEST] Raw response:', content);\r\n\r\n                    if (!content) {\r\n                        log(scenario.name, false, 'Empty response from LLM');\r\n                        directives.push(null);\r\n                        continue;\r\n                    }\r\n\r\n                    const directive = this._parseDirective(content);\r\n                    directives.push(directive);\r\n\r\n                    if (directive) {\r\n                        // Track accumulated labels\r\n                        if (directive.labels?.add) {\r\n                            for (const l of directive.labels.add) {\r\n                                if (!accumulatedLabels.includes(l)) accumulatedLabels.push(l);\r\n                            }\r\n                            if (accumulatedLabels.length > 10) accumulatedLabels = accumulatedLabels.slice(-10);\r\n                        }\r\n                        if (directive.labels?.remove) {\r\n                            accumulatedLabels = accumulatedLabels.filter(l => !directive.labels.remove.includes(l));\r\n                        }\r\n\r\n                        // Build detail summary\r\n                        const parts = [];\r\n                        if (directive.audio) parts.push('audio:' + Object.keys(directive.audio).join(','));\r\n                        if (directive.visuals) parts.push('visual:' + (directive.visuals.effect || 'unchanged'));\r\n                        if (directive.labels?.add?.length) parts.push('+' + directive.labels.add.length + ' labels');\r\n                        if (directive.labels?.remove?.length) parts.push('-' + directive.labels.remove.length + ' labels');\r\n                        if (directive.generateImage) parts.push('img:yes');\r\n                        if (directive.askUser) parts.push('askUser:\"' + directive.askUser.question.substring(0, 30) + '\"');\r\n                        if (directive.commentary) parts.push('note:' + directive.commentary.substring(0, 40));\r\n\r\n                        log(scenario.name, true, parts.join(' | ') || 'empty directive', directive);\r\n\r\n                        // Notify caller for live application\r\n                        if (onDirective) onDirective(directive, i, scenario.name);\r\n\r\n                        // Verify directive was applied to actual session state\r\n                        if (onDirective && this.stateProvider) {\r\n                            await new Promise(r => setTimeout(r, 200));\r\n                            const postState = this.stateProvider();\r\n                            const verifications = this._verifyDirectiveApplication(directive, postState);\r\n                            for (const v of verifications) {\r\n                                log(scenario.name + ' verify: ' + v.field, v.pass, v.detail);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        log(scenario.name, false, 'Could not parse: ' + content.substring(0, 80));\r\n                    }\r\n                } catch (err) {\r\n                    log(scenario.name, false, err.message);\r\n                    directives.push(null);\r\n                }\r\n            }\r\n\r\n            // === ADAPTATION ANALYSIS ===\r\n\r\n            const validDirectives = directives.filter(d => d != null);\r\n            if (validDirectives.length >= 2) {\r\n                // Check if directives actually changed between passes\r\n                let changes = 0;\r\n                for (let i = 1; i < validDirectives.length; i++) {\r\n                    const prev = JSON.stringify(validDirectives[i - 1]);\r\n                    const curr = JSON.stringify(validDirectives[i]);\r\n                    if (prev !== curr) changes++;\r\n                }\r\n\r\n                if (changes > 0) {\r\n                    log('Adaptation check', true,\r\n                        changes + '/' + (validDirectives.length - 1) + ' passes produced different directives');\r\n                } else {\r\n                    log('Adaptation check', false,\r\n                        'All passes returned identical directives - LLM may not be responding to state changes');\r\n                }\r\n\r\n                // Check if emotion shift caused any label/visual/audio change\r\n                const hasLabelActivity = validDirectives.some(d => d.labels?.add?.length || d.labels?.remove?.length);\r\n                const hasAudioChange = validDirectives.some(d => d.audio && Object.keys(d.audio).length > 0);\r\n                const hasVisualChange = validDirectives.some(d => d.visuals?.effect);\r\n\r\n                const hasAskUser = validDirectives.some(d => d.askUser);\r\n\r\n                log('Coverage: labels', hasLabelActivity, hasLabelActivity ? 'LLM generated labels' : 'No labels across all passes');\r\n                log('Coverage: audio', hasAudioChange, hasAudioChange ? 'LLM adjusted audio' : 'No audio changes across all passes');\r\n                log('Coverage: visuals', hasVisualChange, hasVisualChange ? 'LLM changed visuals' : 'No visual changes across all passes');\r\n                log('Coverage: askUser', hasAskUser, hasAskUser ? 'LLM used askUser directive' : 'No askUser across all passes (may be expected if interactive scenario was not reached)');\r\n            } else if (validDirectives.length === 1) {\r\n                log('Adaptation check', true, 'Only 1 valid directive - cannot compare adaptation');\r\n            } else {\r\n                log('Adaptation check', false, 'No valid directives returned');\r\n            }\r\n\r\n            return results;\r\n        }\r\n\r\n        /**\r\n         * Emit status change\r\n         * @param {string} status\r\n         * @private\r\n         */\r\n        _setStatus(status) {\r\n            if (this.onStatusChange) {\r\n                this.onStatusChange(status);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Clean up all resources\r\n         */\r\n        dispose() {\r\n            this.stop();\r\n            this.chatRequest = null;\r\n            this.chatConfig = null;\r\n            this.promptConfig = null;\r\n            this.stateProvider = null;\r\n            this.onDirective = null;\r\n            this.onError = null;\r\n            this.onStatusChange = null;\r\n            this.onTickDebug = null;\r\n            this.lastDirective = null;\r\n            this.lastError = null;\r\n        }\r\n    }\r\n\r\n    // Export\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n        module.exports = SessionDirector;\r\n    }\r\n    if (typeof window !== 'undefined') {\r\n        window.Magic8 = window.Magic8 || {};\r\n        window.Magic8.SessionDirector = SessionDirector;\r\n    }\r\n\r\n}());\r\n\n\n;/* === client/view/magic8/components/HypnoCanvas.js === */\n/**\r\n * HypnoCanvas - Multi-effect visual animation canvas with theme-responsive colors\r\n * Supports particles, spiral, mandala, tunnel effects with transitions\r\n * Mithril.js component for the visual effect layer\r\n */\r\nconst HypnoCanvas = {\r\n    PARTICLE_COUNT: 100,\r\n    particles: [],\r\n    canvas: null,\r\n    ctx: null,\r\n    animationFrame: null,\r\n    isInitialized: false,\r\n    frame: 0,\r\n\r\n    // Effect configuration\r\n    effectMode: null,\r\n    effects: [],\r\n    visuals: null,\r\n\r\n    // Transition state\r\n    prevEffectMode: null,\r\n    transitionStart: 0,\r\n    transitionDuration: 2000,\r\n\r\n    // Auto-cycle state\r\n    cycleIndex: 0,\r\n    cycleTimer: null,\r\n\r\n    // Effect-specific settings\r\n    spiralSpeed: 0.01,\r\n    mandalaLayers: 4,\r\n    mandalaPetals: 12,\r\n    tunnelRings: 12,\r\n\r\n    /**\r\n     * Particle color from theme (updated dynamically)\r\n     */\r\n    particleColor: { r: 150, g: 180, b: 255 },\r\n\r\n    /**\r\n     * Accent color from theme for non-particle effects\r\n     */\r\n    accentColor: { r: 150, g: 180, b: 255 },\r\n\r\n    /**\r\n     * Create a new particle\r\n     * @param {Object} existing - Existing particle to reset (optional)\r\n     * @returns {Object} Particle object\r\n     */\r\n    createParticle(existing) {\r\n        const canvas = this.canvas;\r\n        return {\r\n            x: existing ? existing.x : Math.random() * (canvas?.width || window.innerWidth),\r\n            y: existing ? existing.y : Math.random() * (canvas?.height || window.innerHeight),\r\n            vx: (Math.random() - 0.5) * 0.5,\r\n            vy: (Math.random() - 0.5) * 0.5,\r\n            radius: Math.random() * 3 + 1,\r\n            alpha: Math.random() * 0.5 + 0.1,\r\n            pulsePhase: Math.random() * Math.PI * 2,\r\n            pulseSpeed: 0.02 + Math.random() * 0.02\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Initialize the canvas and particles\r\n     * @param {HTMLCanvasElement} canvasElement - Canvas DOM element\r\n     */\r\n    setupCanvas(canvasElement) {\r\n        if (this.isInitialized) return;\r\n\r\n        this.canvas = canvasElement;\r\n        this.ctx = canvasElement.getContext('2d');\r\n\r\n        this.resizeCanvas();\r\n        this._initParticles();\r\n\r\n        this.isInitialized = true;\r\n        this.frame = 0;\r\n        this.animate();\r\n    },\r\n\r\n    /**\r\n     * Initialize or reinitialize particles\r\n     * @private\r\n     */\r\n    _initParticles() {\r\n        const count = this.visuals?.particleCount || this.PARTICLE_COUNT;\r\n        this.particles = [];\r\n        for (let i = 0; i < count; i++) {\r\n            this.particles.push(this.createParticle());\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Resize canvas to fill viewport\r\n     */\r\n    resizeCanvas() {\r\n        if (!this.canvas) return;\r\n        this.canvas.width = window.innerWidth;\r\n        this.canvas.height = window.innerHeight;\r\n    },\r\n\r\n    /**\r\n     * Update colors from theme\r\n     * @param {Object} theme - Theme object with particle/accent color\r\n     */\r\n    updateTheme(theme) {\r\n        if (theme && theme.particle) {\r\n            this.particleColor = {\r\n                r: theme.particle[0],\r\n                g: theme.particle[1],\r\n                b: theme.particle[2]\r\n            };\r\n        } else if (theme && theme.accent) {\r\n            this.particleColor = {\r\n                r: theme.accent[0],\r\n                g: theme.accent[1],\r\n                b: theme.accent[2]\r\n            };\r\n        }\r\n        if (theme && theme.accent) {\r\n            this.accentColor = {\r\n                r: theme.accent[0],\r\n                g: theme.accent[1],\r\n                b: theme.accent[2]\r\n            };\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Apply visuals configuration from session config\r\n     * @param {Object} visuals - Visual effects config\r\n     */\r\n    applyVisuals(visuals) {\r\n        if (!visuals) return;\r\n        this.visuals = visuals;\r\n\r\n        if (Array.isArray(visuals.effects)) {\r\n            this.effects = visuals.effects;\r\n        }\r\n        if (visuals.spiralSpeed) this.spiralSpeed = visuals.spiralSpeed;\r\n        if (visuals.mandalaLayers) this.mandalaLayers = visuals.mandalaLayers;\r\n        if (visuals.tunnelRings) this.tunnelRings = visuals.tunnelRings;\r\n        if (visuals.transitionDuration) this.transitionDuration = visuals.transitionDuration;\r\n\r\n        // Set initial mode (null when no effects selected  director can still enable later)\r\n        if (this.effects.length === 0) {\r\n            this.effectMode = null;\r\n        } else if (visuals.mode === 'combined') {\r\n            this.effectMode = 'combined';\r\n        } else {\r\n            this.effectMode = this.effects[0];\r\n        }\r\n\r\n        // Reinitialize particles if count changed\r\n        if (visuals.particleCount && visuals.particleCount !== this.particles.length) {\r\n            this._initParticles();\r\n        }\r\n\r\n        // Start auto-cycling if configured\r\n        this._stopCycling();\r\n        if (visuals.mode === 'cycle' && this.effects.length > 1) {\r\n            this._startCycling(visuals.transitionInterval || 30000);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Start auto-cycling through effects\r\n     * @param {number} interval - Milliseconds between transitions\r\n     * @private\r\n     */\r\n    _startCycling(interval) {\r\n        this.cycleIndex = 0;\r\n        this.cycleTimer = setInterval(() => {\r\n            this.cycleIndex = (this.cycleIndex + 1) % this.effects.length;\r\n            this.transitionTo(this.effects[this.cycleIndex]);\r\n        }, interval);\r\n    },\r\n\r\n    /**\r\n     * Stop auto-cycling\r\n     * @private\r\n     */\r\n    _stopCycling() {\r\n        if (this.cycleTimer) {\r\n            clearInterval(this.cycleTimer);\r\n            this.cycleTimer = null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Transition to a new effect mode with cross-fade\r\n     * @param {string} newMode - Target effect mode\r\n     * @param {number} [duration] - Transition duration in ms\r\n     */\r\n    transitionTo(newMode, duration) {\r\n        if (newMode === this.effectMode) return;\r\n        this.prevEffectMode = this.effectMode;\r\n        this.effectMode = newMode;\r\n        this.transitionStart = Date.now();\r\n        if (duration != null) this.transitionDuration = duration;\r\n    },\r\n\r\n    /**\r\n     * Draw a specific effect by name\r\n     * @param {string} mode - Effect mode name\r\n     * @private\r\n     */\r\n    _drawEffect(mode) {\r\n        const ctx = this.ctx;\r\n        const w = this.canvas.width;\r\n        const h = this.canvas.height;\r\n\r\n        switch (mode) {\r\n            case 'particles':\r\n                this._drawParticles(ctx, w, h);\r\n                break;\r\n            case 'spiral':\r\n                this._drawSpiral(ctx, w, h);\r\n                break;\r\n            case 'mandala':\r\n                this._drawMandala(ctx, w, h);\r\n                break;\r\n            case 'tunnel':\r\n                this._drawTunnel(ctx, w, h);\r\n                break;\r\n            case 'hypnoDisc':\r\n                // Rendered as DOM elements (nested divs with CSS animation), not on canvas\r\n                break;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Draw particle effect (glowing orbs)\r\n     * @private\r\n     */\r\n    _drawParticles(ctx, w, h) {\r\n        this.particles.forEach(p => {\r\n            p.x += p.vx;\r\n            p.y += p.vy;\r\n\r\n            if (p.x < 0 || p.x > w) p.vx *= -1;\r\n            if (p.y < 0 || p.y > h) p.vy *= -1;\r\n\r\n            p.pulsePhase += p.pulseSpeed;\r\n            const pulseFactor = 0.5 + 0.5 * Math.sin(p.pulsePhase);\r\n\r\n            p.alpha -= 0.001;\r\n            if (p.alpha <= 0) {\r\n                Object.assign(p, this.createParticle());\r\n            }\r\n\r\n            const alpha = p.alpha * pulseFactor;\r\n            const { r, g, b } = this.particleColor;\r\n\r\n            // Outer glow\r\n            ctx.beginPath();\r\n            ctx.arc(p.x, p.y, p.radius * 2, 0, Math.PI * 2);\r\n            ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${alpha * 0.3})`;\r\n            ctx.fill();\r\n\r\n            // Inner particle\r\n            ctx.beginPath();\r\n            ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);\r\n            ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${alpha})`;\r\n            ctx.fill();\r\n        });\r\n    },\r\n\r\n    /**\r\n     * Draw rotating spiral effect (theme-aware colors)\r\n     * @private\r\n     */\r\n    _drawSpiral(ctx, w, h) {\r\n        const centerX = w / 2;\r\n        const centerY = h / 2;\r\n        const speed = this.spiralSpeed;\r\n        const pulse = 1 + 0.1 * Math.sin(this.frame * 0.005);\r\n        const { r, g, b } = this.accentColor;\r\n\r\n        const brightness = (r + g + b) / 3;\r\n        const useHueCycle = brightness < 50;\r\n\r\n        ctx.beginPath();\r\n        if (useHueCycle) {\r\n            const hue = (this.frame * 0.5) % 360;\r\n            ctx.strokeStyle = `hsla(${hue}, 100%, 80%, 0.8)`;\r\n            ctx.shadowColor = `hsl(${hue}, 100%, 80%)`;\r\n        } else {\r\n            ctx.strokeStyle = `rgba(${r}, ${g}, ${b}, 0.8)`;\r\n            ctx.shadowColor = `rgb(${r}, ${g}, ${b})`;\r\n        }\r\n        ctx.shadowBlur = 10;\r\n        ctx.lineWidth = 2;\r\n\r\n        let angle = 0;\r\n        ctx.moveTo(centerX, centerY);\r\n\r\n        // Scale spiral to fill the full screen (reach corners)\r\n        const cornerDist = Math.sqrt(w * w + h * h) / 2;\r\n        const maxPoints = 2500;\r\n        const radiusGrowth = cornerDist / maxPoints;\r\n        for (let i = 0; i < maxPoints; i++) {\r\n            const radius = i * radiusGrowth * pulse;\r\n            angle += 0.02;\r\n            const x = centerX + radius * Math.cos(angle + this.frame * speed);\r\n            const y = centerY + radius * Math.sin(angle + this.frame * speed);\r\n            ctx.lineTo(x, y);\r\n        }\r\n\r\n        ctx.stroke();\r\n        ctx.shadowBlur = 0;\r\n    },\r\n\r\n    /**\r\n     * Draw rotating mandala pattern (theme-aware colors)\r\n     * @private\r\n     */\r\n    _drawMandala(ctx, w, h) {\r\n        const centerX = w / 2;\r\n        const centerY = h / 2;\r\n        const layers = this.mandalaLayers;\r\n        const petals = this.mandalaPetals;\r\n        const { r, g, b } = this.accentColor;\r\n\r\n        const pulse = 1 + 0.08 * Math.sin(this.frame * 0.02);\r\n        const rotation = this.frame * 0.002;\r\n        const brightness = (r + g + b) / 3;\r\n        const useHueCycle = brightness < 50;\r\n\r\n        // Scale mandala to fill the screen (reach corners)\r\n        const maxExtent = Math.sqrt(w * w + h * h) / 2;\r\n        const layerSpacing = maxExtent / (layers + 1);\r\n\r\n        ctx.save();\r\n        ctx.translate(centerX, centerY);\r\n        ctx.scale(pulse, pulse);\r\n        ctx.rotate(rotation);\r\n\r\n        for (let layer = 0; layer < layers; layer++) {\r\n            const radius = layerSpacing * (layer + 1);\r\n            const petalLength = layerSpacing * 0.4;\r\n            const petalWidth = layerSpacing * 0.15;\r\n\r\n            for (let i = 0; i < petals; i++) {\r\n                const angle = (i * 2 * Math.PI) / petals;\r\n                const x = radius * Math.cos(angle);\r\n                const y = radius * Math.sin(angle);\r\n\r\n                ctx.save();\r\n                ctx.translate(x, y);\r\n                ctx.rotate(angle + rotation);\r\n\r\n                ctx.beginPath();\r\n                ctx.ellipse(0, 0, petalWidth, petalLength, 0, 0, 2 * Math.PI);\r\n\r\n                if (useHueCycle) {\r\n                    const hue = ((this.frame * 0.6) + i * 30) % 360;\r\n                    ctx.strokeStyle = `hsla(${hue}, 100%, 75%, 0.8)`;\r\n                    ctx.shadowColor = ctx.strokeStyle;\r\n                } else {\r\n                    const shift = (i * 30 + layer * 45) % 360;\r\n                    const lr = Math.min(255, r + Math.sin(shift * Math.PI / 180) * 60);\r\n                    const lg = Math.min(255, g + Math.cos(shift * Math.PI / 180) * 60);\r\n                    const lb = Math.min(255, b + Math.sin((shift + 120) * Math.PI / 180) * 60);\r\n                    ctx.strokeStyle = `rgba(${lr|0}, ${lg|0}, ${lb|0}, 0.8)`;\r\n                    ctx.shadowColor = ctx.strokeStyle;\r\n                }\r\n\r\n                ctx.shadowBlur = 8;\r\n                ctx.lineWidth = 2;\r\n                ctx.stroke();\r\n\r\n                ctx.restore();\r\n            }\r\n        }\r\n\r\n        ctx.restore();\r\n        ctx.shadowBlur = 0;\r\n    },\r\n\r\n    /**\r\n     * Draw hypnotic tunnel effect (concentric rings zooming outward)\r\n     * @private\r\n     */\r\n    _drawTunnel(ctx, w, h) {\r\n        const centerX = w / 2;\r\n        const centerY = h / 2;\r\n        const maxRadius = Math.sqrt(w * w + h * h) / 2;\r\n        const rings = this.tunnelRings;\r\n        const { r, g, b } = this.accentColor;\r\n\r\n        const brightness = (r + g + b) / 3;\r\n        const useHueCycle = brightness < 50;\r\n        const rotation = this.frame * 0.003;\r\n\r\n        ctx.save();\r\n        ctx.translate(centerX, centerY);\r\n        ctx.rotate(rotation);\r\n\r\n        for (let i = 0; i < rings; i++) {\r\n            const phase = ((this.frame * 0.5 + i * (maxRadius / rings)) % maxRadius) / maxRadius;\r\n            const radius = phase * maxRadius;\r\n            const alpha = 1 - phase;\r\n\r\n            if (alpha <= 0.05) continue;\r\n\r\n            ctx.beginPath();\r\n            ctx.arc(0, 0, radius, 0, Math.PI * 2);\r\n\r\n            if (useHueCycle) {\r\n                const hue = (this.frame * 0.3 + i * 25) % 360;\r\n                ctx.strokeStyle = `hsla(${hue}, 100%, 70%, ${alpha * 0.7})`;\r\n                ctx.shadowColor = `hsla(${hue}, 100%, 70%, ${alpha * 0.3})`;\r\n            } else {\r\n                ctx.strokeStyle = `rgba(${r}, ${g}, ${b}, ${alpha * 0.7})`;\r\n                ctx.shadowColor = `rgba(${r}, ${g}, ${b}, ${alpha * 0.3})`;\r\n            }\r\n\r\n            ctx.shadowBlur = 6;\r\n            ctx.lineWidth = 2 + (1 - phase) * 2;\r\n            ctx.stroke();\r\n        }\r\n\r\n        ctx.restore();\r\n        ctx.shadowBlur = 0;\r\n    },\r\n\r\n    /**\r\n     * Build the HypnoDisc DOM tree as nested Mithril vnodes.\r\n     * Each level gets its own CSS spin animation; nesting compounds the rotation,\r\n     * producing the moir spiral illusion from the reference spiral.html/css.\r\n     * @param {boolean} active - Whether hypnoDisc is the current effect\r\n     * @returns {Object} Mithril vnode\r\n     * @private\r\n     */\r\n    _renderHypnoDiscDOM(active) {\r\n        const totalRings = 50;\r\n        const { r, g, b } = this.accentColor;\r\n\r\n        // Build from innermost (current=totalRings) to outermost (current=1)\r\n        let inner = m('div', { style: { minWidth: '7px', minHeight: '7px' } });\r\n\r\n        for (let current = totalRings; current >= 1; current--) {\r\n            const rank = (totalRings + 1) - current;\r\n            const isEven = rank % 2 === 0;\r\n            const percentage = rank / totalRings;\r\n            const invertPct = 1 - percentage;\r\n            const opacity = Math.min(1, invertPct + 0.3);\r\n            const borderW = Math.max(0.5, 7 * percentage);\r\n\r\n            const color = isEven\r\n                ? 'rgba(' + r + ',' + g + ',' + b + ',' + opacity + ')'\r\n                : 'rgba(' + (255 - r) + ',' + (255 - g) + ',' + (255 - b) + ',' + (opacity * 0.7) + ')';\r\n\r\n            inner = m('div', {\r\n                style: {\r\n                    minWidth: '7px',\r\n                    minHeight: '7px',\r\n                    boxSizing: 'border-box',\r\n                    padding: '3.5px',\r\n                    borderRadius: '100%',\r\n                    borderTop: borderW + 'px solid ' + color,\r\n                    borderBottom: borderW + 'px solid ' + color,\r\n                    animation: 'spin 60s infinite linear'\r\n                }\r\n            }, inner);\r\n        }\r\n\r\n        // Scale up so the disc fills ~90% of the viewport height\r\n        const scale = Math.max(1, Math.min(window.innerWidth, window.innerHeight) / 400);\r\n\r\n        return m('.absolute.inset-0.flex.items-center.justify-center.overflow-hidden', {\r\n            style: {\r\n                opacity: active ? 1 : 0,\r\n                transition: 'opacity 2s ease'\r\n            }\r\n        }, m('div', { style: { transform: 'scale(' + scale.toFixed(2) + ')' } }, inner));\r\n    },\r\n\r\n    /**\r\n     * Animation loop  handles single, combined, and transition modes\r\n     */\r\n    animate() {\r\n        if (!this.ctx || !this.canvas) return;\r\n\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        this.frame++;\r\n\r\n        // Check for active cross-fade transition\r\n        const isTransitioning = this.prevEffectMode &&\r\n            (Date.now() - this.transitionStart) < this.transitionDuration;\r\n\r\n        if (isTransitioning) {\r\n            const progress = (Date.now() - this.transitionStart) / this.transitionDuration;\r\n\r\n            // Draw previous effect fading out\r\n            this.ctx.save();\r\n            this.ctx.globalAlpha = 1 - progress;\r\n            this._drawEffect(this.prevEffectMode);\r\n            this.ctx.restore();\r\n\r\n            // Draw new effect fading in\r\n            this.ctx.save();\r\n            this.ctx.globalAlpha = progress;\r\n            this._drawEffect(this.effectMode);\r\n            this.ctx.restore();\r\n\r\n            if (progress >= 1) {\r\n                this.prevEffectMode = null;\r\n            }\r\n        } else if (!this.effectMode) {\r\n            // No effect selected  canvas stays clear (director can still enable dynamically)\r\n        } else if (this.effectMode === 'combined' && this.effects.length > 0) {\r\n            // Combined mode: layer all active effects\r\n            const alpha = 1 / this.effects.length;\r\n            for (const effect of this.effects) {\r\n                this.ctx.save();\r\n                this.ctx.globalAlpha = alpha;\r\n                this._drawEffect(effect);\r\n                this.ctx.restore();\r\n            }\r\n        } else {\r\n            this._drawEffect(this.effectMode);\r\n        }\r\n\r\n        this.animationFrame = requestAnimationFrame(() => this.animate());\r\n    },\r\n\r\n    /**\r\n     * Stop animation\r\n     */\r\n    stopAnimation() {\r\n        if (this.animationFrame) {\r\n            cancelAnimationFrame(this.animationFrame);\r\n            this.animationFrame = null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Resume animation\r\n     */\r\n    resumeAnimation() {\r\n        if (!this.animationFrame && this.isInitialized) {\r\n            this.animate();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Clean up resources\r\n     */\r\n    cleanup() {\r\n        this.stopAnimation();\r\n        this._stopCycling();\r\n        this.particles = [];\r\n        this.canvas = null;\r\n        this.ctx = null;\r\n        this.isInitialized = false;\r\n        this.frame = 0;\r\n        this.prevEffectMode = null;\r\n    },\r\n\r\n    // Mithril lifecycle hooks\r\n    oninit(vnode) {\r\n        this._resizeHandler = () => this.resizeCanvas();\r\n        window.addEventListener('resize', this._resizeHandler);\r\n    },\r\n\r\n    oncreate(vnode) {\r\n        const canvas = vnode.dom.querySelector('canvas');\r\n        this.setupCanvas(canvas);\r\n\r\n        if (vnode.attrs.theme) {\r\n            this.updateTheme(vnode.attrs.theme);\r\n        }\r\n        if (vnode.attrs.visuals) {\r\n            this.applyVisuals(vnode.attrs.visuals);\r\n        }\r\n    },\r\n\r\n    onupdate(vnode) {\r\n        if (vnode.attrs.theme) {\r\n            this.updateTheme(vnode.attrs.theme);\r\n        }\r\n        if (vnode.attrs.visuals && vnode.attrs.visuals !== this.visuals) {\r\n            this.applyVisuals(vnode.attrs.visuals);\r\n        }\r\n    },\r\n\r\n    onremove(vnode) {\r\n        window.removeEventListener('resize', this._resizeHandler);\r\n        this.cleanup();\r\n    },\r\n\r\n    view(vnode) {\r\n        const { theme, class: className } = vnode.attrs;\r\n        const showDisc = this.effectMode === 'hypnoDisc' || this.prevEffectMode === 'hypnoDisc';\r\n        const discActive = this.effectMode === 'hypnoDisc';\r\n\r\n        return m('.hypno-wrapper', {\r\n            class: className || 'absolute inset-0 pointer-events-none'\r\n        }, [\r\n            // Canvas for all non-hypnoDisc effects\r\n            m('canvas.hypno-canvas.absolute.inset-0', {\r\n                style: {\r\n                    mixBlendMode: 'screen',\r\n                    opacity: discActive ? 0 : 1,\r\n                    transition: 'opacity 2s ease'\r\n                }\r\n            }),\r\n            // HypnoDisc as nested CSS divs (compound rotation creates the spiral illusion)\r\n            showDisc ? this._renderHypnoDiscDOM(discActive) : null\r\n        ]);\r\n    }\r\n};\r\n\r\n// Factory function to create independent instances\r\nfunction createHypnoCanvas() {\r\n    return {\r\n        ...HypnoCanvas,\r\n        particles: [],\r\n        canvas: null,\r\n        ctx: null,\r\n        animationFrame: null,\r\n        isInitialized: false,\r\n        frame: 0,\r\n        effectMode: null,\r\n        effects: [],\r\n        visuals: null,\r\n        prevEffectMode: null,\r\n        cycleIndex: 0,\r\n        cycleTimer: null,\r\n        particleColor: { r: 150, g: 180, b: 255 },\r\n        accentColor: { r: 150, g: 180, b: 255 }\r\n    };\r\n}\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = { HypnoCanvas, createHypnoCanvas };\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.HypnoCanvas = HypnoCanvas;\r\n    window.Magic8.createHypnoCanvas = createHypnoCanvas;\r\n}\r\n\n\n;/* === client/view/magic8/components/AudioVisualizerOverlay.js === */\n/**\r\n * AudioVisualizerOverlay - Translucent audio frequency visualizer overlay\r\n * Uses AudioMotionAnalyzer to display frequency data from the AudioEngine\r\n * Renders as a screen-blended layer over the visual effects\r\n */\r\nconst AudioVisualizerOverlay = {\r\n    oninit(vnode) {\r\n        this.audioMotion = null;\r\n    },\r\n\r\n    oncreate(vnode) {\r\n        this._createVisualizer(vnode);\r\n    },\r\n\r\n    onupdate(vnode) {\r\n        if (this.audioMotion) {\r\n            const gradient = vnode.attrs.gradient || 'prism';\r\n            const mode = vnode.attrs.mode != null ? vnode.attrs.mode : 2;\r\n\r\n            if (this.audioMotion.gradient !== gradient) {\r\n                try { this.audioMotion.gradient = gradient; } catch (e) { /* gradient may not exist */ }\r\n            }\r\n            if (this.audioMotion.mode !== mode) {\r\n                this.audioMotion.mode = mode;\r\n            }\r\n        }\r\n    },\r\n\r\n    onremove(vnode) {\r\n        if (this.audioMotion) {\r\n            try {\r\n                this.audioMotion.destroy();\r\n            } catch (e) {\r\n                // Ignore cleanup errors\r\n            }\r\n            this.audioMotion = null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Create the AudioMotionAnalyzer instance\r\n     * @param {Object} vnode - Mithril vnode\r\n     * @private\r\n     */\r\n    _createVisualizer(vnode) {\r\n        const audioEngine = vnode.attrs.audioEngine;\r\n        if (!audioEngine) {\r\n            console.warn('AudioVisualizerOverlay: No audioEngine provided');\r\n            return;\r\n        }\r\n\r\n        // Ensure AudioMotionAnalyzer is available\r\n        if (typeof AudioMotionAnalyzer === 'undefined') {\r\n            console.warn('AudioVisualizerOverlay: AudioMotionAnalyzer not loaded yet, retrying...');\r\n            setTimeout(() => this._createVisualizer(vnode), 500);\r\n            return;\r\n        }\r\n\r\n        const container = vnode.dom;\r\n        if (!container) return;\r\n\r\n        try {\r\n            const ctx = audioEngine.getContext();\r\n\r\n            this.audioMotion = new AudioMotionAnalyzer(container, {\r\n                audioCtx: ctx,\r\n                connectSpeakers: false,\r\n                overlay: true,\r\n                bgAlpha: 0,\r\n                showBgColor: false,\r\n                showScaleY: false,\r\n                showScaleX: false,\r\n                gradient: vnode.attrs.gradient || 'prism',\r\n                mode: vnode.attrs.mode != null ? vnode.attrs.mode : 2,\r\n                reflexRatio: 0.3,\r\n                showPeaks: true,\r\n                smoothing: 0.8,\r\n                barSpace: 0.2,\r\n                lumiBars: false\r\n            });\r\n\r\n            // Connect our master audio output to the visualizer's input\r\n            this.audioMotion.connectInput(audioEngine.masterGain);\r\n\r\n            console.log('AudioVisualizerOverlay: Visualizer created successfully');\r\n        } catch (err) {\r\n            console.error('AudioVisualizerOverlay: Failed to create visualizer:', err);\r\n        }\r\n    },\r\n\r\n    view(vnode) {\r\n        return m('.audio-visualizer-overlay', {\r\n            style: {\r\n                position: 'absolute',\r\n                top: 0,\r\n                left: 0,\r\n                right: 0,\r\n                bottom: 0,\r\n                zIndex: 7,\r\n                opacity: vnode.attrs.opacity || 0.35,\r\n                pointerEvents: 'none',\r\n                mixBlendMode: 'screen'\r\n            }\r\n        });\r\n    }\r\n};\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = AudioVisualizerOverlay;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.AudioVisualizerOverlay = AudioVisualizerOverlay;\r\n}\r\n\n\n;/* === client/view/magic8/components/HypnoticTextDisplay.js === */\n/**\r\n * HypnoticTextDisplay - Fading text overlay for hypnotic sequences\r\n * Mithril.js component for displaying scripted text with fade transitions\r\n */\r\nconst HypnoticTextDisplay = {\r\n    oninit(vnode) {\r\n        this.opacity = 0;\r\n        this.currentText = '';\r\n        this.displayText = '';\r\n        this.isTransitioning = false;\r\n        this.transitionTimeout = null;\r\n        this._glowPhase = 0;\r\n        this._glowRafId = null;\r\n    },\r\n\r\n    oncreate(vnode) {\r\n        // Continuous subtle glow breathing on the center text (~10fps to stay light)\r\n        this._lastGlowRedraw = 0;\r\n        const animateGlow = () => {\r\n            this._glowPhase = (Date.now() % 6000) / 6000;\r\n            const now = Date.now();\r\n            if (now - this._lastGlowRedraw >= 100) {\r\n                this._lastGlowRedraw = now;\r\n                m.redraw();\r\n            }\r\n            this._glowRafId = requestAnimationFrame(animateGlow);\r\n        };\r\n        this._glowRafId = requestAnimationFrame(animateGlow);\r\n    },\r\n\r\n    onupdate(vnode) {\r\n        const { text } = vnode.attrs;\r\n\r\n        // Handle text change with fade transition\r\n        if (text !== this.currentText) {\r\n            this.currentText = text;\r\n            this._fadeToText(text);\r\n        }\r\n    },\r\n\r\n    onremove(vnode) {\r\n        if (this.transitionTimeout) {\r\n            clearTimeout(this.transitionTimeout);\r\n        }\r\n        if (this._glowRafId) {\r\n            cancelAnimationFrame(this._glowRafId);\r\n            this._glowRafId = null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Fade out current text and fade in new text\r\n     * @param {string} newText - Text to display\r\n     * @private\r\n     */\r\n    _fadeToText(newText) {\r\n        if (this.isTransitioning) {\r\n            clearTimeout(this.transitionTimeout);\r\n        }\r\n\r\n        this.isTransitioning = true;\r\n\r\n        // Fade out\r\n        this.opacity = 0;\r\n        m.redraw();\r\n\r\n        // After fade out, change text and fade in\r\n        this.transitionTimeout = setTimeout(() => {\r\n            this.displayText = newText;\r\n            this.opacity = 1;\r\n            this.isTransitioning = false;\r\n            m.redraw();\r\n        }, 500); // Half of transition duration\r\n    },\r\n\r\n    view(vnode) {\r\n        const {\r\n            theme,\r\n            fontSize = 'text-4xl md:text-6xl',\r\n            fontFamily = \"'Playfair Display', Georgia, serif\",\r\n            textAlign = 'center',\r\n            padding = 'px-8'\r\n        } = vnode.attrs;\r\n\r\n        // Get colors from theme or defaults\r\n        const accentColor = theme?.accent\r\n            ? `rgb(${theme.accent.join(',')})`\r\n            : 'rgb(255, 255, 255)';\r\n\r\n        const glowColor = theme?.glow\r\n            ? `rgb(${theme.glow.join(',')})`\r\n            : 'rgb(255, 255, 255)';\r\n\r\n        // Subtle breathing glow: oscillate text-shadow radii\r\n        const glowWave = 0.5 + 0.5 * Math.sin(this._glowPhase * Math.PI * 2);\r\n        const r1 = Math.round(20 + 20 * glowWave);\r\n        const r2 = Math.round(40 + 30 * glowWave);\r\n        const r3 = Math.round(60 + 40 * glowWave);\r\n\r\n        return m('.hypnotic-text-container', {\r\n            class: 'absolute inset-0 flex items-center justify-center pointer-events-none z-20'\r\n        }, [\r\n            m('.hypnotic-text', {\r\n                class: `${fontSize} font-light ${textAlign} ${padding} transition-opacity duration-500`,\r\n                style: {\r\n                    opacity: this.opacity,\r\n                    color: accentColor,\r\n                    textShadow: `\r\n                        0 0 ${r1}px ${glowColor},\r\n                        0 0 ${r2}px ${glowColor},\r\n                        0 0 ${r3}px ${glowColor}\r\n                    `,\r\n                    fontFamily: fontFamily,\r\n                    letterSpacing: '0.05em',\r\n                    lineHeight: '1.4',\r\n                    maxWidth: '80%'\r\n                }\r\n            }, this.displayText)\r\n        ]);\r\n    }\r\n};\r\n\r\n/**\r\n * Factory function to create independent instances\r\n * @returns {Object} New HypnoticTextDisplay instance\r\n */\r\nfunction createHypnoticTextDisplay() {\r\n    return {\r\n        oninit(vnode) {\r\n            this.opacity = 0;\r\n            this.currentText = '';\r\n            this.displayText = '';\r\n            this.isTransitioning = false;\r\n            this.transitionTimeout = null;\r\n            this._glowPhase = 0;\r\n            this._glowRafId = null;\r\n        },\r\n\r\n        oncreate(vnode) {\r\n            this._lastGlowRedraw = 0;\r\n            const animateGlow = () => {\r\n                this._glowPhase = (Date.now() % 6000) / 6000;\r\n                const now = Date.now();\r\n                if (now - this._lastGlowRedraw >= 100) {\r\n                    this._lastGlowRedraw = now;\r\n                    m.redraw();\r\n                }\r\n                this._glowRafId = requestAnimationFrame(animateGlow);\r\n            };\r\n            this._glowRafId = requestAnimationFrame(animateGlow);\r\n        },\r\n\r\n        onupdate(vnode) {\r\n            const { text } = vnode.attrs;\r\n\r\n            if (text !== this.currentText) {\r\n                this.currentText = text;\r\n                this._fadeToText(text);\r\n            }\r\n        },\r\n\r\n        onremove(vnode) {\r\n            if (this.transitionTimeout) {\r\n                clearTimeout(this.transitionTimeout);\r\n            }\r\n            if (this._glowRafId) {\r\n                cancelAnimationFrame(this._glowRafId);\r\n                this._glowRafId = null;\r\n            }\r\n        },\r\n\r\n        _fadeToText(newText) {\r\n            if (this.isTransitioning) {\r\n                clearTimeout(this.transitionTimeout);\r\n            }\r\n\r\n            this.isTransitioning = true;\r\n            this.opacity = 0;\r\n            m.redraw();\r\n\r\n            this.transitionTimeout = setTimeout(() => {\r\n                this.displayText = newText;\r\n                this.opacity = 1;\r\n                this.isTransitioning = false;\r\n                m.redraw();\r\n            }, 500);\r\n        },\r\n\r\n        view: HypnoticTextDisplay.view\r\n    };\r\n}\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = { HypnoticTextDisplay, createHypnoticTextDisplay };\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.HypnoticTextDisplay = HypnoticTextDisplay;\r\n    window.Magic8.createHypnoticTextDisplay = createHypnoticTextDisplay;\r\n}\r\n\n\n;/* === client/view/magic8/components/ControlPanel.js === */\n/**\r\n * ControlPanel - Floating controls with auto-hide behavior\r\n * Mithril.js component for Magic8 session controls\r\n */\r\nconst ControlPanel = {\r\n    oninit(vnode) {\r\n        this.isVisible = true;\r\n        this.hideTimeout = null;\r\n        this.autoHideDelay = vnode.attrs.autoHideDelay || 5000;\r\n        this.mouseInside = false;\r\n\r\n        // Mood ring crossfade state\r\n        this._moodEmotion = 'neutral';\r\n        this._moodGender = null;\r\n        this._moodOpacity = 1;\r\n        this._moodLlmGlow = false;\r\n        this._moodFadeTimeout = null;\r\n\r\n        // Start auto-hide timer\r\n        this._scheduleHide();\r\n    },\r\n\r\n    oncreate(vnode) {\r\n        // Track mouse movement to show panel\r\n        this._mouseMoveHandler = (e) => {\r\n            // Show panel on mouse move near bottom of screen\r\n            const threshold = window.innerHeight * 0.8;\r\n            if (e.clientY > threshold || this.mouseInside) {\r\n                this._showPanel();\r\n            }\r\n        };\r\n\r\n        document.addEventListener('mousemove', this._mouseMoveHandler);\r\n\r\n        // Track touch for mobile\r\n        this._touchHandler = () => {\r\n            this._showPanel();\r\n        };\r\n        document.addEventListener('touchstart', this._touchHandler);\r\n    },\r\n\r\n    onremove(vnode) {\r\n        if (this.hideTimeout) {\r\n            clearTimeout(this.hideTimeout);\r\n        }\r\n        if (this._moodFadeTimeout) {\r\n            clearTimeout(this._moodFadeTimeout);\r\n        }\r\n        document.removeEventListener('mousemove', this._mouseMoveHandler);\r\n        document.removeEventListener('touchstart', this._touchHandler);\r\n    },\r\n\r\n    /**\r\n     * Crossfade mood emoji: fade out  swap displayed values  fade in\r\n     * @private\r\n     */\r\n    _crossfadeMood(targetEmotion, targetGender, isLlm) {\r\n        if (targetEmotion === this._moodEmotion && targetGender === this._moodGender) {\r\n            // Values unchanged, just update glow if needed\r\n            if (isLlm !== this._moodLlmGlow) {\r\n                this._moodLlmGlow = isLlm;\r\n            }\r\n            return;\r\n        }\r\n        if (this._moodOpacity < 1) return; // already mid-fade\r\n\r\n        this._moodOpacity = 0;\r\n        if (this._moodFadeTimeout) clearTimeout(this._moodFadeTimeout);\r\n        this._moodFadeTimeout = setTimeout(() => {\r\n            this._moodEmotion = targetEmotion;\r\n            this._moodGender = targetGender;\r\n            this._moodLlmGlow = isLlm;\r\n            this._moodOpacity = 1;\r\n            m.redraw();\r\n        }, 300);\r\n    },\r\n\r\n    /**\r\n     * Show the control panel\r\n     * @private\r\n     */\r\n    _showPanel() {\r\n        this.isVisible = true;\r\n        this._scheduleHide();\r\n        m.redraw();\r\n    },\r\n\r\n    /**\r\n     * Schedule auto-hide\r\n     * @private\r\n     */\r\n    _scheduleHide() {\r\n        if (this.hideTimeout) {\r\n            clearTimeout(this.hideTimeout);\r\n        }\r\n\r\n        if (this.autoHideDelay > 0 && !this.mouseInside) {\r\n            this.hideTimeout = setTimeout(() => {\r\n                this.isVisible = false;\r\n                m.redraw();\r\n            }, this.autoHideDelay);\r\n        }\r\n    },\r\n\r\n    view(vnode) {\r\n        const {\r\n            config,\r\n            state,\r\n            onToggleRecording,\r\n            onToggleAudio,\r\n            onToggleFullscreen,\r\n            onToggleMoodRing,\r\n            onToggleTestMode,\r\n            onOpenConfig,\r\n            onExit\r\n        } = vnode.attrs;\r\n\r\n        const isRecording = state?.isRecording || false;\r\n        const isAudioEnabled = state?.audioEnabled || false;\r\n        const isFullscreen = state?.isFullscreen || false;\r\n        const isTestMode = state?.testMode || false;\r\n\r\n        return m('.control-panel', {\r\n            class: `\r\n                fixed bottom-0 left-0 right-0 z-50\r\n                flex justify-center items-center gap-3 sm:gap-4 p-4\r\n                bg-gradient-to-t from-black/60 to-transparent\r\n                transition-all duration-300\r\n                ${this.isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-full pointer-events-none'}\r\n            `,\r\n            style: {\r\n                paddingBottom: 'max(16px, env(safe-area-inset-bottom))'\r\n            },\r\n            onmouseenter: () => {\r\n                this.mouseInside = true;\r\n                this._showPanel();\r\n            },\r\n            onmouseleave: () => {\r\n                this.mouseInside = false;\r\n                this._scheduleHide();\r\n            }\r\n        }, [\r\n            // Recording button\r\n            config?.recording?.enabled && m('button.control-btn', {\r\n                class: `\r\n                    flex items-center gap-2 px-4 py-2 rounded-full\r\n                    ${isRecording ? 'bg-red-600 animate-pulse' : 'bg-gray-800/80'}\r\n                    hover:bg-gray-700 transition-colors\r\n                    text-white font-medium\r\n                `,\r\n                onclick: onToggleRecording,\r\n                title: isRecording ? 'Stop Recording' : 'Start Recording'\r\n            }, [\r\n                m('span.material-symbols-outlined', {\r\n                    class: isRecording ? 'text-white' : 'text-red-500'\r\n                }, isRecording ? 'stop_circle' : 'radio_button_checked'),\r\n                m('span.hidden.sm:inline', isRecording ? 'Stop' : 'Record')\r\n            ]),\r\n\r\n            // Audio toggle button\r\n            m('button.control-btn', {\r\n                class: `\r\n                    flex items-center gap-2 px-4 py-2 rounded-full\r\n                    bg-gray-800/80 hover:bg-gray-700 transition-colors\r\n                    text-white font-medium\r\n                `,\r\n                onclick: onToggleAudio,\r\n                title: isAudioEnabled ? 'Disable Audio' : 'Enable Audio'\r\n            }, [\r\n                m('span.material-symbols-outlined',\r\n                    isAudioEnabled ? 'volume_up' : 'volume_off'\r\n                ),\r\n                m('span.hidden.sm:inline', isAudioEnabled ? 'Audio On' : 'Audio Off')\r\n            ]),\r\n\r\n            // Fullscreen toggle\r\n            m('button.control-btn', {\r\n                class: `\r\n                    flex items-center gap-2 px-4 py-2 rounded-full\r\n                    bg-gray-800/80 hover:bg-gray-700 transition-colors\r\n                    text-white font-medium\r\n                `,\r\n                onclick: onToggleFullscreen,\r\n                title: isFullscreen ? 'Exit Fullscreen' : 'Enter Fullscreen'\r\n            }, [\r\n                m('span.material-symbols-outlined',\r\n                    isFullscreen ? 'fullscreen_exit' : 'fullscreen'\r\n                ),\r\n                m('span.hidden.sm:inline', isFullscreen ? 'Exit' : 'Fullscreen')\r\n            ]),\r\n\r\n            // Mood ring toggle button with crossfade animation\r\n            (config?.biometrics?.enabled || config?.director?.enabled) && (() => {\r\n                const BiometricThemer = window.Magic8?.BiometricThemer;\r\n\r\n                // Target values: prefer LLM-suggested over raw biometric\r\n                const targetEmotion = state?.suggestedEmotion || state?.emotion || 'neutral';\r\n                const targetGender = state?.suggestedGender || state?.gender || null;\r\n                const isLlm = !!(state?.suggestedEmotion || state?.suggestedGender);\r\n\r\n                // Trigger crossfade if target changed\r\n                this._crossfadeMood(targetEmotion, targetGender, isLlm);\r\n\r\n                // Render uses displayed (lagged) values for emojis\r\n                const emotionEmoji = BiometricThemer?.emotionEmojis?.[this._moodEmotion] || '\\u{1F610}';\r\n                const genderEmoji = this._moodGender ? (BiometricThemer?.genderEmojis?.[this._moodGender] || '') : '';\r\n\r\n                // Mood-colored background when enabled with color data\r\n                let bgStyle = {};\r\n                if (state?.moodRingEnabled && state?.moodColor) {\r\n                    const [r, g, b] = state.moodColor;\r\n                    bgStyle = {\r\n                        backgroundColor: `rgba(${r}, ${g}, ${b}, 0.6)`,\r\n                        borderColor: `rgba(${r}, ${g}, ${b}, 0.8)`,\r\n                        borderWidth: '2px',\r\n                        borderStyle: 'solid',\r\n                        transition: 'background-color 1s ease-in-out, border-color 1s ease-in-out'\r\n                    };\r\n                }\r\n\r\n                const glowFilter = this._moodLlmGlow\r\n                    ? 'drop-shadow(0 0 6px rgba(255,255,255,0.7))'\r\n                    : 'none';\r\n\r\n                const emojiStyle = {\r\n                    fontSize: '20px',\r\n                    lineHeight: '1',\r\n                    opacity: this._moodOpacity,\r\n                    filter: glowFilter,\r\n                    transition: 'opacity 300ms ease-in-out, filter 0.5s ease'\r\n                };\r\n\r\n                return m('button.control-btn', {\r\n                    class: `\r\n                        flex items-center gap-2 px-4 py-2 rounded-full\r\n                        ${state?.moodRingEnabled && !state?.moodColor ? 'bg-purple-700/80' : ''}\r\n                        ${!state?.moodRingEnabled ? 'bg-gray-800/80' : ''}\r\n                        hover:bg-gray-700 transition-colors\r\n                        text-white font-medium\r\n                    `,\r\n                    style: bgStyle,\r\n                    onclick: onToggleMoodRing,\r\n                    title: state?.moodRingEnabled ? 'Mood Ring: ' + this._moodEmotion + ' (click to disable)' : 'Enable Mood Ring'\r\n                }, [\r\n                    m('span', { style: emojiStyle }, emotionEmoji),\r\n                    genderEmoji && m('span', { style: emojiStyle }, genderEmoji),\r\n                    m('span.hidden.sm:inline', state?.moodRingEnabled ? 'Mood On' : 'Mood Ring')\r\n                ]);\r\n            })(),\r\n\r\n            // Test mode toggle button\r\n            m('button.control-btn', {\r\n                class: `\r\n                    flex items-center gap-2 px-4 py-2 rounded-full\r\n                    ${isTestMode ? 'bg-amber-600/80' : 'bg-gray-800/80'}\r\n                    hover:bg-gray-700 transition-colors\r\n                    text-white font-medium\r\n                `,\r\n                onclick: onToggleTestMode,\r\n                title: isTestMode ? 'Disable Test Mode' : 'Enable Test Mode'\r\n            }, [\r\n                m('span.material-symbols-outlined', 'bug_report'),\r\n                m('span.hidden.sm:inline', isTestMode ? 'Test On' : 'Test')\r\n            ]),\r\n\r\n            // Config button\r\n            m('button.control-btn', {\r\n                class: `\r\n                    flex items-center gap-2 px-4 py-2 rounded-full\r\n                    bg-gray-800/80 hover:bg-gray-700 transition-colors\r\n                    text-white font-medium\r\n                `,\r\n                onclick: onOpenConfig,\r\n                title: 'Session Settings'\r\n            }, [\r\n                m('span.material-symbols-outlined', 'settings'),\r\n                m('span.hidden.sm:inline', 'Config')\r\n            ]),\r\n\r\n            // Spacer\r\n            m('.flex-1'),\r\n\r\n            // Exit button\r\n            m('button.control-btn', {\r\n                class: `\r\n                    flex items-center gap-2 px-4 py-2 rounded-full\r\n                    bg-red-900/80 hover:bg-red-800 transition-colors\r\n                    text-white font-medium\r\n                `,\r\n                onclick: onExit,\r\n                title: 'Exit Magic8'\r\n            }, [\r\n                m('span.material-symbols-outlined', 'close'),\r\n                m('span.hidden.sm:inline', 'Exit')\r\n            ])\r\n        ]);\r\n    }\r\n};\r\n\r\n/**\r\n * RecordingIndicator - Badge showing recording status\r\n */\r\nconst RecordingIndicator = {\r\n    oninit(vnode) {\r\n        this.elapsed = '00:00';\r\n        this.updateInterval = null;\r\n    },\r\n\r\n    oncreate(vnode) {\r\n        if (vnode.attrs.recorder) {\r\n            this.updateInterval = setInterval(() => {\r\n                this.elapsed = vnode.attrs.recorder.getFormattedDuration();\r\n                m.redraw();\r\n            }, 1000);\r\n        }\r\n    },\r\n\r\n    onremove(vnode) {\r\n        if (this.updateInterval) {\r\n            clearInterval(this.updateInterval);\r\n        }\r\n    },\r\n\r\n    view(vnode) {\r\n        const { recorder } = vnode.attrs;\r\n\r\n        if (!recorder || !recorder.isRecording) {\r\n            return null;\r\n        }\r\n\r\n        return m('.recording-indicator', {\r\n            class: `\r\n                fixed left-4 z-50\r\n                flex items-center gap-2 px-3 py-2 rounded-full\r\n                bg-red-600 text-white font-medium\r\n                animate-pulse\r\n            `,\r\n            style: {\r\n                top: 'max(16px, env(safe-area-inset-top))'\r\n            }\r\n        }, [\r\n            m('.w-3.h-3.rounded-full.bg-white.animate-ping'),\r\n            m('span', 'REC'),\r\n            m('span.font-mono', this.elapsed)\r\n        ]);\r\n    }\r\n};\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = { ControlPanel, RecordingIndicator };\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.ControlPanel = ControlPanel;\r\n    window.Magic8.RecordingIndicator = RecordingIndicator;\r\n}\r\n\n\n;/* === client/view/magic8/components/BiometricOverlay.js === */\n/**\r\n * BiometricOverlay - Animated floating text labels styled by biometric theme\r\n * Shows text sequence lines as floating labels with randomized positions and animations.\r\n * Face analysis data drives the color palette applied to labels, not displayed as text.\r\n * Animation types: drift, pulse, scale, float\r\n * Mithril.js component\r\n */\r\nconst BiometricOverlay = {\r\n    oninit(vnode) {\r\n        this.labels = [];\r\n        this.nextId = 0;\r\n        this.lastText = '';\r\n        this._rafId = null;\r\n    },\r\n\r\n    oncreate(vnode) {\r\n        this._startAnimLoop();\r\n    },\r\n\r\n    onremove() {\r\n        this._stopAnimLoop();\r\n        this.labels = [];\r\n    },\r\n\r\n    _startAnimLoop() {\r\n        const tick = () => {\r\n            this._rafId = requestAnimationFrame(tick);\r\n\r\n            const now = Date.now();\r\n            const before = this.labels.length;\r\n            this.labels = this.labels.filter(l => {\r\n                const age = (now - l.born) / 1000;\r\n                return age < l.duration;\r\n            });\r\n\r\n            if (this.labels.length > 0 || before > 0) {\r\n                m.redraw();\r\n            }\r\n        };\r\n        this._rafId = requestAnimationFrame(tick);\r\n    },\r\n\r\n    _stopAnimLoop() {\r\n        if (this._rafId) {\r\n            cancelAnimationFrame(this._rafId);\r\n            this._rafId = null;\r\n        }\r\n    },\r\n\r\n    onupdate(vnode) {\r\n        const { text } = vnode.attrs;\r\n        if (text && text !== this.lastText) {\r\n            this.lastText = text;\r\n\r\n            const now = Date.now();\r\n            const animTypes = ['drift', 'pulse', 'scale', 'float', 'glow', 'breathe', 'swell'];\r\n\r\n            this.labels.push({\r\n                id: this.nextId++,\r\n                text: text,\r\n                x: 5 + Math.random() * 85,\r\n                y: 10 + Math.random() * 75,\r\n                anim: animTypes[Math.floor(Math.random() * animTypes.length)],\r\n                size: 0.7 + Math.random() * 0.6,\r\n                duration: 8 + Math.random() * 10,\r\n                driftX: (Math.random() - 0.5) * 50,\r\n                driftY: (Math.random() - 0.5) * 40,\r\n                born: now\r\n            });\r\n\r\n            // Keep at most 2 labels: the one fading out and the one fading in\r\n            if (this.labels.length > 2) {\r\n                this.labels = this.labels.slice(-2);\r\n            }\r\n        }\r\n    },\r\n\r\n    view(vnode) {\r\n        if (!this.labels.length) return null;\r\n\r\n        const theme = vnode.attrs.theme;\r\n\r\n        // Derive colors from biometric theme\r\n        const accentColor = theme?.accent\r\n            ? `rgb(${theme.accent.join(',')})`\r\n            : 'rgba(255,255,255,0.7)';\r\n        const glowColor = theme?.glow\r\n            ? `rgb(${theme.glow.join(',')})`\r\n            : 'rgba(255,255,255,0.3)';\r\n\r\n        // Filter expired labels before rendering to avoid Mithril key mismatch\r\n        const visibleLabels = this.labels.filter(label => {\r\n            const age = (Date.now() - label.born) / 1000;\r\n            const remaining = label.duration - age;\r\n            const fadeOut = remaining < 4 ? Math.max(0, remaining / 4) : 1;\r\n            return Math.min(1, age / 1.5) * fadeOut * 0.45 > 0;\r\n        });\r\n\r\n        if (!visibleLabels.length) return null;\r\n\r\n        const layerOpacity = vnode.attrs.opacity != null ? vnode.attrs.opacity : 1;\r\n\r\n        return m('.biometric-overlay.absolute.inset-0.pointer-events-none.overflow-hidden', {\r\n            style: { zIndex: 15, opacity: layerOpacity }\r\n        }, visibleLabels.map(label => {\r\n            const age = (Date.now() - label.born) / 1000;\r\n            const fadeIn = Math.min(1, age / 1.5);\r\n            const remaining = label.duration - age;\r\n            const fadeOut = remaining < 4 ? Math.max(0, remaining / 4) : 1;\r\n            const opacity = fadeIn * fadeOut * 0.45;\r\n\r\n            const style = {\r\n                position: 'absolute',\r\n                left: label.x + '%',\r\n                top: label.y + '%',\r\n                opacity: opacity,\r\n                fontSize: (label.size * 5) + 'rem',\r\n                fontFamily: \"'Playfair Display', Georgia, serif\",\r\n                letterSpacing: '0.05em',\r\n                lineHeight: '1.4',\r\n                maxWidth: '40%',\r\n                color: accentColor,\r\n                textShadow: `0 0 12px ${glowColor}, 0 0 24px ${glowColor}`,\r\n                willChange: 'transform, opacity'\r\n            };\r\n\r\n            if (label.anim === 'drift') {\r\n                const progress = age / label.duration;\r\n                style.transform = `translate(${label.driftX * progress}px, ${label.driftY * progress}px)`;\r\n            } else if (label.anim === 'pulse') {\r\n                const pulse = 0.5 + 0.5 * Math.sin(age * 1.5);\r\n                style.opacity = opacity * (0.3 + pulse * 0.7);\r\n            } else if (label.anim === 'scale') {\r\n                const scale = 0.8 + 0.4 * Math.sin(age * 0.8);\r\n                style.transform = `scale(${scale})`;\r\n            } else if (label.anim === 'float') {\r\n                const bobY = Math.sin(age * 0.6) * 12;\r\n                const bobX = Math.cos(age * 0.4) * 6;\r\n                style.transform = `translate(${bobX}px, ${bobY}px)`;\r\n            } else if (label.anim === 'glow') {\r\n                // Pulsing text-shadow intensity  glow swells and dims\r\n                const glowPulse = 0.4 + 0.6 * (0.5 + 0.5 * Math.sin(age * 1.2));\r\n                const r1 = Math.round(12 + 28 * glowPulse);\r\n                const r2 = Math.round(24 + 56 * glowPulse);\r\n                const r3 = Math.round(0 + 40 * glowPulse);\r\n                style.textShadow = `0 0 ${r1}px ${glowColor}, 0 0 ${r2}px ${glowColor}, 0 0 ${r3}px ${accentColor}`;\r\n            } else if (label.anim === 'breathe') {\r\n                // Slow inhale/exhale rhythm  opacity and slight vertical drift\r\n                const breath = 0.5 + 0.5 * Math.sin(age * 0.45);\r\n                style.opacity = opacity * (0.25 + breath * 0.75);\r\n                style.transform = `translateY(${breath * -6}px)`;\r\n            } else if (label.anim === 'swell') {\r\n                // Combined gentle scale swell with opacity wave\r\n                const wave = 0.5 + 0.5 * Math.sin(age * 0.7);\r\n                style.transform = `scale(${0.9 + 0.2 * wave})`;\r\n                style.opacity = opacity * (0.4 + wave * 0.6);\r\n                style.letterSpacing = (0.05 + 0.04 * wave) + 'em';\r\n            }\r\n\r\n            return m('.bio-label', { key: label.id, style: style }, label.text);\r\n        }));\r\n    }\r\n};\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = BiometricOverlay;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.BiometricOverlay = BiometricOverlay;\r\n}\r\n\n\n;/* === client/view/magic8/components/SessionConfigEditor.js === */\n/**\r\n * SessionConfigEditor - Configuration UI for Magic8 sessions\r\n * Mithril.js component for setting up session parameters\r\n */\r\nconst SessionConfigEditor = {\r\n    oninit(vnode) {\r\n        this.config = vnode.attrs.config || this._getDefaultConfig();\r\n        this.sdConfigs = [];\r\n        this.textSources = [];\r\n        this.savedSessions = [];\r\n        this.selectedImageGroups = [];\r\n        this.isLoading = true;\r\n        this.createNewSdConfig = false;\r\n        this.createNewTextSource = false;\r\n        this.newTextName = '';\r\n        this.newTextContent = '';\r\n        this.newTextSourceType = 'note';\r\n        this.voiceSources = [];\r\n        this.voiceProfiles = [];\r\n        this.createNewVoiceSource = false;\r\n        this.newVoiceName = '';\r\n        this.newVoiceContent = '';\r\n        this.newVoiceSourceType = 'note';\r\n        this.isSaving = false;\r\n        this.loadingSession = false;\r\n        this.directorTestRunning = false;\r\n        this.directorTestResults = null;\r\n        this.selectedSdDetails = null;\r\n        this.loadingSdDetails = false;\r\n        this.fetchingRandomSd = false;\r\n        this.randomSdExtras = null;  // style-specific fields from randomImageConfig\r\n        this.sdModelList = ['juggernautXL_ragnarokBy.safetensors','dreamshaperXL_v21TurboDPMSDE','chilloutmix_Ni','realismFromHadesXL_lightningV3','realmixXL_V10.safetensors','lustifySDXLNSFW_endgame.safetensors','ponyRealism_V22.safetensors','sdXL_v10VAEFix'];\r\n\r\n        this._loadOptions();\r\n    },\r\n\r\n    /**\r\n     * Get default session configuration\r\n     * @returns {Object}\r\n     * @private\r\n     */\r\n    _getDefaultConfig() {\r\n        return {\r\n            name: 'New Session',\r\n            display: {\r\n                fullscreen: false,\r\n                showControls: true,\r\n                controlsAutoHide: 5000\r\n            },\r\n            biometrics: {\r\n                enabled: true,\r\n                captureInterval: 5,\r\n                updateInterval: 500,\r\n                smoothingFactor: 0.1\r\n            },\r\n            audio: {\r\n                binauralEnabled: true,\r\n                baseFreq: 440,\r\n                minBeat: 2,\r\n                maxBeat: 8,\r\n                sweepStart: 8,\r\n                sweepTrough: 2,\r\n                sweepEnd: 8,\r\n                sweepDurationMin: 5,\r\n                fadeInSec: 2,\r\n                fadeOutSec: 3,\r\n                panEnabled: false,\r\n                panSpeed: 0.1,\r\n                panDepth: 0.8,\r\n                isochronicEnabled: false,\r\n                isochronicFreq: 200,\r\n                isochronicRate: 6,\r\n                isochronicVolume: 0.15,\r\n                visualizerEnabled: false,\r\n                visualizerOpacity: 0.35,\r\n                visualizerMode: 2,\r\n                visualizerGradient: 'prism'\r\n            },\r\n            images: {\r\n                baseGroups: [],\r\n                cycleInterval: 5000,\r\n                crossfadeDuration: 1000,\r\n                includeGenerated: true\r\n            },\r\n            visuals: {\r\n                effects: [],\r\n                mode: 'single',\r\n                transitionInterval: 30000,\r\n                transitionDuration: 2000,\r\n                particleCount: 100,\r\n                spiralSpeed: 0.01,\r\n                mandalaLayers: 4,\r\n                tunnelRings: 12\r\n            },\r\n            imageGeneration: {\r\n                enabled: false,\r\n                sdConfigId: null,\r\n                captureInterval: 120000,\r\n                maxGeneratedImages: 20,\r\n                sdInline: {\r\n                    model: '',\r\n                    refinerModel: '',\r\n                    style: 'art',\r\n                    description: 'ethereal dreamlike portrait, soft lighting, mystical atmosphere',\r\n                    imageAction: 'posing in a surreal setting',\r\n                    negativePrompt: 'Washed out colors, illogical, disgusting, bad anatomy, errors, glitches, mistakes, low resolution, pixilated, blurry, out of focus, low res, mutated, distorted, melting, cropped, disproportionate, wonky, low quality, compressed, muddy colors, overexposed, mosaic, rotten, fake, low poly, lacking detail, watermark, malformed, failed, failure, extra fingers, cloned face, missing legs, extra arms, fused fingers, too many fingers, poorly drawn face',\r\n                    denoisingStrength: 0.65,\r\n                    steps: 30,\r\n                    cfg: 7,\r\n                    sampler: 'dpmpp_2m',\r\n                    scheduler: 'Karras',\r\n                    seed: -1,\r\n                    width: 512,\r\n                    height: 512,\r\n                    hires: false,\r\n                    bodyStyle: 'full body',\r\n                    imageSetting: 'random',\r\n                    refinerSteps: 20,\r\n                    refinerScheduler: 'Karras',\r\n                    refinerSampler: 'dpmpp_2m',\r\n                    refinerCfg: 7,\r\n                    refinerMethod: 'PostApply',\r\n                    refinerUpscale: 2,\r\n                    refinerUpscaleMethod: 'pixel-lanczos',\r\n                    refinerControlPercentage: 0.2\r\n                }\r\n            },\r\n            text: {\r\n                enabled: false,\r\n                sourceObjectId: null,\r\n                sourceType: 'note',\r\n                displayDuration: 5000,\r\n                loop: true\r\n            },\r\n            voice: {\r\n                enabled: false,\r\n                sourceObjectId: null,\r\n                sourceType: 'note',\r\n                voiceProfileId: null,\r\n                loop: true\r\n            },\r\n            recording: {\r\n                enabled: false,\r\n                autoStart: true,\r\n                maxDurationMin: 30\r\n            },\r\n            director: {\r\n                enabled: false,\r\n                command: '',\r\n                intervalMs: 60000,\r\n                testMode: false,\r\n                imageTags: '',\r\n                interactive: false\r\n            }\r\n        };\r\n    },\r\n\r\n    /**\r\n     * Load available options from server\r\n     * @private\r\n     */\r\n    async _loadOptions() {\r\n        try {\r\n            // Ensure Magic8 group paths exist\r\n            await page.makePath(\"auth.group\", \"data\", \"~/Magic8/SDConfigs\");\r\n            await page.makePath(\"auth.group\", \"data\", \"~/Magic8/TextSequences\");\r\n            await page.makePath(\"auth.group\", \"data\", \"~/Magic8/Configs\");\r\n            await page.makePath(\"auth.group\", \"data\", \"~/Magic8/VoiceSequences\");\r\n\r\n            // Load saved sessions from ~/Magic8/Configs\r\n            this.savedSessions = await this._listDataInGroup('~/Magic8/Configs');\r\n\r\n            // Load SD configs from ~/Magic8/SDConfigs\r\n            this.sdConfigs = await this._listDataInGroup('~/Magic8/SDConfigs');\r\n\r\n            // Load text sources from notes and data objects\r\n            const notes = await this._listNotesInGroup('~/Magic8/TextSequences');\r\n            const textObjects = await this._listDataInGroup('~/Magic8/TextSequences');\r\n            this.textSources = [\r\n                ...notes.map(n => ({ ...n, sourceType: 'note' })),\r\n                ...textObjects.map(t => ({ ...t, sourceType: 'data' }))\r\n            ];\r\n\r\n            // Load voice sources from ~/Magic8/VoiceSequences\r\n            const voiceNotes = await this._listNotesInGroup('~/Magic8/VoiceSequences');\r\n            const voiceData = await this._listDataInGroup('~/Magic8/VoiceSequences');\r\n            this.voiceSources = [\r\n                ...voiceNotes.map(n => ({ ...n, sourceType: 'note' })),\r\n                ...voiceData.map(t => ({ ...t, sourceType: 'data' }))\r\n            ];\r\n\r\n            // Load voice profiles\r\n            this.voiceProfiles = await this._listVoiceProfiles();\r\n\r\n            // Pre-populate selected image groups from blender working set\r\n            if (page.components.dnd && page.components.dnd.workingSet) {\r\n                const groups = page.components.dnd.workingSet.filter(\r\n                    w => w[am7model.jsonModelKey] === 'auth.group'\r\n                );\r\n                for (const grp of groups) {\r\n                    if (this.config.images.baseGroups.indexOf(grp.objectId) === -1) {\r\n                        this.config.images.baseGroups.push(grp.objectId);\r\n                    }\r\n                    if (!this.selectedImageGroups.find(g => g.objectId === grp.objectId)) {\r\n                        this.selectedImageGroups.push({ id: grp.id, objectId: grp.objectId, name: grp.name });\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Load SD model list from server\r\n            if (typeof am7sd !== \"undefined\" && am7sd.fetchModels) {\r\n                let models = await am7sd.fetchModels();\r\n                if (models && models.length > 0) {\r\n                    this.sdModelList = models;\r\n                }\r\n            }\r\n\r\n            this.isLoading = false;\r\n            m.redraw();\r\n        } catch (err) {\r\n            console.error('SessionConfigEditor: Failed to load options:', err);\r\n            this.isLoading = false;\r\n            m.redraw();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * List data objects in a group path\r\n     * @param {string} groupPath - Group path to list from\r\n     * @returns {Promise<Array>}\r\n     * @private\r\n     */\r\n    async _listDataInGroup(groupPath) {\r\n        try {\r\n            let dir = await page.findObject(\"auth.group\", \"DATA\", groupPath);\r\n            if (!dir || !dir.objectId) return [];\r\n            return await am7client.list(\"data.data\", dir.objectId, null, 0, 0) || [];\r\n        } catch (err) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    /**\r\n     * List notes in a group path\r\n     * @param {string} groupPath - Group path to list from\r\n     * @returns {Promise<Array>}\r\n     * @private\r\n     */\r\n    async _listNotesInGroup(groupPath) {\r\n        try {\r\n            let dir = await page.findObject(\"auth.group\", \"DATA\", groupPath);\r\n            if (!dir || !dir.objectId) return [];\r\n            return await am7client.list(\"data.note\", dir.objectId, null, 0, 0) || [];\r\n        } catch (err) {\r\n            return [];\r\n        }\r\n    },\r\n\r\n    /**\r\n     * List available voice profiles (identity.voice objects)\r\n     * @returns {Promise<Array>}\r\n     * @private\r\n     */\r\n    async _listVoiceProfiles() {\r\n        try {\r\n            let q = am7view.viewQuery(am7model.newInstance(\"identity.voice\"));\r\n            let qr = await page.search(q);\r\n            return qr?.results || [];\r\n        } catch (err) {\r\n            console.warn('SessionConfigEditor: Failed to list voice profiles:', err);\r\n            return [];\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Load full SD config details for preview\r\n     * @param {string} objectId - SD config objectId\r\n     * @private\r\n     */\r\n    async _loadSdConfigDetails(objectId) {\r\n        if (!objectId) {\r\n            this.selectedSdDetails = null;\r\n            return;\r\n        }\r\n        this.loadingSdDetails = true;\r\n        m.redraw();\r\n        try {\r\n            let q = am7view.viewQuery(am7model.newInstance(\"data.data\"));\r\n            q.entity.request.push(\"dataBytesStore\");\r\n            q.field(\"objectId\", objectId);\r\n            let qr = await page.search(q);\r\n            if (qr && qr.results && qr.results.length) {\r\n                am7model.updateListModel(qr.results);\r\n                const obj = qr.results[0];\r\n                if (obj.dataBytesStore && obj.dataBytesStore.length) {\r\n                    this.selectedSdDetails = JSON.parse(uwm.base64Decode(obj.dataBytesStore));\r\n                } else {\r\n                    this.selectedSdDetails = null;\r\n                }\r\n            } else {\r\n                this.selectedSdDetails = null;\r\n            }\r\n        } catch (err) {\r\n            console.warn('SessionConfigEditor: Failed to load SD config details:', err);\r\n            this.selectedSdDetails = null;\r\n        }\r\n        this.loadingSdDetails = false;\r\n        m.redraw();\r\n    },\r\n\r\n    /**\r\n     * Fetch a randomized SD config from the server and populate inline fields.\r\n     * Style-specific fields (camera, artStyle, etc.) are stored in randomSdExtras\r\n     * and passed through to the generation config.\r\n     * @private\r\n     */\r\n    async _fetchRandomSdConfig() {\r\n        this.fetchingRandomSd = true;\r\n        m.redraw();\r\n        try {\r\n            const cfg = await m.request({\r\n                method: 'GET',\r\n                url: `${g_application_path}/rest/olio/randomImageConfig`,\r\n                withCredentials: true\r\n            });\r\n            if (cfg) {\r\n                const sd = this.config.imageGeneration.sdInline;\r\n                // Map core fields into inline config\r\n                if (cfg.style) sd.style = cfg.style;\r\n                if (cfg.description) sd.description = cfg.description;\r\n                if (cfg.imageAction) sd.imageAction = cfg.imageAction;\r\n                if (cfg.model) sd.model = cfg.model;\r\n                if (cfg.refinerModel) sd.refinerModel = cfg.refinerModel;\r\n                if (cfg.sampler) sd.sampler = cfg.sampler;\r\n                if (cfg.steps) sd.steps = cfg.steps;\r\n                if (cfg.cfg) sd.cfg = cfg.cfg;\r\n                if (cfg.denoisingStrength) sd.denoisingStrength = cfg.denoisingStrength;\r\n                if (cfg.width) sd.width = cfg.width;\r\n                if (cfg.height) sd.height = cfg.height;\r\n\r\n                // Collect style-specific fields for preview and passthrough\r\n                const coreKeys = new Set([\r\n                    'schema', 'objectId', 'id', 'ownerId', 'groupId', 'groupPath', 'organizationId',\r\n                    'name', 'description', 'imageAction', 'model', 'refinerModel', 'sampler',\r\n                    'scheduler', 'refinerSampler', 'refinerScheduler', 'steps', 'refinerSteps',\r\n                    'cfg', 'refinerCfg', 'seed', 'width', 'height', 'denoisingStrength',\r\n                    'style', 'imageCount', 'hires', 'refinerMethod', 'refinerUpscaleMethod',\r\n                    'refinerUpscale', 'refinerControlPercentage', 'bodyStyle', 'customPrompt',\r\n                    'shared', 'referenceImageId', 'imageSetting', 'contentType', 'compressionType'\r\n                ]);\r\n                const extras = {};\r\n                for (const [key, value] of Object.entries(cfg)) {\r\n                    if (!coreKeys.has(key) && value != null && value !== '') {\r\n                        extras[key] = value;\r\n                    }\r\n                }\r\n                this.randomSdExtras = Object.keys(extras).length > 0 ? extras : null;\r\n\r\n                // Merge style-specific fields into sdInline so they pass through to generation\r\n                if (this.randomSdExtras) {\r\n                    Object.assign(sd, this.randomSdExtras);\r\n                }\r\n\r\n                console.log('SessionConfigEditor: Fetched random SD config, style:', cfg.style,\r\n                    'extras:', this.randomSdExtras);\r\n            }\r\n        } catch (err) {\r\n            console.warn('SessionConfigEditor: Failed to fetch random SD config:', err);\r\n        }\r\n        this.fetchingRandomSd = false;\r\n        m.redraw();\r\n    },\r\n\r\n    /**\r\n     * Save a new voice source object and select it\r\n     * @private\r\n     */\r\n    async _saveNewVoiceSource() {\r\n        if (this.isSaving || !this.newVoiceName.trim() || !this.newVoiceContent.trim()) return;\r\n        this.isSaving = true;\r\n        m.redraw();\r\n\r\n        try {\r\n            let dir = await page.findObject(\"auth.group\", \"DATA\", \"~/Magic8/VoiceSequences\");\r\n            if (!dir || !dir.objectId) {\r\n                dir = await page.makePath(\"auth.group\", \"data\", \"~/Magic8/VoiceSequences\");\r\n            }\r\n\r\n            let saved;\r\n            if (this.newVoiceSourceType === 'note') {\r\n                let obj = am7model.newPrimitive(\"data.note\");\r\n                obj.name = this.newVoiceName.trim();\r\n                obj.groupId = dir.id;\r\n                obj.groupPath = dir.path;\r\n                obj.text = this.newVoiceContent.trim();\r\n                saved = await page.createObject(obj);\r\n            } else {\r\n                let obj = am7model.newPrimitive(\"data.data\");\r\n                obj.name = this.newVoiceName.trim();\r\n                obj.contentType = \"text/plain\";\r\n                obj.compressionType = \"none\";\r\n                obj.groupId = dir.id;\r\n                obj.groupPath = dir.path;\r\n                obj.dataBytesStore = uwm.base64Encode(this.newVoiceContent.trim());\r\n                saved = await page.createObject(obj);\r\n            }\r\n\r\n            if (saved && saved.objectId) {\r\n                this.voiceSources.push({ ...saved, sourceType: this.newVoiceSourceType });\r\n                this.config.voice.sourceObjectId = saved.objectId;\r\n                this.config.voice.sourceType = this.newVoiceSourceType;\r\n                this.createNewVoiceSource = false;\r\n                this.newVoiceName = '';\r\n                this.newVoiceContent = '';\r\n            }\r\n        } catch (err) {\r\n            console.error('SessionConfigEditor: Failed to save voice source:', err);\r\n        }\r\n\r\n        this.isSaving = false;\r\n        m.redraw();\r\n    },\r\n\r\n    /**\r\n     * Load a previously saved session config by objectId\r\n     * @param {string} objectId\r\n     * @private\r\n     */\r\n    async _loadSavedSession(objectId) {\r\n        if (!objectId) return;\r\n        try {\r\n            // Fetch full object with dataBytesStore\r\n            let q = am7view.viewQuery(am7model.newInstance(\"data.data\"));\r\n            q.entity.request.push(\"dataBytesStore\");\r\n            q.field(\"objectId\", objectId);\r\n            let qr = await page.search(q);\r\n            if (!qr || !qr.results || !qr.results.length) return;\r\n            am7model.updateListModel(qr.results);\r\n            const obj = qr.results[0];\r\n            if (!obj.dataBytesStore || !obj.dataBytesStore.length) {\r\n                console.warn('SessionConfigEditor: Saved session has no data');\r\n                return;\r\n            }\r\n            let decoded = uwm.base64Decode(obj.dataBytesStore);\r\n            // JSON.stringify produces single-line output, so any literal control\r\n            // characters in the decoded string are encode/decode corruption.\r\n            // Re-escape them so JSON.parse doesn't choke.\r\n            decoded = decoded.replace(/[\\x00-\\x1f]/g, (ch) => {\r\n                if (ch === '\\n') return '\\\\n';\r\n                if (ch === '\\r') return '\\\\r';\r\n                if (ch === '\\t') return '\\\\t';\r\n                return '';\r\n            });\r\n            const loaded = JSON.parse(decoded);\r\n            // Merge with defaults to ensure all keys exist\r\n            const defaults = this._getDefaultConfig();\r\n            this.config = Object.assign({}, defaults, loaded);\r\n            this.config.display = Object.assign({}, defaults.display, loaded.display || {});\r\n            this.config.biometrics = Object.assign({}, defaults.biometrics, loaded.biometrics || {});\r\n            this.config.audio = Object.assign({}, defaults.audio, loaded.audio || {});\r\n            this.config.images = Object.assign({}, defaults.images, loaded.images || {});\r\n            this.config.visuals = Object.assign({}, defaults.visuals, loaded.visuals || {});\r\n            if (loaded.visuals?.effects) {\r\n                this.config.visuals.effects = [...loaded.visuals.effects];\r\n            }\r\n            this.config.imageGeneration = Object.assign({}, defaults.imageGeneration, loaded.imageGeneration || {});\r\n            if (loaded.imageGeneration?.sdInline) {\r\n                this.config.imageGeneration.sdInline = Object.assign({}, defaults.imageGeneration.sdInline, loaded.imageGeneration.sdInline);\r\n            }\r\n            // Restore SD config UI mode: if no saved config ID but inline values were customized, show inline editor\r\n            if (!this.config.imageGeneration.sdConfigId && loaded.imageGeneration?.sdInline) {\r\n                this.createNewSdConfig = true;\r\n                this.selectedSdDetails = null;\r\n                // Restore style-specific extras preview from saved sdInline\r\n                const defaultKeys = new Set(Object.keys(defaults.imageGeneration.sdInline));\r\n                const extras = {};\r\n                for (const [key, value] of Object.entries(this.config.imageGeneration.sdInline)) {\r\n                    if (!defaultKeys.has(key) && value != null && value !== '') {\r\n                        extras[key] = value;\r\n                    }\r\n                }\r\n                this.randomSdExtras = Object.keys(extras).length > 0 ? extras : null;\r\n            } else {\r\n                this.createNewSdConfig = false;\r\n                // Load details for the selected config\r\n                if (this.config.imageGeneration.sdConfigId) {\r\n                    this._loadSdConfigDetails(this.config.imageGeneration.sdConfigId);\r\n                }\r\n            }\r\n            this.config.text = Object.assign({}, defaults.text, loaded.text || {});\r\n            this.config.voice = Object.assign({}, defaults.voice, loaded.voice || {});\r\n            this.config.recording = Object.assign({}, defaults.recording, loaded.recording || {});\r\n            this.config.director = Object.assign({}, defaults.director, loaded.director || {});\r\n\r\n            // Rebuild selectedImageGroups from loaded baseGroups\r\n            this.selectedImageGroups = [];\r\n            if (this.config.images.baseGroups?.length > 0) {\r\n                for (const oid of this.config.images.baseGroups) {\r\n                    // Try to find the group name from blender or just show the id\r\n                    let name = oid;\r\n                    if (page.components.dnd && page.components.dnd.workingSet) {\r\n                        const found = page.components.dnd.workingSet.find(w => w.objectId === oid);\r\n                        if (found) name = found.name;\r\n                    }\r\n                    this.selectedImageGroups.push({ objectId: oid, name: name });\r\n                }\r\n            }\r\n\r\n            m.redraw();\r\n        } catch (err) {\r\n            console.error('SessionConfigEditor: Failed to load saved session:', err);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Save inline SD config as a named object and select it\r\n     * @private\r\n     */\r\n    async _saveNewSdConfig() {\r\n        if (this.isSaving) return;\r\n        const sdInline = this.config.imageGeneration.sdInline;\r\n        if (!sdInline) return;\r\n\r\n        this.isSaving = true;\r\n        m.redraw();\r\n\r\n        try {\r\n            let dir = await page.findObject(\"auth.group\", \"DATA\", \"~/Magic8/SDConfigs\");\r\n            if (!dir || !dir.objectId) {\r\n                dir = await page.makePath(\"auth.group\", \"data\", \"~/Magic8/SDConfigs\");\r\n            }\r\n\r\n            let obj = am7model.newPrimitive(\"data.data\");\r\n            obj.name = this.config.name + ' SD Config';\r\n            obj.contentType = \"application/json\";\r\n            obj.compressionType = \"none\";\r\n            obj.groupId = dir.id;\r\n            obj.groupPath = dir.path;\r\n            obj.dataBytesStore = uwm.base64Encode(JSON.stringify(sdInline));\r\n            let saved = await page.createObject(obj);\r\n\r\n            if (saved && saved.objectId) {\r\n                this.sdConfigs.push(saved);\r\n                this.config.imageGeneration.sdConfigId = saved.objectId;\r\n                this.createNewSdConfig = false;\r\n            }\r\n        } catch (err) {\r\n            console.error('SessionConfigEditor: Failed to save SD config:', err);\r\n        }\r\n\r\n        this.isSaving = false;\r\n        m.redraw();\r\n    },\r\n\r\n    /**\r\n     * Save a new text source object and select it\r\n     * @private\r\n     */\r\n    async _saveNewTextSource() {\r\n        if (this.isSaving || !this.newTextName.trim() || !this.newTextContent.trim()) return;\r\n        this.isSaving = true;\r\n        m.redraw();\r\n\r\n        try {\r\n            let dir = await page.findObject(\"auth.group\", \"DATA\", \"~/Magic8/TextSequences\");\r\n            if (!dir || !dir.objectId) {\r\n                dir = await page.makePath(\"auth.group\", \"data\", \"~/Magic8/TextSequences\");\r\n            }\r\n\r\n            let saved;\r\n            if (this.newTextSourceType === 'note') {\r\n                let obj = am7model.newPrimitive(\"data.note\");\r\n                obj.name = this.newTextName.trim();\r\n                obj.groupId = dir.id;\r\n                obj.groupPath = dir.path;\r\n                obj.text = this.newTextContent.trim();\r\n                saved = await page.createObject(obj);\r\n            } else {\r\n                let obj = am7model.newPrimitive(\"data.data\");\r\n                obj.name = this.newTextName.trim();\r\n                obj.contentType = \"text/plain\";\r\n                obj.compressionType = \"none\";\r\n                obj.groupId = dir.id;\r\n                obj.groupPath = dir.path;\r\n                obj.dataBytesStore = uwm.base64Encode(this.newTextContent.trim());\r\n                saved = await page.createObject(obj);\r\n            }\r\n\r\n            if (saved && saved.objectId) {\r\n                // Add to list and select it\r\n                this.textSources.push({ ...saved, sourceType: this.newTextSourceType });\r\n                this.config.text.sourceObjectId = saved.objectId;\r\n                this.config.text.sourceType = this.newTextSourceType;\r\n                // Switch back to select mode\r\n                this.createNewTextSource = false;\r\n                this.newTextName = '';\r\n                this.newTextContent = '';\r\n            }\r\n        } catch (err) {\r\n            console.error('SessionConfigEditor: Failed to save text source:', err);\r\n        }\r\n\r\n        this.isSaving = false;\r\n        m.redraw();\r\n    },\r\n\r\n    view(vnode) {\r\n        const { onSave, onCancel } = vnode.attrs;\r\n\r\n        if (this.isLoading) {\r\n            return m('.session-config-editor', {\r\n                class: 'flex items-center justify-center h-screen bg-gray-900 text-white'\r\n            }, [\r\n                m('.text-center', [\r\n                    m('.animate-spin.w-8.h-8.border-4.border-blue-500.border-t-transparent.rounded-full.mx-auto.mb-4'),\r\n                    m('p', 'Loading configuration options...')\r\n                ])\r\n            ]);\r\n        }\r\n\r\n        return m('.session-config-editor', {\r\n            class: 'min-h-screen bg-gray-900 text-white p-4 sm:p-6 overflow-auto',\r\n            style: {\r\n                paddingBottom: 'max(24px, env(safe-area-inset-bottom))'\r\n            }\r\n        }, [\r\n            m('.max-w-2xl.mx-auto', [\r\n                // Header\r\n                m('.text-center.mb-8', [\r\n                    m('h1.text-3xl.font-bold.mb-2', 'Magic8 Session'),\r\n                    m('p.text-gray-400', 'Configure your immersive experience')\r\n                ]),\r\n\r\n                // Load Saved Session\r\n                this.savedSessions.length > 0 && m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-3', 'Load Saved Session'),\r\n                    m('select.w-full.p-3.bg-gray-700.rounded-lg.text-white', {\r\n                        disabled: this.loadingSession,\r\n                        onchange: async (e) => {\r\n                            const objectId = e.target.value;\r\n                            if (!objectId) return;\r\n                            this.loadingSession = true;\r\n                            m.redraw();\r\n                            await this._loadSavedSession(objectId);\r\n                            this.loadingSession = false;\r\n                            m.redraw();\r\n                        }\r\n                    }, [\r\n                        m('option', { value: '', selected: true }, this.loadingSession ? 'Loading...' : '-- Select a saved session --'),\r\n                        ...this.savedSessions.map(s =>\r\n                            m('option', { value: s.objectId }, s.name)\r\n                        )\r\n                    ])\r\n                ]),\r\n\r\n                // Session Name\r\n                m('.config-section.mb-6', [\r\n                    m('label.block.text-sm.font-medium.mb-2', 'Session Name'),\r\n                    m('input.w-full.p-3.bg-gray-800.rounded-lg.text-white', {\r\n                        type: 'text',\r\n                        value: this.config.name,\r\n                        oninput: (e) => this.config.name = e.target.value\r\n                    })\r\n                ]),\r\n\r\n                // Biometrics Section\r\n                m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-4', 'Biometric Adaptation'),\r\n                    m('label.flex.items-center.gap-3.cursor-pointer', [\r\n                        m('input.w-5.h-5.rounded', {\r\n                            type: 'checkbox',\r\n                            checked: this.config.biometrics.enabled,\r\n                            onchange: (e) => this.config.biometrics.enabled = e.target.checked\r\n                        }),\r\n                        m('span', 'Enable facial analysis color adaptation')\r\n                    ]),\r\n                    this.config.biometrics.enabled && m('.mt-4', [\r\n                        m('label.block.text-sm.text-gray-400.mb-1', 'Face Scan Interval (seconds)'),\r\n                        m('.flex.items-center.gap-2', [\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 2, max: 30, step: 1,\r\n                                value: this.config.biometrics.captureInterval,\r\n                                oninput: (e) => this.config.biometrics.captureInterval = parseInt(e.target.value)\r\n                            }),\r\n                            m('span.text-sm.w-10.text-right', this.config.biometrics.captureInterval + 's')\r\n                        ])\r\n                    ])\r\n                ]),\r\n\r\n                // Audio Section\r\n                m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-4', 'Audio'),\r\n\r\n                    // Binaural beats\r\n                    m('label.flex.items-center.gap-3.cursor-pointer.mb-4', [\r\n                        m('input.w-5.h-5.rounded', {\r\n                            type: 'checkbox',\r\n                            checked: this.config.audio.binauralEnabled,\r\n                            onchange: (e) => this.config.audio.binauralEnabled = e.target.checked\r\n                        }),\r\n                        m('span', 'Enable binaural beats')\r\n                    ]),\r\n                    this.config.audio.binauralEnabled && m('.ml-8.space-y-4.mb-6', [\r\n                        // Frequency preset selector\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Preset'),\r\n                            m('select.flex-1.bg-gray-700.rounded.p-2.text-sm', {\r\n                                value: this.config.audio.preset || '',\r\n                                onchange: (e) => {\r\n                                    const presetName = e.target.value;\r\n                                    this.config.audio.preset = presetName || null;\r\n                                    if (presetName && Magic8.AudioEngine.FREQUENCY_PRESETS[presetName]) {\r\n                                        const p = Magic8.AudioEngine.FREQUENCY_PRESETS[presetName];\r\n                                        const bands = Magic8.AudioEngine.BRAINWAVE_BANDS;\r\n                                        this.config.audio.baseFreq = p.baseFreq;\r\n                                        this.config.audio.startBand = p.startBand;\r\n                                        this.config.audio.troughBand = p.troughBand;\r\n                                        this.config.audio.endBand = p.endBand;\r\n                                        this.config.audio.sweepStart = bands[p.startBand]?.mid || 10;\r\n                                        this.config.audio.sweepTrough = bands[p.troughBand]?.mid || 5.5;\r\n                                        this.config.audio.sweepEnd = bands[p.endBand]?.mid || 10;\r\n                                    }\r\n                                }\r\n                            }, [\r\n                                m('option', { value: '' }, '(Custom)'),\r\n                                Object.entries(Magic8.AudioEngine.FREQUENCY_PRESETS).map(([key, p]) =>\r\n                                    m('option', { value: key }, p.label)\r\n                                )\r\n                            ])\r\n                        ]),\r\n                        this.config.audio.preset && Magic8.AudioEngine.FREQUENCY_PRESETS[this.config.audio.preset] &&\r\n                            m('.text-sm.text-gray-400.ml-40', Magic8.AudioEngine.FREQUENCY_PRESETS[this.config.audio.preset].desc),\r\n\r\n                        // Solfeggio carrier frequency selector\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Carrier Frequency'),\r\n                            m('select.flex-1.bg-gray-700.rounded.p-2.text-sm', {\r\n                                value: this.config.audio.baseFreq || 200,\r\n                                onchange: (e) => {\r\n                                    this.config.audio.baseFreq = parseInt(e.target.value);\r\n                                    this.config.audio.preset = null;\r\n                                }\r\n                            }, [\r\n                                Object.entries(Magic8.AudioEngine.SOLFEGGIO_FREQS).map(([freq, info]) =>\r\n                                    m('option', { value: freq }, info.label)\r\n                                ),\r\n                                m('option', { value: 200 }, '200 Hz (Standard)'),\r\n                                m('option', { value: 440 }, '440 Hz (Concert A)')\r\n                            ])\r\n                        ]),\r\n                        Magic8.AudioEngine.SOLFEGGIO_FREQS[this.config.audio.baseFreq] &&\r\n                            m('.text-sm.text-gray-400.ml-40', Magic8.AudioEngine.SOLFEGGIO_FREQS[this.config.audio.baseFreq].desc),\r\n\r\n                        // Brainwave band selectors\r\n                        m('.text-sm.text-gray-400.mb-2', 'Brainwave Band Transitions'),\r\n                        m('.grid.gap-2', { style: 'grid-template-columns: 1fr 1fr 1fr' }, [\r\n                            m('.flex.flex-col.gap-1', [\r\n                                m('label.text-xs.text-gray-500', 'Start Band'),\r\n                                m('select.bg-gray-700.rounded.p-2.text-sm', {\r\n                                    value: this.config.audio.startBand || 'alpha',\r\n                                    onchange: (e) => {\r\n                                        this.config.audio.startBand = e.target.value;\r\n                                        this.config.audio.sweepStart = Magic8.AudioEngine.BRAINWAVE_BANDS[e.target.value]?.mid || 10;\r\n                                        this.config.audio.preset = null;\r\n                                    }\r\n                                }, Object.entries(Magic8.AudioEngine.BRAINWAVE_BANDS).map(([key, b]) =>\r\n                                    m('option', { value: key }, b.label)\r\n                                ))\r\n                            ]),\r\n                            m('.flex.flex-col.gap-1', [\r\n                                m('label.text-xs.text-gray-500', 'Trough Band'),\r\n                                m('select.bg-gray-700.rounded.p-2.text-sm', {\r\n                                    value: this.config.audio.troughBand || 'theta',\r\n                                    onchange: (e) => {\r\n                                        this.config.audio.troughBand = e.target.value;\r\n                                        this.config.audio.sweepTrough = Magic8.AudioEngine.BRAINWAVE_BANDS[e.target.value]?.mid || 5.5;\r\n                                        this.config.audio.preset = null;\r\n                                    }\r\n                                }, Object.entries(Magic8.AudioEngine.BRAINWAVE_BANDS).map(([key, b]) =>\r\n                                    m('option', { value: key }, b.label)\r\n                                ))\r\n                            ]),\r\n                            m('.flex.flex-col.gap-1', [\r\n                                m('label.text-xs.text-gray-500', 'End Band'),\r\n                                m('select.bg-gray-700.rounded.p-2.text-sm', {\r\n                                    value: this.config.audio.endBand || 'alpha',\r\n                                    onchange: (e) => {\r\n                                        this.config.audio.endBand = e.target.value;\r\n                                        this.config.audio.sweepEnd = Magic8.AudioEngine.BRAINWAVE_BANDS[e.target.value]?.mid || 10;\r\n                                        this.config.audio.preset = null;\r\n                                    }\r\n                                }, Object.entries(Magic8.AudioEngine.BRAINWAVE_BANDS).map(([key, b]) =>\r\n                                    m('option', { value: key }, b.label)\r\n                                ))\r\n                            ])\r\n                        ]),\r\n\r\n                        // Advanced toggle for raw Hz controls\r\n                        m('label.flex.items-center.gap-2.cursor-pointer.mt-2', [\r\n                            m('input.w-4.h-4.rounded', {\r\n                                type: 'checkbox',\r\n                                checked: this._showAdvancedAudio || false,\r\n                                onchange: (e) => this._showAdvancedAudio = e.target.checked\r\n                            }),\r\n                            m('span.text-sm.text-gray-400', 'Show advanced (raw Hz)')\r\n                        ]),\r\n                        this._showAdvancedAudio && m('.mt-2.space-y-2.border-l-2.border-gray-600.pl-4', [\r\n                            m('.flex.items-center.gap-4', [\r\n                                m('label.w-36', 'Base Frequency'),\r\n                                m('input.flex-1', {\r\n                                    type: 'range', min: 100, max: 963,\r\n                                    value: this.config.audio.baseFreq,\r\n                                    oninput: (e) => { this.config.audio.baseFreq = parseInt(e.target.value); this.config.audio.preset = null; }\r\n                                }),\r\n                                m('span.w-16.text-right', `${this.config.audio.baseFreq} Hz`)\r\n                            ]),\r\n                            m('.flex.items-center.gap-4', [\r\n                                m('label.w-36', 'Sweep Start'),\r\n                                m('input.flex-1', {\r\n                                    type: 'range', min: 0.5, max: 100, step: 0.5,\r\n                                    value: this.config.audio.sweepStart,\r\n                                    oninput: (e) => { this.config.audio.sweepStart = parseFloat(e.target.value); this.config.audio.preset = null; }\r\n                                }),\r\n                                m('span.w-16.text-right', `${this.config.audio.sweepStart} Hz`)\r\n                            ]),\r\n                            m('.flex.items-center.gap-4', [\r\n                                m('label.w-36', 'Sweep Trough'),\r\n                                m('input.flex-1', {\r\n                                    type: 'range', min: 0.5, max: 100, step: 0.5,\r\n                                    value: this.config.audio.sweepTrough,\r\n                                    oninput: (e) => { this.config.audio.sweepTrough = parseFloat(e.target.value); this.config.audio.preset = null; }\r\n                                }),\r\n                                m('span.w-16.text-right', `${this.config.audio.sweepTrough} Hz`)\r\n                            ]),\r\n                            m('.flex.items-center.gap-4', [\r\n                                m('label.w-36', 'Sweep End'),\r\n                                m('input.flex-1', {\r\n                                    type: 'range', min: 0.5, max: 100, step: 0.5,\r\n                                    value: this.config.audio.sweepEnd,\r\n                                    oninput: (e) => { this.config.audio.sweepEnd = parseFloat(e.target.value); this.config.audio.preset = null; }\r\n                                }),\r\n                                m('span.w-16.text-right', `${this.config.audio.sweepEnd} Hz`)\r\n                            ])\r\n                        ]),\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Sweep Duration'),\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 1, max: 20, step: 1,\r\n                                value: this.config.audio.sweepDurationMin,\r\n                                oninput: (e) => this.config.audio.sweepDurationMin = parseInt(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', `${this.config.audio.sweepDurationMin} min`)\r\n                        ]),\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Fade In'),\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 0.5, max: 10, step: 0.5,\r\n                                value: this.config.audio.fadeInSec,\r\n                                oninput: (e) => this.config.audio.fadeInSec = parseFloat(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', `${this.config.audio.fadeInSec}s`)\r\n                        ]),\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Fade Out'),\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 0.5, max: 10, step: 0.5,\r\n                                value: this.config.audio.fadeOutSec,\r\n                                oninput: (e) => this.config.audio.fadeOutSec = parseFloat(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', `${this.config.audio.fadeOutSec}s`)\r\n                        ])\r\n                    ]),\r\n\r\n                    // Q-Sound Panning\r\n                    this.config.audio.binauralEnabled && [\r\n                        m('label.flex.items-center.gap-3.cursor-pointer.mb-4', [\r\n                            m('input.w-5.h-5.rounded', {\r\n                                type: 'checkbox',\r\n                                checked: this.config.audio.panEnabled,\r\n                                onchange: (e) => this.config.audio.panEnabled = e.target.checked\r\n                            }),\r\n                            m('span', 'Q-Sound spatial panning')\r\n                        ]),\r\n                        this.config.audio.panEnabled && m('.ml-8.space-y-4.mb-6', [\r\n                            m('.flex.items-center.gap-4', [\r\n                                m('label.w-36', 'Pan Speed'),\r\n                                m('input.flex-1', {\r\n                                    type: 'range', min: 0.02, max: 0.5, step: 0.02,\r\n                                    value: this.config.audio.panSpeed,\r\n                                    oninput: (e) => this.config.audio.panSpeed = parseFloat(e.target.value)\r\n                                }),\r\n                                m('span.w-16.text-right', this.config.audio.panSpeed.toFixed(2))\r\n                            ]),\r\n                            m('.flex.items-center.gap-4', [\r\n                                m('label.w-36', 'Pan Depth'),\r\n                                m('input.flex-1', {\r\n                                    type: 'range', min: 0.1, max: 1.0, step: 0.1,\r\n                                    value: this.config.audio.panDepth,\r\n                                    oninput: (e) => this.config.audio.panDepth = parseFloat(e.target.value)\r\n                                }),\r\n                                m('span.w-16.text-right', this.config.audio.panDepth.toFixed(1))\r\n                            ])\r\n                        ])\r\n                    ],\r\n\r\n                    // Isochronic Tones\r\n                    m('label.flex.items-center.gap-3.cursor-pointer.mb-4', [\r\n                        m('input.w-5.h-5.rounded', {\r\n                            type: 'checkbox',\r\n                            checked: this.config.audio.isochronicEnabled,\r\n                            onchange: (e) => this.config.audio.isochronicEnabled = e.target.checked\r\n                        }),\r\n                        m('span', 'Isochronic tones')\r\n                    ]),\r\n                    this.config.audio.isochronicEnabled && m('.ml-8.space-y-4.mb-6', [\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Tone Frequency'),\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 100, max: 500, step: 10,\r\n                                value: this.config.audio.isochronicFreq,\r\n                                oninput: (e) => this.config.audio.isochronicFreq = parseInt(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', `${this.config.audio.isochronicFreq} Hz`)\r\n                        ]),\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Pulse Rate'),\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 2, max: 15, step: 0.5,\r\n                                value: this.config.audio.isochronicRate,\r\n                                oninput: (e) => this.config.audio.isochronicRate = parseFloat(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', `${this.config.audio.isochronicRate} Hz`)\r\n                        ]),\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Volume'),\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 0.05, max: 0.5, step: 0.05,\r\n                                value: this.config.audio.isochronicVolume,\r\n                                oninput: (e) => this.config.audio.isochronicVolume = parseFloat(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', this.config.audio.isochronicVolume.toFixed(2))\r\n                        ])\r\n                    ]),\r\n\r\n                    // Audio Visualizer Overlay\r\n                    m('label.flex.items-center.gap-3.cursor-pointer.mb-4', [\r\n                        m('input.w-5.h-5.rounded', {\r\n                            type: 'checkbox',\r\n                            checked: this.config.audio.visualizerEnabled,\r\n                            onchange: (e) => this.config.audio.visualizerEnabled = e.target.checked\r\n                        }),\r\n                        m('span', 'Audio visualizer overlay')\r\n                    ]),\r\n                    this.config.audio.visualizerEnabled && m('.ml-8.space-y-4', [\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Opacity'),\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 0.1, max: 0.6, step: 0.05,\r\n                                value: this.config.audio.visualizerOpacity,\r\n                                oninput: (e) => this.config.audio.visualizerOpacity = parseFloat(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', `${Math.round(this.config.audio.visualizerOpacity * 100)}%`)\r\n                        ]),\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Gradient'),\r\n                            m('select.flex-1.p-2.bg-gray-700.rounded.text-sm', {\r\n                                value: this.config.audio.visualizerGradient,\r\n                                onchange: (e) => this.config.audio.visualizerGradient = e.target.value\r\n                            }, [\r\n                                m('option', { value: 'prism' }, 'Prism'),\r\n                                m('option', { value: 'rainbow' }, 'Rainbow'),\r\n                                m('option', { value: 'classic' }, 'Classic')\r\n                            ])\r\n                        ])\r\n                    ])\r\n                ]),\r\n\r\n                // Background Images Section\r\n                m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-4', 'Background Images'),\r\n                    m('p.text-sm.text-gray-400.mb-3', 'Groups are imported from the blender tray automatically'),\r\n\r\n                    // Selected groups list\r\n                    this.selectedImageGroups.length > 0\r\n                        ? [\r\n                            m('.space-y-1.mb-4', this.selectedImageGroups.map(grp =>\r\n                                m('.flex.items-center.justify-between.p-2.bg-gray-700.rounded', [\r\n                                    m('.flex.items-center.gap-2', [\r\n                                        m('span.material-icons.text-base.text-gray-400', 'folder'),\r\n                                        m('span.text-sm', grp.name)\r\n                                    ]),\r\n                                    m('button.text-gray-400.hover:text-red-400.p-1', {\r\n                                        onclick: () => {\r\n                                            this.selectedImageGroups = this.selectedImageGroups.filter(g => g.objectId !== grp.objectId);\r\n                                            this.config.images.baseGroups = this.config.images.baseGroups.filter(oid => oid !== grp.objectId);\r\n                                        }\r\n                                    }, m('span.material-icons.text-sm', 'close'))\r\n                                ])\r\n                            )),\r\n                            m('.text-xs.text-gray-500',\r\n                                `${this.selectedImageGroups.length} group(s) selected`\r\n                            )\r\n                        ]\r\n                        : m('.p-3.bg-gray-700.rounded.text-gray-500.text-sm',\r\n                            'No groups selected - no background images will cycle'\r\n                        ),\r\n\r\n                    // Cycle settings (always shown  images may come from generated or tag-based sources)\r\n                    m('.space-y-4.mt-4', [\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Cycle Interval'),\r\n                            m('input.flex-1', {\r\n                                type: 'range',\r\n                                min: 2000,\r\n                                max: 30000,\r\n                                step: 1000,\r\n                                value: this.config.images.cycleInterval,\r\n                                oninput: (e) => this.config.images.cycleInterval = parseInt(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', `${this.config.images.cycleInterval / 1000}s`)\r\n                        ]),\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Crossfade'),\r\n                            m('input.flex-1', {\r\n                                type: 'range',\r\n                                min: 200,\r\n                                max: 3000,\r\n                                step: 200,\r\n                                value: this.config.images.crossfadeDuration,\r\n                                oninput: (e) => this.config.images.crossfadeDuration = parseInt(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', `${(this.config.images.crossfadeDuration / 1000).toFixed(1)}s`)\r\n                        ]),\r\n                        m('label.flex.items-center.gap-3.cursor-pointer', [\r\n                            m('input.w-4.h-4.rounded', {\r\n                                type: 'checkbox',\r\n                                checked: this.config.images.includeGenerated,\r\n                                onchange: (e) => this.config.images.includeGenerated = e.target.checked\r\n                            }),\r\n                            m('span.text-sm', 'Include AI-generated images in rotation')\r\n                        ])\r\n                    ])\r\n                ]),\r\n\r\n                // Visual Effects Section\r\n                m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-4', 'Visual Effects'),\r\n                    m('.text-sm.text-gray-400.mb-3', 'Select which effects to render on the canvas overlay'),\r\n\r\n                    // Effect checkboxes\r\n                    m('.grid.gap-2.mb-4', { class: 'grid-cols-2 sm:grid-cols-4' },\r\n                        ['particles', 'spiral', 'mandala', 'tunnel', 'hypnoDisc'].map(effect =>\r\n                            m('label.flex.items-center.gap-2.cursor-pointer.p-2.bg-gray-700.rounded', [\r\n                                m('input.w-4.h-4.rounded', {\r\n                                    type: 'checkbox',\r\n                                    checked: this.config.visuals.effects.includes(effect),\r\n                                    onchange: (e) => {\r\n                                        if (e.target.checked) {\r\n                                            if (!this.config.visuals.effects.includes(effect)) {\r\n                                                this.config.visuals.effects.push(effect);\r\n                                            }\r\n                                        } else {\r\n                                            this.config.visuals.effects = this.config.visuals.effects.filter(ef => ef !== effect);\r\n                                        }\r\n                                    }\r\n                                }),\r\n                                m('span.text-sm.capitalize', effect)\r\n                            ])\r\n                        )\r\n                    ),\r\n\r\n                    // Mode selector\r\n                    m('.flex.items-center.gap-4.mb-4', [\r\n                        m('label.w-24', 'Mode'),\r\n                        m('select.flex-1.p-2.bg-gray-700.rounded.text-sm', {\r\n                            value: this.config.visuals.mode,\r\n                            onchange: (e) => this.config.visuals.mode = e.target.value\r\n                        }, [\r\n                            m('option', { value: 'single' }, 'Single (first selected)'),\r\n                            m('option', { value: 'cycle' }, 'Cycle (rotate through selected)'),\r\n                            m('option', { value: 'combined' }, 'Combined (overlay all selected)')\r\n                        ])\r\n                    ]),\r\n\r\n                    // Cycle mode settings\r\n                    this.config.visuals.mode === 'cycle' && m('.ml-8.space-y-4.mb-4', [\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Transition Interval'),\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 10, max: 120, step: 5,\r\n                                value: this.config.visuals.transitionInterval / 1000,\r\n                                oninput: (e) => this.config.visuals.transitionInterval = parseInt(e.target.value) * 1000\r\n                            }),\r\n                            m('span.w-16.text-right', `${this.config.visuals.transitionInterval / 1000}s`)\r\n                        ]),\r\n                        m('.flex.items-center.gap-4', [\r\n                            m('label.w-36', 'Transition Duration'),\r\n                            m('input.flex-1', {\r\n                                type: 'range', min: 1, max: 5, step: 0.5,\r\n                                value: this.config.visuals.transitionDuration / 1000,\r\n                                oninput: (e) => this.config.visuals.transitionDuration = parseFloat(e.target.value) * 1000\r\n                            }),\r\n                            m('span.w-16.text-right', `${(this.config.visuals.transitionDuration / 1000).toFixed(1)}s`)\r\n                        ])\r\n                    ]),\r\n\r\n                    // Per-effect settings\r\n                    this.config.visuals.effects.includes('particles') && m('.flex.items-center.gap-4.mb-2', [\r\n                        m('label.w-36.text-sm.text-gray-400', 'Particle Count'),\r\n                        m('input.flex-1', {\r\n                            type: 'range', min: 50, max: 200, step: 10,\r\n                            value: this.config.visuals.particleCount,\r\n                            oninput: (e) => this.config.visuals.particleCount = parseInt(e.target.value)\r\n                        }),\r\n                        m('span.w-16.text-right.text-sm', this.config.visuals.particleCount)\r\n                    ]),\r\n                    this.config.visuals.effects.includes('spiral') && m('.flex.items-center.gap-4.mb-2', [\r\n                        m('label.w-36.text-sm.text-gray-400', 'Spiral Speed'),\r\n                        m('input.flex-1', {\r\n                            type: 'range', min: 0.005, max: 0.03, step: 0.001,\r\n                            value: this.config.visuals.spiralSpeed,\r\n                            oninput: (e) => this.config.visuals.spiralSpeed = parseFloat(e.target.value)\r\n                        }),\r\n                        m('span.w-16.text-right.text-sm', this.config.visuals.spiralSpeed.toFixed(3))\r\n                    ]),\r\n                    this.config.visuals.effects.includes('mandala') && m('.flex.items-center.gap-4.mb-2', [\r\n                        m('label.w-36.text-sm.text-gray-400', 'Mandala Layers'),\r\n                        m('input.flex-1', {\r\n                            type: 'range', min: 2, max: 6, step: 1,\r\n                            value: this.config.visuals.mandalaLayers,\r\n                            oninput: (e) => this.config.visuals.mandalaLayers = parseInt(e.target.value)\r\n                        }),\r\n                        m('span.w-16.text-right.text-sm', this.config.visuals.mandalaLayers)\r\n                    ]),\r\n                    this.config.visuals.effects.includes('tunnel') && m('.flex.items-center.gap-4.mb-2', [\r\n                        m('label.w-36.text-sm.text-gray-400', 'Tunnel Rings'),\r\n                        m('input.flex-1', {\r\n                            type: 'range', min: 8, max: 20, step: 1,\r\n                            value: this.config.visuals.tunnelRings,\r\n                            oninput: (e) => this.config.visuals.tunnelRings = parseInt(e.target.value)\r\n                        }),\r\n                        m('span.w-16.text-right.text-sm', this.config.visuals.tunnelRings)\r\n                    ])\r\n                ]),\r\n\r\n                // Image Generation Section\r\n                m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-4', 'AI Image Generation'),\r\n                    m('label.flex.items-center.gap-3.cursor-pointer.mb-4', [\r\n                        m('input.w-5.h-5.rounded', {\r\n                            type: 'checkbox',\r\n                            checked: this.config.imageGeneration.enabled,\r\n                            onchange: (e) => this.config.imageGeneration.enabled = e.target.checked\r\n                        }),\r\n                        m('span', 'Enable SD image generation from camera')\r\n                    ]),\r\n                    this.config.imageGeneration.enabled && m('.ml-8.space-y-4', [\r\n                        // Source toggle: existing config vs create new\r\n                        m('.flex.gap-2.mb-4', [\r\n                            m('button', {\r\n                                class: 'px-3 py-1 rounded text-sm ' +\r\n                                    (!this.createNewSdConfig ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300'),\r\n                                onclick: () => { this.createNewSdConfig = false; }\r\n                            }, 'Select Existing'),\r\n                            m('button', {\r\n                                class: 'px-3 py-1 rounded text-sm ' +\r\n                                    (this.createNewSdConfig ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300'),\r\n                                onclick: () => {\r\n                                    this.createNewSdConfig = true;\r\n                                    this.config.imageGeneration.sdConfigId = null;\r\n                                }\r\n                            }, 'Create New')\r\n                        ]),\r\n\r\n                        // Existing config selector\r\n                        !this.createNewSdConfig && [\r\n                            m('label.block.mb-1', 'SD Configuration'),\r\n                            this.sdConfigs.length > 0\r\n                                ? m('select.w-full.p-2.bg-gray-700.rounded', {\r\n                                    value: this.config.imageGeneration.sdConfigId || '',\r\n                                    onchange: (e) => {\r\n                                        this.config.imageGeneration.sdConfigId = e.target.value || null;\r\n                                        this._loadSdConfigDetails(e.target.value || null);\r\n                                    }\r\n                                }, [\r\n                                    m('option', { value: '' }, '-- Default Config --'),\r\n                                    ...this.sdConfigs.map(c =>\r\n                                        m('option', { value: c.objectId }, c.name)\r\n                                    )\r\n                                ])\r\n                                : m('.p-3.bg-gray-700.rounded.text-gray-400.text-sm', [\r\n                                    m('span', 'No saved configs found in ~/Magic8/SDConfigs.'),\r\n                                    m('br'),\r\n                                    m('span', 'Using default config, or switch to '),\r\n                                    m('a.text-indigo-400.cursor-pointer', {\r\n                                        onclick: () => { this.createNewSdConfig = true; this.config.imageGeneration.sdConfigId = null; }\r\n                                    }, 'Create New'),\r\n                                    m('span', '.')\r\n                                ]),\r\n\r\n                            // SD config detail preview\r\n                            this.loadingSdDetails && m('.mt-3.p-3.bg-gray-700.rounded.text-sm.text-gray-400', 'Loading config details...'),\r\n                            !this.loadingSdDetails && this.selectedSdDetails && this.config.imageGeneration.sdConfigId && m('.mt-3.p-3.bg-gray-700.rounded.text-sm.space-y-2', [\r\n                                m('.text-gray-400.font-medium.mb-2', 'Config Preview'),\r\n                                this.selectedSdDetails.style && m('.flex.gap-2', [\r\n                                    m('span.text-gray-500.w-28', 'Style:'),\r\n                                    m('span', this.selectedSdDetails.style)\r\n                                ]),\r\n                                this.selectedSdDetails.description && m('.flex.gap-2', [\r\n                                    m('span.text-gray-500.w-28', 'Description:'),\r\n                                    m('span.text-gray-300', this.selectedSdDetails.description.length > 80\r\n                                        ? this.selectedSdDetails.description.substring(0, 80) + '...'\r\n                                        : this.selectedSdDetails.description)\r\n                                ]),\r\n                                this.selectedSdDetails.imageAction && m('.flex.gap-2', [\r\n                                    m('span.text-gray-500.w-28', 'Image Action:'),\r\n                                    m('span', this.selectedSdDetails.imageAction)\r\n                                ]),\r\n                                this.selectedSdDetails.model && m('.flex.gap-2', [\r\n                                    m('span.text-gray-500.w-28', 'Model:'),\r\n                                    m('span.text-gray-300', this.selectedSdDetails.model)\r\n                                ]),\r\n                                m('.flex.flex-wrap.gap-x-6.gap-y-1.mt-1', [\r\n                                    this.selectedSdDetails.denoisingStrength != null && m('span.text-gray-400',\r\n                                        `Denoising: ${this.selectedSdDetails.denoisingStrength}`),\r\n                                    this.selectedSdDetails.cfg != null && m('span.text-gray-400',\r\n                                        `CFG: ${this.selectedSdDetails.cfg}`),\r\n                                    this.selectedSdDetails.steps != null && m('span.text-gray-400',\r\n                                        `Steps: ${this.selectedSdDetails.steps}`),\r\n                                    this.selectedSdDetails.sampler && m('span.text-gray-400',\r\n                                        `Sampler: ${this.selectedSdDetails.sampler}`),\r\n                                    (this.selectedSdDetails.width || this.selectedSdDetails.height) && m('span.text-gray-400',\r\n                                        `Size: ${this.selectedSdDetails.width || '?'}x${this.selectedSdDetails.height || '?'}`)\r\n                                ])\r\n                            ])\r\n                        ],\r\n\r\n                        // Inline new config editor\r\n                        this.createNewSdConfig && [\r\n                            m('.grid.gap-4.mb-3', { class: 'grid-cols-1 sm:grid-cols-2' }, [\r\n                                m('div', [\r\n                                    m('label.block.text-sm.text-gray-400.mb-1', 'Model'),\r\n                                    m('select.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                        value: this.config.imageGeneration.sdInline.model,\r\n                                        onchange: (e) => this.config.imageGeneration.sdInline.model = e.target.value\r\n                                    }, [\r\n                                        m('option', { value: '' }, '-- Select Model --'),\r\n                                        ...this.sdModelList.map(v =>\r\n                                            m('option', { value: v }, v)\r\n                                        )\r\n                                    ])\r\n                                ]),\r\n                                m('div', [\r\n                                    m('label.block.text-sm.text-gray-400.mb-1', 'Refiner'),\r\n                                    m('select.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                        value: this.config.imageGeneration.sdInline.refinerModel,\r\n                                        onchange: (e) => this.config.imageGeneration.sdInline.refinerModel = e.target.value\r\n                                    }, [\r\n                                        m('option', { value: '' }, '-- None --'),\r\n                                        ...this.sdModelList.map(v =>\r\n                                            m('option', { value: v }, v)\r\n                                        )\r\n                                    ])\r\n                                ])\r\n                            ]),\r\n\r\n                            m('.flex.items-end.gap-3.mb-3', [\r\n                                m('.flex-1', [\r\n                                    m('label.block.text-sm.text-gray-400.mb-1', 'Style'),\r\n                                    m('select.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                        value: this.config.imageGeneration.sdInline.style,\r\n                                        onchange: (e) => {\r\n                                            this.config.imageGeneration.sdInline.style = e.target.value;\r\n                                            this._fetchRandomSdConfig();\r\n                                        }\r\n                                    }, [\r\n                                        ...['art','photograph','movie','selfie','anime','portrait','comic','digitalArt','fashion','vintage','custom'].map(s =>\r\n                                            m('option', { value: s }, s.charAt(0).toUpperCase() + s.slice(1))\r\n                                        )\r\n                                    ])\r\n                                ]),\r\n                                m('button', {\r\n                                    class: 'px-3 py-2 rounded text-sm font-medium whitespace-nowrap ' +\r\n                                        (this.fetchingRandomSd ? 'bg-gray-600 text-gray-400' : 'bg-indigo-600 text-white hover:bg-indigo-500'),\r\n                                    disabled: this.fetchingRandomSd,\r\n                                    onclick: () => this._fetchRandomSdConfig(),\r\n                                    title: 'Fetch a randomized config from the server with style-specific fields'\r\n                                }, this.fetchingRandomSd ? 'Fetching...' : 'Randomize')\r\n                            ]),\r\n\r\n                            // Style-specific fields preview (from randomize)\r\n                            this.randomSdExtras && m('.mb-3.p-3.bg-gray-700/50.rounded.text-sm', [\r\n                                m('.text-gray-400.font-medium.mb-2', 'Style Details (' + this.config.imageGeneration.sdInline.style + ')'),\r\n                                ...Object.entries(this.randomSdExtras).map(([key, value]) =>\r\n                                    m('.flex.gap-2', [\r\n                                        m('span.text-gray-500.w-36', key.replace(/([A-Z])/g, ' $1').trim() + ':'),\r\n                                        m('span.text-gray-300', String(value))\r\n                                    ])\r\n                                )\r\n                            ]),\r\n\r\n                            m('label.block.text-sm.text-gray-400.mb-1', 'Description'),\r\n                            m('textarea.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                rows: 2,\r\n                                value: this.config.imageGeneration.sdInline.description,\r\n                                oninput: (e) => this.config.imageGeneration.sdInline.description = e.target.value\r\n                            }),\r\n\r\n                            m('label.block.text-sm.text-gray-400.mb-1.mt-3', 'Image Action'),\r\n                            m('input.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                type: 'text',\r\n                                value: this.config.imageGeneration.sdInline.imageAction,\r\n                                oninput: (e) => this.config.imageGeneration.sdInline.imageAction = e.target.value\r\n                            }),\r\n\r\n                            m('label.block.text-sm.text-gray-400.mb-1.mt-3', 'Negative Prompt'),\r\n                            m('textarea.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                rows: 2,\r\n                                placeholder: 'Leave empty for default quality exclusions',\r\n                                value: this.config.imageGeneration.sdInline.negativePrompt,\r\n                                oninput: (e) => this.config.imageGeneration.sdInline.negativePrompt = e.target.value\r\n                            }),\r\n\r\n                            m('.grid.gap-4.mt-3', { class: 'grid-cols-1 sm:grid-cols-2' }, [\r\n                                m('div', [\r\n                                    m('label.block.text-sm.text-gray-400.mb-1', 'Denoising Strength'),\r\n                                    m('.flex.items-center.gap-2', [\r\n                                        m('input.flex-1', {\r\n                                            type: 'range', min: 0.1, max: 1.0, step: 0.05,\r\n                                            value: this.config.imageGeneration.sdInline.denoisingStrength,\r\n                                            oninput: (e) => this.config.imageGeneration.sdInline.denoisingStrength = parseFloat(e.target.value)\r\n                                        }),\r\n                                        m('span.text-sm.w-10.text-right', this.config.imageGeneration.sdInline.denoisingStrength.toFixed(2))\r\n                                    ])\r\n                                ]),\r\n                                m('div', [\r\n                                    m('label.block.text-sm.text-gray-400.mb-1', 'CFG'),\r\n                                    m('.flex.items-center.gap-2', [\r\n                                        m('input.flex-1', {\r\n                                            type: 'range', min: 1, max: 20, step: 0.5,\r\n                                            value: this.config.imageGeneration.sdInline.cfg,\r\n                                            oninput: (e) => this.config.imageGeneration.sdInline.cfg = parseFloat(e.target.value)\r\n                                        }),\r\n                                        m('span.text-sm.w-10.text-right', this.config.imageGeneration.sdInline.cfg)\r\n                                    ])\r\n                                ]),\r\n                                m('div', [\r\n                                    m('label.block.text-sm.text-gray-400.mb-1', 'Steps'),\r\n                                    m('.flex.items-center.gap-2', [\r\n                                        m('input.flex-1', {\r\n                                            type: 'range', min: 10, max: 80, step: 5,\r\n                                            value: this.config.imageGeneration.sdInline.steps,\r\n                                            oninput: (e) => this.config.imageGeneration.sdInline.steps = parseInt(e.target.value)\r\n                                        }),\r\n                                        m('span.text-sm.w-10.text-right', this.config.imageGeneration.sdInline.steps)\r\n                                    ])\r\n                                ]),\r\n                                m('div', [\r\n                                    m('label.block.text-sm.text-gray-400.mb-1', 'Sampler'),\r\n                                    m('select.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                        value: this.config.imageGeneration.sdInline.sampler,\r\n                                        onchange: (e) => this.config.imageGeneration.sdInline.sampler = e.target.value\r\n                                    }, [\r\n                                        m('option', { value: 'dpmpp_2m' }, 'DPM++ 2M'),\r\n                                        m('option', { value: 'euler_a' }, 'Euler A'),\r\n                                        m('option', { value: 'euler' }, 'Euler'),\r\n                                        m('option', { value: 'dpm_2' }, 'DPM 2'),\r\n                                        m('option', { value: 'dpm_2_a' }, 'DPM 2 A'),\r\n                                        m('option', { value: 'lms' }, 'LMS'),\r\n                                        m('option', { value: 'heun' }, 'Heun'),\r\n                                        m('option', { value: 'ddim' }, 'DDIM')\r\n                                    ])\r\n                                ]),\r\n                            ]),\r\n\r\n                            m('.grid.gap-4.mt-3', { class: 'grid-cols-1 sm:grid-cols-2' }, [\r\n                                m('div', [\r\n                                    m('label.block.text-sm.text-gray-400.mb-1', 'Width'),\r\n                                    m('select.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                        value: this.config.imageGeneration.sdInline.width,\r\n                                        onchange: (e) => this.config.imageGeneration.sdInline.width = parseInt(e.target.value)\r\n                                    }, [256, 384, 512, 640, 768, 1024].map(v =>\r\n                                        m('option', { value: v }, v + 'px')\r\n                                    ))\r\n                                ]),\r\n                                m('div', [\r\n                                    m('label.block.text-sm.text-gray-400.mb-1', 'Height'),\r\n                                    m('select.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                        value: this.config.imageGeneration.sdInline.height,\r\n                                        onchange: (e) => this.config.imageGeneration.sdInline.height = parseInt(e.target.value)\r\n                                    }, [256, 384, 512, 640, 768, 1024].map(v =>\r\n                                        m('option', { value: v }, v + 'px')\r\n                                    ))\r\n                                ])\r\n                            ]),\r\n\r\n                            m('.flex.gap-2.mt-3', [\r\n                                m('button', {\r\n                                    class: 'px-4 py-2 rounded text-sm font-medium ' +\r\n                                        (this.isSaving ? 'bg-gray-600 text-gray-400' : 'bg-green-600 text-white hover:bg-green-500'),\r\n                                    disabled: this.isSaving,\r\n                                    onclick: () => this._saveNewSdConfig()\r\n                                }, this.isSaving ? 'Saving...' : 'Save Config'),\r\n                                m('.text-xs.text-gray-500.self-center', 'Save to ~/Magic8/SDConfigs for reuse, or use inline without saving')\r\n                            ])\r\n                        ],\r\n\r\n                        // Capture interval (always shown)\r\n                        m('.flex.items-center.gap-4.mt-4', [\r\n                            m('label.w-32', 'Capture Interval'),\r\n                            m('input.flex-1', {\r\n                                type: 'range',\r\n                                min: 60000,\r\n                                max: 600000,\r\n                                step: 30000,\r\n                                value: this.config.imageGeneration.captureInterval,\r\n                                oninput: (e) => this.config.imageGeneration.captureInterval = parseInt(e.target.value)\r\n                            }),\r\n                            m('span.w-20.text-right', `${(this.config.imageGeneration.captureInterval / 60000).toFixed(1)} min`)\r\n                        ])\r\n                    ])\r\n                ]),\r\n\r\n                // Text Sequence Section\r\n                m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-4', 'Hypnotic Text'),\r\n                    m('label.flex.items-center.gap-3.cursor-pointer.mb-4', [\r\n                        m('input.w-5.h-5.rounded', {\r\n                            type: 'checkbox',\r\n                            checked: this.config.text.enabled,\r\n                            onchange: (e) => this.config.text.enabled = e.target.checked\r\n                        }),\r\n                        m('span', 'Enable text sequence')\r\n                    ]),\r\n                    this.config.text.enabled && m('.ml-8.space-y-4', [\r\n                        // Source toggle: existing vs create new\r\n                        m('.flex.gap-2.mb-4', [\r\n                            m('button', {\r\n                                class: 'px-3 py-1 rounded text-sm ' +\r\n                                    (!this.createNewTextSource ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300'),\r\n                                onclick: () => { this.createNewTextSource = false; }\r\n                            }, 'Select Existing'),\r\n                            m('button', {\r\n                                class: 'px-3 py-1 rounded text-sm ' +\r\n                                    (this.createNewTextSource ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300'),\r\n                                onclick: () => {\r\n                                    this.createNewTextSource = true;\r\n                                    this.config.text.sourceObjectId = null;\r\n                                }\r\n                            }, 'Create New')\r\n                        ]),\r\n\r\n                        // Existing source selector\r\n                        !this.createNewTextSource && [\r\n                            m('label.block.mb-1', 'Text Source'),\r\n                            this.textSources.length > 0\r\n                                ? m('select.w-full.p-2.bg-gray-700.rounded', {\r\n                                    value: this.config.text.sourceObjectId || '',\r\n                                    onchange: (e) => {\r\n                                        const selected = this.textSources.find(t => t.objectId === e.target.value);\r\n                                        this.config.text.sourceObjectId = e.target.value || null;\r\n                                        this.config.text.sourceType = selected?.sourceType || 'note';\r\n                                    }\r\n                                }, [\r\n                                    m('option', { value: '' }, '-- Select Text Source --'),\r\n                                    ...this.textSources.map(t =>\r\n                                        m('option', { value: t.objectId }, `${t.name} (${t.sourceType})`)\r\n                                    )\r\n                                ])\r\n                                : m('.p-3.bg-gray-700.rounded.text-gray-400.text-sm', [\r\n                                    m('span', 'No text sources found in ~/Magic8/TextSequences.'),\r\n                                    m('br'),\r\n                                    m('span', 'Switch to '),\r\n                                    m('a.text-indigo-400.cursor-pointer', {\r\n                                        onclick: () => { this.createNewTextSource = true; this.config.text.sourceObjectId = null; }\r\n                                    }, 'Create New'),\r\n                                    m('span', ' to add one.')\r\n                                ])\r\n                        ],\r\n\r\n                        // Inline new text source editor\r\n                        this.createNewTextSource && [\r\n                            m('label.block.text-sm.text-gray-400.mb-1', 'Name'),\r\n                            m('input.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                type: 'text',\r\n                                placeholder: 'e.g. Relaxation Sequence',\r\n                                value: this.newTextName,\r\n                                oninput: (e) => this.newTextName = e.target.value\r\n                            }),\r\n\r\n                            m('label.block.text-sm.text-gray-400.mb-1.mt-3', 'Type'),\r\n                            m('select.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                value: this.newTextSourceType,\r\n                                onchange: (e) => this.newTextSourceType = e.target.value\r\n                            }, [\r\n                                m('option', { value: 'note' }, 'Note (plain text lines)'),\r\n                                m('option', { value: 'data' }, 'Data (JSON array)')\r\n                            ]),\r\n\r\n                            m('label.block.text-sm.text-gray-400.mb-1.mt-3',\r\n                                this.newTextSourceType === 'note'\r\n                                    ? 'Text (one phrase per line)'\r\n                                    : 'Text (JSON array of strings)'\r\n                            ),\r\n                            m('textarea.w-full.p-2.bg-gray-700.rounded.text-sm.font-mono', {\r\n                                rows: 6,\r\n                                placeholder: this.newTextSourceType === 'note'\r\n                                    ? 'Relax and breathe deeply\\nLet go of all tension\\nFeel the calm wash over you'\r\n                                    : '[\"Relax and breathe deeply\", \"Let go of all tension\", \"Feel the calm wash over you\"]',\r\n                                value: this.newTextContent,\r\n                                oninput: (e) => this.newTextContent = e.target.value\r\n                            }),\r\n\r\n                            m('button', {\r\n                                class: 'mt-3 px-4 py-2 rounded text-sm font-medium ' +\r\n                                    (this.isSaving ? 'bg-gray-600 text-gray-400' : 'bg-green-600 text-white hover:bg-green-500'),\r\n                                disabled: this.isSaving || !this.newTextName.trim() || !this.newTextContent.trim(),\r\n                                onclick: () => this._saveNewTextSource()\r\n                            }, this.isSaving ? 'Saving...' : 'Save & Select')\r\n                        ],\r\n\r\n                        // Options (always shown)\r\n                        m('label.flex.items-center.gap-3.cursor-pointer.mt-4', [\r\n                            m('input.w-5.h-5.rounded', {\r\n                                type: 'checkbox',\r\n                                checked: this.config.text.loop,\r\n                                onchange: (e) => this.config.text.loop = e.target.checked\r\n                            }),\r\n                            m('span', 'Loop text sequence')\r\n                        ]),\r\n                        m('.flex.items-center.gap-4.mt-2', [\r\n                            m('label.w-36', 'Display Duration'),\r\n                            m('input.flex-1', {\r\n                                type: 'range',\r\n                                min: 2000,\r\n                                max: 15000,\r\n                                step: 1000,\r\n                                value: this.config.text.displayDuration,\r\n                                oninput: (e) => this.config.text.displayDuration = parseInt(e.target.value)\r\n                            }),\r\n                            m('span.w-16.text-right', `${this.config.text.displayDuration / 1000}s`)\r\n                        ])\r\n                    ])\r\n                ]),\r\n\r\n                // Voice Sequence Section\r\n                m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-4', 'Voice Sequence'),\r\n                    m('label.flex.items-center.gap-3.cursor-pointer.mb-4', [\r\n                        m('input.w-5.h-5.rounded', {\r\n                            type: 'checkbox',\r\n                            checked: this.config.voice.enabled,\r\n                            onchange: (e) => this.config.voice.enabled = e.target.checked\r\n                        }),\r\n                        m('span', 'Enable voice sequence playback')\r\n                    ]),\r\n                    this.config.voice.enabled && m('.ml-8.space-y-4', [\r\n                        // Source toggle: existing vs create new\r\n                        m('.flex.gap-2.mb-4', [\r\n                            m('button', {\r\n                                class: 'px-3 py-1 rounded text-sm ' +\r\n                                    (!this.createNewVoiceSource ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300'),\r\n                                onclick: () => { this.createNewVoiceSource = false; }\r\n                            }, 'Select Existing'),\r\n                            m('button', {\r\n                                class: 'px-3 py-1 rounded text-sm ' +\r\n                                    (this.createNewVoiceSource ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300'),\r\n                                onclick: () => {\r\n                                    this.createNewVoiceSource = true;\r\n                                    this.config.voice.sourceObjectId = null;\r\n                                }\r\n                            }, 'Create New')\r\n                        ]),\r\n\r\n                        // Existing source selector\r\n                        !this.createNewVoiceSource && [\r\n                            m('label.block.mb-1', 'Voice Source'),\r\n                            this.voiceSources.length > 0\r\n                                ? m('select.w-full.p-2.bg-gray-700.rounded', {\r\n                                    value: this.config.voice.sourceObjectId || '',\r\n                                    onchange: (e) => {\r\n                                        const selected = this.voiceSources.find(t => t.objectId === e.target.value);\r\n                                        this.config.voice.sourceObjectId = e.target.value || null;\r\n                                        this.config.voice.sourceType = selected?.sourceType || 'note';\r\n                                    }\r\n                                }, [\r\n                                    m('option', { value: '' }, '-- Select Voice Source --'),\r\n                                    ...this.voiceSources.map(t =>\r\n                                        m('option', { value: t.objectId }, `${t.name} (${t.sourceType})`)\r\n                                    )\r\n                                ])\r\n                                : m('.p-3.bg-gray-700.rounded.text-gray-400.text-sm', [\r\n                                    m('span', 'No voice sources found in ~/Magic8/VoiceSequences.'),\r\n                                    m('br'),\r\n                                    m('span', 'Switch to '),\r\n                                    m('a.text-indigo-400.cursor-pointer', {\r\n                                        onclick: () => { this.createNewVoiceSource = true; this.config.voice.sourceObjectId = null; }\r\n                                    }, 'Create New'),\r\n                                    m('span', ' to add one.')\r\n                                ])\r\n                        ],\r\n\r\n                        // Inline new voice source editor\r\n                        this.createNewVoiceSource && [\r\n                            m('label.block.text-sm.text-gray-400.mb-1', 'Name'),\r\n                            m('input.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                type: 'text',\r\n                                placeholder: 'e.g. Guided Meditation',\r\n                                value: this.newVoiceName,\r\n                                oninput: (e) => this.newVoiceName = e.target.value\r\n                            }),\r\n\r\n                            m('label.block.text-sm.text-gray-400.mb-1.mt-3', 'Type'),\r\n                            m('select.w-full.p-2.bg-gray-700.rounded.text-sm', {\r\n                                value: this.newVoiceSourceType,\r\n                                onchange: (e) => this.newVoiceSourceType = e.target.value\r\n                            }, [\r\n                                m('option', { value: 'note' }, 'Note (plain text lines)'),\r\n                                m('option', { value: 'data' }, 'Data (base64 text)')\r\n                            ]),\r\n\r\n                            m('label.block.text-sm.text-gray-400.mb-1.mt-3', 'Text (one phrase per line, each line synthesized separately)'),\r\n                            m('textarea.w-full.p-2.bg-gray-700.rounded.text-sm.font-mono', {\r\n                                rows: 6,\r\n                                placeholder: 'Close your eyes and relax\\nTake a deep breath in\\nHold it for a moment\\nNow slowly exhale',\r\n                                value: this.newVoiceContent,\r\n                                oninput: (e) => this.newVoiceContent = e.target.value\r\n                            }),\r\n\r\n                            m('button', {\r\n                                class: 'mt-3 px-4 py-2 rounded text-sm font-medium ' +\r\n                                    (this.isSaving ? 'bg-gray-600 text-gray-400' : 'bg-green-600 text-white hover:bg-green-500'),\r\n                                disabled: this.isSaving || !this.newVoiceName.trim() || !this.newVoiceContent.trim(),\r\n                                onclick: () => this._saveNewVoiceSource()\r\n                            }, this.isSaving ? 'Saving...' : 'Save & Select')\r\n                        ],\r\n\r\n                        // Voice Profile selector\r\n                        m('label.block.mb-1.mt-4', 'Voice Profile'),\r\n                        this.voiceProfiles.length > 0\r\n                            ? m('select.w-full.p-2.bg-gray-700.rounded', {\r\n                                value: this.config.voice.voiceProfileId || '',\r\n                                onchange: (e) => this.config.voice.voiceProfileId = e.target.value || null\r\n                            }, [\r\n                                m('option', { value: '' }, '-- Default Voice (Piper Alba) --'),\r\n                                ...this.voiceProfiles.map(vp =>\r\n                                    m('option', { value: vp.objectId }, vp.name || `${vp.engine || 'piper'} - ${vp.speaker || 'default'}`)\r\n                                )\r\n                            ])\r\n                            : m('.p-2.bg-gray-700.rounded.text-gray-400.text-sm',\r\n                                'No voice profiles found. Default Piper voice will be used.'\r\n                            ),\r\n\r\n                        // Loop option\r\n                        m('label.flex.items-center.gap-3.cursor-pointer.mt-4', [\r\n                            m('input.w-5.h-5.rounded', {\r\n                                type: 'checkbox',\r\n                                checked: this.config.voice.loop,\r\n                                onchange: (e) => this.config.voice.loop = e.target.checked\r\n                            }),\r\n                            m('span', 'Loop voice sequence')\r\n                        ])\r\n                    ])\r\n                ]),\r\n\r\n                // AI Session Director Section\r\n                m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-4', 'AI Session Director'),\r\n                    m('label.flex.items-center.gap-3.cursor-pointer.mb-3', [\r\n                        m('input.w-5.h-5.rounded', {\r\n                            type: 'checkbox',\r\n                            checked: this.config.director.enabled,\r\n                            onchange: (e) => this.config.director.enabled = e.target.checked\r\n                        }),\r\n                        m('span', 'Enable AI Session Director')\r\n                    ]),\r\n                    m('p.text-xs.text-gray-400.mb-3', 'LLM-powered orchestration that adjusts audio, visuals, and labels based on session state. Requires \\'Open Chat\\' config in ~/Chat.'),\r\n                    this.config.director.enabled && m('.space-y-4.mt-3.pl-2.border-l-2.border-gray-700', [\r\n                        m('.config-field', [\r\n                            m('label.block.text-sm.font-medium.mb-1', 'Session Command / Intent'),\r\n                            m('textarea.w-full.bg-gray-900.rounded.px-3.py-2.text-sm', {\r\n                                rows: 3,\r\n                                placeholder: 'Guide me through a deep relaxation journey...',\r\n                                value: this.config.director.command,\r\n                                oninput: (e) => this.config.director.command = e.target.value\r\n                            })\r\n                        ]),\r\n                        m('.config-field', [\r\n                            m('label.block.text-sm.font-medium.mb-1',\r\n                                'Check-in Interval: ' + Math.round(this.config.director.intervalMs / 1000) + 's'\r\n                            ),\r\n                            m('input.w-full', {\r\n                                type: 'range',\r\n                                min: 30000,\r\n                                max: 300000,\r\n                                step: 15000,\r\n                                value: this.config.director.intervalMs,\r\n                                oninput: (e) => this.config.director.intervalMs = parseInt(e.target.value)\r\n                            })\r\n                        ]),\r\n\r\n                        // Image tags for director (selectable pill buttons)\r\n                        (() => {\r\n                            const availableTags = (window.am7imageTokens && window.am7imageTokens.tags)\r\n                                ? window.am7imageTokens.tags\r\n                                : ['selfie', 'nude', 'intimate', 'sexy', 'private', 'casual', 'public', 'professional'];\r\n                            const currentTags = (this.config.director.imageTags || '')\r\n                                .split(',').map(t => t.trim()).filter(t => t);\r\n                            const toggleTag = (tag) => {\r\n                                const idx = currentTags.indexOf(tag);\r\n                                if (idx > -1) { currentTags.splice(idx, 1); }\r\n                                else { currentTags.push(tag); }\r\n                                this.config.director.imageTags = currentTags.join(',');\r\n                            };\r\n                            return m('.config-field', [\r\n                                m('label.block.text-sm.font-medium.mb-1', 'Image Tags'),\r\n                                m('.flex.flex-wrap.gap-2.py-2',\r\n                                    availableTags.map(tag => {\r\n                                        const isSelected = currentTags.indexOf(tag) > -1;\r\n                                        return m('button', {\r\n                                            class: 'px-3 py-1 rounded-full text-xs ' +\r\n                                                (isSelected\r\n                                                    ? 'bg-indigo-600 text-white'\r\n                                                    : 'bg-gray-700 text-gray-400 hover:bg-gray-600'),\r\n                                            onclick: () => toggleTag(tag)\r\n                                        }, tag);\r\n                                    })\r\n                                ),\r\n                                m('p.text-xs.text-gray-500.mt-1',\r\n                                    'Select tags the LLM can use to find existing tagged images.'\r\n                                )\r\n                            ]);\r\n                        })(),\r\n\r\n                        // Interactive mode toggle\r\n                        m('label.flex.items-center.gap-3.cursor-pointer', [\r\n                            m('input.w-4.h-4.rounded', {\r\n                                type: 'checkbox',\r\n                                checked: this.config.director.interactive,\r\n                                onchange: (e) => this.config.director.interactive = e.target.checked\r\n                            }),\r\n                            m('span.text-sm', 'Interactive mode'),\r\n                            m('span.text-xs.text-gray-500.ml-1', '(LLM can ask questions, user responds via speech or text)')\r\n                        ]),\r\n\r\n                        // Test mode toggle\r\n                        m('label.flex.items-center.gap-3.cursor-pointer', [\r\n                            m('input.w-4.h-4.rounded', {\r\n                                type: 'checkbox',\r\n                                checked: this.config.director.testMode,\r\n                                onchange: (e) => this.config.director.testMode = e.target.checked\r\n                            }),\r\n                            m('span.text-sm', 'Test Mode'),\r\n                            m('span.text-xs.text-gray-500.ml-1', '(show debug console and diagnostics overlay during session)')\r\n                        ]),\r\n\r\n                        // Test button\r\n                        m('.config-field.mt-2', [\r\n                            m('button', {\r\n                                class: 'px-4 py-2 rounded text-sm font-medium ' +\r\n                                    (this.directorTestRunning\r\n                                        ? 'bg-gray-600 text-gray-400'\r\n                                        : 'bg-yellow-600 text-white hover:bg-yellow-500'),\r\n                                disabled: this.directorTestRunning,\r\n                                onclick: async () => {\r\n                                    this.directorTestRunning = true;\r\n                                    this.directorTestResults = null;\r\n                                    m.redraw();\r\n                                    try {\r\n                                        const director = new Magic8.SessionDirector();\r\n                                        this.directorTestResults = await director.runDiagnostics(\r\n                                            this.config.director.command || 'Diagnostic test'\r\n                                        );\r\n                                        director.dispose();\r\n                                    } catch (err) {\r\n                                        this.directorTestResults = [{ name: 'Test runner', pass: false, detail: err.message }];\r\n                                    }\r\n                                    this.directorTestRunning = false;\r\n                                    m.redraw();\r\n                                }\r\n                            }, this.directorTestRunning ? 'Testing...' : 'Test Director'),\r\n                            m('span.text-xs.text-gray-500.ml-2', 'Runs all checks including a live LLM call')\r\n                        ]),\r\n\r\n                        // Test results\r\n                        this.directorTestResults && m('.mt-3.p-3.bg-gray-900.rounded.text-sm.font-mono.space-y-1',\r\n                            this.directorTestResults.map(r =>\r\n                                m('.flex.items-start.gap-2', [\r\n                                    m('span', { style: { color: r.pass ? '#4ade80' : '#f87171', minWidth: '20px' } },\r\n                                        r.pass ? 'OK' : 'XX'),\r\n                                    m('span.text-gray-300', r.name),\r\n                                    r.detail && m('span.text-gray-500', ' - ' + r.detail)\r\n                                ])\r\n                            )\r\n                        )\r\n                    ])\r\n                ]),\r\n\r\n                // Recording Section\r\n                m('.config-section.mb-6.p-4.bg-gray-800.rounded-lg', [\r\n                    m('h3.text-lg.font-medium.mb-4', 'Session Recording'),\r\n                    m('label.flex.items-center.gap-3.cursor-pointer', [\r\n                        m('input.w-5.h-5.rounded', {\r\n                            type: 'checkbox',\r\n                            checked: this.config.recording.enabled,\r\n                            onchange: (e) => this.config.recording.enabled = e.target.checked\r\n                        }),\r\n                        m('span', 'Enable video recording')\r\n                    ]),\r\n\r\n                    // Sub-options shown when recording is enabled\r\n                    this.config.recording.enabled && m('.mt-4.ml-2.space-y-4', [\r\n                        m('label.flex.items-center.gap-3.cursor-pointer', [\r\n                            m('input.w-5.h-5.rounded', {\r\n                                type: 'checkbox',\r\n                                checked: this.config.recording.autoStart,\r\n                                onchange: (e) => this.config.recording.autoStart = e.target.checked\r\n                            }),\r\n                            m('span', 'Auto-start when session begins')\r\n                        ]),\r\n                        m('.space-y-1', [\r\n                            m('label.text-sm.text-gray-400', 'Max duration: ' + this.config.recording.maxDurationMin + ' min'),\r\n                            m('input.w-full', {\r\n                                type: 'range',\r\n                                min: 5,\r\n                                max: 120,\r\n                                step: 5,\r\n                                value: this.config.recording.maxDurationMin,\r\n                                oninput: (e) => this.config.recording.maxDurationMin = parseInt(e.target.value)\r\n                            })\r\n                        ]),\r\n                        m('p.text-xs.text-gray-500', 'Recording can also be toggled via the control bar during a session.')\r\n                    ])\r\n                ]),\r\n\r\n                // Action Buttons\r\n                m('.flex.flex-col.gap-3.mt-8', { class: 'sm:flex-row sm:gap-4' }, [\r\n                    m('button.flex-1.py-3.px-6.bg-gray-700.rounded-lg.font-medium.transition', {\r\n                        class: 'hover:bg-gray-600 active:bg-gray-500',\r\n                        style: { minHeight: '44px' },\r\n                        onclick: onCancel\r\n                    }, 'Cancel'),\r\n                    m('button.flex-1.py-3.px-6.bg-indigo-600.rounded-lg.font-medium.transition', {\r\n                        class: 'hover:bg-indigo-500 active:bg-indigo-400',\r\n                        style: { minHeight: '44px' },\r\n                        onclick: () => onSave && onSave(this.config)\r\n                    }, 'Start Session')\r\n                ])\r\n            ])\r\n        ]);\r\n    }\r\n};\r\n\r\n// Export\r\nif (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = SessionConfigEditor;\r\n}\r\nif (typeof window !== 'undefined') {\r\n    window.Magic8 = window.Magic8 || {};\r\n    window.Magic8.SessionConfigEditor = SessionConfigEditor;\r\n}\r\n\n\n;/* === client/view/magic8/Magic8App.js === */\n/**\r\n * Magic8App - Primary orchestrator for the Magic8 immersive experience\r\n * Coordinates all subsystems: audio, biometrics, images, text, recording, generation\r\n * Mithril.js component\r\n */\r\n(function() {\r\n\r\n    const Magic8App = {\r\n        // Session state\r\n        sessionConfig: null,\r\n        chatContext: null,\r\n        containerElement: null,\r\n\r\n        // Subsystem instances\r\n        fullscreenManager: null,\r\n        audioEngine: null,\r\n        biometricThemer: null,\r\n        imageGallery: null,\r\n        textSequence: null,\r\n        voiceSequence: null,\r\n        imageGenerator: null,\r\n        sessionRecorder: null,\r\n\r\n        // UI state\r\n        phase: 'config', // 'config' | 'running' | 'paused'\r\n        isFullscreen: false,\r\n        isRecording: false,\r\n        audioEnabled: false,\r\n        showConfig: false,\r\n        currentTheme: null,\r\n        currentImage: null,\r\n        prevImage: null,\r\n        imageOpacity: 1,\r\n        currentText: '',\r\n        biometricData: null,\r\n\r\n        // Session director\r\n        sessionDirector: null,\r\n        sessionLabels: [],\r\n        sessionVoiceLines: [],\r\n        _sessionStartTime: null,\r\n        _emotionHistory: [],   // [{emotion, timestamp}]  only stores actual changes\r\n\r\n        // Mood suggestion state (test mode emojis + mood ring)\r\n        _suggestedEmotion: null,\r\n        _suggestedGender: null,\r\n        moodRingEnabled: false,\r\n        moodRingColor: null,\r\n        _genderMalePct: 50,  // 0=fully female, 100=fully male (drives gender bar gradient)\r\n\r\n        // Generated image emphasis animation\r\n        _imageAnimation: null, // { transform, transition } for current image\r\n\r\n        // Test mode thumbnails (last capture + last generated)\r\n        _lastCaptureObj: null,    // {objectId, groupPath, name}\r\n        _lastGeneratedObj: null,  // {objectId, groupPath, name}\r\n\r\n        // Interactive director state (askUser)\r\n        _pendingQuestion: null,     // {question: string} from LLM askUser directive\r\n        _userResponse: null,        // captured text response (consumed on next tick)\r\n        _userInputText: '',         // live text in input field (STT or typed)\r\n        _sttMediaStream: null,      // getUserMedia stream for server-side STT\r\n        _sttMediaRecorder: null,    // MediaRecorder instance for server-side STT\r\n        _responseTimeoutId: null,   // auto-submit timeout handle\r\n        _interactionIdleTimer: null, // idle-check interval for text-only interaction\r\n        _lastTypingTime: 0,          // timestamp of last keystroke in interaction input\r\n        _voicePausedForInteraction: false, // voice sequence paused while waiting for user\r\n        _ticksSinceAskUser: 0,    // ticks since last askUser directive (for escalating prompts)\r\n\r\n        // Debug console (test mode)\r\n        debugMessages: [],\r\n        _debugMinimized: false,\r\n\r\n        // Ambient breathing state\r\n        ambientOpacity: 0.15,\r\n        _breatheTransitionMs: 120000,\r\n        _breatheTimeout: null,\r\n\r\n        // Layer opacity (director-controlled, gradual transitions)\r\n        _layerOpacity: { labels: 1, images: 1, visualizer: 1, visuals: 1 },\r\n        _layerOpacityTarget: { labels: 1, images: 1, visualizer: 1, visuals: 1 },\r\n        _layerOpacityStart: { labels: 1, images: 1, visualizer: 1, visuals: 1 },\r\n        _layerTransitionStart: {},\r\n        _opacityTransitionMs: 20000,  // 20s gradual transition\r\n        _opacityRafId: null,\r\n\r\n        // Intervals\r\n        biometricInterval: null,\r\n        imageCycleInterval: null,\r\n        imageGenInterval: null,\r\n\r\n        // Lifecycle\r\n        async oninit(vnode) {\r\n            const sessionConfigId = vnode.attrs.sessionConfigId;\r\n\r\n            // Check for chat context handoff\r\n            const contextJson = sessionStorage.getItem('magic8Context');\r\n            if (contextJson) {\r\n                try {\r\n                    this.chatContext = JSON.parse(contextJson);\r\n                    sessionStorage.removeItem('magic8Context');\r\n                } catch (e) {\r\n                    console.error('Magic8App: Failed to parse chat context:', e);\r\n                }\r\n            }\r\n\r\n            // Load saved session config\r\n            if (sessionConfigId) {\r\n                await this._loadSessionConfig(sessionConfigId);\r\n                this.phase = 'running';\r\n            } else {\r\n                this.phase = 'config';\r\n            }\r\n\r\n            // Create fullscreen manager\r\n            this.fullscreenManager = new Magic8.FullscreenManager();\r\n            this.fullscreenManager.onFullscreenChange((isFS) => {\r\n                this.isFullscreen = isFS;\r\n                m.redraw();\r\n            });\r\n        },\r\n\r\n        oncreate(vnode) {\r\n            this.containerElement = vnode.dom;\r\n\r\n            // Handle keyboard shortcuts\r\n            this._keyHandler = (e) => {\r\n                if (e.key === 'Escape') {\r\n                    this._handleExit();\r\n                } else if (e.key === ' ' && this.phase === 'running') {\r\n                    e.preventDefault();\r\n                    this._togglePause();\r\n                }\r\n            };\r\n            document.addEventListener('keydown', this._keyHandler);\r\n\r\n            // Start session if config was preloaded\r\n            if (this.phase === 'running' && this.sessionConfig) {\r\n                this._initSession();\r\n            }\r\n        },\r\n\r\n        onremove(vnode) {\r\n            document.removeEventListener('keydown', this._keyHandler);\r\n            this._cleanup();\r\n        },\r\n\r\n        // Configuration Management\r\n        async _loadSessionConfig(configId) {\r\n            try {\r\n                let q = am7view.viewQuery(am7model.newInstance(\"data.data\"));\r\n                q.entity.request.push(\"dataBytesStore\");\r\n                q.field(\"objectId\", configId);\r\n                let qr = await page.search(q);\r\n                if (qr && qr.results && qr.results.length) {\r\n                    am7model.updateListModel(qr.results);\r\n                    let obj = qr.results[0];\r\n                    if (obj.dataBytesStore && obj.dataBytesStore.length) {\r\n                        this.sessionConfig = JSON.parse(uwm.base64Decode(obj.dataBytesStore));\r\n                    } else {\r\n                        this.sessionConfig = {};\r\n                    }\r\n                } else {\r\n                    this.sessionConfig = {};\r\n                }\r\n            } catch (err) {\r\n                console.error('Magic8App: Failed to load session config:', err);\r\n                this.sessionConfig = null;\r\n            }\r\n        },\r\n\r\n        async _saveSessionConfig(config) {\r\n            try {\r\n                let dir = await page.findObject(\"auth.group\", \"DATA\", \"~/Magic8/Configs\");\r\n                if (!dir || !dir.objectId) {\r\n                    dir = await page.makePath(\"auth.group\", \"data\", \"~/Magic8/Configs\");\r\n                }\r\n\r\n                const configName = config.name || 'Magic8 Session';\r\n                const encoded = uwm.base64Encode(JSON.stringify(config));\r\n\r\n                // Check for existing config with same name in the group\r\n                let q = am7view.viewQuery(am7model.newInstance(\"data.data\"));\r\n                q.entity.request.push(\"dataBytesStore\");\r\n                q.field(\"name\", configName);\r\n                q.field(\"groupId\", dir.id);\r\n                let qr = await page.search(q);\r\n\r\n                let saved;\r\n                if (qr?.results?.length) {\r\n                    // Update existing record with full object\r\n                    let existing = qr.results[0];\r\n                    existing.dataBytesStore = encoded;\r\n                    existing.compressionType = \"none\";\r\n                    saved = await page.patchObject(existing);\r\n                    console.log('Magic8App: Session config updated:', existing.objectId);\r\n                } else {\r\n                    // Create new record\r\n                    let obj = am7model.newPrimitive(\"data.data\");\r\n                    obj.name = configName;\r\n                    obj.contentType = \"application/json\";\r\n                    obj.compressionType = \"none\";\r\n                    obj.groupId = dir.id;\r\n                    obj.groupPath = dir.path;\r\n                    obj.dataBytesStore = encoded;\r\n                    saved = await page.createObject(obj);\r\n                    if (saved && saved.objectId) {\r\n                        console.log('Magic8App: Session config saved:', saved.objectId);\r\n                    }\r\n                }\r\n\r\n                this.sessionConfig = config;\r\n                return saved?.objectId || null;\r\n            } catch (err) {\r\n                console.error('Magic8App: Failed to save session config:', err);\r\n                return null;\r\n            }\r\n        },\r\n\r\n        // Session Initialization\r\n        async _initSession() {\r\n            if (!this.sessionConfig) return;\r\n            const cfg = this.sessionConfig;\r\n\r\n            // Enter fullscreen\r\n            if (cfg.display?.fullscreen && this.containerElement) {\r\n                try {\r\n                    await this.fullscreenManager.enterFullscreen(this.containerElement);\r\n                    this.isFullscreen = true;\r\n                } catch (e) {\r\n                    console.warn('Magic8App: Fullscreen not available');\r\n                }\r\n            }\r\n\r\n            // Initialize audio engine\r\n            this.audioEngine = new Magic8.AudioEngine();\r\n            // Ensure AudioContext is resumed (browsers suspend until user gesture;\r\n            // _initSession runs from setTimeout, not a direct click handler)\r\n            try {\r\n                const ctx = this.audioEngine.getContext();\r\n                if (ctx.state === 'suspended') ctx.resume();\r\n            } catch (e) { /* context resume is best-effort */ }\r\n\r\n            if (cfg.audio?.binauralEnabled) {\r\n                if (cfg.audio.preset && Magic8.AudioEngine.FREQUENCY_PRESETS[cfg.audio.preset]) {\r\n                    this.audioEngine.startBinauralFromPreset(cfg.audio.preset);\r\n                } else if (cfg.audio.startBand) {\r\n                    this.audioEngine.startBinauralFromBands({\r\n                        startBand: cfg.audio.startBand,\r\n                        troughBand: cfg.audio.troughBand || cfg.audio.startBand,\r\n                        endBand: cfg.audio.endBand || cfg.audio.startBand,\r\n                        baseFreq: cfg.audio.baseFreq || 200,\r\n                        sweepDurationMin: cfg.audio.sweepDurationMin || 5\r\n                    });\r\n                } else {\r\n                    this.audioEngine.startBinaural(cfg.audio);\r\n                }\r\n                this.audioEnabled = true;\r\n            }\r\n\r\n            // Start isochronic tones if enabled\r\n            if (cfg.audio?.isochronicEnabled) {\r\n                this.audioEngine.startIsochronic(cfg.audio);\r\n            }\r\n\r\n            // Initialize biometric themer\r\n            if (cfg.biometrics?.enabled) {\r\n                this.biometricThemer = new Magic8.BiometricThemer();\r\n\r\n                if (cfg.biometrics.smoothingFactor) {\r\n                    this.biometricThemer.setSmoothingFactor(cfg.biometrics.smoothingFactor);\r\n                }\r\n\r\n                this._themeRedrawTimer = null;\r\n                this.biometricThemer.onThemeChange = (theme) => {\r\n                    this.currentTheme = theme;\r\n                    // Throttle m.redraw()  CSS custom properties update at 60fps via _applyTheme,\r\n                    // but mithril vdom diffing at 60fps causes Node.removeChild race conditions\r\n                    if (!this._themeRedrawTimer) {\r\n                        this._themeRedrawTimer = setTimeout(() => {\r\n                            this._themeRedrawTimer = null;\r\n                            m.redraw();\r\n                        }, 200);\r\n                    }\r\n                };\r\n\r\n                this._startBiometricCapture();\r\n            }\r\n\r\n            // Initialize image gallery\r\n            console.log('Magic8App: Initializing image gallery with config:', JSON.stringify(cfg.images));\r\n            this.imageGallery = new Magic8.DynamicImageGallery({\r\n                cycleInterval: cfg.images?.cycleInterval || 5000,\r\n                crossfadeDuration: cfg.images?.crossfadeDuration || 1000,\r\n                includeGenerated: cfg.images?.includeGenerated !== false,\r\n                maxGeneratedImages: cfg.imageGeneration?.maxGeneratedImages || 20\r\n            });\r\n\r\n            // Build group list, including generated images group when SD is enabled\r\n            const imageGroups = cfg.images?.baseGroups ? [...cfg.images.baseGroups] : [];\r\n            if (cfg.imageGeneration?.enabled) {\r\n                try {\r\n                    // Add session-specific generated subgroup (where images are actually saved)\r\n                    const sessionName = cfg.name || 'Session';\r\n                    const sessionGenDir = await page.findObject(\"auth.group\", \"DATA\", \"~/Magic8/Generated/\" + sessionName);\r\n                    if (sessionGenDir && sessionGenDir.objectId) {\r\n                        imageGroups.push(sessionGenDir.objectId);\r\n                        console.log('Magic8App: Added session generated group to gallery:', sessionGenDir.objectId);\r\n                    }\r\n                    // Also add parent ~/Magic8/Generated for any ungrouped images\r\n                    const genDir = await page.findObject(\"auth.group\", \"DATA\", \"~/Magic8/Generated\");\r\n                    if (genDir && genDir.objectId && !imageGroups.includes(genDir.objectId)) {\r\n                        imageGroups.push(genDir.objectId);\r\n                        console.log('Magic8App: Added ~/Magic8/Generated group to image gallery:', genDir.objectId);\r\n                    }\r\n                } catch (e) {\r\n                    console.warn('Magic8App: Could not add generated images group:', e);\r\n                }\r\n            }\r\n\r\n            if (imageGroups.length > 0) {\r\n                console.log('Magic8App: Loading base images from groups:', imageGroups);\r\n                const count = await this.imageGallery.loadBaseImages(imageGroups);\r\n                console.log('Magic8App: Loaded', count, 'base images');\r\n            } else {\r\n                console.warn('Magic8App: No base image groups configured');\r\n            }\r\n\r\n            this.imageGallery.onImageChange = (img) => {\r\n                // Crossfade: move current to prev, set new as current\r\n                this.prevImage = this.currentImage;\r\n                this.currentImage = img;\r\n                this.imageOpacity = 0;\r\n\r\n                // Pick emphasis animation for generated images\r\n                if (img && img.type === 'generated') {\r\n                    const duration = this.imageGallery._getDurationForImage(img);\r\n                    this._imageAnimation = this._pickImageAnimation(duration);\r\n                } else {\r\n                    this._imageAnimation = null;\r\n                }\r\n\r\n                m.redraw();\r\n\r\n                // Fade in new image, then trigger animation start\r\n                requestAnimationFrame(() => {\r\n                    this.imageOpacity = 1;\r\n                    if (this._imageAnimation) {\r\n                        // Start with 'from' transform, then after a frame switch to 'to'\r\n                        requestAnimationFrame(() => {\r\n                            if (this._imageAnimation) {\r\n                                this._imageAnimation._phase = 'to';\r\n                                m.redraw();\r\n                            }\r\n                        });\r\n                    }\r\n                    m.redraw();\r\n                });\r\n            };\r\n\r\n            // Show first image immediately\r\n            const firstImg = this.imageGallery.getCurrent();\r\n            if (firstImg) {\r\n                this.currentImage = firstImg;\r\n                this.imageOpacity = 1;\r\n            }\r\n\r\n            this.imageGallery.start();\r\n            this._startBreathing();\r\n            console.log('Magic8App: Gallery stats:', this.imageGallery.getStats());\r\n\r\n            // Initialize image generation\r\n            if (cfg.imageGeneration?.enabled) {\r\n                this.imageGenerator = new Magic8.ImageGenerationManager(\r\n                    cfg.imageGeneration.sdConfigId,\r\n                    cfg.imageGeneration.sdConfigId ? null : cfg.imageGeneration.sdInline\r\n                );\r\n                // Name session subgroup after session name for replayability\r\n                this.imageGenerator.sessionName = cfg.name || 'Session';\r\n                await this.imageGenerator.loadConfig();\r\n\r\n                this.imageGenerator.onImageGenerated = (img) => {\r\n                    this.imageGallery.showImmediate(img);\r\n                    this._lastGeneratedObj = img;\r\n                };\r\n\r\n                this.imageGenerator.onCaptureCreated = (capture) => {\r\n                    this._lastCaptureObj = capture;\r\n                    m.redraw();\r\n                };\r\n\r\n                this._startImageGeneration();\r\n            }\r\n\r\n            // Initialize text sequence\r\n            console.log('Magic8App: Text config:', JSON.stringify(cfg.text));\r\n            if (cfg.text?.enabled && cfg.text?.sourceObjectId) {\r\n                this.textSequence = new Magic8.TextSequenceManager();\r\n                this.textSequence.loop = cfg.text.loop !== false;\r\n                this.textSequence.displayDuration = cfg.text.displayDuration || 5000;\r\n\r\n                let lineCount = 0;\r\n                if (cfg.text.sourceType === 'note') {\r\n                    lineCount = await this.textSequence.loadFromNote(cfg.text.sourceObjectId);\r\n                } else {\r\n                    lineCount = await this.textSequence.loadFromDataObject(cfg.text.sourceObjectId);\r\n                }\r\n                console.log('Magic8App: Loaded', lineCount, 'text lines from', cfg.text.sourceType, cfg.text.sourceObjectId);\r\n\r\n                this.textSequence.onTextChange = (text) => {\r\n                    this.currentText = text;\r\n                    m.redraw();\r\n                };\r\n\r\n                this.textSequence.start();\r\n            } else if (cfg.text?.enabled) {\r\n                console.warn('Magic8App: Text enabled but no sourceObjectId selected');\r\n            }\r\n\r\n            // LLM-only text mode: create empty manager when director is enabled\r\n            if (!this.textSequence && cfg.director?.enabled) {\r\n                this.textSequence = new Magic8.TextSequenceManager();\r\n                this.textSequence.loop = true;\r\n                this.textSequence.displayDuration = cfg.text?.displayDuration || 8000;\r\n                this.textSequence.onTextChange = (text) => {\r\n                    this.currentText = text;\r\n                    m.redraw();\r\n                };\r\n                console.log('Magic8App: Created empty text manager for LLM-only mode');\r\n            }\r\n\r\n            // Initialize voice sequence\r\n            if (cfg.voice?.enabled && cfg.voice?.sourceObjectId) {\r\n                this.voiceSequence = new Magic8.VoiceSequenceManager(this.audioEngine);\r\n                this.voiceSequence.loop = cfg.voice.loop !== false;\r\n\r\n                let voiceLineCount = 0;\r\n                if (cfg.voice.sourceType === 'note') {\r\n                    voiceLineCount = await this.voiceSequence.loadFromNote(cfg.voice.sourceObjectId);\r\n                } else {\r\n                    voiceLineCount = await this.voiceSequence.loadFromDataObject(cfg.voice.sourceObjectId);\r\n                }\r\n                console.log('Magic8App: Loaded', voiceLineCount, 'voice lines');\r\n\r\n                if (voiceLineCount > 0) {\r\n                    // Pre-synthesize all lines\r\n                    console.log('Magic8App: Synthesizing voice lines...');\r\n                    if (cfg.director?.testMode) {\r\n                        this._debugLog('Voice: synthesizing ' + voiceLineCount + ' lines...', 'voice');\r\n                    }\r\n                    this.voiceSequence.onSynthesisProgress = (done, total) => {\r\n                        console.log(`Magic8App: Voice synthesis ${done}/${total}`);\r\n                        if (cfg.director?.testMode && (done === total || done % 5 === 0)) {\r\n                            this._debugLog('Voice synth: ' + done + '/' + total, 'voice');\r\n                        }\r\n                    };\r\n                    await this.voiceSequence.synthesizeAll(cfg.voice.voiceProfileId);\r\n\r\n                    // Log individual voice lines in test mode\r\n                    if (cfg.director?.testMode && this.voiceSequence.lines) {\r\n                        for (let i = 0; i < Math.min(this.voiceSequence.lines.length, 5); i++) {\r\n                            this._debugLog('Voice line: \"' + this.voiceSequence.lines[i] + '\"', 'voice');\r\n                        }\r\n                        if (this.voiceSequence.lines.length > 5) {\r\n                            this._debugLog('... +' + (this.voiceSequence.lines.length - 5) + ' more voice lines', 'voice');\r\n                        }\r\n                    }\r\n\r\n                    this.voiceSequence.start();\r\n                    console.log('Magic8App: Voice sequence playback started');\r\n                }\r\n            }\r\n\r\n            // Create empty voice manager when voice is enabled but no source file\r\n            // (allows LLM to inject voice lines, or manual use without pre-loaded content)\r\n            if (!this.voiceSequence && cfg.voice?.enabled) {\r\n                this.voiceSequence = new Magic8.VoiceSequenceManager(this.audioEngine);\r\n                this.voiceSequence.loop = cfg.voice?.loop !== false;\r\n                console.log('Magic8App: Created empty voice manager (no source file)');\r\n            }\r\n\r\n            // Initialize recording\r\n            if (cfg.recording?.enabled) {\r\n                this.sessionRecorder = new Magic8.SessionRecorder();\r\n                if (cfg.recording.autoStart) {\r\n                    // Delay to allow canvas to be rendered\r\n                    setTimeout(() => this._startRecording(), 1000);\r\n                }\r\n            }\r\n\r\n            // Initialize session director\r\n            this._sessionStartTime = Date.now();\r\n            if (cfg.director?.enabled && cfg.director?.command) {\r\n                // Ensure camera is running for face data, even if biometric theming is disabled\r\n                if (!cfg.biometrics?.enabled) {\r\n                    console.log('Magic8App: Starting biometric capture for session director');\r\n                    this._startBiometricCapture();\r\n                }\r\n\r\n                this.sessionDirector = new Magic8.SessionDirector();\r\n                this.sessionDirector.stateProvider = () => this._gatherDirectorState();\r\n                this.sessionDirector.onDirective = (d) => {\r\n                    this._applyDirective(d);\r\n                    if (this.sessionConfig?.director?.testMode) {\r\n                        if (d.audio) this._debugLog('Audio: ' + JSON.stringify(d.audio), 'directive');\r\n                        if (d.visuals) this._debugLog('Visual: ' + (d.visuals.effect || JSON.stringify(d.visuals)), 'directive');\r\n                        if (d.labels?.add?.length) this._debugLog('+ Labels: ' + d.labels.add.join(', '), 'label');\r\n                        if (d.labels?.remove?.length) this._debugLog('- Labels: ' + d.labels.remove.join(', '), 'label');\r\n                        if (d.generateImage) this._debugLog('Image: ' + (d.generateImage.description || '').substring(0, 80), 'directive');\r\n                        if (d.voiceLine) this._debugLog('Voice inject: \"' + d.voiceLine + '\"', 'voice');\r\n                        if (d.opacity) this._debugLog('Opacity: ' + JSON.stringify(d.opacity), 'directive');\r\n                        if (d.suggestMood) this._debugLog('Mood: ' + JSON.stringify(d.suggestMood), 'directive');\r\n                        if (d.progressPct != null) this._debugLog('Progress: ' + d.progressPct + '%', 'info');\r\n                        if (d.askUser) this._debugLog('askUser: \"' + d.askUser.question + '\"', 'pass');\r\n                        if (d.commentary) this._debugLog('LLM: ' + d.commentary, 'info');\r\n                        // Interactive mode tracking\r\n                        if (this.sessionConfig?.director?.interactive) {\r\n                            this._debugLog('Interactive tick #' + this._ticksSinceAskUser + (d.askUser ? '  askUser FIRED' : '  no askUser'), d.askUser ? 'pass' : 'warn');\r\n                        }\r\n                    }\r\n                };\r\n                this.sessionDirector.onError = (err) => {\r\n                    console.warn('SessionDirector error:', err);\r\n                    if (this.sessionConfig?.director?.testMode) {\r\n                        this._debugLog('Error: ' + (err.message || err), 'error');\r\n                    }\r\n                };\r\n                // Tick debug: log state message and raw LLM response in test mode\r\n                this.sessionDirector.onTickDebug = (info) => {\r\n                    if (!this.sessionConfig?.director?.testMode) return;\r\n                    // Log the interactive-relevant lines from the state message\r\n                    const stateLines = info.stateMessage.split('\\n');\r\n                    const interactiveLine = stateLines.find(l => l.startsWith('Interactive:'));\r\n                    const responseLine = stateLines.find(l => l.startsWith('User Response:'));\r\n                    if (interactiveLine) {\r\n                        this._debugLog('State  ' + interactiveLine, 'info');\r\n                    }\r\n                    if (responseLine) {\r\n                        this._debugLog('State  ' + responseLine, 'info');\r\n                    }\r\n                    // Log raw LLM output (truncated) so we can see what the LLM actually returned\r\n                    if (info.rawContent) {\r\n                        const raw = info.rawContent.length > 200 ? info.rawContent.substring(0, 200) + '...' : info.rawContent;\r\n                        this._debugLog('Raw LLM [#' + info.tickNum + ']: ' + raw, 'info');\r\n                    }\r\n                    // Log parse result\r\n                    if (!info.directive) {\r\n                        this._debugLog('Parse: FAILED (no valid directive)', 'fail');\r\n                    } else {\r\n                        const keys = Object.keys(info.directive).filter(k => k !== 'commentary');\r\n                        this._debugLog('Parse OK: {' + keys.join(', ') + '}', 'pass');\r\n                    }\r\n                };\r\n                await this.sessionDirector.initialize(cfg.director.command, cfg.director.intervalMs || 60000, cfg.name, {\r\n                    imageTags: cfg.director.imageTags || ''\r\n                });\r\n\r\n                if (cfg.director.testMode) {\r\n                    // Test mode: run multi-pass behavioral diagnostics\r\n                    // Each pass sends different biometric state to the LLM,\r\n                    // applies the returned directive synchronously, then\r\n                    // runDiagnostics verifies the state actually changed via stateProvider\r\n                    this._debugLog('Starting behavioral diagnostics...', 'info');\r\n                    const self = this;\r\n                    let passCount = 0;\r\n\r\n                    const results = await this.sessionDirector.runDiagnostics(\r\n                        cfg.director.command,\r\n                        (directive, passIndex, passName) => {\r\n                            passCount++;\r\n                            self._debugLog('Applying directive [' + passName + ']', 'directive');\r\n                            if (directive.labels?.add?.length) {\r\n                                self._debugLog('+ Labels: ' + directive.labels.add.join(', '), 'label');\r\n                            }\r\n                            if (directive.generateImage) {\r\n                                self._debugLog('Image: ' + (directive.generateImage.description || '').substring(0, 80), 'directive');\r\n                            }\r\n                            if (directive.commentary) {\r\n                                self._debugLog('LLM: ' + directive.commentary, 'info');\r\n                            }\r\n                            self._applyDirective(directive);\r\n                        },\r\n                        (entry) => {\r\n                            self._debugLog(\r\n                                (entry.pass ? 'PASS' : 'FAIL') + ': ' + entry.name + (entry.detail ? ' - ' + entry.detail : ''),\r\n                                entry.pass ? 'pass' : 'fail'\r\n                            );\r\n                        }\r\n                    );\r\n\r\n                    const passed = results.filter(r => r.pass).length;\r\n                    const total = results.length;\r\n                    this._debugLog('Diagnostics complete: ' + passed + '/' + total + ' passed (' + passCount + ' directives applied)', passed === total ? 'pass' : 'fail');\r\n                }\r\n\r\n                this.sessionDirector.start();\r\n            }\r\n\r\n            m.redraw();\r\n        },\r\n\r\n        // Biometric capture loop\r\n        _startBiometricCapture() {\r\n            if (!page.components.camera) {\r\n                console.warn('Magic8App: page.components.camera not available');\r\n                return;\r\n            }\r\n\r\n            const captureCallback = (imageData) => {\r\n                this._handleBiometricData(imageData);\r\n            };\r\n\r\n            // Apply configured capture interval (default camera is 5s)\r\n            const captureIntervalSec = this.sessionConfig?.biometrics?.captureInterval;\r\n            if (captureIntervalSec && captureIntervalSec > 0) {\r\n                page.components.camera.setCaptureInterval(captureIntervalSec);\r\n            }\r\n\r\n            // Ensure video element is in DOM before requesting camera\r\n            const tryStart = () => {\r\n                const devices = page.components.camera.devices();\r\n                console.log('Magic8App: Camera devices found:', devices.length);\r\n\r\n                if (!devices.length) {\r\n                    console.log('Magic8App: Initializing camera and finding devices...');\r\n                    page.components.camera.initializeAndFindDevices(captureCallback);\r\n                } else {\r\n                    console.log('Magic8App: Starting capture on existing device');\r\n                    page.components.camera.startCapture(captureCallback);\r\n                }\r\n            };\r\n\r\n            // Defer to ensure #facecam video element is rendered in DOM\r\n            if (!document.querySelector('#facecam')) {\r\n                console.log('Magic8App: Waiting for #facecam element...');\r\n                requestAnimationFrame(() => {\r\n                    m.redraw.sync();\r\n                    setTimeout(tryStart, 50);\r\n                });\r\n            } else {\r\n                tryStart();\r\n            }\r\n        },\r\n\r\n        _handleBiometricData(imageData) {\r\n            console.log('Magic8App: Biometric capture data:', imageData);\r\n            if (imageData && imageData.results?.length) {\r\n                const data = imageData.results[0];\r\n                console.log('Magic8App: Face analysis result:', data);\r\n                this.biometricData = data;\r\n\r\n                // Track emotion transitions (only store actual changes)\r\n                const emotion = data.dominant_emotion;\r\n                if (emotion) {\r\n                    const last = this._emotionHistory.length > 0\r\n                        ? this._emotionHistory[this._emotionHistory.length - 1]\r\n                        : null;\r\n                    if (!last || last.emotion !== emotion) {\r\n                        this._emotionHistory.push({ emotion, timestamp: Date.now() });\r\n                        // Keep only the last 10 transitions\r\n                        if (this._emotionHistory.length > 10) {\r\n                            this._emotionHistory = this._emotionHistory.slice(-10);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Update gender percentage from face data (unless LLM has overridden)\r\n                if (data.gender_scores) {\r\n                    const malePct = data.gender_scores.Man || 0;\r\n                    this._genderMalePct = Math.round(malePct);\r\n                }\r\n\r\n                if (this.biometricThemer) {\r\n                    this.biometricThemer.updateFromBiometrics(data);\r\n                }\r\n            }\r\n        },\r\n\r\n        // Image generation from camera\r\n        _startImageGeneration() {\r\n            const interval = Math.max(this.sessionConfig?.imageGeneration?.captureInterval || 120000, 60000);\r\n            console.log('Magic8App: Image generation interval:', interval, 'ms');\r\n\r\n            // Poll for biometric data availability, then fire first generation\r\n            this._initialGenCheck = setInterval(async () => {\r\n                if (page.components.camera && this.imageGenerator && this.biometricData) {\r\n                    clearInterval(this._initialGenCheck);\r\n                    this._initialGenCheck = null;\r\n                    console.log('Magic8App: Triggering initial image generation (face detected)');\r\n                    await this.imageGenerator.captureAndGenerate(\r\n                        page.components.camera,\r\n                        this.biometricData\r\n                    );\r\n                }\r\n            }, 5000);\r\n\r\n            this.imageGenInterval = setInterval(async () => {\r\n                if (page.components.camera && this.imageGenerator && this.biometricData) {\r\n                    console.log('Magic8App: Triggering image generation capture (face detected)');\r\n                    await this.imageGenerator.captureAndGenerate(\r\n                        page.components.camera,\r\n                        this.biometricData\r\n                    );\r\n                }\r\n            }, interval);\r\n        },\r\n\r\n        // Pick a random emphasis animation for generated images (Ken Burns-style)\r\n        _pickImageAnimation(durationMs) {\r\n            const dur = (durationMs || 5000) / 1000;\r\n            const animations = [\r\n                // Slow zoom in\r\n                { from: 'scale(1)', to: 'scale(1.15)' },\r\n                // Slow zoom out\r\n                { from: 'scale(1.15)', to: 'scale(1)' },\r\n                // Pan right + slight zoom\r\n                { from: 'scale(1.08) translateX(-3%)', to: 'scale(1.08) translateX(3%)' },\r\n                // Pan left + slight zoom\r\n                { from: 'scale(1.08) translateX(3%)', to: 'scale(1.08) translateX(-3%)' },\r\n                // Pan up + zoom\r\n                { from: 'scale(1.1) translateY(3%)', to: 'scale(1.1) translateY(-3%)' },\r\n                // Pan down + zoom\r\n                { from: 'scale(1.1) translateY(-3%)', to: 'scale(1.1) translateY(3%)' },\r\n                // Diagonal drift\r\n                { from: 'scale(1.1) translate(-2%, -2%)', to: 'scale(1.1) translate(2%, 2%)' },\r\n                // Reverse diagonal drift\r\n                { from: 'scale(1.1) translate(2%, -2%)', to: 'scale(1.1) translate(-2%, 2%)' }\r\n            ];\r\n            const pick = animations[Math.floor(Math.random() * animations.length)];\r\n            return {\r\n                from: { transform: pick.from, transition: 'none' },\r\n                to: { transform: pick.to, transition: 'transform ' + dur + 's ease-in-out' }\r\n            };\r\n        },\r\n\r\n        // Ambient opacity breathing\r\n        _startBreathing() {\r\n            this.ambientOpacity = 0.15;\r\n            this._breatheStep(true);\r\n        },\r\n\r\n        _breatheStep(goingUp) {\r\n            if (this.phase !== 'running' && this.phase !== 'paused') return;\r\n\r\n            // Random half-cycle: 2-4 minutes\r\n            const halfCycleMs = (120 + Math.random() * 120) * 1000;\r\n            this._breatheTransitionMs = halfCycleMs;\r\n\r\n            if (goingUp) {\r\n                // Random upper bound between 0.5 and 0.85\r\n                this.ambientOpacity = 0.5 + Math.random() * 0.35;\r\n            } else {\r\n                // Dim phase\r\n                this.ambientOpacity = 0.1;\r\n            }\r\n            m.redraw();\r\n\r\n            this._breatheTimeout = setTimeout(() => {\r\n                this._breatheStep(!goingUp);\r\n            }, halfCycleMs);\r\n        },\r\n\r\n        _stopBreathing() {\r\n            if (this._breatheTimeout) {\r\n                clearTimeout(this._breatheTimeout);\r\n                this._breatheTimeout = null;\r\n            }\r\n        },\r\n\r\n        // Recording controls\r\n        async _startRecording() {\r\n            if (!this.sessionRecorder) return;\r\n\r\n            const container = this.containerElement;\r\n            if (!container) {\r\n                console.warn('Magic8App: Container not found for recording');\r\n                this._debugLog('Recording: container not found', 'warn');\r\n                return;\r\n            }\r\n\r\n            // Create compositing canvas at container size\r\n            const w = container.clientWidth;\r\n            const h = container.clientHeight;\r\n            const compCanvas = document.createElement('canvas');\r\n            compCanvas.width = w;\r\n            compCanvas.height = h;\r\n            this._recCanvas = compCanvas;\r\n            this._recCtx = compCanvas.getContext('2d');\r\n\r\n            // Pre-load current background image\r\n            this._recImage = new Image();\r\n            this._recImage.crossOrigin = 'anonymous';\r\n            this._recImageUrl = '';\r\n            this._recPrevImage = new Image();\r\n            this._recPrevImage.crossOrigin = 'anonymous';\r\n            if (this.currentImage?.url) {\r\n                this._recImage.src = this.currentImage.url;\r\n                this._recImageUrl = this.currentImage.url;\r\n            }\r\n\r\n            // Start compositing loop\r\n            this._recCompositing = true;\r\n            this._compositeFrame();\r\n\r\n            // Capture stream from compositing canvas + audio\r\n            const audioDestination = this.audioEngine?.getDestination();\r\n            console.log('Magic8App: Starting recording, composite:', w + 'x' + h,\r\n                'audio:', audioDestination ? 'yes' : 'no');\r\n\r\n            try {\r\n                await this.sessionRecorder.startRecording(compCanvas, audioDestination, {\r\n                    maxDurationMin: this.sessionConfig?.recording?.maxDurationMin || 30\r\n                });\r\n                this.isRecording = true;\r\n                this._debugLog('Recording started (composite)', 'info');\r\n                m.redraw();\r\n            } catch (err) {\r\n                this._recCompositing = false;\r\n                console.error('Magic8App: Failed to start recording:', err);\r\n                this._debugLog('Recording failed: ' + err.message, 'error');\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Compositing loop  draws all visual layers onto the recording canvas each frame\r\n         * @private\r\n         */\r\n        _compositeFrame() {\r\n            if (!this._recCompositing) return;\r\n\r\n            const ctx = this._recCtx;\r\n            const w = this._recCanvas.width;\r\n            const h = this._recCanvas.height;\r\n\r\n            // 1. Background color\r\n            const bg = this.currentTheme?.bg || [20, 20, 30];\r\n            ctx.fillStyle = `rgb(${bg[0]},${bg[1]},${bg[2]})`;\r\n            ctx.fillRect(0, 0, w, h);\r\n\r\n            // 2. Background image (cover-style with ambient + director opacity)\r\n            const imgUrl = this.currentImage?.url || '';\r\n            if (imgUrl && imgUrl !== this._recImageUrl) {\r\n                // Image changed  shift current to prev for crossfade\r\n                this._recPrevImage.src = this._recImageUrl;\r\n                this._recImage.src = imgUrl;\r\n                this._recImageUrl = imgUrl;\r\n            }\r\n\r\n            const imgAlpha = (this.ambientOpacity || 1) * (this._layerOpacity?.images || 1);\r\n            // Draw previous image at full opacity during crossfade\r\n            if (this._recPrevImage.complete && this._recPrevImage.naturalWidth > 0 && this.imageOpacity < 1) {\r\n                ctx.globalAlpha = imgAlpha;\r\n                this._drawCover(ctx, this._recPrevImage, w, h);\r\n            }\r\n            // Draw current image at crossfade opacity\r\n            if (this._recImage.complete && this._recImage.naturalWidth > 0) {\r\n                ctx.globalAlpha = imgAlpha * (this.imageOpacity != null ? this.imageOpacity : 1);\r\n                this._drawCover(ctx, this._recImage, w, h);\r\n            }\r\n            ctx.globalAlpha = 1;\r\n\r\n            // 3. HypnoCanvas visual effects\r\n            const hypnoCanvas = this.containerElement?.querySelector('.hypno-canvas');\r\n            if (hypnoCanvas && hypnoCanvas.width > 0) {\r\n                const visAlpha = (this.ambientOpacity != null ? Math.min(1, this.ambientOpacity + 0.4) : 0.7)\r\n                    * (this._layerOpacity?.visuals || 1);\r\n                ctx.globalAlpha = visAlpha;\r\n                ctx.drawImage(hypnoCanvas, 0, 0, w, h);\r\n                ctx.globalAlpha = 1;\r\n            }\r\n\r\n            // 4. Audio visualizer canvas (screen blend)\r\n            const vizCanvas = this.containerElement?.querySelector('.audio-visualizer-overlay canvas');\r\n            if (vizCanvas && vizCanvas.width > 0) {\r\n                const vizAlpha = (this.sessionConfig?.audio?.visualizerOpacity || 0.35)\r\n                    * (this._layerOpacity?.visualizer || 1);\r\n                ctx.globalAlpha = vizAlpha;\r\n                ctx.globalCompositeOperation = 'screen';\r\n                ctx.drawImage(vizCanvas, 0, 0, w, h);\r\n                ctx.globalCompositeOperation = 'source-over';\r\n                ctx.globalAlpha = 1;\r\n            }\r\n\r\n            // 5. Dark overlay for text readability\r\n            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';\r\n            ctx.fillRect(0, 0, w, h);\r\n\r\n            // 6. Text labels  read from DOM to capture exact positions and styling\r\n            const labelEls = this.containerElement?.querySelectorAll('.bio-label');\r\n            if (labelEls && labelEls.length > 0) {\r\n                const cRect = this.containerElement.getBoundingClientRect();\r\n                const layerAlpha = this._layerOpacity?.labels || 1;\r\n                labelEls.forEach(el => {\r\n                    const rect = el.getBoundingClientRect();\r\n                    const x = rect.left - cRect.left;\r\n                    const y = rect.top - cRect.top;\r\n                    const style = getComputedStyle(el);\r\n                    const opacity = (parseFloat(style.opacity) || 0) * layerAlpha;\r\n                    if (opacity < 0.01) return;\r\n\r\n                    ctx.globalAlpha = opacity;\r\n                    ctx.fillStyle = style.color || 'rgba(255,255,255,0.7)';\r\n                    ctx.font = style.fontSize + ' ' + (style.fontFamily || 'Georgia, serif');\r\n\r\n                    // Approximate text shadow as glow\r\n                    const glow = this.currentTheme?.glow;\r\n                    if (glow) {\r\n                        ctx.shadowColor = `rgba(${glow[0]},${glow[1]},${glow[2]},0.5)`;\r\n                        ctx.shadowBlur = 16;\r\n                    }\r\n                    ctx.fillText(el.textContent, x, y + rect.height * 0.75);\r\n                    ctx.shadowBlur = 0;\r\n                });\r\n                ctx.globalAlpha = 1;\r\n            }\r\n\r\n            requestAnimationFrame(() => this._compositeFrame());\r\n        },\r\n\r\n        /**\r\n         * Draw an image cover-style (CSS background-size: cover equivalent)\r\n         * @private\r\n         */\r\n        _drawCover(ctx, img, cw, ch) {\r\n            const imgRatio = img.naturalWidth / img.naturalHeight;\r\n            const canvasRatio = cw / ch;\r\n            let sx, sy, sw, sh;\r\n            if (imgRatio > canvasRatio) {\r\n                sh = img.naturalHeight;\r\n                sw = sh * canvasRatio;\r\n                sx = (img.naturalWidth - sw) / 2;\r\n                sy = 0;\r\n            } else {\r\n                sw = img.naturalWidth;\r\n                sh = sw / canvasRatio;\r\n                sx = 0;\r\n                sy = (img.naturalHeight - sh) / 2;\r\n            }\r\n            ctx.drawImage(img, sx, sy, sw, sh, 0, 0, cw, ch);\r\n        },\r\n\r\n        /**\r\n         * Stop the compositing loop and release the recording canvas\r\n         * @private\r\n         */\r\n        _stopCompositing() {\r\n            this._recCompositing = false;\r\n            this._recCanvas = null;\r\n            this._recCtx = null;\r\n            this._recImage = null;\r\n            this._recPrevImage = null;\r\n            this._recImageUrl = '';\r\n        },\r\n\r\n        async _stopRecording() {\r\n            const recorder = this.sessionRecorder;\r\n            if (!recorder || !this.isRecording) return;\r\n\r\n            this._stopCompositing();\r\n\r\n            try {\r\n                const blob = await recorder.stopRecording();\r\n                this.isRecording = false;\r\n\r\n                if (blob && blob.size > 0) {\r\n                    const sizeMB = (blob.size / (1024 * 1024)).toFixed(1);\r\n                    if (page.toast) page.toast('info', `Saving recording (${sizeMB} MB)...`);\r\n                    await recorder.saveToServer(blob, this.sessionConfig?.name);\r\n                    console.log(`Magic8App: Recording saved to server (${sizeMB} MB)`);\r\n                    if (page.toast) page.toast('info', `Recording saved (${sizeMB} MB)`);\r\n                } else {\r\n                    console.warn('Magic8App: Recording blob is empty');\r\n                    if (page.toast) page.toast('warn', 'Recording was empty');\r\n                }\r\n\r\n                m.redraw();\r\n            } catch (err) {\r\n                console.error('Magic8App: Failed to stop recording:', err);\r\n                this.isRecording = false;\r\n                if (page.toast) page.toast('error', 'Recording failed: ' + err.message);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Stop recording and dispose the recorder (used during cleanup to avoid race)\r\n         * @param {Object} recorder - SessionRecorder instance\r\n         * @private\r\n         */\r\n        async _stopRecordingAndDispose(recorder) {\r\n            this._stopCompositing();\r\n            try {\r\n                const blob = await recorder.stopRecording();\r\n                this.isRecording = false;\r\n\r\n                if (blob && blob.size > 0) {\r\n                    const sizeMB = (blob.size / (1024 * 1024)).toFixed(1);\r\n                    console.log(`Magic8App: Saving recording on exit (${sizeMB} MB)`);\r\n                    await recorder.saveToServer(blob, this.sessionConfig?.name);\r\n                    console.log(`Magic8App: Recording saved to server (${sizeMB} MB)`);\r\n                }\r\n            } catch (err) {\r\n                console.warn('Magic8App: Could not save recording on exit:', err);\r\n                this.isRecording = false;\r\n            } finally {\r\n                recorder.dispose();\r\n            }\r\n        },\r\n\r\n        _toggleRecording() {\r\n            if (this.isRecording) {\r\n                this._stopRecording();\r\n            } else {\r\n                this._startRecording();\r\n            }\r\n        },\r\n\r\n        _togglePause() {\r\n            if (this.phase === 'running') {\r\n                this.phase = 'paused';\r\n                this.textSequence?.pause();\r\n                this.voiceSequence?.pause();\r\n                this.imageGallery?.stop();\r\n                this.audioEngine?.stopIsochronic();\r\n                this._stopBreathing();\r\n                this.sessionDirector?.pause();\r\n            } else if (this.phase === 'paused') {\r\n                this.phase = 'running';\r\n                this.textSequence?.resume();\r\n                this.voiceSequence?.resume();\r\n                this.imageGallery?.start();\r\n                if (this.sessionConfig?.audio?.isochronicEnabled && this.audioEnabled) {\r\n                    this.audioEngine?.startIsochronic(this.sessionConfig.audio);\r\n                }\r\n                this._startBreathing();\r\n                this.sessionDirector?.resume();\r\n            }\r\n            m.redraw();\r\n        },\r\n\r\n        _toggleAudio() {\r\n            this.audioEnabled = !this.audioEnabled;\r\n            const cfg = this.sessionConfig;\r\n\r\n            if (this.audioEnabled) {\r\n                // Restore master volume\r\n                this.audioEngine?.setVolume(1.0);\r\n                // Restart binaural\r\n                if (cfg?.audio?.binauralEnabled) {\r\n                    if (cfg.audio.preset && Magic8.AudioEngine.FREQUENCY_PRESETS[cfg.audio.preset]) {\r\n                        this.audioEngine?.startBinauralFromPreset(cfg.audio.preset);\r\n                    } else if (cfg.audio.startBand) {\r\n                        this.audioEngine?.startBinauralFromBands({\r\n                            startBand: cfg.audio.startBand,\r\n                            troughBand: cfg.audio.troughBand || cfg.audio.startBand,\r\n                            endBand: cfg.audio.endBand || cfg.audio.startBand,\r\n                            baseFreq: cfg.audio.baseFreq || 200,\r\n                            sweepDurationMin: cfg.audio.sweepDurationMin || 5\r\n                        });\r\n                    } else {\r\n                        this.audioEngine?.startBinaural(cfg.audio);\r\n                    }\r\n                }\r\n                // Restart isochronic\r\n                if (cfg?.audio?.isochronicEnabled) {\r\n                    this.audioEngine?.startIsochronic(cfg.audio);\r\n                }\r\n                // Resume voice playback\r\n                this.voiceSequence?.resume();\r\n            } else {\r\n                // Stop all audio sources\r\n                this.audioEngine?.stopBinaural();\r\n                this.audioEngine?.stopIsochronic();\r\n                // Pause voice so it doesn't advance while muted\r\n                this.voiceSequence?.pause();\r\n                // Mute master gain as safety net\r\n                this.audioEngine?.setVolume(0);\r\n            }\r\n\r\n            m.redraw();\r\n        },\r\n\r\n        _toggleFullscreen() {\r\n            if (this.containerElement) {\r\n                this.fullscreenManager.toggleFullscreen(this.containerElement);\r\n            }\r\n        },\r\n\r\n        // Handle exit\r\n        async _handleExit() {\r\n            // Save recording BEFORE cleanup/navigation so the blob download completes\r\n            await this._finalizeRecording();\r\n\r\n            try {\r\n                this._cleanup();\r\n            } catch (err) {\r\n                console.error('Magic8App: Cleanup error during exit:', err);\r\n            }\r\n\r\n            // Check if we came from chat\r\n            if (this.chatContext) {\r\n                const returnContext = {\r\n                    sessionId: this.sessionConfig?.name,\r\n                    timestamp: Date.now()\r\n                };\r\n                sessionStorage.setItem('magic8Return', JSON.stringify(returnContext));\r\n                window.history.back();\r\n            } else {\r\n                // Navigate to home or previous view\r\n                if (m.route && m.route.set) {\r\n                    m.route.set('/main');\r\n                } else {\r\n                    window.history.back();\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Stop recording and download the file before exit.\r\n         * Awaited by _handleExit so the blob download completes before navigation.\r\n         * @private\r\n         */\r\n        async _finalizeRecording() {\r\n            if (!this.isRecording || !this.sessionRecorder) return;\r\n\r\n            this._stopCompositing();\r\n            const recorder = this.sessionRecorder;\r\n            this.sessionRecorder = null; // prevent _cleanup from re-processing\r\n            this.isRecording = false;\r\n\r\n            try {\r\n                console.log('Magic8App: Finalizing recording before exit...');\r\n                const blob = await recorder.stopRecording();\r\n\r\n                if (blob && blob.size > 0) {\r\n                    const sizeMB = (blob.size / (1024 * 1024)).toFixed(1);\r\n                    console.log(`Magic8App: Saving recording before exit (${sizeMB} MB)`);\r\n                    await recorder.saveToServer(blob, this.sessionConfig?.name);\r\n                    console.log(`Magic8App: Recording saved to server (${sizeMB} MB)`);\r\n                    if (page.toast) page.toast('info', `Recording saved (${sizeMB} MB)`);\r\n                } else {\r\n                    console.warn('Magic8App: Recording blob was empty on exit');\r\n                }\r\n            } catch (err) {\r\n                console.warn('Magic8App: Could not save recording on exit:', err);\r\n            } finally {\r\n                recorder.dispose();\r\n            }\r\n        },\r\n\r\n        // Cleanup (guarded against double-call from _handleExit + onremove)\r\n        _cleanup() {\r\n            if (this._cleaned) return;\r\n            this._cleaned = true;\r\n\r\n            clearInterval(this.biometricInterval);\r\n            clearInterval(this.imageCycleInterval);\r\n            clearInterval(this.imageGenInterval);\r\n            if (this._initialGenCheck) {\r\n                clearInterval(this._initialGenCheck);\r\n            }\r\n            this._stopBreathing();\r\n            this._stopCompositing();\r\n            if (this._opacityRafId) {\r\n                cancelAnimationFrame(this._opacityRafId);\r\n                this._opacityRafId = null;\r\n            }\r\n\r\n            // Stop recording FIRST (before audio disposal kills its tracks)\r\n            // If _finalizeRecording already ran (via _handleExit), sessionRecorder is null\r\n            if (this.isRecording && this.sessionRecorder) {\r\n                const recorder = this.sessionRecorder;\r\n                this.sessionRecorder = null;\r\n                this._stopRecordingAndDispose(recorder);\r\n            } else if (this.sessionRecorder) {\r\n                this.sessionRecorder.dispose();\r\n                this.sessionRecorder = null;\r\n            }\r\n\r\n            // Stop camera\r\n            if (page.components.camera) {\r\n                page.components.camera.stopCapture();\r\n            }\r\n\r\n            // Stop audio\r\n            this.audioEngine?.dispose();\r\n\r\n            // Stop text\r\n            this.textSequence?.dispose();\r\n\r\n            // Stop voice\r\n            this.voiceSequence?.dispose();\r\n\r\n            // Stop gallery\r\n            this.imageGallery?.dispose();\r\n\r\n            // Stop generation\r\n            this.imageGenerator?.dispose();\r\n\r\n            // Stop interactive STT if active\r\n            if (this._sttMediaRecorder) {\r\n                try { this._sttMediaRecorder.stop(); } catch (e) { /* ignore */ }\r\n                this._sttMediaRecorder = null;\r\n            }\r\n            if (this._sttMediaStream) {\r\n                this._sttMediaStream.getTracks().forEach(t => t.stop());\r\n                this._sttMediaStream = null;\r\n            }\r\n            page.audioStream = undefined;\r\n            if (this._responseTimeoutId) {\r\n                clearTimeout(this._responseTimeoutId);\r\n                this._responseTimeoutId = null;\r\n            }\r\n            if (this._interactionIdleTimer) {\r\n                clearInterval(this._interactionIdleTimer);\r\n                this._interactionIdleTimer = null;\r\n            }\r\n            this._pendingQuestion = null;\r\n            this._voicePausedForInteraction = false;\r\n\r\n            // Stop session director and clear session data\r\n            this.sessionDirector?.dispose();\r\n            this.sessionLabels = [];\r\n            this.sessionVoiceLines = [];\r\n\r\n            // Stop biometric themer\r\n            if (this._themeRedrawTimer) {\r\n                clearTimeout(this._themeRedrawTimer);\r\n                this._themeRedrawTimer = null;\r\n            }\r\n            this.biometricThemer?.dispose();\r\n\r\n            // Exit fullscreen\r\n            this.fullscreenManager?.exitFullscreen();\r\n            this.fullscreenManager?.dispose();\r\n        },\r\n\r\n        // View\r\n        view(vnode) {\r\n            // Config phase - show setup editor\r\n            if (this.phase === 'config') {\r\n                return m('.magic8-wrapper', [\r\n                    m(Magic8.SessionConfigEditor, {\r\n                        config: this.sessionConfig,\r\n                        onSave: async (config) => {\r\n                            this.sessionConfig = config;\r\n                            this.phase = 'running';\r\n                            m.redraw();\r\n\r\n                            // Save session config to server\r\n                            this._saveSessionConfig(config);\r\n\r\n                            // Defer init to next frame so DOM is ready\r\n                            setTimeout(() => this._initSession(), 100);\r\n                        },\r\n                        onCancel: () => this._handleExit()\r\n                    }),\r\n                    page.components.dialog && page.components.dialog.loadDialog()\r\n                ]);\r\n            }\r\n\r\n            // Running / Paused phase - full immersive experience\r\n            const bgColor = this.currentTheme?.bg\r\n                ? `rgb(${this.currentTheme.bg.join(',')})`\r\n                : 'rgb(20, 20, 30)';\r\n\r\n            return m('.magic8-app.fixed.inset-0.overflow-hidden', {\r\n                style: {\r\n                    background: bgColor,\r\n                    transition: 'background 1s ease'\r\n                }\r\n            }, [\r\n                // Background image container - ambient breathing controls overall opacity, director can dim\r\n                m('.magic8-bg-container.absolute.inset-0.overflow-hidden', {\r\n                    style: {\r\n                        opacity: this.ambientOpacity * this._layerOpacity.images,\r\n                        transition: `opacity ${this._breatheTransitionMs}ms ease-in-out`,\r\n                        zIndex: 1\r\n                    }\r\n                }, [\r\n                    this.prevImage && m('.magic8-bg-prev.absolute.inset-0', {\r\n                        style: {\r\n                            backgroundImage: `url(\"${this.prevImage.url}\")`,\r\n                            backgroundSize: 'cover',\r\n                            backgroundPosition: 'center'\r\n                        }\r\n                    }),\r\n                    this.currentImage && (() => {\r\n                        const anim = this._imageAnimation;\r\n                        const phase = anim ? (anim._phase === 'to' ? anim.to : anim.from) : null;\r\n                        const crossfade = (this.sessionConfig?.images?.crossfadeDuration || 1000);\r\n                        const transitions = ['opacity ' + crossfade + 'ms ease-in-out'];\r\n                        if (phase && phase.transition && phase.transition !== 'none') {\r\n                            transitions.push(phase.transition);\r\n                        }\r\n                        return m('.magic8-bg-current.absolute.inset-0', {\r\n                            style: {\r\n                                backgroundImage: `url(\"${this.currentImage.url}\")`,\r\n                                backgroundSize: 'cover',\r\n                                backgroundPosition: 'center',\r\n                                opacity: this.imageOpacity,\r\n                                transform: phase ? phase.transform : '',\r\n                                transition: transitions.join(', ')\r\n                            }\r\n                        });\r\n                    })()\r\n                ]),\r\n\r\n                // Visual effects canvas layer (breathing opacity synced with background, director can dim)\r\n                m('.absolute.inset-0.z-5.pointer-events-none', {\r\n                    style: {\r\n                        opacity: (this.ambientOpacity != null ? Math.min(1, this.ambientOpacity + 0.4) : 0.7) * this._layerOpacity.visuals,\r\n                        transition: `opacity ${this._breatheTransitionMs || 2000}ms ease-in-out`\r\n                    }\r\n                }, m(Magic8.HypnoCanvas, {\r\n                    theme: this.currentTheme,\r\n                    visuals: this.sessionConfig?.visuals,\r\n                    class: 'absolute inset-0'\r\n                })),\r\n\r\n                // Audio visualizer overlay (between effects and dark overlay, director can dim)\r\n                this.sessionConfig?.audio?.visualizerEnabled && this.audioEngine &&\r\n                    m(Magic8.AudioVisualizerOverlay, {\r\n                        audioEngine: this.audioEngine,\r\n                        opacity: (this.sessionConfig.audio.visualizerOpacity || 0.35) * this._layerOpacity.visualizer,\r\n                        gradient: this.sessionConfig.audio.visualizerGradient || 'prism',\r\n                        mode: this.sessionConfig.audio.visualizerMode || 2\r\n                    }),\r\n\r\n                // Dark overlay for text readability\r\n                m('.absolute.inset-0.z-10.bg-black', {\r\n                    style: { opacity: 0.3 }\r\n                }),\r\n\r\n                // Gender confidence bar (only when mood ring is enabled)\r\n                this.moodRingEnabled && m('.absolute.inset-x-0.pointer-events-none', {\r\n                    style: {\r\n                        height: '33vh',\r\n                        top: '50%',\r\n                        transform: 'translateY(-50%)',\r\n                        opacity: 0.25,\r\n                        zIndex: 11,\r\n                        background: 'linear-gradient(to right, rgba(255,182,193,' + ((100 - this._genderMalePct) / 100) + '), rgba(135,206,235,' + (this._genderMalePct / 100) + '))',\r\n                        transition: 'background 2s ease-in-out'\r\n                    }\r\n                }),\r\n\r\n                // Animated floating text labels, styled by biometric theme (director can dim)\r\n                m(Magic8.BiometricOverlay, {\r\n                    text: this.currentText,\r\n                    theme: this.currentTheme,\r\n                    opacity: this._layerOpacity.labels\r\n                }),\r\n\r\n                // Paused overlay (tappable for mobile resume)\r\n                this.phase === 'paused' && m('.absolute.inset-0.z-40.flex.items-center.justify-center.bg-black/50.cursor-pointer', {\r\n                    onclick: () => this._togglePause()\r\n                }, [\r\n                    m('.text-center.text-white', [\r\n                        m('.text-4xl.mb-4', 'Paused'),\r\n                        m('.text-lg.text-gray-400', 'Tap or press SPACE to resume')\r\n                    ])\r\n                ]),\r\n\r\n                // Recording indicator\r\n                this.isRecording && m(Magic8.RecordingIndicator, {\r\n                    recorder: this.sessionRecorder\r\n                }),\r\n\r\n                // Interactive director overlay (askUser)\r\n                this._pendingQuestion && m('.fixed.inset-x-0.bottom-20.flex.justify-center.px-4', {\r\n                    style: { zIndex: 200 }\r\n                }, [\r\n                    m('.bg-gray-900/95.backdrop-blur.rounded-2xl.p-5.max-w-lg.w-full.shadow-2xl.border.border-cyan-500/30', [\r\n                        // Question text\r\n                        m('.text-cyan-300.text-lg.font-medium.mb-4.text-center', this._pendingQuestion.question),\r\n                        // Input hint\r\n                        m('.flex.items-center.justify-center.gap-2.mb-3.text-sm.text-gray-400', [\r\n                            m('span.material-symbols-outlined.text-cyan-400', 'chat'),\r\n                            'Type your response below'\r\n                        ]),\r\n                        // Text input + submit\r\n                        m('.flex.gap-2', [\r\n                            m('input.flex-1.bg-gray-800.text-white.rounded-lg.px-4.py-3.border.border-gray-600.focus\\\\:border-cyan-400.outline-none', {\r\n                                placeholder: 'Type your response...',\r\n                                value: this._userInputText,\r\n                                oninput: (e) => { this._userInputText = e.target.value; this._lastTypingTime = Date.now(); },\r\n                                onkeydown: (e) => { if (e.key === 'Enter') this._submitUserResponse(); }\r\n                            }),\r\n                            m('button.bg-cyan-600.hover\\\\:bg-cyan-500.text-white.px-5.py-3.rounded-lg.font-medium.transition-colors', {\r\n                                onclick: () => this._submitUserResponse()\r\n                            }, 'Send')\r\n                        ])\r\n                    ])\r\n                ]),\r\n\r\n                // Control panel\r\n                m(Magic8.ControlPanel, {\r\n                    config: this.sessionConfig,\r\n                    state: {\r\n                        isRecording: this.isRecording,\r\n                        audioEnabled: this.audioEnabled,\r\n                        isFullscreen: this.isFullscreen,\r\n                        moodRingEnabled: this.moodRingEnabled,\r\n                        testMode: this.sessionConfig?.director?.testMode || false,\r\n                        emotion: this.biometricData?.dominant_emotion || 'neutral',\r\n                        gender: this.biometricData?.dominant_gender || null,\r\n                        suggestedEmotion: this._suggestedEmotion,\r\n                        suggestedGender: this._suggestedGender,\r\n                        moodColor: this.moodRingColor\r\n                    },\r\n                    autoHideDelay: this.sessionConfig?.display?.controlsAutoHide || 5000,\r\n                    onToggleRecording: () => this._toggleRecording(),\r\n                    onToggleAudio: () => this._toggleAudio(),\r\n                    onToggleFullscreen: () => this._toggleFullscreen(),\r\n                    onToggleMoodRing: () => {\r\n                        this.moodRingEnabled = !this.moodRingEnabled;\r\n                        if (!this.moodRingEnabled) {\r\n                            this.moodRingColor = null;\r\n                        }\r\n                    },\r\n                    onToggleTestMode: () => {\r\n                        if (!this.sessionConfig) return;\r\n                        if (!this.sessionConfig.director) this.sessionConfig.director = {};\r\n                        this.sessionConfig.director.testMode = !this.sessionConfig.director.testMode;\r\n                        if (this.sessionConfig.director.testMode) {\r\n                            this._debugLog('Test mode enabled via control panel', 'info');\r\n                        }\r\n                    },\r\n                    onOpenConfig: () => {\r\n                        this.phase = 'config';\r\n                        m.redraw();\r\n                    },\r\n                    onExit: () => this._handleExit()\r\n                }),\r\n\r\n                // Hidden camera view (needed for biometrics AND director/image generation)\r\n                page.components.camera && (this.sessionConfig?.biometrics?.enabled || this.sessionConfig?.director?.enabled || this.sessionConfig?.imageGeneration?.enabled)\r\n                    ? page.components.camera.videoView()\r\n                    : null,\r\n\r\n                // Test mode emoji display (top-left)\r\n                this.sessionConfig?.director?.testMode && this.biometricData &&\r\n                    m(Magic8.MoodEmojiDisplay, {\r\n                        emotion: this.biometricData?.dominant_emotion || 'neutral',\r\n                        gender: this.biometricData?.dominant_gender || null,\r\n                        suggestedEmotion: this._suggestedEmotion,\r\n                        suggestedGender: this._suggestedGender\r\n                    }),\r\n\r\n                // On-screen debug console (test mode only)\r\n                this.sessionConfig?.director?.testMode && this.debugMessages.length > 0 &&\r\n                    m('.magic8-debug-console', {\r\n                        style: {\r\n                            position: 'fixed',\r\n                            bottom: '10px',\r\n                            right: '10px',\r\n                            width: '440px',\r\n                            maxHeight: this._debugMinimized ? '32px' : '40vh',\r\n                            backgroundColor: 'rgba(0, 0, 0, 0.88)',\r\n                            borderRadius: '6px',\r\n                            border: '1px solid rgba(100, 255, 100, 0.2)',\r\n                            zIndex: 200,\r\n                            fontFamily: \"'Consolas', 'Monaco', monospace\",\r\n                            fontSize: '11px',\r\n                            overflow: 'hidden',\r\n                            display: 'flex',\r\n                            flexDirection: 'column',\r\n                            pointerEvents: 'auto'\r\n                        }\r\n                    }, [\r\n                        // Header bar\r\n                        m('.debug-header', {\r\n                            style: {\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'space-between',\r\n                                padding: '4px 10px',\r\n                                borderBottom: this._debugMinimized ? 'none' : '1px solid rgba(100, 255, 100, 0.15)',\r\n                                cursor: 'pointer',\r\n                                flexShrink: 0,\r\n                                userSelect: 'none'\r\n                            },\r\n                            onclick: () => { this._debugMinimized = !this._debugMinimized; }\r\n                        }, [\r\n                            m('span', { style: { color: '#6f6', fontWeight: 'bold', letterSpacing: '0.5px' } }, 'DEBUG'),\r\n                            m('span', { style: { color: '#666', fontSize: '10px' } },\r\n                                this.debugMessages.length + ' msgs'),\r\n                            m('span', { style: { color: '#888', fontSize: '14px' } },\r\n                                this._debugMinimized ? '+' : '\\u2212')\r\n                        ]),\r\n                        // Message list\r\n                        !this._debugMinimized && m('.debug-messages', {\r\n                            style: {\r\n                                overflowY: 'auto',\r\n                                padding: '4px 8px',\r\n                                flex: 1\r\n                            },\r\n                            oncreate: (vn) => { vn.dom.scrollTop = vn.dom.scrollHeight; },\r\n                            onupdate: (vn) => { vn.dom.scrollTop = vn.dom.scrollHeight; }\r\n                        }, this.debugMessages.map((msg, i) => {\r\n                            const colors = {\r\n                                info: '#aaa',\r\n                                directive: '#6bf',\r\n                                label: '#fb4',\r\n                                voice: '#d8f',\r\n                                pass: '#6f6',\r\n                                fail: '#f66',\r\n                                error: '#f66'\r\n                            };\r\n                            const t = new Date(msg.time);\r\n                            const ts = t.getHours().toString().padStart(2, '0') + ':'\r\n                                + t.getMinutes().toString().padStart(2, '0') + ':'\r\n                                + t.getSeconds().toString().padStart(2, '0');\r\n                            return m('.debug-msg', {\r\n                                key: i,\r\n                                style: {\r\n                                    color: colors[msg.type] || '#aaa',\r\n                                    padding: '1px 0',\r\n                                    lineHeight: '1.4',\r\n                                    wordBreak: 'break-word'\r\n                                }\r\n                            }, '[' + ts + '] ' + msg.text);\r\n                        }))\r\n                    ]),\r\n\r\n                // Test mode thumbnails (last capture + last generated)\r\n                this.sessionConfig?.director?.testMode && (this._lastCaptureObj || this._lastGeneratedObj) &&\r\n                    m('.magic8-test-thumbnails', {\r\n                        style: {\r\n                            position: 'fixed',\r\n                            top: '60px',\r\n                            right: '10px',\r\n                            zIndex: 190,\r\n                            display: 'flex',\r\n                            flexDirection: 'column',\r\n                            gap: '8px',\r\n                            pointerEvents: 'none'\r\n                        }\r\n                    }, [\r\n                        this._lastCaptureObj && m('.test-thumb', {\r\n                            style: {\r\n                                width: '160px',\r\n                                borderRadius: '8px',\r\n                                border: '2px solid rgba(100, 200, 255, 0.5)',\r\n                                overflow: 'hidden',\r\n                                backgroundColor: 'rgba(0,0,0,0.6)'\r\n                            }\r\n                        }, [\r\n                            m('img', {\r\n                                src: g_application_path + '/thumbnail/' +\r\n                                    am7client.dotPath(am7client.currentOrganization) +\r\n                                    '/data.data' + this._lastCaptureObj.groupPath + '/' +\r\n                                    this._lastCaptureObj.name + '/160x160',\r\n                                style: { width: '100%', height: '160px', objectFit: 'cover', display: 'block' },\r\n                                onerror: function() { this.style.display = 'none'; }\r\n                            }),\r\n                            m('div', {\r\n                                style: {\r\n                                    fontSize: '10px', textAlign: 'center',\r\n                                    color: 'rgba(100,200,255,0.8)', padding: '2px 0',\r\n                                    background: 'rgba(0,0,0,0.5)'\r\n                                }\r\n                            }, 'Capture')\r\n                        ]),\r\n                        this._lastGeneratedObj && m('.test-thumb', {\r\n                            style: {\r\n                                width: '160px',\r\n                                borderRadius: '8px',\r\n                                border: '2px solid rgba(100, 255, 100, 0.5)',\r\n                                overflow: 'hidden',\r\n                                backgroundColor: 'rgba(0,0,0,0.6)'\r\n                            }\r\n                        }, [\r\n                            m('img', {\r\n                                src: g_application_path + '/thumbnail/' +\r\n                                    am7client.dotPath(am7client.currentOrganization) +\r\n                                    '/data.data' + (this._lastGeneratedObj.groupPath || '') + '/' +\r\n                                    (this._lastGeneratedObj.name || '') + '/160x160',\r\n                                style: { width: '100%', height: '160px', objectFit: 'cover', display: 'block' },\r\n                                onerror: function() { this.style.display = 'none'; }\r\n                            }),\r\n                            m('div', {\r\n                                style: {\r\n                                    fontSize: '10px', textAlign: 'center',\r\n                                    color: 'rgba(100,255,100,0.8)', padding: '2px 0',\r\n                                    background: 'rgba(0,0,0,0.5)'\r\n                                }\r\n                            }, 'Generated')\r\n                        ])\r\n                    ]),\r\n\r\n                // Dialog support\r\n                page.components.dialog ? page.components.dialog.loadDialog() : null\r\n            ]);\r\n        },\r\n\r\n        /**\r\n         * Gather current session state for the director LLM\r\n         * @returns {Object}\r\n         * @private\r\n         */\r\n        _gatherDirectorState() {\r\n            const bio = this.biometricData;\r\n            const audio = this.sessionConfig?.audio;\r\n            const visuals = this.sessionConfig?.visuals;\r\n\r\n            // Get recent voice lines\r\n            let recentVoiceLines = [];\r\n            if (this.voiceSequence) {\r\n                const seqs = this.voiceSequence.sequences;\r\n                const idx = this.voiceSequence.currentIndex;\r\n                if (seqs && seqs.length > 0 && idx > 0) {\r\n                    const start = Math.max(0, idx - 3);\r\n                    recentVoiceLines = seqs.slice(start, idx);\r\n                }\r\n            }\r\n\r\n            // Compute recent emotion transition (within last 30s)\r\n            let emotionTransition = null;\r\n            if (this._emotionHistory.length >= 2) {\r\n                const now = Date.now();\r\n                const current = this._emotionHistory[this._emotionHistory.length - 1];\r\n                const previous = this._emotionHistory[this._emotionHistory.length - 2];\r\n                const secsSinceChange = (now - current.timestamp) / 1000;\r\n                if (secsSinceChange <= 30) {\r\n                    emotionTransition = {\r\n                        from: previous.emotion,\r\n                        to: current.emotion,\r\n                        secsAgo: Math.round(secsSinceChange)\r\n                    };\r\n                }\r\n            }\r\n\r\n            const state = {\r\n                biometric: bio ? {\r\n                    emotion: bio.dominant_emotion,\r\n                    age: bio.age,\r\n                    gender: bio.dominant_gender\r\n                } : null,\r\n                emotionTransition: emotionTransition,\r\n                labels: [...this.sessionLabels],\r\n                recentVoiceLines: recentVoiceLines,\r\n                currentText: this.currentText,\r\n                audio: audio ? {\r\n                    sweepStart: audio.sweepStart,\r\n                    sweepTrough: audio.sweepTrough,\r\n                    sweepEnd: audio.sweepEnd,\r\n                    baseFreq: audio.baseFreq,\r\n                    bandLabel: this.audioEngine?.currentBandLabel || null,\r\n                    isochronicEnabled: audio.isochronicEnabled,\r\n                    isochronicRate: audio.isochronicRate\r\n                } : null,\r\n                visuals: visuals ? {\r\n                    effects: visuals.effects,\r\n                    mode: visuals.mode\r\n                } : null,\r\n                sdConfig: this.imageGenerator?.sdConfig ? {\r\n                    style: this.imageGenerator.sdConfig.style,\r\n                    description: this.imageGenerator.sdConfig.description,\r\n                    imageAction: this.imageGenerator.sdConfig.imageAction,\r\n                    denoisingStrength: this.imageGenerator.sdConfig.denoisingStrength,\r\n                    cfg: this.imageGenerator.sdConfig.cfg\r\n                } : null,\r\n                layerOpacity: {\r\n                    labels: Math.round(this._layerOpacity.labels * 100) / 100,\r\n                    images: Math.round(this._layerOpacity.images * 100) / 100,\r\n                    visualizer: Math.round(this._layerOpacity.visualizer * 100) / 100,\r\n                    visuals: Math.round(this._layerOpacity.visuals * 100) / 100\r\n                },\r\n                injectedVoiceLines: this.sessionVoiceLines.length > 0\r\n                    ? this.sessionVoiceLines.slice(-3)\r\n                    : [],\r\n                moodRingEnabled: this.moodRingEnabled,\r\n                userResponse: this._userResponse || null,\r\n                interactiveEnabled: !!(this.sessionConfig?.director?.interactive),\r\n                ticksSinceAskUser: this._ticksSinceAskUser,\r\n                elapsedMinutes: this._sessionStartTime\r\n                    ? (Date.now() - this._sessionStartTime) / 60000\r\n                    : 0\r\n            };\r\n\r\n            // Consume the user response after gathering (one-shot)\r\n            this._userResponse = null;\r\n            return state;\r\n        },\r\n\r\n        /**\r\n         * Find images by tags using intersection (AND logic)\r\n         * Pattern from dialog.js findImageForTags  no character scoping\r\n         * @param {Array<string>} tags - Tag names to intersect\r\n         * @returns {Promise<Object|null>} Random matching data.data object, or null\r\n         * @private\r\n         */\r\n        async _findImagesByTags(tags) {\r\n            if (!tags || !tags.length) return null;\r\n            try {\r\n                // Get tag objects for all requested tags\r\n                const tagObjects = [];\r\n                for (const tagName of tags) {\r\n                    const tag = await page.getTag(tagName.trim(), 'data.data');\r\n                    if (!tag) return null; // Tag doesn't exist  no match possible\r\n                    tagObjects.push(tag);\r\n                }\r\n\r\n                // Start with members of the first tag\r\n                const firstMembers = await am7client.members('data.tag', tagObjects[0].objectId, 'data.data', 0, 100);\r\n                if (!firstMembers || !firstMembers.length) return null;\r\n\r\n                let candidateIds = new Set(firstMembers.map(m => m.objectId));\r\n\r\n                // Intersect with each additional tag's members\r\n                for (let i = 1; i < tagObjects.length; i++) {\r\n                    const members = await am7client.members('data.tag', tagObjects[i].objectId, 'data.data', 0, 100);\r\n                    if (!members || !members.length) return null;\r\n                    const memberIds = new Set(members.map(m => m.objectId));\r\n                    for (const id of candidateIds) {\r\n                        if (!memberIds.has(id)) candidateIds.delete(id);\r\n                    }\r\n                    if (candidateIds.size === 0) return null;\r\n                }\r\n\r\n                // Random pick from candidates  use count=1, sort=\"random()\"\r\n                const ids = Array.from(candidateIds);\r\n                const pickedId = ids[Math.floor(Math.random() * ids.length)];\r\n\r\n                const q = am7view.viewQuery(am7model.newInstance('data.data'));\r\n                q.field('objectId', pickedId);\r\n                const qr = await page.search(q);\r\n                return (qr && qr.results && qr.results.length) ? qr.results[0] : null;\r\n            } catch (err) {\r\n                console.warn('Magic8App: Tag search failed:', err);\r\n                return null;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Generate image from camera with temporary SD config overrides\r\n         * @param {Object} directive - Directive with generateImage fields\r\n         * @private\r\n         */\r\n        _generateImageFromCamera(directive) {\r\n            const sdKeys = ['description', 'style', 'imageAction', 'denoisingStrength', 'cfg'];\r\n            const origValues = {};\r\n\r\n            if (this.imageGenerator.sdConfig) {\r\n                for (const key of sdKeys) {\r\n                    origValues[key] = this.imageGenerator.sdConfig[key];\r\n                    if (directive.generateImage[key] != null) {\r\n                        this.imageGenerator.sdConfig[key] = directive.generateImage[key];\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.imageGenerator.captureAndGenerate(\r\n                page.components.camera,\r\n                this.biometricData || null\r\n            ).then(() => {\r\n                if (this.imageGenerator.sdConfig) {\r\n                    for (const key of sdKeys) {\r\n                        if (origValues[key] !== undefined) {\r\n                            this.imageGenerator.sdConfig[key] = origValues[key];\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Apply a directive from the session director\r\n         * @param {Object} directive - Parsed directive from LLM\r\n         * @private\r\n         */\r\n        _applyDirective(directive) {\r\n            if (!directive) return;\r\n            const cfg = this.sessionConfig;\r\n\r\n            // Director can enable audio if it was off\r\n            if (directive.audio && cfg?.audio && this.audioEngine && !this.audioEnabled) {\r\n                this.audioEnabled = true;\r\n                this.audioEngine.setVolume(1.0);\r\n                console.log('Magic8App: Director enabled audio');\r\n                m.redraw();\r\n            }\r\n\r\n            // Director can adjust volume\r\n            if (directive.audio?.volume != null && this.audioEngine) {\r\n                this.audioEngine.setVolume(Math.max(0, Math.min(1, directive.audio.volume)));\r\n            }\r\n\r\n            // Apply audio changes (preset > band > raw Hz)\r\n            if (directive.audio && cfg?.audio && this.audioEngine && this.audioEnabled) {\r\n                let audioHandled = false;\r\n\r\n                // Named preset takes priority\r\n                if (directive.audio.preset) {\r\n                    this.audioEngine.stopBinaural();\r\n                    this.audioEngine.startBinauralFromPreset(directive.audio.preset);\r\n                    audioHandled = true;\r\n                }\r\n                // Named band with optional transitions\r\n                else if (directive.audio.band) {\r\n                    this.audioEngine.stopBinaural();\r\n                    this.audioEngine.startBinauralFromBands({\r\n                        startBand: directive.audio.band,\r\n                        troughBand: directive.audio.troughBand || directive.audio.band,\r\n                        endBand: directive.audio.endBand || directive.audio.band,\r\n                        secondTransition: directive.audio.secondTransition,\r\n                        thirdTransition: directive.audio.thirdTransition,\r\n                        baseFreq: directive.audio.baseFreq || cfg.audio.baseFreq || 200,\r\n                        sweepDurationMin: cfg.audio.sweepDurationMin || 5\r\n                    });\r\n                    audioHandled = true;\r\n                }\r\n\r\n                // Legacy raw Hz sweep (backwards compatible)\r\n                if (!audioHandled) {\r\n                    let audioChanged = false;\r\n                    for (const key of ['sweepStart', 'sweepTrough', 'sweepEnd']) {\r\n                        if (directive.audio[key] != null && directive.audio[key] !== cfg.audio[key]) {\r\n                            cfg.audio[key] = directive.audio[key];\r\n                            audioChanged = true;\r\n                        }\r\n                    }\r\n                    if (audioChanged) {\r\n                        this.audioEngine.stopBinaural();\r\n                        this.audioEngine.startBinaural(cfg.audio);\r\n                    }\r\n                }\r\n\r\n                if (directive.audio.isochronicEnabled != null &&\r\n                    directive.audio.isochronicEnabled !== cfg.audio.isochronicEnabled) {\r\n                    cfg.audio.isochronicEnabled = directive.audio.isochronicEnabled;\r\n                    if (cfg.audio.isochronicEnabled) {\r\n                        this.audioEngine.startIsochronic(cfg.audio);\r\n                    } else {\r\n                        this.audioEngine.stopIsochronic();\r\n                    }\r\n                }\r\n                // Resolve isochronicBand to isochronicRate\r\n                if (directive.audio.isochronicBand) {\r\n                    const bands = Magic8.AudioEngine.BRAINWAVE_BANDS;\r\n                    const band = bands[directive.audio.isochronicBand];\r\n                    if (band) {\r\n                        directive.audio.isochronicRate = band.mid;\r\n                    }\r\n                }\r\n                if (directive.audio.isochronicRate != null) {\r\n                    cfg.audio.isochronicRate = directive.audio.isochronicRate;\r\n                    if (cfg.audio.isochronicEnabled) {\r\n                        this.audioEngine.stopIsochronic();\r\n                        this.audioEngine.startIsochronic(cfg.audio);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Apply visual changes\r\n            if (directive.visuals && cfg?.visuals) {\r\n                if (directive.visuals.effect) {\r\n                    // Create new object to trigger HypnoCanvas identity check\r\n                    this.sessionConfig.visuals = {\r\n                        ...cfg.visuals,\r\n                        effects: [directive.visuals.effect],\r\n                        mode: 'single'\r\n                    };\r\n                    if (directive.visuals.transitionDuration != null) {\r\n                        this.sessionConfig.visuals.transitionDuration = directive.visuals.transitionDuration;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Apply label changes  inject into text sequence for sequential display\r\n            if (directive.labels) {\r\n                if (directive.labels.add && directive.labels.add.length > 0) {\r\n                    for (const label of directive.labels.add) {\r\n                        // Track in sessionLabels for LLM state reporting\r\n                        if (!this.sessionLabels.includes(label)) {\r\n                            this.sessionLabels.push(label);\r\n                        }\r\n                        // Inject into text sequence at current position\r\n                        if (this.textSequence) {\r\n                            this.textSequence.injectText(label, this.textSequence.currentIndex);\r\n                        }\r\n                    }\r\n                    // Cap sessionLabels at 10 for state reporting\r\n                    if (this.sessionLabels.length > 10) {\r\n                        this.sessionLabels = this.sessionLabels.slice(-10);\r\n                    }\r\n                    // Auto-start text sequence if it was empty (LLM-only mode)\r\n                    if (this.textSequence && !this.textSequence.isPlaying && this.textSequence.sequences.length > 0) {\r\n                        this.textSequence.start();\r\n                    }\r\n                }\r\n                if (directive.labels.remove && directive.labels.remove.length > 0) {\r\n                    this.sessionLabels = this.sessionLabels.filter(\r\n                        l => !directive.labels.remove.includes(l)\r\n                    );\r\n                }\r\n            }\r\n\r\n            // Apply image generation  tag search first, camera-based generation as fallback\r\n            if (directive.generateImage && this.imageGenerator && page.components.camera) {\r\n                const tags = directive.generateImage.tags;\r\n                let tagImageHandled = false;\r\n\r\n                // Try tag-based image search if tags provided\r\n                if (tags && tags.length > 0 && window.am7imageTokens) {\r\n                    this._findImagesByTags(tags).then(found => {\r\n                        if (found) {\r\n                            const url = window.am7imageTokens.thumbnailUrl\r\n                                ? window.am7imageTokens.thumbnailUrl(found, '512x512')\r\n                                : (g_application_path + '/media/Public/data.data' + encodeURI(found.groupPath || '') + '/' + encodeURIComponent(found.name));\r\n                            if (this.imageGallery) {\r\n                                this.imageGallery.showImmediate(url);\r\n                            }\r\n                            if (this.sessionConfig?.director?.testMode) {\r\n                                this._debugLog('Tag image found: ' + tags.join('+') + '  ' + found.name, 'pass');\r\n                            }\r\n                        } else {\r\n                            // No tag match  fall back to camera generation\r\n                            if (this.sessionConfig?.director?.testMode) {\r\n                                this._debugLog('No tag match for ' + tags.join('+') + ', generating from camera', 'info');\r\n                            }\r\n                            this._generateImageFromCamera(directive);\r\n                        }\r\n                    });\r\n                    tagImageHandled = true;\r\n                }\r\n\r\n                // Direct camera-based generation (no tags)\r\n                if (!tagImageHandled) {\r\n                    this._generateImageFromCamera(directive);\r\n                }\r\n            }\r\n\r\n            // Apply voice line injection\r\n            if (directive.voiceLine && this.voiceSequence) {\r\n                const insertAt = this.voiceSequence.currentIndex;\r\n                this.sessionVoiceLines.push(directive.voiceLine);\r\n                if (this.sessionConfig?.director?.testMode) {\r\n                    this._debugLog('Voice inject at idx=' + insertAt +\r\n                        ', sequences=' + this.voiceSequence.sequences.length +\r\n                        ', hashes=' + this.voiceSequence.synthesizedHashes.size, 'voice');\r\n                }\r\n                this.voiceSequence.injectLine(\r\n                    directive.voiceLine,\r\n                    insertAt,\r\n                    this.sessionConfig?.voice?.voiceProfileId\r\n                ).then(ok => {\r\n                    if (ok) {\r\n                        console.log('Magic8App: Injected voice line at index', insertAt, ':', directive.voiceLine);\r\n                        if (this.sessionConfig?.director?.testMode) {\r\n                            this._debugLog('Voice injected OK, total=' + this.voiceSequence.sequences.length, 'pass');\r\n                        }\r\n                        // Auto-start voice sequence if it was empty (LLM-only mode) and audio is on\r\n                        if (!this.voiceSequence.isPlaying && this.voiceSequence.sequences.length > 0 && this.audioEnabled) {\r\n                            this.voiceSequence.start();\r\n                        }\r\n                    } else {\r\n                        console.warn('Magic8App: Failed to inject voice line');\r\n                        if (this.sessionConfig?.director?.testMode) {\r\n                            this._debugLog('Voice inject FAILED', 'fail');\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Apply layer opacity changes (gradual transition)\r\n            if (directive.opacity && typeof directive.opacity === 'object') {\r\n                for (const layer of ['labels', 'images', 'visualizer', 'visuals']) {\r\n                    if (typeof directive.opacity[layer] === 'number') {\r\n                        this._setLayerOpacity(layer, directive.opacity[layer]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Apply mood suggestion\r\n            if (directive.suggestMood) {\r\n                if (directive.suggestMood.emotion) {\r\n                    this._suggestedEmotion = directive.suggestMood.emotion;\r\n                }\r\n                if (directive.suggestMood.gender) {\r\n                    this._suggestedGender = directive.suggestMood.gender;\r\n                }\r\n                // LLM gender push  override face data percentage\r\n                if (directive.suggestMood.genderPct != null) {\r\n                    this._genderMalePct = Math.max(0, Math.min(100, directive.suggestMood.genderPct));\r\n                }\r\n                // Update mood ring color when enabled\r\n                if (this.moodRingEnabled && this._suggestedEmotion) {\r\n                    const theme = Magic8.BiometricThemer.emotionThemes[this._suggestedEmotion];\r\n                    if (theme) {\r\n                        this.moodRingColor = theme.accent;\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Handle askUser directive (interactive mode)\r\n            const hasAskUser = !!(directive.askUser);\r\n            const interactiveCfg = !!(this.sessionConfig?.director?.interactive);\r\n            if (hasAskUser || interactiveCfg) {\r\n                console.log('Magic8: askUser check  directive.askUser:', hasAskUser,\r\n                    ', interactive config:', interactiveCfg,\r\n                    ', pendingQuestion:', !!(this._pendingQuestion));\r\n                if (hasAskUser && !interactiveCfg) {\r\n                    this._debugLog('askUser BLOCKED: interactive mode is OFF in config', 'warn');\r\n                }\r\n                if (hasAskUser && interactiveCfg && this._pendingQuestion) {\r\n                    this._debugLog('askUser BLOCKED: already waiting for response', 'warn');\r\n                }\r\n            }\r\n            if (hasAskUser && interactiveCfg) {\r\n                this._startUserInteraction(directive.askUser.question);\r\n                this._ticksSinceAskUser = 0;\r\n            } else if (interactiveCfg) {\r\n                this._ticksSinceAskUser++;\r\n            }\r\n\r\n            if (directive.commentary) {\r\n                console.log('SessionDirector commentary:', directive.commentary);\r\n            }\r\n\r\n            m.redraw();\r\n        },\r\n\r\n        /**\r\n         * Start interactive user interaction (askUser directive)\r\n         * Displays question on screen, speaks it via voice synth,\r\n         * pauses subsequent voice playback, starts STT, shows input overlay.\r\n         * @param {string} question - The question from the LLM\r\n         * @private\r\n         */\r\n        _startUserInteraction(question) {\r\n            if (this._pendingQuestion) {\r\n                console.log('Magic8: _startUserInteraction SKIPPED  already pending:', this._pendingQuestion.question);\r\n                return;\r\n            }\r\n\r\n            this._pendingQuestion = { question };\r\n            this._userInputText = '';\r\n            this._voicePausedForInteraction = false;\r\n            console.log('Magic8: _startUserInteraction SET _pendingQuestion:', question);\r\n\r\n            // Pause director tick cycle while waiting\r\n            this.sessionDirector?.pause();\r\n            this._debugLog('askUser: \"' + question + '\"', 'directive');\r\n\r\n            // Display question as on-screen text\r\n            if (this.textSequence) {\r\n                this.textSequence.injectText(question, this.textSequence.currentIndex);\r\n                if (!this.textSequence.isPlaying && this.textSequence.sequences.length > 0) {\r\n                    this.textSequence.start();\r\n                }\r\n            }\r\n            this.currentText = question;\r\n\r\n            // Speak question via voice synth, then pause voice sequence\r\n            if (this.voiceSequence && this.audioEnabled) {\r\n                const insertAt = this.voiceSequence.currentIndex;\r\n                this.voiceSequence.injectLine(\r\n                    question,\r\n                    insertAt,\r\n                    this.sessionConfig?.voice?.voiceProfileId\r\n                ).then(ok => {\r\n                    if (!ok || !this._pendingQuestion) return;\r\n\r\n                    // Pause the voice sequence so it doesn't auto-advance\r\n                    this.voiceSequence.pause();\r\n                    this._voicePausedForInteraction = true;\r\n\r\n                    // Manually play just the question clip\r\n                    const hash = this.voiceSequence.synthesizedHashes.get(insertAt);\r\n                    if (hash) {\r\n                        const source = this.audioEngine?.sources.get(hash);\r\n                        if (source && source.buffer) {\r\n                            source.play();\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Test mode: simulate STT with canned response after delay\r\n            if (this.sessionConfig?.director?.testMode) {\r\n                const cannedResponses = [\r\n                    'I feel calm and centered',\r\n                    'Things are going well, thank you',\r\n                    'I would like to go deeper',\r\n                    'That sounds good to me',\r\n                    'I am feeling relaxed and open'\r\n                ];\r\n                const canned = cannedResponses[Math.floor(Math.random() * cannedResponses.length)];\r\n                this._debugLog('Test mode: will simulate STT  \"' + canned + '\"', 'info');\r\n\r\n                // Simulate typing effect over 2s, then auto-submit after 5s\r\n                let charIdx = 0;\r\n                const typeInterval = setInterval(() => {\r\n                    if (!this._pendingQuestion || charIdx >= canned.length) {\r\n                        clearInterval(typeInterval);\r\n                        return;\r\n                    }\r\n                    charIdx += 2;\r\n                    this._userInputText = canned.substring(0, charIdx);\r\n                    m.redraw();\r\n                }, 80);\r\n\r\n                this._responseTimeoutId = setTimeout(() => {\r\n                    clearInterval(typeInterval);\r\n                    this._userInputText = canned;\r\n                    this._submitUserResponse();\r\n                }, 5000);\r\n            } else {\r\n                // Production mode: text input only (STT recording disabled for now)\r\n                // User types response and clicks Send or presses Enter.\r\n                // Idle timeout: after 30s of no typing, auto-submit \"No response from user\".\r\n                this._debugLog('Interactive: text input active (STT disabled)', 'info');\r\n\r\n                this._lastTypingTime = Date.now();\r\n                if (this._interactionIdleTimer) clearInterval(this._interactionIdleTimer);\r\n                this._interactionIdleTimer = setInterval(() => {\r\n                    if (!this._pendingQuestion) {\r\n                        clearInterval(this._interactionIdleTimer);\r\n                        this._interactionIdleTimer = null;\r\n                        return;\r\n                    }\r\n                    const idle = Date.now() - this._lastTypingTime;\r\n                    if (idle >= 30000) {\r\n                        this._debugLog('Interaction idle timeout (30s)  auto-submitting', 'info');\r\n                        this._userInputText = 'No response from user';\r\n                        this._submitUserResponse();\r\n                    }\r\n                }, 2000);\r\n\r\n                /* --- STT recording (disabled  re-enable when server-side STT bug is fixed) ---\r\n                // Use server-side STT via WebSocket streaming\r\n                // Capture microphone, stream audio chunks to server, receive transcription\r\n                navigator.mediaDevices.getUserMedia({\r\n                    audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true }\r\n                }).then(mediaStream => {\r\n                    if (!this._pendingQuestion) {\r\n                        mediaStream.getTracks().forEach(t => t.stop());\r\n                        return;\r\n                    }\r\n\r\n                    let mediaRecorder;\r\n                    try {\r\n                        mediaRecorder = new MediaRecorder(mediaStream, { mimeType: 'audio/webm;codecs=opus' });\r\n                    } catch (e) {\r\n                        try {\r\n                            mediaRecorder = new MediaRecorder(mediaStream);\r\n                        } catch (e2) {\r\n                            console.warn('Magic8: MediaRecorder not supported:', e2);\r\n                            mediaStream.getTracks().forEach(t => t.stop());\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n                    this._sttMediaStream = mediaStream;\r\n                    this._sttMediaRecorder = mediaRecorder;\r\n\r\n                    page.audioStream = {\r\n                        onaudioupdate: () => {},\r\n                        onaudiosttupdate: (text) => {\r\n                            if (this._pendingQuestion && text) {\r\n                                this._userInputText = text;\r\n                                m.redraw();\r\n                            }\r\n                        },\r\n                        onaudiouerror: () => {}\r\n                    };\r\n\r\n                    const blobToBase64 = async (blob) => {\r\n                        try {\r\n                            const buff = await blob.arrayBuffer();\r\n                            return btoa(new Uint8Array(buff).reduce((data, val) => data + String.fromCharCode(val), ''));\r\n                        } catch (e) {\r\n                            console.error('Magic8: Error converting audio to base64:', e);\r\n                            return null;\r\n                        }\r\n                    };\r\n\r\n                    mediaRecorder.ondataavailable = async (event) => {\r\n                        if (event.data && event.data.size > 0 && page.wss) {\r\n                            const b64 = await blobToBase64(event.data);\r\n                            if (b64) {\r\n                                page.wss.send(\"audio\", b64);\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    try {\r\n                        mediaRecorder.start(2000);\r\n                        this._debugLog('STT: microphone recording started (server-side)', 'info');\r\n                    } catch (e) {\r\n                        console.warn('Magic8: Error starting recorder:', e);\r\n                    }\r\n                }).catch(err => {\r\n                    console.warn('Magic8: Microphone access error:', err.message);\r\n                });\r\n\r\n                // Auto-submit timeout: max(director interval, 30s)\r\n                const directorInterval = this.sessionDirector?.intervalMs || 60000;\r\n                const timeout = Math.max(directorInterval, 30000);\r\n                this._responseTimeoutId = setTimeout(() => {\r\n                    this._submitUserResponse();\r\n                }, timeout);\r\n                --- end disabled STT --- */\r\n            }\r\n\r\n            m.redraw();\r\n        },\r\n\r\n        /**\r\n         * Submit the user's response (called by button, Enter key, or timeout)\r\n         * Stores response, stops STT, resumes director with immediate tick\r\n         * @private\r\n         */\r\n        _submitUserResponse() {\r\n            if (!this._pendingQuestion) return;\r\n\r\n            // Capture response\r\n            this._userResponse = this._userInputText.trim() || '(no response)';\r\n            this._debugLog('User response: \"' + this._userResponse + '\"', 'info');\r\n\r\n            // Stop server-side STT recording\r\n            if (this._sttMediaRecorder) {\r\n                try { this._sttMediaRecorder.stop(); } catch (e) { /* ignore */ }\r\n                this._sttMediaRecorder = null;\r\n            }\r\n            if (this._sttMediaStream) {\r\n                this._sttMediaStream.getTracks().forEach(t => t.stop());\r\n                this._sttMediaStream = null;\r\n            }\r\n            page.audioStream = undefined;\r\n\r\n            // Clear timeouts\r\n            if (this._responseTimeoutId) {\r\n                clearTimeout(this._responseTimeoutId);\r\n                this._responseTimeoutId = null;\r\n            }\r\n            if (this._interactionIdleTimer) {\r\n                clearInterval(this._interactionIdleTimer);\r\n                this._interactionIdleTimer = null;\r\n            }\r\n\r\n            // Resume voice sequence if we paused it\r\n            if (this._voicePausedForInteraction && this.voiceSequence) {\r\n                this.voiceSequence.resume();\r\n                this._voicePausedForInteraction = false;\r\n            }\r\n\r\n            // Clear UI state\r\n            this._pendingQuestion = null;\r\n            this._userInputText = '';\r\n\r\n            // Resume director and force immediate tick\r\n            if (this.sessionDirector) {\r\n                this.sessionDirector.resume();\r\n                this.sessionDirector._tick();\r\n            }\r\n\r\n            m.redraw();\r\n        },\r\n\r\n        /**\r\n         * Log a message to the on-screen debug console (test mode only)\r\n         * @param {string} text - Message text\r\n         * @param {string} [type='info'] - Message type: info, directive, label, voice, pass, fail, error\r\n         * @private\r\n         */\r\n        _debugLog(text, type) {\r\n            this.debugMessages.push({\r\n                time: Date.now(),\r\n                type: type || 'info',\r\n                text: text\r\n            });\r\n            if (this.debugMessages.length > 300) {\r\n                this.debugMessages = this.debugMessages.slice(-300);\r\n            }\r\n            m.redraw();\r\n        },\r\n\r\n        /**\r\n         * Set a layer opacity target and start the gradual transition.\r\n         * @param {string} layer - 'labels' | 'images' | 'visualizer' | 'visuals'\r\n         * @param {number} value - Target opacity (clamped to 0.151.0)\r\n         * @private\r\n         */\r\n        _setLayerOpacity(layer, value) {\r\n            const clamped = Math.max(0.15, Math.min(1, value));\r\n            if (Math.abs(clamped - this._layerOpacityTarget[layer]) < 0.01) return;\r\n\r\n            this._layerOpacityStart[layer] = this._layerOpacity[layer];\r\n            this._layerOpacityTarget[layer] = clamped;\r\n            this._layerTransitionStart[layer] = Date.now();\r\n            this._startOpacityAnimation();\r\n        },\r\n\r\n        /**\r\n         * Start the rAF loop that gradually transitions layer opacities.\r\n         * @private\r\n         */\r\n        _startOpacityAnimation() {\r\n            if (this._opacityRafId) return;\r\n            this._opacityRafId = requestAnimationFrame(() => this._animateOpacity());\r\n        },\r\n\r\n        /**\r\n         * rAF tick: ease each transitioning layer toward its target.\r\n         * @private\r\n         */\r\n        _animateOpacity() {\r\n            const now = Date.now();\r\n            let anyActive = false;\r\n\r\n            for (const layer of ['labels', 'images', 'visualizer', 'visuals']) {\r\n                const startTime = this._layerTransitionStart[layer];\r\n                if (startTime == null) continue;\r\n\r\n                const progress = Math.min(1, (now - startTime) / this._opacityTransitionMs);\r\n                // Ease in-out quad\r\n                const eased = progress < 0.5\r\n                    ? 2 * progress * progress\r\n                    : 1 - Math.pow(-2 * progress + 2, 2) / 2;\r\n\r\n                this._layerOpacity[layer] = this._layerOpacityStart[layer] +\r\n                    (this._layerOpacityTarget[layer] - this._layerOpacityStart[layer]) * eased;\r\n\r\n                if (progress >= 1) {\r\n                    this._layerOpacity[layer] = this._layerOpacityTarget[layer];\r\n                    delete this._layerTransitionStart[layer];\r\n                } else {\r\n                    anyActive = true;\r\n                }\r\n            }\r\n\r\n            m.redraw();\r\n\r\n            if (anyActive) {\r\n                this._opacityRafId = requestAnimationFrame(() => this._animateOpacity());\r\n            } else {\r\n                this._opacityRafId = null;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Generate biometric clue strings\r\n         * @returns {Array<string>}\r\n         * @private\r\n         */\r\n        _getBiometricClues() {\r\n            const data = this.biometricData;\r\n            if (!data) return [];\r\n\r\n            const clues = [];\r\n\r\n            if (data.dominant_emotion) {\r\n                clues.push(`A state of ${data.dominant_emotion}.`);\r\n            }\r\n            if (data.age) {\r\n                clues.push(`${data.age} years of experience.`);\r\n            }\r\n            if (data.dominant_gender) {\r\n                clues.push(`An expression of ${data.dominant_gender.toLowerCase()} energy.`);\r\n            }\r\n\r\n            return clues;\r\n        }\r\n    };\r\n\r\n    // Register as a page view\r\n    if (typeof page !== 'undefined') {\r\n        page.views = page.views || {};\r\n        page.views.magic8 = Magic8App;\r\n    }\r\n\r\n    // Export\r\n    if (typeof module !== 'undefined' && module.exports) {\r\n        module.exports = Magic8App;\r\n    }\r\n    if (typeof window !== 'undefined') {\r\n        window.Magic8 = window.Magic8 || {};\r\n        window.Magic8.App = Magic8App;\r\n    }\r\n\r\n}());\r\n\n\n;/* === client/view/magic8/index.js === */\n/**\r\n * Magic8 Module - Entry point and public API\r\n * Consolidated immersive experience with biometric theming, audio, and AI generation\r\n *\r\n * Script Loading Order:\r\n *   1. utils/FullscreenManager.js\r\n *   2. utils/DynamicImageGallery.js\r\n *   3. audio/AudioEngine.js\r\n *   4. audio/VoiceSequenceManager.js\r\n *   5. state/BiometricThemer.js\r\n *   6. video/SessionRecorder.js\r\n *   7. text/TextSequenceManager.js\r\n *   8. generation/ImageGenerationManager.js\r\n *   9. ai/SessionDirector.js\r\n *  10. components/HypnoCanvas.js\r\n *  11. components/AudioVisualizerOverlay.js\r\n *  12. components/HypnoticTextDisplay.js\r\n *  13. components/ControlPanel.js\r\n *  14. components/MoodEmojiDisplay.js\r\n *  15. components/MoodRingButton.js\r\n *  16. components/BiometricOverlay.js\r\n *  17. components/SessionConfigEditor.js\r\n *  18. Magic8App.js\r\n *  19. index.js (this file)\r\n */\r\n(function() {\r\n\r\n    // Ensure Magic8 namespace exists\r\n    window.Magic8 = window.Magic8 || {};\r\n\r\n    /**\r\n     * Launch Magic8 from chat context\r\n     * @param {Object} chatContext - Chat context to pass to Magic8\r\n     * @param {Object} chatContext.chatConfigId - Chat config object ID\r\n     * @param {Object} chatContext.chatHistory - Recent chat messages\r\n     * @param {Object} chatContext.systemCharacter - System character info\r\n     * @param {Object} chatContext.userCharacter - User character info\r\n     * @param {Object} chatContext.instanceId - Chat instance ID\r\n     */\r\n    Magic8.launchFromChat = function(chatContext) {\r\n        sessionStorage.setItem('magic8Context', JSON.stringify(chatContext));\r\n        m.route.set('/magic8');\r\n    };\r\n\r\n    /**\r\n     * Launch Magic8 with a saved session config\r\n     * @param {string} sessionConfigId - Object ID of saved config\r\n     */\r\n    Magic8.launchWithConfig = function(sessionConfigId) {\r\n        m.route.set('/magic8', { sessionConfigId: sessionConfigId });\r\n    };\r\n\r\n    /**\r\n     * Launch Magic8 with fresh configuration\r\n     */\r\n    Magic8.launch = function() {\r\n        m.route.set('/magic8');\r\n    };\r\n\r\n    /**\r\n     * Check for return context from Magic8 (for chat.js to use)\r\n     * @returns {Object|null} Return context or null\r\n     */\r\n    Magic8.getReturnContext = function() {\r\n        const json = sessionStorage.getItem('magic8Return');\r\n        if (json) {\r\n            sessionStorage.removeItem('magic8Return');\r\n            try {\r\n                return JSON.parse(json);\r\n            } catch (e) {\r\n                return null;\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    /**\r\n     * Get the script paths for loading Magic8 module\r\n     * @param {string} basePath - Base path to magic8 directory\r\n     * @returns {Array<string>} Ordered script paths\r\n     */\r\n    Magic8.getScriptPaths = function(basePath) {\r\n        const base = basePath || 'view/magic8';\r\n        return [\r\n            `${base}/utils/FullscreenManager.js`,\r\n            `${base}/utils/DynamicImageGallery.js`,\r\n            `${base}/audio/AudioEngine.js`,\r\n            `${base}/audio/VoiceSequenceManager.js`,\r\n            `${base}/state/BiometricThemer.js`,\r\n            `${base}/video/SessionRecorder.js`,\r\n            `${base}/text/TextSequenceManager.js`,\r\n            `${base}/generation/ImageGenerationManager.js`,\r\n            `${base}/ai/SessionDirector.js`,\r\n            `${base}/components/HypnoCanvas.js`,\r\n            `${base}/components/AudioVisualizerOverlay.js`,\r\n            `${base}/components/HypnoticTextDisplay.js`,\r\n            `${base}/components/ControlPanel.js`,\r\n            `${base}/components/MoodEmojiDisplay.js`,\r\n            `${base}/components/MoodRingButton.js`,\r\n            `${base}/components/BiometricOverlay.js`,\r\n            `${base}/components/SessionConfigEditor.js`,\r\n            `${base}/Magic8App.js`,\r\n            `${base}/index.js`\r\n        ];\r\n    };\r\n\r\n    // Module info\r\n    Magic8.VERSION = '1.0.0';\r\n    Magic8.MODULE_NAME = 'Magic8';\r\n\r\n    console.log('Magic8 module loaded (v' + Magic8.VERSION + ')');\r\n\r\n}());\r\n\n\n;/* === client/applicationRouter.js === */\n(function(){\r\n\r\n    let routes = {\r\n        \r\n        \"/sig\": page.views.sig,\r\n        \"/saur\": page.views.saur,\r\n        \"/main\" : page.views.main,\r\n        \"/nav\" : page.views.navigator().view,\r\n        \"/chat\" : page.views.chat().view,\r\n        \"/new/:objectId\" : page.views.object().view,\r\n        \"/new/:type/:objectId\" : page.views.object().view,\r\n        \"/pnew/:type/:objectId\" : page.views.object().view,\r\n        \"/view/:type/:objectId\" : page.views.object().view,\r\n        \"/list/:type\" : page.views.list().view,\r\n        \"/list/:type/:objectId\" : page.views.list().view,\r\n        \"/plist/:type/:objectId\" : page.views.list().view,\r\n        \"/game\" : page.views.game,\r\n        \"/game/:name\" : page.views.game,\r\n        \"/cardGame-v2\": page.views.cardGameV2,\r\n        \"/hyp\": page.views.hyp,\r\n        \"/magic8\": page.views.magic8\r\n    };\r\n    \r\n    \r\n\r\n    function init(){\r\n        window.addEventListener(\"beforeunload\", takeDown);\r\n        refreshApplication();\r\n    }\r\n    \r\n    function takeDown(){\r\n        console.log(\"Unload\");\r\n        if(page.wss){\r\n            page.wss.close();\r\n        }\r\n    }\r\n\r\n    function refreshApplication() {\r\n        \r\n        am7client.principal().then((usr) => {\r\n            let rt = window.location.hash.slice(window.location.hash.indexOf(\"/\"));\r\n            page.application = undefined;\r\n            page.user = usr;\r\n            \r\n            if(usr == null){\r\n                page.wss.close();\r\n                rt = \"/sig\";\r\n                m.route.set(rt);\r\n                m.route(document.body, rt, routes);\r\n                \r\n            }\r\n            else{\r\n                am7client.currentOrganization = usr.organizationPath;\r\n                am7client.application().then((app) => {\r\n                    page.application = app;\r\n                    if(app && app != null){\r\n                        for(let v in app){\r\n                            if(app[v] instanceof Array){\r\n                                am7model.updateListModel(app[v], am7model.getModelField(app.schema, v));\r\n                            }\r\n                        }\r\n                        setContextRoles(app);\r\n                        if(!rt.length || rt == \"/sig\") rt = \"/main\";\r\n                        page.wss.connect();\r\n                    }\r\n                    else{\r\n                        rt = \"/sig\";\r\n                    }\r\n                    m.route.set(rt);\r\n                    m.route(document.body, rt, routes);\r\n                });\r\n            }\r\n            \r\n           \r\n        });\r\n\r\n        page.router = {\r\n            refresh: refreshApplication,\r\n            routes,\r\n            route: function(path, node){\r\n                m.route.set(path);\r\n            }\r\n        };\r\n    };\r\n\r\n    init();\r\n\r\n    function hasRole(roles, role){\r\n        return (roles.filter(r => r.name.toLowerCase() === role.toLowerCase()).length > 0);\r\n    }\r\n    function setContextRoles(app){\r\n        let ctxRoles = page.context().roles;\r\n        let roles = (app && app.userRoles ? app.userRoles : []);\r\n\r\n        ctxRoles.user = hasRole(roles, 'accountusers');\r\n        ctxRoles.api = hasRole(roles, 'apiusers');\r\n        ctxRoles.userReader = hasRole(roles, 'accountusersreader');\r\n        ctxRoles.roleReader = hasRole(roles, 'rolereaders');\r\n        ctxRoles.permissionReader = hasRole(roles, 'permissionreaders');\r\n        ctxRoles.author = hasRole(roles, 'articleauthors');\r\n        ctxRoles.systemAdmin = hasRole(roles, 'systemadministrators');\r\n        ctxRoles.accountAdmin = hasRole(roles, 'accountadministrators');\r\n        ctxRoles.dataAdmin = hasRole(roles, 'dataadministrators');\r\n        ctxRoles.objectAdmin = hasRole(roles, 'objectadministrators');\r\n        ctxRoles.scriptExecutor = hasRole(roles, 'scriptexecutors');\r\n        ctxRoles.admin = (ctxRoles.systemAdmin || ctxRoles.accountAdmin);\r\n    }\r\n\r\n}());\r\n\n"],
  "mappings": "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K,KAAO,EAAM,GAAK,EAAG,EAC7E7C,GAAK,GAKb,OAAOmL,CACX,CAEJ,EACG,OAAO,OAAU,IAChB,OAAO,OAASV,EAGhB,OAAO,QAAUA,CAEzB,GAAE,GAGD,UAAY,CAGX,IAAIY,EAAW,CACf,aAAgB,SAChB,WAAc,CACZ,CACE,OAAU,uBACV,KAAQ,WACR,MAAS,WACT,KAAQ,eACR,MAAS,CACP,cACA,kBACA,mBACA,YACA,kBACA,mBACA,kBACF,EACA,WAAc,CACZ,CACE,OAAU,uBACV,KAAQ,cACR,SAAY,eACZ,UAAa,GACb,KAAQ,QACR,MAAS,CACP,YACA,aACA,kBACA,kBACF,EACA,KAAQ,YACR,MAAS,CACP,mBACA,aACA,kBACA,WACF,CACF,CACF,CACF,EACA,CACE,OAAU,uBACV,MAAS,SACT,KAAQ,QACR,MAAS,CACP,uBACA,UACA,UACA,YACA,YACA,aACA,UACF,EACA,KAAQ,gBACR,WAAc,CACZ,CACE,OAAU,uBACV,KAAQ,UACR,UAAa,GACb,MAAS,UACT,MAAS,UACT,MAAS,CACP,YACA,YACF,EACA,KAAQ,QACR,KAAQ,cACR,MAAS,CACP,aACA,WACF,CACF,EACA,CACE,OAAU,uBACV,KAAQ,UACR,UAAa,GACb,MAAS,WACT,MAAS,CACP,YACA,YACF,EACA,KAAQ,aACR,KAAQ,UACR,MAAS,WACT,MAAS,CACP,aACA,WACF,CACF,CACF,CACF,EACA,CACE,OAAU,uBACV,KAAQ,UACR,MAAS,UACT,MAAS,CACP,uBACA,cACA,UACA,aACF,EACA,KAAQ,UACV,EACC,CACG,OAAU,uBACV,KAAQ,QACR,MAAS,QACT,MAAS,CAOP,kBACA,iBACA,sBACA,wBACA,gCACA,eACA,gBACA,WACF,EACA,KAAQ,YACV,EACF,CACE,OAAU,uBACV,KAAQ,SACR,MAAS,SACT,MAAS,CACP,gBACA,cACA,iBACA,cACA,mBACA,iBACF,EACA,KAAQ,QACV,EACA,CACE,OAAU,uBACV,KAAQ,OACR,MAAS,QACT,MAAS,CACP,OACA,cACA,uBACF,EACA,KAAQ,cACV,CACF,EACA,MAAS,CACP,cAAiB,CACf,OACA,UACA,OACA,WACA,SACA,OACA,OACA,MACA,OACA,OACA,QACA,SACA,YACA,WACA,SACA,SACF,EACA,yBAA4B,CAC1B,UACA,SACA,OACA,SACA,SACA,SACF,EACA,gBAAmB,CACjB,UACA,QACA,SACA,SACA,aACF,EACA,sBAAyB,CACvB,UACA,eACA,SACA,aACA,aACA,UACF,EACA,eAAkB,CAChB,UACA,MACA,UACA,SACA,SACA,QACA,OACA,UACA,WACA,QACA,OACA,SACA,UACA,eACA,YACA,QACA,OACA,SACA,WACF,EACA,iBAAoB,CAClB,UACA,oBACA,cACA,SACA,UACA,OACF,EACA,yBAA4B,CAC1B,UACA,UACA,OACA,SACA,YACA,UACA,YACA,SACF,EACA,iBAAoB,CAClB,UACA,QACA,SACA,cACA,aACA,UACA,OACA,MACF,EACA,+BAAkC,CAChC,UACA,gBACA,oBACA,kBACF,EACA,mBAAsB,CACpB,UACA,MACA,UACA,SACA,aACA,UACA,YACA,sBACA,eACA,yBACA,SACA,KACA,WACA,UACA,iBACA,qBACA,OACA,QACA,YACA,UACF,EACA,oBAAuB,CACrB,UACA,OACA,MACF,EACA,kBAAqB,CACnB,UACA,MACA,MACA,OACA,YACA,sBACA,eACA,wBACF,EACA,mBAAsB,CACpB,UACA,UACA,IACF,EACA,gBAAmB,CACjB,UACA,QACA,QACA,MACA,QACA,SACF,EACA,2BAA8B,CAC5B,UACA,aACA,QACA,eACA,UACA,UACA,OACA,QACF,EACA,sBAAyB,CACvB,UACA,SACA,OACA,QACA,SACA,SACA,UACA,KACF,EACA,gBAAmB,CACjB,UACA,QACF,EACA,mBAAsB,CACpB,UACA,kBACA,kBACA,OACA,qBACA,qBACA,QACA,cACA,YACA,UACA,MACA,WACF,EACA,eAAkB,CAChB,UACA,mBACA,kBACA,WACF,EACA,aAAgB,CACd,UACA,QACA,OACA,aACA,WACA,YACA,SACA,UACA,OACA,WACA,UACA,UACA,YACA,WACF,EACA,iBAAoB,CAClB,UACA,aACA,OACA,MACF,EACA,cAAiB,CACf,UACA,UACA,OACA,SACA,OACA,QACF,EACA,cAAiB,CACf,UACA,MACA,WACA,eACA,OACA,SACA,UACA,OACF,EACA,iBAAoB,CAClB,UACA,OACA,OACA,SACA,QACA,SACF,EACA,kBAAqB,CACnB,UACA,QACA,aACA,WACA,UACF,EACA,0BAA6B,CAC3B,UACA,YACA,SACA,OACF,EACA,cAAiB,CACf,YACA,aACA,SACF,EACA,qBAAwB,CACtB,UACA,OACA,SACA,SACA,aACF,EACA,gBAAmB,CACjB,UACA,YACA,WACA,YACA,aACA,gBACA,qBACA,eACA,UACF,EACA,mBAAsB,CACpB,UACA,OACA,QACA,OACA,aACA,UACA,OACA,SACA,SACA,aACF,EACA,sBAAyB,CACvB,UACA,eACA,SACA,SACA,OACF,EACA,uBAA0B,CACxB,UACA,gBACA,SACA,OACA,UACA,oBACA,mBACA,QACA,SACA,UACF,EACA,cAAiB,CACf,UACA,cACA,eACA,OACA,IACF,EACA,iBAAoB,CAClB,UACA,SACA,QACA,UACA,OACA,OACA,SACF,EACA,aAAgB,CACd,UACA,UACA,OACA,QACF,EACA,aAAgB,CACd,UACA,SACA,MACF,EACA,oBAAuB,CACrB,UACA,MACA,gBACA,iBACA,UACA,UACF,EACA,kBAAqB,CACnB,UACA,UACA,gBACA,QACA,UACA,QACA,OACA,UACA,QACF,EACA,oBAAuB,CACrB,UACA,QACA,WACA,SACA,eACA,cACA,WACA,UACA,sBACA,YACA,YACA,WACA,SACF,EACA,gBAAmB,CACjB,UACA,QACA,SACA,SACA,MACA,OACA,UACA,OACA,OACA,WACA,OACA,UACA,WACA,SACA,QACA,UACA,cACA,gBACA,cACA,OACA,UACA,QACA,OACA,MACA,WACA,SACA,OACA,YACA,UACA,YACA,UACA,SACA,MACF,EACA,mBAAsB,CACpB,UACA,OACA,OACA,SACF,EACA,eAAkB,CAChB,UACA,OACA,SACF,EACA,YAAe,CACb,UACA,UACA,OACA,OACA,SACA,OACF,EACA,aAAgB,CACd,UACA,QACA,SACA,SACA,aACF,EACA,mBAAsB,CACpB,UACA,eACA,SACA,aACA,aACA,UACF,EACA,mBAAsB,CACpB,UACA,UACA,WACA,cACA,MACF,EACA,cAAiB,CACf,UACA,SACA,MACA,OACA,UACA,WACA,YACF,EACA,qBAAwB,CACtB,UACA,UACA,WACA,eACA,OACF,EACA,kBAAqB,CACnB,cACA,cACA,aACA,iBACA,UACA,UACA,gBACA,cACA,cACA,YACF,EACA,iBAAoB,CAClB,UACA,WACA,QACA,aACA,WACF,EACA,mBAAsB,CACpB,UACA,gBACA,SACA,OACA,SACA,OACA,YACA,aACA,eACA,WACF,EACA,sBAAyB,CACvB,eACA,aACA,WACA,YACA,cACA,gBACA,iBACA,OACA,QACA,WACA,gBACA,gBACA,WACA,kBACA,YACA,cACA,YACA,SACF,EACA,gBAAmB,CACjB,UACA,YACA,YACA,OACA,SACA,QACA,UACA,mBACA,OACA,OACA,aACA,cACF,EACA,kBAAqB,CACnB,QACA,YACA,OACA,YACA,QACA,YACA,OACA,YACA,SACF,EACA,oBAAuB,CACrB,UACA,cACA,SACA,cACA,WACA,UACA,SACF,EACA,kBAAqB,CACnB,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,OACA,MACA,MACA,QACA,OACA,OACA,MACA,QACA,QACA,OACA,MACA,SACA,SACA,WACA,UACF,EACA,aAAgB,CACd,cACA,QACA,MACA,UACA,aACA,gBACA,OACA,SACA,WACA,UACA,WACA,eACA,OACA,WACA,WACA,WACA,cACA,SACA,WACA,YACA,OACA,UACA,MACF,EACA,iBAAoB,CAClB,cACA,gBACA,QACA,QACA,OACA,aACA,aACA,gBACA,aACA,gBACA,UACA,MACA,SACA,SACA,WACA,UACA,OACA,WACA,WACA,WACA,SACA,WACA,OACA,gBACF,EACA,oBAAuB,CACrB,cACA,OACA,SACA,WACA,SACA,WACA,SACA,SACA,WACA,cACA,UACA,WACA,aACA,YACA,aACA,YACA,OACA,SACA,SACA,YACA,WACA,oBACA,uBACA,OACA,WACA,cACA,SACA,YACA,OACA,SACA,gBACA,WACA,SACA,UACA,OACA,WACA,YACA,WACA,SACF,EACA,kBAAqB,CACnB,aACA,WACA,SACA,aACA,SACF,EACA,gBAAmB,CACjB,iBACA,YACA,cACA,cACA,kBACF,EACA,wBAA2B,CACzB,UACA,aACA,eACA,WACA,aACA,OACA,OACA,QACA,WACA,cACA,MACA,WACF,EACA,aAAgB,CACd,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,GACF,EACA,eAAkB,CAChB,MACA,YACA,YACA,aACA,wBACA,UACA,WACA,WACA,YACA,gBACA,aACA,YACA,eACA,aACA,aACA,eACA,YACA,aACA,WACA,WACA,eACA,eACA,kBACA,mBACA,WACA,WACA,aACA,OACA,gBACA,YACA,cACA,UACA,YACA,SACA,SACA,WACA,aACA,eACA,YACA,SACF,EACA,aAAgB,CACd,UACA,oBACA,uBACA,UACA,UACA,iBACF,EACA,oBAAuB,CACrB,WACA,aACA,YACA,SACA,WACA,SACF,EACA,eAAkB,CAChB,gBACA,gBACA,kBACA,kBACA,uBACA,qBACA,qBACA,gBACA,gBACA,gBACA,qBACA,qBACA,OACA,kBACA,kBACA,kBACA,kBACA,mBACA,mBACA,uBACA,uBACA,gBACA,gBACA,gBACA,eACF,EACA,aAAgB,CACd,cACA,QACA,WACA,WACA,cACA,kBACA,WACA,aACA,UACA,SACA,OACA,SACA,YACF,EACA,kBAAqB,CACnB,OACA,WACA,QACA,KACA,OACA,SACA,OACA,YACA,YACA,OACA,QACA,YACA,YACA,SACF,EACA,aAAgB,CACd,IACA,MACA,IACA,IACA,KACA,IACF,EACA,mBAAsB,CACpB,UACA,QACA,SACA,QACF,CACF,EACA,OAAU,CACR,CACE,KAAQ,cACR,SAAY,GACZ,OAAU,CACR,CACE,MAAS,OACT,KAAQ,OACR,KAAQ,SACR,SAAY,GACZ,MAAS,GACT,UAAa,GACb,UAAa,IACb,MAAS,CACP,WACF,EACA,UAAa,GACf,CACF,CACF,EACA,CACE,KAAQ,iBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,UACR,KAAQ,OACR,SAAY,GACZ,QAAW,GACX,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,kBACR,SAAY,GACZ,MAAS,CACP,UACF,EACA,OAAU,CACR,CACE,KAAQ,WACR,KAAQ,SACR,SAAY,GACZ,SAAY,GACZ,UAAa,GACb,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,uBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,aACR,KAAQ,OACR,SAAY,QACZ,UAAa,mBACb,WAAc,GACd,gBAAmB,GACnB,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,yBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,mBACR,KAAQ,SACR,QAAW,GACX,UAAa,sBACb,aAAgB,iBAChB,SAAY,gDACZ,SAAY,EACZ,UAAa,IACf,EACA,CACE,KAAQ,iBACR,KAAQ,OACR,SAAY,GACZ,QAAW,GACX,MAAS,GACT,cAAiB,GACjB,UAAa,GACf,CACF,CACF,EACA,CACE,KAAQ,kBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,YACR,KAAQ,UACR,UAAa,GACb,UAAa,KACf,EACA,CACE,KAAQ,kBACR,KAAQ,OACR,SAAY,SACZ,UAAa,GACb,QAAW,GACX,UAAa,MACf,CACF,CACF,EACA,CACE,KAAQ,oBACR,SAAY,GACZ,MAAS,CACP,IACF,EACA,OAAU,CACR,CACE,KAAQ,KACR,MAAS,KACT,KAAQ,OACR,MAAS,GACT,SAAY,GACZ,SAAY,GACZ,QAAW,GACX,SAAY,GACZ,WAAc,GACd,UAAa,GACf,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,GACZ,SAAY,CACV,iBACA,kBACA,uBACA,yBACA,kBACA,mBACF,EACA,QAAW,8CACX,MAAS,CACP,KACA,WACA,UACA,gBACF,EACA,OAAU,CAAC,CACb,EACA,CACE,KAAQ,aACR,SAAY,GACZ,MAAS,CACP,KACF,EACA,OAAU,CACR,CACE,KAAQ,MACR,KAAQ,SACR,SAAY,GACZ,SAAY,+CACZ,SAAY,EACZ,SAAY,GACZ,UAAa,IACb,UAAa,GACf,CACF,CACF,EACA,CACE,KAAQ,YACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,QACR,KAAQ,UACR,UAAa,GACb,UAAa,KACf,CACF,CACF,EACA,CACE,KAAQ,cACR,SAAY,GACZ,SAAY,CACV,mBACA,aACA,WACF,EACA,QAAW,8CACX,MAAS,CACP,KACA,MACA,WACA,SACF,EACA,OAAU,CAAC,CACb,EACA,CACE,KAAQ,qBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,WACR,KAAQ,OACR,SAAY,QACZ,UAAa,iBACb,QAAW,GACX,gBAAmB,GACnB,UAAa,MACf,CACF,CACF,EACA,CACE,KAAQ,eACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,OACR,SAAY,QACZ,UAAa,WACb,QAAW,GACX,cAAiB,GACjB,gBAAmB,EACrB,CACF,CACF,EACA,CACE,KAAQ,gBACR,SAAY,CACV,cACA,cACA,qBACA,cACF,EACA,SAAY,GACZ,MAAS,CACP,MACF,EACA,OAAU,CAAC,CACb,EACA,CACE,KAAQ,gBACR,SAAY,GACZ,MAAS,CACP,UACF,EACA,WAAc,CACZ,MAAS,CACP,CACE,OAAU,CACR,UACF,EACA,MAAS,CACP,cACF,CACF,CACF,CACF,EACA,OAAU,CACR,CACE,KAAQ,WACR,KAAQ,OACR,aAAgB,KAChB,UAAa,QACb,SAAY,GACZ,MAAS,GACT,QAAW,EACX,UAAa,GACb,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,cACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,SACR,QAAW,GACX,SAAY,gDACZ,SAAY,CACd,CACF,CACF,EACA,CACE,KAAQ,sBACR,SAAY,CACV,gBACA,gBACA,aACF,EACA,YAAe,CACb,gBACF,EACA,KAAQ,SACR,MAAS,eACT,YAAe,6DACf,OAAU,CACR,CACE,KAAQ,OACR,UAAa,2DACb,KAAQ,OACR,SAAY,GACZ,MAAS,GACT,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,kBACR,cAAiB,CACf,MACF,EACA,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,KACR,KAAQ,OACR,SAAY,GACZ,SAAY,GACZ,QAAW,EACb,EACA,CACE,KAAQ,WACR,KAAQ,SACR,SAAY,GACZ,SAAY,GACZ,UAAa,EACf,EACA,CACE,KAAQ,OACR,KAAQ,SACR,SAAY,EACd,EACA,CACE,KAAQ,aACR,KAAQ,SACR,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,uBACR,SAAY,CACV,iBACF,EACA,cAAiB,CACf,MACF,EACA,OAAU,CACR,CACE,KAAQ,iBACR,KAAQ,MACV,CACF,CACF,EACA,CACE,KAAQ,iCACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,qBACR,UAAa,8BACb,KAAQ,QACR,QAAW,GACX,OAAU,CACR,MAAS,CACP,KAAQ,CACN,qBACF,CACF,CACF,EACA,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,cACR,YAAe,CACb,sBACF,EACA,SAAY,CACV,gBACA,gCACF,EACA,KAAQ,gBACR,MAAS,OACT,WAAc,CACZ,MAAS,CACP,CACE,OAAU,CACR,MACF,EACA,MAAS,CACP,UACF,CACF,CACF,CACF,EACA,GAAM,CACJ,OAAU,+CACZ,EACA,YAAe,wCACf,OAAU,CACR,MAAS,CACP,OAAU,CACR,uBACF,EACA,KAAQ,CACN,wBACA,qBACF,EACA,OAAU,CACR,uBACF,EACA,OAAU,CACR,uBACF,EACA,MAAS,CACP,uBACF,CACF,CACF,EACA,MAAS,CACP,OACA,eACF,EACA,OAAU,CACR,CACE,KAAQ,gBACR,UAAa,aACb,KAAQ,QACR,QAAW,GACX,OAAU,CACR,MAAS,CACP,KAAQ,CACN,qBACF,CACF,CACF,EACA,UAAa,IACf,EACA,CACE,KAA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ACA,KAAQ,SACR,MAAS,QACT,uBAA0B,GAC1B,YAAe,yNACf,MAAS,CACP,OACA,OACA,gBACF,EACA,OAAU,CACR,CACE,KAAQ,OACR,UAAa,oDACb,KAAQ,OACR,SAAY,GACZ,MAAS,GACT,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,GACZ,MAAS,CACP,6BACF,EACA,OAAU,CACR,CACE,KAAQ,iBACR,KAAQ,SACR,UAAa,GACb,UAAa,IACf,EACA,CACE,KAAQ,cACR,KAAQ,OACR,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,CACV,mBACA,kBACF,EACA,gBAAmB,GACnB,YAAe,oIACf,OAAU,CACR,MAAS,CACP,OAAU,CACR,cACF,EACA,KAAQ,CACN,uBACA,oBACF,EACA,OAAU,CACR,uBACF,EACA,OAAU,CACR,uBACA,oBACF,EACA,MAAS,CACP,uBACF,CACF,CACF,EACA,MAAS,CACP,OACA,QACA,WACF,EACA,UAAa,OACb,UAAa,YACb,OAAU,CACR,CACE,KAAQ,QACR,KAAQ,OACR,UAAa,YACb,UAAa,GACf,EACA,CACE,KAAQ,YACR,UAAa,oDACb,KAAQ,OACR,QAAW,SACX,UAAa,GACb,UAAa,IACf,EACA,CACE,KAAQ,aACR,KAAQ,SACR,UAAa,IACb,UAAa,IACf,EACA,CACE,KAAQ,OACR,KAAQ,SACR,UAAa,GACb,UAAa,GACf,CACF,CACF,EACA,CACE,KAAQ,YACR,SAAY,CACV,gBACA,cACA,eACF,EACA,YAAe,CACb,sCACF,EACA,KAAQ,QACR,MAAS,OACT,uBAA0B,GAC1B,YAAe,2KACf,OAAU,CACR,CACE,KAAQ,OACR,UAAa,mDACb,KAAQ,OACR,MAAS,GACT,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,kBACR,SAAY,CACV,gBACA,cACA,eACF,EACA,YAAe,CACb,sCACF,EACA,KAAQ,SACR,MAAS,aACT,uBAA0B,GAC1B,YAAe,6KACf,OAAU,CACR,CACE,MAAS,OACT,KAAQ,OACR,UAAa,yDACb,KAAQ,OACR,MAAS,GACT,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,kBACR,UAAa,0DACb,KAAQ,OACR,UAAa,GACb,QAAW,SACb,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,cACR,KAAQ,SACR,UAAa,GACf,CACF,CACF,EACA,CACE,KAAQ,iBACR,SAAY,GACZ,SAAY,CACV,mBACA,kBACF,EACA,OAAU,CACR,CACE,KAAQ,iBACR,KAAQ,MACV,EACA,CACE,KAAQ,WACR,KAAQ,SACR,UAAa,GACf,EACA,CACE,KAAQ,gBACR,KAAQ,UACR,QAAW,EACb,EACA,CACE,KAAQ,OACR,KAAQ,MACV,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,YACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,aACR,KAAQ,SACV,CACF,CACF,EACA,CACE,KAAQ,kBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,QACR,KAAQ,SACR,UAAa,GACb,UAAa,KACf,EACA,CACE,KAAQ,UACR,KAAQ,SACR,UAAa,GACb,UAAa,KACf,EACA,CACE,KAAQ,UACR,KAAQ,UACR,UAAa,IACf,EACA,CACE,KAAQ,gBACR,KAAQ,OACR,SAAY,SACZ,UAAa,GACb,UAAa,IACf,EACA,CACE,KAAQ,kBACR,KAAQ,OACR,SAAY,SACZ,UAAa,GACb,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,yBACR,SAAY,GACZ,SAAY,CACV,iBACA,mBACA,iBACF,EACA,OAAU,CAAC,CACb,EACA,CACE,KAAQ,kBACR,SAAY,OACZ,QAAW,kDACX,OAAU,CACR,CACE,KAAQ,cACR,KAAQ,YACR,UAAa,IACf,EACA,CACE,KAAQ,eACR,KAAQ,YACR,MAAS,gBACT,UAAa,IACf,EACA,CACE,KAAQ,aACR,KAAQ,YACR,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,iBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,SACR,UAAa,cACb,KAAQ,QACR,QAAW,GACX,gBAAmB,EACrB,CACF,CACF,EACA,CACE,KAAQ,YACR,SAAY,CACV,iBACA,yBACA,qBACA,kBACA,gBACF,EACA,MAAS,OACT,KAAQ,cACR,MAAS,OACT,uBAA0B,GAC1B,UAAa,OACb,UAAa,YACb,MAAS,CACP,cACA,gBACF,EACA,YAAe,+FACf,OAAU,CACR,CACE,KAAQ,aACR,KAAQ,SACR,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,iBACR,SAAY,CACV,gBACA,kBACA,kBACF,EACA,MAAS,WACT,KAAQ,eACR,MAAS,UACT,YAAe,+IACf,OAAU,CACR,CACE,KAAQ,YACR,KAAQ,MACV,EACA,CACE,KAAQ,cACR,UAAa,sDACb,KAAQ,OACR,UAAa,EACf,EACA,CACE,KAAQ,SACR,UAAa,4DACb,KAAQ,OACR,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,kBACR,SAAY,CACV,cACA,kBACA,kBACA,mBACA,kBACF,EACA,QAAW,oDACX,KAAQ,eACR,MAAS,aACT,YAAe,mKACf,OAAU,CACR,MAAS,CACP,OAAU,CACR,cACF,EACA,KAAQ,CACN,uBACA,oBACF,EACA,OAAU,CACR,uBACF,EACA,OAAU,CACR,uBACA,oBACF,EACA,MAAS,CACP,uBACF,CACF,CACF,EACA,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,SACR,UAAa,GACb,UAAa,GACf,EACA,CACE,KAAQ,OACR,UAAa,cACb,KAAQ,QACR,QAAW,EACb,EACA,CACE,KAAQ,aACR,KAAQ,MACV,EACA,CACE,KAAQ,UACR,KAAQ,UACR,MAAS,EACX,EACA,CACE,KAAQ,uBACR,KAAQ,MACV,EACA,CACE,KAAQ,mBACR,KAAQ,MACV,EACA,CACE,KAAQ,OACR,UAAa,yDACb,KAAQ,OACR,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,eACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,QACR,KAAQ,KACV,CACF,CACF,EACA,CACE,KAAQ,eACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,QACR,KAAQ,MACR,UAAa,KACf,CACF,C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,KAAQ,gBACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,eACR,KAAQ,MACV,EACA,CACE,KAAQ,iBACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,eACR,KAAQ,KACV,EACA,CACE,KAAQ,WACR,KAAQ,KACV,EACA,CACE,KAAQ,iBACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,UACR,KAAQ,OACR,UAAa,YACf,EACA,CACE,KAAQ,YACR,KAAQ,SACR,QAAW,GACX,UAAa,aACb,aAAgB,UAChB,SAAY,+CACd,EACA,CACE,KAAQ,YACR,KAAQ,SACR,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,aACR,SAAY,CACV,eACF,EACA,QAAW,+CACX,YAAe,WACf,OAAU,CAAC,CACb,EACA,CACE,KAAQ,gBACR,SAAY,CACV,kBACF,EACA,cAAiB,CACf,SACF,EACA,OAAU,CACR,CACE,KAAQ,cACR,KAAQ,SACR,YAAe,mGACjB,CACF,CACF,EACA,CACE,KAAQ,oBACR,QAAW,uDACX,cAAiB,CACf,MACF,EACA,OAAU,CACR,CACE,KAAQ,aACR,KAAQ,OACR,SAAY,QACZ,UAAa,eACf,CACF,CACF,EACA,CACE,KAAQ,cACR,QAAW,uDACX,cAAiB,CACf,MACF,EACA,OAAU,CACR,CACE,KAAQ,SACR,KAAQ,OACR,QAAW,GACb,EACA,CACE,KAAQ,UACR,KAAQ,OACR,SAAY,QACZ,UAAa,kBACf,CACF,CACF,EACA,CACE,KAAQ,mBACR,cAAiB,CACf,MACF,EACA,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,SACR,KAAQ,OACR,SAAY,QACZ,UAAa,uBACf,CACF,CACF,EACA,CACE,KAAQ,wBACR,cAAiB,CACf,MACF,EACA,SAAY,CACV,kBACF,EACA,OAAU,CAAC,CACb,EACA,CACE,KAAQ,kBACR,SAAY,CACV,sBACF,EACA,cAAiB,CACf,MACF,EACA,OAAU,CAAC,CACb,EACA,CACE,KAAQ,kBACR,SAAY,CACV,gBACF,EACA,MAAS,aACT,YAAe,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,SAAY,CACV,iBACF,EACA,YAAe,2KACf,OAAU,CACR,CACE,KAAQ,YACR,KAAQ,OACV,EACA,CACE,KAAQ,SACR,KAAQ,OACR,SAAY,QACd,EACA,CACE,KAAQ,WACR,UAAa,qEACb,KAAQ,OACR,MAAS,GACT,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,uBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,cACR,KAAQ,SACR,UAAa,KACb,UAAa,KACf,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,YACR,KAAQ,OACR,WAAc,EAChB,CACF,CACF,EACA,CACE,KAAQ,eACR,SAAY,CACV,kBACA,yBACA,uBACA,oBACA,mBACA,iBACA,kBACF,EACA,QAAW,+CACX,2BAA8B,GAC9B,YAAe,gDACf,OAAU,CACR,CACE,KAAQ,WACR,KAAQ,SACR,SAAY,GACZ,SAAY,GACZ,UAAa,EACf,EACA,CACE,KAAQ,SACR,UAAa,qDACb,KAAQ,OACR,MAAS,GACT,UAAa,EACf,EACA,CACE,KAAQ,WACR,UAAa,uDACb,KAAQ,OACR,MAAS,GACT,UAAa,EACf,EACA,CACE,KAAQ,WACR,UAAa,QACb,KAAQ,QACR,QAAW,GACX,YAAe,cACjB,EACA,CACE,KAAQ,eACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,cACR,UAAa,cACb,KAAQ,QACR,QAAW,EACb,EACA,CACE,KAAQ,UACR,KAAQ,SACR,UAAa,IACf,EACA,CACE,KAAQ,QACR,KAAQ,QACV,EACA,CACE,KAAQ,SACR,UAAa,wBACb,KAAQ,OACV,CACF,CACF,EACA,CACE,KAAQ,8BACR,SAAY,CACV,iBACA,kBACA,yBACA,kBACA,oBACA,mBACA,YACF,EACA,OAAU,CACR,MAAS,CACP,OAAU,CACR,cACF,EACA,KAAQ,CACN,uBACA,oBACF,EACA,OAAU,CACR,uBACF,EACA,OAAU,CACR,uBACA,oBACF,EACA,MAAS,CACP,uBACF,CACF,EACA,SAAY,CACV,KAAQ,CACN,SAAY,cACZ,aAAgB,iBAChB,YAAe,gLACjB,CACF,CACF,EACA,YAAe,0IACf,gBAAmB,GACnB,uBAA0B,GAC1B,MAAS,CACP,cACA,iBACA,KACA,UACA,gBACF,EACA,OAAU,CACR,CACE,KAAQ,WACR,UAAa,mBACb,SAAY,QACZ,QAAW,GACX,KAAQ,OACR,iBAAoB,YACtB,EACA,CACE,KAAQ,YACR,UAAa,mBACb,SAAY,QACZ,QAAW,GACX,KAAQ,OACR,iBAAoB,YACtB,EACA,CACE,KAAQ,yBACR,UAAa,iEACb,KAAQ,OACR,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,kBACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,cACR,UAAa,QACb,KAAQ,QACR,QAAW,GACX,YAAe,kBACf,OAAU,CACR,MAAS,CACP,OAAU,CACR,sBACA,iBACA,cACA,mBACF,EACA,KAAQ,CACN,sBACA,iBACA,cACA,mBACF,CACF,CACF,CACF,CACF,CACF,EACA,CACE,KAAQ,oBACR,SAAY,OACZ,SAAY,CACV,gBACA,gBACA,iBACA,mBACA,kBACA,oBACF,EACA,OAAU,CACR,CACE,KAAQ,eACR,UAAa,QACb,KAAQ,QACR,YAAe,eACf,YAAe,kDACjB,EACA,CACE,KAAQ,WACR,UAAa,QACb,KAAQ,QACR,QAAW,GACX,YAAe,eACf,OAAU,CACR,MAAS,CACP,KAAQ,CACN,gBACF,CACF,CACF,CACF,EACA,CACE,KAAQ,eACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,QACR,KAAQ,QACV,CACF,CACF,EACA,CACE,KAAQ,kBACR,SAAY,GACZ,SAAY,CACV,kBACF,EACA,YAAe,sGACf,OAAU,CACR,CACE,KAAQ,WACR,UAAa,QACb,KAAQ,QACR,QAAW,GACX,YAAe,eACf,OAAU,CACR,MAAS,CACP,KAAQ,CACN,sBACA,gBACF,CACF,CACF,CACF,EACA,CACE,KAAQ,eACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,WACR,UAAa,QACb,KAAQ,QACR,QAAW,GACX,YAAe,eACf,OAAU,CACR,MAAS,CACP,KAAQ,CACN,sBACA,gBACF,CACF,CACF,CACF,EACA,CACE,KAAQ,eACR,KAAQ,SACR,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,uBACR,SAAY,CACV,oBACA,kBACA,gBACF,EACA,QAAW,uDACX,KAAQ,yBACR,MAAS,iBACT,YAAe,sKACf,OAAU,CACR,MAAS,CACP,OAAU,CACR,YACF,EACA,KAAQ,CACN,gBACF,EACA,OAAU,CACR,kBACA,uBACF,EACA,OAAU,CACR,uBACF,EACA,MAAS,CACP,uBACF,CACF,CACF,EACA,OAAU,CACR,CACE,KAAQ,WACR,UAAa,gBACb,SAAY,QACZ,KAAQ,MACV,EACA,CACE,KAAQ,iBACR,UAAa,+DACb,KAAQ,OACR,QAAW,UACX,UAAa,GACb,OAAU,CACR,MAAS,CACP,OAAU,CACR,YACA,iBACF,CACF,CACF,CACF,CACF,CACF,EACA,CACE,KAAQ,qBACR,SAAY,CACV,eACF,EACA,YAAe,CACb,sBACF,EACA,MAAS,CACP,OACA,YACF,EACA,YAAe,+CACf,OAAU,CACR,CACE,KAAQ,aACR,KAAQ,MACV,CACF,CACF,EACA,CACE,KAAQ,cACR,SAAY,CACV,iBACA,qBACA,kBACA,mBACA,iBACF,EACA,SAAY,kDACZ,MAAS,CACP,cACA,MACF,EACA,YAAe,oDACf,OAAU,CACR,CACE,KAAQ,eACR,KAAQ,SACR,SAAY,wDACZ,SAAY,GACZ,QAAW,EACb,EACA,CACE,KAAQ,OACR,UAAa,qDACb,KAAQ,OACR,QAAW,UACX,UAAa,EACf,EACA,CACE,KAAQ,OACR,KAAQ,MACV,EACA,CACE,KAAQ,WACR,KAAQ,OACR,SAAY,QACZ,UAAa,qBACb,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,qBACR,UAAa,GACb,GAAM,CACJ,OAAU,wDACV,OAAU,wDACV,OAAU,uDACZ,EACA,OAAU,CACR,SAAY,CACV,KAAQ,CACN,SAAY,WACZ,OAAU,cACV,YAAe,gLACjB,CACF,CACF,EACA,OAAU,CACR,CACE,KAAQ,WACR,KAAQ,SACR,UAA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OACR,SAAY,QACZ,UAAa,gBACb,QAAW,EACb,CACF,CACF,EACA,CACE,KAAQ,YACR,SAAY,CACV,iBACA,gBACA,iBACF,EACA,MAAS,QACT,KAAQ,OACR,MAAS,OACT,YAAe,qDACf,UAAa,GACb,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,QACV,CACF,CACF,EACA,CACE,KAAQ,wBACR,cAAiB,CACf,SACF,EACA,OAAU,CACR,CACE,KAAQ,kBACR,KAAQ,KACV,EACA,CACE,KAAQ,QACR,KAAQ,QACV,EACA,CACE,KAAQ,UACR,UAAa,gBACb,KAAQ,OACV,EACA,CACE,KAAQ,SACR,KAAQ,OACR,SAAY,QACd,EACA,CACE,KAAQ,YACR,KAAQ,OACR,SAAY,MACZ,MAAS,CAAC,EAAG,EAAG,CAAC,CACnB,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,CACV,kBACA,yBACA,mBACA,mBACF,EACA,OAAU,CACR,MAAS,CACP,OAAU,CACR,cACF,EACA,KAAQ,CACN,cACF,CACF,CACF,EACA,YAAe,mDACf,YAAe,CACb,wDACF,EACA,QAAW,mDACX,OAAU,CACR,CACE,KAAQ,YACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,UACR,KAAQ,SACV,EACA,CACE,KAAQ,UACR,KAAQ,OACR,SAAY,GACZ,QAAW,EACb,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,OACZ,OAAU,CACR,CACE,KAAQ,YACR,UAAa,iDACb,KAAQ,OACR,UAAa,GACb,UAAa,KACf,CACF,CACF,EACA,CACE,KAAQ,aACR,SAAY,CACV,iBACA,qBACA,mBACA,cACF,EACA,YAAe,CACb,qCACF,EACA,MAAS,SACT,KAAQ,WACR,MAAS,QACT,YAAe,gOACf,OAAU,CACR,CACE,KAAQ,OACR,UAAa,oDACb,KAAQ,OACR,UAAa,EACf,EACA,CACE,KAAQ,OACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,eACR,KAAQ,OACR,SAAY,QACZ,UAAa,QACb,QAAW,GACX,gBAAmB,EACrB,CACF,CACF,EACA,CACE,KAAQ,YACR,a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A,kBACA,kBACF,EACA,MAAS,CACP,KACA,WACA,UACA,WACA,OACF,EACA,YAAe,4IACf,KAAQ,SACR,MAAS,UACT,MAAS,WACT,uBAA0B,GAC1B,OAAU,CACR,CACE,KAAQ,QACR,KAAQ,OACR,SAAY,QACZ,UAAa,YACb,QAAW,GACX,iBAAoB,eACtB,EACA,CACE,KAAQ,WACR,KAAQ,QACR,UAAa,YACb,QAAW,EACb,EACA,CACE,KAAQ,QACR,KAAQ,QACR,UAAa,iBACb,QAAW,EACb,EACA,CACE,KAAQ,eACR,KAAQ,SACR,UAAa,GACf,EACA,CACE,KAAQ,kBACR,KAAQ,SACR,UAAa,GACf,EACA,CACE,KAAQ,YACR,KAAQ,SACR,UAAa,GACf,CACF,CACF,EACA,CACE,KAAQ,mBACR,SAAY,CACV,iBACF,EACA,SAAY,GACZ,MAAS,CAAC,EACV,OAAU,CACR,CACE,KAAQ,QACR,KAAQ,KACV,EACA,CACE,KAAQ,aACR,KAAQ,KACV,EACA,CACE,KAAQ,UACR,KAAQ,SACR,SAAY,wDACZ,QAAW,EACb,EACA,CACE,KAAQ,YACR,KAAQ,SACR,UAAa,GACf,CACF,CACF,EACA,CACE,KAAQ,wBACR,SAAY,CACV,kBACA,kBACA,mBACA,yBACA,mBACF,EACA,MAAS,CACP,kBACA,sBACA,QACA,YACF,EACA,MAAS,CACP,sCACF,EACA,YAAe,yFACf,OAAU,CACR,CACE,KAAQ,kBACR,UAAa,QACb,KAAQ,QACR,QAAW,GACX,YAAe,sBACf,OAAU,CACR,MAAS,CACP,KAAQ,CACN,cACF,CACF,CACF,CACF,EACA,CACE,KAAQ,sBACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,QACR,KAAQ,SACR,UAAa,EACf,CACF,CACF,EACA,CACE,KAAQ,kBACR,UAAa,GACb,QAAW,oDACX,OAAU,CACR,CACE,KAAQ,UACR,SAAY,QACZ,UAAa,wBACb,KAAQ,MACV,CACF,CACF,EACA,CACE,KAAQ,mBACR,cAAiB,CACf,SACF,EACA,SAAY,CAAC,EACb,MAAS,CAAC,EACV,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,QACV,EACA,CACE,KAAQ,UACR,KAAQ,KACV,EACA,CACE,KAAQ,eACR,KAAQ,QACV,EACA,CACE,KAAQ,OACR,KAAQ,QACV,EACA,CACE,KAAQ,QACR,KAAQ,KACV,EACA,CACE,KAAQ,aACR,KAAQ,KACV,EACA,CACE,KAAQ,UACR,KAAQ,QACV,CACF,CACF,EACA,CACE,KAAQ,qBACR,cAAiB,CACf,SACF,EACA,OAAU,CACR,CACE,KAAQ,KACR,KAAQ,QACV,EACA,CACE,KAAQ,OACR,UAAa,yDACb,KAAQ,OACR,UAAa,GACb,QAAW,SACb,EACA,CACE,KAAQ,YACR,UAAa,QACb,KAAQ,QACR,QAAW,GACX,YAAe,gBACf,OAAU,CACR,MAAS,CACP,KAAQ,CACN,UACF,CACF,CACF,CACF,EACA,CACE,KAAQ,gBACR,KAAQ,QACV,EACA,CACE,KAAQ,gBACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,OACR,UAAa,QACb,KAAQ,QACR,QAAW,GACX,YAAe,WACf,OAAU,CACR,MAAS,CACP,KAAQ,CACN,UACF,CACF,CACF,CACF,EACA,CACE,KAAQ,WACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,UACR,KAAQ,MACV,CACF,CACF,EACA,CACE,KAAQ,sBACR,SAAY,CACV,oBACF,EACA,cAAiB,CACf,SACF,EACA,OAAU,CACR,CACE,KAAQ,eACR,UAAa,uDACb,KAAQ,OACR,UAAa,GACb,QAAW,SACb,CACF,CACF,EACA,CACE,KAAQ,YACR,cAAiB,CACf,WACF,EACA,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,QACV,EACA,CACE,KAAQ,YACR,KAAQ,QACV,EACA,CACE,KAAQ,uBACR,KAAQ,QACV,EACA,CACE,KAAQ,eACR,KAAQ,QACV,EACA,CACE,KAAQ,WACR,KAAQ,UACR,QAAW,EACb,EACA,CACE,KAAQ,QACR,KAAQ,OACR,SAAY,QACZ,UAAa,eACf,EACA,CACE,KAAQ,SACR,KAAQ,QACR,UAAa,eACf,CACF,CACF,EACA,CACE,KAAQ,gBACR,cAAiB,CACf,WACF,EACA,SAAY,CACV,oBACF,EACA,OAAU,CACR,CACE,KAAQ,WACR,KAAQ,QACV,EACA,CACE,KAAQ,OACR,KAAQ,MACR,QAAW,CACb,EACA,CACE,KAAQ,uBACR,KAAQ,QACV,EACA,CACE,KAAQ,eACR,KAAQ,QACV,EACA,CACE,KAAQ,SACR,KAAQ,OACR,SAAY,QACZ,UAAa,eACf,EACA,CACE,KAAQ,SACR,KAAQ,QACR,UAAa,eACf,CACF,CACF,EACA,CACE,KAAQ,iBACR,SAAY,CACV,iBACA,gCACF,EACA,KAAQ,YACR,MAAS,QACT,MAAS,SACT,YAAe,kCACf,OAAU,CACR,CACE,KAAQ,SACR,KAAQ,SACR,QAAW,OACX,MAAS,CACP,QACA,MACF,CACF,EACA,CACE,KAAQ,YACR,KAAQ,MACR,QAAW,EACb,EACA,CACE,KAAQ,cACR,KAAQ,QACR,UAAa,YACb,QAAW,EACb,EACA,CACE,KAAQ,UACR,KAAQ,SACR,QAAW,UACX,MAAS,CACP,UACA,mBACF,CACF,EACA,CACE,KAAQ,QACR,KAAQ,SACR,SAAY,GACZ,SAAY,EACZ,QAAW,GACb,CACF,CACF,EACA,CACE,KAAQ,kBACR,SAAY,CACV,kBACA,kBACF,EACA,MAAS,aACT,KAAQ,OACR,MAAS,mBACT,uBAA0B,GAC1B,QAAW,iDACX,OAAU,8CACV,MAAS,CACP,SACF,EACA,YAAe,6OACf,OAAU,CACR,CACE,KAAQ,WACR,KAAQ,QACR,UAAa,aACb,QAAW,EACb,EACA,CACE,KAAQ,YACR,KAAQ,QACR,UAAa,aACb,QAAW,EACb,EACA,CACE,KAAQ,YACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,SACR,KAAQ,OACR,SAAY,QACd,EACA,CACE,KAAQ,SACR,KAAQ,OACR,SAAY,QACZ,UAAa,aACb,QAAW,GACX,iBAAoB,cACtB,EACA,CACE,KAAQ,QACR,KAAQ,QACR,UAAa,aACb,QAAW,GACX,iBAAoB,eACpB,UAAa,KACf,EACA,CACE,KAAQ,aACR,KAAQ,QACR,UAAa,kBACb,QAAW,GACX,UAAa,KACf,EACA,CACE,KAAQ,WACR,KAAQ,QACR,UAAa,gBACb,QAAW,GACX,UAAa,MACf,EACA,CACE,KAAQ,YACR,KAAQ,QACR,UAAa,iBACb,QAAW,EACb,EACA,CACE,KAAQ,QACR,KAAQ,QACR,UAAa,aACb,QAAW,GACX,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,gBACR,aAAgB,CACd,gBACF,EACA,SAAY,CACV,kBACA,kBACF,EACA,MAAS,YACT,KAAQ,WACR,YAAe,mPACf,MAAS,WACT,OAAU,CACR,CACE,KAAQ,QACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,QACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,SACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,OACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,OACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,QACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,OACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,OACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,UACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,YACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,SACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,QACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,QACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,MACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,UACR,KAAQ,SACR,SAAY,KACZ,SAAY,IACZ,cAAiB,EACnB,CACF,CACF,EACA,CACE,KAAQ,eACR,aAAgB,CACd,gBACF,EACA,SAAY,CACV,kBACA,kBACF,EACA,MAAS,YACT,KAAQ,WACR,MAAS,UACT,MAAS,CACP,KACA,SACF,EACA,YAAe,wPACf,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,SACR,UAAa,EACb,QAAW,KACX,YAAe,wDACjB,EACA,CACE,KAAQ,kBACR,KAAQ,QACV,EACA,CACE,KAAQ,QACR,KAAQ,QACV,EACA,CACE,KAAQ,SACR,KAAQ,QACV,EACA,CACE,KAAQ,SACR,KAAQ,QACV,EACA,CACE,KAAQ,SACR,KAAQ,QACV,EACA,CACE,KAAQ,UACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,aACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,aACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,YACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,YACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,QACR,KAAQ,MACR,SAAY,EACZ,SAAY,IACZ,cAAiB,EACnB,EACA,CACE,KAAQ,aACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,WACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,YACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,YACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,YACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,kBACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,iBACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,aACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,EACnB,EACA,CACE,KAAQ,QACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,GACjB,YAAe,kDACjB,CACF,CACF,EACA,CACE,KAAQ,kBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,UACR,KAAQ,MACR,SAAY,EACZ,SAAY,IACZ,QAAW,IACX,cAAiB,EACnB,EACA,CACE,KAAQ,YACR,KAAQ,OACR,SAAY,QACZ,UAAa,eACb,QAAW,EACb,CACF,CACF,EACA,CACE,KAAQ,gBACR,SAAY,GACZ,OAAU,CACR,CACE,KAAQ,cACR,KAAQ,QACV,EACA,CACE,KAAQ,mBACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,cAAiB,GACjB,QAAW,EACb,EACA,CACE,KAAQ,QACR,KAAQ,SACR,SAAY,EACZ,cAAiB,EACnB,CACF,CACF,EACA,CACE,KAAQ,YACR,aAAgB,CACd,gBACF,EACA,SAAY,CACV,cACA,kBACA,eACA,mBACA,qBACA,kBACA,eACF,EACA,MAAS,QACT,KAAQ,WACR,MAAS,OACT,MAAS,CACP,KACA,UACA,MACF,EACA,uBAA0B,GAC1B,YAAe,4SACf,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,WACR,KAAQ,SACR,UAAa,GACb,UAAa,KACf,EACA,CACE,KAAQ,WACR,KAAQ,MACR,UAAa,MACf,EACA,CACE,KAAQ,UACR,UAAa,YACb,KAAQ,QACR,QAAW,EACb,EACA,CACE,KAAQ,QACR,KAAQ,QACR,UAAa,aACb,QAAW,EACb,EACA,CACE,KAAQ,kBACR,KAAQ,QACR,UAAa,aACb,QAAW,EACb,EACA,CACE,KAAQ,cACR,KAAQ,QACR,UAAa,aACb,QAAW,EACb,EACA,CACE,KAAQ,MACR,KAAQ,KACV,EACA,CACE,KAAQ,QACR,KAAQ,SACV,EACA,CACE,KAAQ,YACR,KAAQ,OACR,SAAY,SACZ,UAAa,KACf,EACA,CACE,KAAQ,QACR,KAAQ,OACR,SAAY,QACZ,UAAa,aACb,iBAAoB,aACpB,QAAW,GACX,UAAa,KACf,EACA,CACE,KAAQ,WACR,KAAQ,OACR,SAAY,QACZ,UAAa,aACb,iBAAoB,gBACpB,QAAW,GACX,UAAa,MACf,EACA,CACE,KAAQ,aACR,KAAQ,QACR,UAAa,sBACb,QAAW,GACX,UAAa,MACf,CACF,CACF,EACA,CACE,KAAQ,gBACR,aAAgB,CACd,gBACF,EACA,SAAY,CACV,WACF,EACA,MAAS,YACT,KAAQ,UACR,MAAS,WACT,uBAA0B,GAC1B,YAAe,yDACf,OAAU,CACR,CACE,KAAQ,SACR,KAAQ,SACR,UAAa,EACb,YAAe,sBACjB,EACA,CACE,KAAQ,SACR,KAAQ,SACR,UAAa,EACf,EACA,CACE,KAAQ,aACR,KAAQ,SACR,UAAa,GACb,YAAe,oBACjB,EACA,CACE,KAAQ,OACR,KAAQ,OACR,SAAY,QACd,EACA,CACE,KAAQ,QACR,UAAa,iDACb,KAAQ,OACR,UAAa,GACb,QAAW,MACb,EACA,CACE,KAAQ,WACR,KAAQ,OACR,SAAY,SACZ,MAAS,CACP,OACA,OACA,OACA,OACA,QACA,QACA,SACA,OACA,MACA,QACA,QACA,MACA,OACA,QACA,OACA,SACA,MACA,UACA,OACA,QACA,WACA,QACA,SACA,YACA,OACA,QACA,OACA,OACA,MACA,MACA,MACA,QACA,QACA,KACF,CACF,CACF,CACF,EACA,CACE,KAAQ,eACR,aAAgB,CACd,gBACF,EACA,SAAY,CACV,cACA,kBACA,uBACA,kBACF,EACA,MAAS,UACT,KAAQ,SACR,MAAS,UACT,MAAS,CACP,KACA,UACA,MACF,EACA,uBAA0B,GAC1B,YAAe,gOACf,OAAU,CACR,CACE,KAAQ,OACR,KAAQ,SACR,YAAe,oFACjB,EACA,CACE,KAAQ,WACR,KAAQ,SACR,UAAa,GACb,UAAa,KACf,EACA,CACE,KAAQ,SACR,KAAQ,SACR,UAAa,EACb,YAAe,sBACjB,EACA,CACE,KAAQ,WACR,KAAQ,QACR,UAAa,kBACb,QAAW,GACX,gBAAmB,EACrB,EACA,CACE,KAAQ,eACR,KAAQ,SACR,UAAa,GACf,EACA,CACE,K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AQ,cACR,KAAQ,MACR,SAAY,GACZ,YAAe,+FACf,UAAa,MACf,EACA,CACE,KAAQ,oBACR,KAAQ,SACR,SAAY,EACZ,SAAY,EACZ,YAAe,iHACf,cAAiB,GACjB,UAAa,MACf,EACA,CACE,KAAQ,qBACR,KAAQ,OACR,SAAY,SACZ,MAAS,CACP,mBACA,oBACA,kBACA,UACA,QACA,iBACA,kBACA,eACA,SACA,WACA,aACA,eACA,UACA,WACA,OACA,QACA,eACF,EACA,UAAa,MACf,EACA,CACE,KAAQ,qBACR,KAAQ,OACR,SAAY,SACZ,MAAS,CACP,mBACA,oBACA,kBACA,UACA,QACA,iBACA,kBACA,eACA,SACA,WACA,aACA,eACA,UACA,WACA,OACA,QACA,eACF,EACA,UAAa,MACf,EACA,CACE,KAAQ,sBACR,KAAQ,OACR,SAAY,SACZ,MAAS,CACP,OACA,gBACA,cACA,YACA,UACF,EACA,UAAa,MACf,EACA,CACE,KAAQ,sBACR,KAAQ,OACR,SAAY,SACZ,MAAS,CACP,OACA,gBACA,cACA,YACA,UACF,EACA,UAAa,MACf,EACA,CACE,KAAQ,iBACR,KAAQ,OACR,SAAY,SACZ,MAAS,CACP,SACA,QACF,EACA,UAAa,KACf,EACA,CACE,KAAQ,iBACR,KAAQ,OACR,SAAY,SACZ,MAAS,CACP,SACA,QACF,EACA,UAAa,KACf,EACA,CACE,KAAQ,oBACR,KAAQ,OACR,SAAY,SACZ,MAAS,CACP,QACA,QACA,SACA,OACA,QACA,OACA,OACA,UACA,YACA,SACA,QACA,QACA,MACA,SACF,EACA,UAAa,IACf,EACA,CACE,KAAQ,oBACR,KAAQ,OACR,SAAY,SACZ,MAAS,CACP,QACA,QACA,SACA,OACA,QACA,OACA,OACA,UACA,YACA,SACA,QACA,QACA,MACA,SACF,EACA,UAAa,IACf,EACA,CACE,KAAQ,iBACR,KAAQ,OACR,SAAY,SACZ,UAAa,IACf,EACA,CACE,KAAQ,iBACR,KAAQ,OACR,SAAY,QACZ,UAAa,aACb,QAAW,GACX,UAAa,IACf,CACF,CACF,EACA,CACE,KAAQ,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",
  "names": ["cache", "principal", "sCurrentOrganization", "sBase", "sCache", "sResource", "sModelSvc", "sPrincipal", "sSearch", "sPathSvc", "sMake", "sList", "sStreamSvc", "sAuthZ", "sComm", "sCred", "sPol", "sCtl", "sReq", "sToken", "sAppr", "sScr", "sTagSvc", "sOlio", "getPrincipal", "o", "u", "p", "v2", "fH", "vParms", "b", "oU2", "sType", "vDef", "a", "s", "i", "sText", "sKey", "sIv", "enc", "f", "aH", "getCache", "cleanup", "get", "clearCache", "vType", "bLocalOnly", "oObj", "removeFromCache", "sObjId", "getFromCache", "sAct", "addToCache", "sId", "vObj", "newPrimaryCredential", "oAuthN", "post", "deleteObject", "del", "patchObject", "patch", "create", "updateBulk", "aObj", "evaluate", "executeScript", "urn", "executeScriptById", "sObjectId", "define", "searchCount", "q", "search", "compLabel", "newQuery", "m", "v", "z", "c", "name", "value", "fld", "afs", "r", "bCount", "type", "fc", "trace", "bEnable", "member", "sObjectType", "sField", "sActorType", "sActorId", "getApplicationProfile", "getImageTags", "applyImageTags", "getByObjectId", "getFullByObjectId", "getByUrn", "getByName", "sName", "bParent", "getByNameInGroupParent", "stream", "l", "count", "list", "sFields", "iStart", "iLength", "sK", "findTags", "findBy", "oSearch", "findByTag", "aTags", "t", "countByTag", "findByAnyTag", "countByAnyTag", "find", "sObjType", "sPath", "makeFind", "make", "bMake", "getDotPath", "path", "sAlt", "logout", "loginWithPassword", "sOrg", "cred", "login", "url", "x", "data", "getObjectAuthorization", "listSystemPermissions", "listSystemRoles", "listSystemPolicies", "permitSystem", "bView", "bEdit", "bDelete", "bCreate", "permit", "sPermId", "listMembers", "iCount", "countMembers", "membershipStats", "sParticipantType", "iContainerId", "iLimit", "sPart", "iCont", "iLim", "personalityProfile", "profileComparison", "sObjectId1", "sObjectId2", "applyPatches", "obj", "patches", "pathParts", "target", "part", "finalProp", "refreshNested", "full", "nestedId", "fresh", "parent", "syncObject", "cached", "update", "deep", "key", "syncFromResponse", "syncData", "pathMapping", "responseKey", "targetPath", "finalKey", "SYNC_MAPPINGS", "getUserPersonObject", "res", "rej", "getUserObject", "sOType", "listUserRoles", "listEntitlementsForType", "mediaDataPath", "bThumb", "getIsRequestable", "getOwnerApprovalPolicy", "attachPolicy", "sPid", "n", "d", "Base64", "input", "output", "chr1", "chr2", "chr3", "enc1", "enc2", "enc3", "enc4", "string", "utftext", "am7model", "cat", "proto", "aP", "k", "catO", "model", "an", "om", "ftype", "field", "am", "sLType", "ignoreEmptyNull", "innerCall", "nfv", "emptyArray", "nullOrUndef", "ft", "sDP", "fieldDefVal", "defVal", "h", "mk", "e", "baseModel", "recurse", "ue", "af", "e2", "vrcache", "ru", "oru", "vr", "isStr", "nvr", "vri", "rules", "applyReplacement", "ir", "tir", "re", "err", "ri", "entity", "dateTimeDecorator", "dateTimeZDecorator", "numberDecorator", "rangeDecorator", "textListDecorator", "colorDecorator", "blobDecorator", "dec", "array", "r1", "form", "inst", "index", "arr", "report", "decorateInOut", "bIn", "df", "mf", "val", "pn", "op", "fv", "fh", "pent", "b1id", "color", "rgb", "hsl", "g", "ndf1", "cl", "min", "max", "delta", "text", "options", "warnings", "warning", "attr", "prop", "node", "aa", "sStart", "sEnd", "sA", "sC", "sS", "id", "ctx", "tags", "grp", "opath", "cnt", "set", "fav", "itype", "qr", "tag", "origin", "temp", "pg", "up", "listPathBase", "dir", "wsUrl", "event", "sTok", "iIter", "iter", "org", "tok", "msg", "c1", "eventType", "eventData", "message", "recipient", "schema", "recipientId", "dat", "newCredential", "currentCredential", "authReq", "startRecord", "recordCount", "sr", "rc", "modType", "handler", "bUp", "fConfirm", "fCancel", "images", "charInst", "galleryImages", "characterInstance", "gallery", "existingIds", "img", "profile", "portrait", "profileObjectId", "pq", "pqr", "objj", "a1", "a2", "port", "nt", "timeout", "items", "cfg", "closeBtn", "objectId", "viewPath", "sClass", "sIco", "sLabel", "fHandler", "params", "pages", "stem", "openItems", "object", "subType", "child", "newParent", "modType2", "parObj", "group", "start", "length", "g2", "og", "query", "mode", "alt", "self", "obj2", "keyMatch", "prev", "idx", "dataURI", "mime", "binary", "groupId", "dialogUp", "dialogCfg", "chatInto", "ref", "aCCfg", "sessName", "pa", "loadPromptList", "ca", "loadChatList", "cname", "remoteEnt", "wset", "aCPs", "aC", "sq", "sess", "q2", "w", "endDialog", "setDialog", "showProgress", "updateSessionName", "acfg", "pcfg", "bRename", "chat", "prompt", "ycfg", "vcfg", "occfg", "opcfg", "sysName", "usrName", "chatSettings", "cinst", "summarize", "creq", "vectorize", "lastReimage", "loadSDConfig", "saveSDConfig", "config", "applySDConfig", "socialSharingMap", "socialSharingTags", "getOrCreateSharingTag", "tagName", "objectType", "newTag", "applySharingTag", "image", "wearLevelName", "sharingContext", "toggleSharingTag", "enable", "chatImageTags", "tagToWearLevel", "resolvedImageCache", "parseImageTokens", "content", "tokens", "regex", "match", "inner", "parts", "tagStr", "getImageThumbnailUrl", "size", "findImageForTags", "character", "charName", "nameTag", "charImages", "candidateIds", "tagMembers", "memberIds", "cid", "ids", "picked", "debugReimage", "generateImageForTags", "targetLevel", "lvl", "levelOrder", "charType", "charRecord", "originalPortraitId", "profileId", "originalWearStates", "sto", "activeAp", "app", "wears", "targetIdx", "shouldWear", "charConfigName", "charConfig", "resolve", "reject", "sharingTag", "stag", "od", "restorePatches", "resolveImageToken", "token", "members", "mi", "getCurrentWearLevel", "storeRef", "maxLevel", "maxLevelName", "we", "levelIndex", "reimage", "isCharPerson", "tempApplyDefaults", "cseed", "baseSeed", "wearLevel", "useSeed", "imgEntity", "imageNameTag", "selfieTag", "seed", "saveEntity", "savedCfg", "orgPath", "src", "selected", "appl", "lvls", "aL", "bL", "dressedDown", "lowestLevel", "nudeIdx", "includeNude", "totalImages", "sharedConfig", "ncfg", "reimageApparel", "hires", "loadDialog", "createDialog", "entityType", "title", "fConf", "fCanc", "sizeCls", "mconf", "confirm", "sMessage", "cancelDialog", "batchProgress", "label", "processItem", "onComplete", "state", "startBatch", "stopBatch", "pct", "memberCloud", "modelType", "containerId", "stats", "cloudMode", "selectedStat", "memberList", "previewSrc", "searchFilter", "minCount", "maxCount", "getFilteredStats", "lowerFilter", "fontSize", "selectStat", "stat", "mems", "backToCloud", "cloudColor", "ratio", "hue", "sat", "lit", "cloudTextColor", "filteredStats", "bg", "fg", "mem", "memType", "memName", "thumb", "imgSrc", "pp", "showOutfitBuilder", "characterId", "gender", "currentApparel", "modelName", "builderApparel", "apparel", "startGameWithCharacter", "characterName", "groupPath", "adoptCharacter", "result", "dialog", "dnd", "blended", "blender", "filt", "b2", "actor", "cls", "ret", "dragGroup", "dragParent", "dragModType", "overParent", "dropGroup", "totalUpCount", "currentUpCount", "maxUpload", "files", "pb", "fileReader", "clearFlds", "uri", "formData", "fname", "xhr", "res2", "rej2", "aD", "oG", "oD", "handleDragLeave", "evt", "handleDragEnter", "handleDragOver", "handleDrop", "viewers", "pdfViewer", "inInst", "eventBus", "currentPage", "pageCount", "scale", "raster", "pdfDocument", "didInit", "pdfControls", "fp", "render", "zoom", "lp", "np", "pdfContainer", "loadPdf", "bits", "init", "pdfPageNum", "pdfScale", "container", "doc", "pdfPage", "viewport", "pdfPageView", "pdf", "dressUp", "dressCharacter", "dressApparel", "dressDown", "setApparelDescription", "wdesc", "describeWearable", "wear", "qual", "opac", "shin", "smoo", "col", "fab", "pat", "loc", "opacs", "shins", "vapp", "aq", "aqr", "oids", "minLevel", "availMin", "ulevel", "maxLevelIdx", "newLevel", "setNarDescription", "nar", "pro", "TECH_TIERS", "CLIMATE_TYPES", "OUTFIT_PRESETS", "BODY_LOCATIONS", "outfitBuilderState", "WEAR_LEVELS", "generateOutfit", "techTier", "climate", "style", "body", "resp", "generateMannequinImages", "apparelId", "buildFromPieces", "pieces", "primaryColor", "pattern", "getMannequinBaseUrl", "MannequinViewer", "vnode", "levelImage", "baseUrl", "overlayUrl", "level", "isSelected", "hasImage", "am7olio", "tier", "preset", "imgUrl", "wearables", "byLocation", "slot", "forms", "dataM", "ctf", "tagM", "tagf", "cleanupTestVoice", "testVoice", "refId", "vprops", "sinst", "sdr", "sd", "aud", "apath", "amt", "pickProfile", "pe", "gp", "tp", "objectPage", "useName", "pickVoice", "narrate", "age", "race", "profUrl", "nms", "char", "createCharacter", "cdir", "charN", "datName", "getProfUrl", "reader", "characterWizard", "rollCharacter", "getSystemPrompt", "prc", "prcr", "voice", "models", "rf", "getDefaultValuesForField", "jsName", "getFormatForType", "format", "getActionView", "getValidationErrorLabel", "txt", "getFieldView", "ff", "annot", "getField", "props", "fprops", "useType", "ofld", "iprops", "vf", "el", "el2", "icon", "basePath", "getBasePathByType", "worldView", "getTypeByPath", "subPath", "outT", "getPathForType", "viewQuery", "getViewFields", "oidf", "idf", "idv", "getFormFieldNames", "getFormField", "fo", "typeToModel", "ot", "showField", "show", "rctx", "showCount", "invert", "reqVal", "mat", "reqVals", "showTotal", "isBinary", "mt", "contentType", "am7view", "formatName", "renderFunction", "originalGetField", "originalFieldView", "attrs", "rendererType", "formName", "getFileTypeIcon", "mtIco", "ext", "getThumbnail", "ctl", "ico", "gridMode", "icoPath", "icoCls", "sty", "getIcon", "getFavoriteStyle", "isFavcls", "getPolarListItem", "dcls", "pagination", "supplData", "dndProp", "getPolarListView", "rset", "results", "defaultHeaderMap", "getHeaders", "map", "getHeadersView", "mod", "headers", "lbl", "selectHandler", "cw", "getCellStyle", "sortButton", "sico", "getTabularRow", "allTags", "maxVisible", "visibleTags", "remainingCount", "tagElements", "getFormattedValue", "ah", "lastFld", "um", "getTabularView", "table", "getGridListItem", "showInfo", "footer", "gridCellCls", "displayIndicators", "displayObjects", "pr", "getGridListView", "getCarouselItem", "uimarkers", "getCarouselView", "am7dec", "deleteChat", "force", "chatHandler", "getChatRequest", "requestName", "chatCfg", "promptCfg", "req", "chatReq", "makeChat", "sModel", "sServerUrl", "sServiceType", "icfg", "makePrompt", "aSystem", "am7chat", "CARD_TYPES", "TEMPLATE_TYPES", "ITEM_SUBTYPE_ICONS", "CARD_RENDER_CONFIG", "GAME_PHASES", "STATUS_EFFECTS", "COMBAT_OUTCOMES", "CARD_TEMPLATES", "THEME_DEFAULTS", "DEFAULT_THEME", "LEVEL_UP_STATS", "STAT_DESCRIPTIONS", "DECK_BASE_PATH", "encodeJson", "decodeJson", "encoded", "upsertDataRecord", "fileName", "existing", "loadDataRecord", "createGroup", "listDataRecords", "deckStorage", "deckName", "saved", "serializeGameState", "deserializeGameState", "saveData", "gameStorage", "saves", "latest", "keepCount", "createCampaignData", "characterCard", "campaignStorage", "campaignData", "calculateXP", "isVictory", "xp", "saveCampaignProgress", "xpGain", "campaign", "applyCampaignBonuses", "gain", "end", "mag", "C", "rarityStars", "rarity", "_", "NeedBar", "current", "abbrev", "StatBlock", "order", "row", "cornerIcon", "position", "cardTypeIcon", "iconDetail", "extraClass", "D20Dice", "rolling", "winner", "displayVal", "R", "renderCharacterBody", "card", "noPreview", "renderCharacterBackBody", "bgImage", "needs", "equip", "skills", "backStyle", "renderCardBody", "imageUrl", "placeholderColor", "imageArea", "details", "hf", "statElements", "footerItems", "isReusable", "renderCompactStats", "isCardIncomplete", "CardFace", "compact", "incomplete", "renderType", "renderOpts", "bodyFn", "cardStyle", "sizeClass", "cardClass", "compactBody", "CardBack", "previewImageUrl", "showImagePreview", "closeImagePreview", "ImagePreviewOverlay", "previewCard", "previewFlipped", "showCardPreview", "closeCardPreview", "CardPreviewOverlay", "viewingDeck", "cardFrontBg", "cardBackBg", "backContent", "artUrl", "galleryPickerCard", "galleryLoading", "openGalleryPicker", "fetchCharPerson", "closeGalleryPicker", "GalleryPickerOverlay", "fullSrc", "safeName", "availableCharacters", "charsLoading", "selectedChars", "characterTemplates", "generatingCharacters", "getActiveTheme", "getDeckNameInput", "statVal", "fallback", "mapStats", "statistics", "resolveStatistics", "charObj", "sqr", "clampStat", "str", "getPortraitUrl", "getCharId", "refreshCharacterCard", "assembleCharacterCard", "assembleCharEquipment", "activeTheme", "cn", "apparelCards", "ap", "slots", "mw", "rw", "weaponCard", "ss", "as", "ds", "skillCards", "hm", "im", "magicCards", "shuffle", "j", "assembleStarterDeck", "chars", "theme", "allCards", "charNames", "bodyAp", "feetAp", "curTheme", "themeConsumables", "consumables", "actionCards", "talkCard", "themeName", "loadAvailableCharacters", "allChars", "seenIds", "deckNameInput", "deckCharDir", "ch", "de", "loadCharacterTemplates", "generateCharactersFromTemplates", "themeId", "templates", "shuffled", "selectedTemplates", "characters", "template", "rolled", "themeClass", "persistGeneratedCharacters", "charDir", "persisted", "charPersonToCard", "charPerson", "refreshAllCharacters", "deck", "charCards", "refreshed", "themeLoading", "colorCache", "applyingOutfits", "loadThemeConfig", "td", "lookupColor", "colorName", "qf", "applyThemeOutfits", "skipSave", "thm", "categories", "processed", "apparelDir", "wearableDir", "genderOutfits", "outfitDef", "storeObjId", "existingApparel", "wPatches", "storeItemList", "itemRef", "storeInvList", "invRef", "createdApparel", "createdWearables", "wDef", "colorRef", "wearable", "created", "inusePatches", "THEME_STORAGE_PATH", "themeStorage", "themeData", "themeEditorState", "loadThemeList", "builtins", "custom", "editTheme", "isBuiltin", "createNewTheme", "ThemeEditorUI", "cardCount", "parsed", "act", "ok", "ART_BASE_PATH", "getViewingDeck", "getDeckStorage", "getGameState", "styleLabel", "ACTION_PROMPTS", "TALK_PROMPTS", "buildCardPrompt", "customSuffix", "suffix", "baseName", "typeName", "scene", "artQueue", "artProcessing", "artCompleted", "artTotal", "artPaused", "artDir", "backgroundImageId", "backgroundThumbUrl", "backgroundPrompt", "backgroundGenerating", "tabletopImageId", "tabletopThumbUrl", "tabletopGenerating", "flippedCards", "cardFrontImageUrl", "cardBackImageUrl", "cardFrontGenerating", "cardBackGenerating", "sequenceCardId", "sequenceProgress", "newSdOverride", "defaultSdOverrides", "sdOverrides", "sdConfigExpanded", "sdConfigTab", "gameConfigExpanded", "voiceProfiles", "voiceProfilesLoaded", "loadVoiceProfiles", "getDeckGameConfig", "getCardTypeDelta", "ov", "def", "hasChanges", "sdOverrideInsts", "sdOverrideViews", "getSdOverrideInst", "resetSdOverrideInsts", "currentDeckSafeName", "ensureArtDir", "subdir", "generateBackground", "am7sd", "bgOv", "bgPrompt", "generateTabletop", "ttOv", "ttPrompt", "buildSdEntity", "artCfg", "typeOv", "defOv", "setting", "generateCardArt", "sdEntity", "thumbUrl", "rname", "generateTemplateArt", "side", "configKey", "processArtQueue", "gameState", "next", "deckCard", "dupeIdx", "dupeCard", "propagateArtToGameState", "cardName", "cardType", "isPortrait", "updated", "updateCard", "pos", "cardSignature", "queueDeckArt", "needFront", "needBack", "needBg", "needTabletop", "preGenCount", "uniqueCards", "sig", "job", "dupeCount", "sum", "saveArtProgress", "pauseArtQueue", "resumeArtQueue", "cancelArtQueue", "generateImageSequence", "activeApparel", "fullApparel", "sdBase", "seedAttr", "lastImage", "ArtQueueProgress", "pending", "processing", "failed", "done", "queueActive", "envActive", "seqActive", "anyActive", "totalDone", "currentMsg", "statusText", "applyStatusEffect", "effectId", "sourceName", "effectDef", "removeStatusEffect", "removed", "hasStatusEffect", "getStatusModifiers", "mods", "effect", "processStatusEffectsTurnStart", "messages", "tickStatusEffects", "onActorHit", "parseEffect", "effectStr", "damageMatch", "drainMatch", "healMatch", "energyMatch", "moraleMatch", "drawMatch", "statuses", "applyParsedEffects", "owner", "log", "dmgResult", "before", "se", "isEffectParseable", "SKILL_ACTION_KEYWORDS", "getStackSkillMod", "stack", "actionType", "total", "keywords", "modLower", "kw", "E", "DiceUtils", "sides", "statName", "raw", "breakdown", "modifier", "rollD20", "rollInitiative", "getActorATK", "isDualWielding", "getWeaponATKs", "getActorDEF", "rollAttack", "attacker", "strMod", "atkBonus", "skillMod", "statusMods", "statusAtkMod", "rollDefense", "defender", "endMod", "defBonus", "parryBonus", "statusDefMod", "getCombatOutcome", "attackRoll", "defenseRoll", "diff", "attackNat", "defenseNat", "calculateDamage", "outcome", "weaponAtk", "baseDamage", "finalDamage", "applyDamage", "damage", "reduced", "resolveCombat", "attackerActor", "defenderActor", "dualWield", "weapons", "damageResult", "selfDamageResult", "secondAttack", "secondRoll", "secondOutcome", "secondDamage", "criticalEffects", "rewardCard", "droppableItems", "droppedItem", "gs", "checkGameOver", "balanceData", "loadBalanceData", "THREAT_CREATURES", "getThreatCreatures", "SCENARIO_CARDS", "getScenarioCards", "generateCriticalReward", "rarityOrder", "drawPile", "typeMatch", "candidates", "reward", "bonus", "createThreatEncounter", "difficulty", "creatures", "creatureIdx", "base", "scaleFactor", "threat", "checkNat1Threats", "threats", "insertBeginningThreats", "drawScenarioCard", "cards", "totalWeight", "roll", "cumulative", "checkEndThreat", "scenario", "anteCard", "actorName", "claimPot", "winnerActor", "addToPot", "reason", "checkLethargy", "typesPlayed", "actionCounts", "played", "stripped", "checkExhausted", "failedActionType", "handCount", "drawCardsForActor", "ensureOffensiveCard", "attackIdx", "attackCard", "basicAttack", "isCoreCardType", "isModifierCardType", "placeCard", "positionIndex", "forceModifier", "currentPlayer", "isModifier", "hasExistingCore", "actionKey", "removeCardFromPosition", "skipRedraw", "dealInitialStack", "itemCards", "armors", "shuffledApparel", "Ch", "AI", "Th", "St", "llmStatus", "checkLlmConnectivity", "response", "gameCharSelection", "initAnimState", "resetInitAnimState", "startInitiativeAnimation", "countdownInterval", "runInitiativePhase", "createGameState", "selectedCharacter", "allCharacters", "playerCharCard", "otherChars", "opponentCharCard", "playerStats", "rawPlayerEnd", "playerEnd", "playerAp", "rawPlayerMag", "playerMag", "opponentStats", "rawOppEnd", "opponentEnd", "opponentAp", "rawOppMag", "opponentMag", "talkCards", "encounterCards", "itemMid", "apparelMid", "playerItems", "opponentItems", "playerApparel", "opponentApparel", "playableCards", "shuffledPool", "midPoint", "playerDrawPile", "opponentDrawPile", "initialHandSize", "playerHand", "opponentHand", "gameDirector", "gameNarrator", "gameChatManager", "gameVoice", "gameAnnouncerVoice", "initializeLLMComponents", "opponentChar", "gc", "narrationEnabled", "opponentVoiceEnabled", "opponentVoiceProfileId", "announcerEnabled", "announcerProfile", "announcerVoiceEnabled", "announcerVoiceProfileId", "CardGameDirector", "CardGameNarrator", "CardGameChatManager", "CardGameVoice", "narrateGameStart", "buildEmotionContext", "emotion", "triggerNarration", "trigger", "extraContext", "playerName", "opponentName", "baseContext", "context", "fallbackText", "tension", "roundWinner", "winName", "attackerName", "defenderName", "emotionCtx", "narrationText", "narration", "finalText", "showNarrationSubtitle", "narrateGameEnd", "narrateRoundStart", "narrateRoundEnd", "pTotal", "oTotal", "totalPositions", "winnerAp", "loserAp", "winnerPositions", "loserPositions", "wCount", "lCount", "beginningThreats", "advancePhase", "enterThreatResponsePhase", "enterDrawPlacementPhase", "resolveThreatCombat", "advanceResolution", "enterEndThreatPhase", "startNextRound", "resolveEndThreatCombat", "aiPlaceCards", "responders", "responder", "defenseStack", "targetActor", "threatAttacker", "defenderStack", "lootCard", "responderActor", "placeThreatDefenseCard", "apCost", "handIndex", "skipThreatResponse", "playerEffects", "opponentEffects", "targetHandSize", "playerDraw", "opponentDraw", "activeCampaign", "levelUpState", "resolutionAnimating", "resolutionPhase", "resolutionDiceFaces", "resolutionDiceInterval", "currentCombatResult", "openTalkChat", "bar", "isThreat", "ownerKey", "ownerActor", "ownerName", "exhaustedResult", "targetName", "coreCard", "hpBefore", "energyBefore", "moraleBefore", "ownerAgi", "fleeRoll", "fleeDC", "other", "ownerInt", "investRoll", "offeredItems", "aiItems", "giveItem", "item", "materials", "craftRoll", "craftDC", "craftedItem", "lostMat", "ownerCha", "targetCha", "ownerRoll", "targetRoll", "moraleDmg", "ownerStats", "fizzled", "required", "actual", "CardGameLLM", "chatDir", "templateCfg", "systemPrompt", "temperature", "lastMsg", "cleaned", "chatName", "promptName", "getConstants", "directorPrompts", "loadDirectorPrompts", "alignment", "personality", "directive", "retryResponse", "retryContent", "retryDirective", "opp", "player", "positions", "coreCards", "stacks", "cardsUsed", "posIdx", "playable", "applyAIDecision", "decision", "modifiers", "checkPlacementComplete", "modifierCards", "skill", "remainingCores", "playableCores", "emptyPositions", "playerDone", "opponentDone", "getDirector", "setDirector", "narratorPrompts", "loadNarratorPrompts", "_CardGameNarrator", "profileConfig", "maxSentences", "lines", "imagePrompt", "line", "__publicField", "getNarrator", "setNarrator", "chatPrompts", "loadChatPrompts", "npcCharacter", "traits", "tone", "desc", "playerMessage", "contextMessages", "npcReply", "interaction", "msgCount", "history", "getChatManager", "setChatManager", "cm", "voiceConfig", "audioComponent", "source", "sourceNode", "gainNode", "getPlayerEmotion", "getPlayerMoodColor", "getVoice", "setVoice", "savedDecks", "decksLoading", "storage", "themes", "loadSavedDecks", "names", "decks", "savesList", "screen", "buildingDeck", "saveDeck", "unpersisted", "viewDeck", "deleteDeck", "storageName", "playDeck", "resumeGame", "DeckList", "cardBackUrl", "editingCard", "editingCardIndex", "addCardTypeOpen", "startAddCard", "templateKey", "startEditCard", "saveEditingCard", "builtDeck", "cancelEditingCard", "deleteCard", "cardField", "opts", "CardEditorFields", "sub", "fields", "BuilderThemeStep", "themeOption", "BuilderCharacterStep", "charsState", "generated", "charPickerCard", "tempDeckName", "chId", "BuilderReviewStep", "charCard", "isCharacter", "DeckView", "copy", "uniqueMap", "busy", "insts", "active", "views", "allKeys", "overrides", "vProfiles", "vLoaded", "voiceProfilePicker", "valueKey", "vp", "artJob", "isGenerating", "hasArt", "isChar", "isFlipped", "cardFront", "cardBack", "cardContent", "isThisCard", "seqProgress", "NS", "InitiativePhaseUI", "playerFlipped", "opponentFlipped", "anim", "opponent", "showFlipped", "renderInitCard", "who", "isWinner", "diceFace", "flipped", "isLoser", "EquipPhaseUI", "equipped", "EquipSlot", "ResolutionPhaseUI", "currentPos", "isAttack", "isRolling", "showResult", "combat", "actionLabel", "actionVerb", "CleanupPhaseUI", "playerPts", "oppPts", "Storage", "winnerText", "threatAutoRespondScheduled", "ThreatResponseUI", "tr", "isEndThreat", "isPlayerResponder", "apRemaining", "aiActor", "defenseCards", "GP", "TalkChatUI", "inputRef", "sendMessage", "npcName", "fallbackResponses", "randomResponse", "msgArea", "endChat", "playerMsgs", "npcPortrait", "GameOverUI", "narratedEnd", "campaignSaved", "LevelUpUI", "rounds", "playerChar", "statsSelected", "remaining", "currentVal", "gained", "selectedCount", "handTrayFilter", "stackFlipped", "rendering", "formatPhase", "phase", "calcCharScore", "CharacterSelectUI", "bestChar", "worstChar", "bestScore", "worstScore", "score", "tabletopBg", "containerStyle", "isBest", "isWorst", "GameView", "isPlacement", "isPlayerTurn", "endTurn", "CharacterSidebar", "ActionBar", "HandTray", "FannedCardStack", "stackId", "maxShow", "cardList", "flipKey", "fanAngle", "fanOffset", "isOpponent", "hpPct", "energyPct", "isResolution", "isActive", "isResolved", "isPlayerPos", "isThreatPos", "playerOutOfAP", "canDrop", "isLocked", "cardData", "hand", "filteredHand", "isThreatPhase", "isResponder", "hasAP", "canPlaceDefense", "S", "Eng", "Themes", "GS", "TEST_CATEGORIES", "testDeck", "testDeckName", "testState", "setTestDeck", "clearTestDeck", "testLog", "category", "status", "entry", "runTestSuite", "cats", "engine", "ai", "resolvedDeck", "resolvedDeckName", "deckNames", "testData", "decoded", "testText", "savedGs", "tempGs", "savedNarrator", "rolls", "minRoll", "maxRoll", "testActor", "totalAtk", "totalDef", "testStack", "atkMod", "defMod", "testEffects", "parseableEffects", "unparseableEffects", "skillTests", "pool", "types", "sk", "hasNumericMod", "mg", "parseable", "con", "testChar", "cd", "testState1", "xpWin", "xpLose", "levels", "testGsState", "testCampaign", "charTestDecks", "deckNames2", "dn", "hasCore", "outOfRange", "statsBefore", "statsAfter", "expectedAp", "hasAttack", "testOwner", "testTarget", "dmgParsed", "healParsed", "hasStun", "hasShield", "beforeCure", "afterCure", "keptShield", "comboOk", "lifecycleActor", "modActor", "saveDeckName", "origHandLen", "origRound", "origOppHp", "origPhase", "loaded", "ls", "checks", "allOk", "pair", "testLlm", "initOk", "testNarrator", "narratorOk", "resNarration", "hasAudio", "testVoice1", "testVoice2", "savedDirector", "savedChatMgr", "savedVoice", "savedAnnVoice", "testGs", "disabledDeck", "enabledDeck", "mixedDeck", "deckGc", "maxRounds", "pRoll", "oRoll", "initWinner", "pAtk", "oDef", "dmg", "oAtk", "pDef", "loadedSave", "roundtrip", "TestModeUI", "statusColors", "statusIcons", "lastCat", "catLabel", "proxyState", "moduleFn", "defs", "toggleFullMode", "cardGame", "isGameScreen", "advgrid", "infoLabel", "infoStatus", "builderMode", "modeClear", "modeRoom", "modeCorridor", "changed", "modeSpawn", "groups", "communityData", "newGameData", "updateChanged", "toggleBuilder", "toggleModeClear", "toggleModeRoom", "toggleModeCorridor", "toggleSpawn", "buildCell", "y", "cell", "constructRegion", "getGroups", "generateMap", "generateRooms", "placeRoom", "findSpaceLocation", "randomVal", "iters", "maxiters", "collision", "placedRooms", "rh", "newMapCell", "statusCallback", "initLocation", "outB", "restoreMap", "initEvent", "ct", "cellType", "configureEvent", "pev", "pevC", "lastE", "randE", "oE", "cloc", "clocd", "initLoc", "getCell", "initEvt", "randomPerson", "pR", "randomPersons", "per", "newPlayerPerson", "initPopulation", "clone", "solicitInfo", "chooseInfo", "confirmInfo", "refreshInfo", "createNewGrid", "outCell", "dgrid", "refreshGrid", "gridView", "gridStyle", "colorPrep", "defCubeColor", "cubeClsC", "cubeStyleS", "cellTypeColor", "getCellTypeStyle", "cubeCls", "cubeStyle", "cellColorMap", "oneYearMs", "getAge", "d1", "ms", "modelInfo", "ino", "aR", "modelGame", "getScoreCard", "modelPanel", "moveWest", "moveNorth", "moveSouth", "moveEast", "wait", "stop", "endGame", "udef", "keyControl", "saveGame", "saveGrid", "l1", "l2", "aLocs", "l3", "getCommands", "bldCommands", "tetris", "preview", "mesh", "previewStyle", "prevGrid", "prevColor", "evaluateGrid", "dg", "addPiece", "clock", "clearAllNodes", "down", "checkClearLine", "lineCount", "tryStart", "rotatePiece", "move", "moveLeft", "moveRight", "rotateLeft", "rotateRight", "drop", "fullMode", "gridPath", "commonWords", "randomizeCommonWords", "getWordColorClass", "word", "classes", "calculateTurnScore", "getInitialData", "coherenceScoreThreshold", "analyzing", "analyzeAndLockPhrases", "scanForCombinations", "phrasesToAnalyze", "combo", "scoredPhrase", "comboToLock", "p1Words", "p2Words", "phraseId", "wordInfo", "boardWord", "combinations", "rIdx", "currentCombination", "cIdx", "handleEndOfRound", "combinationsThisRound", "survivingPhrases", "combosToEvaluate", "gameChat", "lastMessage", "newBoard", "nextAvailableRow", "originalWord", "finalPhraseStrings", "triggerEndGame", "switchTurn", "finalPhrases", "finalPrompt", "finalMessage", "endGameChat", "prepareChatConfig", "endPromptName", "prepareEndPrompt", "preparePrompt", "chatRequestName", "endChatRequestName", "endPromptCfg", "startGame", "prepareWords", "startTimer", "resetGame", "setup", "togglePause", "exportBoardState", "exportedData", "jsonString", "textArea", "runAutopilot", "spendTurnPoints", "points", "handleRefreshWords", "playerNum", "words", "handleCustomWord", "addCustomWord", "wordName", "newWord", "choice", "emptyCells", "wordToPlace", "wordIndex", "targetCell", "wordWithPlayer", "shiftWords", "direction", "rows", "cols", "allWords", "findEmptyAdjacent", "directions", "dr", "dc", "newRow", "newCol", "handleGridDragStart", "rowIndex", "colIndex", "payload", "targetRowIndex", "targetColIndex", "emptySpot", "bumpedWord", "handleTrashDrop", "wordToTrash", "leftWords", "rightWords", "isAutoRefresh", "wordTargetCount", "wordCount", "currentWords", "wordsPerType", "wordTypes", "wordDict", "typeCode", "allExistingNames", "getNewPlayerWords", "newWords", "assignWords", "playerList", "testEndGame", "wordGame", "crumbButtons", "showBreadcrumb", "modelBreadCrumb", "oL", "objType", "typeUdef", "crumbs", "aSp", "bBack", "bJoi", "bid", "menuCls", "btnCls", "disabled", "buildBreadCrumb", "contextMenuItemHandler", "configureContextMenus", "cleanupContextMenus", "setupDisplayState", "breadCrumb", "asideMenu", "button", "icoId", "fHold", "fWrapper", "clicky", "expandCategory", "expanded", "getCategories", "topMenu", "profileDimensions", "showFavButton", "trayExpanded", "shutOnEmpty", "sCls", "sAltIco", "profileContextButton", "xProf", "activeShuffle", "favGroup", "doPickShuffle", "filter", "bBlend", "loadFavGroup", "shuffleTray", "buttons", "workingBtns", "mid", "blendable", "blendy", "blendCls", "favButton", "blendButton", "backButton", "trayCls", "tray", "lastNot", "not", "notiActive", "mr", "panel", "panels", "modelPanelContents", "clickPanelItem", "baseType", "getProtoCat", "renderPortraitField", "fieldName", "maxMode", "imgClass", "renderImageField", "buildMediaPath", "renderVideoField", "vidClass", "renderAudioField", "audClass", "renderTextField", "renderPDFField", "renderMarkdownField", "renderMessageContentField", "renderInnerObjectView", "attrsWithModel", "renderer", "renderObjectView", "renderCarouselControls", "entityName", "view", "updateChange", "renderFormView", "renderInnerFormView", "objView", "objDat", "renderForm", "useCls", "getRowCount", "getMaxElementValue", "addFormRow", "setEntityBinding", "removeFormRow", "patterns", "getPatternType", "rule", "invalid", "validateForm", "oF", "getAppForm", "formVal", "pid", "isSupportedBinaryType", "out_bool", "entityMap", "saveForm", "xtr", "testEl", "testName", "ename", "modelRule", "rid", "rule2", "oDV", "aInc", "oP", "res3", "rej3", "s2", "crule", "modelElement", "element", "component", "patternId", "errCls", "modelElementContainer", "layout", "className", "labelClass", "formView", "els", "grid", "altCls", "rowE", "skipDel", "skipRow", "cells", "i2", "setApp", "setEntity", "bind", "vals", "getDefaultOffset", "ev", "e3", "evv", "navigation", "navigable", "nav", "eventPath", "menuPath", "len", "sMenuId", "navg", "buttonPath", "vQuery", "altClass", "sAltCls", "bF", "bN", "mnu", "ignoreList", "gid", "oMenu", "btn", "asideToggle", "asideGlass", "crumb", "newPaginationControl", "requesting", "embeddedMode", "newPagination", "containerType", "getSearchQuery", "getRequestFields", "handleList", "gq", "handleCount", "listRouter", "iPage", "updatePage", "navNext", "bRedrawOnly", "getPageUrl", "navPrev", "ttype", "uType", "fType", "modList", "flds", "stopPaginating", "updateList", "navigateByParent", "bSystem", "sort", "usePage", "doFilter", "sFilt", "paginationControlBar", "pageButtons", "paginationButton", "bMore", "left", "right", "maxI", "getPageState", "bEmbed", "designer", "designStyle", "designHtml", "caller", "toggled", "pickData", "pickDataObject", "codeMirror", "handlePickData", "insertObjectAtCaret", "frame", "oA", "oI", "sThumbUrl", "sUrl", "insertNodeAtCaret", "oNode", "sel", "range", "pickImage", "defAct", "action", "opt", "transitionHandler", "refreshDesignSources", "alignSource", "setupDesigner", "designDocumentHeader", "designDocumentFooter", "writeFrame", "toggleStyle", "sStyle", "formatOptions", "fontOptions", "fontSizeOptions", "fontColorOptions", "fillColorOptions", "designDocumentDefContent", "bytes", "tarea", "annotations", "docType", "enableDesigner", "sSource", "getDesignField", "getDesigner", "getRichTextDesigner", "getCodeDesigner", "newTreeComponent", "treeMatrix", "autoExpand", "selectedNode", "originRole", "originPermission", "pendingRefresh", "olioMode", "checkOlio", "olio", "inlineType", "dlg", "inlineAdd", "mtx", "newGrp", "resetNode", "addNew", "scrollToLast", "deleteNode", "tmx", "refreshTree", "getTreeView", "tree", "buttonBar", "getTreeViewNode", "getMatrix", "bGroup", "nodeName", "fList", "fListType", "builtIn", "pathType", "expandNode", "selectNode", "getNestedTreeView", "bExpand", "nest", "rb", "bb", "n1", "n2", "altActive", "selId", "itemProps", "skipList", "pickerMode", "childPickerMode", "fieldPicker", "altEntity", "altPath", "pickerHandler", "useEntity", "setType", "preparePicker", "pv", "cancelPicker", "enablePicker", "bNoRefresh", "picker", "renderers", "audioRecord", "inputAttrs", "selectAttrs", "vs", "optAttrs", "progressAttrs", "buttonHandler", "buttonContent", "buttonAttrs", "createAudioRecordButton", "applyDragAndDrop", "textareaAttrs", "buildThumbnailPath", "fieldClass", "dataUrl", "clickHandler", "modelKey", "ui", "currentIndex", "sharingTags", "navigate", "deleteImage", "setAsProfile", "toggleTag", "imgTags", "hasTag", "openImageInNewTab", "currentImage", "currentTags", "navButtons", "tagsList", "printHandler", "valPick", "findVal", "pageCtx", "pickerName", "fieldView", "tableType", "tableForm", "tableFieldView", "tableField", "hasRenderer", "getRenderer", "register", "fn", "formFieldRenderers", "pickMember", "addMember", "pickCtx", "deleteMember", "valuesState", "foreignData", "vProp", "objectMembers", "memberObjects", "paftype", "pftype", "ptype", "pickEntity", "addEntity", "openEntity", "ent", "deleteEntity", "reparent", "children", "pickChild", "addChild", "deleteChild", "objectControls", "objectRequests", "membership", "editEntry", "cancelEntry", "deleteEntry", "newEntry", "ne", "checkEntry", "parentField", "einst", "fk", "aB", "tableEntry", "emojiLoadReq", "emojiDict", "emojiReq", "emojiDesc", "emojiCat", "emojiSubCat", "emojiResults", "searchEmojis", "findEmojis", "emojiMenuButton", "emojiCategories", "loadEmojiDict", "ejs", "itm", "emojiContextButton", "renderEmojiButton", "markdownEmojis", "ea", "extractEmojis", "findEmojiDesc", "findEmojiName", "edd", "ed", "emoji", "ad", "targetEmoji", "categoryName", "subCategories", "subCategoryName", "foundEmoji", "be", "rea", "ar", "et", "emojiRegex", "exportEmojis", "delim", "tsvContent", "subCategory", "ems", "emojiChar", "unicode", "gameContextButton", "gameMenuButton", "route", "renderGameButton", "games", "audioMap", "audioSource", "visualizers", "recorder", "upNext", "newMagic8", "magic8", "clearMagic8", "audioMagic8", "preserveContent", "stopAudioSources", "clearAudioSource", "canvasTop", "canvasBottom", "configureMagic8", "prune", "aMsg", "messagesToProcess", "currentContent", "contentChanged", "sysProfileId", "usrProfileId", "actualIndex", "profId", "createAudioSource", "props1", "props2", "togglePlayMagic8", "currentAudio", "togglePlayAudioSource", "bgAudio", "bgAnim", "bgImg", "imgBase", "imgCfg", "imageTransition", "getMagic8View", "sysUrl", "usrUrl", "gimg", "qg", "imageClasses", "dom", "drawSpiral", "drawMandala", "canvas", "width", "height", "centerX", "centerY", "animate", "pulse", "rotation", "petals", "layers", "layer", "radius", "petalLength", "petalWidth", "angle", "spiralSpeed", "pulseSpeed", "strokeColor", "newRecorder", "togglePlayAudio", "isStreamSilent", "threshold", "bufferLength", "dataArray", "maxAmplitude", "amplitude", "recordWithVisualizer", "saveHandler", "mediaStream", "audioCtx", "analyzer", "chunks", "mediaRecorder", "silenceCount", "totalSilenceTime", "silenceStartTime", "isCurrentlySilent", "ab_b64", "buf", "getAudioBase64", "blob", "buff", "sendChunk", "chunk", "close", "b64", "checkSilence", "isSilent", "currentTime", "silenceDuration", "currentSilenceTime", "totalCurrentSilence", "toggleRecord", "audioBlob", "newAudioStream", "errorMsg", "stopRecording", "track", "extractText", "dataB64", "unconfigureAudio", "enabled", "configureVisualizer", "autoPlay", "oM", "getAudioMapForContainer", "audioMotion", "getRunningAudioSources", "configureAudio", "aM", "aud2", "autoStop", "noStart", "audio", "createAudioVisualizer", "contId", "base64ToArrayBuffer", "base64", "cleanedBase64", "binaryString", "tmpAud", "audioContext", "audioBuffer", "recording", "recordButton", "recordField", "recognition", "SpeechRecognition", "currentHandler", "finalTranscript", "baseText", "interimTranscript", "transcript", "toneCtx", "leftOsc", "rightOsc", "leftGain", "rightGain", "masterGain", "merger", "baseFreq", "minBeat", "maxBeat", "sweepDurationMin", "sweepInterval", "startBinauralSweep", "dcBlocker", "rampTime", "targetVolume", "startTime", "scheduleSweep", "stopBinauralSweep", "now", "halfCycle", "audioSourceControllers", "registerAudioSource", "controller", "unregisterAudioSource", "stopAllAudioSourceControllers", "except", "simpleHash", "hash", "synthesizeAudio", "arrayBuffer", "createSourceNode", "play", "api", "pause", "resume", "togglePlayPause", "destroy", "AudioVisualizer", "tryCreateVisualizer", "currentAudioSource", "analyzerNode", "actualHeight", "cssClass", "SimpleAudioPlayer", "isPlaying", "vizElement", "Magic8Ball", "audioSource1", "audioSource2", "lastContentHash", "backgroundImages", "imageBaseGroupsLoaded", "hasAutoPlayedForHash", "getContentHash", "getOrCreateAudioSource", "role", "existingSource", "setupAudioSources", "shouldAutoPlay", "contentHash", "currentHash", "useProfile", "isCapturing", "isInitialized", "videoEl", "deviceInit", "videoDevices", "selectedDeviceId", "API_ENDPOINT", "CAPTURE_INTERVAL_SECONDS", "captureIntervalId", "videoElement", "initializeAndFindDevices", "fCaptureHandler", "device", "pickCamera", "startCapture", "selectedLabel", "constraints", "captureAndSend", "capturing", "imageData", "camera", "seconds", "mainPage", "nodeMain", "signInPage", "doLogin", "organizations", "toggleSpecify", "orgFieldDesigner", "organizationField", "authenticatedPage", "newListControl", "listPage", "wentBack", "carousel", "info", "listType", "baseListType", "listContainerId", "navContainerId", "navFilter", "embeddedController", "pickerCancel", "containerMode", "defaultRecordCount", "defaultIconRecordCount", "infiniteScroll", "showFooter", "showIconFooter", "systemList", "taggingInProgress", "textField", "plc", "fKeyHandler", "getSelected", "getSelectedIndices", "aRes", "aSel", "getType", "editItem", "editSelected", "deleteSelected", "contType", "bBucket", "applyTagsToList", "closeSelected", "openSelected", "navigateUp", "navigateToPathId", "ltype", "byParent", "openSystemLibrary", "openOlio", "openFavorites", "openPath", "navigateDown", "listSystemType", "openItem", "selectResult", "toggleInfo", "toggleContainer", "toggleGrid", "bOff", "toggleCarousel", "toggleCarouselFull", "bForce", "toggleCarouselMax", "displayGrid", "getListController", "getCurrentResults", "moveCarousel", "moveCarouselTo", "checkScrollPagination", "displayList", "limit", "getOptionButton", "optButton", "disableUp", "getAdminButtons", "rs", "favSel", "getPickerButton", "getActionButtons", "openCloud", "getPageToggleButtons", "getGroupSearchButtons", "getOlioButtons", "oliSel", "getFavoriteButtons", "getActionButtonBar", "getListViewInner", "fdoh", "fdrh", "npath", "red", "getListView", "navListKey", "initParams", "listFilter", "currentDefaultRecordCount", "cient", "newObjectPage", "pinst", "oinst", "tabIndex", "designMode", "callerIndex", "callerActive", "pendingResponse", "definition", "listView", "objectNew", "parentNew", "streamSeg", "parentProperty", "printJSONToWindow", "bu", "toggleDesignMode", "txtEl", "doUpdate", "syncText", "bpatch", "upatch", "puint", "uint", "bNew", "doCancel", "applyTags", "doCopy", "resetEntity", "doDelete", "buttonTab", "icoName", "switchTab", "getFormatForContentType", "postRender", "getFormCommands", "bSel", "bAdjust", "cmd", "func", "getFormCommandView", "getValuesForFormField", "hidden", "cmds", "getValuesForTableField", "rowModel", "rowClass", "cv", "rm", "modelField", "spans", "spans2", "modelFieldContainer", "getObjectProperty", "vVal", "altName", "altVal", "noChange", "altForm", "aom", "getPrimitive", "aname", "rendererCtx", "doFieldPicker", "doFieldOpen", "doFieldClear", "streamId", "rendered", "modelForm", "minst", "mo", "oid", "ooinst", "outF", "modelPicker", "pickList", "getForm", "cactive", "mForm", "cForm", "getFormTabs", "tabs", "getFooter", "getObjectViewInner", "designable", "getObjectView", "primitive", "cobj", "bPNew", "setInst", "ldraw", "getMembershipContext", "getTableEntryContext", "gpath", "fact", "properties", "prq", "stype", "pname", "uname", "newNavigatorControl", "navigator", "treeView", "altView", "getNavigatorTopMenuView", "getSplitContainerView", "splitLeft", "getSplitLeftContainerView", "getSplitRightContainerView", "getResultsView", "getNavigatorBottomMenuView", "getNavigatorView", "newChatControl", "aPCfg", "aSess", "audioText", "newChatConfig", "hideThoughts", "editIndex", "editMode", "resolvingImages", "showTagSelector", "selectedImageTags", "patchChatImageToken", "replacements", "sessionType", "session", "patched", "serverMsg", "getHistory", "resolveChatImages", "msgIndex", "msgs", "resolved", "newToken", "processImageTokensInContent", "msgRole", "html", "toggleImageTag", "insertImageToken", "doClear", "clearEditMode", "pickSession", "doPeek", "newChatStream", "clearChat", "m1", "newChainStream", "last", "getChainProgressView", "cs", "doChainSend", "pushHistory", "chainReq", "doStop", "doChat", "faceProfile", "loadConfigList", "c2", "c3", "getChatTopMenuView", "vsess", "bDel", "openChatSettings", "toggleAudio", "sendToMagic8", "magic8Context", "handleFaceMetricCapture", "toggleProfile", "toggleCamera", "toggleThoughts", "editMessageHistory", "toggleEditMode", "c1g", "c1l", "c2g", "c2l", "c1i", "c2i", "midx", "aidx", "amsg", "hasAutoPlayedThisSession", "align", "ectl", "ecls", "bectl", "pruneOut", "pruneToMark", "pruneTag", "pruneOther", "contentForHash", "pruneAll", "setLbl", "mark", "idx1", "idx2", "tdx1", "maxCheck", "check", "tdx2", "getChatBottomMenuView", "pendBar", "placeText", "msgProps", "tagSelectorRow", "handleAudioSave", "mimeType", "navKey", "lastCount", "oMsg", "dir2", "getChatView", "bPopSet", "game", "components", "getGameComponent", "parm", "keyHandler", "doSave", "getGameView", "comp", "particles", "particleColor", "PARTICLE_COUNT", "imageUrls", "canvasInitialized", "setupCanvas", "createParticle", "animateCanvas", "HypnoApp", "clues", "raceBlendedColor", "raceTotalScore", "weight", "genderBlendedColor", "genderTotalScore", "initialData", "clue", "cb", "callback", "groupIds", "allResults", "gqr", "groupNumericId", "groupErr", "baseIdx", "genIdx", "duration", "wasRunning", "interval", "_AudioEngine", "cleanContent", "sweepStart", "sweepTrough", "sweepEnd", "fadeInSec", "fadeOutSec", "panEnabled", "panSpeed", "panDepth", "elapsed", "panValue", "freq", "rate", "volume", "osc", "pulseGain", "isoGain", "pulseDuration", "onDuration", "offDuration", "schedulePulses", "scheduleAhead", "pulseStart", "ie", "presetName", "bands", "trough", "waypoints", "totalDuration", "segments", "segmentDuration", "targetTime", "hz", "band", "audioEngine", "noteObjectId", "voiceProfileId", "successCount", "playingIdx", "bufferNode", "durationMs", "pauseMs", "atIndex", "newHashes", "minMs", "maxMs", "_BiometricThemer", "biometricData", "blendedTheme", "emotionScores", "arousal", "intensity", "raceColor", "genderColor", "totalScore", "targetTheme", "root", "factor", "canvasElement", "audioDestination", "fps", "canvasStream", "audioStream", "recorderOptions", "sessionName", "base64Data", "ts", "marker", "minutes", "remainingSeconds", "sdConfigObjectId", "inlineConfig", "cameraComponent", "activeJobs", "base64Image", "description", "emotionPrompt", "genRequest", "request", "jobId", "pendingJob", "captureObj", "reimageUrl", "reqErr", "detail", "movedImage", "savedImage", "cutoff", "capturePath", "imageObj", "genPath", "referenceImageId", "_SessionDirector", "command", "intervalMs", "fullTemplate", "chatConfigName", "newChatCfg", "co", "optKeys", "tagLines", "userMessage", "tickNum", "ticks", "jsonStr", "firstBrace", "lastBrace", "strictErr", "fixed", "preserved", "term", "prefix", "valid", "validBands", "validEmotions", "validGenders", "json", "openBraces", "openBrackets", "inString", "escape", "stringChar", "postState", "onDirective", "onLog", "testCommand", "pass", "chatConfigs", "promptConfig", "chatConfig", "chatRequest", "testScenarios", "directives", "accumulatedLabels", "verifications", "validDirectives", "changes", "curr", "hasLabelActivity", "hasAudioChange", "hasVisualChange", "hasAskUser", "SessionDirector", "visuals", "newMode", "pulseFactor", "alpha", "speed", "useHueCycle", "cornerDist", "maxPoints", "radiusGrowth", "layerSpacing", "shift", "lr", "lg", "lb", "maxRadius", "rings", "rank", "isEven", "percentage", "invertPct", "opacity", "borderW", "progress", "showDisc", "discActive", "gradient", "animateGlow", "newText", "fontFamily", "textAlign", "padding", "accentColor", "glowColor", "glowWave", "r2", "r3", "targetEmotion", "targetGender", "isLlm", "onToggleRecording", "onToggleAudio", "onToggleFullscreen", "onToggleMoodRing", "onToggleTestMode", "onOpenConfig", "onExit", "isRecording", "isAudioEnabled", "isFullscreen", "isTestMode", "BiometricThemer", "emotionEmoji", "genderEmoji", "bgStyle", "glowFilter", "emojiStyle", "tick", "animTypes", "visibleLabels", "fadeOut", "layerOpacity", "fadeIn", "bobY", "bobX", "glowPulse", "breath", "wave", "notes", "textObjects", "voiceNotes", "voiceData", "coreKeys", "extras", "defaults", "defaultKeys", "found", "sdInline", "onSave", "onCancel", "ef", "availableTags", "director", "Magic8App", "sessionConfigId", "contextJson", "isFS", "configId", "configName", "imageGroups", "sessionGenDir", "genDir", "firstImg", "capture", "voiceLineCount", "stateLines", "interactiveLine", "responseLine", "keys", "passCount", "passIndex", "passName", "passed", "captureCallback", "captureIntervalSec", "devices", "malePct", "dur", "animations", "pick", "goingUp", "halfCycleMs", "compCanvas", "imgAlpha", "hypnoCanvas", "visAlpha", "vizCanvas", "vizAlpha", "labelEls", "cRect", "layerAlpha", "rect", "glow", "imgRatio", "canvasRatio", "sx", "sy", "sw", "sh", "sizeMB", "returnContext", "bgColor", "transitions", "vn", "colors", "bio", "recentVoiceLines", "seqs", "emotionTransition", "previous", "secsSinceChange", "tagObjects", "firstMembers", "pickedId", "sdKeys", "origValues", "audioHandled", "audioChanged", "tagImageHandled", "insertAt", "interactiveCfg", "question", "cannedResponses", "canned", "charIdx", "typeInterval", "clamped", "eased", "chatContext", "routes", "takeDown", "refreshApplication", "usr", "rt", "setContextRoles", "hasRole", "roles", "ctxRoles"]
}
